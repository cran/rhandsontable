<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Jonathan Owen" />

<meta name="date" content="2016-02-01" />

<title>rhandsontable Introduction</title>

<script src="data:application/x-javascript;base64,KGZ1bmN0aW9uKCkgewogIC8vIElmIHdpbmRvdy5IVE1MV2lkZ2V0cyBpcyBhbHJlYWR5IGRlZmluZWQsIHRoZW4gdXNlIGl0OyBvdGhlcndpc2UgY3JlYXRlIGEKICAvLyBuZXcgb2JqZWN0LiBUaGlzIGFsbG93cyBwcmVjZWRpbmcgY29kZSB0byBzZXQgb3B0aW9ucyB0aGF0IGFmZmVjdCB0aGUKICAvLyBpbml0aWFsaXphdGlvbiBwcm9jZXNzICh0aG91Z2ggbm9uZSBjdXJyZW50bHkgZXhpc3QpLgogIHdpbmRvdy5IVE1MV2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cyB8fCB7fTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gYSB2aWV3ZXIgcGFuZS4gSWYgbm90LCB3ZSdyZSBpbiBhIHdlYiBicm93c2VyLgogIHZhciB2aWV3ZXJNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnZpZXdlck1vZGUgPQogICAgICAvXGJ2aWV3ZXJfcGFuZT0xXGIvLnRlc3Qod2luZG93LmxvY2F0aW9uKTsKCiAgLy8gU2VlIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZS4gSWYgbm90LCBpdCdzIGEgc3RhdGljIGRvY3VtZW50LgogIC8vIE5vdGUgdGhhdCBzdGF0aWMgd2lkZ2V0cyBjYW4gYXBwZWFyIGluIGJvdGggU2hpbnkgYW5kIHN0YXRpYyBtb2RlcywgYnV0CiAgLy8gb2J2aW91c2x5LCBTaGlueSB3aWRnZXRzIGNhbiBvbmx5IGFwcGVhciBpbiBTaGlueSBhcHBzL2RvY3VtZW50cy4KICB2YXIgc2hpbnlNb2RlID0gd2luZG93LkhUTUxXaWRnZXRzLnNoaW55TW9kZSA9CiAgICAgIHR5cGVvZih3aW5kb3cuU2hpbnkpICE9PSAidW5kZWZpbmVkIiAmJiAhIXdpbmRvdy5TaGlueS5vdXRwdXRCaW5kaW5nczsKCiAgLy8gV2UgY2FuJ3QgY291bnQgb24galF1ZXJ5IGJlaW5nIGF2YWlsYWJsZSwgc28gd2UgaW1wbGVtZW50IG91ciBvd24KICAvLyB2ZXJzaW9uIGlmIG5lY2Vzc2FyeS4KICBmdW5jdGlvbiBxdWVyeVNlbGVjdG9yQWxsKHNjb3BlLCBzZWxlY3RvcikgewogICAgaWYgKHR5cGVvZihqUXVlcnkpICE9PSAidW5kZWZpbmVkIiAmJiBzY29wZSBpbnN0YW5jZW9mIGpRdWVyeSkgewogICAgICByZXR1cm4gc2NvcGUuZmluZChzZWxlY3Rvcik7CiAgICB9CiAgICBpZiAoc2NvcGUucXVlcnlTZWxlY3RvckFsbCkgewogICAgICByZXR1cm4gc2NvcGUucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7CiAgICB9CiAgfQoKICBmdW5jdGlvbiBhc0FycmF5KHZhbHVlKSB7CiAgICBpZiAodmFsdWUgPT09IG51bGwpCiAgICAgIHJldHVybiBbXTsKICAgIGlmICgkLmlzQXJyYXkodmFsdWUpKQogICAgICByZXR1cm4gdmFsdWU7CiAgICByZXR1cm4gW3ZhbHVlXTsKICB9CgogIC8vIEltcGxlbWVudCBqUXVlcnkncyBleHRlbmQKICBmdW5jdGlvbiBleHRlbmQodGFyZ2V0IC8qLCAuLi4gKi8pIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDEpIHsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAxOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBzb3VyY2UgPSBhcmd1bWVudHNbaV07CiAgICAgIGZvciAodmFyIHByb3AgaW4gc291cmNlKSB7CiAgICAgICAgaWYgKHNvdXJjZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgewogICAgICAgICAgdGFyZ2V0W3Byb3BdID0gc291cmNlW3Byb3BdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9CgogIC8vIElFOCBkb2Vzbid0IHN1cHBvcnQgQXJyYXkuZm9yRWFjaC4KICBmdW5jdGlvbiBmb3JFYWNoKHZhbHVlcywgY2FsbGJhY2ssIHRoaXNBcmcpIHsKICAgIGlmICh2YWx1ZXMuZm9yRWFjaCkgewogICAgICB2YWx1ZXMuZm9yRWFjaChjYWxsYmFjaywgdGhpc0FyZyk7CiAgICB9IGVsc2UgewogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNhbGxiYWNrLmNhbGwodGhpc0FyZywgdmFsdWVzW2ldLCBpLCB2YWx1ZXMpOwogICAgICB9CiAgICB9CiAgfQoKICAvLyBSZXBsYWNlcyB0aGUgc3BlY2lmaWVkIG1ldGhvZCB3aXRoIHRoZSByZXR1cm4gdmFsdWUgb2YgZnVuY1NvdXJjZS4KICAvLwogIC8vIE5vdGUgdGhhdCBmdW5jU291cmNlIHNob3VsZCBub3QgQkUgdGhlIG5ldyBtZXRob2QsIGl0IHNob3VsZCBiZSBhIGZ1bmN0aW9uCiAgLy8gdGhhdCBSRVRVUk5TIHRoZSBuZXcgbWV0aG9kLiBmdW5jU291cmNlIHJlY2VpdmVzIGEgc2luZ2xlIGFyZ3VtZW50IHRoYXQgaXMKICAvLyB0aGUgb3ZlcnJpZGRlbiBtZXRob2QsIGl0IGNhbiBiZSBjYWxsZWQgZnJvbSB0aGUgbmV3IG1ldGhvZC4gVGhlIG92ZXJyaWRkZW4KICAvLyBtZXRob2QgY2FuIGJlIGNhbGxlZCBsaWtlIGEgcmVndWxhciBmdW5jdGlvbiwgaXQgaGFzIHRoZSB0YXJnZXQgcGVybWFuZW50bHkKICAvLyBib3VuZCB0byBpdCBzbyAidGhpcyIgd2lsbCB3b3JrIGNvcnJlY3RseS4KICBmdW5jdGlvbiBvdmVycmlkZU1ldGhvZCh0YXJnZXQsIG1ldGhvZE5hbWUsIGZ1bmNTb3VyY2UpIHsKICAgIHZhciBzdXBlckZ1bmMgPSB0YXJnZXRbbWV0aG9kTmFtZV0gfHwgZnVuY3Rpb24oKSB7fTsKICAgIHZhciBzdXBlckZ1bmNCb3VuZCA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gc3VwZXJGdW5jLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTsKICAgIH07CiAgICB0YXJnZXRbbWV0aG9kTmFtZV0gPSBmdW5jU291cmNlKHN1cGVyRnVuY0JvdW5kKTsKICB9CgogIC8vIEltcGxlbWVudCBhIHZhZ3VlIGZhY3NpbWlsaWUgb2YgalF1ZXJ5J3MgZGF0YSBtZXRob2QKICBmdW5jdGlvbiBlbGVtZW50RGF0YShlbCwgbmFtZSwgdmFsdWUpIHsKICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDIpIHsKICAgICAgcmV0dXJuIGVsWyJodG1sd2lkZ2V0X2RhdGFfIiArIG5hbWVdOwogICAgfSBlbHNlIGlmIChhcmd1bWVudHMubGVuZ3RoID09IDMpIHsKICAgICAgZWxbImh0bWx3aWRnZXRfZGF0YV8iICsgbmFtZV0gPSB2YWx1ZTsKICAgICAgcmV0dXJuIGVsOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJXcm9uZyBudW1iZXIgb2YgYXJndW1lbnRzIGZvciBlbGVtZW50RGF0YTogIiArCiAgICAgICAgYXJndW1lbnRzLmxlbmd0aCk7CiAgICB9CiAgfQoKICAvLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzM0NDYxNzAvZXNjYXBlLXN0cmluZy1mb3ItdXNlLWluLWphdmFzY3JpcHQtcmVnZXgKICBmdW5jdGlvbiBlc2NhcGVSZWdFeHAoc3RyKSB7CiAgICByZXR1cm4gc3RyLnJlcGxhY2UoL1tcLVxbXF1cL1x7XH1cKFwpXCpcK1w/XC5cXFxeXCRcfF0vZywgIlxcJCYiKTsKICB9CgogIGZ1bmN0aW9uIGhhc0NsYXNzKGVsLCBjbGFzc05hbWUpIHsKICAgIHZhciByZSA9IG5ldyBSZWdFeHAoIlxcYiIgKyBlc2NhcGVSZWdFeHAoY2xhc3NOYW1lKSArICJcXGIiKTsKICAgIHJldHVybiByZS50ZXN0KGVsLmNsYXNzTmFtZSk7CiAgfQoKICAvLyBlbGVtZW50cyAtIGFycmF5IChvciBhcnJheS1saWtlIG9iamVjdCkgb2YgSFRNTCBlbGVtZW50cwogIC8vIGNsYXNzTmFtZSAtIGNsYXNzIG5hbWUgdG8gdGVzdCBmb3IKICAvLyBpbmNsdWRlIC0gaWYgdHJ1ZSwgb25seSByZXR1cm4gZWxlbWVudHMgd2l0aCBnaXZlbiBjbGFzc05hbWU7CiAgLy8gICBpZiBmYWxzZSwgb25seSByZXR1cm4gZWxlbWVudHMgKndpdGhvdXQqIGdpdmVuIGNsYXNzTmFtZQogIGZ1bmN0aW9uIGZpbHRlckJ5Q2xhc3MoZWxlbWVudHMsIGNsYXNzTmFtZSwgaW5jbHVkZSkgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKICAgICAgaWYgKGhhc0NsYXNzKGVsZW1lbnRzW2ldLCBjbGFzc05hbWUpID09IGluY2x1ZGUpCiAgICAgICAgcmVzdWx0cy5wdXNoKGVsZW1lbnRzW2ldKTsKICAgIH0KICAgIHJldHVybiByZXN1bHRzOwogIH0KCiAgZnVuY3Rpb24gb24ob2JqLCBldmVudE5hbWUsIGZ1bmMpIHsKICAgIGlmIChvYmouYWRkRXZlbnRMaXN0ZW5lcikgewogICAgICBvYmouYWRkRXZlbnRMaXN0ZW5lcihldmVudE5hbWUsIGZ1bmMsIGZhbHNlKTsKICAgIH0gZWxzZSBpZiAob2JqLmF0dGFjaEV2ZW50KSB7CiAgICAgIG9iai5hdHRhY2hFdmVudChldmVudE5hbWUsIGZ1bmMpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gb2ZmKG9iaiwgZXZlbnROYW1lLCBmdW5jKSB7CiAgICBpZiAob2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIpCiAgICAgIG9iai5yZW1vdmVFdmVudExpc3RlbmVyKGV2ZW50TmFtZSwgZnVuYywgZmFsc2UpOwogICAgZWxzZSBpZiAob2JqLmRldGFjaEV2ZW50KSB7CiAgICAgIG9iai5kZXRhY2hFdmVudChldmVudE5hbWUsIGZ1bmMpOwogICAgfQogIH0KCiAgLy8gVHJhbnNsYXRlIGFycmF5IG9mIHZhbHVlcyB0byB0b3AvcmlnaHQvYm90dG9tL2xlZnQsIGFzIHVzdWFsIHdpdGgKICAvLyB0aGUgInBhZGRpbmciIENTUyBwcm9wZXJ0eQogIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0NTUy9wYWRkaW5nCiAgZnVuY3Rpb24gdW5wYWNrUGFkZGluZyh2YWx1ZSkgewogICAgaWYgKHR5cGVvZih2YWx1ZSkgPT09ICJudW1iZXIiKQogICAgICB2YWx1ZSA9IFt2YWx1ZV07CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAxKSB7CiAgICAgIHJldHVybiB7dG9wOiB2YWx1ZVswXSwgcmlnaHQ6IHZhbHVlWzBdLCBib3R0b206IHZhbHVlWzBdLCBsZWZ0OiB2YWx1ZVswXX07CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAyKSB7CiAgICAgIHJldHVybiB7dG9wOiB2YWx1ZVswXSwgcmlnaHQ6IHZhbHVlWzFdLCBib3R0b206IHZhbHVlWzBdLCBsZWZ0OiB2YWx1ZVsxXX07CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAzKSB7CiAgICAgIHJldHVybiB7dG9wOiB2YWx1ZVswXSwgcmlnaHQ6IHZhbHVlWzFdLCBib3R0b206IHZhbHVlWzJdLCBsZWZ0OiB2YWx1ZVsxXX07CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSA0KSB7CiAgICAgIHJldHVybiB7dG9wOiB2YWx1ZVswXSwgcmlnaHQ6IHZhbHVlWzFdLCBib3R0b206IHZhbHVlWzJdLCBsZWZ0OiB2YWx1ZVszXX07CiAgICB9CiAgfQoKICAvLyBDb252ZXJ0IGFuIHVucGFja2VkIHBhZGRpbmcgb2JqZWN0IHRvIGEgQ1NTIHZhbHVlCiAgZnVuY3Rpb24gcGFkZGluZ1RvQ3NzKHBhZGRpbmdPYmopIHsKICAgIHJldHVybiBwYWRkaW5nT2JqLnRvcCArICJweCAiICsgcGFkZGluZ09iai5yaWdodCArICJweCAiICsgcGFkZGluZ09iai5ib3R0b20gKyAicHggIiArIHBhZGRpbmdPYmoubGVmdCArICJweCI7CiAgfQoKICAvLyBNYWtlcyBhIG51bWJlciBzdWl0YWJsZSBmb3IgQ1NTCiAgZnVuY3Rpb24gcHgoeCkgewogICAgaWYgKHR5cGVvZih4KSA9PT0gIm51bWJlciIpCiAgICAgIHJldHVybiB4ICsgInB4IjsKICAgIGVsc2UKICAgICAgcmV0dXJuIHg7CiAgfQoKICAvLyBSZXRyaWV2ZXMgcnVudGltZSB3aWRnZXQgc2l6aW5nIGluZm9ybWF0aW9uIGZvciBhbiBlbGVtZW50LgogIC8vIFRoZSByZXR1cm4gdmFsdWUgaXMgZWl0aGVyIG51bGwsIG9yIGFuIG9iamVjdCB3aXRoIGZpbGwsIHBhZGRpbmcsCiAgLy8gZGVmYXVsdFdpZHRoLCBkZWZhdWx0SGVpZ2h0IGZpZWxkcy4KICBmdW5jdGlvbiBzaXppbmdQb2xpY3koZWwpIHsKICAgIHZhciBzaXppbmdFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoInNjcmlwdFtkYXRhLWZvcj0nIiArIGVsLmlkICsgIiddW3R5cGU9J2FwcGxpY2F0aW9uL2h0bWx3aWRnZXQtc2l6aW5nJ10iKTsKICAgIGlmICghc2l6aW5nRWwpCiAgICAgIHJldHVybiBudWxsOwogICAgdmFyIHNwID0gSlNPTi5wYXJzZShzaXppbmdFbC50ZXh0Q29udGVudCB8fCBzaXppbmdFbC50ZXh0IHx8ICJ7fSIpOwogICAgaWYgKHZpZXdlck1vZGUpIHsKICAgICAgcmV0dXJuIHNwLnZpZXdlcjsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBzcC5icm93c2VyOwogICAgfQogIH0KCiAgZnVuY3Rpb24gaW5pdFNpemluZyhlbCkgewogICAgdmFyIHNpemluZyA9IHNpemluZ1BvbGljeShlbCk7CiAgICBpZiAoIXNpemluZykKICAgICAgcmV0dXJuOwoKICAgIHZhciBjZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiaHRtbHdpZGdldF9jb250YWluZXIiKTsKICAgIGlmICghY2VsKQogICAgICByZXR1cm47CgogICAgaWYgKHR5cGVvZihzaXppbmcucGFkZGluZykgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUubWFyZ2luID0gIjAiOwogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLnBhZGRpbmcgPSBwYWRkaW5nVG9Dc3ModW5wYWNrUGFkZGluZyhzaXppbmcucGFkZGluZykpOwogICAgfQoKICAgIGlmIChzaXppbmcuZmlsbCkgewogICAgICBkb2N1bWVudC5ib2R5LnN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5oZWlnaHQgPSAiMTAwJSI7CiAgICAgIGlmIChjZWwpIHsKICAgICAgICBjZWwuc3R5bGUucG9zaXRpb24gPSAiYWJzb2x1dGUiOwogICAgICAgIHZhciBwYWQgPSB1bnBhY2tQYWRkaW5nKHNpemluZy5wYWRkaW5nKTsKICAgICAgICBjZWwuc3R5bGUudG9wID0gcGFkLnRvcCArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLnJpZ2h0ID0gcGFkLnJpZ2h0ICsgInB4IjsKICAgICAgICBjZWwuc3R5bGUuYm90dG9tID0gcGFkLmJvdHRvbSArICJweCI7CiAgICAgICAgY2VsLnN0eWxlLmxlZnQgPSBwYWQubGVmdCArICJweCI7CiAgICAgICAgZWwuc3R5bGUud2lkdGggPSAiMTAwJSI7CiAgICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGNlbC5vZmZzZXRXaWR0aDsgfSwKICAgICAgICBnZXRIZWlnaHQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2VsLm9mZnNldEhlaWdodDsgfQogICAgICB9OwoKICAgIH0gZWxzZSB7CiAgICAgIGVsLnN0eWxlLndpZHRoID0gcHgoc2l6aW5nLndpZHRoKTsKICAgICAgZWwuc3R5bGUuaGVpZ2h0ID0gcHgoc2l6aW5nLmhlaWdodCk7CgogICAgICByZXR1cm4gewogICAgICAgIGdldFdpZHRoOiBmdW5jdGlvbigpIHsgcmV0dXJuIGVsLm9mZnNldFdpZHRoOyB9LAogICAgICAgIGdldEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiBlbC5vZmZzZXRIZWlnaHQ7IH0KICAgICAgfTsKICAgIH0KICB9CgogIC8vIERlZmF1bHQgaW1wbGVtZW50YXRpb25zIGZvciBtZXRob2RzCiAgdmFyIGRlZmF1bHRzID0gewogICAgZmluZDogZnVuY3Rpb24oc2NvcGUpIHsKICAgICAgcmV0dXJuIHF1ZXJ5U2VsZWN0b3JBbGwoc2NvcGUsICIuIiArIHRoaXMubmFtZSk7CiAgICB9LAogICAgcmVuZGVyRXJyb3I6IGZ1bmN0aW9uKGVsLCBlcnIpIHsKICAgICAgdmFyICRlbCA9ICQoZWwpOwoKICAgICAgdGhpcy5jbGVhckVycm9yKGVsKTsKCiAgICAgIC8vIEFkZCBhbGwgdGhlc2UgZXJyb3IgY2xhc3NlcywgYXMgU2hpbnkgZG9lcwogICAgICB2YXIgZXJyQ2xhc3MgPSAic2hpbnktb3V0cHV0LWVycm9yIjsKICAgICAgaWYgKGVyci50eXBlICE9PSBudWxsKSB7CiAgICAgICAgLy8gdXNlIHRoZSBjbGFzc2VzIG9mIHRoZSBlcnJvciBjb25kaXRpb24gYXMgQ1NTIGNsYXNzIG5hbWVzCiAgICAgICAgZXJyQ2xhc3MgPSBlcnJDbGFzcyArICIgIiArICQubWFwKGFzQXJyYXkoZXJyLnR5cGUpLCBmdW5jdGlvbih0eXBlKSB7CiAgICAgICAgICByZXR1cm4gZXJyQ2xhc3MgKyAiLSIgKyB0eXBlOwogICAgICAgIH0pLmpvaW4oIiAiKTsKICAgICAgfQogICAgICBlcnJDbGFzcyA9IGVyckNsYXNzICsgIiBodG1sd2lkZ2V0cy1lcnJvciI7CgogICAgICAvLyBJcyBlbCBpbmxpbmUgb3IgYmxvY2s/IElmIGlubGluZSBvciBpbmxpbmUtYmxvY2ssIGp1c3QgZGlzcGxheTpub25lIGl0CiAgICAgIC8vIGFuZCBhZGQgYW4gaW5saW5lIGVycm9yLgogICAgICB2YXIgZGlzcGxheSA9ICRlbC5jc3MoImRpc3BsYXkiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgZGlzcGxheSk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICAkZWwuaGlkZSgpOwogICAgICAgIGlmIChlcnIubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICAgIHZhciBlcnJvclNwYW4gPSAkKCI8c3Bhbj4iKS5hZGRDbGFzcyhlcnJDbGFzcyk7CiAgICAgICAgICBlcnJvclNwYW4udGV4dChlcnIubWVzc2FnZSk7CiAgICAgICAgICAkZWwuYWZ0ZXIoZXJyb3JTcGFuKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZGlzcGxheSA9PT0gImJsb2NrIikgewogICAgICAgIC8vIElmIGJsb2NrLCBhZGQgYW4gZXJyb3IganVzdCBhZnRlciB0aGUgZWwsIHNldCB2aXNpYmlsaXR5Om5vbmUgb24gdGhlCiAgICAgICAgLy8gZWwsIGFuZCBwb3NpdGlvbiB0aGUgZXJyb3IgdG8gYmUgb24gdG9wIG9mIHRoZSBlbC4KICAgICAgICAvLyBNYXJrIGl0IHdpdGggYSB1bmlxdWUgSUQgYW5kIENTUyBjbGFzcyBzbyB3ZSBjYW4gcmVtb3ZlIGl0IGxhdGVyLgogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaGlkZGVuIik7CiAgICAgICAgaWYgKGVyci5tZXNzYWdlICE9PSAiIikgewogICAgICAgICAgdmFyIGVycm9yRGl2ID0gJCgiPGRpdj4iKS5hZGRDbGFzcyhlcnJDbGFzcykuY3NzKCJwb3NpdGlvbiIsICJhYnNvbHV0ZSIpCiAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgLmNzcygibGVmdCIsIGVsLm9mZnNldExlZnQpCiAgICAgICAgICAgIC8vIHNldHRpbmcgd2lkdGggY2FuIHB1c2ggb3V0IHRoZSBwYWdlIHNpemUsIGZvcmNpbmcgb3RoZXJ3aXNlCiAgICAgICAgICAgIC8vIHVubmVjZXNzYXJ5IHNjcm9sbGJhcnMgdG8gYXBwZWFyIGFuZCBtYWtpbmcgaXQgaW1wb3NzaWJsZSBmb3IKICAgICAgICAgICAgLy8gdGhlIGVsZW1lbnQgdG8gc2hyaW5rOyBzbyB1c2UgbWF4LXdpZHRoIGluc3RlYWQKICAgICAgICAgICAgLmNzcygibWF4V2lkdGgiLCBlbC5vZmZzZXRXaWR0aCkKICAgICAgICAgICAgLmNzcygiaGVpZ2h0IiwgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgIGVycm9yRGl2LnRleHQoZXJyLm1lc3NhZ2UpOwogICAgICAgICAgJGVsLmFmdGVyKGVycm9yRGl2KTsKCiAgICAgICAgICAvLyBSZWFsbHkgZHVtYiB3YXkgdG8ga2VlcCB0aGUgc2l6ZS9wb3NpdGlvbiBvZiB0aGUgZXJyb3IgaW4gc3luYyB3aXRoCiAgICAgICAgICAvLyB0aGUgcGFyZW50IGVsZW1lbnQgYXMgdGhlIHdpbmRvdyBpcyByZXNpemVkIG9yIHdoYXRldmVyLgogICAgICAgICAgdmFyIGludElkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGlmICghZXJyb3JEaXZbMF0ucGFyZW50RWxlbWVudCkgewogICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaW50SWQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvckRpdgogICAgICAgICAgICAgIC5jc3MoInRvcCIsIGVsLm9mZnNldFRvcCkKICAgICAgICAgICAgICAuY3NzKCJsZWZ0IiwgZWwub2Zmc2V0TGVmdCkKICAgICAgICAgICAgICAuY3NzKCJtYXhXaWR0aCIsIGVsLm9mZnNldFdpZHRoKQogICAgICAgICAgICAgIC5jc3MoImhlaWdodCIsIGVsLm9mZnNldEhlaWdodCk7CiAgICAgICAgICB9LCA1MDApOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIGNsZWFyRXJyb3I6IGZ1bmN0aW9uKGVsKSB7CiAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgdmFyIGRpc3BsYXkgPSAkZWwuZGF0YSgicmVzdG9yZS1kaXNwbGF5LW1vZGUiKTsKICAgICAgJGVsLmRhdGEoInJlc3RvcmUtZGlzcGxheS1tb2RlIiwgbnVsbCk7CgogICAgICBpZiAoZGlzcGxheSA9PT0gImlubGluZSIgfHwgZGlzcGxheSA9PT0gImlubGluZS1ibG9jayIpIHsKICAgICAgICBpZiAoZGlzcGxheSkKICAgICAgICAgICRlbC5jc3MoImRpc3BsYXkiLCBkaXNwbGF5KTsKICAgICAgICAkKGVsLm5leHRTaWJsaW5nKS5maWx0ZXIoIi5odG1sd2lkZ2V0cy1lcnJvciIpLnJlbW92ZSgpOwogICAgICB9IGVsc2UgaWYgKGRpc3BsYXkgPT09ICJibG9jayIpewogICAgICAgICRlbC5jc3MoInZpc2liaWxpdHkiLCAiaW5oZXJpdCIpOwogICAgICAgICQoZWwubmV4dFNpYmxpbmcpLmZpbHRlcigiLmh0bWx3aWRnZXRzLWVycm9yIikucmVtb3ZlKCk7CiAgICAgIH0KICAgIH0sCiAgICBzaXppbmc6IHt9CiAgfTsKCiAgLy8gQ2FsbGVkIGJ5IHdpZGdldCBiaW5kaW5ncyB0byByZWdpc3RlciBhIG5ldyB0eXBlIG9mIHdpZGdldC4gVGhlIGRlZmluaXRpb24KICAvLyBvYmplY3QgY2FuIGNvbnRhaW4gdGhlIGZvbGxvd2luZyBwcm9wZXJ0aWVzOgogIC8vIC0gbmFtZSAocmVxdWlyZWQpIC0gQSBzdHJpbmcgaW5kaWNhdGluZyB0aGUgYmluZGluZyBuYW1lLCB3aGljaCB3aWxsIGJlCiAgLy8gICB1c2VkIGJ5IGRlZmF1bHQgYXMgdGhlIENTUyBjbGFzc25hbWUgdG8gbG9vayBmb3IuCiAgLy8gLSBpbml0aWFsaXplIChvcHRpb25hbCkgLSBBIGZ1bmN0aW9uKGVsKSB0aGF0IHdpbGwgYmUgY2FsbGVkIG9uY2UgcGVyCiAgLy8gICB3aWRnZXQgZWxlbWVudDsgaWYgYSB2YWx1ZSBpcyByZXR1cm5lZCwgaXQgd2lsbCBiZSBwYXNzZWQgYXMgdGhlIHRoaXJkCiAgLy8gICB2YWx1ZSB0byByZW5kZXJWYWx1ZS4KICAvLyAtIHJlbmRlclZhbHVlIChyZXF1aXJlZCkgLSBBIGZ1bmN0aW9uKGVsLCBkYXRhLCBpbml0VmFsdWUpIHRoYXQgd2lsbCBiZQogIC8vICAgY2FsbGVkIHdpdGggZGF0YS4gU3RhdGljIGNvbnRleHRzIHdpbGwgY2F1c2UgdGhpcyB0byBiZSBjYWxsZWQgb25jZSBwZXIKICAvLyAgIGVsZW1lbnQ7IFNoaW55IGFwcHMgd2lsbCBjYXVzZSB0aGlzIHRvIGJlIGNhbGxlZCBtdWx0aXBsZSB0aW1lcyBwZXIKICAvLyAgIGVsZW1lbnQsIGFzIHRoZSBkYXRhIGNoYW5nZXMuCiAgd2luZG93LkhUTUxXaWRnZXRzLndpZGdldCA9IGZ1bmN0aW9uKGRlZmluaXRpb24pIHsKICAgIGlmICghZGVmaW5pdGlvbi5uYW1lKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIG5hbWUiKTsKICAgIH0KICAgIGlmICghZGVmaW5pdGlvbi50eXBlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHR5cGUiKTsKICAgIH0KICAgIC8vIEN1cnJlbnRseSB3ZSBvbmx5IHN1cHBvcnQgb3V0cHV0IHdpZGdldHMKICAgIGlmIChkZWZpbml0aW9uLnR5cGUgIT09ICJvdXRwdXQiKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVW5yZWNvZ25pemVkIHdpZGdldCB0eXBlICciICsgZGVmaW5pdGlvbi50eXBlICsgIiciKTsKICAgIH0KICAgIC8vIFRPRE86IFZlcmlmeSB0aGF0IC5uYW1lIGlzIGEgdmFsaWQgQ1NTIGNsYXNzbmFtZQogICAgaWYgKCFkZWZpbml0aW9uLnJlbmRlclZhbHVlKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiV2lkZ2V0IG11c3QgaGF2ZSBhIHJlbmRlclZhbHVlIGZ1bmN0aW9uIik7CiAgICB9CgogICAgLy8gRm9yIHN0YXRpYyByZW5kZXJpbmcgKG5vbi1TaGlueSksIHVzZSBhIHNpbXBsZSB3aWRnZXQgcmVnaXN0cmF0aW9uCiAgICAvLyBzY2hlbWUuIFdlIGFsc28gdXNlIHRoaXMgc2NoZW1lIGZvciBTaGlueSBhcHBzL2RvY3VtZW50cyB0aGF0IGFsc28KICAgIC8vIGNvbnRhaW4gc3RhdGljIHdpZGdldHMuCiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgLy8gTWVyZ2UgZGVmYXVsdHMgaW50byB0aGUgZGVmaW5pdGlvbjsgZG9uJ3QgbXV0YXRlIHRoZSBvcmlnaW5hbCBkZWZpbml0aW9uLgogICAgdmFyIHN0YXRpY0JpbmRpbmcgPSBleHRlbmQoe30sIGRlZmF1bHRzLCBkZWZpbml0aW9uKTsKICAgIG92ZXJyaWRlTWV0aG9kKHN0YXRpY0JpbmRpbmcsICJmaW5kIiwgZnVuY3Rpb24oc3VwZXJmdW5jKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbihzY29wZSkgewogICAgICAgIHZhciByZXN1bHRzID0gc3VwZXJmdW5jKHNjb3BlKTsKICAgICAgICAvLyBGaWx0ZXIgb3V0IFNoaW55IG91dHB1dHMsIHdlIG9ubHkgd2FudCB0aGUgc3RhdGljIGtpbmQKICAgICAgICByZXR1cm4gZmlsdGVyQnlDbGFzcyhyZXN1bHRzLCAiaHRtbC13aWRnZXQtb3V0cHV0IiwgZmFsc2UpOwogICAgICB9OwogICAgfSk7CiAgICB3aW5kb3cuSFRNTFdpZGdldHMud2lkZ2V0cy5wdXNoKHN0YXRpY0JpbmRpbmcpOwoKICAgIGlmIChzaGlueU1vZGUpIHsKICAgICAgLy8gU2hpbnkgaXMgcnVubmluZy4gUmVnaXN0ZXIgdGhlIGRlZmluaXRpb24gYXMgYW4gb3V0cHV0IGJpbmRpbmcuCgogICAgICAvLyBNZXJnZSBkZWZhdWx0cyBpbnRvIHRoZSBkZWZpbml0aW9uOyBkb24ndCBtdXRhdGUgdGhlIG9yaWdpbmFsIGRlZmluaXRpb24uCiAgICAgIC8vIFRoZSBiYXNlIG9iamVjdCBpcyBhIFNoaW55IG91dHB1dCBiaW5kaW5nIGlmIHdlJ3JlIHJ1bm5pbmcgaW4gU2hpbnkgbW9kZSwKICAgICAgLy8gb3IgYW4gZW1wdHkgb2JqZWN0IGlmIHdlJ3JlIG5vdC4KICAgICAgdmFyIHNoaW55QmluZGluZyA9IGV4dGVuZChuZXcgU2hpbnkuT3V0cHV0QmluZGluZygpLCBkZWZhdWx0cywgZGVmaW5pdGlvbik7CgogICAgICAvLyBXcmFwIHJlbmRlclZhbHVlIHRvIGhhbmRsZSBpbml0aWFsaXphdGlvbiwgd2hpY2ggdW5mb3J0dW5hdGVseSBpc24ndAogICAgICAvLyBzdXBwb3J0ZWQgbmF0aXZlbHkgYnkgU2hpbnkgYXQgdGhlIHRpbWUgb2YgdGhpcyB3cml0aW5nLgoKICAgICAgLy8gTkI6IHNoaW55QmluZGluZy5pbml0aWFsaXplIG1heSBiZSB1bmRlZmluZWQsIGFzIGl0J3Mgb3B0aW9uYWwuCgogICAgICAvLyBSZW5hbWUgaW5pdGlhbGl6ZSB0byBtYWtlIHN1cmUgaXQgaXNuJ3QgY2FsbGVkIGJ5IGEgZnV0dXJlIHZlcnNpb24KICAgICAgLy8gb2YgU2hpbnkgdGhhdCBkb2VzIHN1cHBvcnQgaW5pdGlhbGl6ZSBkaXJlY3RseS4KICAgICAgc2hpbnlCaW5kaW5nLl9odG1sd2lkZ2V0c19pbml0aWFsaXplID0gc2hpbnlCaW5kaW5nLmluaXRpYWxpemU7CiAgICAgIGRlbGV0ZSBzaGlueUJpbmRpbmcuaW5pdGlhbGl6ZTsKCiAgICAgIG92ZXJyaWRlTWV0aG9kKHNoaW55QmluZGluZywgImZpbmQiLCBmdW5jdGlvbihzdXBlcmZ1bmMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcGUpIHsKCiAgICAgICAgICB2YXIgcmVzdWx0cyA9IHN1cGVyZnVuYyhzY29wZSk7CgogICAgICAgICAgLy8gT25seSByZXR1cm4gZWxlbWVudHMgdGhhdCBhcmUgU2hpbnkgb3V0cHV0cywgbm90IHN0YXRpYyBvbmVzCiAgICAgICAgICB2YXIgZHluYW1pY1Jlc3VsdHMgPSByZXN1bHRzLmZpbHRlcigiLmh0bWwtd2lkZ2V0LW91dHB1dCIpOwoKICAgICAgICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aGF0ZXZlciBjYXVzZWQgU2hpbnkgdG8gdGhpbmsgdGhlcmUgbWlnaHQgYmUKICAgICAgICAgIC8vIG5ldyBkeW5hbWljIG91dHB1dHMsIGFsc28gY2F1c2VkIHRoZXJlIHRvIGJlIG5ldyBzdGF0aWMgb3V0cHV0cy4KICAgICAgICAgIC8vIFNpbmNlIHRoZXJlIG1pZ2h0IGJlIGxvdHMgb2YgZGlmZmVyZW50IGh0bWx3aWRnZXRzIGJpbmRpbmdzLCB3ZQogICAgICAgICAgLy8gc2NoZWR1bGUgZXhlY3V0aW9uIGZvciBsYXRlci0tbm8gbmVlZCB0byBzdGF0aWNSZW5kZXIgbXVsdGlwbGUKICAgICAgICAgIC8vIHRpbWVzLgogICAgICAgICAgaWYgKHJlc3VsdHMubGVuZ3RoICE9PSBkeW5hbWljUmVzdWx0cy5sZW5ndGgpCiAgICAgICAgICAgIHNjaGVkdWxlU3RhdGljUmVuZGVyKCk7CgogICAgICAgICAgcmV0dXJuIGR5bmFtaWNSZXN1bHRzOwogICAgICAgIH07CiAgICAgIH0pOwoKICAgICAgb3ZlcnJpZGVNZXRob2Qoc2hpbnlCaW5kaW5nLCAicmVuZGVyVmFsdWUiLCBmdW5jdGlvbihzdXBlcmZ1bmMpIHsKICAgICAgICByZXR1cm4gZnVuY3Rpb24oZWwsIGRhdGEpIHsKICAgICAgICAgIC8vIFJlc29sdmUgc3RyaW5ncyBtYXJrZWQgYXMgamF2YXNjcmlwdCBsaXRlcmFscyB0byBvYmplY3RzCiAgICAgICAgICBpZiAoIShkYXRhLmV2YWxzIGluc3RhbmNlb2YgQXJyYXkpKSBkYXRhLmV2YWxzID0gW2RhdGEuZXZhbHNdOwogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGRhdGEuZXZhbHMgJiYgaSA8IGRhdGEuZXZhbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgd2luZG93LkhUTUxXaWRnZXRzLmV2YWx1YXRlU3RyaW5nTWVtYmVyKGRhdGEueCwgZGF0YS5ldmFsc1tpXSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIXRoaXMucmVuZGVyT25OdWxsVmFsdWUpIHsKICAgICAgICAgICAgaWYgKGRhdGEueCA9PT0gbnVsbCkgewogICAgICAgICAgICAgIGVsLnN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgZWwuc3R5bGUudmlzaWJpbGl0eSA9ICJpbmhlcml0IjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKCFlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIikpIHsKICAgICAgICAgICAgaW5pdFNpemluZyhlbCk7CgogICAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRpYWxpemVkIiwgdHJ1ZSk7CiAgICAgICAgICAgIGlmICh0aGlzLl9odG1sd2lkZ2V0c19pbml0aWFsaXplKSB7CiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHRoaXMuX2h0bWx3aWRnZXRzX2luaXRpYWxpemUoZWwsIGVsLm9mZnNldFdpZHRoLAogICAgICAgICAgICAgICAgZWwub2Zmc2V0SGVpZ2h0KTsKICAgICAgICAgICAgICBlbGVtZW50RGF0YShlbCwgImluaXRfcmVzdWx0IiwgcmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgU2hpbnkucmVuZGVyRGVwZW5kZW5jaWVzKGRhdGEuZGVwcyk7CiAgICAgICAgICBzdXBlcmZ1bmMoZWwsIGRhdGEueCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIG92ZXJyaWRlTWV0aG9kKHNoaW55QmluZGluZywgInJlc2l6ZSIsIGZ1bmN0aW9uKHN1cGVyZnVuYykgewogICAgICAgIHJldHVybiBmdW5jdGlvbihlbCwgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgLy8gU2hpbnkgY2FuIGNhbGwgcmVzaXplIGJlZm9yZSBpbml0aWFsaXplL3JlbmRlclZhbHVlIGhhdmUgYmVlbgogICAgICAgICAgLy8gY2FsbGVkLCB3aGljaCBkb2Vzbid0IG1ha2Ugc2Vuc2UgZm9yIHdpZGdldHMuCiAgICAgICAgICBpZiAoZWxlbWVudERhdGEoZWwsICJpbml0aWFsaXplZCIpKSB7CiAgICAgICAgICAgIHN1cGVyZnVuYyhlbCwgd2lkdGgsIGhlaWdodCwgZWxlbWVudERhdGEoZWwsICJpbml0X3Jlc3VsdCIpKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIFNoaW55Lm91dHB1dEJpbmRpbmdzLnJlZ2lzdGVyKHNoaW55QmluZGluZywgc2hpbnlCaW5kaW5nLm5hbWUpOwogICAgfQogIH07CgogIHZhciBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogIGZ1bmN0aW9uIHNjaGVkdWxlU3RhdGljUmVuZGVyKCkgewogICAgaWYgKCFzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQpIHsKICAgICAgc2NoZWR1bGVTdGF0aWNSZW5kZXJUaW1lcklkID0gc2V0VGltZW91dChmdW5jdGlvbigpIHsKICAgICAgICBzY2hlZHVsZVN0YXRpY1JlbmRlclRpbWVySWQgPSBudWxsOwogICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIoKTsKICAgICAgfSwgMSk7CiAgICB9CiAgfQoKICAvLyBSZW5kZXIgc3RhdGljIHdpZGdldHMgYWZ0ZXIgdGhlIGRvY3VtZW50IGZpbmlzaGVzIGxvYWRpbmcKICAvLyBTdGF0aWNhbGx5IHJlbmRlciBhbGwgZWxlbWVudHMgdGhhdCBhcmUgb2YgdGhpcyB3aWRnZXQncyBjbGFzcwogIHdpbmRvdy5IVE1MV2lkZ2V0cy5zdGF0aWNSZW5kZXIgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiaW5kaW5ncyA9IHdpbmRvdy5IVE1MV2lkZ2V0cy53aWRnZXRzIHx8IFtdOwogICAgZm9yRWFjaChiaW5kaW5ncywgZnVuY3Rpb24oYmluZGluZykgewogICAgICB2YXIgbWF0Y2hlcyA9IGJpbmRpbmcuZmluZChkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpOwogICAgICBmb3JFYWNoKG1hdGNoZXMsIGZ1bmN0aW9uKGVsKSB7CiAgICAgICAgdmFyIHNpemVPYmogPSBpbml0U2l6aW5nKGVsLCBiaW5kaW5nKTsKCiAgICAgICAgaWYgKGhhc0NsYXNzKGVsLCAiaHRtbC13aWRnZXQtc3RhdGljLWJvdW5kIikpCiAgICAgICAgICByZXR1cm47CiAgICAgICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lICsgIiBodG1sLXdpZGdldC1zdGF0aWMtYm91bmQiOwoKICAgICAgICB2YXIgaW5pdFJlc3VsdDsKICAgICAgICBpZiAoYmluZGluZy5pbml0aWFsaXplKSB7CiAgICAgICAgICBpbml0UmVzdWx0ID0gYmluZGluZy5pbml0aWFsaXplKGVsLAogICAgICAgICAgICBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgIHNpemVPYmogPyBzaXplT2JqLmdldEhlaWdodCgpIDogZWwub2Zmc2V0SGVpZ2h0CiAgICAgICAgICApOwogICAgICAgIH0KCiAgICAgICAgaWYgKGJpbmRpbmcucmVzaXplKSB7CiAgICAgICAgICB2YXIgbGFzdFNpemUgPSB7fTsKICAgICAgICAgIHZhciByZXNpemVIYW5kbGVyID0gZnVuY3Rpb24oZSkgewogICAgICAgICAgICB2YXIgc2l6ZSA9IHsKICAgICAgICAgICAgICB3OiBzaXplT2JqID8gc2l6ZU9iai5nZXRXaWR0aCgpIDogZWwub2Zmc2V0V2lkdGgsCiAgICAgICAgICAgICAgaDogc2l6ZU9iaiA/IHNpemVPYmouZ2V0SGVpZ2h0KCkgOiBlbC5vZmZzZXRIZWlnaHQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgaWYgKHNpemUudyA9PT0gMCAmJiBzaXplLmggPT09IDApCiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICBpZiAoc2l6ZS53ID09PSBsYXN0U2l6ZS53ICYmIHNpemUuaCA9PT0gbGFzdFNpemUuaCkKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIGxhc3RTaXplID0gc2l6ZTsKICAgICAgICAgICAgYmluZGluZy5yZXNpemUoZWwsIHNpemUudywgc2l6ZS5oLCBpbml0UmVzdWx0KTsKICAgICAgICAgIH07CgogICAgICAgICAgb24od2luZG93LCAicmVzaXplIiwgcmVzaXplSGFuZGxlcik7CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIGNhc2VzIHdoZXJlIHdlJ3JlIHJ1bm5pbmcgaW4gYSBTaGlueQogICAgICAgICAgLy8gYXBwLCBidXQgdGhlIHdpZGdldCBpdHNlbGYgaXMgbm90IGEgU2hpbnkgb3V0cHV0LCBidXQKICAgICAgICAgIC8vIHJhdGhlciBhIHNpbXBsZSBzdGF0aWMgd2lkZ2V0LiBPbmUgZXhhbXBsZSBvZiB0aGlzIGlzCiAgICAgICAgICAvLyBhbiBybWFya2Rvd24gZG9jdW1lbnQgdGhhdCBoYXMgcnVudGltZTpzaGlueSBhbmQgd2lkZ2V0CiAgICAgICAgICAvLyB0aGF0IGlzbid0IGluIGEgcmVuZGVyIGZ1bmN0aW9uLiBTaGlueSBvbmx5IGtub3dzIHRvCiAgICAgICAgICAvLyBjYWxsIHJlc2l6ZSBoYW5kbGVycyBmb3IgU2hpbnkgb3V0cHV0cywgbm90IGZvciBzdGF0aWMKICAgICAgICAgIC8vIHdpZGdldHMsIHNvIHdlIGRvIGl0IG91cnNlbHZlcy4KICAgICAgICAgIGlmICh3aW5kb3cualF1ZXJ5KSB7CiAgICAgICAgICAgIHdpbmRvdy5qUXVlcnkoZG9jdW1lbnQpLm9uKCJzaG93biIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgICB3aW5kb3cualF1ZXJ5KGRvY3VtZW50KS5vbigiaGlkZGVuIiwgcmVzaXplSGFuZGxlcik7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gVGhpcyBpcyBuZWVkZWQgZm9yIHRoZSBzcGVjaWZpYyBjYXNlIG9mIGlvc2xpZGVzLCB3aGljaAogICAgICAgICAgLy8gZmxpcHMgc2xpZGVzIGJldHdlZW4gZGlzcGxheTpub25lIGFuZCBkaXNwbGF5OmJsb2NrLgogICAgICAgICAgLy8gSWRlYWxseSB3ZSB3b3VsZCBub3QgaGF2ZSB0byBoYXZlIGlvc2xpZGUtc3BlY2lmaWMgY29kZQogICAgICAgICAgLy8gaGVyZSwgYnV0IHJhdGhlciBoYXZlIGlvc2xpZGVzIHJhaXNlIGEgZ2VuZXJpYyBldmVudCwKICAgICAgICAgIC8vIGJ1dCB0aGUgcm1hcmtkb3duIHBhY2thZ2UganVzdCB3ZW50IHRvIENSQU4gc28gdGhlCiAgICAgICAgICAvLyB3aW5kb3cgdG8gZ2V0dGluZyB0aGF0IGZpeGVkIG1heSBiZSBsb25nLgogICAgICAgICAgaWYgKHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKSB7CiAgICAgICAgICAgIC8vIEl0J3MgT0sgdG8gbGltaXQgdGhpcyB0byB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcgogICAgICAgICAgICAvLyBicm93c2VycyBiZWNhdXNlIGlvc2xpZGVzIGl0c2VsZiBvbmx5IHN1cHBvcnRzCiAgICAgICAgICAgIC8vIHN1Y2ggYnJvd3NlcnMuCiAgICAgICAgICAgIG9uKGRvY3VtZW50LCAic2xpZGVlbnRlciIsIHJlc2l6ZUhhbmRsZXIpOwogICAgICAgICAgICBvbihkb2N1bWVudCwgInNsaWRlbGVhdmUiLCByZXNpemVIYW5kbGVyKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHZhciBzY3JpcHREYXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcigic2NyaXB0W2RhdGEtZm9yPSciICsgZWwuaWQgKyAiJ11bdHlwZT0nYXBwbGljYXRpb24vanNvbiddIik7CiAgICAgICAgaWYgKHNjcmlwdERhdGEpIHsKICAgICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShzY3JpcHREYXRhLnRleHRDb250ZW50IHx8IHNjcmlwdERhdGEudGV4dCk7CiAgICAgICAgICAvLyBSZXNvbHZlIHN0cmluZ3MgbWFya2VkIGFzIGphdmFzY3JpcHQgbGl0ZXJhbHMgdG8gb2JqZWN0cwogICAgICAgICAgaWYgKCEoZGF0YS5ldmFscyBpbnN0YW5jZW9mIEFycmF5KSkgZGF0YS5ldmFscyA9IFtkYXRhLmV2YWxzXTsKICAgICAgICAgIGZvciAodmFyIGsgPSAwOyBkYXRhLmV2YWxzICYmIGsgPCBkYXRhLmV2YWxzLmxlbmd0aDsgaysrKSB7CiAgICAgICAgICAgIHdpbmRvdy5IVE1MV2lkZ2V0cy5ldmFsdWF0ZVN0cmluZ01lbWJlcihkYXRhLngsIGRhdGEuZXZhbHNba10pOwogICAgICAgICAgfQogICAgICAgICAgYmluZGluZy5yZW5kZXJWYWx1ZShlbCwgZGF0YS54LCBpbml0UmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfQoKICAvLyBXYWl0IHVudGlsIGFmdGVyIHRoZSBkb2N1bWVudCBoYXMgbG9hZGVkIHRvIHJlbmRlciB0aGUgd2lkZ2V0cy4KICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikgewogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigiRE9NQ29udGVudExvYWRlZCIsIGZ1bmN0aW9uKCkgewogICAgICBkb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCJET01Db250ZW50TG9hZGVkIiwgYXJndW1lbnRzLmNhbGxlZSwgZmFsc2UpOwogICAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7CiAgICB9LCBmYWxzZSk7CiAgfSBlbHNlIGlmIChkb2N1bWVudC5hdHRhY2hFdmVudCkgewogICAgZG9jdW1lbnQuYXR0YWNoRXZlbnQoIm9ucmVhZHlzdGF0ZWNoYW5nZSIsIGZ1bmN0aW9uKCkgewogICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gImNvbXBsZXRlIikgewogICAgICAgIGRvY3VtZW50LmRldGFjaEV2ZW50KCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCBhcmd1bWVudHMuY2FsbGVlKTsKICAgICAgICB3aW5kb3cuSFRNTFdpZGdldHMuc3RhdGljUmVuZGVyKCk7CiAgICAgIH0KICAgIH0pOwogIH0KCgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5nZXRBdHRhY2htZW50VXJsID0gZnVuY3Rpb24oZGVwbmFtZSwga2V5KSB7CiAgICAvLyBJZiBubyBrZXksIGRlZmF1bHQgdG8gdGhlIGZpcnN0IGl0ZW0KICAgIGlmICh0eXBlb2Yoa2V5KSA9PT0gInVuZGVmaW5lZCIpCiAgICAgIGtleSA9IDE7CgogICAgdmFyIGxpbmsgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkZXBuYW1lICsgIi0iICsga2V5ICsgIi1hdHRhY2htZW50Iik7CiAgICBpZiAoIWxpbmspIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJBdHRhY2htZW50ICIgKyBkZXBuYW1lICsgIi8iICsga2V5ICsgIiBub3QgZm91bmQgaW4gZG9jdW1lbnQiKTsKICAgIH0KICAgIHJldHVybiBsaW5rLmdldEF0dHJpYnV0ZSgiaHJlZiIpOwogIH07CgogIHdpbmRvdy5IVE1MV2lkZ2V0cy5kYXRhZnJhbWVUb0QzID0gZnVuY3Rpb24oZGYpIHsKICAgIHZhciBuYW1lcyA9IFtdOwogICAgdmFyIGxlbmd0aDsKICAgIGZvciAodmFyIG5hbWUgaW4gZGYpIHsKICAgICAgICBpZiAoZGYuaGFzT3duUHJvcGVydHkobmFtZSkpCiAgICAgICAgICAgIG5hbWVzLnB1c2gobmFtZSk7CiAgICAgICAgaWYgKHR5cGVvZihkZltuYW1lXSkgIT09ICJvYmplY3QiIHx8IHR5cGVvZihkZltuYW1lXS5sZW5ndGgpID09PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCBmaWVsZHMgbXVzdCBiZSBhcnJheXMiKTsKICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZihsZW5ndGgpICE9PSAidW5kZWZpbmVkIiAmJiBsZW5ndGggIT09IGRmW25hbWVdLmxlbmd0aCkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkFsbCBmaWVsZHMgbXVzdCBiZSBhcnJheXMgb2YgdGhlIHNhbWUgbGVuZ3RoIik7CiAgICAgICAgfQogICAgICAgIGxlbmd0aCA9IGRmW25hbWVdLmxlbmd0aDsKICAgIH0KICAgIHZhciByZXN1bHRzID0gW107CiAgICB2YXIgaXRlbTsKICAgIGZvciAodmFyIHJvdyA9IDA7IHJvdyA8IGxlbmd0aDsgcm93KyspIHsKICAgICAgICBpdGVtID0ge307CiAgICAgICAgZm9yICh2YXIgY29sID0gMDsgY29sIDwgbmFtZXMubGVuZ3RoOyBjb2wrKykgewogICAgICAgICAgICBpdGVtW25hbWVzW2NvbF1dID0gZGZbbmFtZXNbY29sXV1bcm93XTsKICAgICAgICB9CiAgICAgICAgcmVzdWx0cy5wdXNoKGl0ZW0pOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfTsKCiAgd2luZG93LkhUTUxXaWRnZXRzLnRyYW5zcG9zZUFycmF5MkQgPSBmdW5jdGlvbihhcnJheSkgewogICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSAwKSByZXR1cm4gYXJyYXk7CiAgICAgIHZhciBuZXdBcnJheSA9IGFycmF5WzBdLm1hcChmdW5jdGlvbihjb2wsIGkpIHsKICAgICAgICAgIHJldHVybiBhcnJheS5tYXAoZnVuY3Rpb24ocm93KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHJvd1tpXQogICAgICAgICAgfSkKICAgICAgfSk7CiAgICAgIHJldHVybiBuZXdBcnJheTsKICB9OwogIC8vIFNwbGl0IHZhbHVlIGF0IHNwbGl0Q2hhciwgYnV0IGFsbG93IHNwbGl0Q2hhciB0byBiZSBlc2NhcGVkCiAgLy8gdXNpbmcgZXNjYXBlQ2hhci4gQW55IG90aGVyIGNoYXJhY3RlcnMgZXNjYXBlZCBieSBlc2NhcGVDaGFyCiAgLy8gd2lsbCBiZSBpbmNsdWRlZCBhcyB1c3VhbCAoaW5jbHVkaW5nIGVzY2FwZUNoYXIgaXRzZWxmKS4KICBmdW5jdGlvbiBzcGxpdFdpdGhFc2NhcGUodmFsdWUsIHNwbGl0Q2hhciwgZXNjYXBlQ2hhcikgewogICAgdmFyIHJlc3VsdHMgPSBbXTsKICAgIHZhciBlc2NhcGVNb2RlID0gZmFsc2U7CiAgICB2YXIgY3VycmVudFJlc3VsdCA9ICIiOwogICAgZm9yICh2YXIgcG9zID0gMDsgcG9zIDwgdmFsdWUubGVuZ3RoOyBwb3MrKykgewogICAgICBpZiAoIWVzY2FwZU1vZGUpIHsKICAgICAgICBpZiAodmFsdWVbcG9zXSA9PT0gc3BsaXRDaGFyKSB7CiAgICAgICAgICByZXN1bHRzLnB1c2goY3VycmVudFJlc3VsdCk7CiAgICAgICAgICBjdXJyZW50UmVzdWx0ID0gIiI7CiAgICAgICAgfSBlbHNlIGlmICh2YWx1ZVtwb3NdID09PSBlc2NhcGVDaGFyKSB7CiAgICAgICAgICBlc2NhcGVNb2RlID0gdHJ1ZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFJlc3VsdCArPSB2YWx1ZVtwb3NdOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJyZW50UmVzdWx0ICs9IHZhbHVlW3Bvc107CiAgICAgICAgZXNjYXBlTW9kZSA9IGZhbHNlOwogICAgICB9CiAgICB9CiAgICBpZiAoY3VycmVudFJlc3VsdCAhPT0gIiIpIHsKICAgICAgcmVzdWx0cy5wdXNoKGN1cnJlbnRSZXN1bHQpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdHM7CiAgfQogIC8vIEZ1bmN0aW9uIGF1dGhvcmVkIGJ5IFlpaHVpL0pKIEFsbGFpcmUKICB3aW5kb3cuSFRNTFdpZGdldHMuZXZhbHVhdGVTdHJpbmdNZW1iZXIgPSBmdW5jdGlvbihvLCBtZW1iZXIpIHsKICAgIHZhciBwYXJ0cyA9IHNwbGl0V2l0aEVzY2FwZShtZW1iZXIsICcuJywgJ1xcJyk7CiAgICBmb3IgKHZhciBpID0gMCwgbCA9IHBhcnRzLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICB2YXIgcGFydCA9IHBhcnRzW2ldOwogICAgICAvLyBwYXJ0IG1heSBiZSBhIGNoYXJhY3RlciBvciAnbnVtZXJpYycgbWVtYmVyIG5hbWUKICAgICAgaWYgKG8gIT09IG51bGwgJiYgdHlwZW9mIG8gPT09ICJvYmplY3QiICYmIHBhcnQgaW4gbykgewogICAgICAgIGlmIChpID09IChsIC0gMSkpIHsgLy8gaWYgd2UgYXJlIGF0IHRoZSBlbmQgb2YgdGhlIGxpbmUgdGhlbiBldmFsdWxhdGUKICAgICAgICAgIGlmICh0eXBlb2Ygb1twYXJ0XSA9PT0gInN0cmluZyIpCiAgICAgICAgICAgIG9bcGFydF0gPSBldmFsKCIoIiArIG9bcGFydF0gKyAiKSIpOwogICAgICAgIH0gZWxzZSB7IC8vIG90aGVyd2lzZSBjb250aW51ZSB0byBuZXh0IGVtYmVkZGVkIG9iamVjdAogICAgICAgICAgbyA9IG9bcGFydF07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfTsKfSkoKTsKCg=="></script>
<link href="data:text/css;charset=utf-8,%40charset%20%22UTF%2D8%22%3B%2Ehandsontable%7Bposition%3Arelative%7D%2Ehandsontable%20%2Ehide%7Bdisplay%3Anone%7D%2Ehandsontable%20%2Erelative%7Bposition%3Arelative%7D%2Ehandsontable%2EhtAutoSize%7Bvisibility%3Ahidden%3Bleft%3A%2D99000px%3Bposition%3Aabsolute%3Btop%3A%2D99000px%7D%2Ehandsontable%20%2EwtHider%7Bwidth%3A0%7D%2Ehandsontable%20%2EwtSpreader%7Bposition%3Arelative%3Bwidth%3A0%3Bheight%3Aauto%7D%2Ehandsontable%20table%2C%2Ehandsontable%20tbody%2C%2Ehandsontable%20thead%2C%2Ehandsontable%20td%2C%2Ehandsontable%20th%2C%2Ehandsontable%20input%2C%2Ehandsontable%20textarea%2C%2Ehandsontable%20div%7Bbox%2Dsizing%3Acontent%2Dbox%3B%2Dwebkit%2Dbox%2Dsizing%3Acontent%2Dbox%3B%2Dmoz%2Dbox%2Dsizing%3Acontent%2Dbox%7D%2Ehandsontable%20input%2C%2Ehandsontable%20textarea%7Bmin%2Dheight%3Ainitial%7D%2Ehandsontable%20table%2EhtCore%7Bborder%2Dcollapse%3Aseparate%3Bborder%2Dspacing%3A0%3Bmargin%3A0%3Bborder%2Dwidth%3A0%3Btable%2Dlayout%3Afixed%3Bwidth%3A0%3Boutline%2Dwidth%3A0%3Bmax%2Dwidth%3Anone%3Bmax%2Dheight%3Anone%7D%2Ehandsontable%20col%7Bwidth%3A50px%7D%2Ehandsontable%20col%2ErowHeader%7Bwidth%3A50px%7D%2Ehandsontable%20th%2C%2Ehandsontable%20td%7Bborder%2Dright%3A1px%20solid%20%23CCC%3Bborder%2Dbottom%3A1px%20solid%20%23CCC%3Bheight%3A22px%3Bempty%2Dcells%3Ashow%3Bline%2Dheight%3A21px%3Bpadding%3A0%204px%200%204px%3Bbackground%2Dcolor%3A%23FFF%3Bvertical%2Dalign%3Atop%3Boverflow%3Ahidden%3Boutline%2Dwidth%3A0%3Bwhite%2Dspace%3Apre%2Dline%7D%2Ehandsontable%20td%2EhtInvalid%7Bbackground%2Dcolor%3A%23ff4c42%21important%7D%2Ehandsontable%20td%2EhtNoWrap%7Bwhite%2Dspace%3Anowrap%7D%2Ehandsontable%20th%3Alast%2Dchild%7Bborder%2Dright%3A1px%20solid%20%23CCC%3Bborder%2Dbottom%3A1px%20solid%20%23CCC%7D%2Ehandsontable%20tr%3Afirst%2Dchild%20th%2EhtNoFrame%2C%2Ehandsontable%20th%3Afirst%2Dchild%2EhtNoFrame%2C%2Ehandsontable%20th%2EhtNoFrame%7Bborder%2Dleft%2Dwidth%3A0%3Bbackground%2Dcolor%3Awhite%3Bborder%2Dcolor%3A%23FFF%7D%2Ehandsontable%20th%3Afirst%2Dchild%2C%2Ehandsontable%20td%3Afirst%2Dof%2Dtype%2C%2Ehandsontable%20%2EhtNoFrame%2Bth%2C%2Ehandsontable%20%2EhtNoFrame%2Btd%7Bborder%2Dleft%3A1px%20solid%20%23CCC%7D%2Ehandsontable%2EhtRowHeaders%20thead%20tr%20th%3Anth%2Dchild%282%29%7Bborder%2Dleft%3A1px%20solid%20%23CCC%7D%2Ehandsontable%20tr%3Afirst%2Dchild%20th%2C%2Ehandsontable%20tr%3Afirst%2Dchild%20td%7Bborder%2Dtop%3A1px%20solid%20%23CCC%7D%2Eht%5Fmaster%3Anot%28%2EinnerBorderLeft%29%20%7E%20%2Ehandsontable%20tbody%20tr%20th%2C%2Eht%5Fmaster%3Anot%28%2EinnerBorderLeft%29%20%7E%20%2Ehandsontable%3Anot%28%2Eht%5Fclone%5Ftop%29%20thead%20tr%20th%3Afirst%2Dchild%7Bborder%2Dright%2Dwidth%3A0%7D%2Eht%5Fmaster%3Anot%28%2EinnerBorderTop%29%20thead%20tr%3Alast%2Dchild%20th%2C%2Eht%5Fmaster%3Anot%28%2EinnerBorderTop%29%20%7E%20%2Ehandsontable%20thead%20tr%3Alast%2Dchild%20th%2C%2Eht%5Fmaster%3Anot%28%2EinnerBorderTop%29%20thead%20tr%2ElastChild%20th%2C%2Eht%5Fmaster%3Anot%28%2EinnerBorderTop%29%20%7E%20%2Ehandsontable%20thead%20tr%2ElastChild%20th%7Bborder%2Dbottom%2Dwidth%3A0%7D%2Ehandsontable%20th%7Bbackground%2Dcolor%3A%23EEE%3Bcolor%3A%23222%3Btext%2Dalign%3Acenter%3Bfont%2Dweight%3Anormal%3Bwhite%2Dspace%3Anowrap%7D%2Ehandsontable%20thead%20th%7Bpadding%3A0%7D%2Ehandsontable%20th%2Eactive%7Bbackground%2Dcolor%3A%23CCC%7D%2Ehandsontable%20thead%20th%20%2Erelative%7Bpadding%3A2px%204px%7D%2Ehandsontable%20%2EmanualColumnMover%7Bposition%3Afixed%3Bleft%3A0%3Btop%3A0%3Bbackground%2Dcolor%3Atransparent%3Bwidth%3A5px%3Bheight%3A25px%3Bz%2Dindex%3A999%3Bcursor%3Amove%7D%2Ehandsontable%20%2EmanualRowMover%7Bposition%3Afixed%3Bleft%3A%2D4px%3Btop%3A0%3Bbackground%2Dcolor%3Atransparent%3Bheight%3A5px%3Bwidth%3A50px%3Bz%2Dindex%3A999%3Bcursor%3Amove%7D%2Ehandsontable%20%2EmanualColumnMoverGuide%2C%2Ehandsontable%20%2EmanualRowMoverGuide%7Bposition%3Afixed%3Bleft%3A0%3Btop%3A0%3Bbackground%2Dcolor%3A%23CCC%3Bwidth%3A25px%3Bheight%3A25px%3Bopacity%3A%2E7%3Bdisplay%3Anone%7D%2Ehandsontable%20%2EmanualColumnMoverGuide%2Eactive%2C%2Ehandsontable%20%2EmanualRowMoverGuide%2Eactive%7Bdisplay%3Ablock%7D%2Ehandsontable%20%2EmanualColumnMover%3Ahover%2C%2Ehandsontable%20%2EmanualColumnMover%2Eactive%2C%2Ehandsontable%20%2EmanualRowMover%3Ahover%2C%2Ehandsontable%20%2EmanualRowMover%2Eactive%7Bbackground%2Dcolor%3A%2388F%7D%2Ehandsontable%20%2EmanualColumnResizer%7Bposition%3Afixed%3Btop%3A0%3Bcursor%3Acol%2Dresize%3Bz%2Dindex%3A110%3Bwidth%3A5px%3Bheight%3A25px%7D%2Ehandsontable%20%2EmanualRowResizer%7Bposition%3Afixed%3Bleft%3A0%3Bcursor%3Arow%2Dresize%3Bz%2Dindex%3A110%3Bheight%3A5px%3Bwidth%3A50px%7D%2Ehandsontable%20%2EmanualColumnResizer%3Ahover%2C%2Ehandsontable%20%2EmanualColumnResizer%2Eactive%2C%2Ehandsontable%20%2EmanualRowResizer%3Ahover%2C%2Ehandsontable%20%2EmanualRowResizer%2Eactive%7Bbackground%2Dcolor%3A%23AAB%7D%2Ehandsontable%20%2EmanualColumnResizerGuide%7Bposition%3Afixed%3Bright%3A0%3Btop%3A0%3Bbackground%2Dcolor%3A%23AAB%3Bdisplay%3Anone%3Bwidth%3A0%3Bborder%2Dright%3A1px%20dashed%20%23777%3Bmargin%2Dleft%3A5px%7D%2Ehandsontable%20%2EmanualRowResizerGuide%7Bposition%3Afixed%3Bleft%3A0%3Bbottom%3A0%3Bbackground%2Dcolor%3A%23AAB%3Bdisplay%3Anone%3Bheight%3A0%3Bborder%2Dbottom%3A1px%20dashed%20%23777%3Bmargin%2Dtop%3A5px%7D%2Ehandsontable%20%2EmanualColumnResizerGuide%2Eactive%2C%2Ehandsontable%20%2EmanualRowResizerGuide%2Eactive%7Bdisplay%3Ablock%7D%2Ehandsontable%20%2EcolumnSorting%7Bposition%3Arelative%7D%2Ehandsontable%20%2EcolumnSorting%3Ahover%7Btext%2Ddecoration%3Aunderline%3Bcursor%3Apointer%7D%2Ehandsontable%20%2EcolumnSorting%2Eascending%3A%3Aafter%7Bcontent%3A%27%5C25B2%27%3Bcolor%3A%235f5f5f%3Bposition%3Aabsolute%3Bright%3A%2D15px%7D%2Ehandsontable%20%2EcolumnSorting%2Edescending%3A%3Aafter%7Bcontent%3A%27%5C25BC%27%3Bcolor%3A%235f5f5f%3Bposition%3Aabsolute%3Bright%3A%2D15px%7D%2Ehandsontable%20th%2EbeforeHiddenColumn%7Bposition%3Arelative%7D%2Ehandsontable%20th%2EbeforeHiddenColumn%3A%3Aafter%2C%2Ehandsontable%20th%2EafterHiddenColumn%3A%3Abefore%7Bcontent%3A%27%5C25C0%27%3Bcolor%3A%23bbb%3Bposition%3Aabsolute%3Bright%3A1px%3Btop%3A2px%3Bfont%2Dsize%3A5pt%7D%2Ehandsontable%20th%2EafterHiddenColumn%7Bposition%3Arelative%7D%2Ehandsontable%20th%2EafterHiddenColumn%3A%3Abefore%7Bleft%3A1px%3Btop%3A2px%3Bright%3Aauto%3Bcontent%3A%27%5C25B6%27%7D%2Ehandsontable%20td%2EafterHiddenColumn%2EfirstVisible%7Bborder%2Dleft%3A1px%20solid%20%23CCC%7D%2Ehandsontable%20thead%20th%2EhiddenHeader%7Bdisplay%3Anone%7D%2Ehandsontable%20%2EwtBorder%7Bposition%3Aabsolute%3Bfont%2Dsize%3A0%7D%2Ehandsontable%20%2EwtBorder%2Ehidden%7Bdisplay%3Anone%21important%7D%2Ehandsontable%20td%2Earea%7Bbackground%3A%2Dmoz%2Dlinear%2Dgradient%28top%2Crgba%28181%2C209%2C255%2C0%2E34%29%200%2Crgba%28181%2C209%2C255%2C0%2E34%29%20100%25%29%3Bbackground%3A%2Dwebkit%2Dgradient%28linear%2Cleft%20top%2Cleft%20bottom%2Ccolor%2Dstop%280%25%2Crgba%28181%2C209%2C255%2C0%2E34%29%29%2Ccolor%2Dstop%28100%25%2Crgba%28181%2C209%2C255%2C0%2E34%29%29%29%3Bbackground%3A%2Dwebkit%2Dlinear%2Dgradient%28top%2Crgba%28181%2C209%2C255%2C0%2E34%29%200%2Crgba%28181%2C209%2C255%2C0%2E34%29%20100%25%29%3Bbackground%3A%2Do%2Dlinear%2Dgradient%28top%2Crgba%28181%2C209%2C255%2C0%2E34%29%200%2Crgba%28181%2C209%2C255%2C0%2E34%29%20100%25%29%3Bbackground%3A%2Dms%2Dlinear%2Dgradient%28top%2Crgba%28181%2C209%2C255%2C0%2E34%29%200%2Crgba%28181%2C209%2C255%2C0%2E34%29%20100%25%29%3Bbackground%3Alinear%2Dgradient%28to%20bottom%2Crgba%28181%2C209%2C255%2C0%2E34%29%200%2Crgba%28181%2C209%2C255%2C0%2E34%29%20100%25%29%3Bfilter%3Aprogid%3ADXImageTransform%2EMicrosoft%2Egradient%28startColorstr%3D%27%2357b5d1ff%27%2CendColorstr%3D%27%2357b5d1ff%27%2CGradientType%3D0%29%3Bbackground%2Dcolor%3A%23fff%7D%2Ehandsontable%20%2EwtBorder%2Ecorner%7Bfont%2Dsize%3A0%3Bcursor%3Acrosshair%7D%2Ehandsontable%20%2EhtBorder%2EhtFillBorder%7Bbackground%3Ared%3Bwidth%3A1px%3Bheight%3A1px%7D%2EhandsontableInput%7Bborder%3A0%3Boutline%2Dwidth%3A0%3Bmargin%3A0%3Bpadding%3A1px%205px%200%205px%3Bfont%2Dfamily%3Ainherit%3Bline%2Dheight%3A21px%3Bfont%2Dsize%3Ainherit%3Bbox%2Dshadow%3A0%200%200%202px%20%235292f7%20inset%3Bresize%3Anone%3Bdisplay%3Ainline%2Dblock%3Bcolor%3A%23000%3Bborder%2Dradius%3A0%3Bbackground%2Dcolor%3A%23FFF%7D%2EhandsontableInputHolder%7Bposition%3Aabsolute%3Btop%3A0%3Bleft%3A0%3Bz%2Dindex%3A100%7D%2EhtSelectEditor%7B%2Dwebkit%2Dappearance%3Amenulist%2Dbutton%21important%3Bposition%3Aabsolute%3Bwidth%3Aauto%7D%2Ehandsontable%20%2EhtDimmed%7Bcolor%3A%23777%7D%2Ehandsontable%20%2EhtSubmenu%7Bposition%3Arelative%7D%2Ehandsontable%20%2EhtSubmenu%20%3Aafter%7Bcontent%3A%27%E2%96%B6%27%3Bcolor%3A%23777%3Bposition%3Aabsolute%3Bright%3A5px%7D%2Ehandsontable%20%2EhtLeft%7Btext%2Dalign%3Aleft%7D%2Ehandsontable%20%2EhtCenter%7Btext%2Dalign%3Acenter%7D%2Ehandsontable%20%2EhtRight%7Btext%2Dalign%3Aright%7D%2Ehandsontable%20%2EhtJustify%7Btext%2Dalign%3Ajustify%7D%2Ehandsontable%20%2EhtTop%7Bvertical%2Dalign%3Atop%7D%2Ehandsontable%20%2EhtMiddle%7Bvertical%2Dalign%3Amiddle%7D%2Ehandsontable%20%2EhtBottom%7Bvertical%2Dalign%3Abottom%7D%2Ehandsontable%20%2EhtPlaceholder%7Bcolor%3A%23999%7D%2Ehandsontable%20%2EhtAutocompleteArrow%7Bfloat%3Aright%3Bfont%2Dsize%3A10px%3Bcolor%3A%23EEE%3Bcursor%3Adefault%3Bwidth%3A16px%3Btext%2Dalign%3Acenter%7D%2Ehandsontable%20td%20%2EhtAutocompleteArrow%3Ahover%7Bcolor%3A%23777%7D%2Ehandsontable%20td%2Earea%20%2EhtAutocompleteArrow%7Bcolor%3A%23d3d3d3%7D%2Ehandsontable%20%2EhtCheckboxRendererInput%2EnoValue%7Bopacity%3A%2E5%7D%2Ehandsontable%20%2EhtCheckboxRendererLabel%7Bcursor%3Apointer%3Bdisplay%3Ainline%2Dblock%3Bwidth%3A100%25%7D%2Ehandsontable%20%2EhtNumeric%7Btext%2Dalign%3Aright%7D%2EhtCommentCell%7Bposition%3Arelative%7D%2EhtCommentCell%3Aafter%7Bcontent%3A%27%27%3Bposition%3Aabsolute%3Btop%3A0%3Bright%3A0%3Bborder%2Dleft%3A6px%20solid%20transparent%3Bborder%2Dtop%3A6px%20solid%20red%7D%40%2Dwebkit%2Dkeyframes%20opacity%2Dhide%7Bfrom%7Bopacity%3A1%7Dto%7Bopacity%3A0%7D%7D%40keyframes%20opacity%2Dhide%7Bfrom%7Bopacity%3A1%7Dto%7Bopacity%3A0%7D%7D%40%2Dwebkit%2Dkeyframes%20opacity%2Dshow%7Bfrom%7Bopacity%3A0%7Dto%7Bopacity%3A1%7D%7D%40keyframes%20opacity%2Dshow%7Bfrom%7Bopacity%3A0%7Dto%7Bopacity%3A1%7D%7D%2Ehandsontable%20%2Ehandsontable%2Eht%5Fclone%5Ftop%20%2EwtHider%7Bpadding%3A0%200%205px%200%7D%2Ehandsontable%20%2EautocompleteEditor%2Ehandsontable%7Bpadding%2Dright%3A17px%7D%2Ehandsontable%20%2EautocompleteEditor%2Ehandsontable%2EhtMacScroll%7Bpadding%2Dright%3A15px%7D%2Ehandsontable%2Elistbox%7Bmargin%3A0%7D%2Ehandsontable%2Elistbox%20%2Eht%5Fmaster%20table%7Bborder%3A1px%20solid%20%23ccc%3Bborder%2Dcollapse%3Aseparate%3Bbackground%3Awhite%7D%2Ehandsontable%2Elistbox%20th%2C%2Ehandsontable%2Elistbox%20tr%3Afirst%2Dchild%20th%2C%2Ehandsontable%2Elistbox%20tr%3Alast%2Dchild%20th%2C%2Ehandsontable%2Elistbox%20tr%3Afirst%2Dchild%20td%2C%2Ehandsontable%2Elistbox%20td%7Bborder%2Dcolor%3Atransparent%7D%2Ehandsontable%2Elistbox%20th%2C%2Ehandsontable%2Elistbox%20td%7Bwhite%2Dspace%3Anowrap%3Btext%2Doverflow%3Aellipsis%7D%2Ehandsontable%2Elistbox%20td%2EhtDimmed%7Bcursor%3Adefault%3Bcolor%3Ainherit%3Bfont%2Dstyle%3Ainherit%7D%2Ehandsontable%2Elistbox%20%2EwtBorder%7Bvisibility%3Ahidden%7D%2Ehandsontable%2Elistbox%20tr%20td%2Ecurrent%2C%2Ehandsontable%2Elistbox%20tr%3Ahover%20td%7Bbackground%3A%23eee%7D%2Eht%5Fclone%5Ftop%7Bz%2Dindex%3A101%7D%2Eht%5Fclone%5Fleft%7Bz%2Dindex%3A102%7D%2Eht%5Fclone%5Ftop%5Fleft%5Fcorner%2C%2Eht%5Fclone%5Fbottom%5Fleft%5Fcorner%7Bz%2Dindex%3A103%7D%2Eht%5Fclone%5Fdebug%7Bz%2Dindex%3A103%7D%2Ehandsontable%20td%2EhtSearchResult%7Bbackground%3A%23fcedd9%3Bcolor%3A%23583707%7D%2EhtBordered%7Bborder%2Dwidth%3A1px%7D%2EhtBordered%2EhtTopBorderSolid%7Bborder%2Dtop%2Dstyle%3Asolid%3Bborder%2Dtop%2Dcolor%3A%23000%7D%2EhtBordered%2EhtRightBorderSolid%7Bborder%2Dright%2Dstyle%3Asolid%3Bborder%2Dright%2Dcolor%3A%23000%7D%2EhtBordered%2EhtBottomBorderSolid%7Bborder%2Dbottom%2Dstyle%3Asolid%3Bborder%2Dbottom%2Dcolor%3A%23000%7D%2EhtBordered%2EhtLeftBorderSolid%7Bborder%2Dleft%2Dstyle%3Asolid%3Bborder%2Dleft%2Dcolor%3A%23000%7D%2EhtCommentTextArea%7B%2Dmoz%2Dbox%2Dshadow%3A1px%201px%202px%20%23bbb%3B%2Dwebkit%2Dbox%2Dshadow%3A1px%201px%202px%20%23bbb%3Bbackground%2Dcolor%3A%23fffacd%3Bborder%3A1px%20solid%20%23999%3Bbox%2Dshadow%3A1px%201px%202px%20%23bbb%3Bfont%2Dfamily%3A%27Arial%27%7D%2Ehandsontable%20tbody%20tr%20th%3Anth%2Dlast%2Dchild%282%29%7Bborder%2Dright%3A1px%20solid%20%23CCC%7D%2Ehandsontable%20thead%20tr%3Anth%2Dlast%2Dchild%282%29%20th%2EhtGroupIndicatorContainer%7Bborder%2Dbottom%3A1px%20solid%20%23CCC%3Bpadding%2Dbottom%3A5px%7D%2Eht%5Fclone%5Ftop%5Fleft%5Fcorner%20thead%20tr%20th%3Anth%2Dlast%2Dchild%282%29%7Bborder%2Dright%3A1px%20solid%20%23CCC%7D%2EhtCollapseButton%7Bwidth%3A10px%3Bheight%3A10px%3Bline%2Dheight%3A10px%3Btext%2Dalign%3Acenter%3Bborder%2Dradius%3A5px%3Bborder%3A1px%20solid%20%23f3f3f3%3B%2Dwebkit%2Dbox%2Dshadow%3A1px%201px%203px%20rgba%280%2C0%2C0%2C0%2E4%29%3Bbox%2Dshadow%3A1px%201px%203px%20rgba%280%2C0%2C0%2C0%2E4%29%3Bcursor%3Apointer%3Bmargin%2Dbottom%3A3px%3Bposition%3Arelative%7D%2EhtCollapseButton%3Aafter%7Bcontent%3A%22%22%3Bheight%3A300%25%3Bwidth%3A1px%3Bdisplay%3Ablock%3Bbackground%3A%23ccc%3Bmargin%2Dleft%3A4px%3Bposition%3Aabsolute%3Bbottom%3A10px%7Dthead%20%2EhtCollapseButton%7Bright%3A5px%3Bposition%3Aabsolute%3Btop%3A5px%3Bbackground%3A%23fff%7Dthead%20%2EhtCollapseButton%3Aafter%7Bheight%3A1px%3Bwidth%3A700%25%3Bright%3A10px%3Btop%3A4px%7D%2Ehandsontable%20tr%20th%20%2EhtExpandButton%7Bposition%3Aabsolute%3Bwidth%3A10px%3Bheight%3A10px%3Bline%2Dheight%3A10px%3Btext%2Dalign%3Acenter%3Bborder%2Dradius%3A5px%3Bborder%3A1px%20solid%20%23f3f3f3%3B%2Dwebkit%2Dbox%2Dshadow%3A1px%201px%203px%20rgba%280%2C0%2C0%2C0%2E4%29%3Bbox%2Dshadow%3A1px%201px%203px%20rgba%280%2C0%2C0%2C0%2E4%29%3Bcursor%3Apointer%3Btop%3A0%3Bdisplay%3Anone%7D%2Ehandsontable%20thead%20tr%20th%20%2EhtExpandButton%7Btop%3A5px%7D%2Ehandsontable%20tr%20th%20%2EhtExpandButton%2Eclickable%7Bdisplay%3Ablock%7D%2EcollapsibleIndicator%7Bposition%3Aabsolute%3Btop%3A50%25%3Btransform%3Atranslate%280%25%2C%2D50%25%29%3Bright%3A5px%3Bborder%3A1px%20solid%20%23a6a6a6%3Bline%2Dheight%3A10px%3Bcolor%3A%23222%3Bborder%2Dradius%3A10px%3Bfont%2Dsize%3A10px%3Bwidth%3A10px%3Bheight%3A10px%3Bcursor%3Apointer%3B%2Dwebkit%2Dbox%2Dshadow%3A0%200%200%206px%20rgba%28238%2C238%2C238%2C1%29%3B%2Dmoz%2Dbox%2Dshadow%3A0%200%200%206px%20rgba%28238%2C238%2C238%2C1%29%3Bbox%2Dshadow%3A0%200%200%206px%20rgba%28238%2C238%2C238%2C1%29%3Bbackground%3A%23eee%7D%2Ehandsontable%20col%2Ehidden%7Bwidth%3A0%21important%7D%2Ehandsontable%20table%20tr%20th%2ElightRightBorder%7Bborder%2Dright%3A1px%20solid%20%23e6e6e6%7D%2Ehandsontable%20tr%2Ehidden%2C%2Ehandsontable%20tr%2Ehidden%20td%2C%2Ehandsontable%20tr%2Ehidden%20th%7Bdisplay%3Anone%7D%2Eht%5Fmaster%2C%2Eht%5Fclone%5Fleft%2C%2Eht%5Fclone%5Ftop%2C%2Eht%5Fclone%5Fbottom%7Boverflow%3Ahidden%7D%2Eht%5Fmaster%20%2EwtHolder%7Boverflow%3Aauto%7D%2Eht%5Fclone%5Fleft%20%2EwtHolder%7Boverflow%2Dx%3Ahidden%3Boverflow%2Dy%3Aauto%7D%2Eht%5Fclone%5Ftop%20%2EwtHolder%2C%2Eht%5Fclone%5Fbottom%20%2EwtHolder%7Boverflow%2Dx%3Aauto%3Boverflow%2Dy%3Ahidden%7D%2EwtDebugHidden%7Bdisplay%3Anone%7D%2EwtDebugVisible%7Bdisplay%3Ablock%3B%2Dwebkit%2Danimation%2Dduration%3A%2E5s%3B%2Dwebkit%2Danimation%2Dname%3AwtFadeInFromNone%3Banimation%2Dduration%3A%2E5s%3Banimation%2Dname%3AwtFadeInFromNone%7D%40keyframes%20wtFadeInFromNone%7B0%25%7Bdisplay%3Anone%3Bopacity%3A0%7D1%25%7Bdisplay%3Ablock%3Bopacity%3A0%7D100%25%7Bdisplay%3Ablock%3Bopacity%3A1%7D%7D%40%2Dwebkit%2Dkeyframes%20wtFadeInFromNone%7B0%25%7Bdisplay%3Anone%3Bopacity%3A0%7D1%25%7Bdisplay%3Ablock%3Bopacity%3A0%7D100%25%7Bdisplay%3Ablock%3Bopacity%3A1%7D%7D%2Ehandsontable%2Emobile%2C%2Ehandsontable%2Emobile%20%2EwtHolder%7B%2Dwebkit%2Dtouch%2Dcallout%3Anone%3B%2Dwebkit%2Duser%2Dselect%3Anone%3B%2Dkhtml%2Duser%2Dselect%3Anone%3B%2Dmoz%2Duser%2Dselect%3Anone%3B%2Dms%2Duser%2Dselect%3Anone%3Buser%2Dselect%3Anone%3B%2Dwebkit%2Dtap%2Dhighlight%2Dcolor%3Argba%280%2C0%2C0%2C0%29%3B%2Dwebkit%2Doverflow%2Dscrolling%3Atouch%7D%2EhtMobileEditorContainer%7Bdisplay%3Anone%3Bposition%3Aabsolute%3Btop%3A0%3Bwidth%3A70%25%3Bheight%3A54pt%3Bbackground%3A%23f8f8f8%3Bborder%2Dradius%3A20px%3Bborder%3A1px%20solid%20%23ebebeb%3Bz%2Dindex%3A999%3Bbox%2Dsizing%3Aborder%2Dbox%3B%2Dwebkit%2Dbox%2Dsizing%3Aborder%2Dbox%3B%2Dwebkit%2Dtext%2Dsize%2Dadjust%3Anone%7D%2EtopLeftSelectionHandle%3Anot%28%2Eht%5Fmaster%20%2EtopLeftSelectionHandle%29%2C%2EtopLeftSelectionHandle%2DHitArea%3Anot%28%2Eht%5Fmaster%20%2EtopLeftSelectionHandle%2DHitArea%29%7Bz%2Dindex%3A9999%7D%2EtopLeftSelectionHandle%2C%2EtopLeftSelectionHandle%2DHitArea%2C%2EbottomRightSelectionHandle%2C%2EbottomRightSelectionHandle%2DHitArea%7Bleft%3A%2D10000px%3Btop%3A%2D10000px%7D%2EhtMobileEditorContainer%2Eactive%7Bdisplay%3Ablock%7D%2EhtMobileEditorContainer%20%2Einputs%7Bposition%3Aabsolute%3Bright%3A210pt%3Bbottom%3A10pt%3Btop%3A10pt%3Bleft%3A14px%3Bheight%3A34pt%7D%2EhtMobileEditorContainer%20%2Einputs%20textarea%7Bfont%2Dsize%3A13pt%3Bborder%3A1px%20solid%20%23a1a1a1%3B%2Dwebkit%2Dappearance%3Anone%3B%2Dwebkit%2Dbox%2Dshadow%3Anone%3B%2Dmoz%2Dbox%2Dshadow%3Anone%3Bbox%2Dshadow%3Anone%3Bposition%3Aabsolute%3Bleft%3A14px%3Bright%3A14px%3Btop%3A0%3Bbottom%3A0%3Bpadding%3A7pt%7D%2EhtMobileEditorContainer%20%2EcellPointer%7Bposition%3Aabsolute%3Btop%3A%2D13pt%3Bheight%3A0%3Bwidth%3A0%3Bleft%3A30px%3Bborder%2Dleft%3A13pt%20solid%20transparent%3Bborder%2Dright%3A13pt%20solid%20transparent%3Bborder%2Dbottom%3A13pt%20solid%20%23ebebeb%7D%2EhtMobileEditorContainer%20%2EcellPointer%2Ehidden%7Bdisplay%3Anone%7D%2EhtMobileEditorContainer%20%2EcellPointer%3Abefore%7Bcontent%3A%27%27%3Bdisplay%3Ablock%3Bposition%3Aabsolute%3Btop%3A2px%3Bheight%3A0%3Bwidth%3A0%3Bleft%3A%2D13pt%3Bborder%2Dleft%3A13pt%20solid%20transparent%3Bborder%2Dright%3A13pt%20solid%20transparent%3Bborder%2Dbottom%3A13pt%20solid%20%23f8f8f8%7D%2EhtMobileEditorContainer%20%2EmoveHandle%7Bposition%3Aabsolute%3Btop%3A10pt%3Bleft%3A5px%3Bwidth%3A30px%3Bbottom%3A0%3Bcursor%3Amove%3Bz%2Dindex%3A9999%7D%2EhtMobileEditorContainer%20%2EmoveHandle%3Aafter%7Bcontent%3A%22%2E%2E%5Ca%2E%2E%5Ca%2E%2E%5Ca%2E%2E%22%3Bwhite%2Dspace%3Apre%3Bline%2Dheight%3A10px%3Bfont%2Dsize%3A20pt%3Bdisplay%3Ainline%2Dblock%3Bmargin%2Dtop%3A%2D8px%3Bcolor%3A%23ebebeb%7D%2EhtMobileEditorContainer%20%2EpositionControls%7Bwidth%3A205pt%3Bposition%3Aabsolute%3Bright%3A5pt%3Btop%3A0%3Bbottom%3A0%7D%2EhtMobileEditorContainer%20%2EpositionControls%3Ediv%7Bwidth%3A50pt%3Bheight%3A100%25%3Bfloat%3Aleft%7D%2EhtMobileEditorContainer%20%2EpositionControls%3Ediv%3Aafter%7Bcontent%3A%22%20%22%3Bdisplay%3Ablock%3Bwidth%3A15pt%3Bheight%3A15pt%3Btext%2Dalign%3Acenter%3Bline%2Dheight%3A50pt%7D%2EhtMobileEditorContainer%20%2EleftButton%3Aafter%2C%2EhtMobileEditorContainer%20%2ErightButton%3Aafter%2C%2EhtMobileEditorContainer%20%2EupButton%3Aafter%2C%2EhtMobileEditorContainer%20%2EdownButton%3Aafter%7Btransform%2Dorigin%3A5pt%205pt%3B%2Dwebkit%2Dtransform%2Dorigin%3A5pt%205pt%3Bmargin%3A21pt%200%200%2021pt%7D%2EhtMobileEditorContainer%20%2EleftButton%3Aafter%7Bborder%2Dtop%3A2px%20solid%20%23288ffe%3Bborder%2Dleft%3A2px%20solid%20%23288ffe%3B%2Dwebkit%2Dtransform%3Arotate%28%2D45deg%29%7D%2EhtMobileEditorContainer%20%2EleftButton%3Aactive%3Aafter%7Bborder%2Dcolor%3A%23cfcfcf%7D%2EhtMobileEditorContainer%20%2ErightButton%3Aafter%7Bborder%2Dtop%3A2px%20solid%20%23288ffe%3Bborder%2Dleft%3A2px%20solid%20%23288ffe%3B%2Dwebkit%2Dtransform%3Arotate%28135deg%29%7D%2EhtMobileEditorContainer%20%2ErightButton%3Aactive%3Aafter%7Bborder%2Dcolor%3A%23cfcfcf%7D%2EhtMobileEditorContainer%20%2EupButton%3Aafter%7Bborder%2Dtop%3A2px%20solid%20%23288ffe%3Bborder%2Dleft%3A2px%20solid%20%23288ffe%3B%2Dwebkit%2Dtransform%3Arotate%2845deg%29%7D%2EhtMobileEditorContainer%20%2EupButton%3Aactive%3Aafter%7Bborder%2Dcolor%3A%23cfcfcf%7D%2EhtMobileEditorContainer%20%2EdownButton%3Aafter%7Bborder%2Dtop%3A2px%20solid%20%23288ffe%3Bborder%2Dleft%3A2px%20solid%20%23288ffe%3B%2Dwebkit%2Dtransform%3Arotate%28225deg%29%7D%2EhtMobileEditorContainer%20%2EdownButton%3Aactive%3Aafter%7Bborder%2Dcolor%3A%23cfcfcf%7D%2Ehandsontable%2Ehide%2Dtween%7B%2Dwebkit%2Danimation%3Aopacity%2Dhide%20%2E3s%3Banimation%3Aopacity%2Dhide%20%2E3s%3Banimation%2Dfill%2Dmode%3Aforwards%3B%2Dwebkit%2Danimation%2Dfill%2Dmode%3Aforwards%7D%2Ehandsontable%2Eshow%2Dtween%7B%2Dwebkit%2Danimation%3Aopacity%2Dshow%20%2E3s%3Banimation%3Aopacity%2Dshow%20%2E3s%3Banimation%2Dfill%2Dmode%3Aforwards%3B%2Dwebkit%2Danimation%2Dfill%2Dmode%3Aforwards%7D%2EhtContextMenu%7Bdisplay%3Anone%3Bposition%3Aabsolute%3Bz%2Dindex%3A1060%7D%2EhtContextMenu%20%2Eht%5Fclone%5Ftop%2C%2EhtContextMenu%20%2Eht%5Fclone%5Fleft%2C%2EhtContextMenu%20%2Eht%5Fclone%5Fcorner%2C%2EhtContextMenu%20%2Eht%5Fclone%5Fdebug%7Bdisplay%3Anone%7D%2EhtContextMenu%20table%2EhtCore%7Bborder%3A1px%20solid%20%23bbb%3Bborder%2Dbottom%2Dwidth%3A2px%3Bborder%2Dright%2Dwidth%3A2px%7D%2EhtContextMenu%20%2EwtBorder%7Bvisibility%3Ahidden%7D%2EhtContextMenu%20table%20tbody%20tr%20td%7Bbackground%3Awhite%3Bborder%2Dwidth%3A0%3Bpadding%3A4px%206px%200%206px%3Bcursor%3Apointer%3Boverflow%3Ahidden%3Bwhite%2Dspace%3Anowrap%3Btext%2Doverflow%3Aellipsis%7D%2EhtContextMenu%20table%20tbody%20tr%20td%3Afirst%2Dchild%7Bborder%3A0%7D%2EhtContextMenu%20table%20tbody%20tr%20td%2EhtDimmed%7Bfont%2Dstyle%3Anormal%3Bcolor%3A%23323232%7D%2EhtContextMenu%20table%20tbody%20tr%20td%2Ecurrent%2C%2EhtContextMenu%20table%20tbody%20tr%20td%2Ezeroclipboard%2Dis%2Dhover%7Bbackground%3A%23e9e9e9%7D%2EhtContextMenu%20table%20tbody%20tr%20td%2EhtSeparator%7Bborder%2Dtop%3A1px%20solid%20%23bbb%3Bheight%3A0%3Bpadding%3A0%7D%2EhtContextMenu%20table%20tbody%20tr%20td%2EhtDisabled%7Bcolor%3A%23999%7D%2EhtContextMenu%20table%20tbody%20tr%20td%2EhtDisabled%3Ahover%7Bbackground%3A%23fff%3Bcolor%3A%23999%3Bcursor%3Adefault%7D%2EhtContextMenu%20table%20tbody%20tr%2EhtHidden%7Bdisplay%3Anone%7D%2EhtContextMenu%20table%20tbody%20tr%20td%20%2EhtItemWrapper%7Bmargin%2Dleft%3A10px%3Bmargin%2Dright%3A6px%7D%2EhtContextMenu%20table%20tbody%20tr%20td%20div%20span%2Eselected%7Bmargin%2Dtop%3A%2D2px%3Bposition%3Aabsolute%3Bleft%3A4px%7D%2EhtContextMenu%20%2Eht%5Fmaster%20%2EwtHolder%7Boverflow%3Ahidden%7D%2Epika%2Dsingle%7Bz%2Dindex%3A9999%3Bdisplay%3Ablock%3Bposition%3Arelative%3Bcolor%3A%23333%3Bbackground%3A%23fff%3Bborder%3A1px%20solid%20%23ccc%3Bborder%2Dbottom%2Dcolor%3A%23bbb%3Bfont%2Dfamily%3A%22Helvetica%20Neue%22%2CHelvetica%2CArial%2Csans%2Dserif%7D%2Epika%2Dsingle%3Abefore%2C%2Epika%2Dsingle%3Aafter%7Bcontent%3A%22%20%22%3Bdisplay%3Atable%7D%2Epika%2Dsingle%3Aafter%7Bclear%3Aboth%7D%2Epika%2Dsingle%7B%2Azoom%3A1%7D%2Epika%2Dsingle%2Eis%2Dhidden%7Bdisplay%3Anone%7D%2Epika%2Dsingle%2Eis%2Dbound%7Bposition%3Aabsolute%3Bbox%2Dshadow%3A0%205px%2015px%20%2D5px%20rgba%280%2C0%2C0%2C%2E5%29%7D%2Epika%2Dlendar%7Bfloat%3Aleft%3Bwidth%3A240px%3Bmargin%3A8px%7D%2Epika%2Dtitle%7Bposition%3Arelative%3Btext%2Dalign%3Acenter%7D%2Epika%2Dlabel%7Bdisplay%3Ainline%2Dblock%3B%2Adisplay%3Ainline%3Bposition%3Arelative%3Bz%2Dindex%3A9999%3Boverflow%3Ahidden%3Bmargin%3A0%3Bpadding%3A5px%203px%3Bfont%2Dsize%3A14px%3Bline%2Dheight%3A20px%3Bfont%2Dweight%3Abold%3Bbackground%2Dcolor%3A%23fff%7D%2Epika%2Dtitle%20select%7Bcursor%3Apointer%3Bposition%3Aabsolute%3Bz%2Dindex%3A9998%3Bmargin%3A0%3Bleft%3A0%3Btop%3A5px%3Bfilter%3Aalpha%28opacity%3D0%29%3Bopacity%3A0%7D%2Epika%2Dprev%2C%2Epika%2Dnext%7Bdisplay%3Ablock%3Bcursor%3Apointer%3Bposition%3Arelative%3Boutline%3A0%3Bborder%3A0%3Bpadding%3A0%3Bwidth%3A20px%3Bheight%3A30px%3Btext%2Dindent%3A20px%3Bwhite%2Dspace%3Anowrap%3Boverflow%3Ahidden%3Bbackground%2Dcolor%3Atransparent%3Bbackground%2Dposition%3Acenter%20center%3Bbackground%2Drepeat%3Ano%2Drepeat%3Bbackground%2Dsize%3A75%25%2075%25%3Bopacity%3A%2E5%3B%2Aposition%3Aabsolute%3B%2Atop%3A0%7D%2Epika%2Dprev%3Ahover%2C%2Epika%2Dnext%3Ahover%7Bopacity%3A1%7D%2Epika%2Dprev%2C%2Eis%2Drtl%20%2Epika%2Dnext%7Bfloat%3Aleft%3Bbackground%2Dimage%3Aurl%28%27data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAUklEQVR42u3VMQoAIBADQf8Pgj%2BOD9hG2CtONJB2ymQkKe0HbwAP0xucDiQWARITIDEBEnMgMQ8S8%2BAqBIl6kKgHiXqQqAeJepBo%2Fz38J%2FU0uAHlaBkBl9I4GwAAAABJRU5ErkJggg%3D%3D%27%29%3B%2Aleft%3A0%7D%2Epika%2Dnext%2C%2Eis%2Drtl%20%2Epika%2Dprev%7Bfloat%3Aright%3Bbackground%2Dimage%3Aurl%28%27data%3Aimage%2Fpng%3Bbase64%2CiVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAYAAAAsEj5rAAAAU0lEQVR42u3VOwoAMAgE0dwfAnNjU26bYkBCFGwfiL9VVWoO%2BBJ4Gf3gtsEKKoFBNTCoCAYVwaAiGNQGMUHMkjGbgjk2mIONuXo0nC8XnCf1JXgArVIZAQh5TKYAAAAASUVORK5CYII%3D%27%29%3B%2Aright%3A0%7D%2Epika%2Dprev%2Eis%2Ddisabled%2C%2Epika%2Dnext%2Eis%2Ddisabled%7Bcursor%3Adefault%3Bopacity%3A%2E2%7D%2Epika%2Dselect%7Bdisplay%3Ainline%2Dblock%3B%2Adisplay%3Ainline%7D%2Epika%2Dtable%7Bwidth%3A100%25%3Bborder%2Dcollapse%3Acollapse%3Bborder%2Dspacing%3A0%3Bborder%3A0%7D%2Epika%2Dtable%20th%2C%2Epika%2Dtable%20td%7Bwidth%3A14%2E285714285714286%25%3Bpadding%3A0%7D%2Epika%2Dtable%20th%7Bcolor%3A%23999%3Bfont%2Dsize%3A12px%3Bline%2Dheight%3A25px%3Bfont%2Dweight%3Abold%3Btext%2Dalign%3Acenter%7D%2Epika%2Dbutton%7Bcursor%3Apointer%3Bdisplay%3Ablock%3Bbox%2Dsizing%3Aborder%2Dbox%3B%2Dmoz%2Dbox%2Dsizing%3Aborder%2Dbox%3Boutline%3A0%3Bborder%3A0%3Bmargin%3A0%3Bwidth%3A100%25%3Bpadding%3A5px%3Bcolor%3A%23666%3Bfont%2Dsize%3A12px%3Bline%2Dheight%3A15px%3Btext%2Dalign%3Aright%3Bbackground%3A%23f5f5f5%7D%2Epika%2Dweek%7Bfont%2Dsize%3A11px%3Bcolor%3A%23999%7D%2Eis%2Dtoday%20%2Epika%2Dbutton%7Bcolor%3A%233af%3Bfont%2Dweight%3Abold%7D%2Eis%2Dselected%20%2Epika%2Dbutton%7Bcolor%3A%23fff%3Bfont%2Dweight%3Abold%3Bbackground%3A%233af%3Bbox%2Dshadow%3Ainset%200%201px%203px%20%23178fe5%3Bborder%2Dradius%3A3px%7D%2Eis%2Dinrange%20%2Epika%2Dbutton%7Bbackground%3A%23d5e9f7%7D%2Eis%2Dstartrange%20%2Epika%2Dbutton%7Bcolor%3A%23fff%3Bbackground%3A%236cb31d%3Bbox%2Dshadow%3Anone%3Bborder%2Dradius%3A3px%7D%2Eis%2Dendrange%20%2Epika%2Dbutton%7Bcolor%3A%23fff%3Bbackground%3A%233af%3Bbox%2Dshadow%3Anone%3Bborder%2Dradius%3A3px%7D%2Eis%2Ddisabled%20%2Epika%2Dbutton%7Bpointer%2Devents%3Anone%3Bcursor%3Adefault%3Bcolor%3A%23999%3Bopacity%3A%2E3%7D%2Epika%2Dbutton%3Ahover%7Bcolor%3A%23fff%3Bbackground%3A%23ff8000%3Bbox%2Dshadow%3Anone%3Bborder%2Dradius%3A3px%7D%2Epika%2Dtable%20abbr%7Bborder%2Dbottom%3A0%3Bcursor%3Ahelp%7D" rel="stylesheet" />
<script src="data:application/x-javascript;base64,LyohCihUaGUgTUlUIExpY2Vuc2UpCgpDb3B5cmlnaHQgKGMpIDIwMTItMjAxNCBNYXJjaW4gV2FycGVjaG93c2tpCkNvcHlyaWdodCAoYykgMjAxNSBIYW5kc29uY29kZSBzcC4geiBvLm8uIDxoZWxsb0BoYW5kc29uY29kZS5uZXQ+CgpQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcKYSBjb3B5IG9mIHRoaXMgc29mdHdhcmUgYW5kIGFzc29jaWF0ZWQgZG9jdW1lbnRhdGlvbiBmaWxlcyAodGhlCidTb2Z0d2FyZScpLCB0byBkZWFsIGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcKd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHMgdG8gdXNlLCBjb3B5LCBtb2RpZnksIG1lcmdlLCBwdWJsaXNoLApkaXN0cmlidXRlLCBzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YgdGhlIFNvZnR3YXJlLCBhbmQgdG8KcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUgaXMgZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvCnRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczoKClRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlCmluY2x1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMgb2YgdGhlIFNvZnR3YXJlLgoKVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEICdBUyBJUycsIFdJVEhPVVQgV0FSUkFOVFkgT0YgQU5ZIEtJTkQsCkVYUFJFU1MgT1IgSU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRgpNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFORCBOT05JTkZSSU5HRU1FTlQuCklOIE5PIEVWRU5UIFNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQUJMRSBGT1IgQU5ZCkNMQUlNLCBEQU1BR0VTIE9SIE9USEVSIExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsClRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sIE9VVCBPRiBPUiBJTiBDT05ORUNUSU9OIFdJVEggVEhFClNPRlRXQVJFIE9SIFRIRSBVU0UgT1IgT1RIRVIgREVBTElOR1MgSU4gVEhFIFNPRlRXQVJFLgoKKi8KIWZ1bmN0aW9uKGUpe2lmKCJvYmplY3QiPT10eXBlb2YgZXhwb3J0cyYmInVuZGVmaW5lZCIhPXR5cGVvZiBtb2R1bGUpbW9kdWxlLmV4cG9ydHM9ZSgpO2Vsc2UgaWYoImZ1bmN0aW9uIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZClkZWZpbmUoW10sZSk7ZWxzZXt2YXIgdDt0PSJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6dGhpcyx0LkhhbmRzb250YWJsZT1lKCl9fShmdW5jdGlvbigpe3ZhciBlO3JldHVybiBmdW5jdGlvbihlLHQsbil7cmV0dXJuIGZ1bmN0aW9uIG8oZSx0LG4pe2Z1bmN0aW9uIHIoYSxsKXtpZighdFthXSl7aWYoIWVbYV0pe3ZhciB1PSJmdW5jdGlvbiI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFsJiZ1KXJldHVybiB1KGEsITApO2lmKGkpcmV0dXJuIGkoYSwhMCk7aWYoc1thXSYmInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3dbc1thXV0pcmV0dXJuIHdpbmRvd1tzW2FdXTt2YXIgYz1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIithKyInIik7dGhyb3cgYy5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixjfXZhciBkPXRbYV09e2V4cG9ydHM6e319O2VbYV1bMF0uY2FsbChkLmV4cG9ydHMsZnVuY3Rpb24odCl7dmFyIG49ZVthXVsxXVt0XTtyZXR1cm4gcihuP246dCl9LGQsZC5leHBvcnRzLG8sZSx0LG4pfXJldHVybiB0W2FdLmV4cG9ydHN9Zm9yKHZhciBpPSJmdW5jdGlvbiI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLHM9SlNPTi5wYXJzZSgneyJ6ZXJvY2xpcGJvYXJkIjoiWmVyb0NsaXBib2FyZCIsIm1vbWVudCI6Im1vbWVudCIsInBpa2FkYXkiOiJQaWthZGF5In0nKXx8e30sYT0wO2E8bi5sZW5ndGg7YSsrKXIoblthXSk7cmV0dXJuIHJ9KGUsdCxuKSxmdW5jdGlvbigpe3JldHVybiBIYW5kc29udGFibGV9fSh7MTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0Ijt3aW5kb3cualF1ZXJ5JiYhZnVuY3Rpb24oZSx0LG4pe3QuZm4uaGFuZHNvbnRhYmxlPWZ1bmN0aW9uKGUpe3ZhciB0LG8scixpLHMsYT10aGlzLmZpcnN0KCksbD1hLmRhdGEoImhhbmRzb250YWJsZSIpO2lmKCJzdHJpbmciIT10eXBlb2YgZSlyZXR1cm4gcz1lfHx7fSxsP2wudXBkYXRlU2V0dGluZ3Mocyk6KGw9bmV3IG4uQ29yZShhWzBdLHMpLGEuZGF0YSgiaGFuZHNvbnRhYmxlIixsKSxsLmluaXQoKSksYTtpZihyPVtdLGFyZ3VtZW50cy5sZW5ndGg+MSlmb3IodD0xLG89YXJndW1lbnRzLmxlbmd0aDtvPnQ7dCsrKXIucHVzaChhcmd1bWVudHNbdF0pO2lmKGwpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgbFtlXSl0aHJvdyBuZXcgRXJyb3IoIkhhbmRzb250YWJsZSBkbyBub3QgcHJvdmlkZSBhY3Rpb246ICIrZSk7aT1sW2VdLmFwcGx5KGwsciksImRlc3Ryb3kiPT09ZSYmYS5yZW1vdmVEYXRhKCl9cmV0dXJuIGl9fSh3aW5kb3csalF1ZXJ5LEhhbmRzb250YWJsZSl9LHt9XSwyOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlQm9yZGVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYn19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbD0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSx1PWwuZ2V0Q29tcHV0ZWRTdHlsZSxjPWwuZ2V0VHJpbW1pbmdDb250YWluZXIsZD1sLmlubmVyV2lkdGgsaD1sLmlubmVySGVpZ2h0LGY9bC5vZmZzZXQscD1sLm91dGVySGVpZ2h0LGc9bC5vdXRlcldpZHRoLG09KHI9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbix2PShpPWUoImV2ZW50TWFuYWdlciIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuRXZlbnRNYW5hZ2VyLHc9KHM9ZSgiY2VsbC9jb29yZHMiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLldhbGtvbnRhYmxlQ2VsbENvb3Jkcyx5PShhPWUoIm92ZXJsYXkvX2Jhc2UuanMiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLldhbGtvbnRhYmxlT3ZlcmxheSxiPWZ1bmN0aW9uKGUsdCl7dCYmKHRoaXMuZXZlbnRNYW5hZ2VyPW5ldyB2KGUpLHRoaXMuaW5zdGFuY2U9ZSx0aGlzLndvdD1lLHRoaXMuc2V0dGluZ3M9dCx0aGlzLm1vdXNlRG93bj0hMSx0aGlzLm1haW49bnVsbCx0aGlzLnRvcD1udWxsLHRoaXMubGVmdD1udWxsLHRoaXMuYm90dG9tPW51bGwsdGhpcy5yaWdodD1udWxsLHRoaXMudG9wU3R5bGU9bnVsbCx0aGlzLmxlZnRTdHlsZT1udWxsLHRoaXMuYm90dG9tU3R5bGU9bnVsbCx0aGlzLnJpZ2h0U3R5bGU9bnVsbCx0aGlzLmNvcm5lckRlZmF1bHRTdHlsZT17d2lkdGg6IjVweCIsaGVpZ2h0OiI1cHgiLGJvcmRlcldpZHRoOiIycHgiLGJvcmRlclN0eWxlOiJzb2xpZCIsYm9yZGVyQ29sb3I6IiNGRkYifSx0aGlzLmNvcm5lcj1udWxsLHRoaXMuY29ybmVyU3R5bGU9bnVsbCx0aGlzLmNyZWF0ZUJvcmRlcnModCksdGhpcy5yZWdpc3Rlckxpc3RlbmVycygpKX07JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGIse3JlZ2lzdGVyTGlzdGVuZXJzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LmJvZHksIm1vdXNlZG93biIsZnVuY3Rpb24oKXtyZXR1cm4gZS5vbk1vdXNlRG93bigpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5ib2R5LCJtb3VzZXVwIixmdW5jdGlvbigpe3JldHVybiBlLm9uTW91c2VVcCgpfSk7Zm9yKHZhciB0PXRoaXMsbj1mdW5jdGlvbihuLG8pe3QuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodC5tYWluLmNoaWxkTm9kZXNbbl0sIm1vdXNlZW50ZXIiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uTW91c2VFbnRlcih0LGUubWFpbi5jaGlsZE5vZGVzW25dKX0pfSxvPTAscj10aGlzLm1haW4uY2hpbGROb2Rlcy5sZW5ndGg7cj5vO28rKyluKG8scil9LG9uTW91c2VEb3duOmZ1bmN0aW9uKCl7dGhpcy5tb3VzZURvd249ITB9LG9uTW91c2VVcDpmdW5jdGlvbigpe3RoaXMubW91c2VEb3duPSExfSxvbk1vdXNlRW50ZXI6ZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBuKGUpe3JldHVybiBlLmNsaWVudFk8TWF0aC5mbG9vcihpLnRvcCk/ITA6ZS5jbGllbnRZPk1hdGguY2VpbChpLnRvcCtpLmhlaWdodCk/ITA6ZS5jbGllbnRYPE1hdGguZmxvb3IoaS5sZWZ0KT8hMDplLmNsaWVudFg+TWF0aC5jZWlsKGkubGVmdCtpLndpZHRoKT8hMDp2b2lkIDB9ZnVuY3Rpb24gbyhlKXtuKGUpJiYoci5ldmVudE1hbmFnZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5ib2R5LCJtb3VzZW1vdmUiLG8pLHQuc3R5bGUuZGlzcGxheT0iYmxvY2siKX1pZih0aGlzLm1vdXNlRG93biYmdGhpcy53b3QuZ2V0U2V0dGluZygiaGlkZUJvcmRlck9uTW91c2VEb3duT3ZlciIpKXtlLnByZXZlbnREZWZhdWx0KCksbShlKTt2YXIgcj10aGlzLGk9dC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTt0LnN0eWxlLmRpc3BsYXk9Im5vbmUiLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQuYm9keSwibW91c2Vtb3ZlIixvKX19LGNyZWF0ZUJvcmRlcnM6ZnVuY3Rpb24oZSl7dGhpcy5tYWluPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3ZhciB0PVsidG9wIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0IiwiY29ybmVyIl0sbj10aGlzLm1haW4uc3R5bGU7bi5wb3NpdGlvbj0iYWJzb2x1dGUiLG4udG9wPTAsbi5sZWZ0PTA7Zm9yKHZhciBvPTA7NT5vO28rKyl7dmFyIHI9dFtvXSxpPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO2kuY2xhc3NOYW1lPSJ3dEJvcmRlciAiKyh0aGlzLnNldHRpbmdzLmNsYXNzTmFtZXx8IiIpLHRoaXMuc2V0dGluZ3Nbcl0mJnRoaXMuc2V0dGluZ3Nbcl0uaGlkZSYmKGkuY2xhc3NOYW1lKz0iIGhpZGRlbiIpLG49aS5zdHlsZSxuLmJhY2tncm91bmRDb2xvcj10aGlzLnNldHRpbmdzW3JdJiZ0aGlzLnNldHRpbmdzW3JdLmNvbG9yP3RoaXMuc2V0dGluZ3Nbcl0uY29sb3I6ZS5ib3JkZXIuY29sb3Isbi5oZWlnaHQ9dGhpcy5zZXR0aW5nc1tyXSYmdGhpcy5zZXR0aW5nc1tyXS53aWR0aD90aGlzLnNldHRpbmdzW3JdLndpZHRoKyJweCI6ZS5ib3JkZXIud2lkdGgrInB4IixuLndpZHRoPXRoaXMuc2V0dGluZ3Nbcl0mJnRoaXMuc2V0dGluZ3Nbcl0ud2lkdGg/dGhpcy5zZXR0aW5nc1tyXS53aWR0aCsicHgiOmUuYm9yZGVyLndpZHRoKyJweCIsdGhpcy5tYWluLmFwcGVuZENoaWxkKGkpfXRoaXMudG9wPXRoaXMubWFpbi5jaGlsZE5vZGVzWzBdLHRoaXMubGVmdD10aGlzLm1haW4uY2hpbGROb2Rlc1sxXSx0aGlzLmJvdHRvbT10aGlzLm1haW4uY2hpbGROb2Rlc1syXSx0aGlzLnJpZ2h0PXRoaXMubWFpbi5jaGlsZE5vZGVzWzNdLHRoaXMudG9wU3R5bGU9dGhpcy50b3Auc3R5bGUsdGhpcy5sZWZ0U3R5bGU9dGhpcy5sZWZ0LnN0eWxlLHRoaXMuYm90dG9tU3R5bGU9dGhpcy5ib3R0b20uc3R5bGUsdGhpcy5yaWdodFN0eWxlPXRoaXMucmlnaHQuc3R5bGUsdGhpcy5jb3JuZXI9dGhpcy5tYWluLmNoaWxkTm9kZXNbNF0sdGhpcy5jb3JuZXIuY2xhc3NOYW1lKz0iIGNvcm5lciIsdGhpcy5jb3JuZXJTdHlsZT10aGlzLmNvcm5lci5zdHlsZSx0aGlzLmNvcm5lclN0eWxlLndpZHRoPXRoaXMuY29ybmVyRGVmYXVsdFN0eWxlLndpZHRoLHRoaXMuY29ybmVyU3R5bGUuaGVpZ2h0PXRoaXMuY29ybmVyRGVmYXVsdFN0eWxlLmhlaWdodCx0aGlzLmNvcm5lclN0eWxlLmJvcmRlcj1bdGhpcy5jb3JuZXJEZWZhdWx0U3R5bGUuYm9yZGVyV2lkdGgsdGhpcy5jb3JuZXJEZWZhdWx0U3R5bGUuYm9yZGVyU3R5bGUsdGhpcy5jb3JuZXJEZWZhdWx0U3R5bGUuYm9yZGVyQ29sb3JdLmpvaW4oIiAiKSxIYW5kc29udGFibGUubW9iaWxlQnJvd3NlciYmdGhpcy5jcmVhdGVNdWx0aXBsZVNlbGVjdG9ySGFuZGxlcygpLHRoaXMuZGlzYXBwZWFyKCksdGhpcy53b3Qud3RUYWJsZS5ib3JkZXJzSG9sZGVyfHwodGhpcy53b3Qud3RUYWJsZS5ib3JkZXJzSG9sZGVyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLHRoaXMud290Lnd0VGFibGUuYm9yZGVyc0hvbGRlci5jbGFzc05hbWU9Imh0Qm9yZGVycyIsdGhpcy53b3Qud3RUYWJsZS5zcHJlYWRlci5hcHBlbmRDaGlsZCh0aGlzLndvdC53dFRhYmxlLmJvcmRlcnNIb2xkZXIpKSx0aGlzLndvdC53dFRhYmxlLmJvcmRlcnNIb2xkZXIuaW5zZXJ0QmVmb3JlKHRoaXMubWFpbix0aGlzLndvdC53dFRhYmxlLmJvcmRlcnNIb2xkZXIuZmlyc3RDaGlsZCl9LGNyZWF0ZU11bHRpcGxlU2VsZWN0b3JIYW5kbGVzOmZ1bmN0aW9uKCl7dGhpcy5zZWxlY3Rpb25IYW5kbGVzPXt0b3BMZWZ0OmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHRvcExlZnRIaXRBcmVhOmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLGJvdHRvbVJpZ2h0OmRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLGJvdHRvbVJpZ2h0SGl0QXJlYTpkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKX07dmFyIGU9MTAsdD00MDt0aGlzLnNlbGVjdGlvbkhhbmRsZXMudG9wTGVmdC5jbGFzc05hbWU9InRvcExlZnRTZWxlY3Rpb25IYW5kbGUiLHRoaXMuc2VsZWN0aW9uSGFuZGxlcy50b3BMZWZ0SGl0QXJlYS5jbGFzc05hbWU9InRvcExlZnRTZWxlY3Rpb25IYW5kbGUtSGl0QXJlYSIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLmJvdHRvbVJpZ2h0LmNsYXNzTmFtZT0iYm90dG9tUmlnaHRTZWxlY3Rpb25IYW5kbGUiLHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5ib3R0b21SaWdodEhpdEFyZWEuY2xhc3NOYW1lPSJib3R0b21SaWdodFNlbGVjdGlvbkhhbmRsZS1IaXRBcmVhIix0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzPXt0b3BMZWZ0OnRoaXMuc2VsZWN0aW9uSGFuZGxlcy50b3BMZWZ0LnN0eWxlLHRvcExlZnRIaXRBcmVhOnRoaXMuc2VsZWN0aW9uSGFuZGxlcy50b3BMZWZ0SGl0QXJlYS5zdHlsZSxib3R0b21SaWdodDp0aGlzLnNlbGVjdGlvbkhhbmRsZXMuYm90dG9tUmlnaHQuc3R5bGUsYm90dG9tUmlnaHRIaXRBcmVhOnRoaXMuc2VsZWN0aW9uSGFuZGxlcy5ib3R0b21SaWdodEhpdEFyZWEuc3R5bGV9O3ZhciBuPXtwb3NpdGlvbjoiYWJzb2x1dGUiLGhlaWdodDp0KyJweCIsd2lkdGg6dCsicHgiLCJib3JkZXItcmFkaXVzIjpwYXJzZUludCh0LzEuNSwxMCkrInB4In07Zm9yKHZhciBvIGluIG4pbi5oYXNPd25Qcm9wZXJ0eShvKSYmKHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMuYm90dG9tUmlnaHRIaXRBcmVhW29dPW5bb10sdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0SGl0QXJlYVtvXT1uW29dKTt2YXIgcj17cG9zaXRpb246ImFic29sdXRlIixoZWlnaHQ6ZSsicHgiLHdpZHRoOmUrInB4IiwiYm9yZGVyLXJhZGl1cyI6cGFyc2VJbnQoZS8xLjUsMTApKyJweCIsYmFja2dyb3VuZDoiI0Y1RjVGRiIsYm9yZGVyOiIxcHggc29saWQgIzQyODVjOCJ9O2Zvcih2YXIgaSBpbiByKXIuaGFzT3duUHJvcGVydHkoaSkmJih0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzLmJvdHRvbVJpZ2h0W2ldPXJbaV0sdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0W2ldPXJbaV0pO3RoaXMubWFpbi5hcHBlbmRDaGlsZCh0aGlzLnNlbGVjdGlvbkhhbmRsZXMudG9wTGVmdCksdGhpcy5tYWluLmFwcGVuZENoaWxkKHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5ib3R0b21SaWdodCksdGhpcy5tYWluLmFwcGVuZENoaWxkKHRoaXMuc2VsZWN0aW9uSGFuZGxlcy50b3BMZWZ0SGl0QXJlYSksdGhpcy5tYWluLmFwcGVuZENoaWxkKHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5ib3R0b21SaWdodEhpdEFyZWEpfSxpc1BhcnRSYW5nZTpmdW5jdGlvbihlLHQpe3JldHVybiF0aGlzLndvdC5zZWxlY3Rpb25zLmFyZWEuY2VsbFJhbmdlfHxlPT10aGlzLndvdC5zZWxlY3Rpb25zLmFyZWEuY2VsbFJhbmdlLnRvLnJvdyYmdD09dGhpcy53b3Quc2VsZWN0aW9ucy5hcmVhLmNlbGxSYW5nZS50by5jb2w/ITE6ITB9LHVwZGF0ZU11bHRpcGxlU2VsZWN0aW9uSGFuZGxlc1Bvc2l0aW9uOmZ1bmN0aW9uKGUsdCxuLG8scixpKXt2YXIgcz1wYXJzZUludCh0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzLnRvcExlZnQud2lkdGgsMTApLGE9cGFyc2VJbnQodGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0SGl0QXJlYS53aWR0aCwxMCk7dGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0LnRvcD1wYXJzZUludChuLXMsMTApKyJweCIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0LmxlZnQ9cGFyc2VJbnQoby1zLDEwKSsicHgiLHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMudG9wTGVmdEhpdEFyZWEudG9wPXBhcnNlSW50KG4tYS80KjMsMTApKyJweCIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0SGl0QXJlYS5sZWZ0PXBhcnNlSW50KG8tYS80KjMsMTApKyJweCIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy5ib3R0b21SaWdodC50b3A9cGFyc2VJbnQobitpLDEwKSsicHgiLHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMuYm90dG9tUmlnaHQubGVmdD1wYXJzZUludChvK3IsMTApKyJweCIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy5ib3R0b21SaWdodEhpdEFyZWEudG9wPXBhcnNlSW50KG4raS1hLzQsMTApKyJweCIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy5ib3R0b21SaWdodEhpdEFyZWEubGVmdD1wYXJzZUludChvK3ItYS80LDEwKSsicHgiLHRoaXMuc2V0dGluZ3MuYm9yZGVyLm11bHRpcGxlU2VsZWN0aW9uSGFuZGxlc1Zpc2libGUmJnRoaXMuc2V0dGluZ3MuYm9yZGVyLm11bHRpcGxlU2VsZWN0aW9uSGFuZGxlc1Zpc2libGUoKT8odGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0LmRpc3BsYXk9ImJsb2NrIix0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzLnRvcExlZnRIaXRBcmVhLmRpc3BsYXk9ImJsb2NrIix0aGlzLmlzUGFydFJhbmdlKGUsdCk/KHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMuYm90dG9tUmlnaHQuZGlzcGxheT0ibm9uZSIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy5ib3R0b21SaWdodEhpdEFyZWEuZGlzcGxheT0ibm9uZSIpOih0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzLmJvdHRvbVJpZ2h0LmRpc3BsYXk9ImJsb2NrIix0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzLmJvdHRvbVJpZ2h0SGl0QXJlYS5kaXNwbGF5PSJibG9jayIpKToodGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0LmRpc3BsYXk9Im5vbmUiLHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMuYm90dG9tUmlnaHQuZGlzcGxheT0ibm9uZSIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0SGl0QXJlYS5kaXNwbGF5PSJub25lIix0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzLmJvdHRvbVJpZ2h0SGl0QXJlYS5kaXNwbGF5PSJub25lIiksZT09dGhpcy53b3Qud3RTZXR0aW5ncy5nZXRTZXR0aW5nKCJmaXhlZFJvd3NUb3AiKXx8dD09dGhpcy53b3Qud3RTZXR0aW5ncy5nZXRTZXR0aW5nKCJmaXhlZENvbHVtbnNMZWZ0Iik/KHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMudG9wTGVmdC56SW5kZXg9Ijk5OTkiLHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMudG9wTGVmdEhpdEFyZWEuekluZGV4PSI5OTk5Iik6KHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMudG9wTGVmdC56SW5kZXg9IiIsdGhpcy5zZWxlY3Rpb25IYW5kbGVzLnN0eWxlcy50b3BMZWZ0SGl0QXJlYS56SW5kZXg9IiIpfSxhcHBlYXI6ZnVuY3Rpb24oZSl7aWYoIXRoaXMuZGlzYWJsZWQpe3ZhciB0LG4sbyxyLGkscyxhLGwsbSx2LGIsQyxSLF8sUyxFLFQsTyxNO009eS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LHkuQ0xPTkVfVE9QKXx8eS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LHkuQ0xPTkVfVE9QX0xFRlRfQ09STkVSKT90aGlzLndvdC5nZXRTZXR0aW5nKCJmaXhlZFJvd3NUb3AiKTp5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXkseS5DTE9ORV9CT1RUT00pfHx5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXkseS5DTE9ORV9CT1RUT01fTEVGVF9DT1JORVIpP3RoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c0JvdHRvbSIpOnRoaXMud290Lnd0VGFibGUuZ2V0UmVuZGVyZWRSb3dzQ291bnQoKTtmb3IodmFyIGs9MDtNPms7aysrKXt2YXIgSD10aGlzLndvdC53dFRhYmxlLnJvd0ZpbHRlci5yZW5kZXJlZFRvU291cmNlKGspO2lmKEg+PWVbMF0mJkg8PWVbMl0pe1I9SDticmVha319Zm9yKHZhciBEPU0tMTtEPj0wO0QtLSl7dmFyIHg9dGhpcy53b3Qud3RUYWJsZS5yb3dGaWx0ZXIucmVuZGVyZWRUb1NvdXJjZShEKTtpZih4Pj1lWzBdJiZ4PD1lWzJdKXtTPXg7YnJlYWt9fU09dGhpcy53b3Qud3RUYWJsZS5nZXRSZW5kZXJlZENvbHVtbnNDb3VudCgpO2Zvcih2YXIgQT0wO00+QTtBKyspe3ZhciBQPXRoaXMud290Lnd0VGFibGUuY29sdW1uRmlsdGVyLnJlbmRlcmVkVG9Tb3VyY2UoQSk7aWYoUD49ZVsxXSYmUDw9ZVszXSl7Xz1QO2JyZWFrfX1mb3IodmFyIE49TS0xO04+PTA7Ti0tKXt2YXIgTD10aGlzLndvdC53dFRhYmxlLmNvbHVtbkZpbHRlci5yZW5kZXJlZFRvU291cmNlKE4pO2lmKEw+PWVbMV0mJkw8PWVbM10pe0U9TDticmVha319aWYodm9pZCAwPT09Unx8dm9pZCAwPT09XylyZXR1cm4gdm9pZCB0aGlzLmRpc2FwcGVhcigpO3Q9UiE9PVN8fF8hPT1FLG49dGhpcy53b3Qud3RUYWJsZS5nZXRDZWxsKG5ldyB3KFIsXykpLG89dD90aGlzLndvdC53dFRhYmxlLmdldENlbGwobmV3IHcoUyxFKSk6bixyPWYobiksaT10P2Yobyk6cixzPWYodGhpcy53b3Qud3RUYWJsZS5UQUJMRSksbD1yLnRvcCxiPWkudG9wK3AobyktbCx2PXIubGVmdCxDPWkubGVmdCtnKG8pLXYsYT1sLXMudG9wLTEsbT12LXMubGVmdC0xO3ZhciBXPXUobik7cGFyc2VJbnQoVy5ib3JkZXJUb3BXaWR0aCwxMCk+MCYmKGErPTEsYj1iPjA/Yi0xOjApLHBhcnNlSW50KFcuYm9yZGVyTGVmdFdpZHRoLDEwKT4wJiYobSs9MSxDPUM+MD9DLTE6MCksdGhpcy50b3BTdHlsZS50b3A9YSsicHgiLHRoaXMudG9wU3R5bGUubGVmdD1tKyJweCIsdGhpcy50b3BTdHlsZS53aWR0aD1DKyJweCIsdGhpcy50b3BTdHlsZS5kaXNwbGF5PSJibG9jayIsdGhpcy5sZWZ0U3R5bGUudG9wPWErInB4Iix0aGlzLmxlZnRTdHlsZS5sZWZ0PW0rInB4Iix0aGlzLmxlZnRTdHlsZS5oZWlnaHQ9YisicHgiLHRoaXMubGVmdFN0eWxlLmRpc3BsYXk9ImJsb2NrIjt2YXIgST1NYXRoLmZsb29yKHRoaXMuc2V0dGluZ3MuYm9yZGVyLndpZHRoLzIpO3RoaXMuYm90dG9tU3R5bGUudG9wPWErYi1JKyJweCIsdGhpcy5ib3R0b21TdHlsZS5sZWZ0PW0rInB4Iix0aGlzLmJvdHRvbVN0eWxlLndpZHRoPUMrInB4Iix0aGlzLmJvdHRvbVN0eWxlLmRpc3BsYXk9ImJsb2NrIix0aGlzLnJpZ2h0U3R5bGUudG9wPWErInB4Iix0aGlzLnJpZ2h0U3R5bGUubGVmdD1tK0MtSSsicHgiLHRoaXMucmlnaHRTdHlsZS5oZWlnaHQ9YisxKyJweCIsdGhpcy5yaWdodFN0eWxlLmRpc3BsYXk9ImJsb2NrIixIYW5kc29udGFibGUubW9iaWxlQnJvd3Nlcnx8IXRoaXMuaGFzU2V0dGluZyh0aGlzLnNldHRpbmdzLmJvcmRlci5jb3JuZXJWaXNpYmxlKXx8dGhpcy5pc1BhcnRSYW5nZShTLEUpP3RoaXMuY29ybmVyU3R5bGUuZGlzcGxheT0ibm9uZSI6KHRoaXMuY29ybmVyU3R5bGUudG9wPWErYi00KyJweCIsdGhpcy5jb3JuZXJTdHlsZS5sZWZ0PW0rQy00KyJweCIsdGhpcy5jb3JuZXJTdHlsZS5ib3JkZXJSaWdodFdpZHRoPXRoaXMuY29ybmVyRGVmYXVsdFN0eWxlLmJvcmRlcldpZHRoLHRoaXMuY29ybmVyU3R5bGUud2lkdGg9dGhpcy5jb3JuZXJEZWZhdWx0U3R5bGUud2lkdGgsdGhpcy5jb3JuZXJTdHlsZS5kaXNwbGF5PSJibG9jayIsVD1jKHRoaXMud290Lnd0VGFibGUuVEFCTEUpLEU9PT10aGlzLndvdC5nZXRTZXR0aW5nKCJ0b3RhbENvbHVtbnMiKS0xJiYoTz1vLm9mZnNldExlZnQrZyhvKT49ZChUKSxPJiYodGhpcy5jb3JuZXJTdHlsZS5sZWZ0PU1hdGguZmxvb3IobStDLTMtcGFyc2VJbnQodGhpcy5jb3JuZXJEZWZhdWx0U3R5bGUud2lkdGgpLzIpKyJweCIsdGhpcy5jb3JuZXJTdHlsZS5ib3JkZXJSaWdodFdpZHRoPTApKSxTPT09dGhpcy53b3QuZ2V0U2V0dGluZygidG90YWxSb3dzIiktMSYmKE89by5vZmZzZXRUb3ArcChvKT49aChUKSxPJiYodGhpcy5jb3JuZXJTdHlsZS50b3A9TWF0aC5mbG9vcihhK2ItMy1wYXJzZUludCh0aGlzLmNvcm5lckRlZmF1bHRTdHlsZS5oZWlnaHQpLzIpKyJweCIsdGhpcy5jb3JuZXJTdHlsZS5ib3JkZXJCb3R0b21XaWR0aD0wKSkpLEhhbmRzb250YWJsZS5tb2JpbGVCcm93c2VyJiZ0aGlzLnVwZGF0ZU11bHRpcGxlU2VsZWN0aW9uSGFuZGxlc1Bvc2l0aW9uKFIsXyxhLG0sQyxiKX19LGRpc2FwcGVhcjpmdW5jdGlvbigpe3RoaXMudG9wU3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5sZWZ0U3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5ib3R0b21TdHlsZS5kaXNwbGF5PSJub25lIix0aGlzLnJpZ2h0U3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5jb3JuZXJTdHlsZS5kaXNwbGF5PSJub25lIixIYW5kc29udGFibGUubW9iaWxlQnJvd3NlciYmKHRoaXMuc2VsZWN0aW9uSGFuZGxlcy5zdHlsZXMudG9wTGVmdC5kaXNwbGF5PSJub25lIix0aGlzLnNlbGVjdGlvbkhhbmRsZXMuc3R5bGVzLmJvdHRvbVJpZ2h0LmRpc3BsYXk9Im5vbmUiKX0saGFzU2V0dGluZzpmdW5jdGlvbihlKXtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2YgZT9lKCk6ISFlfX0se30pLHdpbmRvdy5XYWxrb250YWJsZUJvcmRlcj1ifSx7ImNlbGwvY29vcmRzIjo1LGV2ZW50TWFuYWdlcjo0MSwiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvZG9tL2V2ZW50Ijo0Niwib3ZlcmxheS9fYmFzZS5qcyI6MTF9XSwzOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlVmlld3BvcnRDb2x1bW5zQ2FsY3VsYXRvcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHJ9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbz1uZXcgV2Vha01hcCxyPWZ1bmN0aW9uKGUsdCxuLHIsaSxzLGEpe28uc2V0KHRoaXMse3ZpZXdwb3J0V2lkdGg6ZSxzY3JvbGxPZmZzZXQ6dCx0b3RhbENvbHVtbnM6bixjb2x1bW5XaWR0aEZuOnIsb3ZlcnJpZGVGbjppLG9ubHlGdWxseVZpc2libGU6c30pLHRoaXMuY291bnQ9MCx0aGlzLnN0YXJ0Q29sdW1uPW51bGwsdGhpcy5lbmRDb2x1bW49bnVsbCx0aGlzLnN0YXJ0UG9zaXRpb249bnVsbCx0aGlzLnN0cmV0Y2hBbGxSYXRpbz0wLHRoaXMuc3RyZXRjaExhc3RXaWR0aD0wLHRoaXMuc3RyZXRjaD1hLHRoaXMudG90YWxUYXJnZXRXaWR0aD0wLHRoaXMubmVlZFZlcmlmeUxhc3RDb2x1bW5XaWR0aD0hMCx0aGlzLnN0cmV0Y2hBbGxDb2x1bW5zV2lkdGg9W10sdGhpcy5jYWxjdWxhdGUoKX0saT1yOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhyLHtjYWxjdWxhdGU6ZnVuY3Rpb24oKXtmb3IodmFyIGUsdD0wLG49ITAscj1bXSxpPW8uZ2V0KHRoaXMpLHM9aS5vbmx5RnVsbHlWaXNpYmxlLGE9aS5vdmVycmlkZUZuLGw9aS5zY3JvbGxPZmZzZXQsdT1pLnRvdGFsQ29sdW1ucyxjPWkudmlld3BvcnRXaWR0aCxkPTA7dT5kO2QrKylpZihlPXRoaXMuX2dldENvbHVtbldpZHRoKGQpLGw+PXQmJiFzJiYodGhpcy5zdGFydENvbHVtbj1kKSx0Pj1sJiZsK2M+PXQrZSYmKG51bGw9PXRoaXMuc3RhcnRDb2x1bW4mJih0aGlzLnN0YXJ0Q29sdW1uPWQpLHRoaXMuZW5kQ29sdW1uPWQpLHIucHVzaCh0KSx0Kz1lLHN8fCh0aGlzLmVuZENvbHVtbj1kKSx0Pj1sK2Mpe249ITE7YnJlYWt9aWYodGhpcy5lbmRDb2x1bW49PT11LTEmJm4pZm9yKHRoaXMuc3RhcnRDb2x1bW49dGhpcy5lbmRDb2x1bW47dGhpcy5zdGFydENvbHVtbj4wOyl7dmFyIGg9clt0aGlzLmVuZENvbHVtbl0rZS1yW3RoaXMuc3RhcnRDb2x1bW4tMV07aWYoKGM+PWh8fCFzKSYmdGhpcy5zdGFydENvbHVtbi0tLGg+YylicmVha31udWxsIT09dGhpcy5zdGFydENvbHVtbiYmYSYmYSh0aGlzKSx0aGlzLnN0YXJ0UG9zaXRpb249clt0aGlzLnN0YXJ0Q29sdW1uXSx2b2lkIDA9PXRoaXMuc3RhcnRQb3NpdGlvbiYmKHRoaXMuc3RhcnRQb3NpdGlvbj1udWxsKSxudWxsIT09dGhpcy5zdGFydENvbHVtbiYmKHRoaXMuY291bnQ9dGhpcy5lbmRDb2x1bW4tdGhpcy5zdGFydENvbHVtbisxKX0scmVmcmVzaFN0cmV0Y2hpbmc6ZnVuY3Rpb24oZSl7aWYoIm5vbmUiIT09dGhpcy5zdHJldGNoKXtmb3IodmFyIHQsbixyPTAsaT1vLmdldCh0aGlzKSxzPWkudG90YWxDb2x1bW5zLGE9MDtzPmE7YSsrKXQ9dGhpcy5fZ2V0Q29sdW1uV2lkdGgoYSkscis9dDt0aGlzLnRvdGFsVGFyZ2V0V2lkdGg9ZSxuPXItZSwiYWxsIj09PXRoaXMuc3RyZXRjaCYmMD5uPyh0aGlzLnN0cmV0Y2hBbGxSYXRpbz1lL3IsdGhpcy5zdHJldGNoQWxsQ29sdW1uc1dpZHRoPVtdLHRoaXMubmVlZFZlcmlmeUxhc3RDb2x1bW5XaWR0aD0hMCk6Imxhc3QiPT09dGhpcy5zdHJldGNoJiZlIT09MS8wJiYodGhpcy5zdHJldGNoTGFzdFdpZHRoPS1uK3RoaXMuX2dldENvbHVtbldpZHRoKHMtMSkpfX0sZ2V0U3RyZXRjaGVkQ29sdW1uV2lkdGg6ZnVuY3Rpb24oZSx0KXt2YXIgbj1udWxsO3JldHVybiJhbGwiPT09dGhpcy5zdHJldGNoJiYwIT09dGhpcy5zdHJldGNoQWxsUmF0aW8/bj10aGlzLl9nZXRTdHJldGNoZWRBbGxDb2x1bW5XaWR0aChlLHQpOiJsYXN0Ij09PXRoaXMuc3RyZXRjaCYmMCE9PXRoaXMuc3RyZXRjaExhc3RXaWR0aCYmKG49dGhpcy5fZ2V0U3RyZXRjaGVkTGFzdENvbHVtbldpZHRoKGUpKSxufSxfZ2V0U3RyZXRjaGVkQWxsQ29sdW1uV2lkdGg6ZnVuY3Rpb24oZSx0KXt2YXIgbj0wLHI9by5nZXQodGhpcyksaT1yLnRvdGFsQ29sdW1ucztpZih0aGlzLnN0cmV0Y2hBbGxDb2x1bW5zV2lkdGhbZV18fCh0aGlzLnN0cmV0Y2hBbGxDb2x1bW5zV2lkdGhbZV09TWF0aC5yb3VuZCh0KnRoaXMuc3RyZXRjaEFsbFJhdGlvKSksdGhpcy5zdHJldGNoQWxsQ29sdW1uc1dpZHRoLmxlbmd0aD09PWkmJnRoaXMubmVlZFZlcmlmeUxhc3RDb2x1bW5XaWR0aCl7dGhpcy5uZWVkVmVyaWZ5TGFzdENvbHVtbldpZHRoPSExO2Zvcih2YXIgcz0wO3M8dGhpcy5zdHJldGNoQWxsQ29sdW1uc1dpZHRoLmxlbmd0aDtzKyspbis9dGhpcy5zdHJldGNoQWxsQ29sdW1uc1dpZHRoW3NdO24hPT10aGlzLnRvdGFsVGFyZ2V0V2lkdGgmJih0aGlzLnN0cmV0Y2hBbGxDb2x1bW5zV2lkdGhbdGhpcy5zdHJldGNoQWxsQ29sdW1uc1dpZHRoLmxlbmd0aC0xXSs9dGhpcy50b3RhbFRhcmdldFdpZHRoLW4pfXJldHVybiB0aGlzLnN0cmV0Y2hBbGxDb2x1bW5zV2lkdGhbZV19LF9nZXRTdHJldGNoZWRMYXN0Q29sdW1uV2lkdGg6ZnVuY3Rpb24oZSl7dmFyIHQ9by5nZXQodGhpcyksbj10LnRvdGFsQ29sdW1ucztyZXR1cm4gZT09PW4tMT90aGlzLnN0cmV0Y2hMYXN0V2lkdGg6bnVsbH0sX2dldENvbHVtbldpZHRoOmZ1bmN0aW9uKGUpe3ZhciB0PW8uZ2V0KHRoaXMpLmNvbHVtbldpZHRoRm4oZSk7cmV0dXJuIHZvaWQgMD09PXQmJih0PWkuREVGQVVMVF9XSURUSCksdH19LHtnZXQgREVGQVVMVF9XSURUSCgpe3JldHVybiA1MH19KSx3aW5kb3cuV2Fsa29udGFibGVWaWV3cG9ydENvbHVtbnNDYWxjdWxhdG9yPXJ9LHt9XSw0OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlVmlld3BvcnRSb3dzQ2FsY3VsYXRvcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHJ9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbz1uZXcgV2Vha01hcCxyPWZ1bmN0aW9uKGUsdCxuLHIsaSxzLGEpe28uc2V0KHRoaXMse3ZpZXdwb3J0SGVpZ2h0OmUsc2Nyb2xsT2Zmc2V0OnQsdG90YWxSb3dzOm4scm93SGVpZ2h0Rm46cixvdmVycmlkZUZuOmksb25seUZ1bGx5VmlzaWJsZTpzLGhvcml6b250YWxTY3JvbGxiYXJIZWlnaHQ6YX0pLHRoaXMuY291bnQ9MCx0aGlzLnN0YXJ0Um93PW51bGwsdGhpcy5lbmRSb3c9bnVsbCx0aGlzLnN0YXJ0UG9zaXRpb249bnVsbCx0aGlzLmNhbGN1bGF0ZSgpfSxpPXI7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKHIse2NhbGN1bGF0ZTpmdW5jdGlvbigpe2Zvcih2YXIgZT0wLHQ9ITAsbj1bXSxyPW8uZ2V0KHRoaXMpLHM9ci5vbmx5RnVsbHlWaXNpYmxlLGE9ci5vdmVycmlkZUZuLGw9ci5yb3dIZWlnaHRGbix1PXIuc2Nyb2xsT2Zmc2V0LGM9ci50b3RhbFJvd3MsZD1yLnZpZXdwb3J0SGVpZ2h0LGg9ci5ob3Jpem9udGFsU2Nyb2xsYmFySGVpZ2h0fHwwLGY9MDtjPmY7ZisrKXt2YXIgcD1sKGYpO2lmKHZvaWQgMD09PXAmJihwPWkuREVGQVVMVF9IRUlHSFQpLHU+PWUmJiFzJiYodGhpcy5zdGFydFJvdz1mKSxlPj11JiZ1K2QtaD49ZStwJiYobnVsbD09PXRoaXMuc3RhcnRSb3cmJih0aGlzLnN0YXJ0Um93PWYpLHRoaXMuZW5kUm93PWYpLG4ucHVzaChlKSxlKz1wLHN8fCh0aGlzLmVuZFJvdz1mKSxlPj11K2QtaCl7dD0hMTticmVha319aWYodGhpcy5lbmRSb3c9PT1jLTEmJnQpZm9yKHRoaXMuc3RhcnRSb3c9dGhpcy5lbmRSb3c7dGhpcy5zdGFydFJvdz4wOyl7dmFyIGc9blt0aGlzLmVuZFJvd10rcC1uW3RoaXMuc3RhcnRSb3ctMV07aWYoKGQtaD49Z3x8IXMpJiZ0aGlzLnN0YXJ0Um93LS0sZz49ZC1oKWJyZWFrfW51bGwhPT10aGlzLnN0YXJ0Um93JiZhJiZhKHRoaXMpLHRoaXMuc3RhcnRQb3NpdGlvbj1uW3RoaXMuc3RhcnRSb3ddLHZvaWQgMD09dGhpcy5zdGFydFBvc2l0aW9uJiYodGhpcy5zdGFydFBvc2l0aW9uPW51bGwpLG51bGwhPT10aGlzLnN0YXJ0Um93JiYodGhpcy5jb3VudD10aGlzLmVuZFJvdy10aGlzLnN0YXJ0Um93KzEpfX0se2dldCBERUZBVUxUX0hFSUdIVCgpe3JldHVybiAyM319KSx3aW5kb3cuV2Fsa29udGFibGVWaWV3cG9ydFJvd3NDYWxjdWxhdG9yPXJ9LHt9XSw1OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlQ2VsbENvb3Jkczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbz1mdW5jdGlvbihlLHQpeyJ1bmRlZmluZWQiIT10eXBlb2YgZSYmInVuZGVmaW5lZCIhPXR5cGVvZiB0Pyh0aGlzLnJvdz1lLHRoaXMuY29sPXQpOih0aGlzLnJvdz1udWxsLHRoaXMuY29sPW51bGwpfTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3Mobyx7aXNWYWxpZDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yb3c8MHx8dGhpcy5jb2w8MD8hMTp0aGlzLnJvdz49ZS5nZXRTZXR0aW5nKCJ0b3RhbFJvd3MiKXx8dGhpcy5jb2w+PWUuZ2V0U2V0dGluZygidG90YWxDb2x1bW5zIik/ITE6ITB9LGlzRXF1YWw6ZnVuY3Rpb24oZSl7cmV0dXJuIGU9PT10aGlzPyEwOnRoaXMucm93PT09ZS5yb3cmJnRoaXMuY29sPT09ZS5jb2x9LGlzU291dGhFYXN0T2Y6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucm93Pj1lLnJvdyYmdGhpcy5jb2w+PWUuY29sfSxpc05vcnRoV2VzdE9mOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJvdzw9ZS5yb3cmJnRoaXMuY29sPD1lLmNvbH0saXNTb3V0aFdlc3RPZjpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yb3c+PWUucm93JiZ0aGlzLmNvbDw9ZS5jb2x9LGlzTm9ydGhFYXN0T2Y6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucm93PD1lLnJvdyYmdGhpcy5jb2w+PWUuY29sfX0se30pLHdpbmRvdy5XYWxrb250YWJsZUNlbGxDb29yZHM9b30se31dLDY6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVDZWxsUmFuZ2U6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scj0obz1lKCJjZWxsL2Nvb3JkcyIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSkuV2Fsa29udGFibGVDZWxsQ29vcmRzLGk9ZnVuY3Rpb24oZSx0LG4pe3RoaXMuaGlnaGxpZ2h0PWUsdGhpcy5mcm9tPXQsdGhpcy50bz1ufSxzPWk7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGkse2lzVmFsaWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZnJvbS5pc1ZhbGlkKGUpJiZ0aGlzLnRvLmlzVmFsaWQoZSl9LGlzU2luZ2xlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZnJvbS5yb3c9PT10aGlzLnRvLnJvdyYmdGhpcy5mcm9tLmNvbD09PXRoaXMudG8uY29sfSxnZXRIZWlnaHQ6ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5tYXgodGhpcy5mcm9tLnJvdyx0aGlzLnRvLnJvdyktTWF0aC5taW4odGhpcy5mcm9tLnJvdyx0aGlzLnRvLnJvdykrMX0sZ2V0V2lkdGg6ZnVuY3Rpb24oKXtyZXR1cm4gTWF0aC5tYXgodGhpcy5mcm9tLmNvbCx0aGlzLnRvLmNvbCktTWF0aC5taW4odGhpcy5mcm9tLmNvbCx0aGlzLnRvLmNvbCkrMX0saW5jbHVkZXM6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCksbj10aGlzLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCk7cmV0dXJuIGUucm93PDAmJihlLnJvdz0wKSxlLmNvbDwwJiYoZS5jb2w9MCksdC5yb3c8PWUucm93JiZuLnJvdz49ZS5yb3cmJnQuY29sPD1lLmNvbCYmbi5jb2w+PWUuY29sfSxpbmNsdWRlc1JhbmdlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmluY2x1ZGVzKGUuZ2V0VG9wTGVmdENvcm5lcigpKSYmdGhpcy5pbmNsdWRlcyhlLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCkpfSxpc0VxdWFsOmZ1bmN0aW9uKGUpe3JldHVybiBNYXRoLm1pbih0aGlzLmZyb20ucm93LHRoaXMudG8ucm93KT09TWF0aC5taW4oZS5mcm9tLnJvdyxlLnRvLnJvdykmJk1hdGgubWF4KHRoaXMuZnJvbS5yb3csdGhpcy50by5yb3cpPT1NYXRoLm1heChlLmZyb20ucm93LGUudG8ucm93KSYmTWF0aC5taW4odGhpcy5mcm9tLmNvbCx0aGlzLnRvLmNvbCk9PU1hdGgubWluKGUuZnJvbS5jb2wsZS50by5jb2wpJiZNYXRoLm1heCh0aGlzLmZyb20uY29sLHRoaXMudG8uY29sKT09TWF0aC5tYXgoZS5mcm9tLmNvbCxlLnRvLmNvbCl9LG92ZXJsYXBzOmZ1bmN0aW9uKGUpe3JldHVybiBlLmlzU291dGhFYXN0T2YodGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCkpJiZlLmlzTm9ydGhXZXN0T2YodGhpcy5nZXRCb3R0b21SaWdodENvcm5lcigpKX0saXNTb3V0aEVhc3RPZjpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCkuaXNTb3V0aEVhc3RPZihlKXx8dGhpcy5nZXRCb3R0b21SaWdodENvcm5lcigpLmlzU291dGhFYXN0T2YoZSl9LGlzTm9ydGhXZXN0T2Y6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZ2V0VG9wTGVmdENvcm5lcigpLmlzTm9ydGhXZXN0T2YoZSl8fHRoaXMuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKS5pc05vcnRoV2VzdE9mKGUpfSxleHBhbmQ6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCksbj10aGlzLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCk7cmV0dXJuIGUucm93PHQucm93fHxlLmNvbDx0LmNvbHx8ZS5yb3c+bi5yb3d8fGUuY29sPm4uY29sPyh0aGlzLmZyb209bmV3IHIoTWF0aC5taW4odC5yb3csZS5yb3cpLE1hdGgubWluKHQuY29sLGUuY29sKSksdGhpcy50bz1uZXcgcihNYXRoLm1heChuLnJvdyxlLnJvdyksTWF0aC5tYXgobi5jb2wsZS5jb2wpKSwhMCk6ITF9LGV4cGFuZEJ5UmFuZ2U6ZnVuY3Rpb24oZSl7aWYodGhpcy5pbmNsdWRlc1JhbmdlKGUpfHwhdGhpcy5vdmVybGFwcyhlKSlyZXR1cm4hMTt2YXIgdD10aGlzLmdldFRvcExlZnRDb3JuZXIoKSxuPXRoaXMuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKSxvPSh0aGlzLmdldFRvcFJpZ2h0Q29ybmVyKCksdGhpcy5nZXRCb3R0b21MZWZ0Q29ybmVyKCksZS5nZXRUb3BMZWZ0Q29ybmVyKCkpLGk9ZS5nZXRCb3R0b21SaWdodENvcm5lcigpLGE9TWF0aC5taW4odC5yb3csby5yb3cpLGw9TWF0aC5taW4odC5jb2wsby5jb2wpLHU9TWF0aC5tYXgobi5yb3csaS5yb3cpLGM9TWF0aC5tYXgobi5jb2wsaS5jb2wpLGQ9bmV3IHIoYSxsKSxoPW5ldyByKHUsYyksZj1uZXcgcyhkLGQsaCkuaXNDb3JuZXIodGhpcy5mcm9tLGUpLHA9ZS5pc0VxdWFsKG5ldyBzKGQsZCxoKSk7cmV0dXJuIGYmJiFwJiYodGhpcy5mcm9tLmNvbD5kLmNvbCYmKGQuY29sPWMsaC5jb2w9bCksdGhpcy5mcm9tLnJvdz5kLnJvdyYmKGQucm93PXUsaC5yb3c9YSkpLHRoaXMuZnJvbT1kLHRoaXMudG89aCwhMH0sZ2V0RGlyZWN0aW9uOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZnJvbS5pc05vcnRoV2VzdE9mKHRoaXMudG8pPyJOVy1TRSI6dGhpcy5mcm9tLmlzTm9ydGhFYXN0T2YodGhpcy50byk/Ik5FLVNXIjp0aGlzLmZyb20uaXNTb3V0aEVhc3RPZih0aGlzLnRvKT8iU0UtTlciOnRoaXMuZnJvbS5pc1NvdXRoV2VzdE9mKHRoaXMudG8pPyJTVy1ORSI6dm9pZCAwfSxzZXREaXJlY3Rpb246ZnVuY3Rpb24oZSl7c3dpdGNoKGUpe2Nhc2UiTlctU0UiOnRoaXMuZnJvbT10aGlzLmdldFRvcExlZnRDb3JuZXIoKSx0aGlzLnRvPXRoaXMuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKTticmVhaztjYXNlIk5FLVNXIjp0aGlzLmZyb209dGhpcy5nZXRUb3BSaWdodENvcm5lcigpLHRoaXMudG89dGhpcy5nZXRCb3R0b21MZWZ0Q29ybmVyKCk7YnJlYWs7Y2FzZSJTRS1OVyI6dGhpcy5mcm9tPXRoaXMuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKSx0aGlzLnRvPXRoaXMuZ2V0VG9wTGVmdENvcm5lcigpO2JyZWFrO2Nhc2UiU1ctTkUiOnRoaXMuZnJvbT10aGlzLmdldEJvdHRvbUxlZnRDb3JuZXIoKSx0aGlzLnRvPXRoaXMuZ2V0VG9wUmlnaHRDb3JuZXIoKX19LGdldFRvcExlZnRDb3JuZXI6ZnVuY3Rpb24oKXtyZXR1cm4gbmV3IHIoTWF0aC5taW4odGhpcy5mcm9tLnJvdyx0aGlzLnRvLnJvdyksTWF0aC5taW4odGhpcy5mcm9tLmNvbCx0aGlzLnRvLmNvbCkpfSxnZXRCb3R0b21SaWdodENvcm5lcjpmdW5jdGlvbigpe3JldHVybiBuZXcgcihNYXRoLm1heCh0aGlzLmZyb20ucm93LHRoaXMudG8ucm93KSxNYXRoLm1heCh0aGlzLmZyb20uY29sLHRoaXMudG8uY29sKSl9LGdldFRvcFJpZ2h0Q29ybmVyOmZ1bmN0aW9uKCl7cmV0dXJuIG5ldyByKE1hdGgubWluKHRoaXMuZnJvbS5yb3csdGhpcy50by5yb3cpLE1hdGgubWF4KHRoaXMuZnJvbS5jb2wsdGhpcy50by5jb2wpKX0sZ2V0Qm90dG9tTGVmdENvcm5lcjpmdW5jdGlvbigpe3JldHVybiBuZXcgcihNYXRoLm1heCh0aGlzLmZyb20ucm93LHRoaXMudG8ucm93KSxNYXRoLm1pbih0aGlzLmZyb20uY29sLHRoaXMudG8uY29sKSl9LGlzQ29ybmVyOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQmJnQuaW5jbHVkZXMoZSkmJih0aGlzLmdldFRvcExlZnRDb3JuZXIoKS5pc0VxdWFsKG5ldyByKHQuZnJvbS5yb3csdC5mcm9tLmNvbCkpfHx0aGlzLmdldFRvcFJpZ2h0Q29ybmVyKCkuaXNFcXVhbChuZXcgcih0LmZyb20ucm93LHQudG8uY29sKSl8fHRoaXMuZ2V0Qm90dG9tTGVmdENvcm5lcigpLmlzRXF1YWwobmV3IHIodC50by5yb3csdC5mcm9tLmNvbCkpfHx0aGlzLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCkuaXNFcXVhbChuZXcgcih0LnRvLnJvdyx0LnRvLmNvbCkpKT8hMDplLmlzRXF1YWwodGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCkpfHxlLmlzRXF1YWwodGhpcy5nZXRUb3BSaWdodENvcm5lcigpKXx8ZS5pc0VxdWFsKHRoaXMuZ2V0Qm90dG9tTGVmdENvcm5lcigpKXx8ZS5pc0VxdWFsKHRoaXMuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKSl9LGdldE9wcG9zaXRlQ29ybmVyOmZ1bmN0aW9uKGUsdCl7aWYoIShlIGluc3RhbmNlb2YgcikpcmV0dXJuITE7aWYodCYmdC5pbmNsdWRlcyhlKSl7aWYodGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCkuaXNFcXVhbChuZXcgcih0LmZyb20ucm93LHQuZnJvbS5jb2wpKSlyZXR1cm4gdGhpcy5nZXRCb3R0b21SaWdodENvcm5lcigpO2lmKHRoaXMuZ2V0VG9wUmlnaHRDb3JuZXIoKS5pc0VxdWFsKG5ldyByKHQuZnJvbS5yb3csdC50by5jb2wpKSlyZXR1cm4gdGhpcy5nZXRCb3R0b21MZWZ0Q29ybmVyKCk7aWYodGhpcy5nZXRCb3R0b21MZWZ0Q29ybmVyKCkuaXNFcXVhbChuZXcgcih0LnRvLnJvdyx0LmZyb20uY29sKSkpcmV0dXJuIHRoaXMuZ2V0VG9wUmlnaHRDb3JuZXIoKTtpZih0aGlzLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCkuaXNFcXVhbChuZXcgcih0LnRvLnJvdyx0LnRvLmNvbCkpKXJldHVybiB0aGlzLmdldFRvcExlZnRDb3JuZXIoKX1yZXR1cm4gZS5pc0VxdWFsKHRoaXMuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKSk/dGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCk6ZS5pc0VxdWFsKHRoaXMuZ2V0VG9wTGVmdENvcm5lcigpKT90aGlzLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCk6ZS5pc0VxdWFsKHRoaXMuZ2V0VG9wUmlnaHRDb3JuZXIoKSk/dGhpcy5nZXRCb3R0b21MZWZ0Q29ybmVyKCk6ZS5pc0VxdWFsKHRoaXMuZ2V0Qm90dG9tTGVmdENvcm5lcigpKT90aGlzLmdldFRvcFJpZ2h0Q29ybmVyKCk6dm9pZCAwfSxnZXRCb3JkZXJzU2hhcmVkV2l0aDpmdW5jdGlvbihlKXtpZighdGhpcy5pbmNsdWRlc1JhbmdlKGUpKXJldHVybltdO3ZhciB0PXt0b3A6TWF0aC5taW4odGhpcy5mcm9tLnJvdyx0aGlzLnRvLnJvdyksYm90dG9tOk1hdGgubWF4KHRoaXMuZnJvbS5yb3csdGhpcy50by5yb3cpLGxlZnQ6TWF0aC5taW4odGhpcy5mcm9tLmNvbCx0aGlzLnRvLmNvbCkscmlnaHQ6TWF0aC5tYXgodGhpcy5mcm9tLmNvbCx0aGlzLnRvLmNvbCl9LG49e3RvcDpNYXRoLm1pbihlLmZyb20ucm93LGUudG8ucm93KSxib3R0b206TWF0aC5tYXgoZS5mcm9tLnJvdyxlLnRvLnJvdyksbGVmdDpNYXRoLm1pbihlLmZyb20uY29sLGUudG8uY29sKSxyaWdodDpNYXRoLm1heChlLmZyb20uY29sLGUudG8uY29sKX0sbz1bXTtyZXR1cm4gdC50b3A9PW4udG9wJiZvLnB1c2goInRvcCIpLHQucmlnaHQ9PW4ucmlnaHQmJm8ucHVzaCgicmlnaHQiKSx0LmJvdHRvbT09bi5ib3R0b20mJm8ucHVzaCgiYm90dG9tIiksdC5sZWZ0PT1uLmxlZnQmJm8ucHVzaCgibGVmdCIpLG99LGdldElubmVyOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMuZ2V0VG9wTGVmdENvcm5lcigpLHQ9dGhpcy5nZXRCb3R0b21SaWdodENvcm5lcigpLG49W10sbz1lLnJvdztvPD10LnJvdztvKyspZm9yKHZhciBpPWUuY29sO2k8PXQuY29sO2krKyl0aGlzLmZyb20ucm93PT09byYmdGhpcy5mcm9tLmNvbD09PWl8fHRoaXMudG8ucm93PT09byYmdGhpcy50by5jb2w9PT1pfHxuLnB1c2gobmV3IHIobyxpKSk7cmV0dXJuIG59LGdldEFsbDpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLmdldFRvcExlZnRDb3JuZXIoKSx0PXRoaXMuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKSxuPVtdLG89ZS5yb3c7bzw9dC5yb3c7bysrKWZvcih2YXIgaT1lLmNvbDtpPD10LmNvbDtpKyspZS5yb3c9PT1vJiZlLmNvbD09PWk/bi5wdXNoKGUpOnQucm93PT09byYmdC5jb2w9PT1pP24ucHVzaCh0KTpuLnB1c2gobmV3IHIobyxpKSk7cmV0dXJuIG59LGZvckFsbDpmdW5jdGlvbihlKXtmb3IodmFyIHQ9dGhpcy5nZXRUb3BMZWZ0Q29ybmVyKCksbj10aGlzLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCksbz10LnJvdztvPD1uLnJvdztvKyspZm9yKHZhciByPXQuY29sO3I8PW4uY29sO3IrKyl7dmFyIGk9ZShvLHIpO2lmKGk9PT0hMSlyZXR1cm59fX0se30pLHdpbmRvdy5XYWxrb250YWJsZUNlbGxSYW5nZT1pfSx7ImNlbGwvY29vcmRzIjo1fV0sNzpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtXYWxrb250YWJsZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHh9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscyxhLGwsdSxjLGQsaCxmLHAsZyxtLHY9KG89ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSksdz12LmFkZENsYXNzLHk9di5mYXN0SW5uZXJUZXh0LGI9di5pc1Zpc2libGUsQz12LnJlbW92ZUNsYXNzLFI9KHI9ZSgiaGVscGVycy9vYmplY3QiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLm9iamVjdEVhY2gsXz0oaT1lKCJoZWxwZXJzL3N0cmluZyIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSksUz1fLnRvVXBwZXJDYXNlRmlyc3QsRT1fLnJhbmRvbVN0cmluZyxUPShzPWUoImV2ZW50IikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5XYWxrb250YWJsZUV2ZW50LE89KGE9ZSgib3ZlcmxheXMiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLldhbGtvbnRhYmxlT3ZlcmxheXMsTT0obD1lKCJzY3JvbGwiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLldhbGtvbnRhYmxlU2Nyb2xsLGs9KHU9ZSgic2V0dGluZ3MiKSx1JiZ1Ll9fZXNNb2R1bGUmJnV8fHsiZGVmYXVsdCI6dX0pLldhbGtvbnRhYmxlU2V0dGluZ3MsSD0oYz1lKCJ0YWJsZSIpLGMmJmMuX19lc01vZHVsZSYmY3x8eyJkZWZhdWx0IjpjfSkuV2Fsa29udGFibGVUYWJsZSxEPShkPWUoInZpZXdwb3J0IiksZCYmZC5fX2VzTW9kdWxlJiZkfHx7ImRlZmF1bHQiOmR9KS5XYWxrb250YWJsZVZpZXdwb3J0LHg9KChoPWUoIm92ZXJsYXkvX2Jhc2UuanMiKSxoJiZoLl9fZXNNb2R1bGUmJmh8fHsiZGVmYXVsdCI6aH0pLldhbGtvbnRhYmxlT3ZlcmxheSwoZj1lKCJvdmVybGF5L3RvcC5qcyIpLGYmJmYuX19lc01vZHVsZSYmZnx8eyJkZWZhdWx0IjpmfSkuV2Fsa29udGFibGVUb3BPdmVybGF5LChwPWUoIm92ZXJsYXkvbGVmdC5qcyIpLHAmJnAuX19lc01vZHVsZSYmcHx8eyJkZWZhdWx0IjpwfSkuV2Fsa29udGFibGVMZWZ0T3ZlcmxheSwoZz1lKCJvdmVybGF5L2RlYnVnLmpzIiksZyYmZy5fX2VzTW9kdWxlJiZnfHx7ImRlZmF1bHQiOmd9KS5XYWxrb250YWJsZURlYnVnT3ZlcmxheSwobT1lKCJvdmVybGF5L3RvcExlZnRDb3JuZXIuanMiKSxtJiZtLl9fZXNNb2R1bGUmJm18fHsiZGVmYXVsdCI6bX0pLldhbGtvbnRhYmxlVG9wTGVmdENvcm5lck92ZXJsYXksZnVuY3Rpb24oZSl7dmFyIHQ9W107aWYodGhpcy5ndWlkPSJ3dF8iK0UoKSxlLmNsb25lU291cmNlPyh0aGlzLmNsb25lU291cmNlPWUuY2xvbmVTb3VyY2UsdGhpcy5jbG9uZU92ZXJsYXk9ZS5jbG9uZU92ZXJsYXksdGhpcy53dFNldHRpbmdzPWUuY2xvbmVTb3VyY2Uud3RTZXR0aW5ncyx0aGlzLnd0VGFibGU9bmV3IEgodGhpcyxlLnRhYmxlLGUud3RSb290RWxlbWVudCksdGhpcy53dFNjcm9sbD1uZXcgTSh0aGlzKSx0aGlzLnd0Vmlld3BvcnQ9ZS5jbG9uZVNvdXJjZS53dFZpZXdwb3J0LHRoaXMud3RFdmVudD1uZXcgVCh0aGlzKSx0aGlzLnNlbGVjdGlvbnM9dGhpcy5jbG9uZVNvdXJjZS5zZWxlY3Rpb25zKToodGhpcy53dFNldHRpbmdzPW5ldyBrKHRoaXMsZSksdGhpcy53dFRhYmxlPW5ldyBIKHRoaXMsZS50YWJsZSksdGhpcy53dFNjcm9sbD1uZXcgTSh0aGlzKSx0aGlzLnd0Vmlld3BvcnQ9bmV3IEQodGhpcyksdGhpcy53dEV2ZW50PW5ldyBUKHRoaXMpLHRoaXMuc2VsZWN0aW9ucz10aGlzLmdldFNldHRpbmcoInNlbGVjdGlvbnMiKSx0aGlzLnd0T3ZlcmxheXM9bmV3IE8odGhpcyksdGhpcy5leHBvcnRTZXR0aW5nc0FzQ2xhc3NOYW1lcygpKSx0aGlzLnd0VGFibGUuVEhFQUQuY2hpbGROb2Rlcy5sZW5ndGgmJnRoaXMud3RUYWJsZS5USEVBRC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoKXtmb3IodmFyIG49MCxvPXRoaXMud3RUYWJsZS5USEVBRC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXMubGVuZ3RoO28+bjtuKyspdC5wdXNoKHRoaXMud3RUYWJsZS5USEVBRC5jaGlsZE5vZGVzWzBdLmNoaWxkTm9kZXNbbl0uaW5uZXJIVE1MKTt0aGlzLmdldFNldHRpbmcoImNvbHVtbkhlYWRlcnMiKS5sZW5ndGh8fHRoaXMudXBkYXRlKCJjb2x1bW5IZWFkZXJzIixbZnVuY3Rpb24oZSxuKXt5KG4sdFtlXSl9XSl9dGhpcy5kcmF3bj0hMSx0aGlzLmRyYXdJbnRlcnJ1cHRlZD0hMX0pOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyh4LHtkcmF3OmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTohMTtyZXR1cm4gdGhpcy5kcmF3SW50ZXJydXB0ZWQ9ITEsZXx8Yih0aGlzLnd0VGFibGUuVEFCTEUpP3RoaXMud3RUYWJsZS5kcmF3KGUpOnRoaXMuZHJhd0ludGVycnVwdGVkPSEwLHRoaXN9LGdldENlbGw6ZnVuY3Rpb24oZSl7dmFyIHQ9dm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTohMTtpZighdClyZXR1cm4gdGhpcy53dFRhYmxlLmdldENlbGwoZSk7dmFyIG49dGhpcy53dFNldHRpbmdzLmdldFNldHRpbmcoInRvdGFsUm93cyIpLG89dGhpcy53dFNldHRpbmdzLmdldFNldHRpbmcoImZpeGVkUm93c1RvcCIpLHI9dGhpcy53dFNldHRpbmdzLmdldFNldHRpbmcoImZpeGVkUm93c0JvdHRvbSIpLGk9dGhpcy53dFNldHRpbmdzLmdldFNldHRpbmcoImZpeGVkQ29sdW1uc0xlZnQiKTtpZihlLnJvdzxvJiZlLmNvbDxpKXJldHVybiB0aGlzLnd0T3ZlcmxheXMudG9wTGVmdENvcm5lck92ZXJsYXkuY2xvbmUud3RUYWJsZS5nZXRDZWxsKGUpO2lmKGUucm93PG8pcmV0dXJuIHRoaXMud3RPdmVybGF5cy50b3BPdmVybGF5LmNsb25lLnd0VGFibGUuZ2V0Q2VsbChlKTtpZihlLmNvbDxpJiZlLnJvdz49bi1yKXtpZih0aGlzLnd0T3ZlcmxheXMuYm90dG9tTGVmdENvcm5lck92ZXJsYXkuY2xvbmUpcmV0dXJuIHRoaXMud3RPdmVybGF5cy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheS5jbG9uZS53dFRhYmxlLmdldENlbGwoZSl9ZWxzZXtpZihlLmNvbDxpKXJldHVybiB0aGlzLnd0T3ZlcmxheXMubGVmdE92ZXJsYXkuY2xvbmUud3RUYWJsZS5nZXRDZWxsKGUpO2lmKGUucm93Pj1uLXImJnRoaXMud3RPdmVybGF5cy5ib3R0b21PdmVybGF5LmNsb25lKXJldHVybiB0aGlzLnd0T3ZlcmxheXMuYm90dG9tT3ZlcmxheS5jbG9uZS53dFRhYmxlLmdldENlbGwoZSl9cmV0dXJuIHRoaXMud3RUYWJsZS5nZXRDZWxsKGUpfSx1cGRhdGU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy53dFNldHRpbmdzLnVwZGF0ZShlLHQpfSxzY3JvbGxWZXJ0aWNhbDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy53dE92ZXJsYXlzLnRvcE92ZXJsYXkuc2Nyb2xsVG8oZSksdGhpcy5nZXRTZXR0aW5nKCJvblNjcm9sbFZlcnRpY2FsbHkiKSx0aGlzfSxzY3JvbGxIb3Jpem9udGFsOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnd0T3ZlcmxheXMubGVmdE92ZXJsYXkuc2Nyb2xsVG8oZSksdGhpcy5nZXRTZXR0aW5nKCJvblNjcm9sbEhvcml6b250YWxseSIpLHRoaXN9LHNjcm9sbFZpZXdwb3J0OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnd0U2Nyb2xsLnNjcm9sbFZpZXdwb3J0KGUpLHRoaXN9LGdldFZpZXdwb3J0OmZ1bmN0aW9uKCl7cmV0dXJuW3RoaXMud3RUYWJsZS5nZXRGaXJzdFZpc2libGVSb3coKSx0aGlzLnd0VGFibGUuZ2V0Rmlyc3RWaXNpYmxlQ29sdW1uKCksdGhpcy53dFRhYmxlLmdldExhc3RWaXNpYmxlUm93KCksdGhpcy53dFRhYmxlLmdldExhc3RWaXNpYmxlQ29sdW1uKCldfSxnZXRPdmVybGF5TmFtZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmNsb25lT3ZlcmxheT90aGlzLmNsb25lT3ZlcmxheS50eXBlOiJtYXN0ZXIifSxleHBvcnRTZXR0aW5nc0FzQ2xhc3NOYW1lczpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD17cm93SGVhZGVyczpbImFycmF5Il0sY29sdW1uSGVhZGVyczpbImFycmF5Il19LG49W10sbz1bXTtSKHQsZnVuY3Rpb24odCxyKXt0LmluZGV4T2YoImFycmF5Iik+LTEmJmUuZ2V0U2V0dGluZyhyKS5sZW5ndGgmJm8ucHVzaCgiaHQiK1MocikpLG4ucHVzaCgiaHQiK1MocikpfSksQyh0aGlzLnd0VGFibGUud3RSb290RWxlbWVudC5wYXJlbnROb2RlLG4pLHcodGhpcy53dFRhYmxlLnd0Um9vdEVsZW1lbnQucGFyZW50Tm9kZSxvKX0sZ2V0U2V0dGluZzpmdW5jdGlvbihlLHQsbixvLHIpe3JldHVybiB0aGlzLnd0U2V0dGluZ3MuZ2V0U2V0dGluZyhlLHQsbixvLHIpfSxoYXNTZXR0aW5nOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnd0U2V0dGluZ3MuaGFzKGUpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy53dE92ZXJsYXlzLmRlc3Ryb3koKSx0aGlzLnd0RXZlbnQuZGVzdHJveSgpfX0se30pLHdpbmRvdy5XYWxrb250YWJsZT14fSx7ZXZlbnQ6OCwiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvb2JqZWN0Ijo1MCwiaGVscGVycy9zdHJpbmciOjUyLCJvdmVybGF5L19iYXNlLmpzIjoxMSwib3ZlcmxheS9kZWJ1Zy5qcyI6MTIsIm92ZXJsYXkvbGVmdC5qcyI6MTMsIm92ZXJsYXkvdG9wLmpzIjoxNCwib3ZlcmxheS90b3BMZWZ0Q29ybmVyLmpzIjoxNSxvdmVybGF5czoxNixzY3JvbGw6MTcsc2V0dGluZ3M6MTksdGFibGU6MjAsdmlld3BvcnQ6MjJ9XSw4OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSl7dmFyIHQ9dGhpcyxuPWMoZSk7dGhpcy5pbnN0YW5jZT1lO3ZhciBvPVtudWxsLG51bGxdO3RoaXMuZGJsQ2xpY2tUaW1lb3V0PVtudWxsLG51bGxdO3ZhciByLGkscz1mdW5jdGlvbihlKXt2YXIgbj10LnBhcmVudENlbGwoZS5yZWFsVGFyZ2V0KTtsKGUucmVhbFRhcmdldCwiY29ybmVyIik/dC5pbnN0YW5jZS5nZXRTZXR0aW5nKCJvbkNlbGxDb3JuZXJNb3VzZURvd24iLGUsZS5yZWFsVGFyZ2V0KTpuLlREJiZ0Lmluc3RhbmNlLmhhc1NldHRpbmcoIm9uQ2VsbE1vdXNlRG93biIpJiZ0Lmluc3RhbmNlLmdldFNldHRpbmcoIm9uQ2VsbE1vdXNlRG93biIsZSxuLmNvb3JkcyxuLlRELHQuaW5zdGFuY2UpLDIhPT1lLmJ1dHRvbiYmbi5URCYmKG9bMF09bi5URCxjbGVhclRpbWVvdXQodC5kYmxDbGlja1RpbWVvdXRbMF0pLHQuZGJsQ2xpY2tUaW1lb3V0WzBdPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtvWzBdPW51bGx9LDFlMykpfSxkPWZ1bmN0aW9uKGUpe3QuaW5zdGFuY2UudG91Y2hNb3Zpbmc9ITB9LGg9ZnVuY3Rpb24oZSl7bi5hZGRFdmVudExpc3RlbmVyKHRoaXMsInRvdWNobW92ZSIsZCksdC5jaGVja0lmVG91Y2hNb3ZlPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtyZXR1cm4gdC5pbnN0YW5jZS50b3VjaE1vdmluZz09PSEwPyh0Lmluc3RhbmNlLnRvdWNoTW92aW5nPXZvaWQgMCx2b2lkIG4ucmVtb3ZlRXZlbnRMaXN0ZW5lcigidG91Y2htb3ZlIixkLCExKSk6dm9pZCBzKGUpfSwzMCl9LGY9ZnVuY3Rpb24oZSl7dmFyIG4sbzt0Lmluc3RhbmNlLmhhc1NldHRpbmcoIm9uQ2VsbE1vdXNlT3ZlciIpJiYobj10Lmluc3RhbmNlLnd0VGFibGUuVEFCTEUsbz1hKGUucmVhbFRhcmdldCxbIlREIiwiVEgiXSxuKSxvJiZvIT09aSYmdShvLG4pJiYoaT1vLHQuaW5zdGFuY2UuZ2V0U2V0dGluZygib25DZWxsTW91c2VPdmVyIixlLHQuaW5zdGFuY2Uud3RUYWJsZS5nZXRDb29yZHMobyksbyx0Lmluc3RhbmNlKSkpfSxwPWZ1bmN0aW9uKGUpe2lmKDIhPT1lLmJ1dHRvbil7dmFyIG49dC5wYXJlbnRDZWxsKGUucmVhbFRhcmdldCk7bi5URD09PW9bMF0mJm4uVEQ9PT1vWzFdPyhsKGUucmVhbFRhcmdldCwiY29ybmVyIik/dC5pbnN0YW5jZS5nZXRTZXR0aW5nKCJvbkNlbGxDb3JuZXJEYmxDbGljayIsZSxuLmNvb3JkcyxuLlRELHQuaW5zdGFuY2UpOnQuaW5zdGFuY2UuZ2V0U2V0dGluZygib25DZWxsRGJsQ2xpY2siLGUsbi5jb29yZHMsbi5URCx0Lmluc3RhbmNlKSxvWzBdPW51bGwsb1sxXT1udWxsKTpuLlREPT09b1swXSYmKG9bMV09bi5URCxjbGVhclRpbWVvdXQodC5kYmxDbGlja1RpbWVvdXRbMV0pLHQuZGJsQ2xpY2tUaW1lb3V0WzFdPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtvWzFdPW51bGx9LDUwMCkpfX0sZz1mdW5jdGlvbihlKXtjbGVhclRpbWVvdXQociksZS5wcmV2ZW50RGVmYXVsdCgpLHAoZSl9O2lmKG4uYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmluc3RhbmNlLnd0VGFibGUuaG9sZGVyLCJtb3VzZWRvd24iLHMpLG4uYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmluc3RhbmNlLnd0VGFibGUuVEFCTEUsIm1vdXNlb3ZlciIsZiksbi5hZGRFdmVudExpc3RlbmVyKHRoaXMuaW5zdGFuY2Uud3RUYWJsZS5ob2xkZXIsIm1vdXNldXAiLHApLHRoaXMuaW5zdGFuY2Uud3RUYWJsZS5ob2xkZXIucGFyZW50Tm9kZS5wYXJlbnROb2RlJiZIYW5kc29udGFibGUubW9iaWxlQnJvd3NlciYmIXQuaW5zdGFuY2Uud3RUYWJsZS5pc1dvcmtpbmdPbkNsb25lKCkpe3ZhciBtPSIuIit0aGlzLmluc3RhbmNlLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUuY2xhc3NOYW1lLnNwbGl0KCIgIikuam9pbigiLiIpO24uYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmluc3RhbmNlLnd0VGFibGUuaG9sZGVyLCJ0b3VjaHN0YXJ0IixmdW5jdGlvbihlKXt0Lmluc3RhbmNlLnRvdWNoQXBwbGllZD0hMCx1KGUudGFyZ2V0LG0pJiZoLmNhbGwoZS50YXJnZXQsZSl9KSxuLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5pbnN0YW5jZS53dFRhYmxlLmhvbGRlciwidG91Y2hlbmQiLGZ1bmN0aW9uKGUpe3QuaW5zdGFuY2UudG91Y2hBcHBsaWVkPSExLHUoZS50YXJnZXQsbSkmJmcuY2FsbChlLnRhcmdldCxlKX0pLHQuaW5zdGFuY2UubW9tZW50dW1TY3JvbGxpbmd8fCh0Lmluc3RhbmNlLm1vbWVudHVtU2Nyb2xsaW5nPXt9KSxuLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5pbnN0YW5jZS53dFRhYmxlLmhvbGRlciwic2Nyb2xsIixmdW5jdGlvbihlKXtjbGVhclRpbWVvdXQodC5pbnN0YW5jZS5tb21lbnR1bVNjcm9sbGluZy5fdGltZW91dCksdC5pbnN0YW5jZS5tb21lbnR1bVNjcm9sbGluZy5vbmdvaW5nfHx0Lmluc3RhbmNlLmdldFNldHRpbmcoIm9uQmVmb3JlVG91Y2hTY3JvbGwiKSx0Lmluc3RhbmNlLm1vbWVudHVtU2Nyb2xsaW5nLm9uZ29pbmc9ITAsdC5pbnN0YW5jZS5tb21lbnR1bVNjcm9sbGluZy5fdGltZW91dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dC5pbnN0YW5jZS50b3VjaEFwcGxpZWR8fCh0Lmluc3RhbmNlLm1vbWVudHVtU2Nyb2xsaW5nLm9uZ29pbmc9ITEsdC5pbnN0YW5jZS5nZXRTZXR0aW5nKCJvbkFmdGVyTW9tZW50dW1TY3JvbGwiKSl9LDIwMCl9KX1uLmFkZEV2ZW50TGlzdGVuZXIod2luZG93LCJyZXNpemUiLGZ1bmN0aW9uKCl7Im5vbmUiIT09dC5pbnN0YW5jZS5nZXRTZXR0aW5nKCJzdHJldGNoSCIpJiZ0Lmluc3RhbmNlLmRyYXcoKX0pLHRoaXMuZGVzdHJveT1mdW5jdGlvbigpe2NsZWFyVGltZW91dCh0aGlzLmRibENsaWNrVGltZW91dFswXSksY2xlYXJUaW1lb3V0KHRoaXMuZGJsQ2xpY2tUaW1lb3V0WzFdKSxuLmRlc3Ryb3koKX19T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVFdmVudDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgcixpLHM9KHI9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksYT1zLmNsb3Nlc3QsbD1zLmhhc0NsYXNzLHU9cy5pc0NoaWxkT2YsYz0oaT1lKCJldmVudE1hbmFnZXIiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLmV2ZW50TWFuYWdlcjtvLnByb3RvdHlwZS5wYXJlbnRDZWxsPWZ1bmN0aW9uKGUpe3ZhciB0PXt9LG49dGhpcy5pbnN0YW5jZS53dFRhYmxlLlRBQkxFLG89YShlLFsiVEQiLCJUSCJdLG4pO3JldHVybiBvJiZ1KG8sbik/KHQuY29vcmRzPXRoaXMuaW5zdGFuY2Uud3RUYWJsZS5nZXRDb29yZHMobyksdC5URD1vKTpsKGUsInd0Qm9yZGVyIikmJmwoZSwiY3VycmVudCIpPyh0LmNvb3Jkcz10aGlzLmluc3RhbmNlLnNlbGVjdGlvbnMuY3VycmVudC5jZWxsUmFuZ2UuaGlnaGxpZ2h0LHQuVEQ9dGhpcy5pbnN0YW5jZS53dFRhYmxlLmdldENlbGwodC5jb29yZHMpKTpsKGUsInd0Qm9yZGVyIikmJmwoZSwiYXJlYSIpJiZ0aGlzLmluc3RhbmNlLnNlbGVjdGlvbnMuYXJlYS5jZWxsUmFuZ2UmJih0LmNvb3Jkcz10aGlzLmluc3RhbmNlLnNlbGVjdGlvbnMuYXJlYS5jZWxsUmFuZ2UudG8sdC5URD10aGlzLmluc3RhbmNlLnd0VGFibGUuZ2V0Q2VsbCh0LmNvb3JkcykpLHR9LHdpbmRvdy5XYWxrb250YWJsZUV2ZW50PW99LHtldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1fV0sOTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtXYWxrb250YWJsZUNvbHVtbkZpbHRlcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbz1mdW5jdGlvbihlLHQsbil7dGhpcy5vZmZzZXQ9ZSx0aGlzLnRvdGFsPXQsdGhpcy5jb3VudFRIPW59OyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhvLHtvZmZzZXR0ZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGUrdGhpcy5vZmZzZXR9LHVuT2Zmc2V0dGVkOmZ1bmN0aW9uKGUpe3JldHVybiBlLXRoaXMub2Zmc2V0fSxyZW5kZXJlZFRvU291cmNlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLm9mZnNldHRlZChlKX0sc291cmNlVG9SZW5kZXJlZDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy51bk9mZnNldHRlZChlKX0sb2Zmc2V0dGVkVEg6ZnVuY3Rpb24oZSl7cmV0dXJuIGUtdGhpcy5jb3VudFRIfSx1bk9mZnNldHRlZFRIOmZ1bmN0aW9uKGUpe3JldHVybiBlK3RoaXMuY291bnRUSH0sdmlzaWJsZVJvd0hlYWRlZENvbHVtblRvU291cmNlQ29sdW1uOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJlbmRlcmVkVG9Tb3VyY2UodGhpcy5vZmZzZXR0ZWRUSChlKSl9LHNvdXJjZUNvbHVtblRvVmlzaWJsZVJvd0hlYWRlZENvbHVtbjpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy51bk9mZnNldHRlZFRIKHRoaXMuc291cmNlVG9SZW5kZXJlZChlKSl9fSx7fSksd2luZG93LldhbGtvbnRhYmxlQ29sdW1uRmlsdGVyPW87Cn0se31dLDEwOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlUm93RmlsdGVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvPWZ1bmN0aW9uKGUsdCxuKXt0aGlzLm9mZnNldD1lLHRoaXMudG90YWw9dCx0aGlzLmNvdW50VEg9bn07JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKG8se29mZnNldHRlZDpmdW5jdGlvbihlKXtyZXR1cm4gZSt0aGlzLm9mZnNldH0sdW5PZmZzZXR0ZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGUtdGhpcy5vZmZzZXR9LHJlbmRlcmVkVG9Tb3VyY2U6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMub2Zmc2V0dGVkKGUpfSxzb3VyY2VUb1JlbmRlcmVkOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnVuT2Zmc2V0dGVkKGUpfSxvZmZzZXR0ZWRUSDpmdW5jdGlvbihlKXtyZXR1cm4gZS10aGlzLmNvdW50VEh9LHVuT2Zmc2V0dGVkVEg6ZnVuY3Rpb24oZSl7cmV0dXJuIGUrdGhpcy5jb3VudFRIfSx2aXNpYmxlQ29sSGVhZGVkUm93VG9Tb3VyY2VSb3c6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucmVuZGVyZWRUb1NvdXJjZSh0aGlzLm9mZnNldHRlZFRIKGUpKX0sc291cmNlUm93VG9WaXNpYmxlQ29sSGVhZGVkUm93OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnVuT2Zmc2V0dGVkVEgodGhpcy5zb3VyY2VUb1JlbmRlcmVkKGUpKX19LHt9KSx3aW5kb3cuV2Fsa29udGFibGVSb3dGaWx0ZXI9b30se31dLDExOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlT3ZlcmxheTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGh9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscz0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxhPXMuZ2V0U2Nyb2xsYWJsZUVsZW1lbnQsbD1zLmdldFRyaW1taW5nQ29udGFpbmVyLHU9KHI9ZSgiaGVscGVycy9vYmplY3QiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLmRlZmluZUdldHRlcixjPShpPWUoImV2ZW50TWFuYWdlciIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuZXZlbnRNYW5hZ2VyLGQ9e30saD1mdW5jdGlvbihlKXt1KHRoaXMsIndvdCIsZSx7d3JpdGFibGU6ITF9KSx0aGlzLmluc3RhbmNlPXRoaXMud290LHRoaXMudHlwZT0iIix0aGlzLlRBQkxFPXRoaXMud290Lnd0VGFibGUuVEFCTEUsdGhpcy5oaWRlcj10aGlzLndvdC53dFRhYmxlLmhpZGVyLHRoaXMuc3ByZWFkZXI9dGhpcy53b3Qud3RUYWJsZS5zcHJlYWRlcix0aGlzLmhvbGRlcj10aGlzLndvdC53dFRhYmxlLmhvbGRlcix0aGlzLnd0Um9vdEVsZW1lbnQ9dGhpcy53b3Qud3RUYWJsZS53dFJvb3RFbGVtZW50LHRoaXMudHJpbW1pbmdDb250YWluZXI9bCh0aGlzLmhpZGVyLnBhcmVudE5vZGUucGFyZW50Tm9kZSksdGhpcy5tYWluVGFibGVTY3JvbGxhYmxlRWxlbWVudD1hKHRoaXMud290Lnd0VGFibGUuVEFCTEUpLHRoaXMubmVlZEZ1bGxSZW5kZXI9dGhpcy5zaG91bGRCZVJlbmRlcmVkKCksdGhpcy5hcmVFbGVtZW50U2l6ZXNBZGp1c3RlZD0hMX0sZj1oOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhoLHtzaG91bGRCZVJlbmRlcmVkOmZ1bmN0aW9uKCl7cmV0dXJuITB9LG1ha2VDbG9uZTpmdW5jdGlvbihlKXtpZigtMT09PWYuQ0xPTkVfVFlQRVMuaW5kZXhPZihlKSl0aHJvdyBuZXcgRXJyb3IoJ0Nsb25lIHR5cGUgIicrZSsnIiBpcyBub3Qgc3VwcG9ydGVkLicpO3ZhciB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiVEFCTEUiKTtyZXR1cm4gdC5jbGFzc05hbWU9Imh0X2Nsb25lXyIrZSsiIGhhbmRzb250YWJsZSIsdC5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiLHQuc3R5bGUudG9wPTAsdC5zdHlsZS5sZWZ0PTAsdC5zdHlsZS5vdmVyZmxvdz0iaGlkZGVuIixuLmNsYXNzTmFtZT10aGlzLndvdC53dFRhYmxlLlRBQkxFLmNsYXNzTmFtZSx0LmFwcGVuZENoaWxkKG4pLHRoaXMudHlwZT1lLHRoaXMud290Lnd0VGFibGUud3RSb290RWxlbWVudC5wYXJlbnROb2RlLmFwcGVuZENoaWxkKHQpLG5ldyBXYWxrb250YWJsZSh7Y2xvbmVTb3VyY2U6dGhpcy53b3QsY2xvbmVPdmVybGF5OnRoaXMsdGFibGU6bn0pfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTohMSx0PXRoaXMuc2hvdWxkQmVSZW5kZXJlZCgpO3RoaXMuY2xvbmUmJih0aGlzLm5lZWRGdWxsUmVuZGVyfHx0KSYmdGhpcy5jbG9uZS5kcmF3KGUpLHRoaXMubmVlZEZ1bGxSZW5kZXI9dH0sZGVzdHJveTpmdW5jdGlvbigpe2ModGhpcy5jbG9uZSkuZGVzdHJveSgpfX0se2dldCBDTE9ORV9UT1AoKXtyZXR1cm4idG9wIn0sZ2V0IENMT05FX0JPVFRPTSgpe3JldHVybiJib3R0b20ifSxnZXQgQ0xPTkVfTEVGVCgpe3JldHVybiJsZWZ0In0sZ2V0IENMT05FX1RPUF9MRUZUX0NPUk5FUigpe3JldHVybiJ0b3BfbGVmdF9jb3JuZXIifSxnZXQgQ0xPTkVfQk9UVE9NX0xFRlRfQ09STkVSKCl7cmV0dXJuImJvdHRvbV9sZWZ0X2Nvcm5lciJ9LGdldCBDTE9ORV9ERUJVRygpe3JldHVybiJkZWJ1ZyJ9LGdldCBDTE9ORV9UWVBFUygpe3JldHVybltmLkNMT05FX1RPUCxmLkNMT05FX0JPVFRPTSxmLkNMT05FX0xFRlQsZi5DTE9ORV9UT1BfTEVGVF9DT1JORVIsZi5DTE9ORV9CT1RUT01fTEVGVF9DT1JORVIsZi5DTE9ORV9ERUJVR119LHJlZ2lzdGVyT3ZlcmxheTpmdW5jdGlvbihlLHQpe2lmKC0xPT09Zi5DTE9ORV9UWVBFUy5pbmRleE9mKGUpKXRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgb3ZlcmxheSAoIitlKyIpLiIpO2RbZV09dH0sY3JlYXRlT3ZlcmxheTpmdW5jdGlvbihlLHQpe3JldHVybiBuZXcgZFtlXSh0KX0saXNPdmVybGF5VHlwZU9mOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGUmJmRbdF0/ZSBpbnN0YW5jZW9mIGRbdF06ITF9fSksd2luZG93LldhbGtvbnRhYmxlT3ZlcmxheT1ofSx7ZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy9vYmplY3QiOjUwfV0sMTI6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVEZWJ1Z092ZXJsYXk6e2dldDpmdW5jdGlvbigpe3JldHVybiBhfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpPShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLmFkZENsYXNzLHM9KHI9ZSgiX2Jhc2UiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLldhbGtvbnRhYmxlT3ZlcmxheSxhPWZ1bmN0aW9uKGUpeyR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yKGwpLmNhbGwodGhpcyxlKSx0aGlzLmNsb25lPXRoaXMubWFrZUNsb25lKHMuQ0xPTkVfREVCVUcpLHRoaXMuY2xvbmUud3RUYWJsZS5ob2xkZXIuc3R5bGUub3BhY2l0eT0uNCx0aGlzLmNsb25lLnd0VGFibGUuaG9sZGVyLnN0eWxlLnRleHRTaGFkb3c9IjAgMCAycHggI2ZmMDAwMCIsaSh0aGlzLmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUsInd0RGVidWdWaXNpYmxlIil9LGw9YTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoYSx7fSx7fSxzKSx3aW5kb3cuV2Fsa29udGFibGVEZWJ1Z092ZXJsYXk9YSxzLnJlZ2lzdGVyT3ZlcmxheShzLkNMT05FX0RFQlVHLGEpfSx7X2Jhc2U6MTEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1fV0sMTM6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVMZWZ0T3ZlcmxheTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGd9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGk9KG89ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSkscz1pLmFkZENsYXNzLGE9aS5nZXRTY3JvbGxiYXJXaWR0aCxsPWkuZ2V0U2Nyb2xsTGVmdCx1PWkuZ2V0V2luZG93U2Nyb2xsVG9wLGM9aS5oYXNDbGFzcyxkPWkub3V0ZXJXaWR0aCxoPWkucmVtb3ZlQ2xhc3MsZj1pLnNldE92ZXJsYXlQb3NpdGlvbixwPShyPWUoIl9iYXNlIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5XYWxrb250YWJsZU92ZXJsYXksZz1mdW5jdGlvbihlKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJDb25zdHJ1Y3RvcihtKS5jYWxsKHRoaXMsZSksdGhpcy5jbG9uZT10aGlzLm1ha2VDbG9uZShwLkNMT05FX0xFRlQpfSxtPWc7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGcse3Nob3VsZEJlUmVuZGVyZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy53b3QuZ2V0U2V0dGluZygiZml4ZWRDb2x1bW5zTGVmdCIpfHx0aGlzLndvdC5nZXRTZXR0aW5nKCJyb3dIZWFkZXJzIikubGVuZ3RoPyEwOiExfSxyZXNldEZpeGVkUG9zaXRpb246ZnVuY3Rpb24oKXtpZih0aGlzLm5lZWRGdWxsUmVuZGVyJiZ0aGlzLndvdC53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKXt2YXIgZT10aGlzLmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUsdD0wO2lmKHRoaXMudHJpbW1pbmdDb250YWluZXI9PT13aW5kb3cpe3ZhciBuLG8scj10aGlzLndvdC53dFRhYmxlLmhpZGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGk9TWF0aC5jZWlsKHIubGVmdCkscz1NYXRoLmNlaWwoci5yaWdodCk7bz10aGlzLndvdC53dFRhYmxlLmhpZGVyLnN0eWxlLnRvcCxvPSIiPT09bz8wOm8sbj0wPmkmJnMtZS5vZmZzZXRXaWR0aD4wPy1pOjAsdD1uLG4rPSJweCIsZihlLG4sbyl9ZWxzZSB0PXRoaXMuZ2V0U2Nyb2xsUG9zaXRpb24oKTt0aGlzLmFkanVzdEhlYWRlckJvcmRlcnNQb3NpdGlvbih0KSx0aGlzLmFkanVzdEVsZW1lbnRzU2l6ZSgpfX0sc2V0U2Nyb2xsUG9zaXRpb246ZnVuY3Rpb24oZSl7dGhpcy5tYWluVGFibGVTY3JvbGxhYmxlRWxlbWVudD09PXdpbmRvdz93aW5kb3cuc2Nyb2xsVG8oZSx1KCkpOnRoaXMubWFpblRhYmxlU2Nyb2xsYWJsZUVsZW1lbnQuc2Nyb2xsTGVmdD1lfSxvblNjcm9sbDpmdW5jdGlvbigpe3RoaXMud290LmdldFNldHRpbmcoIm9uU2Nyb2xsSG9yaXpvbnRhbGx5Iil9LHN1bUNlbGxTaXplczpmdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0wLG89dGhpcy53b3Qud3RTZXR0aW5ncy5kZWZhdWx0Q29sdW1uV2lkdGg7dD5lOyluKz10aGlzLndvdC53dFRhYmxlLmdldFN0cmV0Y2hlZENvbHVtbldpZHRoKGUpfHxvLGUrKztyZXR1cm4gbn0sYWRqdXN0RWxlbWVudHNTaXplOmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTohMTsodGhpcy5uZWVkRnVsbFJlbmRlcnx8ZSkmJih0aGlzLmFkanVzdFJvb3RFbGVtZW50U2l6ZSgpLHRoaXMuYWRqdXN0Um9vdENoaWxkcmVuU2l6ZSgpLGV8fCh0aGlzLmFyZUVsZW1lbnRTaXplc0FkanVzdGVkPSEwKSl9LGFkanVzdFJvb3RFbGVtZW50U2l6ZTpmdW5jdGlvbigpe3ZhciBlLHQ9dGhpcy53b3Qud3RUYWJsZS5ob2xkZXIsbj10LmNsaWVudEhlaWdodD09PXQub2Zmc2V0SGVpZ2h0PzA6YSgpLG89dGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlLHI9by5zdHlsZTt0aGlzLnRyaW1taW5nQ29udGFpbmVyIT09d2luZG93JiYoci5oZWlnaHQ9dGhpcy53b3Qud3RWaWV3cG9ydC5nZXRXb3Jrc3BhY2VIZWlnaHQoKS1uKyJweCIpLHRoaXMuY2xvbmUud3RUYWJsZS5ob2xkZXIuc3R5bGUuaGVpZ2h0PXIuaGVpZ2h0LGU9ZCh0aGlzLmNsb25lLnd0VGFibGUuVEFCTEUpLHIud2lkdGg9KDA9PT1lP2U6ZSs0KSsicHgifSxhZGp1c3RSb290Q2hpbGRyZW5TaXplOmZ1bmN0aW9uKCl7dmFyIGU9YSgpO3RoaXMuY2xvbmUud3RUYWJsZS5oaWRlci5zdHlsZS5oZWlnaHQ9dGhpcy5oaWRlci5zdHlsZS5oZWlnaHQsdGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5zdHlsZS5oZWlnaHQ9dGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlLnN0eWxlLmhlaWdodCwwPT09ZSYmKGU9MzApLHRoaXMuY2xvbmUud3RUYWJsZS5ob2xkZXIuc3R5bGUud2lkdGg9cGFyc2VJbnQodGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlLnN0eWxlLndpZHRoLDEwKStlKyJweCJ9LGFwcGx5VG9ET006ZnVuY3Rpb24oKXt2YXIgZT10aGlzLndvdC5nZXRTZXR0aW5nKCJ0b3RhbENvbHVtbnMiKTtpZih0aGlzLmFyZUVsZW1lbnRTaXplc0FkanVzdGVkfHx0aGlzLmFkanVzdEVsZW1lbnRzU2l6ZSgpLCJudW1iZXIiPT10eXBlb2YgdGhpcy53b3Qud3RWaWV3cG9ydC5jb2x1bW5zUmVuZGVyQ2FsY3VsYXRvci5zdGFydFBvc2l0aW9uKXRoaXMuc3ByZWFkZXIuc3R5bGUubGVmdD10aGlzLndvdC53dFZpZXdwb3J0LmNvbHVtbnNSZW5kZXJDYWxjdWxhdG9yLnN0YXJ0UG9zaXRpb24rInB4IjtlbHNle2lmKDAhPT1lKXRocm93IG5ldyBFcnJvcigiSW5jb3JyZWN0IHZhbHVlIG9mIHRoZSBjb2x1bW5zUmVuZGVyQ2FsY3VsYXRvciIpO3RoaXMuc3ByZWFkZXIuc3R5bGUubGVmdD0iMCJ9dGhpcy5zcHJlYWRlci5zdHlsZS5yaWdodD0iIix0aGlzLm5lZWRGdWxsUmVuZGVyJiZ0aGlzLnN5bmNPdmVybGF5T2Zmc2V0KCl9LHN5bmNPdmVybGF5T2Zmc2V0OmZ1bmN0aW9uKCl7Im51bWJlciI9PXR5cGVvZiB0aGlzLndvdC53dFZpZXdwb3J0LnJvd3NSZW5kZXJDYWxjdWxhdG9yLnN0YXJ0UG9zaXRpb24/dGhpcy5jbG9uZS53dFRhYmxlLnNwcmVhZGVyLnN0eWxlLnRvcD10aGlzLndvdC53dFZpZXdwb3J0LnJvd3NSZW5kZXJDYWxjdWxhdG9yLnN0YXJ0UG9zaXRpb24rInB4Ijp0aGlzLmNsb25lLnd0VGFibGUuc3ByZWFkZXIuc3R5bGUudG9wPSIifSxzY3JvbGxUbzpmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXMuZ2V0VGFibGVQYXJlbnRPZmZzZXQoKSxvPXRoaXMud290LmNsb25lU291cmNlP3RoaXMud290LmNsb25lU291cmNlOnRoaXMud290LHI9by53dFRhYmxlLmhvbGRlcixpPTA7dCYmci5vZmZzZXRXaWR0aCE9PXIuY2xpZW50V2lkdGgmJihpPWEoKSksdD8obis9dGhpcy5zdW1DZWxsU2l6ZXMoMCxlKzEpLG4tPXRoaXMud290Lnd0Vmlld3BvcnQuZ2V0Vmlld3BvcnRXaWR0aCgpKTpuKz10aGlzLnN1bUNlbGxTaXplcyh0aGlzLndvdC5nZXRTZXR0aW5nKCJmaXhlZENvbHVtbnNMZWZ0IiksZSksbis9aSx0aGlzLnNldFNjcm9sbFBvc2l0aW9uKG4pfSxnZXRUYWJsZVBhcmVudE9mZnNldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnRyaW1taW5nQ29udGFpbmVyPT09d2luZG93P3RoaXMud290Lnd0VGFibGUuaG9sZGVyT2Zmc2V0LmxlZnQ6MH0sZ2V0U2Nyb2xsUG9zaXRpb246ZnVuY3Rpb24oKXtyZXR1cm4gbCh0aGlzLm1haW5UYWJsZVNjcm9sbGFibGVFbGVtZW50KX0sYWRqdXN0SGVhZGVyQm9yZGVyc1Bvc2l0aW9uOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMud290Lnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUsbj10aGlzLndvdC5nZXRTZXR0aW5nKCJyb3dIZWFkZXJzIiksbz10aGlzLndvdC5nZXRTZXR0aW5nKCJmaXhlZENvbHVtbnNMZWZ0Iik7aWYobyYmIW4ubGVuZ3RoKXModCwiaW5uZXJCb3JkZXJMZWZ0Iik7ZWxzZSBpZighbyYmbi5sZW5ndGgpe3ZhciByPWModCwiaW5uZXJCb3JkZXJMZWZ0Iik7ZT9zKHQsImlubmVyQm9yZGVyTGVmdCIpOmgodCwiaW5uZXJCb3JkZXJMZWZ0IiksKCFyJiZlfHxyJiYhZSkmJnRoaXMud290Lnd0T3ZlcmxheXMuYWRqdXN0RWxlbWVudHNTaXplKCl9fX0se30scCksd2luZG93LldhbGtvbnRhYmxlTGVmdE92ZXJsYXk9ZyxwLnJlZ2lzdGVyT3ZlcmxheShwLkNMT05FX0xFRlQsZyl9LHtfYmFzZToxMSwiaGVscGVycy9kb20vZWxlbWVudCI6NDV9XSwxNDpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtXYWxrb250YWJsZVRvcE92ZXJsYXk6e2dldDpmdW5jdGlvbigpe3JldHVybiBnfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpPShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLHM9aS5hZGRDbGFzcyxhPWkuZ2V0U2Nyb2xsYmFyV2lkdGgsbD1pLmdldFNjcm9sbFRvcCx1PWkuZ2V0V2luZG93U2Nyb2xsTGVmdCxjPWkuaGFzQ2xhc3MsZD1pLm91dGVySGVpZ2h0LGg9aS5yZW1vdmVDbGFzcyxmPWkuc2V0T3ZlcmxheVBvc2l0aW9uLHA9KHI9ZSgiX2Jhc2UiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLldhbGtvbnRhYmxlT3ZlcmxheSxnPWZ1bmN0aW9uKGUpeyR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yKG0pLmNhbGwodGhpcyxlKSx0aGlzLmNsb25lPXRoaXMubWFrZUNsb25lKHAuQ0xPTkVfVE9QKX0sbT1nOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhnLHtzaG91bGRCZVJlbmRlcmVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c1RvcCIpfHx0aGlzLndvdC5nZXRTZXR0aW5nKCJjb2x1bW5IZWFkZXJzIikubGVuZ3RoPyEwOiExfSxyZXNldEZpeGVkUG9zaXRpb246ZnVuY3Rpb24oKXtpZih0aGlzLm5lZWRGdWxsUmVuZGVyJiZ0aGlzLndvdC53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKXt2YXIgZT10aGlzLmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUsdD0wO2lmKHRoaXMud290Lnd0T3ZlcmxheXMubGVmdE92ZXJsYXkudHJpbW1pbmdDb250YWluZXI9PT13aW5kb3cpe3ZhciBuLG8scj10aGlzLndvdC53dFRhYmxlLmhpZGVyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGk9TWF0aC5jZWlsKHIudG9wKSxzPU1hdGguY2VpbChyLmJvdHRvbSk7bj10aGlzLndvdC53dFRhYmxlLmhpZGVyLnN0eWxlLmxlZnQsbj0iIj09PW4/MDpuLG89MD5pJiZzLWUub2Zmc2V0SGVpZ2h0PjA/LWk6MCx0PW8sbys9InB4IixmKGUsbixvKX1lbHNlIHQ9dGhpcy5nZXRTY3JvbGxQb3NpdGlvbigpO3RoaXMuYWRqdXN0SGVhZGVyQm9yZGVyc1Bvc2l0aW9uKHQpLHRoaXMuYWRqdXN0RWxlbWVudHNTaXplKCl9fSxzZXRTY3JvbGxQb3NpdGlvbjpmdW5jdGlvbihlKXt0aGlzLm1haW5UYWJsZVNjcm9sbGFibGVFbGVtZW50PT09d2luZG93P3dpbmRvdy5zY3JvbGxUbyh1KCksZSk6dGhpcy5tYWluVGFibGVTY3JvbGxhYmxlRWxlbWVudC5zY3JvbGxUb3A9ZX0sb25TY3JvbGw6ZnVuY3Rpb24oKXt0aGlzLndvdC5nZXRTZXR0aW5nKCJvblNjcm9sbFZlcnRpY2FsbHkiKX0sc3VtQ2VsbFNpemVzOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPTAsbz10aGlzLndvdC53dFNldHRpbmdzLnNldHRpbmdzLmRlZmF1bHRSb3dIZWlnaHQ7dD5lOyl7dmFyIHI9dGhpcy53b3Qud3RUYWJsZS5nZXRSb3dIZWlnaHQoZSk7bis9dm9pZCAwPT09cj9vOnIsZSsrfXJldHVybiBufSxhZGp1c3RFbGVtZW50c1NpemU6ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiExOyh0aGlzLm5lZWRGdWxsUmVuZGVyfHxlKSYmKHRoaXMuYWRqdXN0Um9vdEVsZW1lbnRTaXplKCksdGhpcy5hZGp1c3RSb290Q2hpbGRyZW5TaXplKCksZXx8KHRoaXMuYXJlRWxlbWVudFNpemVzQWRqdXN0ZWQ9ITApKX0sYWRqdXN0Um9vdEVsZW1lbnRTaXplOmZ1bmN0aW9uKCl7dmFyIGUsdD10aGlzLndvdC53dFRhYmxlLmhvbGRlcixuPXQuY2xpZW50V2lkdGg9PT10Lm9mZnNldFdpZHRoPzA6YSgpLG89dGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlLHI9by5zdHlsZTt0aGlzLnRyaW1taW5nQ29udGFpbmVyIT09d2luZG93JiYoci53aWR0aD10aGlzLndvdC53dFZpZXdwb3J0LmdldFdvcmtzcGFjZVdpZHRoKCktbisicHgiKSx0aGlzLmNsb25lLnd0VGFibGUuaG9sZGVyLnN0eWxlLndpZHRoPXIud2lkdGgsZT1kKHRoaXMuY2xvbmUud3RUYWJsZS5UQUJMRSksci5oZWlnaHQ9KDA9PT1lP2U6ZSs0KSsicHgifSxhZGp1c3RSb290Q2hpbGRyZW5TaXplOmZ1bmN0aW9uKCl7dmFyIGU9YSgpO3RoaXMuY2xvbmUud3RUYWJsZS5oaWRlci5zdHlsZS53aWR0aD10aGlzLmhpZGVyLnN0eWxlLndpZHRoLHRoaXMuY2xvbmUud3RUYWJsZS5ob2xkZXIuc3R5bGUud2lkdGg9dGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlLnN0eWxlLndpZHRoLDA9PT1lJiYoZT0zMCksdGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5zdHlsZS5oZWlnaHQ9cGFyc2VJbnQodGhpcy5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlLnN0eWxlLmhlaWdodCwxMCkrZSsicHgifSxhcHBseVRvRE9NOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy53b3QuZ2V0U2V0dGluZygidG90YWxSb3dzIik7aWYodGhpcy5hcmVFbGVtZW50U2l6ZXNBZGp1c3RlZHx8dGhpcy5hZGp1c3RFbGVtZW50c1NpemUoKSwibnVtYmVyIj09dHlwZW9mIHRoaXMud290Lnd0Vmlld3BvcnQucm93c1JlbmRlckNhbGN1bGF0b3Iuc3RhcnRQb3NpdGlvbil0aGlzLnNwcmVhZGVyLnN0eWxlLnRvcD10aGlzLndvdC53dFZpZXdwb3J0LnJvd3NSZW5kZXJDYWxjdWxhdG9yLnN0YXJ0UG9zaXRpb24rInB4IjtlbHNle2lmKDAhPT1lKXRocm93IG5ldyBFcnJvcigiSW5jb3JyZWN0IHZhbHVlIG9mIHRoZSByb3dzUmVuZGVyQ2FsY3VsYXRvciIpO3RoaXMuc3ByZWFkZXIuc3R5bGUudG9wPSIwIn10aGlzLnNwcmVhZGVyLnN0eWxlLmJvdHRvbT0iIix0aGlzLm5lZWRGdWxsUmVuZGVyJiZ0aGlzLnN5bmNPdmVybGF5T2Zmc2V0KCl9LHN5bmNPdmVybGF5T2Zmc2V0OmZ1bmN0aW9uKCl7Im51bWJlciI9PXR5cGVvZiB0aGlzLndvdC53dFZpZXdwb3J0LmNvbHVtbnNSZW5kZXJDYWxjdWxhdG9yLnN0YXJ0UG9zaXRpb24/dGhpcy5jbG9uZS53dFRhYmxlLnNwcmVhZGVyLnN0eWxlLmxlZnQ9dGhpcy53b3Qud3RWaWV3cG9ydC5jb2x1bW5zUmVuZGVyQ2FsY3VsYXRvci5zdGFydFBvc2l0aW9uKyJweCI6dGhpcy5jbG9uZS53dFRhYmxlLnNwcmVhZGVyLnN0eWxlLmxlZnQ9IiJ9LHNjcm9sbFRvOmZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpcy5nZXRUYWJsZVBhcmVudE9mZnNldCgpLG89dGhpcy53b3QuY2xvbmVTb3VyY2U/dGhpcy53b3QuY2xvbmVTb3VyY2U6dGhpcy53b3Qscj1vLnd0VGFibGUuaG9sZGVyLGk9MDtpZih0JiZyLm9mZnNldEhlaWdodCE9PXIuY2xpZW50SGVpZ2h0JiYoaT1hKCkpLHQpe3ZhciBzPXRoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c0JvdHRvbSIpLGw9KHRoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c1RvcCIpLHRoaXMud290LmdldFNldHRpbmcoInRvdGFsUm93cyIpKTtuKz10aGlzLnN1bUNlbGxTaXplcygwLGUrMSksbi09dGhpcy53b3Qud3RWaWV3cG9ydC5nZXRWaWV3cG9ydEhlaWdodCgpLXRoaXMuc3VtQ2VsbFNpemVzKGwtcyxsKSxuKz0xfWVsc2Ugbis9dGhpcy5zdW1DZWxsU2l6ZXModGhpcy53b3QuZ2V0U2V0dGluZygiZml4ZWRSb3dzVG9wIiksZSk7bis9aSx0aGlzLnNldFNjcm9sbFBvc2l0aW9uKG4pfSxnZXRUYWJsZVBhcmVudE9mZnNldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLm1haW5UYWJsZVNjcm9sbGFibGVFbGVtZW50PT09d2luZG93P3RoaXMud290Lnd0VGFibGUuaG9sZGVyT2Zmc2V0LnRvcDowfSxnZXRTY3JvbGxQb3NpdGlvbjpmdW5jdGlvbigpe3JldHVybiBsKHRoaXMubWFpblRhYmxlU2Nyb2xsYWJsZUVsZW1lbnQpfSxhZGp1c3RIZWFkZXJCb3JkZXJzUG9zaXRpb246ZnVuY3Rpb24oZSl7aWYoMD09PXRoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c1RvcCIpJiZ0aGlzLndvdC5nZXRTZXR0aW5nKCJjb2x1bW5IZWFkZXJzIikubGVuZ3RoPjApe3ZhciB0PXRoaXMud290Lnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUsbj1jKHQsImlubmVyQm9yZGVyVG9wIik7ZT9zKHQsImlubmVyQm9yZGVyVG9wIik6aCh0LCJpbm5lckJvcmRlclRvcCIpLCghbiYmZXx8biYmIWUpJiZ0aGlzLndvdC53dE92ZXJsYXlzLmFkanVzdEVsZW1lbnRzU2l6ZSgpfWlmKDA9PT10aGlzLndvdC5nZXRTZXR0aW5nKCJyb3dIZWFkZXJzIikubGVuZ3RoKXt2YXIgbz10aGlzLmNsb25lLnd0VGFibGUuVEhFQUQucXVlcnlTZWxlY3RvckFsbCgidGg6bnRoLW9mLXR5cGUoMikiKTtpZihvKWZvcih2YXIgcj0wO3I8by5sZW5ndGg7cisrKW9bcl0uc3R5bGVbImJvcmRlci1sZWZ0LXdpZHRoIl09MH19fSx7fSxwKSx3aW5kb3cuV2Fsa29udGFibGVUb3BPdmVybGF5PWcscC5yZWdpc3Rlck92ZXJsYXkocC5DTE9ORV9UT1AsZyl9LHtfYmFzZToxMSwiaGVscGVycy9kb20vZWxlbWVudCI6NDV9XSwxNTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtXYWxrb250YWJsZVRvcExlZnRDb3JuZXJPdmVybGF5OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gY319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaT0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxzPWkub3V0ZXJIZWlnaHQsYT1pLm91dGVyV2lkdGgsbD1pLnNldE92ZXJsYXlQb3NpdGlvbix1PShyPWUoIl9iYXNlIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5XYWxrb250YWJsZU92ZXJsYXksYz1mdW5jdGlvbihlKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJDb25zdHJ1Y3RvcihkKS5jYWxsKHRoaXMsZSksdGhpcy5jbG9uZT10aGlzLm1ha2VDbG9uZSh1LkNMT05FX1RPUF9MRUZUX0NPUk5FUil9LGQ9YzskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoYyx7c2hvdWxkQmVSZW5kZXJlZDpmdW5jdGlvbigpe3JldHVybih0aGlzLndvdC5nZXRTZXR0aW5nKCJmaXhlZFJvd3NUb3AiKXx8dGhpcy53b3QuZ2V0U2V0dGluZygiY29sdW1uSGVhZGVycyIpLmxlbmd0aCkmJih0aGlzLndvdC5nZXRTZXR0aW5nKCJmaXhlZENvbHVtbnNMZWZ0Iil8fHRoaXMud290LmdldFNldHRpbmcoInJvd0hlYWRlcnMiKS5sZW5ndGgpPyEwOiExfSxyZXNldEZpeGVkUG9zaXRpb246ZnVuY3Rpb24oKXtpZih0aGlzLndvdC53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKXt2YXIgZT10aGlzLmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUsdD1zKHRoaXMuY2xvbmUud3RUYWJsZS5UQUJMRSksbj1hKHRoaXMuY2xvbmUud3RUYWJsZS5UQUJMRSk7aWYodGhpcy50cmltbWluZ0NvbnRhaW5lcj09PXdpbmRvdyl7dmFyIG8scixpPXRoaXMud290Lnd0VGFibGUuaGlkZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksdT1NYXRoLmNlaWwoaS50b3ApLGM9TWF0aC5jZWlsKGkubGVmdCksZD1NYXRoLmNlaWwoaS5ib3R0b20pLGg9TWF0aC5jZWlsKGkucmlnaHQpO289MD5jJiZoLWUub2Zmc2V0V2lkdGg+MD8tYysicHgiOiIwIixyPTA+dSYmZC1lLm9mZnNldEhlaWdodD4wPy11KyJweCI6IjAiLGwoZSxvLHIpfWUuc3R5bGUuaGVpZ2h0PSgwPT09dD90OnQrNCkrInB4IixlLnN0eWxlLndpZHRoPSgwPT09bj9uOm4rNCkrInB4In19fSx7fSx1KSx3aW5kb3cuV2Fsa29udGFibGVUb3BMZWZ0Q29ybmVyT3ZlcmxheT1jLHUucmVnaXN0ZXJPdmVybGF5KHUuQ0xPTkVfVE9QX0xFRlRfQ09STkVSLGMpfSx7X2Jhc2U6MTEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1fV0sMTY6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVPdmVybGF5czp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGZ9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscz0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxhPXMuZ2V0U2Nyb2xsYWJsZUVsZW1lbnQsbD1zLmdldFNjcm9sbGJhcldpZHRoLHU9cy5nZXRTY3JvbGxMZWZ0LGM9cy5nZXRTY3JvbGxUb3AsZD0ocj1lKCJoZWxwZXJzL3VuaWNvZGUiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLmlzS2V5LGg9KGk9ZSgiZXZlbnRNYW5hZ2VyIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5FdmVudE1hbmFnZXIsZj1mdW5jdGlvbihlKXt0aGlzLndvdD1lLHRoaXMuaW5zdGFuY2U9dGhpcy53b3QsdGhpcy5ldmVudE1hbmFnZXI9bmV3IGgodGhpcy53b3QpLHRoaXMud290LnVwZGF0ZSgic2Nyb2xsYmFyV2lkdGgiLGwoKSksdGhpcy53b3QudXBkYXRlKCJzY3JvbGxiYXJIZWlnaHQiLGwoKSksdGhpcy5tYWluVGFibGVTY3JvbGxhYmxlRWxlbWVudD1hKHRoaXMud290Lnd0VGFibGUuVEFCTEUpLHRoaXMudG9wT3ZlcmxheT1XYWxrb250YWJsZU92ZXJsYXkuY3JlYXRlT3ZlcmxheShXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfVE9QLHRoaXMud290KSwidW5kZWZpbmVkIj09dHlwZW9mIFdhbGtvbnRhYmxlQm90dG9tT3ZlcmxheT90aGlzLmJvdHRvbU92ZXJsYXk9e25lZWRGdWxsUmVuZGVyOiExfTp0aGlzLmJvdHRvbU92ZXJsYXk9V2Fsa29udGFibGVPdmVybGF5LmNyZWF0ZU92ZXJsYXkoV2Fsa29udGFibGVPdmVybGF5LkNMT05FX0JPVFRPTSx0aGlzLndvdCksdGhpcy5sZWZ0T3ZlcmxheT1XYWxrb250YWJsZU92ZXJsYXkuY3JlYXRlT3ZlcmxheShXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfTEVGVCx0aGlzLndvdCksdGhpcy50b3BPdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiZ0aGlzLmxlZnRPdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiYodGhpcy50b3BMZWZ0Q29ybmVyT3ZlcmxheT1XYWxrb250YWJsZU92ZXJsYXkuY3JlYXRlT3ZlcmxheShXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfVE9QX0xFRlRfQ09STkVSLHRoaXMud290KSksdGhpcy5ib3R0b21PdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiZ0aGlzLmxlZnRPdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiYidW5kZWZpbmVkIiE9dHlwZW9mIFdhbGtvbnRhYmxlQm90dG9tTGVmdENvcm5lck92ZXJsYXk/dGhpcy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheT1XYWxrb250YWJsZU92ZXJsYXkuY3JlYXRlT3ZlcmxheShXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfQk9UVE9NX0xFRlRfQ09STkVSLHRoaXMud290KTp0aGlzLmJvdHRvbUxlZnRDb3JuZXJPdmVybGF5PXtuZWVkRnVsbFJlbmRlcjohMX0sdGhpcy53b3QuZ2V0U2V0dGluZygiZGVidWciKSYmKHRoaXMuZGVidWc9V2Fsa29udGFibGVPdmVybGF5LmNyZWF0ZU92ZXJsYXkoV2Fsa29udGFibGVPdmVybGF5LkNMT05FX0RFQlVHLHRoaXMud290KSksdGhpcy5kZXN0cm95ZWQ9ITEsdGhpcy5rZXlQcmVzc2VkPSExLHRoaXMuc3ByZWFkZXJMYXN0U2l6ZT17d2lkdGg6bnVsbCxoZWlnaHQ6bnVsbH0sdGhpcy5vdmVybGF5U2Nyb2xsUG9zaXRpb25zPXttYXN0ZXI6e3RvcDowLGxlZnQ6MH0sdG9wOnt0b3A6bnVsbCxsZWZ0OjB9LGJvdHRvbTp7dG9wOm51bGwsbGVmdDowfSxsZWZ0Ont0b3A6MCxsZWZ0Om51bGx9fSx0aGlzLnJlZ2lzdGVyTGlzdGVuZXJzKCl9OyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhmLHtyZWZyZXNoQWxsOmZ1bmN0aW9uKCl7aWYodGhpcy53b3QuZHJhd24pe2lmKCF0aGlzLndvdC53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKXJldHVybiB2b2lkIHRoaXMuZGVzdHJveSgpO3RoaXMud290LmRyYXcoITApLHRoaXMudG9wT3ZlcmxheS5vblNjcm9sbCgpLHRoaXMubGVmdE92ZXJsYXkub25TY3JvbGwoKX19LHJlZ2lzdGVyTGlzdGVuZXJzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwia2V5ZG93biIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25LZXlEb3duKHQpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsImtleXVwIixmdW5jdGlvbigpe3JldHVybiBlLm9uS2V5VXAoKX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQsInZpc2liaWxpdHljaGFuZ2UiLGZ1bmN0aW9uKCl7cmV0dXJuIGUub25LZXlVcCgpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLm1haW5UYWJsZVNjcm9sbGFibGVFbGVtZW50LCJzY3JvbGwiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uVGFibGVTY3JvbGwodCl9KSx0aGlzLnRvcE92ZXJsYXkubmVlZEZ1bGxSZW5kZXImJih0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHRoaXMudG9wT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlciwic2Nyb2xsIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vblRhYmxlU2Nyb2xsKHQpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnRvcE92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIsIndoZWVsIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vblRhYmxlU2Nyb2xsKHQpfSkpLHRoaXMuYm90dG9tT3ZlcmxheS5uZWVkRnVsbFJlbmRlciYmKHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ib3R0b21PdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLCJzY3JvbGwiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uVGFibGVTY3JvbGwodCl9KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuYm90dG9tT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlciwid2hlZWwiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uVGFibGVTY3JvbGwodCl9KSksdGhpcy5sZWZ0T3ZlcmxheS5uZWVkRnVsbFJlbmRlciYmKHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5sZWZ0T3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlciwic2Nyb2xsIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vblRhYmxlU2Nyb2xsKHQpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmxlZnRPdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLCJ3aGVlbCIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25UYWJsZVNjcm9sbCh0KX0pKSx0aGlzLnRvcE92ZXJsYXkudHJpbW1pbmdDb250YWluZXIhPT13aW5kb3cmJnRoaXMubGVmdE92ZXJsYXkudHJpbW1pbmdDb250YWluZXIhPT13aW5kb3cmJnRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIod2luZG93LCJ3aGVlbCIsZnVuY3Rpb24odCl7dmFyIG4sbz10LndoZWVsRGVsdGFZfHx0LmRlbHRhWSxyPXQud2hlZWxEZWx0YVh8fHQuZGVsdGFYO2UudG9wT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlci5jb250YWlucyh0LnJlYWxUYXJnZXQpP249InRvcCI6ZS5ib3R0b21PdmVybGF5LmNsb25lJiZlLmJvdHRvbU92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIuY29udGFpbnModC5yZWFsVGFyZ2V0KT9uPSJib3R0b20iOmUubGVmdE92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIuY29udGFpbnModC5yZWFsVGFyZ2V0KSYmKG49ImxlZnQiKSwidG9wIj09biYmMCE9PW8/dC5wcmV2ZW50RGVmYXVsdCgpOiJsZWZ0Ij09biYmMCE9PXI/dC5wcmV2ZW50RGVmYXVsdCgpOiJib3R0b20iPT1uJiYwIT09byYmdC5wcmV2ZW50RGVmYXVsdCgpfSl9LG9uVGFibGVTY3JvbGw6ZnVuY3Rpb24oZSl7SGFuZHNvbnRhYmxlLm1vYmlsZUJyb3dzZXJ8fCghdGhpcy5rZXlQcmVzc2VkfHx0aGlzLm1haW5UYWJsZVNjcm9sbGFibGVFbGVtZW50PT09d2luZG93fHxlLnRhcmdldC5jb250YWlucyh0aGlzLm1haW5UYWJsZVNjcm9sbGFibGVFbGVtZW50KSkmJigic2Nyb2xsIj09PWUudHlwZT90aGlzLnN5bmNTY3JvbGxQb3NpdGlvbnMoZSk6dGhpcy50cmFuc2xhdGVNb3VzZVdoZWVsVG9TY3JvbGwoZSkpfSxvbktleURvd246ZnVuY3Rpb24oZSl7dGhpcy5rZXlQcmVzc2VkPWQoZS5rZXlDb2RlLCJBUlJPV19VUHxBUlJPV19SSUdIVHxBUlJPV19ET1dOfEFSUk9XX0xFRlQiKX0sb25LZXlVcDpmdW5jdGlvbigpe3RoaXMua2V5UHJlc3NlZD0hMX0sdHJhbnNsYXRlTW91c2VXaGVlbFRvU2Nyb2xsOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxuPXRoaXMudG9wT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlcixvPXRoaXMuYm90dG9tT3ZlcmxheS5jbG9uZT90aGlzLmJvdHRvbU92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXI6bnVsbCxyPXRoaXMubGVmdE92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIsaT17dHlwZToid2hlZWwifSxzPWUudGFyZ2V0LGE9ZS53aGVlbERlbHRhWXx8LTEqZS5kZWx0YVksbD1lLndoZWVsRGVsdGFYfHwtMSplLmRlbHRhWDtzIT1kb2N1bWVudCYmbnVsbCE9czspe2lmKHMuY2xhc3NOYW1lLmluZGV4T2YoInd0SG9sZGVyIik+LTEpe3Q9czticmVha31zPXMucGFyZW50Tm9kZX1yZXR1cm4gaS50YXJnZXQ9dCx0PT1uP3RoaXMuc3luY1Njcm9sbFBvc2l0aW9ucyhpLC0uMiphKTp0PT1vP3RoaXMuc3luY1Njcm9sbFBvc2l0aW9ucyhpLC0uMiphKTp0PT1yJiZ0aGlzLnN5bmNTY3JvbGxQb3NpdGlvbnMoaSwtLjIqbCksITF9LHN5bmNTY3JvbGxQb3NpdGlvbnM6ZnVuY3Rpb24oZSl7dmFyIHQ9dm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpudWxsO2lmKCF0aGlzLmRlc3Ryb3llZCl7aWYoMD09PWFyZ3VtZW50cy5sZW5ndGgpcmV0dXJuIHZvaWQgdGhpcy5zeW5jU2Nyb2xsV2l0aE1hc3RlcigpO3ZhciBuLG8scixpPXRoaXMubWFpblRhYmxlU2Nyb2xsYWJsZUVsZW1lbnQscz1lLnRhcmdldCxhPTAsbD0hMTt0aGlzLnRvcE92ZXJsYXkubmVlZEZ1bGxSZW5kZXImJihuPXRoaXMudG9wT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlciksdGhpcy5ib3R0b21PdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiYocj10aGlzLmJvdHRvbU92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIpLHRoaXMubGVmdE92ZXJsYXkubmVlZEZ1bGxSZW5kZXImJihvPXRoaXMubGVmdE92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIpLHM9PT1kb2N1bWVudCYmKHM9d2luZG93KSxzPT09aT8oYT11KHMpLHRoaXMub3ZlcmxheVNjcm9sbFBvc2l0aW9ucy5tYXN0ZXIubGVmdCE9PWEmJih0aGlzLm92ZXJsYXlTY3JvbGxQb3NpdGlvbnMubWFzdGVyLmxlZnQ9YSxsPSEwLG4mJihuLnNjcm9sbExlZnQ9YSksciYmKHIuc2Nyb2xsTGVmdD1hKSksYT1jKHMpLHRoaXMub3ZlcmxheVNjcm9sbFBvc2l0aW9ucy5tYXN0ZXIudG9wIT09YSYmKHRoaXMub3ZlcmxheVNjcm9sbFBvc2l0aW9ucy5tYXN0ZXIudG9wPWEsbD0hMCxvJiYoby5zY3JvbGxUb3A9YSkpKTpzPT09cj8oYT11KHMpLHRoaXMub3ZlcmxheVNjcm9sbFBvc2l0aW9ucy5ib3R0b20ubGVmdCE9PWEmJih0aGlzLm92ZXJsYXlTY3JvbGxQb3NpdGlvbnMuYm90dG9tLmxlZnQ9YSxsPSEwLGkuc2Nyb2xsTGVmdD1hKSxudWxsIT09dCYmKGw9ITAsaS5zY3JvbGxUb3ArPXQpKTpzPT09bj8oYT11KHMpLHRoaXMub3ZlcmxheVNjcm9sbFBvc2l0aW9ucy50b3AubGVmdCE9PWEmJih0aGlzLm92ZXJsYXlTY3JvbGxQb3NpdGlvbnMudG9wLmxlZnQ9YSxsPSEwLGkuc2Nyb2xsTGVmdD1hKSxudWxsIT09dCYmKGw9ITAsaS5zY3JvbGxUb3ArPXQpKTpzPT09byYmKGE9YyhzKSx0aGlzLm92ZXJsYXlTY3JvbGxQb3NpdGlvbnMubGVmdC50b3AhPT1hJiYodGhpcy5vdmVybGF5U2Nyb2xsUG9zaXRpb25zLmxlZnQudG9wPWEsbD0hMCxpLnNjcm9sbFRvcD1hKSxudWxsIT09dCYmKGw9ITAsaS5zY3JvbGxMZWZ0Kz10KSksIXRoaXMua2V5UHJlc3NlZCYmbCYmInNjcm9sbCI9PT1lLnR5cGUmJnRoaXMucmVmcmVzaEFsbCgpfX0sc3luY1Njcm9sbFdpdGhNYXN0ZXI6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLnRvcE92ZXJsYXkubWFpblRhYmxlU2Nyb2xsYWJsZUVsZW1lbnQ7dGhpcy50b3BPdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiYodGhpcy50b3BPdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLnNjcm9sbExlZnQ9ZS5zY3JvbGxMZWZ0KSx0aGlzLmxlZnRPdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiYodGhpcy5sZWZ0T3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlci5zY3JvbGxUb3A9ZS5zY3JvbGxUb3ApfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5ldmVudE1hbmFnZXIuZGVzdHJveSgpLHRoaXMudG9wT3ZlcmxheS5kZXN0cm95KCksdGhpcy5ib3R0b21PdmVybGF5LmNsb25lJiZ0aGlzLmJvdHRvbU92ZXJsYXkuZGVzdHJveSgpLHRoaXMubGVmdE92ZXJsYXkuZGVzdHJveSgpLHRoaXMudG9wTGVmdENvcm5lck92ZXJsYXkmJnRoaXMudG9wTGVmdENvcm5lck92ZXJsYXkuZGVzdHJveSgpLHRoaXMuYm90dG9tTGVmdENvcm5lck92ZXJsYXkmJnRoaXMuYm90dG9tTGVmdENvcm5lck92ZXJsYXkuY2xvbmUmJnRoaXMuYm90dG9tTGVmdENvcm5lck92ZXJsYXkuZGVzdHJveSgpLHRoaXMuZGVidWcmJnRoaXMuZGVidWcuZGVzdHJveSgpLHRoaXMuZGVzdHJveWVkPSEwfSxyZWZyZXNoOmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTohMTtpZih0aGlzLnRvcE92ZXJsYXkuYXJlRWxlbWVudFNpemVzQWRqdXN0ZWQmJnRoaXMubGVmdE92ZXJsYXkuYXJlRWxlbWVudFNpemVzQWRqdXN0ZWQpe3ZhciB0PXRoaXMud290Lnd0VGFibGUud3RSb290RWxlbWVudC5wYXJlbnROb2RlfHx0aGlzLndvdC53dFRhYmxlLnd0Um9vdEVsZW1lbnQsbj10LmNsaWVudFdpZHRoLG89dC5jbGllbnRIZWlnaHQ7KG4hPT10aGlzLnNwcmVhZGVyTGFzdFNpemUud2lkdGh8fG8hPT10aGlzLnNwcmVhZGVyTGFzdFNpemUuaGVpZ2h0KSYmKHRoaXMuc3ByZWFkZXJMYXN0U2l6ZS53aWR0aD1uLHRoaXMuc3ByZWFkZXJMYXN0U2l6ZS5oZWlnaHQ9byx0aGlzLmFkanVzdEVsZW1lbnRzU2l6ZSgpKX10aGlzLmJvdHRvbU92ZXJsYXkuY2xvbmUmJnRoaXMuYm90dG9tT3ZlcmxheS5yZWZyZXNoKGUpLHRoaXMubGVmdE92ZXJsYXkucmVmcmVzaChlKSx0aGlzLnRvcE92ZXJsYXkucmVmcmVzaChlKSx0aGlzLnRvcExlZnRDb3JuZXJPdmVybGF5JiZ0aGlzLnRvcExlZnRDb3JuZXJPdmVybGF5LnJlZnJlc2goZSksdGhpcy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheSYmdGhpcy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheS5jbG9uZSYmdGhpcy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheS5yZWZyZXNoKGUpLHRoaXMuZGVidWcmJnRoaXMuZGVidWcucmVmcmVzaChlKX0sYWRqdXN0RWxlbWVudHNTaXplOmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTohMSx0PXRoaXMud290LmdldFNldHRpbmcoInRvdGFsQ29sdW1ucyIpLG49dGhpcy53b3QuZ2V0U2V0dGluZygidG90YWxSb3dzIiksbz10aGlzLndvdC53dFZpZXdwb3J0LmdldFJvd0hlYWRlcldpZHRoKCkscj10aGlzLndvdC53dFZpZXdwb3J0LmdldENvbHVtbkhlYWRlckhlaWdodCgpLGk9dGhpcy53b3Qud3RUYWJsZS5oaWRlci5zdHlsZTtpLndpZHRoPW8rdGhpcy5sZWZ0T3ZlcmxheS5zdW1DZWxsU2l6ZXMoMCx0KSsicHgiLGkuaGVpZ2h0PXIrdGhpcy50b3BPdmVybGF5LnN1bUNlbGxTaXplcygwLG4pKzErInB4Iix0aGlzLnRvcE92ZXJsYXkuYWRqdXN0RWxlbWVudHNTaXplKGUpLHRoaXMubGVmdE92ZXJsYXkuYWRqdXN0RWxlbWVudHNTaXplKGUpLHRoaXMuYm90dG9tT3ZlcmxheS5jbG9uZSYmdGhpcy5ib3R0b21PdmVybGF5LmFkanVzdEVsZW1lbnRzU2l6ZShlKX0sYXBwbHlUb0RPTTpmdW5jdGlvbigpe3RoaXMudG9wT3ZlcmxheS5hcmVFbGVtZW50U2l6ZXNBZGp1c3RlZCYmdGhpcy5sZWZ0T3ZlcmxheS5hcmVFbGVtZW50U2l6ZXNBZGp1c3RlZHx8dGhpcy5hZGp1c3RFbGVtZW50c1NpemUoKSx0aGlzLnRvcE92ZXJsYXkuYXBwbHlUb0RPTSgpLHRoaXMuYm90dG9tT3ZlcmxheS5jbG9uZSYmdGhpcy5ib3R0b21PdmVybGF5LmFwcGx5VG9ET00oKSx0aGlzLmxlZnRPdmVybGF5LmFwcGx5VG9ET00oKX19LHt9KSx3aW5kb3cuV2Fsa29udGFibGVPdmVybGF5cz1mfSx7ZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy91bmljb2RlIjo1M31dLDE3OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlU2Nyb2xsOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvPWZ1bmN0aW9uKGUpe3RoaXMud290PWUsdGhpcy5pbnN0YW5jZT1lfTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3Mobyx7c2Nyb2xsVmlld3BvcnQ6ZnVuY3Rpb24oZSl7aWYodGhpcy53b3QuZHJhd24pe3ZhciB0PXRoaXMud290LmdldFNldHRpbmcoInRvdGFsUm93cyIpLG49dGhpcy53b3QuZ2V0U2V0dGluZygidG90YWxDb2x1bW5zIiksbz10aGlzLmluc3RhbmNlLmdldFNldHRpbmcoImZpeGVkUm93c1RvcCIpLHI9dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5nKCJmaXhlZFJvd3NCb3R0b20iKSxpPXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZygiZml4ZWRDb2x1bW5zTGVmdCIpO2lmKGUucm93PDB8fGUucm93PnQtMSl0aHJvdyBuZXcgRXJyb3IoInJvdyAiK2Uucm93KyIgZG9lcyBub3QgZXhpc3QiKTtpZihlLmNvbDwwfHxlLmNvbD5uLTEpdGhyb3cgbmV3IEVycm9yKCJjb2x1bW4gIitlLmNvbCsiIGRvZXMgbm90IGV4aXN0Iik7ZS5yb3c+dGhpcy5pbnN0YW5jZS53dFRhYmxlLmdldExhc3RWaXNpYmxlUm93KCkmJmUucm93PHQtcj90aGlzLndvdC53dE92ZXJsYXlzLnRvcE92ZXJsYXkuc2Nyb2xsVG8oZS5yb3csITApOmUucm93Pj1vJiZlLnJvdzx0aGlzLmluc3RhbmNlLnd0VGFibGUuZ2V0Rmlyc3RWaXNpYmxlUm93KCkmJnRoaXMud290Lnd0T3ZlcmxheXMudG9wT3ZlcmxheS5zY3JvbGxUbyhlLnJvdyksZS5jb2w+dGhpcy5pbnN0YW5jZS53dFRhYmxlLmdldExhc3RWaXNpYmxlQ29sdW1uKCk/dGhpcy53b3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5zY3JvbGxUbyhlLmNvbCwhMCk6ZS5jb2w+PWkmJmUuY29sPHRoaXMuaW5zdGFuY2Uud3RUYWJsZS5nZXRGaXJzdFZpc2libGVDb2x1bW4oKSYmdGhpcy53b3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5zY3JvbGxUbyhlLmNvbCl9fX0se30pLHdpbmRvdy5XYWxrb250YWJsZVNjcm9sbD1vfSx7fV0sMTg6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVTZWxlY3Rpb246e2dldDpmdW5jdGlvbigpe3JldHVybiBkfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpLHMsYT0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KS5hZGRDbGFzcyxsPShyPWUoImJvcmRlciIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuV2Fsa29udGFibGVCb3JkZXIsdT0oaT1lKCJjZWxsL2Nvb3JkcyIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuV2Fsa29udGFibGVDZWxsQ29vcmRzLGM9KHM9ZSgiY2VsbC9yYW5nZSIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkuV2Fsa29udGFibGVDZWxsUmFuZ2UsZD1mdW5jdGlvbihlLHQpe3RoaXMuc2V0dGluZ3M9ZSx0aGlzLmNlbGxSYW5nZT10fHxudWxsLHRoaXMuaW5zdGFuY2VCb3JkZXJzPXt9fTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoZCx7Z2V0Qm9yZGVyOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmluc3RhbmNlQm9yZGVyc1tlLmd1aWRdP3RoaXMuaW5zdGFuY2VCb3JkZXJzW2UuZ3VpZF06dm9pZCh0aGlzLmluc3RhbmNlQm9yZGVyc1tlLmd1aWRdPW5ldyBsKGUsdGhpcy5zZXR0aW5ncykpfSxpc0VtcHR5OmZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PT10aGlzLmNlbGxSYW5nZX0sYWRkOmZ1bmN0aW9uKGUpe3RoaXMuaXNFbXB0eSgpP3RoaXMuY2VsbFJhbmdlPW5ldyBjKGUsZSxlKTp0aGlzLmNlbGxSYW5nZS5leHBhbmQoZSl9LHJlcGxhY2U6ZnVuY3Rpb24oZSx0KXtpZighdGhpcy5pc0VtcHR5KCkpe2lmKHRoaXMuY2VsbFJhbmdlLmZyb20uaXNFcXVhbChlKSlyZXR1cm4gdGhpcy5jZWxsUmFuZ2UuZnJvbT10LCEwO2lmKHRoaXMuY2VsbFJhbmdlLnRvLmlzRXF1YWwoZSkpcmV0dXJuIHRoaXMuY2VsbFJhbmdlLnRvPXQsITB9cmV0dXJuITF9LGNsZWFyOmZ1bmN0aW9uKCl7dGhpcy5jZWxsUmFuZ2U9bnVsbH0sZ2V0Q29ybmVyczpmdW5jdGlvbigpe3ZhciBlPXRoaXMuY2VsbFJhbmdlLmdldFRvcExlZnRDb3JuZXIoKSx0PXRoaXMuY2VsbFJhbmdlLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCk7cmV0dXJuW2Uucm93LGUuY29sLHQucm93LHQuY29sXX0sYWRkQ2xhc3NBdENvb3JkczpmdW5jdGlvbihlLHQsbixvKXt2YXIgcj1lLnd0VGFibGUuZ2V0Q2VsbChuZXcgdSh0LG4pKTsib2JqZWN0Ij09dHlwZW9mIHImJmEocixvKX0sZHJhdzpmdW5jdGlvbihlKXtpZih0aGlzLmlzRW1wdHkoKSl7aWYodGhpcy5zZXR0aW5ncy5ib3JkZXIpe3ZhciB0PXRoaXMuZ2V0Qm9yZGVyKGUpO3QmJnQuZGlzYXBwZWFyKCl9fWVsc2V7Zm9yKHZhciBuLG8scixpPWUud3RUYWJsZS5nZXRSZW5kZXJlZFJvd3NDb3VudCgpLHM9ZS53dFRhYmxlLmdldFJlbmRlcmVkQ29sdW1uc0NvdW50KCksbD10aGlzLmdldENvcm5lcnMoKSx1PTA7cz51O3UrKylvPWUud3RUYWJsZS5jb2x1bW5GaWx0ZXIucmVuZGVyZWRUb1NvdXJjZSh1KSxvPj1sWzFdJiZvPD1sWzNdJiYocj1lLnd0VGFibGUuZ2V0Q29sdW1uSGVhZGVyKG8pLHImJnRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0Q29sdW1uQ2xhc3NOYW1lJiZhKHIsdGhpcy5zZXR0aW5ncy5oaWdobGlnaHRDb2x1bW5DbGFzc05hbWUpKTtmb3IodmFyIGM9MDtpPmM7YysrKXtuPWUud3RUYWJsZS5yb3dGaWx0ZXIucmVuZGVyZWRUb1NvdXJjZShjKSxuPj1sWzBdJiZuPD1sWzJdJiYocj1lLnd0VGFibGUuZ2V0Um93SGVhZGVyKG4pLHImJnRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0Um93Q2xhc3NOYW1lJiZhKHIsdGhpcy5zZXR0aW5ncy5oaWdobGlnaHRSb3dDbGFzc05hbWUpKTtmb3IodmFyIGQ9MDtzPmQ7ZCsrKW89ZS53dFRhYmxlLmNvbHVtbkZpbHRlci5yZW5kZXJlZFRvU291cmNlKGQpLG4+PWxbMF0mJm48PWxbMl0mJm8+PWxbMV0mJm88PWxbM10/dGhpcy5zZXR0aW5ncy5jbGFzc05hbWUmJnRoaXMuYWRkQ2xhc3NBdENvb3JkcyhlLG4sbyx0aGlzLnNldHRpbmdzLmNsYXNzTmFtZSk6bj49bFswXSYmbjw9bFsyXT90aGlzLnNldHRpbmdzLmhpZ2hsaWdodFJvd0NsYXNzTmFtZSYmdGhpcy5hZGRDbGFzc0F0Q29vcmRzKGUsbixvLHRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0Um93Q2xhc3NOYW1lKTpvPj1sWzFdJiZvPD1sWzNdJiZ0aGlzLnNldHRpbmdzLmhpZ2hsaWdodENvbHVtbkNsYXNzTmFtZSYmdGhpcy5hZGRDbGFzc0F0Q29vcmRzKGUsbixvLHRoaXMuc2V0dGluZ3MuaGlnaGxpZ2h0Q29sdW1uQ2xhc3NOYW1lKX1pZihlLmdldFNldHRpbmcoIm9uQmVmb3JlRHJhd0JvcmRlcnMiLGwsdGhpcy5zZXR0aW5ncy5jbGFzc05hbWUpLHRoaXMuc2V0dGluZ3MuYm9yZGVyKXt2YXIgaD10aGlzLmdldEJvcmRlcihlKTtoJiZoLmFwcGVhcihsKX19fX0se30pLHdpbmRvdy5XYWxrb250YWJsZVNlbGVjdGlvbj1kfSx7Ym9yZGVyOjIsImNlbGwvY29vcmRzIjo1LCJjZWxsL3JhbmdlIjo2LCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NX1dLDE5OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlU2V0dGluZ3M6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scj0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KS5mYXN0SW5uZXJUZXh0LGk9ZnVuY3Rpb24oZSx0KXt2YXIgbj10aGlzO3RoaXMud290PWUsdGhpcy5pbnN0YW5jZT1lLHRoaXMuZGVmYXVsdHM9e3RhYmxlOnZvaWQgMCxkZWJ1ZzohMSxleHRlcm5hbFJvd0NhbGN1bGF0b3I6ITEsc3RyZXRjaEg6Im5vbmUiLGN1cnJlbnRSb3dDbGFzc05hbWU6bnVsbCxjdXJyZW50Q29sdW1uQ2xhc3NOYW1lOm51bGwsZGF0YTp2b2lkIDAsZml4ZWRDb2x1bW5zTGVmdDowLGZpeGVkUm93c1RvcDowLGZpeGVkUm93c0JvdHRvbTowLG1pblNwYXJlUm93czowLHJvd0hlYWRlcnM6ZnVuY3Rpb24oKXtyZXR1cm5bXX0sY29sdW1uSGVhZGVyczpmdW5jdGlvbigpe3JldHVybltdfSx0b3RhbFJvd3M6dm9pZCAwLHRvdGFsQ29sdW1uczp2b2lkIDAsY2VsbFJlbmRlcmVyOmZ1bmN0aW9uKGUsdCxvKXt2YXIgaT1uLmdldFNldHRpbmcoImRhdGEiLGUsdCk7cihvLHZvaWQgMD09PWl8fG51bGw9PT1pPyIiOmkpfSxjb2x1bW5XaWR0aDpmdW5jdGlvbihlKXt9LHJvd0hlaWdodDpmdW5jdGlvbihlKXt9LGRlZmF1bHRSb3dIZWlnaHQ6MjMsZGVmYXVsdENvbHVtbldpZHRoOjUwLHNlbGVjdGlvbnM6bnVsbCxoaWRlQm9yZGVyT25Nb3VzZURvd25PdmVyOiExLHZpZXdwb3J0Um93Q2FsY3VsYXRvck92ZXJyaWRlOm51bGwsdmlld3BvcnRDb2x1bW5DYWxjdWxhdG9yT3ZlcnJpZGU6bnVsbCxvbkNlbGxNb3VzZURvd246bnVsbCxvbkNlbGxNb3VzZU92ZXI6bnVsbCxvbkNlbGxEYmxDbGljazpudWxsLG9uQ2VsbENvcm5lck1vdXNlRG93bjpudWxsLG9uQ2VsbENvcm5lckRibENsaWNrOm51bGwsYmVmb3JlRHJhdzpudWxsLG9uRHJhdzpudWxsLG9uQmVmb3JlRHJhd0JvcmRlcnM6bnVsbCxvblNjcm9sbFZlcnRpY2FsbHk6bnVsbCxvblNjcm9sbEhvcml6b250YWxseTpudWxsLG9uQmVmb3JlVG91Y2hTY3JvbGw6bnVsbCxvbkFmdGVyTW9tZW50dW1TY3JvbGw6bnVsbCxzY3JvbGxiYXJXaWR0aDoxMCxzY3JvbGxiYXJIZWlnaHQ6MTAscmVuZGVyQWxsUm93czohMSxncm91cHM6ITF9LHRoaXMuc2V0dGluZ3M9e307Zm9yKHZhciBvIGluIHRoaXMuZGVmYXVsdHMpaWYodGhpcy5kZWZhdWx0cy5oYXNPd25Qcm9wZXJ0eShvKSlpZih2b2lkIDAhPT10W29dKXRoaXMuc2V0dGluZ3Nbb109dFtvXTtlbHNle2lmKHZvaWQgMD09PXRoaXMuZGVmYXVsdHNbb10pdGhyb3cgbmV3IEVycm9yKCdBIHJlcXVpcmVkIHNldHRpbmcgIicrbysnIiB3YXMgbm90IHByb3ZpZGVkJyk7dGhpcy5zZXR0aW5nc1tvXT10aGlzLmRlZmF1bHRzW29dfX07JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGkse3VwZGF0ZTpmdW5jdGlvbihlLHQpe2lmKHZvaWQgMD09PXQpZm9yKHZhciBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmKHRoaXMuc2V0dGluZ3Nbbl09ZVtuXSk7ZWxzZSB0aGlzLnNldHRpbmdzW2VdPXQ7cmV0dXJuIHRoaXMud290fSxnZXRTZXR0aW5nOmZ1bmN0aW9uKGUsdCxuLG8scil7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIHRoaXMuc2V0dGluZ3NbZV0/dGhpcy5zZXR0aW5nc1tlXSh0LG4sbyxyKTp2b2lkIDAhPT10JiZBcnJheS5pc0FycmF5KHRoaXMuc2V0dGluZ3NbZV0pP3RoaXMuc2V0dGluZ3NbZV1bdF06dGhpcy5zZXR0aW5nc1tlXX0saGFzOmZ1bmN0aW9uKGUpe3JldHVybiEhdGhpcy5zZXR0aW5nc1tlXX19LHt9KSx3aW5kb3cuV2Fsa29udGFibGVTZXR0aW5ncz1pfSx7ImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1fV0sMjA6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVUYWJsZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEN9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscyxhLGwsdT0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxjPXUuZ2V0U3R5bGUsZD11LmdldFRyaW1taW5nQ29udGFpbmVyLGg9dS5oYXNDbGFzcyxmPXUuaW5kZXgscD11Lm9mZnNldCxnPXUucmVtb3ZlQ2xhc3MsbT11LnJlbW92ZVRleHROb2Rlcyx2PSh1Lm92ZXJsYXlDb250YWluc0VsZW1lbnQsKHI9ZSgiY2VsbC9jb29yZHMiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLldhbGtvbnRhYmxlQ2VsbENvb3Jkcyksdz0oKGk9ZSgiY2VsbC9yYW5nZSIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuV2Fsa29udGFibGVDZWxsUmFuZ2UsKHM9ZSgiZmlsdGVyL2NvbHVtbiIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkuV2Fsa29udGFibGVDb2x1bW5GaWx0ZXIpLHk9KGE9ZSgiZmlsdGVyL3JvdyIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSkuV2Fsa29udGFibGVSb3dGaWx0ZXIsYj0obD1lKCJ0YWJsZVJlbmRlcmVyIiksbCYmbC5fX2VzTW9kdWxlJiZsfHx7ImRlZmF1bHQiOmx9KS5XYWxrb250YWJsZVRhYmxlUmVuZGVyZXIsQz1mdW5jdGlvbihlLHQpe3RoaXMud290PWUsdGhpcy5pbnN0YW5jZT10aGlzLndvdCx0aGlzLlRBQkxFPXQsdGhpcy5UQk9EWT1udWxsLHRoaXMuVEhFQUQ9bnVsbCx0aGlzLkNPTEdST1VQPW51bGwsdGhpcy50YWJsZU9mZnNldD0wLHRoaXMuaG9sZGVyT2Zmc2V0PTAsbSh0aGlzLlRBQkxFKSx0aGlzLnNwcmVhZGVyPXRoaXMuY3JlYXRlU3ByZWFkZXIodGhpcy5UQUJMRSksdGhpcy5oaWRlcj10aGlzLmNyZWF0ZUhpZGVyKHRoaXMuc3ByZWFkZXIpLHRoaXMuaG9sZGVyPXRoaXMuY3JlYXRlSG9sZGVyKHRoaXMuaGlkZXIpLHRoaXMud3RSb290RWxlbWVudD10aGlzLmhvbGRlci5wYXJlbnROb2RlLHRoaXMuYWxpZ25PdmVybGF5c1dpdGhUcmltbWluZ0NvbnRhaW5lcigpLHRoaXMuZml4VGFibGVEb21UcmVlKCksdGhpcy5jb2xncm91cENoaWxkcmVuTGVuZ3RoPXRoaXMuQ09MR1JPVVAuY2hpbGROb2Rlcy5sZW5ndGgsdGhpcy50aGVhZENoaWxkcmVuTGVuZ3RoPXRoaXMuVEhFQUQuZmlyc3RDaGlsZD90aGlzLlRIRUFELmZpcnN0Q2hpbGQuY2hpbGROb2Rlcy5sZW5ndGg6MCx0aGlzLnRib2R5Q2hpbGRyZW5MZW5ndGg9dGhpcy5UQk9EWS5jaGlsZE5vZGVzLmxlbmd0aCx0aGlzLnJvd0ZpbHRlcj1udWxsLHRoaXMuY29sdW1uRmlsdGVyPW51bGx9OyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhDLHtmaXhUYWJsZURvbVRyZWU6ZnVuY3Rpb24oKXt0aGlzLlRCT0RZPXRoaXMuVEFCTEUucXVlcnlTZWxlY3RvcigidGJvZHkiKSx0aGlzLlRCT0RZfHwodGhpcy5UQk9EWT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpLHRoaXMuVEFCTEUuYXBwZW5kQ2hpbGQodGhpcy5UQk9EWSkpLHRoaXMuVEhFQUQ9dGhpcy5UQUJMRS5xdWVyeVNlbGVjdG9yKCJ0aGVhZCIpLHRoaXMuVEhFQUR8fCh0aGlzLlRIRUFEPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInRoZWFkIiksdGhpcy5UQUJMRS5pbnNlcnRCZWZvcmUodGhpcy5USEVBRCx0aGlzLlRCT0RZKSksdGhpcy5DT0xHUk9VUD10aGlzLlRBQkxFLnF1ZXJ5U2VsZWN0b3IoImNvbGdyb3VwIiksdGhpcy5DT0xHUk9VUHx8KHRoaXMuQ09MR1JPVVA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiY29sZ3JvdXAiKSx0aGlzLlRBQkxFLmluc2VydEJlZm9yZSh0aGlzLkNPTEdST1VQLHRoaXMuVEhFQUQpKSx0aGlzLndvdC5nZXRTZXR0aW5nKCJjb2x1bW5IZWFkZXJzIikubGVuZ3RoJiYhdGhpcy5USEVBRC5jaGlsZE5vZGVzLmxlbmd0aCYmdGhpcy5USEVBRC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUUiIpKX0sY3JlYXRlU3ByZWFkZXI6ZnVuY3Rpb24oZSl7dmFyIHQsbj1lLnBhcmVudE5vZGU7cmV0dXJuIG4mJjE9PT1uLm5vZGVUeXBlJiZoKG4sInd0SG9sZGVyIil8fCh0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLHQuY2xhc3NOYW1lPSJ3dFNwcmVhZGVyIixuJiZuLmluc2VydEJlZm9yZSh0LGUpLHQuYXBwZW5kQ2hpbGQoZSkpLHQuc3R5bGUucG9zaXRpb249InJlbGF0aXZlIix0fSxjcmVhdGVIaWRlcjpmdW5jdGlvbihlKXt2YXIgdCxuPWUucGFyZW50Tm9kZTtyZXR1cm4gbiYmMT09PW4ubm9kZVR5cGUmJmgobiwid3RIb2xkZXIiKXx8KHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IiksdC5jbGFzc05hbWU9Ind0SGlkZXIiLG4mJm4uaW5zZXJ0QmVmb3JlKHQsZSksdC5hcHBlbmRDaGlsZChlKSksdH0sY3JlYXRlSG9sZGVyOmZ1bmN0aW9uKGUpe3ZhciB0LG49ZS5wYXJlbnROb2RlO3JldHVybiBuJiYxPT09bi5ub2RlVHlwZSYmaChuLCJ3dEhvbGRlciIpfHwodD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSx0LnN0eWxlLnBvc2l0aW9uPSJyZWxhdGl2ZSIsdC5jbGFzc05hbWU9Ind0SG9sZGVyIixuJiZuLmluc2VydEJlZm9yZSh0LGUpLHRoaXMuaXNXb3JraW5nT25DbG9uZSgpfHwodC5wYXJlbnROb2RlLmNsYXNzTmFtZSs9Imh0X21hc3RlciBoYW5kc29udGFibGUiKSx0LmFwcGVuZENoaWxkKGUpKSx0fSxhbGlnbk92ZXJsYXlzV2l0aFRyaW1taW5nQ29udGFpbmVyOmZ1bmN0aW9uKCl7dmFyIGU9ZCh0aGlzLnd0Um9vdEVsZW1lbnQpO3RoaXMuaXNXb3JraW5nT25DbG9uZSgpfHwodGhpcy5ob2xkZXIucGFyZW50Tm9kZS5zdHlsZS5wb3NpdGlvbj0icmVsYXRpdmUiLGU9PT13aW5kb3c/KHRoaXMuaG9sZGVyLnN0eWxlLm92ZXJmbG93PSJ2aXNpYmxlIix0aGlzLnd0Um9vdEVsZW1lbnQuc3R5bGUub3ZlcmZsb3c9InZpc2libGUiKToodGhpcy5ob2xkZXIuc3R5bGUud2lkdGg9YyhlLCJ3aWR0aCIpLHRoaXMuaG9sZGVyLnN0eWxlLmhlaWdodD1jKGUsImhlaWdodCIpLHRoaXMuaG9sZGVyLnN0eWxlLm92ZXJmbG93PSIiKSl9LGlzV29ya2luZ09uQ2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMud290LmNsb25lU291cmNlfSxkcmF3OmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZygidG90YWxSb3dzIik7aWYodGhpcy5pc1dvcmtpbmdPbkNsb25lKCl8fCh0aGlzLmhvbGRlck9mZnNldD1wKHRoaXMuaG9sZGVyKSxlPXRoaXMud290Lnd0Vmlld3BvcnQuY3JlYXRlUmVuZGVyQ2FsY3VsYXRvcnMoZSkpLGUpdGhpcy5pc1dvcmtpbmdPbkNsb25lKCl8fHRoaXMud290Lnd0Vmlld3BvcnQuY3JlYXRlVmlzaWJsZUNhbGN1bGF0b3JzKCksdGhpcy53b3Qud3RPdmVybGF5cyYmdGhpcy53b3Qud3RPdmVybGF5cy5yZWZyZXNoKCEwKTtlbHNle3RoaXMuaXNXb3JraW5nT25DbG9uZSgpP3RoaXMudGFibGVPZmZzZXQ9dGhpcy53b3QuY2xvbmVTb3VyY2Uud3RUYWJsZS50YWJsZU9mZnNldDp0aGlzLnRhYmxlT2Zmc2V0PXAodGhpcy5UQUJMRSk7dmFyIG47bj1XYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMud290LmNsb25lT3ZlcmxheSxXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfREVCVUcpfHxXYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMud290LmNsb25lT3ZlcmxheSxXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfVE9QKXx8V2Fsa29udGFibGVPdmVybGF5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXksV2Fsa29udGFibGVPdmVybGF5LkNMT05FX1RPUF9MRUZUX0NPUk5FUik/MDpXYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMuaW5zdGFuY2UuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9CT1RUT00pfHxXYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMuaW5zdGFuY2UuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9CT1RUT01fTEVGVF9DT1JORVIpP3QtdGhpcy53b3QuZ2V0U2V0dGluZygiZml4ZWRSb3dzQm90dG9tIik6dGhpcy53b3Qud3RWaWV3cG9ydC5yb3dzUmVuZGVyQ2FsY3VsYXRvci5zdGFydFJvdzt2YXIgbztvPVdhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9ERUJVRyl8fFdhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9MRUZUKXx8V2Fsa29udGFibGVPdmVybGF5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXksV2Fsa29udGFibGVPdmVybGF5LkNMT05FX1RPUF9MRUZUX0NPUk5FUil8fFdhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9CT1RUT01fTEVGVF9DT1JORVIpPzA6dGhpcy53b3Qud3RWaWV3cG9ydC5jb2x1bW5zUmVuZGVyQ2FsY3VsYXRvci5zdGFydENvbHVtbiwKdGhpcy5yb3dGaWx0ZXI9bmV3IHkobix0LHRoaXMud290LmdldFNldHRpbmcoImNvbHVtbkhlYWRlcnMiKS5sZW5ndGgpLHRoaXMuY29sdW1uRmlsdGVyPW5ldyB3KG8sdGhpcy53b3QuZ2V0U2V0dGluZygidG90YWxDb2x1bW5zIiksdGhpcy53b3QuZ2V0U2V0dGluZygicm93SGVhZGVycyIpLmxlbmd0aCksdGhpcy5fZG9EcmF3KCksdGhpcy5hbGlnbk92ZXJsYXlzV2l0aFRyaW1taW5nQ29udGFpbmVyKCl9cmV0dXJuIHRoaXMucmVmcmVzaFNlbGVjdGlvbnMoZSksdGhpcy5pc1dvcmtpbmdPbkNsb25lKCl8fCh0aGlzLndvdC53dE92ZXJsYXlzLnRvcE92ZXJsYXkucmVzZXRGaXhlZFBvc2l0aW9uKCksdGhpcy53b3Qud3RPdmVybGF5cy5ib3R0b21PdmVybGF5LmNsb25lJiZ0aGlzLndvdC53dE92ZXJsYXlzLmJvdHRvbU92ZXJsYXkucmVzZXRGaXhlZFBvc2l0aW9uKCksdGhpcy53b3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5yZXNldEZpeGVkUG9zaXRpb24oKSx0aGlzLndvdC53dE92ZXJsYXlzLnRvcExlZnRDb3JuZXJPdmVybGF5JiZ0aGlzLndvdC53dE92ZXJsYXlzLnRvcExlZnRDb3JuZXJPdmVybGF5LnJlc2V0Rml4ZWRQb3NpdGlvbigpLHRoaXMuaW5zdGFuY2Uud3RPdmVybGF5cy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheSYmdGhpcy5pbnN0YW5jZS53dE92ZXJsYXlzLmJvdHRvbUxlZnRDb3JuZXJPdmVybGF5LmNsb25lJiZ0aGlzLndvdC53dE92ZXJsYXlzLmJvdHRvbUxlZnRDb3JuZXJPdmVybGF5LnJlc2V0Rml4ZWRQb3NpdGlvbigpKSx0aGlzLndvdC5kcmF3bj0hMCx0aGlzfSxfZG9EcmF3OmZ1bmN0aW9uKCl7dmFyIGU9bmV3IGIodGhpcyk7ZS5yZW5kZXIoKX0scmVtb3ZlQ2xhc3NGcm9tQ2VsbHM6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PXRoaXMuVEFCTEUucXVlcnlTZWxlY3RvckFsbCgiLiIrZSksbj0wLG89dC5sZW5ndGg7bz5uO24rKylnKHRbbl0sZSl9LHJlZnJlc2hTZWxlY3Rpb25zOmZ1bmN0aW9uKGUpe2lmKHRoaXMud290LnNlbGVjdGlvbnMpe3ZhciB0PXRoaXMud290LnNlbGVjdGlvbnMubGVuZ3RoO2lmKGUpZm9yKHZhciBuPTA7dD5uO24rKyl0aGlzLndvdC5zZWxlY3Rpb25zW25dLnNldHRpbmdzLmNsYXNzTmFtZSYmdGhpcy5yZW1vdmVDbGFzc0Zyb21DZWxscyh0aGlzLndvdC5zZWxlY3Rpb25zW25dLnNldHRpbmdzLmNsYXNzTmFtZSksdGhpcy53b3Quc2VsZWN0aW9uc1tuXS5zZXR0aW5ncy5oaWdobGlnaHRSb3dDbGFzc05hbWUmJnRoaXMucmVtb3ZlQ2xhc3NGcm9tQ2VsbHModGhpcy53b3Quc2VsZWN0aW9uc1tuXS5zZXR0aW5ncy5oaWdobGlnaHRSb3dDbGFzc05hbWUpLHRoaXMud290LnNlbGVjdGlvbnNbbl0uc2V0dGluZ3MuaGlnaGxpZ2h0Q29sdW1uQ2xhc3NOYW1lJiZ0aGlzLnJlbW92ZUNsYXNzRnJvbUNlbGxzKHRoaXMud290LnNlbGVjdGlvbnNbbl0uc2V0dGluZ3MuaGlnaGxpZ2h0Q29sdW1uQ2xhc3NOYW1lKTtmb3IodmFyIG89MDt0Pm87bysrKXRoaXMud290LnNlbGVjdGlvbnNbb10uZHJhdyh0aGlzLndvdCxlKX19LGdldENlbGw6ZnVuY3Rpb24oZSl7aWYodGhpcy5pc1Jvd0JlZm9yZVJlbmRlcmVkUm93cyhlLnJvdykpcmV0dXJuLTE7aWYodGhpcy5pc1Jvd0FmdGVyUmVuZGVyZWRSb3dzKGUucm93KSlyZXR1cm4tMjt2YXIgdD10aGlzLlRCT0RZLmNoaWxkTm9kZXNbdGhpcy5yb3dGaWx0ZXIuc291cmNlVG9SZW5kZXJlZChlLnJvdyldO3JldHVybiB0P3QuY2hpbGROb2Rlc1t0aGlzLmNvbHVtbkZpbHRlci5zb3VyY2VDb2x1bW5Ub1Zpc2libGVSb3dIZWFkZWRDb2x1bW4oZS5jb2wpXTp2b2lkIDB9LGdldENvbHVtbkhlYWRlcjpmdW5jdGlvbihlKXt2YXIgdD12b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjAsbj10aGlzLlRIRUFELmNoaWxkTm9kZXNbdF07cmV0dXJuIG4/bi5jaGlsZE5vZGVzW3RoaXMuY29sdW1uRmlsdGVyLnNvdXJjZUNvbHVtblRvVmlzaWJsZVJvd0hlYWRlZENvbHVtbihlKV06dm9pZCAwfSxnZXRSb3dIZWFkZXI6ZnVuY3Rpb24oZSl7aWYoMD09PXRoaXMuY29sdW1uRmlsdGVyLnNvdXJjZUNvbHVtblRvVmlzaWJsZVJvd0hlYWRlZENvbHVtbigwKSlyZXR1cm4gbnVsbDt2YXIgdD10aGlzLlRCT0RZLmNoaWxkTm9kZXNbdGhpcy5yb3dGaWx0ZXIuc291cmNlVG9SZW5kZXJlZChlKV07cmV0dXJuIHQ/dC5jaGlsZE5vZGVzWzBdOnZvaWQgMH0sZ2V0Q29vcmRzOmZ1bmN0aW9uKGUpe3ZhciB0PWUucGFyZW50Tm9kZSxuPWYodCk7bj10LnBhcmVudE5vZGU9PT10aGlzLlRIRUFEP3RoaXMucm93RmlsdGVyLnZpc2libGVDb2xIZWFkZWRSb3dUb1NvdXJjZVJvdyhuKTp0aGlzLnJvd0ZpbHRlci5yZW5kZXJlZFRvU291cmNlKG4pO3ZhciBvPXRoaXMuY29sdW1uRmlsdGVyLnZpc2libGVSb3dIZWFkZWRDb2x1bW5Ub1NvdXJjZUNvbHVtbihlLmNlbGxJbmRleCk7cmV0dXJuIG5ldyB2KG4sbyl9LGdldFRyRm9yUm93OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLlRCT0RZLmNoaWxkTm9kZXNbdGhpcy5yb3dGaWx0ZXIuc291cmNlVG9SZW5kZXJlZChlKV19LGdldEZpcnN0UmVuZGVyZWRSb3c6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy53b3Qud3RWaWV3cG9ydC5yb3dzUmVuZGVyQ2FsY3VsYXRvci5zdGFydFJvd30sZ2V0Rmlyc3RWaXNpYmxlUm93OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMud290Lnd0Vmlld3BvcnQucm93c1Zpc2libGVDYWxjdWxhdG9yLnN0YXJ0Um93fSxnZXRGaXJzdFJlbmRlcmVkQ29sdW1uOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMud290Lnd0Vmlld3BvcnQuY29sdW1uc1JlbmRlckNhbGN1bGF0b3Iuc3RhcnRDb2x1bW59LGdldEZpcnN0VmlzaWJsZUNvbHVtbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLndvdC53dFZpZXdwb3J0LmNvbHVtbnNWaXNpYmxlQ2FsY3VsYXRvci5zdGFydENvbHVtbn0sZ2V0TGFzdFJlbmRlcmVkUm93OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMud290Lnd0Vmlld3BvcnQucm93c1JlbmRlckNhbGN1bGF0b3IuZW5kUm93fSxnZXRMYXN0VmlzaWJsZVJvdzpmdW5jdGlvbigpe3JldHVybiB0aGlzLndvdC53dFZpZXdwb3J0LnJvd3NWaXNpYmxlQ2FsY3VsYXRvci5lbmRSb3d9LGdldExhc3RSZW5kZXJlZENvbHVtbjpmdW5jdGlvbigpe3JldHVybiB0aGlzLndvdC53dFZpZXdwb3J0LmNvbHVtbnNSZW5kZXJDYWxjdWxhdG9yLmVuZENvbHVtbn0sZ2V0TGFzdFZpc2libGVDb2x1bW46ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy53b3Qud3RWaWV3cG9ydC5jb2x1bW5zVmlzaWJsZUNhbGN1bGF0b3IuZW5kQ29sdW1ufSxpc1Jvd0JlZm9yZVJlbmRlcmVkUm93czpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yb3dGaWx0ZXIuc291cmNlVG9SZW5kZXJlZChlKTwwJiZlPj0wfSxpc1Jvd0FmdGVyVmlld3BvcnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMucm93RmlsdGVyLnNvdXJjZVRvUmVuZGVyZWQoZSk+dGhpcy5nZXRMYXN0VmlzaWJsZVJvdygpfSxpc1Jvd0FmdGVyUmVuZGVyZWRSb3dzOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnJvd0ZpbHRlci5zb3VyY2VUb1JlbmRlcmVkKGUpPnRoaXMuZ2V0TGFzdFJlbmRlcmVkUm93KCl9LGlzQ29sdW1uQmVmb3JlVmlld3BvcnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY29sdW1uRmlsdGVyLnNvdXJjZVRvUmVuZGVyZWQoZSk8MCYmZT49MH0saXNDb2x1bW5BZnRlclZpZXdwb3J0OmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmNvbHVtbkZpbHRlci5zb3VyY2VUb1JlbmRlcmVkKGUpPnRoaXMuZ2V0TGFzdFZpc2libGVDb2x1bW4oKX0saXNMYXN0Um93RnVsbHlWaXNpYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0TGFzdFZpc2libGVSb3coKT09PXRoaXMuZ2V0TGFzdFJlbmRlcmVkUm93KCl9LGlzTGFzdENvbHVtbkZ1bGx5VmlzaWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldExhc3RWaXNpYmxlQ29sdW1uKCk9PT10aGlzLmdldExhc3RSZW5kZXJlZENvbHVtbigpfSxnZXRSZW5kZXJlZENvbHVtbnNDb3VudDpmdW5jdGlvbigpe3JldHVybiBXYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMud290LmNsb25lT3ZlcmxheSxXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfREVCVUcpP3RoaXMud290LmdldFNldHRpbmcoInRvdGFsQ29sdW1ucyIpOldhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9MRUZUKXx8V2Fsa29udGFibGVPdmVybGF5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXksV2Fsa29udGFibGVPdmVybGF5LkNMT05FX1RPUF9MRUZUX0NPUk5FUil8fFdhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9CT1RUT01fTEVGVF9DT1JORVIpP3RoaXMud290LmdldFNldHRpbmcoImZpeGVkQ29sdW1uc0xlZnQiKTp0aGlzLndvdC53dFZpZXdwb3J0LmNvbHVtbnNSZW5kZXJDYWxjdWxhdG9yLmNvdW50fSxnZXRSZW5kZXJlZFJvd3NDb3VudDpmdW5jdGlvbigpe3JldHVybiBXYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMud290LmNsb25lT3ZlcmxheSxXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfREVCVUcpP3RoaXMud290LmdldFNldHRpbmcoInRvdGFsUm93cyIpOldhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9UT1ApfHxXYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMud290LmNsb25lT3ZlcmxheSxXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfVE9QX0xFRlRfQ09STkVSKT90aGlzLndvdC5nZXRTZXR0aW5nKCJmaXhlZFJvd3NUb3AiKTpXYWxrb250YWJsZU92ZXJsYXkuaXNPdmVybGF5VHlwZU9mKHRoaXMud290LmNsb25lT3ZlcmxheSxXYWxrb250YWJsZU92ZXJsYXkuQ0xPTkVfQk9UVE9NKXx8V2Fsa29udGFibGVPdmVybGF5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXksV2Fsa29udGFibGVPdmVybGF5LkNMT05FX0JPVFRPTV9MRUZUX0NPUk5FUik/dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5nKCJmaXhlZFJvd3NCb3R0b20iKTp0aGlzLndvdC53dFZpZXdwb3J0LnJvd3NSZW5kZXJDYWxjdWxhdG9yLmNvdW50fSxnZXRWaXNpYmxlUm93c0NvdW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMud290Lnd0Vmlld3BvcnQucm93c1Zpc2libGVDYWxjdWxhdG9yLmNvdW50fSxhbGxSb3dzSW5WaWV3cG9ydDpmdW5jdGlvbigpe3JldHVybiB0aGlzLndvdC5nZXRTZXR0aW5nKCJ0b3RhbFJvd3MiKT09dGhpcy5nZXRWaXNpYmxlUm93c0NvdW50KCl9LGdldFJvd0hlaWdodDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLndvdC53dFNldHRpbmdzLnNldHRpbmdzLnJvd0hlaWdodChlKSxuPXRoaXMud290Lnd0Vmlld3BvcnQub3ZlcnNpemVkUm93c1tlXTtyZXR1cm4gdm9pZCAwIT09biYmKHQ9dm9pZCAwPT09dD9uOk1hdGgubWF4KHQsbikpLHR9LGdldENvbHVtbkhlYWRlckhlaWdodDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLndvdC53dFNldHRpbmdzLnNldHRpbmdzLmRlZmF1bHRSb3dIZWlnaHQsbj10aGlzLndvdC53dFZpZXdwb3J0Lm92ZXJzaXplZENvbHVtbkhlYWRlcnNbZV07cmV0dXJuIHZvaWQgMCE9PW4mJih0PXQ/TWF0aC5tYXgodCxuKTpuKSx0fSxnZXRWaXNpYmxlQ29sdW1uc0NvdW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMud290Lnd0Vmlld3BvcnQuY29sdW1uc1Zpc2libGVDYWxjdWxhdG9yLmNvdW50fSxhbGxDb2x1bW5zSW5WaWV3cG9ydDpmdW5jdGlvbigpe3JldHVybiB0aGlzLndvdC5nZXRTZXR0aW5nKCJ0b3RhbENvbHVtbnMiKT09dGhpcy5nZXRWaXNpYmxlQ29sdW1uc0NvdW50KCl9LGdldENvbHVtbldpZHRoOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMud290Lnd0U2V0dGluZ3Muc2V0dGluZ3MuY29sdW1uV2lkdGg7cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIHQ/dD10KGUpOiJvYmplY3QiPT10eXBlb2YgdCYmKHQ9dFtlXSksdHx8dGhpcy53b3Qud3RTZXR0aW5ncy5zZXR0aW5ncy5kZWZhdWx0Q29sdW1uV2lkdGh9LGdldFN0cmV0Y2hlZENvbHVtbldpZHRoOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuZ2V0Q29sdW1uV2lkdGgoZSksbj0tMT09PVt2b2lkIDAsbnVsbF0uaW5kZXhPZih0KT90OnRoaXMuaW5zdGFuY2Uud3RTZXR0aW5ncy5zZXR0aW5ncy5kZWZhdWx0Q29sdW1uV2lkdGgsbz10aGlzLndvdC53dFZpZXdwb3J0LmNvbHVtbnNSZW5kZXJDYWxjdWxhdG9yO2lmKG8pe3ZhciByPW8uZ2V0U3RyZXRjaGVkQ29sdW1uV2lkdGgoZSxuKTtyJiYobj1yKX1yZXR1cm4gbn19LHt9KSx3aW5kb3cuV2Fsa29udGFibGVUYWJsZT1DfSx7ImNlbGwvY29vcmRzIjo1LCJjZWxsL3JhbmdlIjo2LCJmaWx0ZXIvY29sdW1uIjo5LCJmaWx0ZXIvcm93IjoxMCwiaGVscGVycy9kb20vZWxlbWVudCI6NDUsdGFibGVSZW5kZXJlcjoyMX1dLDIxOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSx0KXt2YXIgbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUSCIpO3JldHVybiB0Lmluc2VydEJlZm9yZShuLGUpLHQucmVtb3ZlQ2hpbGQoZSksbn1mdW5jdGlvbiByKGUsdCl7dmFyIG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiVEQiKTtyZXR1cm4gdC5pbnNlcnRCZWZvcmUobixlKSx0LnJlbW92ZUNoaWxkKGUpLG59T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7V2Fsa29udGFibGVUYWJsZVJlbmRlcmVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaH19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBpLHM9KGk9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSksYT1zLmFkZENsYXNzLGw9cy5lbXB0eSx1PXMuZ2V0U2Nyb2xsYmFyV2lkdGgsYz1zLmhhc0NsYXNzLGQ9cy5pbm5lckhlaWdodCxoPWZ1bmN0aW9uKGUpe3RoaXMud3RUYWJsZT1lLHRoaXMud290PWUuaW5zdGFuY2UsdGhpcy5pbnN0YW5jZT1lLmluc3RhbmNlLHRoaXMucm93RmlsdGVyPWUucm93RmlsdGVyLHRoaXMuY29sdW1uRmlsdGVyPWUuY29sdW1uRmlsdGVyLHRoaXMuVEFCTEU9ZS5UQUJMRSx0aGlzLlRIRUFEPWUuVEhFQUQsdGhpcy5UQk9EWT1lLlRCT0RZLHRoaXMuQ09MR1JPVVA9ZS5DT0xHUk9VUCx0aGlzLnJvd0hlYWRlcnM9W10sdGhpcy5yb3dIZWFkZXJDb3VudD0wLHRoaXMuY29sdW1uSGVhZGVycz1bXSx0aGlzLmNvbHVtbkhlYWRlckNvdW50PTAsdGhpcy5maXhlZFJvd3NUb3A9MCx0aGlzLmZpeGVkUm93c0JvdHRvbT0wfTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoaCx7cmVuZGVyOmZ1bmN0aW9uKCl7dGhpcy53dFRhYmxlLmlzV29ya2luZ09uQ2xvbmUoKXx8dGhpcy53b3QuZ2V0U2V0dGluZygiYmVmb3JlRHJhdyIsITApLHRoaXMucm93SGVhZGVycz10aGlzLndvdC5nZXRTZXR0aW5nKCJyb3dIZWFkZXJzIiksdGhpcy5yb3dIZWFkZXJDb3VudD10aGlzLnJvd0hlYWRlcnMubGVuZ3RoLHRoaXMuZml4ZWRSb3dzVG9wPXRoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c1RvcCIpLHRoaXMuZml4ZWRSb3dzQm90dG9tPXRoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c0JvdHRvbSIpLHRoaXMuY29sdW1uSGVhZGVycz10aGlzLndvdC5nZXRTZXR0aW5nKCJjb2x1bW5IZWFkZXJzIiksdGhpcy5jb2x1bW5IZWFkZXJDb3VudD10aGlzLmNvbHVtbkhlYWRlcnMubGVuZ3RoO3ZhciBlLHQ9dGhpcy53dFRhYmxlLmdldFJlbmRlcmVkQ29sdW1uc0NvdW50KCksbj10aGlzLnd0VGFibGUuZ2V0UmVuZGVyZWRSb3dzQ291bnQoKSxvPXRoaXMud290LmdldFNldHRpbmcoInRvdGFsQ29sdW1ucyIpLHI9dGhpcy53b3QuZ2V0U2V0dGluZygidG90YWxSb3dzIiksaT0hMTtpZigoV2Fsa29udGFibGVPdmVybGF5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXksV2Fsa29udGFibGVPdmVybGF5LkNMT05FX0JPVFRPTSl8fFdhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9CT1RUT01fTEVGVF9DT1JORVIpKSYmKHRoaXMuY29sdW1uSGVhZGVycz1bXSx0aGlzLmNvbHVtbkhlYWRlckNvdW50PTApLG8+MCYmKHRoaXMuYWRqdXN0QXZhaWxhYmxlTm9kZXMoKSxpPSEwLHRoaXMucmVuZGVyQ29sdW1uSGVhZGVycygpLHRoaXMucmVuZGVyUm93cyhyLG4sdCksdGhpcy53dFRhYmxlLmlzV29ya2luZ09uQ2xvbmUoKXx8KGU9dGhpcy53b3Qud3RWaWV3cG9ydC5nZXRXb3Jrc3BhY2VXaWR0aCgpLHRoaXMud290Lnd0Vmlld3BvcnQuY29udGFpbmVyV2lkdGg9bnVsbCksdGhpcy5hZGp1c3RDb2x1bW5IZWFkZXJIZWlnaHRzKCksdGhpcy5hZGp1c3RDb2x1bW5XaWR0aHModCksdGhpcy5tYXJrT3ZlcnNpemVkQ29sdW1ucygpKSxpfHx0aGlzLmFkanVzdEF2YWlsYWJsZU5vZGVzKCksdGhpcy5yZW1vdmVSZWR1bmRhbnRSb3dzKG4pLHRoaXMud3RUYWJsZS5pc1dvcmtpbmdPbkNsb25lKCkpe2lmKFdhbGtvbnRhYmxlT3ZlcmxheS5pc092ZXJsYXlUeXBlT2YodGhpcy53b3QuY2xvbmVPdmVybGF5LFdhbGtvbnRhYmxlT3ZlcmxheS5DTE9ORV9CT1RUT00pKXt2YXIgcz10aGlzLndvdC5jbG9uZU92ZXJsYXkuaW5zdGFuY2U7dGhpcy53b3QuY2xvbmVPdmVybGF5Lm1hcmtPdmVyc2l6ZWRGaXhlZEJvdHRvbVJvd3MoKSxzLnd0T3ZlcmxheXMuYWRqdXN0RWxlbWVudHNTaXplKCl9fWVsc2V7aWYodGhpcy5tYXJrT3ZlcnNpemVkUm93cygpLHRoaXMud290Lnd0Vmlld3BvcnQuY3JlYXRlVmlzaWJsZUNhbGN1bGF0b3JzKCksdGhpcy53b3Qud3RPdmVybGF5cy5yZWZyZXNoKCExKSx0aGlzLndvdC53dE92ZXJsYXlzLmFwcGx5VG9ET00oKSxlIT09dGhpcy53b3Qud3RWaWV3cG9ydC5nZXRXb3Jrc3BhY2VXaWR0aCgpKXt0aGlzLndvdC53dFZpZXdwb3J0LmNvbnRhaW5lcldpZHRoPW51bGw7Zm9yKHZhciBhPXRoaXMud3RUYWJsZS5nZXRGaXJzdFJlbmRlcmVkQ29sdW1uKCksbD10aGlzLnd0VGFibGUuZ2V0TGFzdFJlbmRlcmVkQ29sdW1uKCksdT1hO2w+dTt1Kyspe3ZhciBjPXRoaXMud3RUYWJsZS5nZXRTdHJldGNoZWRDb2x1bW5XaWR0aCh1KSxkPXRoaXMuY29sdW1uRmlsdGVyLnNvdXJjZVRvUmVuZGVyZWQodSk7dGhpcy5DT0xHUk9VUC5jaGlsZE5vZGVzW2QrdGhpcy5yb3dIZWFkZXJDb3VudF0uc3R5bGUud2lkdGg9YysicHgifX10aGlzLndvdC5nZXRTZXR0aW5nKCJvbkRyYXciLCEwKX19LHJlbW92ZVJlZHVuZGFudFJvd3M6ZnVuY3Rpb24oZSl7Zm9yKDt0aGlzLnd0VGFibGUudGJvZHlDaGlsZHJlbkxlbmd0aD5lOyl0aGlzLlRCT0RZLnJlbW92ZUNoaWxkKHRoaXMuVEJPRFkubGFzdENoaWxkKSx0aGlzLnd0VGFibGUudGJvZHlDaGlsZHJlbkxlbmd0aC0tfSxyZW5kZXJSb3dzOmZ1bmN0aW9uKGUsdCxuKXtmb3IodmFyIG8scixpPTAscz10aGlzLnJvd0ZpbHRlci5yZW5kZXJlZFRvU291cmNlKGkpLGE9dGhpcy53dFRhYmxlLmlzV29ya2luZ09uQ2xvbmUoKTtlPnMmJnM+PTAmJihpPjFlMyYmY29uc29sZS5lcnJvcigiU2VjdXJpdHkgYnJha2U6IFRvbyBtdWNoIFRScy4gUGxlYXNlIGRlZmluZSBoZWlnaHQgZm9yIHlvdXIgdGFibGUsIHdoaWNoIHdpbGwgZW5mb3JjZSBzY3JvbGxiYXJzLiIpLHZvaWQgMD09PXR8fGkhPT10KTspe2lmKHI9dGhpcy5nZXRPckNyZWF0ZVRyRm9yUm93KGksciksdGhpcy5yZW5kZXJSb3dIZWFkZXJzKHMsciksdGhpcy5hZGp1c3RDb2x1bW5zKHIsbit0aGlzLnJvd0hlYWRlckNvdW50KSxvPXRoaXMucmVuZGVyQ2VsbHMocyxyLG4pLCghYXx8V2Fsa29udGFibGVPdmVybGF5LmlzT3ZlcmxheVR5cGVPZih0aGlzLndvdC5jbG9uZU92ZXJsYXksV2Fsa29udGFibGVPdmVybGF5LkNMT05FX0JPVFRPTSkpJiZ0aGlzLnJlc2V0T3ZlcnNpemVkUm93KHMpLHIuZmlyc3RDaGlsZCl7dmFyIGw9dGhpcy53b3Qud3RUYWJsZS5nZXRSb3dIZWlnaHQocyk7bD8obC0tLHIuZmlyc3RDaGlsZC5zdHlsZS5oZWlnaHQ9bCsicHgiKTpyLmZpcnN0Q2hpbGQuc3R5bGUuaGVpZ2h0PSIifWkrKyxzPXRoaXMucm93RmlsdGVyLnJlbmRlcmVkVG9Tb3VyY2UoaSl9fSxyZXNldE92ZXJzaXplZFJvdzpmdW5jdGlvbihlKXt0aGlzLndvdC5nZXRTZXR0aW5nKCJleHRlcm5hbFJvd0NhbGN1bGF0b3IiKXx8dGhpcy53b3Qud3RWaWV3cG9ydC5vdmVyc2l6ZWRSb3dzJiZ0aGlzLndvdC53dFZpZXdwb3J0Lm92ZXJzaXplZFJvd3NbZV0mJih0aGlzLndvdC53dFZpZXdwb3J0Lm92ZXJzaXplZFJvd3NbZV09dm9pZCAwKX0sbWFya092ZXJzaXplZFJvd3M6ZnVuY3Rpb24oKXtpZighdGhpcy53b3QuZ2V0U2V0dGluZygiZXh0ZXJuYWxSb3dDYWxjdWxhdG9yIikpe3ZhciBlLHQsbixvLHIsaT10aGlzLmluc3RhbmNlLnd0VGFibGUuVEJPRFkuY2hpbGROb2Rlcy5sZW5ndGgscz1pKnRoaXMuaW5zdGFuY2Uud3RTZXR0aW5ncy5zZXR0aW5ncy5kZWZhdWx0Um93SGVpZ2h0LGE9ZCh0aGlzLmluc3RhbmNlLnd0VGFibGUuVEJPRFkpLTE7dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5nKCJ0b3RhbFJvd3MiKTtpZihzIT09YXx8dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5nKCJmaXhlZFJvd3NCb3R0b20iKSlmb3IoO2k7KWktLSxuPXRoaXMuaW5zdGFuY2Uud3RUYWJsZS5yb3dGaWx0ZXIucmVuZGVyZWRUb1NvdXJjZShpKSxlPXRoaXMuaW5zdGFuY2Uud3RUYWJsZS5nZXRSb3dIZWlnaHQobiksbz10aGlzLmluc3RhbmNlLnd0VGFibGUuZ2V0VHJGb3JSb3cobikscj1vLnF1ZXJ5U2VsZWN0b3IoInRoIiksdD1yP2Qocik6ZChvKS0xLCghZSYmdGhpcy5pbnN0YW5jZS53dFNldHRpbmdzLnNldHRpbmdzLmRlZmF1bHRSb3dIZWlnaHQ8dHx8dD5lKSYmKHRoaXMuaW5zdGFuY2Uud3RWaWV3cG9ydC5vdmVyc2l6ZWRSb3dzW25dPSsrdCl9fSxtYXJrT3ZlcnNpemVkQ29sdW1uczpmdW5jdGlvbigpe3ZhciBlPXRoaXMud290LmdldE92ZXJsYXlOYW1lKCk7aWYodGhpcy5jb2x1bW5IZWFkZXJDb3VudCYmIXRoaXMud290Lnd0Vmlld3BvcnQuaXNNYXJrZWRPdmVyc2l6ZWRDb2x1bW5bZV0mJiF0aGlzLnd0VGFibGUuaXNXb3JraW5nT25DbG9uZSgpKXtmb3IodmFyIHQ9dGhpcy53dFRhYmxlLmdldFJlbmRlcmVkQ29sdW1uc0NvdW50KCksbj0wO248dGhpcy5jb2x1bW5IZWFkZXJDb3VudDtuKyspZm9yKHZhciBvPS0xKnRoaXMucm93SGVhZGVyQ291bnQ7dD5vO28rKyl0aGlzLm1hcmtJZk92ZXJzaXplZENvbHVtbkhlYWRlcihvKTt0aGlzLndvdC53dFZpZXdwb3J0LmlzTWFya2VkT3ZlcnNpemVkQ29sdW1uW2VdPSEwfX0sYWRqdXN0Q29sdW1uSGVhZGVySGVpZ2h0czpmdW5jdGlvbigpe2Zvcih2YXIgZT10aGlzLndvdC5nZXRTZXR0aW5nKCJjb2x1bW5IZWFkZXJzIiksdD10aGlzLndvdC53dFRhYmxlLlRIRUFELmNoaWxkTm9kZXMsbj10aGlzLndvdC53dFZpZXdwb3J0Lm92ZXJzaXplZENvbHVtbkhlYWRlcnMsbz0wLHI9ZS5sZW5ndGg7cj5vO28rKylpZihuW29dKXtpZigwPT09dFtvXS5jaGlsZE5vZGVzLmxlbmd0aClyZXR1cm47dFtvXS5jaGlsZE5vZGVzWzBdLnN0eWxlLmhlaWdodD1uW29dKyJweCJ9fSxtYXJrSWZPdmVyc2l6ZWRDb2x1bW5IZWFkZXI6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0LG4sbyxyPXRoaXMud290Lnd0VGFibGUuY29sdW1uRmlsdGVyLnJlbmRlcmVkVG9Tb3VyY2UoZSksaT10aGlzLmNvbHVtbkhlYWRlckNvdW50LHM9dGhpcy53b3Qud3RTZXR0aW5ncy5zZXR0aW5ncy5kZWZhdWx0Um93SGVpZ2h0O2k7KWktLSx0PXRoaXMud290Lnd0VGFibGUuZ2V0Q29sdW1uSGVhZGVySGVpZ2h0KGkpLG49dGhpcy53b3Qud3RUYWJsZS5nZXRDb2x1bW5IZWFkZXIocixpKSxuJiYobz1kKG4pLCghdCYmbz5zfHxvPnQpJiYodGhpcy53b3Qud3RWaWV3cG9ydC5vdmVyc2l6ZWRDb2x1bW5IZWFkZXJzW2ldPW8pKX0scmVuZGVyQ2VsbHM6ZnVuY3Rpb24oZSx0LG4pe2Zvcih2YXIgbyxpLHM9MDtuPnM7cysrKWk9dGhpcy5jb2x1bW5GaWx0ZXIucmVuZGVyZWRUb1NvdXJjZShzKSxvPTA9PT1zP3QuY2hpbGROb2Rlc1t0aGlzLmNvbHVtbkZpbHRlci5zb3VyY2VDb2x1bW5Ub1Zpc2libGVSb3dIZWFkZWRDb2x1bW4oaSldOm8ubmV4dFNpYmxpbmcsIlRIIj09by5ub2RlTmFtZSYmKG89cihvLHQpKSxjKG8sImhpZGUiKXx8KG8uY2xhc3NOYW1lPSIiKSxvLnJlbW92ZUF0dHJpYnV0ZSgic3R5bGUiKSx0aGlzLndvdC53dFNldHRpbmdzLnNldHRpbmdzLmNlbGxSZW5kZXJlcihlLGksbyk7cmV0dXJuIG99LGFkanVzdENvbHVtbldpZHRoczpmdW5jdGlvbihlKXt2YXIgdD0wLG49dGhpcy53b3QuY2xvbmVTb3VyY2U/dGhpcy53b3QuY2xvbmVTb3VyY2U6dGhpcy53b3Qsbz1uLnd0VGFibGUuaG9sZGVyO28ub2Zmc2V0SGVpZ2h0PG8uc2Nyb2xsSGVpZ2h0JiYodD11KCkpLHRoaXMud290Lnd0Vmlld3BvcnQuY29sdW1uc1JlbmRlckNhbGN1bGF0b3IucmVmcmVzaFN0cmV0Y2hpbmcodGhpcy53b3Qud3RWaWV3cG9ydC5nZXRWaWV3cG9ydFdpZHRoKCktdCk7Zm9yKHZhciByPTA7ZT5yO3IrKyl7dmFyIGk9dGhpcy53dFRhYmxlLmdldFN0cmV0Y2hlZENvbHVtbldpZHRoKHRoaXMuY29sdW1uRmlsdGVyLnJlbmRlcmVkVG9Tb3VyY2UocikpO3RoaXMuQ09MR1JPVVAuY2hpbGROb2Rlc1tyK3RoaXMucm93SGVhZGVyQ291bnRdLnN0eWxlLndpZHRoPWkrInB4In19LGFwcGVuZFRvVGJvZHk6ZnVuY3Rpb24oZSl7dGhpcy5UQk9EWS5hcHBlbmRDaGlsZChlKSx0aGlzLnd0VGFibGUudGJvZHlDaGlsZHJlbkxlbmd0aCsrfSxnZXRPckNyZWF0ZVRyRm9yUm93OmZ1bmN0aW9uKGUsdCl7dmFyIG47cmV0dXJuIGU+PXRoaXMud3RUYWJsZS50Ym9keUNoaWxkcmVuTGVuZ3RoPyhuPXRoaXMuY3JlYXRlUm93KCksdGhpcy5hcHBlbmRUb1Rib2R5KG4pKTpuPTA9PT1lP3RoaXMuVEJPRFkuZmlyc3RDaGlsZDp0Lm5leHRTaWJsaW5nLG4uY2xhc3NOYW1lJiZuLnJlbW92ZUF0dHJpYnV0ZSgiY2xhc3MiKSxufSxjcmVhdGVSb3c6ZnVuY3Rpb24oKXtmb3IodmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiVFIiKSx0PTA7dDx0aGlzLnJvd0hlYWRlckNvdW50O3QrKyllLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIlRIIikpO3JldHVybiBlfSxyZW5kZXJSb3dIZWFkZXI6ZnVuY3Rpb24oZSx0LG4pe24uY2xhc3NOYW1lPSIiLG4ucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpLHRoaXMucm93SGVhZGVyc1t0XShlLG4sdCl9LHJlbmRlclJvd0hlYWRlcnM6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49dC5maXJzdENoaWxkLHI9MDtyPHRoaXMucm93SGVhZGVyQ291bnQ7cisrKW4/IlREIj09bi5ub2RlTmFtZSYmKG49byhuLHQpKToobj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUSCIpLHQuYXBwZW5kQ2hpbGQobikpLHRoaXMucmVuZGVyUm93SGVhZGVyKGUscixuKSxuPW4ubmV4dFNpYmxpbmd9LGFkanVzdEF2YWlsYWJsZU5vZGVzOmZ1bmN0aW9uKCl7dGhpcy5hZGp1c3RDb2xHcm91cHMoKSx0aGlzLmFkanVzdFRoZWFkKCl9LHJlbmRlckNvbHVtbkhlYWRlcnM6ZnVuY3Rpb24oKXt0aGlzLndvdC5nZXRPdmVybGF5TmFtZSgpO2lmKHRoaXMuY29sdW1uSGVhZGVyQ291bnQpZm9yKHZhciBlPXRoaXMud3RUYWJsZS5nZXRSZW5kZXJlZENvbHVtbnNDb3VudCgpLHQ9MDt0PHRoaXMuY29sdW1uSGVhZGVyQ291bnQ7dCsrKWZvcih2YXIgbj10aGlzLmdldFRyRm9yQ29sdW1uSGVhZGVycyh0KSxvPS0xKnRoaXMucm93SGVhZGVyQ291bnQ7ZT5vO28rKyl7dmFyIHI9dGhpcy5jb2x1bW5GaWx0ZXIucmVuZGVyZWRUb1NvdXJjZShvKTt0aGlzLnJlbmRlckNvbHVtbkhlYWRlcih0LHIsbi5jaGlsZE5vZGVzW28rdGhpcy5yb3dIZWFkZXJDb3VudF0pfX0sYWRqdXN0Q29sR3JvdXBzOmZ1bmN0aW9uKCl7Zm9yKHZhciBlPXRoaXMud3RUYWJsZS5nZXRSZW5kZXJlZENvbHVtbnNDb3VudCgpO3RoaXMud3RUYWJsZS5jb2xncm91cENoaWxkcmVuTGVuZ3RoPGUrdGhpcy5yb3dIZWFkZXJDb3VudDspdGhpcy5DT0xHUk9VUC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJDT0wiKSksdGhpcy53dFRhYmxlLmNvbGdyb3VwQ2hpbGRyZW5MZW5ndGgrKztmb3IoO3RoaXMud3RUYWJsZS5jb2xncm91cENoaWxkcmVuTGVuZ3RoPmUrdGhpcy5yb3dIZWFkZXJDb3VudDspdGhpcy5DT0xHUk9VUC5yZW1vdmVDaGlsZCh0aGlzLkNPTEdST1VQLmxhc3RDaGlsZCksdGhpcy53dFRhYmxlLmNvbGdyb3VwQ2hpbGRyZW5MZW5ndGgtLTt0aGlzLnJvd0hlYWRlckNvdW50JiZhKHRoaXMuQ09MR1JPVVAuY2hpbGROb2Rlc1swXSwicm93SGVhZGVyIil9LGFkanVzdFRoZWFkOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy53dFRhYmxlLmdldFJlbmRlcmVkQ29sdW1uc0NvdW50KCksdD10aGlzLlRIRUFELmZpcnN0Q2hpbGQ7aWYodGhpcy5jb2x1bW5IZWFkZXJzLmxlbmd0aCl7Zm9yKHZhciBuPTAsbz10aGlzLmNvbHVtbkhlYWRlcnMubGVuZ3RoO28+bjtuKyspe2Zvcih0PXRoaXMuVEhFQUQuY2hpbGROb2Rlc1tuXSx0fHwodD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUUiIpLHRoaXMuVEhFQUQuYXBwZW5kQ2hpbGQodCkpLHRoaXMudGhlYWRDaGlsZHJlbkxlbmd0aD10LmNoaWxkTm9kZXMubGVuZ3RoO3RoaXMudGhlYWRDaGlsZHJlbkxlbmd0aDxlK3RoaXMucm93SGVhZGVyQ291bnQ7KXQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiVEgiKSksdGhpcy50aGVhZENoaWxkcmVuTGVuZ3RoKys7Zm9yKDt0aGlzLnRoZWFkQ2hpbGRyZW5MZW5ndGg+ZSt0aGlzLnJvd0hlYWRlckNvdW50Oyl0LnJlbW92ZUNoaWxkKHQubGFzdENoaWxkKSx0aGlzLnRoZWFkQ2hpbGRyZW5MZW5ndGgtLX12YXIgcj10aGlzLlRIRUFELmNoaWxkTm9kZXMubGVuZ3RoO2lmKHI+dGhpcy5jb2x1bW5IZWFkZXJzLmxlbmd0aClmb3IodmFyIGk9dGhpcy5jb2x1bW5IZWFkZXJzLmxlbmd0aDtyPmk7aSsrKXRoaXMuVEhFQUQucmVtb3ZlQ2hpbGQodGhpcy5USEVBRC5sYXN0Q2hpbGQpfWVsc2UgdCYmbCh0KX0sZ2V0VHJGb3JDb2x1bW5IZWFkZXJzOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLlRIRUFELmNoaWxkTm9kZXNbZV19LHJlbmRlckNvbHVtbkhlYWRlcjpmdW5jdGlvbihlLHQsbil7cmV0dXJuIG4uY2xhc3NOYW1lPSIiLG4ucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpLHRoaXMuY29sdW1uSGVhZGVyc1tlXSh0LG4sZSl9LGFkanVzdENvbHVtbnM6ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49ZS5jaGlsZE5vZGVzLmxlbmd0aDt0Pm47KXt2YXIgbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJURCIpO2UuYXBwZW5kQ2hpbGQobyksbisrfWZvcig7bj50OyllLnJlbW92ZUNoaWxkKGUubGFzdENoaWxkKSxuLS19LHJlbW92ZVJlZHVuZGFudENvbHVtbnM6ZnVuY3Rpb24oZSl7Zm9yKDt0aGlzLnd0VGFibGUudGJvZHlDaGlsZHJlbkxlbmd0aD5lOyl0aGlzLlRCT0RZLnJlbW92ZUNoaWxkKHRoaXMuVEJPRFkubGFzdENoaWxkKSx0aGlzLnd0VGFibGUudGJvZHlDaGlsZHJlbkxlbmd0aC0tfX0se30pLHdpbmRvdy5XYWxrb250YWJsZVRhYmxlUmVuZGVyZXI9aH0seyJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NX1dLDIyOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1dhbGtvbnRhYmxlVmlld3BvcnQ6e2dldDpmdW5jdGlvbigpe3JldHVybiB2fX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpLHMsYT0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxsPWEuZ2V0U2Nyb2xsYmFyV2lkdGgsdT1hLmdldFNjcm9sbFRvcCxjPWEuZ2V0U3R5bGUsZD1hLm9mZnNldCxoPWEub3V0ZXJIZWlnaHQsZj1hLm91dGVyV2lkdGgscD0ocj1lKCJldmVudE1hbmFnZXIiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLkV2ZW50TWFuYWdlcixnPShpPWUoImNhbGN1bGF0b3Ivdmlld3BvcnRDb2x1bW5zIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5XYWxrb250YWJsZVZpZXdwb3J0Q29sdW1uc0NhbGN1bGF0b3IsbT0ocz1lKCJjYWxjdWxhdG9yL3ZpZXdwb3J0Um93cyIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkuV2Fsa29udGFibGVWaWV3cG9ydFJvd3NDYWxjdWxhdG9yLHY9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpczt0aGlzLndvdD1lLHRoaXMuaW5zdGFuY2U9dGhpcy53b3QsdGhpcy5vdmVyc2l6ZWRSb3dzPVtdLHRoaXMub3ZlcnNpemVkQ29sdW1uSGVhZGVycz1bXSx0aGlzLmlzTWFya2VkT3ZlcnNpemVkQ29sdW1uPXt9LHRoaXMuY2xpZW50SGVpZ2h0PTAsdGhpcy5jb250YWluZXJXaWR0aD1OYU4sdGhpcy5yb3dIZWFkZXJXaWR0aD1OYU4sdGhpcy5yb3dzVmlzaWJsZUNhbGN1bGF0b3I9bnVsbCx0aGlzLmNvbHVtbnNWaXNpYmxlQ2FsY3VsYXRvcj1udWxsLHRoaXMuZXZlbnRNYW5hZ2VyPW5ldyBwKHRoaXMud290KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHdpbmRvdywicmVzaXplIixmdW5jdGlvbigpe3QuY2xpZW50SGVpZ2h0PXQuZ2V0V29ya3NwYWNlSGVpZ2h0KCl9KX07JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKHYse2dldFdvcmtzcGFjZUhlaWdodDpmdW5jdGlvbigpe3ZhciBlLHQ9dGhpcy5pbnN0YW5jZS53dE92ZXJsYXlzLnRvcE92ZXJsYXkudHJpbW1pbmdDb250YWluZXIsbj0wO3JldHVybiB0PT09d2luZG93P249ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDooZT1oKHQpLG49ZT4wJiZ0LmNsaWVudEhlaWdodD4wP3QuY2xpZW50SGVpZ2h0OjEvMCksbn0sZ2V0V29ya3NwYWNlV2lkdGg6ZnVuY3Rpb24oKXt2YXIgZSx0LG49dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5nKCJ0b3RhbENvbHVtbnMiKSxvPXRoaXMuaW5zdGFuY2Uud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS50cmltbWluZ0NvbnRhaW5lcixyPXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZygic3RyZXRjaEgiKSxpPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRXaWR0aDtyZXR1cm4gZT1IYW5kc29udGFibGUuZnJlZXplT3ZlcmxheXM/TWF0aC5taW4oaS10aGlzLmdldFdvcmtzcGFjZU9mZnNldCgpLmxlZnQsaSk6TWF0aC5taW4odGhpcy5nZXRDb250YWluZXJGaWxsV2lkdGgoKSxpLXRoaXMuZ2V0V29ya3NwYWNlT2Zmc2V0KCkubGVmdCxpKSxvPT09d2luZG93JiZuPjAmJnRoaXMuc3VtQ29sdW1uV2lkdGhzKDAsbi0xKT5lP2RvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDpvIT09d2luZG93JiYodD1jKHRoaXMuaW5zdGFuY2Uud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS50cmltbWluZ0NvbnRhaW5lciwib3ZlcmZsb3ciKSwic2Nyb2xsIj09dHx8ImhpZGRlbiI9PXR8fCJhdXRvIj09dCk/TWF0aC5tYXgoZSxvLmNsaWVudFdpZHRoKToibm9uZSIhPT1yJiZyP2U6TWF0aC5tYXgoZSxmKHRoaXMuaW5zdGFuY2Uud3RUYWJsZS5UQUJMRSkpfSxoYXNWZXJ0aWNhbFNjcm9sbDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldFdvcmtzcGFjZUFjdHVhbEhlaWdodCgpPnRoaXMuZ2V0V29ya3NwYWNlSGVpZ2h0KCl9LGhhc0hvcml6b250YWxTY3JvbGw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRXb3Jrc3BhY2VBY3R1YWxXaWR0aCgpPnRoaXMuZ2V0V29ya3NwYWNlV2lkdGgoKX0sc3VtQ29sdW1uV2lkdGhzOmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPTA7dD5lOyluKz10aGlzLndvdC53dFRhYmxlLmdldENvbHVtbldpZHRoKGUpLGUrKztyZXR1cm4gbn0sZ2V0Q29udGFpbmVyRmlsbFdpZHRoOmZ1bmN0aW9uKCl7aWYodGhpcy5jb250YWluZXJXaWR0aClyZXR1cm4gdGhpcy5jb250YWluZXJXaWR0aDt2YXIgZSx0LG49dGhpcy5pbnN0YW5jZS53dFRhYmxlLmhvbGRlcjtyZXR1cm4gdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSx0LnN0eWxlLndpZHRoPSIxMDAlIix0LnN0eWxlLmhlaWdodD0iMXB4IixuLmFwcGVuZENoaWxkKHQpLGU9dC5vZmZzZXRXaWR0aCx0aGlzLmNvbnRhaW5lcldpZHRoPWUsbi5yZW1vdmVDaGlsZCh0KSxlfSxnZXRXb3Jrc3BhY2VPZmZzZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZCh0aGlzLndvdC53dFRhYmxlLlRBQkxFKX0sZ2V0V29ya3NwYWNlQWN0dWFsSGVpZ2h0OmZ1bmN0aW9uKCl7cmV0dXJuIGgodGhpcy53b3Qud3RUYWJsZS5UQUJMRSl9LGdldFdvcmtzcGFjZUFjdHVhbFdpZHRoOmZ1bmN0aW9uKCl7cmV0dXJuIGYodGhpcy53b3Qud3RUYWJsZS5UQUJMRSl8fGYodGhpcy53b3Qud3RUYWJsZS5UQk9EWSl8fGYodGhpcy53b3Qud3RUYWJsZS5USEVBRCl9LGdldENvbHVtbkhlYWRlckhlaWdodDpmdW5jdGlvbigpe3JldHVybiBpc05hTih0aGlzLmNvbHVtbkhlYWRlckhlaWdodCkmJih0aGlzLmNvbHVtbkhlYWRlckhlaWdodD1oKHRoaXMud290Lnd0VGFibGUuVEhFQUQpKSx0aGlzLmNvbHVtbkhlYWRlckhlaWdodH0sZ2V0Vmlld3BvcnRIZWlnaHQ6ZnVuY3Rpb24oKXt2YXIgZSx0PXRoaXMuZ2V0V29ya3NwYWNlSGVpZ2h0KCk7cmV0dXJuIHQ9PT0xLzA/dDooZT10aGlzLmdldENvbHVtbkhlYWRlckhlaWdodCgpLGU+MCYmKHQtPWUpLHQpfSxnZXRSb3dIZWFkZXJXaWR0aDpmdW5jdGlvbigpe2lmKHRoaXMud290LmNsb25lU291cmNlKXJldHVybiB0aGlzLndvdC5jbG9uZVNvdXJjZS53dFZpZXdwb3J0LmdldFJvd0hlYWRlcldpZHRoKCk7aWYoaXNOYU4odGhpcy5yb3dIZWFkZXJXaWR0aCkpe3ZhciBlPXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZygicm93SGVhZGVycyIpO2lmKGUubGVuZ3RoKXt2YXIgdD10aGlzLmluc3RhbmNlLnd0VGFibGUuVEFCTEUucXVlcnlTZWxlY3RvcigiVEgiKTt0aGlzLnJvd0hlYWRlcldpZHRoPTA7Zm9yKHZhciBuPTAsbz1lLmxlbmd0aDtvPm47bisrKXQ/KHRoaXMucm93SGVhZGVyV2lkdGgrPWYodCksdD10Lm5leHRTaWJsaW5nKTp0aGlzLnJvd0hlYWRlcldpZHRoKz01MH1lbHNlIHRoaXMucm93SGVhZGVyV2lkdGg9MH1yZXR1cm4gdGhpcy5yb3dIZWFkZXJXaWR0aH0sZ2V0Vmlld3BvcnRXaWR0aDpmdW5jdGlvbigpe3ZhciBlLHQ9dGhpcy5nZXRXb3Jrc3BhY2VXaWR0aCgpO3JldHVybiB0PT09MS8wP3Q6KGU9dGhpcy5nZXRSb3dIZWFkZXJXaWR0aCgpLGU+MD90LWU6dCl9LGNyZWF0ZVJvd3NDYWxjdWxhdG9yOmZ1bmN0aW9uKCl7dmFyIGUsdCxuLG8scixpLHMsYT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiExLGM9dGhpcztyZXR1cm4gdGhpcy5yb3dIZWFkZXJXaWR0aD1OYU4sZT10aGlzLndvdC53dFNldHRpbmdzLnNldHRpbmdzLnJlbmRlckFsbFJvd3M/MS8wOnRoaXMuZ2V0Vmlld3BvcnRIZWlnaHQoKSx0PXUodGhpcy53b3Qud3RPdmVybGF5cy5tYWluVGFibGVTY3JvbGxhYmxlRWxlbWVudCktdGhpcy53b3Qud3RPdmVybGF5cy50b3BPdmVybGF5LmdldFRhYmxlUGFyZW50T2Zmc2V0KCksMD50JiYodD0wKSxuPXRoaXMud290LmdldFNldHRpbmcoImZpeGVkUm93c1RvcCIpLHI9dGhpcy53b3QuZ2V0U2V0dGluZygiZml4ZWRSb3dzQm90dG9tIikscz10aGlzLndvdC5nZXRTZXR0aW5nKCJ0b3RhbFJvd3MiKSxuJiYoaT10aGlzLndvdC53dE92ZXJsYXlzLnRvcE92ZXJsYXkuc3VtQ2VsbFNpemVzKDAsbiksdCs9aSxlLT1pKSxyJiZ0aGlzLndvdC53dE92ZXJsYXlzLmJvdHRvbU92ZXJsYXkuY2xvbmUmJihpPXRoaXMud290Lnd0T3ZlcmxheXMuYm90dG9tT3ZlcmxheS5zdW1DZWxsU2l6ZXMocy1yLHMpLGUtPWkpLG89dGhpcy53b3Qud3RUYWJsZS5ob2xkZXIuY2xpZW50SGVpZ2h0PT09dGhpcy53b3Qud3RUYWJsZS5ob2xkZXIub2Zmc2V0SGVpZ2h0PzA6bCgpLG5ldyBtKGUsdCx0aGlzLndvdC5nZXRTZXR0aW5nKCJ0b3RhbFJvd3MiKSxmdW5jdGlvbihlKXtyZXR1cm4gYy53b3Qud3RUYWJsZS5nZXRSb3dIZWlnaHQoZSl9LGE/bnVsbDp0aGlzLndvdC53dFNldHRpbmdzLnNldHRpbmdzLnZpZXdwb3J0Um93Q2FsY3VsYXRvck92ZXJyaWRlLGEsbyl9LGNyZWF0ZUNvbHVtbnNDYWxjdWxhdG9yOmZ1bmN0aW9uKCl7dmFyIGUsdCxuPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06ITEsbz10aGlzLHI9dGhpcy5nZXRWaWV3cG9ydFdpZHRoKCk7aWYodGhpcy5jb2x1bW5IZWFkZXJIZWlnaHQ9TmFOLGU9dGhpcy53b3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5nZXRTY3JvbGxQb3NpdGlvbigpLXRoaXMud290Lnd0T3ZlcmxheXMubGVmdE92ZXJsYXkuZ2V0VGFibGVQYXJlbnRPZmZzZXQoKSwwPmUmJihlPTApLHQ9dGhpcy53b3QuZ2V0U2V0dGluZygiZml4ZWRDb2x1bW5zTGVmdCIpKXt2YXIgaT10aGlzLndvdC53dE92ZXJsYXlzLmxlZnRPdmVybGF5LnN1bUNlbGxTaXplcygwLHQpO2UrPWksci09aX1yZXR1cm4gdGhpcy53b3Qud3RUYWJsZS5ob2xkZXIuY2xpZW50V2lkdGghPT10aGlzLndvdC53dFRhYmxlLmhvbGRlci5vZmZzZXRXaWR0aCYmKHItPWwoKSksbmV3IGcocixlLHRoaXMud290LmdldFNldHRpbmcoInRvdGFsQ29sdW1ucyIpLGZ1bmN0aW9uKGUpe3JldHVybiBvLndvdC53dFRhYmxlLmdldENvbHVtbldpZHRoKGUpfSxuP251bGw6dGhpcy53b3Qud3RTZXR0aW5ncy5zZXR0aW5ncy52aWV3cG9ydENvbHVtbkNhbGN1bGF0b3JPdmVycmlkZSxuLHRoaXMud290LmdldFNldHRpbmcoInN0cmV0Y2hIIikpfSxjcmVhdGVSZW5kZXJDYWxjdWxhdG9yczpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06ITE7aWYoZSl7dmFyIHQ9dGhpcy5jcmVhdGVSb3dzQ2FsY3VsYXRvcighMCksbj10aGlzLmNyZWF0ZUNvbHVtbnNDYWxjdWxhdG9yKCEwKTt0aGlzLmFyZUFsbFByb3Bvc2VkVmlzaWJsZVJvd3NBbHJlYWR5UmVuZGVyZWQodCkmJnRoaXMuYXJlQWxsUHJvcG9zZWRWaXNpYmxlQ29sdW1uc0FscmVhZHlSZW5kZXJlZChuKXx8KGU9ITEpfXJldHVybiBlfHwodGhpcy5yb3dzUmVuZGVyQ2FsY3VsYXRvcj10aGlzLmNyZWF0ZVJvd3NDYWxjdWxhdG9yKCksdGhpcy5jb2x1bW5zUmVuZGVyQ2FsY3VsYXRvcj10aGlzLmNyZWF0ZUNvbHVtbnNDYWxjdWxhdG9yKCkpLHRoaXMucm93c1Zpc2libGVDYWxjdWxhdG9yPW51bGwsdGhpcy5jb2x1bW5zVmlzaWJsZUNhbGN1bGF0b3I9bnVsbCxlfSxjcmVhdGVWaXNpYmxlQ2FsY3VsYXRvcnM6ZnVuY3Rpb24oKXt0aGlzLnJvd3NWaXNpYmxlQ2FsY3VsYXRvcj10aGlzLmNyZWF0ZVJvd3NDYWxjdWxhdG9yKCEwKSx0aGlzLmNvbHVtbnNWaXNpYmxlQ2FsY3VsYXRvcj10aGlzLmNyZWF0ZUNvbHVtbnNDYWxjdWxhdG9yKCEwKX0sYXJlQWxsUHJvcG9zZWRWaXNpYmxlUm93c0FscmVhZHlSZW5kZXJlZDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5yb3dzVmlzaWJsZUNhbGN1bGF0b3I/ZS5zdGFydFJvdzx0aGlzLnJvd3NSZW5kZXJDYWxjdWxhdG9yLnN0YXJ0Um93fHxlLnN0YXJ0Um93PT09dGhpcy5yb3dzUmVuZGVyQ2FsY3VsYXRvci5zdGFydFJvdyYmZS5zdGFydFJvdz4wPyExOmUuZW5kUm93PnRoaXMucm93c1JlbmRlckNhbGN1bGF0b3IuZW5kUm93fHxlLmVuZFJvdz09PXRoaXMucm93c1JlbmRlckNhbGN1bGF0b3IuZW5kUm93JiZlLmVuZFJvdzx0aGlzLndvdC5nZXRTZXR0aW5nKCJ0b3RhbFJvd3MiKS0xPyExOiEwOiExfSxhcmVBbGxQcm9wb3NlZFZpc2libGVDb2x1bW5zQWxyZWFkeVJlbmRlcmVkOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmNvbHVtbnNWaXNpYmxlQ2FsY3VsYXRvcj9lLnN0YXJ0Q29sdW1uPHRoaXMuY29sdW1uc1JlbmRlckNhbGN1bGF0b3Iuc3RhcnRDb2x1bW58fGUuc3RhcnRDb2x1bW49PT10aGlzLmNvbHVtbnNSZW5kZXJDYWxjdWxhdG9yLnN0YXJ0Q29sdW1uJiZlLnN0YXJ0Q29sdW1uPjA/ITE6ZS5lbmRDb2x1bW4+dGhpcy5jb2x1bW5zUmVuZGVyQ2FsY3VsYXRvci5lbmRDb2x1bW58fGUuZW5kQ29sdW1uPT09dGhpcy5jb2x1bW5zUmVuZGVyQ2FsY3VsYXRvci5lbmRDb2x1bW4mJmUuZW5kQ29sdW1uPHRoaXMud290LmdldFNldHRpbmcoInRvdGFsQ29sdW1ucyIpLTE/ITE6ITA6ITF9fSx7fSksd2luZG93LldhbGtvbnRhYmxlVmlld3BvcnQ9dn0seyJjYWxjdWxhdG9yL3ZpZXdwb3J0Q29sdW1ucyI6MywiY2FsY3VsYXRvci92aWV3cG9ydFJvd3MiOjQsZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NX1dLDIzOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO3ZhciBvLHIsaSxzLGEsbCx1LGMsZCxoLGYscCxnLG0sdix3LHksYixDO3dpbmRvdy5IYW5kc29udGFibGU9ZnVuY3Rpb24gSShlLHQpe3ZhciBuPW5ldyBJLkNvcmUoZSx0fHx7fSk7cmV0dXJuIG4uaW5pdCgpLG59LG89ZSgic2hpbXMvY2xhc3NlcyIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSxyPWUoImVzNmNvbGxlY3Rpb25zIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9O3ZhciBSPShpPWUoInBsdWdpbkhvb2tzIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5Ib29rcztIYW5kc29udGFibGUuaG9va3N8fChIYW5kc29udGFibGUuaG9va3M9bmV3IFIpLHM9ZSgiY29yZSIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSxhPWUoInJlbmRlcmVycy9fY2VsbERlY29yYXRvciIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSxsPWUoImNlbGxUeXBlcyIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSx1PWUoInBsdWdpbnMvanF1ZXJ5SGFuZHNvbnRhYmxlIiksdSYmdS5fX2VzTW9kdWxlJiZ1fHx7ImRlZmF1bHQiOnV9O3ZhciBfPShjPWUoImhlbHBlcnMvYXJyYXkiKSxjJiZjLl9fZXNNb2R1bGUmJmN8fHsiZGVmYXVsdCI6Y30pLFM9KGQ9ZSgiaGVscGVycy9icm93c2VyIiksZCYmZC5fX2VzTW9kdWxlJiZkfHx7ImRlZmF1bHQiOmR9KSxFPShoPWUoImhlbHBlcnMvZGF0YSIpLGgmJmguX19lc01vZHVsZSYmaHx8eyJkZWZhdWx0IjpofSksVD0oZj1lKCJoZWxwZXJzL2Z1bmN0aW9uIiksZiYmZi5fX2VzTW9kdWxlJiZmfHx7ImRlZmF1bHQiOmZ9KSxPPShwPWUoImhlbHBlcnMvbWl4ZWQiKSxwJiZwLl9fZXNNb2R1bGUmJnB8fHsiZGVmYXVsdCI6cH0pLE09KGc9ZSgiaGVscGVycy9udW1iZXIiKSxnJiZnLl9fZXNNb2R1bGUmJmd8fHsiZGVmYXVsdCI6Z30pLGs9KG09ZSgiaGVscGVycy9vYmplY3QiKSxtJiZtLl9fZXNNb2R1bGUmJm18fHsiZGVmYXVsdCI6bX0pLEg9KHY9ZSgiaGVscGVycy9zZXR0aW5nIiksdiYmdi5fX2VzTW9kdWxlJiZ2fHx7ImRlZmF1bHQiOnZ9KSxEPSh3PWUoImhlbHBlcnMvc3RyaW5nIiksdyYmdy5fX2VzTW9kdWxlJiZ3fHx7ImRlZmF1bHQiOnd9KSx4PSh5PWUoImhlbHBlcnMvdW5pY29kZSIpLHkmJnkuX19lc01vZHVsZSYmeXx8eyJkZWZhdWx0Ijp5fSksQT0oYj1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksYiYmYi5fX2VzTW9kdWxlJiZifHx7ImRlZmF1bHQiOmJ9KSxQPShDPWUoImhlbHBlcnMvZG9tL2V2ZW50IiksQyYmQy5fX2VzTW9kdWxlJiZDfHx7ImRlZmF1bHQiOkN9KSxOPVtfLFMsRSxULE8sTSxrLEgsRCx4XSxMPVtBLFBdO0hhbmRzb250YWJsZS5idWlsZERhdGU9IlRodSBOb3YgMTkgMjAxNSAxMDo1MTo1NiBHTVQrMDEwMCAoQ0VUKSIsSGFuZHNvbnRhYmxlLnBhY2thZ2VOYW1lPSJoYW5kc29udGFibGUiLEhhbmRzb250YWJsZS52ZXJzaW9uPSIwLjIwLjEiO3ZhciBXPSJAQGJhc2VWZXJzaW9uIjsvXkBALy50ZXN0KFcpfHwoSGFuZHNvbnRhYmxlLmJhc2VWZXJzaW9uPVcpLEhhbmRzb250YWJsZS5wbHVnaW5zPXt9LEhhbmRzb250YWJsZS5oZWxwZXI9e30sSGFuZHNvbnRhYmxlLmRvbT17fSxIYW5kc29udGFibGUuRG9tPUhhbmRzb250YWJsZS5kb20sXy5hcnJheUVhY2goTixmdW5jdGlvbihlKXtfLmFycmF5RWFjaChPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhlKSxmdW5jdGlvbih0KXsiXyIhPT10LmNoYXJBdCgwKSYmKEhhbmRzb250YWJsZS5oZWxwZXJbdF09ZVt0XSl9KX0pLF8uYXJyYXlFYWNoKEwsZnVuY3Rpb24oZSl7Xy5hcnJheUVhY2goT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZSksZnVuY3Rpb24odCl7Il8iIT09dC5jaGFyQXQoMCkmJihIYW5kc29udGFibGUuZG9tW3RdPWVbdF0pfSl9KX0se2NlbGxUeXBlczoyNCxjb3JlOjI1LGVzNmNvbGxlY3Rpb25zOiJlczZjb2xsZWN0aW9ucyIsImhlbHBlcnMvYXJyYXkiOjQyLCJoZWxwZXJzL2Jyb3dzZXIiOjQzLCJoZWxwZXJzL2RhdGEiOjQ0LCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy9kb20vZXZlbnQiOjQ2LCJoZWxwZXJzL2Z1bmN0aW9uIjo0NywiaGVscGVycy9taXhlZCI6NDgsImhlbHBlcnMvbnVtYmVyIjo0OSwiaGVscGVycy9vYmplY3QiOjUwLCJoZWxwZXJzL3NldHRpbmciOjUxLCJoZWxwZXJzL3N0cmluZyI6NTIsImhlbHBlcnMvdW5pY29kZSI6NTMscGx1Z2luSG9va3M6NTYsInBsdWdpbnMvanF1ZXJ5SGFuZHNvbnRhYmxlIjoxLCJyZW5kZXJlcnMvX2NlbGxEZWNvcmF0b3IiOjg5LCJzaGltcy9jbGFzc2VzIjo5Nn1dLDI0OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO3ZhciBvLHIsaSxzLGEsbCx1LGMsZCxoLGYscCxnLG0sdix3LHksYixDLFIsXyxTLEU9KG89ZSgiaGVscGVycy9icm93c2VyIiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KS5pc01vYmlsZUJyb3dzZXIsVD0ocj1lKCJlZGl0b3JzIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5nZXRFZGl0b3JDb25zdHJ1Y3RvcixPPShpPWUoInJlbmRlcmVycyIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuZ2V0UmVuZGVyZXI7KHM9ZSgiZWRpdG9ycy9hdXRvY29tcGxldGVFZGl0b3IiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLkF1dG9jb21wbGV0ZUVkaXRvciwoYT1lKCJlZGl0b3JzL2NoZWNrYm94RWRpdG9yIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5DaGVja2JveEVkaXRvciwobD1lKCJlZGl0b3JzL2RhdGVFZGl0b3IiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLkRhdGVFZGl0b3IsKHU9ZSgiZWRpdG9ycy9kcm9wZG93bkVkaXRvciIpLHUmJnUuX19lc01vZHVsZSYmdXx8eyJkZWZhdWx0Ijp1fSkuRHJvcGRvd25FZGl0b3IsKGM9ZSgiZWRpdG9ycy9oYW5kc29udGFibGVFZGl0b3IiKSxjJiZjLl9fZXNNb2R1bGUmJmN8fHsiZGVmYXVsdCI6Y30pLkhhbmRzb250YWJsZUVkaXRvciwoZD1lKCJlZGl0b3JzL21vYmlsZVRleHRFZGl0b3IiKSxkJiZkLl9fZXNNb2R1bGUmJmR8fHsiZGVmYXVsdCI6ZH0pLk1vYmlsZVRleHRFZGl0b3IsKGg9ZSgiZWRpdG9ycy9udW1lcmljRWRpdG9yIiksaCYmaC5fX2VzTW9kdWxlJiZofHx7ImRlZmF1bHQiOmh9KS5OdW1lcmljRWRpdG9yLChmPWUoImVkaXRvcnMvcGFzc3dvcmRFZGl0b3IiKSxmJiZmLl9fZXNNb2R1bGUmJmZ8fHsiZGVmYXVsdCI6Zn0pLlBhc3N3b3JkRWRpdG9yLChwPWUoImVkaXRvcnMvc2VsZWN0RWRpdG9yIikscCYmcC5fX2VzTW9kdWxlJiZwfHx7ImRlZmF1bHQiOnB9KS5TZWxlY3RFZGl0b3IsKGc9ZSgiZWRpdG9ycy90ZXh0RWRpdG9yIiksZyYmZy5fX2VzTW9kdWxlJiZnfHx7ImRlZmF1bHQiOmd9KS5UZXh0RWRpdG9yLChtPWUoInJlbmRlcmVycy9hdXRvY29tcGxldGVSZW5kZXJlciIpLG0mJm0uX19lc01vZHVsZSYmbXx8eyJkZWZhdWx0IjptfSkuQXV0b2NvbXBsZXRlUmVuZGVyZXIsKHY9ZSgicmVuZGVyZXJzL2NoZWNrYm94UmVuZGVyZXIiKSx2JiZ2Ll9fZXNNb2R1bGUmJnZ8fHsiZGVmYXVsdCI6dn0pLkNoZWNrYm94UmVuZGVyZXIsKHc9ZSgicmVuZGVyZXJzL2h0bWxSZW5kZXJlciIpLHcmJncuX19lc01vZHVsZSYmd3x8eyJkZWZhdWx0Ijp3fSkuSHRtbFJlbmRlcmVyLCh5PWUoInJlbmRlcmVycy9udW1lcmljUmVuZGVyZXIiKSx5JiZ5Ll9fZXNNb2R1bGUmJnl8fHsiZGVmYXVsdCI6eX0pLk51bWVyaWNSZW5kZXJlciwoYj1lKCJyZW5kZXJlcnMvcGFzc3dvcmRSZW5kZXJlciIpLGImJmIuX19lc01vZHVsZSYmYnx8eyJkZWZhdWx0IjpifSkuUGFzc3dvcmRSZW5kZXJlciwoQz1lKCJyZW5kZXJlcnMvdGV4dFJlbmRlcmVyIiksQyYmQy5fX2VzTW9kdWxlJiZDfHx7ImRlZmF1bHQiOkN9KS5UZXh0UmVuZGVyZXIsKFI9ZSgidmFsaWRhdG9ycy9hdXRvY29tcGxldGVWYWxpZGF0b3IiKSxSJiZSLl9fZXNNb2R1bGUmJlJ8fHsiZGVmYXVsdCI6Un0pLkF1dG9jb21wbGV0ZVZhbGlkYXRvciwoXz1lKCJ2YWxpZGF0b3JzL2RhdGVWYWxpZGF0b3IiKSxfJiZfLl9fZXNNb2R1bGUmJl98fHsiZGVmYXVsdCI6X30pLkRhdGVWYWxpZGF0b3IsKFM9ZSgidmFsaWRhdG9ycy9udW1lcmljVmFsaWRhdG9yIiksUyYmUy5fX2VzTW9kdWxlJiZTfHx7ImRlZmF1bHQiOlN9KS5OdW1lcmljVmFsaWRhdG9yO0hhbmRzb250YWJsZS5tb2JpbGVCcm93c2VyPUUoKSxIYW5kc29udGFibGUuQXV0b2NvbXBsZXRlQ2VsbD17ZWRpdG9yOlQoImF1dG9jb21wbGV0ZSIpLHJlbmRlcmVyOk8oImF1dG9jb21wbGV0ZSIpLHZhbGlkYXRvcjpIYW5kc29udGFibGUuQXV0b2NvbXBsZXRlVmFsaWRhdG9yfSxIYW5kc29udGFibGUuQ2hlY2tib3hDZWxsPXtlZGl0b3I6VCgiY2hlY2tib3giKSxyZW5kZXJlcjpPKCJjaGVja2JveCIpfSxIYW5kc29udGFibGUuVGV4dENlbGw9e2VkaXRvcjpUKEhhbmRzb250YWJsZS5tb2JpbGVCcm93c2VyPyJtb2JpbGUiOiJ0ZXh0IikscmVuZGVyZXI6TygidGV4dCIpfSxIYW5kc29udGFibGUuTnVtZXJpY0NlbGw9e2VkaXRvcjpUKCJudW1lcmljIikscmVuZGVyZXI6TygibnVtZXJpYyIpLHZhbGlkYXRvcjpIYW5kc29udGFibGUuTnVtZXJpY1ZhbGlkYXRvcixkYXRhVHlwZToibnVtYmVyIn0sSGFuZHNvbnRhYmxlLkRhdGVDZWxsPXtlZGl0b3I6VCgiZGF0ZSIpLHZhbGlkYXRvcjpIYW5kc29udGFibGUuRGF0ZVZhbGlkYXRvcixyZW5kZXJlcjpPKCJhdXRvY29tcGxldGUiKX0sSGFuZHNvbnRhYmxlLkhhbmRzb250YWJsZUNlbGw9e2VkaXRvcjpUKCJoYW5kc29udGFibGUiKSxyZW5kZXJlcjpPKCJhdXRvY29tcGxldGUiKX0sSGFuZHNvbnRhYmxlLlBhc3N3b3JkQ2VsbD17ZWRpdG9yOlQoInBhc3N3b3JkIikscmVuZGVyZXI6TygicGFzc3dvcmQiKSxjb3B5YWJsZTohMX0sSGFuZHNvbnRhYmxlLkRyb3Bkb3duQ2VsbD17ZWRpdG9yOlQoImRyb3Bkb3duIikscmVuZGVyZXI6TygiYXV0b2NvbXBsZXRlIiksdmFsaWRhdG9yOkhhbmRzb250YWJsZS5BdXRvY29tcGxldGVWYWxpZGF0b3J9LEhhbmRzb250YWJsZS5jZWxsVHlwZXM9e3RleHQ6SGFuZHNvbnRhYmxlLlRleHRDZWxsLGRhdGU6SGFuZHNvbnRhYmxlLkRhdGVDZWxsLG51bWVyaWM6SGFuZHNvbnRhYmxlLk51bWVyaWNDZWxsLGNoZWNrYm94OkhhbmRzb250YWJsZS5DaGVja2JveENlbGwsYXV0b2NvbXBsZXRlOkhhbmRzb250YWJsZS5BdXRvY29tcGxldGVDZWxsLGhhbmRzb250YWJsZTpIYW5kc29udGFibGUuSGFuZHNvbnRhYmxlQ2VsbCxwYXNzd29yZDpIYW5kc29udGFibGUuUGFzc3dvcmRDZWxsLGRyb3Bkb3duOkhhbmRzb250YWJsZS5Ecm9wZG93bkNlbGx9LEhhbmRzb250YWJsZS5jZWxsTG9va3VwPXt2YWxpZGF0b3I6e251bWVyaWM6SGFuZHNvbnRhYmxlLk51bWVyaWNWYWxpZGF0b3IsYXV0b2NvbXBsZXRlOkhhbmRzb250YWJsZS5BdXRvY29tcGxldGVWYWxpZGF0b3J9fX0se2VkaXRvcnM6MjksImVkaXRvcnMvYXV0b2NvbXBsZXRlRWRpdG9yIjozMSwiZWRpdG9ycy9jaGVja2JveEVkaXRvciI6MzIsImVkaXRvcnMvZGF0ZUVkaXRvciI6MzMsImVkaXRvcnMvZHJvcGRvd25FZGl0b3IiOjM0LCJlZGl0b3JzL2hhbmRzb250YWJsZUVkaXRvciI6MzUsImVkaXRvcnMvbW9iaWxlVGV4dEVkaXRvciI6MzYsImVkaXRvcnMvbnVtZXJpY0VkaXRvciI6MzcsImVkaXRvcnMvcGFzc3dvcmRFZGl0b3IiOjM4LCJlZGl0b3JzL3NlbGVjdEVkaXRvciI6MzksImVkaXRvcnMvdGV4dEVkaXRvciI6NDAsImhlbHBlcnMvYnJvd3NlciI6NDMscmVuZGVyZXJzOjg4LCJyZW5kZXJlcnMvYXV0b2NvbXBsZXRlUmVuZGVyZXIiOjkwLCJyZW5kZXJlcnMvY2hlY2tib3hSZW5kZXJlciI6OTEsInJlbmRlcmVycy9odG1sUmVuZGVyZXIiOjkyLCJyZW5kZXJlcnMvbnVtZXJpY1JlbmRlcmVyIjo5MywicmVuZGVyZXJzL3Bhc3N3b3JkUmVuZGVyZXIiOjk0LCJyZW5kZXJlcnMvdGV4dFJlbmRlcmVyIjo5NSwidmFsaWRhdG9ycy9hdXRvY29tcGxldGVWYWxpZGF0b3IiOjEwMCwidmFsaWRhdG9ycy9kYXRlVmFsaWRhdG9yIjoxMDEsInZhbGlkYXRvcnMvbnVtZXJpY1ZhbGlkYXRvciI6MTAyfV0sMjU6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7dmFyIG8scixpLHMsYSxsLHUsYyxkLGgsZixwLGcsbSx2LHcseSxiLEMsUj0obz1lKCJudW1lcmFsIiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KVsiZGVmYXVsdCJdLF89KHI9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksUz1fLmFkZENsYXNzLEU9Xy5lbXB0eSxUPV8uaXNDaGlsZE9mV2ViQ29tcG9uZW50VGFibGUsTz1fLnJlbW92ZUNsYXNzLE09KGk9ZSgiaGVscGVycy9zZXR0aW5nIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5jb2x1bW5GYWN0b3J5LGs9KHM9ZSgiZGF0YU1hcCIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkuRGF0YU1hcCxIPShhPWUoImVkaXRvck1hbmFnZXIiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLkVkaXRvck1hbmFnZXIsRD0obD1lKCJldmVudE1hbmFnZXIiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLmV2ZW50TWFuYWdlcix4PSh1PWUoImhlbHBlcnMvb2JqZWN0IiksdSYmdS5fX2VzTW9kdWxlJiZ1fHx7ImRlZmF1bHQiOnV9KSxBPXguZXh0ZW5kLFA9eC5kdWNrU2NoZW1hLE49eC5pc09iamVjdEVxdWFscyxMPXguZGVlcENsb25lLFc9KGM9ZSgiaGVscGVycy9hcnJheSIpLGMmJmMuX19lc01vZHVsZSYmY3x8eyJkZWZhdWx0IjpjfSkuYXJyYXlGbGF0dGVuLEk9KGQ9ZSgicGx1Z2lucyIpLGQmJmQuX19lc01vZHVsZSYmZHx8eyJkZWZhdWx0IjpkfSkuZ2V0UGx1Z2luLGo9KGg9ZSgicmVuZGVyZXJzIiksaCYmaC5fX2VzTW9kdWxlJiZofHx7ImRlZmF1bHQiOmh9KS5nZXRSZW5kZXJlcixCPShmPWUoImhlbHBlcnMvc3RyaW5nIiksZiYmZi5fX2VzTW9kdWxlJiZmfHx7ImRlZmF1bHQiOmZ9KS5yYW5kb21TdHJpbmcsRj0ocD1lKCJoZWxwZXJzL251bWJlciIpLHAmJnAuX19lc01vZHVsZSYmcHx8eyJkZWZhdWx0IjpwfSkucmFuZ2VFYWNoLFY9KGc9ZSgidGFibGVWaWV3IiksZyYmZy5fX2VzTW9kdWxlJiZnfHx7ImRlZmF1bHQiOmd9KS5UYWJsZVZpZXcsej0obT1lKCJkYXRhU291cmNlIiksbSYmbS5fX2VzTW9kdWxlJiZtfHx7ImRlZmF1bHQiOm19KS5EYXRhU291cmNlLFk9KHY9ZSgiaGVscGVycy9kYXRhIiksdiYmdi5fX2VzTW9kdWxlJiZ2fHx7ImRlZmF1bHQiOnZ9KSxVPVkudHJhbnNsYXRlUm93c1RvQ29sdW1ucyxHPVkuY2VsbE1ldGhvZExvb2t1cEZhY3RvcnksJD1ZLnNwcmVhZHNoZWV0Q29sdW1uTGFiZWwsSz0odz1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiKSx3JiZ3Ll9fZXNNb2R1bGUmJnd8fHsiZGVmYXVsdCI6d30pLldhbGtvbnRhYmxlQ2VsbENvb3JkcyxYPSh5PWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL3JhbmdlIikseSYmeS5fX2VzTW9kdWxlJiZ5fHx7ImRlZmF1bHQiOnl9KS5XYWxrb250YWJsZUNlbGxSYW5nZSxxPSgoYj1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvc2VsZWN0aW9uIiksYiYmYi5fX2VzTW9kdWxlJiZifHx7ImRlZmF1bHQiOmJ9KS5XYWxrb250YWJsZVNlbGVjdGlvbiwoQz1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2FsY3VsYXRvci92aWV3cG9ydENvbHVtbnMiKSxDJiZDLl9fZXNNb2R1bGUmJkN8fHsiZGVmYXVsdCI6Q30pLldhbGtvbnRhYmxlVmlld3BvcnRDb2x1bW5zQ2FsY3VsYXRvcik7SGFuZHNvbnRhYmxlLmFjdGl2ZUd1aWQ9bnVsbCxIYW5kc29udGFibGUuQ29yZT1mdW5jdGlvbihlLHQpe2Z1bmN0aW9uIG4oKXt2YXIgZT0hMTtyZXR1cm57dmFsaWRhdG9yc0luUXVldWU6MCx2YWxpZDohMCxhZGRWYWxpZGF0b3JUb1F1ZXVlOmZ1bmN0aW9uKCl7dGhpcy52YWxpZGF0b3JzSW5RdWV1ZSsrLGU9ITF9LHJlbW92ZVZhbGlkYXRvckZvcm1RdWV1ZTpmdW5jdGlvbigpe3RoaXMudmFsaWRhdG9yc0luUXVldWU9dGhpcy52YWxpZGF0b3JzSW5RdWV1ZS0xPDA/MDp0aGlzLnZhbGlkYXRvcnNJblF1ZXVlLTEsdGhpcy5jaGVja0lmUXVldWVJc0VtcHR5KCl9LG9uUXVldWVFbXB0eTpmdW5jdGlvbihlKXt9LGNoZWNrSWZRdWV1ZUlzRW1wdHk6ZnVuY3Rpb24oKXswPT10aGlzLnZhbGlkYXRvcnNJblF1ZXVlJiYwPT1lJiYoZT0hMCx0aGlzLm9uUXVldWVFbXB0eSh0aGlzLnZhbGlkKSl9fX1mdW5jdGlvbiBvKGUsdCxvKXtmdW5jdGlvbiByKCl7dmFyIG47ZS5sZW5ndGgmJihuPUhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYmVmb3JlQ2hhbmdlIixlLHQpLCJmdW5jdGlvbiI9PXR5cGVvZiBuP2NvbnNvbGUud2FybigiWW91ciBiZWZvcmVDaGFuZ2UgY2FsbGJhY2sgcmV0dXJucyBhIGZ1bmN0aW9uLiBJdCdzIG5vdCBzdXBwb3J0ZWQgc2luY2UgSGFuZHNvbnRhYmxlIDAuMTIuMSAoYW5kIHRoZSByZXR1cm5lZCBmdW5jdGlvbiB3aWxsIG5vdCBiZSBleGVjdXRlZCkuIik6bj09PSExJiZlLnNwbGljZSgwLGUubGVuZ3RoKSksbygpfXZhciBpPW5ldyBuO2kub25RdWV1ZUVtcHR5PXI7Zm9yKHZhciBzPWUubGVuZ3RoLTE7cz49MDtzLS0paWYobnVsbD09PWVbc10pZS5zcGxpY2UocywxKTtlbHNle3ZhciBhPWVbc11bMF0sbD1kLnByb3BUb0NvbChlW3NdWzFdKSx1PW0ucnVuSG9va3MoIm1vZGlmeUNvbCIsbCksYz1tLmdldENlbGxNZXRhKGEsdSk7aWYoIm51bWVyaWMiPT09Yy50eXBlJiYic3RyaW5nIj09dHlwZW9mIGVbc11bM10mJmVbc11bM10ubGVuZ3RoPjAmJigvXi0/W1xkXHNdKihcLnxcLCk/XGQqJC8udGVzdChlW3NdWzNdKXx8Yy5mb3JtYXQpKXt2YXIgaD1lW3NdWzNdLmxlbmd0aDsidW5kZWZpbmVkIj09dHlwZW9mIGMubGFuZ3VhZ2U/Ui5sYW5ndWFnZSgiZW4iKTplW3NdWzNdLmluZGV4T2YoIi4iKT09PWgtMyYmLTE9PT1lW3NdWzNdLmluZGV4T2YoIiwiKT9SLmxhbmd1YWdlKCJlbiIpOlIubGFuZ3VhZ2UoYy5sYW5ndWFnZSksUi52YWxpZGF0ZShlW3NdWzNdKSYmKGVbc11bM109UigpLnVuZm9ybWF0KGVbc11bM10pKX1tLmdldENlbGxWYWxpZGF0b3IoYykmJihpLmFkZFZhbGlkYXRvclRvUXVldWUoKSxtLnZhbGlkYXRlQ2VsbChlW3NdWzNdLGMsZnVuY3Rpb24odCxuKXtyZXR1cm4gZnVuY3Rpb24obyl7aWYoImJvb2xlYW4iIT10eXBlb2Ygbyl0aHJvdyBuZXcgRXJyb3IoIlZhbGlkYXRpb24gZXJyb3I6IHJlc3VsdCBpcyBub3QgYm9vbGVhbiIpO289PT0hMSYmbi5hbGxvd0ludmFsaWQ9PT0hMSYmKGUuc3BsaWNlKHQsMSksbi52YWxpZD0hMCwtLXQpLGkucmVtb3ZlVmFsaWRhdG9yRm9ybVF1ZXVlKCl9fShzLGMpLHQpKX1pLmNoZWNrSWZRdWV1ZUlzRW1wdHkoKX1mdW5jdGlvbiByKGUsdCl7dmFyIG49ZS5sZW5ndGgtMTtpZighKDA+bikpe2Zvcig7bj49MDtuLS0paWYobnVsbCE9PWVbbl0pe2lmKG51bGwhPWVbbl1bMl18fG51bGwhPWVbbl1bM10pe2lmKGMuc2V0dGluZ3MuYWxsb3dJbnNlcnRSb3cpZm9yKDtlW25dWzBdPm0uY291bnRSb3dzKCktMTspZC5jcmVhdGVSb3coKTtpZigiYXJyYXkiPT09bS5kYXRhVHlwZSYmYy5zZXR0aW5ncy5hbGxvd0luc2VydENvbHVtbilmb3IoO2QucHJvcFRvQ29sKGVbbl1bMV0pPm0uY291bnRDb2xzKCktMTspZC5jcmVhdGVDb2woKTtkLnNldChlW25dWzBdLGVbbl1bMV0sZVtuXVszXSl9fWVsc2UgZS5zcGxpY2UobiwxKTttLmZvcmNlRnVsbFJlbmRlcj0hMCxmLmFkanVzdFJvd3NBbmRDb2xzKCksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJiZWZvcmVDaGFuZ2VSZW5kZXIiLGUsdCksCnAucmVmcmVzaEJvcmRlcnMobnVsbCwhMCksbS52aWV3Lnd0Lnd0T3ZlcmxheXMuYWRqdXN0RWxlbWVudHNTaXplKCksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJhZnRlckNoYW5nZSIsZSx0fHwiZWRpdCIpfX1mdW5jdGlvbiBpKGUsdCxuKXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIGU/ZTpbW2UsdCxuXV19ZnVuY3Rpb24gcyhlKXtpZihlLmhhc093blByb3BlcnR5KCJ0eXBlIikpe3ZhciB0LG49e307aWYoIm9iamVjdCI9PXR5cGVvZiBlLnR5cGUpdD1lLnR5cGU7ZWxzZSBpZigic3RyaW5nIj09dHlwZW9mIGUudHlwZSYmKHQ9SGFuZHNvbnRhYmxlLmNlbGxUeXBlc1tlLnR5cGVdLHZvaWQgMD09PXQpKXRocm93IG5ldyBFcnJvcignWW91IGRlY2xhcmVkIGNlbGwgdHlwZSAiJytlLnR5cGUrJyIgYXMgYSBzdHJpbmcgdGhhdCBpcyBub3QgbWFwcGVkIHRvIGEga25vd24gb2JqZWN0LiBDZWxsIHR5cGUgbXVzdCBiZSBhbiBvYmplY3Qgb3IgYSBzdHJpbmcgbWFwcGVkIHRvIGFuIG9iamVjdCBpbiBIYW5kc29udGFibGUuY2VsbFR5cGVzJyk7Zm9yKHZhciBvIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShvKSYmIWUuaGFzT3duUHJvcGVydHkobykmJihuW29dPXRbb10pO3JldHVybiBufX1mdW5jdGlvbiBhKGUpe3JldHVybiBIYW5kc29udGFibGUuaG9va3MucnVuKG0sIm1vZGlmeVJvdyIsZSl9ZnVuY3Rpb24gbChlKXtyZXR1cm4gSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJtb2RpZnlDb2wiLGUpfWZ1bmN0aW9uIHUoKXt0aHJvdyBuZXcgRXJyb3IoIlRoaXMgbWV0aG9kIGNhbm5vdCBiZSBjYWxsZWQgYmVjYXVzZSB0aGlzIEhhbmRzb250YWJsZSBpbnN0YW5jZSBoYXMgYmVlbiBkZXN0cm95ZWQiKX12YXIgYyxkLGgsZixwLGcsbT10aGlzLHY9ZnVuY3Rpb24oKXt9LHc9RChtKTtBKHYucHJvdG90eXBlLFoucHJvdG90eXBlKSxBKHYucHJvdG90eXBlLHQpLEEodi5wcm90b3R5cGUscyh0KSksdGhpcy5yb290RWxlbWVudD1lLHRoaXMuaXNIb3RUYWJsZUVudj1UKHRoaXMucm9vdEVsZW1lbnQpLEhhbmRzb250YWJsZS5ldmVudE1hbmFnZXIuaXNIb3RUYWJsZUVudj10aGlzLmlzSG90VGFibGVFbnYsdGhpcy5jb250YWluZXI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdGhpcy5yZW5kZXJDYWxsPSExLGUuaW5zZXJ0QmVmb3JlKHRoaXMuY29udGFpbmVyLGUuZmlyc3RDaGlsZCksdGhpcy5ndWlkPSJodF8iK0IoKSx0aGlzLnJvb3RFbGVtZW50LmlkJiYiaHRfIiE9PXRoaXMucm9vdEVsZW1lbnQuaWQuc3Vic3RyaW5nKDAsMyl8fCh0aGlzLnJvb3RFbGVtZW50LmlkPXRoaXMuZ3VpZCksYz17Y2VsbFNldHRpbmdzOltdLGNvbHVtblNldHRpbmdzOltdLGNvbHVtbnNTZXR0aW5nQ29uZmxpY3RzOlsiZGF0YSIsIndpZHRoIl0sc2V0dGluZ3M6bmV3IHYsc2VsUmFuZ2U6bnVsbCxpc1BvcHVsYXRlZDpudWxsLHNjcm9sbGFibGU6bnVsbCxmaXJzdFJ1bjohMH0sZj17YWx0ZXI6ZnVuY3Rpb24oZSx0LG4sbyxyKXt2YXIgaTtzd2l0Y2gobj1ufHwxLGUpe2Nhc2UiaW5zZXJ0X3JvdyI6aWYobS5nZXRTZXR0aW5ncygpLm1heFJvd3M9PT1tLmNvdW50U291cmNlUm93cygpKXJldHVybjtpPWQuY3JlYXRlUm93KHQsbiksaSYmKHAuaXNTZWxlY3RlZCgpJiZjLnNlbFJhbmdlLmZyb20ucm93Pj10PyhjLnNlbFJhbmdlLmZyb20ucm93PWMuc2VsUmFuZ2UuZnJvbS5yb3craSxwLnRyYW5zZm9ybUVuZChpLDApKTpwLnJlZnJlc2hCb3JkZXJzKCkpO2JyZWFrO2Nhc2UiaW5zZXJ0X2NvbCI6aWYoaT1kLmNyZWF0ZUNvbCh0LG4pKXtpZihBcnJheS5pc0FycmF5KG0uZ2V0U2V0dGluZ3MoKS5jb2xIZWFkZXJzKSl7dmFyIHM9W3QsMF07cy5sZW5ndGgrPWksQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShtLmdldFNldHRpbmdzKCkuY29sSGVhZGVycyxzKX1wLmlzU2VsZWN0ZWQoKSYmYy5zZWxSYW5nZS5mcm9tLmNvbD49dD8oYy5zZWxSYW5nZS5mcm9tLmNvbD1jLnNlbFJhbmdlLmZyb20uY29sK2kscC50cmFuc2Zvcm1FbmQoMCxpKSk6cC5yZWZyZXNoQm9yZGVycygpfWJyZWFrO2Nhc2UicmVtb3ZlX3JvdyI6ZC5yZW1vdmVSb3codCxuKSxjLmNlbGxTZXR0aW5ncy5zcGxpY2UodCxuKTt2YXIgYT1tLmNvdW50Um93cygpLGw9bS5nZXRTZXR0aW5ncygpLmZpeGVkUm93c1RvcDtsPj10KzEmJihtLmdldFNldHRpbmdzKCkuZml4ZWRSb3dzVG9wLT1NYXRoLm1pbihuLGwtdCkpO3ZhciB1PW0uZ2V0U2V0dGluZ3MoKS5maXhlZFJvd3NCb3R0b207dSYmdCsxPj1hLXUmJihtLmdldFNldHRpbmdzKCkuZml4ZWRSb3dzQm90dG9tLT1NYXRoLm1pbihuLHUtdCkpLGYuYWRqdXN0Um93c0FuZENvbHMoKSxwLnJlZnJlc2hCb3JkZXJzKCk7YnJlYWs7Y2FzZSJyZW1vdmVfY29sIjpkLnJlbW92ZUNvbCh0LG4pO2Zvcih2YXIgaD0wLGc9ZC5nZXRBbGwoKS5sZW5ndGg7Zz5oO2grKyloIGluIGMuY2VsbFNldHRpbmdzJiZjLmNlbGxTZXR0aW5nc1toXS5zcGxpY2UodCxuKTt2YXIgdj1tLmdldFNldHRpbmdzKCkuZml4ZWRDb2x1bW5zTGVmdDt2Pj10KzEmJihtLmdldFNldHRpbmdzKCkuZml4ZWRDb2x1bW5zTGVmdC09TWF0aC5taW4obix2LXQpKSxBcnJheS5pc0FycmF5KG0uZ2V0U2V0dGluZ3MoKS5jb2xIZWFkZXJzKSYmKCJ1bmRlZmluZWQiPT10eXBlb2YgdCYmKHQ9LTEpLG0uZ2V0U2V0dGluZ3MoKS5jb2xIZWFkZXJzLnNwbGljZSh0LG4pKSxmLmFkanVzdFJvd3NBbmRDb2xzKCkscC5yZWZyZXNoQm9yZGVycygpO2JyZWFrO2RlZmF1bHQ6dGhyb3cgbmV3IEVycm9yKCdUaGVyZSBpcyBubyBzdWNoIGFjdGlvbiAiJytlKyciJyl9cnx8Zi5hZGp1c3RSb3dzQW5kQ29scygpfSxhZGp1c3RSb3dzQW5kQ29sczpmdW5jdGlvbigpe2lmKGMuc2V0dGluZ3MubWluUm93cyl7dmFyIGU9bS5jb3VudFJvd3MoKTtpZihlPGMuc2V0dGluZ3MubWluUm93cylmb3IodmFyIHQ9MCxuPWMuc2V0dGluZ3MubWluUm93cztuLWU+dDt0KyspZC5jcmVhdGVSb3cobS5jb3VudFJvd3MoKSwxLCEwKX1pZihjLnNldHRpbmdzLm1pblNwYXJlUm93cyl7dmFyIG89bS5jb3VudEVtcHR5Um93cyghMCk7aWYobzxjLnNldHRpbmdzLm1pblNwYXJlUm93cylmb3IoO288Yy5zZXR0aW5ncy5taW5TcGFyZVJvd3MmJm0uY291bnRSb3dzKCk8Yy5zZXR0aW5ncy5tYXhSb3dzO28rKylkLmNyZWF0ZVJvdyhtLmNvdW50Um93cygpLDEsITApfXZhciByO2lmKChjLnNldHRpbmdzLm1pbkNvbHN8fGMuc2V0dGluZ3MubWluU3BhcmVDb2xzKSYmKHI9bS5jb3VudEVtcHR5Q29scyghMCkpLGMuc2V0dGluZ3MubWluQ29scyYmIWMuc2V0dGluZ3MuY29sdW1ucyYmbS5jb3VudENvbHMoKTxjLnNldHRpbmdzLm1pbkNvbHMpZm9yKDttLmNvdW50Q29scygpPGMuc2V0dGluZ3MubWluQ29scztyKyspZC5jcmVhdGVDb2wobS5jb3VudENvbHMoKSwxLCEwKTtpZihjLnNldHRpbmdzLm1pblNwYXJlQ29scyYmIWMuc2V0dGluZ3MuY29sdW1ucyYmImFycmF5Ij09PW0uZGF0YVR5cGUmJnI8Yy5zZXR0aW5ncy5taW5TcGFyZUNvbHMpZm9yKDtyPGMuc2V0dGluZ3MubWluU3BhcmVDb2xzJiZtLmNvdW50Q29scygpPGMuc2V0dGluZ3MubWF4Q29scztyKyspZC5jcmVhdGVDb2wobS5jb3VudENvbHMoKSwxLCEwKTt2YXIgaT1tLmNvdW50Um93cygpLHM9bS5jb3VudENvbHMoKTtpZigoMD09PWl8fDA9PT1zKSYmcC5kZXNlbGVjdCgpLHAuaXNTZWxlY3RlZCgpKXt2YXIgYT0hMSxsPWMuc2VsUmFuZ2UuZnJvbS5yb3csdT1jLnNlbFJhbmdlLmZyb20uY29sLGg9Yy5zZWxSYW5nZS50by5yb3csZj1jLnNlbFJhbmdlLnRvLmNvbDtsPmktMT8obD1pLTEsYT0hMCxoPmwmJihoPWwpKTpoPmktMSYmKGg9aS0xLGE9ITAsbD5oJiYobD1oKSksdT5zLTE/KHU9cy0xLGE9ITAsZj51JiYoZj11KSk6Zj5zLTEmJihmPXMtMSxhPSEwLHU+ZiYmKHU9ZikpLGEmJm0uc2VsZWN0Q2VsbChsLHUsaCxmKX1tLnZpZXcmJm0udmlldy53dC53dE92ZXJsYXlzLmFkanVzdEVsZW1lbnRzU2l6ZSgpfSxwb3B1bGF0ZUZyb21BcnJheTpmdW5jdGlvbihlLHQsbixvLHIsaSxzKXt2YXIgYSxsLHUsZCxoPVtdLGY9e307aWYobD10Lmxlbmd0aCwwPT09bClyZXR1cm4hMTt2YXIgcCxnLHYsdzsoe3JvdzpudWxsPT09bj9udWxsOm4ucm93LGNvbDpudWxsPT09bj9udWxsOm4uY29sfSk7c3dpdGNoKHIpe2Nhc2Uic2hpZnRfZG93biI6Zm9yKHA9bj9uLmNvbC1lLmNvbCsxOjAsZz1uP24ucm93LWUucm93KzE6MCx0PVUodCksdT0wLGQ9dC5sZW5ndGgsdj1NYXRoLm1heChkLHApO3Y+dTt1KyspaWYoZD51KXtmb3IoYT0wLGw9dFt1XS5sZW5ndGg7Zy1sPmE7YSsrKXRbdV0ucHVzaCh0W3VdW2ElbF0pO3RbdV0udW5zaGlmdChlLmNvbCt1LGUucm93LDApLG0uc3BsaWNlQ29sLmFwcGx5KG0sdFt1XSl9ZWxzZSB0W3UlZF1bMF09ZS5jb2wrdSxtLnNwbGljZUNvbC5hcHBseShtLHRbdSVkXSk7YnJlYWs7Y2FzZSJzaGlmdF9yaWdodCI6Zm9yKHA9bj9uLmNvbC1lLmNvbCsxOjAsZz1uP24ucm93LWUucm93KzE6MCxhPTAsbD10Lmxlbmd0aCx3PU1hdGgubWF4KGwsZyk7dz5hO2ErKylpZihsPmEpe2Zvcih1PTAsZD10W2FdLmxlbmd0aDtwLWQ+dTt1KyspdFthXS5wdXNoKHRbYV1bdSVkXSk7dFthXS51bnNoaWZ0KGUucm93K2EsZS5jb2wsMCksbS5zcGxpY2VSb3cuYXBwbHkobSx0W2FdKX1lbHNlIHRbYSVsXVswXT1lLnJvdythLG0uc3BsaWNlUm93LmFwcGx5KG0sdFthJWxdKTticmVhaztjYXNlIm92ZXJ3cml0ZSI6ZGVmYXVsdDpmLnJvdz1lLnJvdyxmLmNvbD1lLmNvbDt2YXIgeSxiPXtyb3c6biYmZT9uLnJvdy1lLnJvdysxOjEsY29sOm4mJmU/bi5jb2wtZS5jb2wrMToxfSxDPTAsUj0wLF89ITAsUz1mdW5jdGlvbihlKXt2YXIgbj12b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOm51bGwsbz10W2UldC5sZW5ndGhdO3JldHVybiBudWxsIT09bj9vW24lby5sZW5ndGhdOm99LEU9dC5sZW5ndGgsVD1uP24ucm93LWUucm93KzE6MDtmb3IobD1uP1Q6TWF0aC5tYXgoRSxUKSxhPTA7bD5hJiYhKG4mJmYucm93Pm4ucm93JiZUPkV8fCFjLnNldHRpbmdzLmFsbG93SW5zZXJ0Um93JiZmLnJvdz5tLmNvdW50Um93cygpLTF8fGYucm93Pj1jLnNldHRpbmdzLm1heFJvd3MpO2ErKyl7dmFyIE89YS1DLE09UyhPKS5sZW5ndGgsaz1uP24uY29sLWUuY29sKzE6MDtpZihkPW4/azpNYXRoLm1heChNLGspLGYuY29sPWUuY29sLHk9bS5nZXRDZWxsTWV0YShmLnJvdyxmLmNvbCksInBhc3RlIiE9PW8mJiJhdXRvZmlsbCIhPT1vfHwheS5za2lwUm93T25QYXN0ZSl7Zm9yKFI9MCx1PTA7ZD51JiYhKG4mJmYuY29sPm4uY29sJiZrPk18fCFjLnNldHRpbmdzLmFsbG93SW5zZXJ0Q29sdW1uJiZmLmNvbD5tLmNvdW50Q29scygpLTF8fGYuY29sPj1jLnNldHRpbmdzLm1heENvbHMpO3UrKylpZih5PW0uZ2V0Q2VsbE1ldGEoZi5yb3csZi5jb2wpLCJwYXN0ZSIhPT1vJiYiYXV0b2ZpbGwiIT09b3x8IXkuc2tpcENvbHVtbk9uUGFzdGUpaWYoeS5yZWFkT25seSlmLmNvbCsrO2Vsc2V7dmFyIEg9dS1SLEQ9UyhPLEgpLHg9bS5nZXREYXRhQXRDZWxsKGYucm93LGYuY29sKSxBPXtyb3c6Tyxjb2w6SH07aWYoImF1dG9maWxsIj09PW8pe3ZhciBXPW0ucnVuSG9va3MoImJlZm9yZUF1dG9maWxsSW5zaWRlUG9wdWxhdGUiLEEsaSx0LHMse30sYik7VyYmKEQ9InVuZGVmaW5lZCI9PXR5cGVvZiBXLnZhbHVlP0Q6Vy52YWx1ZSl9aWYobnVsbCE9PUQmJiJvYmplY3QiPT10eXBlb2YgRClpZihudWxsPT09eHx8Im9iamVjdCIhPXR5cGVvZiB4KV89ITE7ZWxzZXt2YXIgST1QKHhbMF18fHgpLGo9UChEWzBdfHxEKTtOKEksaik/RD1MKEQpOl89ITF9ZWxzZSBudWxsIT09eCYmIm9iamVjdCI9PXR5cGVvZiB4JiYoXz0hMSk7XyYmaC5wdXNoKFtmLnJvdyxmLmNvbCxEXSksXz0hMCxmLmNvbCsrfWVsc2UgUisrLGYuY29sKyssZCsrO2Yucm93Kyt9ZWxzZSBDKyssZi5yb3crKyxsKyt9bS5zZXREYXRhQXRDZWxsKGgsbnVsbCxudWxsLG98fCJwb3B1bGF0ZUZyb21BcnJheSIpfX19LHRoaXMuc2VsZWN0aW9uPXA9e2luUHJvZ3Jlc3M6ITEsc2VsZWN0ZWRIZWFkZXI6e2NvbHM6ITEscm93czohMX0sc2V0U2VsZWN0ZWRIZWFkZXJzOmZ1bmN0aW9uKGUsdCl7bS5zZWxlY3Rpb24uc2VsZWN0ZWRIZWFkZXIucm93cz1lLG0uc2VsZWN0aW9uLnNlbGVjdGVkSGVhZGVyLmNvbHM9dH0sYmVnaW46ZnVuY3Rpb24oKXttLnNlbGVjdGlvbi5pblByb2dyZXNzPSEwfSxmaW5pc2g6ZnVuY3Rpb24oKXt2YXIgZT1tLmdldFNlbGVjdGVkKCk7SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJhZnRlclNlbGVjdGlvbkVuZCIsZVswXSxlWzFdLGVbMl0sZVszXSksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJhZnRlclNlbGVjdGlvbkVuZEJ5UHJvcCIsZVswXSxtLmNvbFRvUHJvcChlWzFdKSxlWzJdLG0uY29sVG9Qcm9wKGVbM10pKSxtLnNlbGVjdGlvbi5pblByb2dyZXNzPSExfSxpc0luUHJvZ3Jlc3M6ZnVuY3Rpb24oKXtyZXR1cm4gbS5zZWxlY3Rpb24uaW5Qcm9ncmVzc30sc2V0UmFuZ2VTdGFydDpmdW5jdGlvbihlLHQpe0hhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYmVmb3JlU2V0UmFuZ2VTdGFydCIsZSksYy5zZWxSYW5nZT1uZXcgWChlLGUsZSkscC5zZXRSYW5nZUVuZChlLG51bGwsdCl9LHNldFJhbmdlRW5kOmZ1bmN0aW9uKGUsdCxuKXtpZihudWxsIT09Yy5zZWxSYW5nZSl7dmFyIG8scj0hMSxpPSEwLHM9bS52aWV3Lnd0Lnd0VGFibGUuZ2V0Rmlyc3RWaXNpYmxlUm93KCksYT1tLnZpZXcud3Qud3RUYWJsZS5nZXRGaXJzdFZpc2libGVDb2x1bW4oKSxsPXtyb3c6bnVsbCxjb2w6bnVsbH07SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJiZWZvcmVTZXRSYW5nZUVuZCIsZSksbS5zZWxlY3Rpb24uYmVnaW4oKSxsLnJvdz1lLnJvdzwwP3M6ZS5yb3csbC5jb2w9ZS5jb2w8MD9hOmUuY29sLGMuc2VsUmFuZ2UudG89bmV3IEsobC5yb3csbC5jb2wpLGMuc2V0dGluZ3MubXVsdGlTZWxlY3R8fChjLnNlbFJhbmdlLmZyb209ZSksbS52aWV3Lnd0LnNlbGVjdGlvbnMuY3VycmVudC5jbGVhcigpLG89bS5nZXRDZWxsTWV0YShjLnNlbFJhbmdlLmhpZ2hsaWdodC5yb3csYy5zZWxSYW5nZS5oaWdobGlnaHQuY29sKS5kaXNhYmxlVmlzdWFsU2VsZWN0aW9uLCJzdHJpbmciPT10eXBlb2YgbyYmKG89W29dKSwobz09PSExfHxBcnJheS5pc0FycmF5KG8pJiYtMT09PW8uaW5kZXhPZigiY3VycmVudCIpKSYmbS52aWV3Lnd0LnNlbGVjdGlvbnMuY3VycmVudC5hZGQoYy5zZWxSYW5nZS5oaWdobGlnaHQpLG0udmlldy53dC5zZWxlY3Rpb25zLmFyZWEuY2xlYXIoKSwobz09PSExfHxBcnJheS5pc0FycmF5KG8pJiYtMT09PW8uaW5kZXhPZigiYXJlYSIpKSYmcC5pc011bHRpcGxlKCkmJihtLnZpZXcud3Quc2VsZWN0aW9ucy5hcmVhLmFkZChjLnNlbFJhbmdlLmZyb20pLG0udmlldy53dC5zZWxlY3Rpb25zLmFyZWEuYWRkKGMuc2VsUmFuZ2UudG8pKSwoYy5zZXR0aW5ncy5jdXJyZW50Um93Q2xhc3NOYW1lfHxjLnNldHRpbmdzLmN1cnJlbnRDb2xDbGFzc05hbWUpJiYobS52aWV3Lnd0LnNlbGVjdGlvbnMuaGlnaGxpZ2h0LmNsZWFyKCksbS52aWV3Lnd0LnNlbGVjdGlvbnMuaGlnaGxpZ2h0LmFkZChjLnNlbFJhbmdlLmZyb20pLG0udmlldy53dC5zZWxlY3Rpb25zLmhpZ2hsaWdodC5hZGQoYy5zZWxSYW5nZS50bykpLEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJTZWxlY3Rpb24iLGMuc2VsUmFuZ2UuZnJvbS5yb3csYy5zZWxSYW5nZS5mcm9tLmNvbCxjLnNlbFJhbmdlLnRvLnJvdyxjLnNlbFJhbmdlLnRvLmNvbCksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJhZnRlclNlbGVjdGlvbkJ5UHJvcCIsYy5zZWxSYW5nZS5mcm9tLnJvdyxkLmNvbFRvUHJvcChjLnNlbFJhbmdlLmZyb20uY29sKSxjLnNlbFJhbmdlLnRvLnJvdyxkLmNvbFRvUHJvcChjLnNlbFJhbmdlLnRvLmNvbCkpLCgwPT09Yy5zZWxSYW5nZS5mcm9tLnJvdyYmYy5zZWxSYW5nZS50by5yb3c9PT1tLmNvdW50Um93cygpLTEmJm0uY291bnRSb3dzKCk+MXx8MD09PWMuc2VsUmFuZ2UuZnJvbS5jb2wmJmMuc2VsUmFuZ2UudG8uY29sPT09bS5jb3VudENvbHMoKS0xJiZtLmNvdW50Q29scygpPjEpJiYocj0hMCksKGUucm93PDB8fGUuY29sPDApJiYoaT0hMSksdCE9PSExJiYhciYmaSYmKGMuc2VsUmFuZ2UuZnJvbSYmIXAuaXNNdWx0aXBsZSgpP20udmlldy5zY3JvbGxWaWV3cG9ydChjLnNlbFJhbmdlLmZyb20pOm0udmlldy5zY3JvbGxWaWV3cG9ydChlKSkscC5yZWZyZXNoQm9yZGVycyhudWxsLG4pfX0scmVmcmVzaEJvcmRlcnM6ZnVuY3Rpb24oZSx0KXt0fHxnLmRlc3Ryb3lFZGl0b3IoZSksbS52aWV3LnJlbmRlcigpLHAuaXNTZWxlY3RlZCgpJiYhdCYmZy5wcmVwYXJlRWRpdG9yKCl9LGlzTXVsdGlwbGU6ZnVuY3Rpb24oKXt2YXIgZT0hKGMuc2VsUmFuZ2UudG8uY29sPT09Yy5zZWxSYW5nZS5mcm9tLmNvbCYmYy5zZWxSYW5nZS50by5yb3c9PT1jLnNlbFJhbmdlLmZyb20ucm93KSx0PUhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJJc011bHRpcGxlU2VsZWN0aW9uIixlKTtyZXR1cm4gZT90OnZvaWQgMH0sdHJhbnNmb3JtU3RhcnQ6ZnVuY3Rpb24oZSx0LG4sbyl7dmFyIHIsaSxzLGEsbD1uZXcgSyhlLHQpLHU9MCxkPTA7bS5ydW5Ib29rcygibW9kaWZ5VHJhbnNmb3JtU3RhcnQiLGwpLHI9bS5jb3VudFJvd3MoKSxpPW0uY291bnRDb2xzKCksYT1tLmdldFNldHRpbmdzKCkuZml4ZWRSb3dzQm90dG9tLGMuc2VsUmFuZ2UuaGlnaGxpZ2h0LnJvdytlPnItMT9uJiZjLnNldHRpbmdzLm1pblNwYXJlUm93cz4wJiYhKGEmJmMuc2VsUmFuZ2UuaGlnaGxpZ2h0LnJvdz49ci1hLTEpPyhtLmFsdGVyKCJpbnNlcnRfcm93IixyKSxyPW0uY291bnRSb3dzKCkpOmMuc2V0dGluZ3MuYXV0b1dyYXBDb2wmJihsLnJvdz0xLXIsbC5jb2w9Yy5zZWxSYW5nZS5oaWdobGlnaHQuY29sK2wuY29sPT1pLTE/MS1pOjEpOmMuc2V0dGluZ3MuYXV0b1dyYXBDb2wmJmMuc2VsUmFuZ2UuaGlnaGxpZ2h0LnJvdytsLnJvdzwwJiZjLnNlbFJhbmdlLmhpZ2hsaWdodC5jb2wrbC5jb2w+PTAmJihsLnJvdz1yLTEsbC5jb2w9Yy5zZWxSYW5nZS5oaWdobGlnaHQuY29sK2wuY29sPT0wP2ktMTotMSksYy5zZWxSYW5nZS5oaWdobGlnaHQuY29sK2wuY29sPmktMT9uJiZjLnNldHRpbmdzLm1pblNwYXJlQ29scz4wPyhtLmFsdGVyKCJpbnNlcnRfY29sIixpKSxpPW0uY291bnRDb2xzKCkpOmMuc2V0dGluZ3MuYXV0b1dyYXBSb3cmJihsLnJvdz1jLnNlbFJhbmdlLmhpZ2hsaWdodC5yb3crbC5yb3c9PXItMT8xLXI6MSxsLmNvbD0xLWkpOmMuc2V0dGluZ3MuYXV0b1dyYXBSb3cmJmMuc2VsUmFuZ2UuaGlnaGxpZ2h0LmNvbCtsLmNvbDwwJiZjLnNlbFJhbmdlLmhpZ2hsaWdodC5yb3crbC5yb3c+PTAmJihsLnJvdz1jLnNlbFJhbmdlLmhpZ2hsaWdodC5yb3crbC5yb3c9PTA/ci0xOi0xLGwuY29sPWktMSkscz1uZXcgSyhjLnNlbFJhbmdlLmhpZ2hsaWdodC5yb3crbC5yb3csYy5zZWxSYW5nZS5oaWdobGlnaHQuY29sK2wuY29sKSxzLnJvdzwwPyh1PS0xLHMucm93PTApOnMucm93PjAmJnMucm93Pj1yJiYodT0xLHMucm93PXItMSkscy5jb2w8MD8oZD0tMSxzLmNvbD0wKTpzLmNvbD4wJiZzLmNvbD49aSYmKGQ9MSxzLmNvbD1pLTEpLG0ucnVuSG9va3MoImFmdGVyTW9kaWZ5VHJhbnNmb3JtU3RhcnQiLHMsdSxkKSxwLnNldFJhbmdlU3RhcnQocyxvKX0sdHJhbnNmb3JtRW5kOmZ1bmN0aW9uKGUsdCl7dmFyIG4sbyxyLGk9bmV3IEsoZSx0KSxzPTAsYT0wO20ucnVuSG9va3MoIm1vZGlmeVRyYW5zZm9ybUVuZCIsaSksbj1tLmNvdW50Um93cygpLG89bS5jb3VudENvbHMoKSxyPW5ldyBLKGMuc2VsUmFuZ2UudG8ucm93K2kucm93LGMuc2VsUmFuZ2UudG8uY29sK2kuY29sKSxyLnJvdzwwPyhzPS0xLHIucm93PTApOnIucm93PjAmJnIucm93Pj1uJiYocz0xLHIucm93PW4tMSksci5jb2w8MD8oYT0tMSxyLmNvbD0wKTpyLmNvbD4wJiZyLmNvbD49byYmKGE9MSxyLmNvbD1vLTEpLG0ucnVuSG9va3MoImFmdGVyTW9kaWZ5VHJhbnNmb3JtRW5kIixyLHMsYSkscC5zZXRSYW5nZUVuZChyLCEwKX0saXNTZWxlY3RlZDpmdW5jdGlvbigpe3JldHVybiBudWxsIT09Yy5zZWxSYW5nZX0saW5JblNlbGVjdGlvbjpmdW5jdGlvbihlKXtyZXR1cm4gcC5pc1NlbGVjdGVkKCk/Yy5zZWxSYW5nZS5pbmNsdWRlcyhlKTohMX0sZGVzZWxlY3Q6ZnVuY3Rpb24oKXtwLmlzU2VsZWN0ZWQoKSYmKG0uc2VsZWN0aW9uLmluUHJvZ3Jlc3M9ITEsYy5zZWxSYW5nZT1udWxsLG0udmlldy53dC5zZWxlY3Rpb25zLmN1cnJlbnQuY2xlYXIoKSxtLnZpZXcud3Quc2VsZWN0aW9ucy5hcmVhLmNsZWFyKCksKGMuc2V0dGluZ3MuY3VycmVudFJvd0NsYXNzTmFtZXx8Yy5zZXR0aW5ncy5jdXJyZW50Q29sQ2xhc3NOYW1lKSYmbS52aWV3Lnd0LnNlbGVjdGlvbnMuaGlnaGxpZ2h0LmNsZWFyKCksZy5kZXN0cm95RWRpdG9yKCkscC5yZWZyZXNoQm9yZGVycygpLEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJEZXNlbGVjdCIpKX0sc2VsZWN0QWxsOmZ1bmN0aW9uKCl7Yy5zZXR0aW5ncy5tdWx0aVNlbGVjdCYmKHAuc2V0UmFuZ2VTdGFydChuZXcgSygwLDApKSxwLnNldFJhbmdlRW5kKG5ldyBLKG0uY291bnRSb3dzKCktMSxtLmNvdW50Q29scygpLTEpLCExKSl9LGVtcHR5OmZ1bmN0aW9uKCl7aWYocC5pc1NlbGVjdGVkKCkpe3ZhciBlLHQsbj1jLnNlbFJhbmdlLmdldFRvcExlZnRDb3JuZXIoKSxvPWMuc2VsUmFuZ2UuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKSxyPVtdO2ZvcihlPW4ucm93O2U8PW8ucm93O2UrKylmb3IodD1uLmNvbDt0PD1vLmNvbDt0KyspbS5nZXRDZWxsTWV0YShlLHQpLnJlYWRPbmx5fHxyLnB1c2goW2UsdCwiIl0pO20uc2V0RGF0YUF0Q2VsbChyKX19fSx0aGlzLmluaXQ9ZnVuY3Rpb24oKXtoPW5ldyB6KG0sYy5zZXR0aW5ncy5kYXRhKSxIYW5kc29udGFibGUuaG9va3MucnVuKG0sImJlZm9yZUluaXQiKSxIYW5kc29udGFibGUubW9iaWxlQnJvd3NlciYmUyhtLnJvb3RFbGVtZW50LCJtb2JpbGUiKSx0aGlzLnVwZGF0ZVNldHRpbmdzKGMuc2V0dGluZ3MsITApLHRoaXMudmlldz1uZXcgVih0aGlzKSxnPW5ldyBIKG0sYyxwLGQpLHRoaXMuZm9yY2VGdWxsUmVuZGVyPSEwLEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiaW5pdCIpLHRoaXMudmlldy5yZW5kZXIoKSwib2JqZWN0Ij09dHlwZW9mIGMuZmlyc3RSdW4mJihIYW5kc29udGFibGUuaG9va3MucnVuKG0sImFmdGVyQ2hhbmdlIixjLmZpcnN0UnVuWzBdLGMuZmlyc3RSdW5bMV0pLGMuZmlyc3RSdW49ITEpLEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJJbml0Iil9LHRoaXMudmFsaWRhdGVDZWxsPWZ1bmN0aW9uKGUsdCxuLG8pe2Z1bmN0aW9uIHIoZSl7dmFyIG89dC5waHlzaWNhbENvbCxyPXQucGh5c2ljYWxSb3csaT1tLmdldENlbGwocixvLCEwKTtpJiZtLnZpZXcud3Qud3RTZXR0aW5ncy5zZXR0aW5ncy5jZWxsUmVuZGVyZXIocixvLGkpLG4oZSl9dmFyIGk9bS5nZXRDZWxsVmFsaWRhdG9yKHQpOyJbb2JqZWN0IFJlZ0V4cF0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGkpJiYoaT1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCxuKXtuKGUudGVzdCh0KSl9fShpKSksImZ1bmN0aW9uIj09dHlwZW9mIGk/KGU9SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJiZWZvcmVWYWxpZGF0ZSIsZSx0LnJvdyx0LnByb3AsbyksbS5fcmVnaXN0ZXJUaW1lb3V0KHNldFRpbWVvdXQoZnVuY3Rpb24oKXtpLmNhbGwodCxlLGZ1bmN0aW9uKG4pe249SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJhZnRlclZhbGlkYXRlIixuLGUsdC5yb3csdC5wcm9wLG8pLHQudmFsaWQ9bixyKG4pLEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwicG9zdEFmdGVyVmFsaWRhdGUiLG4sZSx0LnJvdyx0LnByb3Asbyl9KX0sMCkpKToodC52YWxpZD0hMCxyKHQudmFsaWQpKX0sdGhpcy5zZXREYXRhQXRDZWxsPWZ1bmN0aW9uKGUsdCxuLHMpe3ZhciBhLGwsdSxjPWkoZSx0LG4pLGg9W107Zm9yKGE9MCxsPWMubGVuZ3RoO2w+YTthKyspe2lmKCJvYmplY3QiIT10eXBlb2YgY1thXSl0aHJvdyBuZXcgRXJyb3IoIk1ldGhvZCBgc2V0RGF0YUF0Q2VsbGAgYWNjZXB0cyByb3cgbnVtYmVyIG9yIGNoYW5nZXMgYXJyYXkgb2YgYXJyYXlzIGFzIGl0cyBmaXJzdCBwYXJhbWV0ZXIiKTtpZigibnVtYmVyIiE9dHlwZW9mIGNbYV1bMV0pdGhyb3cgbmV3IEVycm9yKCJNZXRob2QgYHNldERhdGFBdENlbGxgIGFjY2VwdHMgcm93IGFuZCBjb2x1bW4gbnVtYmVyIGFzIGl0cyBwYXJhbWV0ZXJzLiBJZiB5b3Ugd2FudCB0byB1c2Ugb2JqZWN0IHByb3BlcnR5IG5hbWUsIHVzZSBtZXRob2QgYHNldERhdGFBdFJvd1Byb3BgIik7dT1kLmNvbFRvUHJvcChjW2FdWzFdKSxoLnB1c2goW2NbYV1bMF0sdSxkLmdldChjW2FdWzBdLHUpLGNbYV1bMl1dKX1zfHwib2JqZWN0IiE9dHlwZW9mIGV8fChzPXQpLG8oaCxzLGZ1bmN0aW9uKCl7cihoLHMpfSl9LHRoaXMuc2V0RGF0YUF0Um93UHJvcD1mdW5jdGlvbihlLHQsbixzKXt2YXIgYSxsLHU9aShlLHQsbiksYz1bXTtmb3IoYT0wLGw9dS5sZW5ndGg7bD5hO2ErKyljLnB1c2goW3VbYV1bMF0sdVthXVsxXSxkLmdldCh1W2FdWzBdLHVbYV1bMV0pLHVbYV1bMl1dKTtzfHwib2JqZWN0IiE9dHlwZW9mIGV8fChzPXQpLG8oYyxzLGZ1bmN0aW9uKCl7cihjLHMpfSl9LHRoaXMubGlzdGVuPWZ1bmN0aW9uKCl7SGFuZHNvbnRhYmxlLmFjdGl2ZUd1aWQ9bS5ndWlkfSx0aGlzLnVubGlzdGVuPWZ1bmN0aW9uKCl7SGFuZHNvbnRhYmxlLmFjdGl2ZUd1aWQ9bnVsbH0sdGhpcy5pc0xpc3RlbmluZz1mdW5jdGlvbigpe3JldHVybiBIYW5kc29udGFibGUuYWN0aXZlR3VpZD09PW0uZ3VpZH0sdGhpcy5kZXN0cm95RWRpdG9yPWZ1bmN0aW9uKGUpe3AucmVmcmVzaEJvcmRlcnMoZSl9LHRoaXMucG9wdWxhdGVGcm9tQXJyYXk9ZnVuY3Rpb24oZSx0LG4sbyxyLGkscyxhLGwpe3ZhciB1O2lmKCJvYmplY3QiIT10eXBlb2Ygbnx8Im9iamVjdCIhPXR5cGVvZiBuWzBdKXRocm93IG5ldyBFcnJvcigicG9wdWxhdGVGcm9tQXJyYXkgcGFyYW1ldGVyIGBpbnB1dGAgbXVzdCBiZSBhbiBhcnJheSBvZiBhcnJheXMiKTtyZXR1cm4gdT0ibnVtYmVyIj09dHlwZW9mIG8/bmV3IEsobyxyKTpudWxsLGYucG9wdWxhdGVGcm9tQXJyYXkobmV3IEsoZSx0KSxuLHUsaSxzLGEsbCl9LHRoaXMuc3BsaWNlQ29sPWZ1bmN0aW9uKGUsdCxuKXtyZXR1cm4gZC5zcGxpY2VDb2wuYXBwbHkoZCxhcmd1bWVudHMpfSx0aGlzLnNwbGljZVJvdz1mdW5jdGlvbihlLHQsbil7cmV0dXJuIGQuc3BsaWNlUm93LmFwcGx5KGQsYXJndW1lbnRzKX0sdGhpcy5nZXRTZWxlY3RlZD1mdW5jdGlvbigpe3JldHVybiBwLmlzU2VsZWN0ZWQoKT9bYy5zZWxSYW5nZS5mcm9tLnJvdyxjLnNlbFJhbmdlLmZyb20uY29sLGMuc2VsUmFuZ2UudG8ucm93LGMuc2VsUmFuZ2UudG8uY29sXTp2b2lkIDB9LHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZT1mdW5jdGlvbigpe3JldHVybiBwLmlzU2VsZWN0ZWQoKT9jLnNlbFJhbmdlOnZvaWQgMH0sdGhpcy5yZW5kZXI9ZnVuY3Rpb24oKXttLnZpZXcmJihtLnJlbmRlckNhbGw9ITAsbS5mb3JjZUZ1bGxSZW5kZXI9ITAscC5yZWZyZXNoQm9yZGVycyhudWxsLCEwKSl9LHRoaXMubG9hZERhdGE9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdCgpe2MuY2VsbFNldHRpbmdzLmxlbmd0aD0wfWlmKCJvYmplY3QiPT10eXBlb2YgZSYmbnVsbCE9PWUpZS5wdXNoJiZlLnNwbGljZXx8KGU9W2VdKTtlbHNle2lmKG51bGwhPT1lKXRocm93IG5ldyBFcnJvcigibG9hZERhdGEgb25seSBhY2NlcHRzIGFycmF5IG9mIG9iamVjdHMgb3IgYXJyYXkgb2YgYXJyYXlzICgiK3R5cGVvZiBlKyIgZ2l2ZW4pIik7ZT1bXTtmb3IodmFyIG4sbz0wLHI9Yy5zZXR0aW5ncy5zdGFydFJvd3M7cj5vO28rKyl7bj1bXTtmb3IodmFyIGk9MCxzPWMuc2V0dGluZ3Muc3RhcnRDb2xzO3M+aTtpKyspbi5wdXNoKG51bGwpO2UucHVzaChuKX19Yy5pc1BvcHVsYXRlZD0hMSx2LnByb3RvdHlwZS5kYXRhPWUsQXJyYXkuaXNBcnJheShjLnNldHRpbmdzLmRhdGFTY2hlbWEpfHxBcnJheS5pc0FycmF5KGVbMF0pP20uZGF0YVR5cGU9ImFycmF5IjoiZnVuY3Rpb24iPT10eXBlb2YgYy5zZXR0aW5ncy5kYXRhU2NoZW1hP20uZGF0YVR5cGU9ImZ1bmN0aW9uIjptLmRhdGFUeXBlPSJvYmplY3QiLGQ9bmV3IGsobSxjLHYpLGguZGF0YT1lLGguZGF0YVR5cGU9bS5kYXRhVHlwZSxoLmNvbFRvUHJvcD1kLmNvbFRvUHJvcC5iaW5kKGQpLGgucHJvcFRvQ29sPWQucHJvcFRvQ29sLmJpbmQoZCksdCgpLGYuYWRqdXN0Um93c0FuZENvbHMoKSxIYW5kc29udGFibGUuaG9va3MucnVuKG0sImFmdGVyTG9hZERhdGEiLGMuZmlyc3RSdW4pLGMuZmlyc3RSdW4/Yy5maXJzdFJ1bj1bbnVsbCwibG9hZERhdGEiXTooSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJhZnRlckNoYW5nZSIsbnVsbCwibG9hZERhdGEiKSxtLnJlbmRlcigpKSxjLmlzUG9wdWxhdGVkPSEwfSx0aGlzLmdldERhdGE9ZnVuY3Rpb24oZSx0LG4sbyl7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiBlP2QuZ2V0QWxsKCk6ZC5nZXRSYW5nZShuZXcgSyhlLHQpLG5ldyBLKG4sbyksZC5ERVNUSU5BVElPTl9SRU5ERVJFUil9LHRoaXMuZ2V0Q29weWFibGVUZXh0PWZ1bmN0aW9uKGUsdCxuLG8pe3JldHVybiBkLmdldENvcHlhYmxlVGV4dChuZXcgSyhlLHQpLG5ldyBLKG4sbykpfSx0aGlzLmdldENvcHlhYmxlRGF0YT1mdW5jdGlvbihlLHQpe3JldHVybiBkLmdldENvcHlhYmxlKGUsZC5jb2xUb1Byb3AodCkpfSx0aGlzLmdldFNjaGVtYT1mdW5jdGlvbigpe3JldHVybiBkLmdldFNjaGVtYSgpfSx0aGlzLnVwZGF0ZVNldHRpbmdzPWZ1bmN0aW9uKGUsdCl7dmFyIG4sbztpZigidW5kZWZpbmVkIiE9dHlwZW9mIGUucm93cyl0aHJvdyBuZXcgRXJyb3IoJyJyb3dzIiBzZXR0aW5nIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQuIGRvIHlvdSBtZWFuIHN0YXJ0Um93cywgbWluUm93cyBvciBtYXhSb3dzPycpO2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgZS5jb2xzKXRocm93IG5ldyBFcnJvcignImNvbHMiIHNldHRpbmcgaXMgbm8gbG9uZ2VyIHN1cHBvcnRlZC4gZG8geW91IG1lYW4gc3RhcnRDb2xzLCBtaW5Db2xzIG9yIG1heENvbHM/Jyk7Zm9yKG4gaW4gZSkiZGF0YSIhPT1uJiYoSGFuZHNvbnRhYmxlLmhvb2tzLmdldFJlZ2lzdGVyZWQoKS5pbmRleE9mKG4pPi0xPygiZnVuY3Rpb24iPT10eXBlb2YgZVtuXXx8QXJyYXkuaXNBcnJheShlW25dKSkmJm0uYWRkSG9vayhuLGVbbl0pOiF0JiZlLmhhc093blByb3BlcnR5KG4pJiYodi5wcm90b3R5cGVbbl09ZVtuXSkpO2lmKHZvaWQgMD09PWUuZGF0YSYmdm9pZCAwPT09Yy5zZXR0aW5ncy5kYXRhP20ubG9hZERhdGEobnVsbCk6dm9pZCAwIT09ZS5kYXRhP20ubG9hZERhdGEoZS5kYXRhKTp2b2lkIDAhPT1lLmNvbHVtbnMmJmQuY3JlYXRlTWFwKCksbz1tLmNvdW50Q29scygpLGMuY2VsbFNldHRpbmdzLmxlbmd0aD0wLG8+MCl7dmFyIHIsaTtmb3Iobj0wO28+bjtuKyspYy5jb2x1bW5TZXR0aW5nc1tuXT1NKHYsYy5jb2x1bW5zU2V0dGluZ0NvbmZsaWN0cykscj1jLmNvbHVtblNldHRpbmdzW25dLnByb3RvdHlwZSx2LnByb3RvdHlwZS5jb2x1bW5zJiYoaT12LnByb3RvdHlwZS5jb2x1bW5zW25dLEEocixpKSxBKHIscyhpKSkpfWlmKCJ1bmRlZmluZWQiIT10eXBlb2YgZS5jZWxsKWZvcihuIGluIGUuY2VsbClpZihlLmNlbGwuaGFzT3duUHJvcGVydHkobikpe3ZhciBhPWUuY2VsbFtuXTttLnNldENlbGxNZXRhT2JqZWN0KGEucm93LGEuY29sLGEpfWlmKEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJDZWxsTWV0YVJlc2V0IiksInVuZGVmaW5lZCIhPXR5cGVvZiBlLmNsYXNzTmFtZSYmKHYucHJvdG90eXBlLmNsYXNzTmFtZSYmTyhtLnJvb3RFbGVtZW50LHYucHJvdG90eXBlLmNsYXNzTmFtZSksZS5jbGFzc05hbWUmJlMobS5yb290RWxlbWVudCxlLmNsYXNzTmFtZSkpLCJ1bmRlZmluZWQiIT10eXBlb2YgZS5oZWlnaHQpe3ZhciBsPWUuaGVpZ2h0OyJmdW5jdGlvbiI9PXR5cGVvZiBsJiYobD1sKCkpLG0ucm9vdEVsZW1lbnQuc3R5bGUuaGVpZ2h0PWwrInB4In1pZigidW5kZWZpbmVkIiE9dHlwZW9mIGUud2lkdGgpe3ZhciB1PWUud2lkdGg7ImZ1bmN0aW9uIj09dHlwZW9mIHUmJih1PXUoKSksbS5yb290RWxlbWVudC5zdHlsZS53aWR0aD11KyJweCJ9bCYmKG0ucm9vdEVsZW1lbnQuc3R5bGUub3ZlcmZsb3c9ImhpZGRlbiIpLHR8fEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJVcGRhdGVTZXR0aW5ncyIpLGYuYWRqdXN0Um93c0FuZENvbHMoKSxtLnZpZXcmJiFjLmZpcnN0UnVuJiYobS5mb3JjZUZ1bGxSZW5kZXI9ITAscC5yZWZyZXNoQm9yZGVycyhudWxsLCEwKSl9LHRoaXMuZ2V0VmFsdWU9ZnVuY3Rpb24oKXt2YXIgZT1tLmdldFNlbGVjdGVkKCk7aWYodi5wcm90b3R5cGUuZ2V0VmFsdWUpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiB2LnByb3RvdHlwZS5nZXRWYWx1ZSlyZXR1cm4gdi5wcm90b3R5cGUuZ2V0VmFsdWUuY2FsbChtKTtpZihlKXJldHVybiBtLmdldERhdGEoKVtlWzBdXVt2LnByb3RvdHlwZS5nZXRWYWx1ZV19ZWxzZSBpZihlKXJldHVybiBtLmdldERhdGFBdENlbGwoZVswXSxlWzFdKX0sdGhpcy5nZXRTZXR0aW5ncz1mdW5jdGlvbigpe3JldHVybiBjLnNldHRpbmdzfSx0aGlzLmNsZWFyPWZ1bmN0aW9uKCl7cC5zZWxlY3RBbGwoKSxwLmVtcHR5KCl9LHRoaXMuYWx0ZXI9ZnVuY3Rpb24oZSx0LG4sbyxyKXtmLmFsdGVyKGUsdCxuLG8scil9LHRoaXMuZ2V0Q2VsbD1mdW5jdGlvbihlLHQsbil7cmV0dXJuIG0udmlldy5nZXRDZWxsQXRDb29yZHMobmV3IEsoZSx0KSxuKX0sdGhpcy5nZXRDb29yZHM9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMudmlldy53dC53dFRhYmxlLmdldENvb3Jkcy5jYWxsKHRoaXMudmlldy53dC53dFRhYmxlLGUpfSx0aGlzLmNvbFRvUHJvcD1mdW5jdGlvbihlKXtyZXR1cm4gZC5jb2xUb1Byb3AoZSl9LHRoaXMucHJvcFRvQ29sPWZ1bmN0aW9uKGUpe3JldHVybiBkLnByb3BUb0NvbChlKX0sdGhpcy5nZXREYXRhQXRDZWxsPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIGQuZ2V0KGUsZC5jb2xUb1Byb3AodCkpfSx0aGlzLmdldERhdGFBdFJvd1Byb3A9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZC5nZXQoZSx0KX0sdGhpcy5nZXREYXRhQXRDb2w9ZnVuY3Rpb24oZSl7dmFyIHQ9W107cmV0dXJuIHQuY29uY2F0LmFwcGx5KHQsZC5nZXRSYW5nZShuZXcgSygwLGUpLG5ldyBLKGMuc2V0dGluZ3MuZGF0YS5sZW5ndGgtMSxlKSxkLkRFU1RJTkFUSU9OX1JFTkRFUkVSKSl9LHRoaXMuZ2V0RGF0YUF0UHJvcD1mdW5jdGlvbihlKXt2YXIgdCxuPVtdO3JldHVybiB0PWQuZ2V0UmFuZ2UobmV3IEsoMCxkLnByb3BUb0NvbChlKSksbmV3IEsoYy5zZXR0aW5ncy5kYXRhLmxlbmd0aC0xLGQucHJvcFRvQ29sKGUpKSxkLkRFU1RJTkFUSU9OX1JFTkRFUkVSKSxuLmNvbmNhdC5hcHBseShuLHQpfSx0aGlzLmdldFNvdXJjZURhdGE9ZnVuY3Rpb24oZSx0LG4sbyl7dmFyIHI7cmV0dXJuIHI9dm9pZCAwPT09ZT9oLmdldERhdGEoKTpoLmdldEJ5UmFuZ2UobmV3IEsoZSx0KSxuZXcgSyhuLG8pKX0sdGhpcy5nZXRTb3VyY2VEYXRhQXRDb2w9ZnVuY3Rpb24oZSl7cmV0dXJuIGguZ2V0QXRDb2x1bW4oZSl9LHRoaXMuZ2V0U291cmNlRGF0YUF0Um93PWZ1bmN0aW9uKGUpe3JldHVybiBoLmdldEF0Um93KGUpfSx0aGlzLmdldFNvdXJjZURhdGFBdENlbGw9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gaC5nZXRBdENlbGwoZSx0KX0sdGhpcy5nZXREYXRhQXRSb3c9ZnVuY3Rpb24oZSl7dmFyIHQ9ZC5nZXRSYW5nZShuZXcgSyhlLDApLG5ldyBLKGUsdGhpcy5jb3VudENvbHMoKS0xKSxkLkRFU1RJTkFUSU9OX1JFTkRFUkVSKTtyZXR1cm4gdFswXX0sdGhpcy5nZXREYXRhVHlwZT1mdW5jdGlvbihlLHQsbixvKXt2YXIgcj10aGlzLGk9bnVsbCxzPW51bGw7dm9pZCAwPT09ZSYmKGU9MCxuPXRoaXMuY291bnRSb3dzKCksdD0wLG89dGhpcy5jb3VudENvbHMoKSksdm9pZCAwPT09biYmKG49ZSksdm9pZCAwPT09byYmKG89dCk7dmFyIGE9Im1peGVkIjtyZXR1cm4gRihNYXRoLm1pbihlLG4pLE1hdGgubWF4KGUsbiksZnVuY3Rpb24oZSl7dmFyIG49ITA7cmV0dXJuIEYoTWF0aC5taW4odCxvKSxNYXRoLm1heCh0LG8pLGZ1bmN0aW9uKHQpe3ZhciBvPXIuZ2V0Q2VsbE1ldGEoZSx0KTtyZXR1cm4gcz1vLnR5cGUsaT9uPWk9PT1zOmk9cyxufSksYT1uP3M6Im1peGVkIixufSksYX0sdGhpcy5yZW1vdmVDZWxsTWV0YT1mdW5jdGlvbihlLHQsbil7dmFyIG89bS5nZXRDZWxsTWV0YShlLHQpO3ZvaWQgMCE9b1tuXSYmZGVsZXRlIGMuY2VsbFNldHRpbmdzW2VdW3RdW25dfSx0aGlzLnNldENlbGxNZXRhT2JqZWN0PWZ1bmN0aW9uKGUsdCxuKXtpZigib2JqZWN0Ij09dHlwZW9mIG4pZm9yKHZhciBvIGluIG4paWYobi5oYXNPd25Qcm9wZXJ0eShvKSl7dmFyIHI9bltvXTt0aGlzLnNldENlbGxNZXRhKGUsdCxvLHIpfX0sdGhpcy5zZXRDZWxsTWV0YT1mdW5jdGlvbihlLHQsbixvKXtjLmNlbGxTZXR0aW5nc1tlXXx8KGMuY2VsbFNldHRpbmdzW2VdPVtdKSxjLmNlbGxTZXR0aW5nc1tlXVt0XXx8KGMuY2VsbFNldHRpbmdzW2VdW3RdPW5ldyBjLmNvbHVtblNldHRpbmdzW3RdKSxjLmNlbGxTZXR0aW5nc1tlXVt0XVtuXT1vLEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJTZXRDZWxsTWV0YSIsZSx0LG4sbyl9LHRoaXMuZ2V0Q2VsbHNNZXRhPWZ1bmN0aW9uKCl7cmV0dXJuIFcoYy5jZWxsU2V0dGluZ3MpfSx0aGlzLmdldENlbGxNZXRhPWZ1bmN0aW9uKGUsdCl7dmFyIG4sbz1kLmNvbFRvUHJvcCh0KSxyPWUsaT10O2lmKGU9YShlKSx0PWwodCksYy5jb2x1bW5TZXR0aW5nc1t0XXx8KGMuY29sdW1uU2V0dGluZ3NbdF09TSh2LGMuY29sdW1uc1NldHRpbmdDb25mbGljdHMpKSxjLmNlbGxTZXR0aW5nc1tlXXx8KGMuY2VsbFNldHRpbmdzW2VdPVtdKSxjLmNlbGxTZXR0aW5nc1tlXVt0XXx8KGMuY2VsbFNldHRpbmdzW2VdW3RdPW5ldyBjLmNvbHVtblNldHRpbmdzW3RdKSxuPWMuY2VsbFNldHRpbmdzW2VdW3RdLG4ucm93PWUsbi5jb2w9dCxuLnBoeXNpY2FsUm93PXIsbi5waHlzaWNhbENvbD1pLG4ucHJvcD1vLG4uaW5zdGFuY2U9bSxIYW5kc29udGFibGUuaG9va3MucnVuKG0sImJlZm9yZUdldENlbGxNZXRhIixlLHQsbiksQShuLHMobikpLG4uY2VsbHMpe3ZhciB1PW4uY2VsbHMuY2FsbChuLGUsdCxvKTt1JiYoQShuLHUpLEEobixzKHUpKSl9cmV0dXJuIEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJHZXRDZWxsTWV0YSIsZSx0LG4pLG59LHRoaXMuaXNDb2x1bW5Nb2RpZmljYXRpb25BbGxvd2VkPWZ1bmN0aW9uKCl7cmV0dXJuISgib2JqZWN0Ij09PW0uZGF0YVR5cGV8fG0uZ2V0U2V0dGluZ3MoKS5jb2x1bW5zKX07dmFyIHk9RygicmVuZGVyZXIiKTt0aGlzLmdldENlbGxSZW5kZXJlcj1mdW5jdGlvbihlLHQpe3ZhciBuPXkuY2FsbCh0aGlzLGUsdCk7cmV0dXJuIGoobil9LHRoaXMuZ2V0Q2VsbEVkaXRvcj1HKCJlZGl0b3IiKSx0aGlzLmdldENlbGxWYWxpZGF0b3I9RygidmFsaWRhdG9yIiksdGhpcy52YWxpZGF0ZUNlbGxzPWZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBuO3Qub25RdWV1ZUVtcHR5PWU7Zm9yKHZhciBvPW0uY291bnRSb3dzKCktMTtvPj0wOyl7Zm9yKHZhciByPW0uY291bnRDb2xzKCktMTtyPj0wOyl0LmFkZFZhbGlkYXRvclRvUXVldWUoKSxtLnZhbGlkYXRlQ2VsbChtLmdldERhdGFBdENlbGwobyxyKSxtLmdldENlbGxNZXRhKG8sciksZnVuY3Rpb24oZSl7aWYoImJvb2xlYW4iIT10eXBlb2YgZSl0aHJvdyBuZXcgRXJyb3IoIlZhbGlkYXRpb24gZXJyb3I6IHJlc3VsdCBpcyBub3QgYm9vbGVhbiIpO2U9PT0hMSYmKHQudmFsaWQ9ITEpLHQucmVtb3ZlVmFsaWRhdG9yRm9ybVF1ZXVlKCl9LCJ2YWxpZGF0ZUNlbGxzIiksci0tO28tLX10LmNoZWNrSWZRdWV1ZUlzRW1wdHkoKX0sdGhpcy5nZXRSb3dIZWFkZXI9ZnVuY3Rpb24oZSl7dmFyIHQ9Yy5zZXR0aW5ncy5yb3dIZWFkZXJzO3JldHVybiB2b2lkIDAhPT1lJiYoZT1IYW5kc29udGFibGUuaG9va3MucnVuKG0sIm1vZGlmeVJvd0hlYWRlciIsZSkpLHZvaWQgMD09PWU/KHQ9W10sRihtLmNvdW50Um93cygpLTEsZnVuY3Rpb24oZSl7dC5wdXNoKG0uZ2V0Um93SGVhZGVyKGUpKX0pKTpBcnJheS5pc0FycmF5KHQpJiZ2b2lkIDAhPT10W2VdP3Q9dFtlXToiZnVuY3Rpb24iPT10eXBlb2YgdD90PXQoZSk6dCYmInN0cmluZyIhPXR5cGVvZiB0JiYibnVtYmVyIiE9dHlwZW9mIHQmJih0PWUrMSksdH0sdGhpcy5oYXNSb3dIZWFkZXJzPWZ1bmN0aW9uKCl7cmV0dXJuISFjLnNldHRpbmdzLnJvd0hlYWRlcnN9LHRoaXMuaGFzQ29sSGVhZGVycz1mdW5jdGlvbigpe2lmKHZvaWQgMCE9PWMuc2V0dGluZ3MuY29sSGVhZGVycyYmbnVsbCE9PWMuc2V0dGluZ3MuY29sSGVhZGVycylyZXR1cm4hIWMuc2V0dGluZ3MuY29sSGVhZGVycztmb3IodmFyIGU9MCx0PW0uY291bnRDb2xzKCk7dD5lO2UrKylpZihtLmdldENvbEhlYWRlcihlKSlyZXR1cm4hMDtyZXR1cm4hMX0sdGhpcy5nZXRDb2xIZWFkZXI9ZnVuY3Rpb24oZSl7aWYoZT1IYW5kc29udGFibGUuaG9va3MucnVuKG0sIm1vZGlmeUNvbEhlYWRlciIsZSksdm9pZCAwPT09ZSl7Zm9yKHZhciB0PVtdLG49MCxvPW0uY291bnRDb2xzKCk7bz5uO24rKyl0LnB1c2gobS5nZXRDb2xIZWFkZXIobikpO3JldHVybiB0fXZhciByPWU7cmV0dXJuIGU9SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJtb2RpZnlDb2wiLGUpLGMuc2V0dGluZ3MuY29sdW1ucyYmYy5zZXR0aW5ncy5jb2x1bW5zW2VdJiZjLnNldHRpbmdzLmNvbHVtbnNbZV0udGl0bGU/Yy5zZXR0aW5ncy5jb2x1bW5zW2VdLnRpdGxlOkFycmF5LmlzQXJyYXkoYy5zZXR0aW5ncy5jb2xIZWFkZXJzKSYmdm9pZCAwIT09Yy5zZXR0aW5ncy5jb2xIZWFkZXJzW2VdP2Muc2V0dGluZ3MuY29sSGVhZGVyc1tlXToiZnVuY3Rpb24iPT10eXBlb2YgYy5zZXR0aW5ncy5jb2xIZWFkZXJzP2Muc2V0dGluZ3MuY29sSGVhZGVycyhlKTpjLnNldHRpbmdzLmNvbEhlYWRlcnMmJiJzdHJpbmciIT10eXBlb2YgYy5zZXR0aW5ncy5jb2xIZWFkZXJzJiYibnVtYmVyIiE9dHlwZW9mIGMuc2V0dGluZ3MuY29sSGVhZGVycz8kKHIpOmMuc2V0dGluZ3MuY29sSGVhZGVyc30sdGhpcy5fZ2V0Q29sV2lkdGhGcm9tU2V0dGluZ3M9ZnVuY3Rpb24oZSl7dmFyIHQ9bS5nZXRDZWxsTWV0YSgwLGUpLG49dC53aWR0aDtpZigodm9pZCAwPT09bnx8bj09PWMuc2V0dGluZ3Mud2lkdGgpJiYobj10LmNvbFdpZHRocyksdm9pZCAwIT09biYmbnVsbCE9PW4pe3N3aXRjaCh0eXBlb2Ygbil7Y2FzZSJvYmplY3QiOm49bltlXTticmVhaztjYXNlImZ1bmN0aW9uIjpuPW4oZSl9InN0cmluZyI9PXR5cGVvZiBuJiYobj1wYXJzZUludChuLDEwKSl9cmV0dXJuIG59LHRoaXMuZ2V0Q29sV2lkdGg9ZnVuY3Rpb24oZSl7dmFyIHQ9bS5fZ2V0Q29sV2lkdGhGcm9tU2V0dGluZ3MoZSk7cmV0dXJuIHQ9SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJtb2RpZnlDb2xXaWR0aCIsdCxlKSx2b2lkIDA9PT10JiYodD1xLkRFRkFVTFRfV0lEVEgpLHR9LHRoaXMuX2dldFJvd0hlaWdodEZyb21TZXR0aW5ncz1mdW5jdGlvbihlKXt2YXIgdD1jLnNldHRpbmdzLnJvd0hlaWdodHM7aWYodm9pZCAwIT09dCYmbnVsbCE9PXQpe3N3aXRjaCh0eXBlb2YgdCl7Y2FzZSJvYmplY3QiOnQ9dFtlXTticmVhaztjYXNlImZ1bmN0aW9uIjp0PXQoZSl9InN0cmluZyI9PXR5cGVvZiB0JiYodD1wYXJzZUludCh0LDEwKSl9cmV0dXJuIHR9LHRoaXMuZ2V0Um93SGVpZ2h0PWZ1bmN0aW9uKGUpe3ZhciB0PW0uX2dldFJvd0hlaWdodEZyb21TZXR0aW5ncyhlKTtyZXR1cm4gdD1IYW5kc29udGFibGUuaG9va3MucnVuKG0sIm1vZGlmeVJvd0hlaWdodCIsdCxlKX0sdGhpcy5jb3VudFNvdXJjZVJvd3M9ZnVuY3Rpb24oKXtyZXR1cm4gbS5nZXRTb3VyY2VEYXRhKCk/bS5nZXRTb3VyY2VEYXRhKCkubGVuZ3RoOjB9LHRoaXMuY291bnRSb3dzPWZ1bmN0aW9uKCl7cmV0dXJuIGQuZ2V0TGVuZ3RoKCl9LHRoaXMuY291bnRDb2xzPWZ1bmN0aW9uKCl7cmV0dXJuIm9iamVjdCI9PT1tLmRhdGFUeXBlfHwiZnVuY3Rpb24iPT09bS5kYXRhVHlwZT9jLnNldHRpbmdzLmNvbHVtbnMmJmMuc2V0dGluZ3MuY29sdW1ucy5sZW5ndGg/Yy5zZXR0aW5ncy5jb2x1bW5zLmxlbmd0aDpkLmNvbFRvUHJvcENhY2hlLmxlbmd0aDoiYXJyYXkiPT09bS5kYXRhVHlwZT9jLnNldHRpbmdzLmNvbHVtbnMmJmMuc2V0dGluZ3MuY29sdW1ucy5sZW5ndGg/Yy5zZXR0aW5ncy5jb2x1bW5zLmxlbmd0aDpjLnNldHRpbmdzLmRhdGEmJmMuc2V0dGluZ3MuZGF0YVswXSYmYy5zZXR0aW5ncy5kYXRhWzBdLmxlbmd0aD9jLnNldHRpbmdzLmRhdGFbMF0ubGVuZ3RoOjA6dm9pZCAwfSx0aGlzLmdldENvbHNwYW5PZmZzZXQ9ZnVuY3Rpb24oZSx0KXt2YXIgbj0wO2lmKG0uY29sc3BhbkFycmF5KXtmb3IodmFyIG89MDtlPm87bysrKW4rPW0uY29sc3BhbkFycmF5W3RdW29dLTF8fDA7cmV0dXJuIG59Zm9yKHZhciBuPTAscj1tLnZpZXcud3Qud3RUYWJsZS5USEVBRC5jaGlsZE5vZGVzLmxlbmd0aC10LTEsaT1tLnZpZXcud3Qud3RUYWJsZS5USEVBRC5xdWVyeVNlbGVjdG9yKCJ0cjpudGgtY2hpbGQoIitwYXJzZUludChyKzEsMTApKyIpIikscz1tLnZpZXcud3Qud3RTZXR0aW5ncy5zZXR0aW5ncy5yb3dIZWFkZXJzKCkubGVuZ3RoLG89cztzK2U+bztvKyspaS5jaGlsZE5vZGVzW29dLmhhc0F0dHJpYnV0ZSgiY29sc3BhbiIpJiYobis9cGFyc2VJbnQoaS5jaGlsZE5vZGVzW29dLmdldEF0dHJpYnV0ZSgiY29sc3BhbiIpLDEwKS0xKTtyZXR1cm4gbn0sdGhpcy5nZXRIZWFkZXJDb2xzcGFuPWZ1bmN0aW9uKGUsdCl7dmFyIG49bS52aWV3Lnd0Lnd0VGFibGUuVEhFQUQuY2hpbGROb2Rlcy5sZW5ndGgtdC0xLG89bS52aWV3Lnd0Lnd0U2V0dGluZ3Muc2V0dGluZ3Mucm93SGVhZGVycygpLmxlbmd0aCxyPW0udmlldy53dC53dFRhYmxlLlRIRUFELnF1ZXJ5U2VsZWN0b3IoInRyOm50aC1jaGlsZCgiK3BhcnNlSW50KG4rMSwxMCkrIikiKSxpPW8rZS1tLnZpZXcud3Qud3RWaWV3cG9ydC5jb2x1bW5zUmVuZGVyQ2FsY3VsYXRvci5zdGFydENvbHVtbjtyZXR1cm4gci5jaGlsZE5vZGVzW2ldLmhhc0F0dHJpYnV0ZSgiY29sc3BhbiIpP3BhcnNlSW50KHIuY2hpbGROb2Rlc1tpXS5nZXRBdHRyaWJ1dGUoImNvbHNwYW4iKSwxMCk6MH0sdGhpcy5yb3dPZmZzZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gbS52aWV3Lnd0Lnd0VGFibGUuZ2V0Rmlyc3RSZW5kZXJlZFJvdygpfSx0aGlzLmNvbE9mZnNldD1mdW5jdGlvbigpe3JldHVybiBtLnZpZXcud3Qud3RUYWJsZS5nZXRGaXJzdFJlbmRlcmVkQ29sdW1uKCl9LHRoaXMuY291bnRSZW5kZXJlZFJvd3M9ZnVuY3Rpb24oKXtyZXR1cm4gbS52aWV3Lnd0LmRyYXduP20udmlldy53dC53dFRhYmxlLmdldFJlbmRlcmVkUm93c0NvdW50KCk6LTF9LHRoaXMuY291bnRWaXNpYmxlUm93cz1mdW5jdGlvbigpe3JldHVybiBtLnZpZXcud3QuZHJhd24/bS52aWV3Lnd0Lnd0VGFibGUuZ2V0VmlzaWJsZVJvd3NDb3VudCgpOi0xfSx0aGlzLmNvdW50UmVuZGVyZWRDb2xzPWZ1bmN0aW9uKCl7cmV0dXJuIG0udmlldy53dC5kcmF3bj9tLnZpZXcud3Qud3RUYWJsZS5nZXRSZW5kZXJlZENvbHVtbnNDb3VudCgpOi0xfSx0aGlzLmNvdW50VmlzaWJsZUNvbHM9ZnVuY3Rpb24oKXtyZXR1cm4gbS52aWV3Lnd0LmRyYXduP20udmlldy53dC53dFRhYmxlLmdldFZpc2libGVDb2x1bW5zQ291bnQoKTotMX0sdGhpcy5jb3VudEVtcHR5Um93cz1mdW5jdGlvbihlKXtmb3IodmFyIHQsbj1tLmNvdW50Um93cygpLTEsbz0wO24+PTA7KXtpZih0PUhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcywibW9kaWZ5Um93IixuKSxtLmlzRW1wdHlSb3codCkpbysrO2Vsc2UgaWYoZSlicmVhaztuLS19cmV0dXJuIG99LHRoaXMuY291bnRFbXB0eUNvbHM9ZnVuY3Rpb24oZSl7aWYobS5jb3VudFJvd3MoKTwxKXJldHVybiAwO2Zvcih2YXIgdD1tLmNvdW50Q29scygpLTEsbj0wO3Q+PTA7KXtpZihtLmlzRW1wdHlDb2wodCkpbisrO2Vsc2UgaWYoZSlicmVhazt0LS19cmV0dXJuIG59LHRoaXMuaXNFbXB0eVJvdz1mdW5jdGlvbihlKXtyZXR1cm4gYy5zZXR0aW5ncy5pc0VtcHR5Um93LmNhbGwobSxlKX0sdGhpcy5pc0VtcHR5Q29sPWZ1bmN0aW9uKGUpe3JldHVybiBjLnNldHRpbmdzLmlzRW1wdHlDb2wuY2FsbChtLGUpfSx0aGlzLnNlbGVjdENlbGw9ZnVuY3Rpb24oZSx0LG4sbyxyLGkpe3ZhciBzO2lmKGk9InVuZGVmaW5lZCI9PXR5cGVvZiBpfHxpPT09ITAsIm51bWJlciIhPXR5cGVvZiBlfHwwPmV8fGU+PW0uY291bnRSb3dzKCkpcmV0dXJuITE7aWYoIm51bWJlciIhPXR5cGVvZiB0fHwwPnR8fHQ+PW0uY291bnRDb2xzKCkpcmV0dXJuITE7aWYoInVuZGVmaW5lZCIhPXR5cGVvZiBuKXtpZigibnVtYmVyIiE9dHlwZW9mIG58fDA+bnx8bj49bS5jb3VudFJvd3MoKSlyZXR1cm4hMTtpZigibnVtYmVyIiE9dHlwZW9mIG98fDA+b3x8bz49bS5jb3VudENvbHMoKSlyZXR1cm4hMX1yZXR1cm4gcz1uZXcgSyhlLHQpLGMuc2VsUmFuZ2U9bmV3IFgocyxzLHMpLGkmJm0ubGlzdGVuKCksInVuZGVmaW5lZCI9PXR5cGVvZiBuP3Auc2V0UmFuZ2VFbmQoYy5zZWxSYW5nZS5mcm9tLHIpOnAuc2V0UmFuZ2VFbmQobmV3IEsobixvKSxyKSxtLnNlbGVjdGlvbi5maW5pc2goKSwhMH0sdGhpcy5zZWxlY3RDZWxsQnlQcm9wPWZ1bmN0aW9uKGUsdCxuLG8scil7cmV0dXJuIGFyZ3VtZW50c1sxXT1kLnByb3BUb0NvbChhcmd1bWVudHNbMV0pLCJ1bmRlZmluZWQiIT10eXBlb2YgYXJndW1lbnRzWzNdJiYoYXJndW1lbnRzWzNdPWQucHJvcFRvQ29sKGFyZ3VtZW50c1szXSkpLG0uc2VsZWN0Q2VsbC5hcHBseShtLGFyZ3VtZW50cyl9LHRoaXMuZGVzZWxlY3RDZWxsPWZ1bmN0aW9uKCl7cC5kZXNlbGVjdCgpfSx0aGlzLmRlc3Ryb3k9ZnVuY3Rpb24oKXttLl9jbGVhclRpbWVvdXRzKCksbS52aWV3JiZtLnZpZXcuZGVzdHJveSgpLGgmJmguZGVzdHJveSgpLGg9bnVsbCxFKG0ucm9vdEVsZW1lbnQpLHcuZGVzdHJveSgpLEhhbmRzb250YWJsZS5ob29rcy5ydW4obSwiYWZ0ZXJEZXN0cm95IiksSGFuZHNvbnRhYmxlLmhvb2tzLmRlc3Ryb3kobSk7Zm9yKHZhciBlIGluIG0pbS5oYXNPd25Qcm9wZXJ0eShlKSYmKCJmdW5jdGlvbiI9PXR5cGVvZiBtW2VdP21bZV09dToiZ3VpZCIhPT1lJiYobVtlXT1udWxsKSk7Yz1udWxsLGQ9bnVsbCxmPW51bGwscD1udWxsLGc9bnVsbCxtPW51bGwsdj1udWxsfSx0aGlzLmdldEFjdGl2ZUVkaXRvcj1mdW5jdGlvbigpe3JldHVybiBnLmdldEFjdGl2ZUVkaXRvcigpfSx0aGlzLmdldFBsdWdpbj1mdW5jdGlvbihlKXtyZXR1cm4gSSh0aGlzLGUpfSx0aGlzLmdldEluc3RhbmNlPWZ1bmN0aW9uKCl7cmV0dXJuIG19LHRoaXMuYWRkSG9vaz1mdW5jdGlvbihlLHQpe0hhbmRzb250YWJsZS5ob29rcy5hZGQoZSx0LG0pfSx0aGlzLmFkZEhvb2tPbmNlPWZ1bmN0aW9uKGUsdCl7SGFuZHNvbnRhYmxlLmhvb2tzLm9uY2UoZSx0LG0pfSx0aGlzLnJlbW92ZUhvb2s9ZnVuY3Rpb24oZSx0KXtIYW5kc29udGFibGUuaG9va3MucmVtb3ZlKGUsdCxtKX0sdGhpcy5ydW5Ib29rcz1mdW5jdGlvbihlLHQsbixvLHIsaSxzKXtyZXR1cm4gSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLGUsdCxuLG8scixpLHMpfSx0aGlzLnRpbWVvdXRzPVtdLHRoaXMuX3JlZ2lzdGVyVGltZW91dD1mdW5jdGlvbihlKXt0aGlzLnRpbWVvdXRzLnB1c2goZSl9LHRoaXMuX2NsZWFyVGltZW91dHM9ZnVuY3Rpb24oKXtmb3IodmFyIGU9MCx0PXRoaXMudGltZW91dHMubGVuZ3RoO3Q+ZTtlKyspY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dHNbZV0pfSx0aGlzLnZlcnNpb249SGFuZHNvbnRhYmxlLnZlcnNpb24sSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihtLCJjb25zdHJ1Y3QiKX07dmFyIFo9ZnVuY3Rpb24oKXt9O1oucHJvdG90eXBlPXtkYXRhOnZvaWQgMCxkYXRhU2NoZW1hOnZvaWQgMCx3aWR0aDp2b2lkIDAsaGVpZ2h0OnZvaWQgMCxzdGFydFJvd3M6NSxzdGFydENvbHM6NSxyb3dIZWFkZXJzOm51bGwsY29sSGVhZGVyczpudWxsLGNvbFdpZHRoczp2b2lkIDAscm93SGVpZ2h0czp2b2lkIDAsY29sdW1uczp2b2lkIDAsY2VsbHM6dm9pZCAwLGNlbGw6W10sY29tbWVudHM6ITEsY3VzdG9tQm9yZGVyczohMSxtaW5Sb3dzOjAsbWluQ29sczowLG1heFJvd3M6MS8wLG1heENvbHM6MS8wLG1pblNwYXJlUm93czowLG1pblNwYXJlQ29sczowLGFsbG93SW5zZXJ0Um93OiEwLGFsbG93SW5zZXJ0Q29sdW1uOiEwLGFsbG93UmVtb3ZlUm93OiEwLGFsbG93UmVtb3ZlQ29sdW1uOiEwLG11bHRpU2VsZWN0OiEwLGZpbGxIYW5kbGU6ITAsZml4ZWRSb3dzVG9wOjAsZml4ZWRSb3dzQm90dG9tOjAsZml4ZWRDb2x1bW5zTGVmdDowLG91dHNpZGVDbGlja0Rlc2VsZWN0czohMCxlbnRlckJlZ2luc0VkaXRpbmc6ITAsZW50ZXJNb3Zlczp7cm93OjEsY29sOjB9LHRhYk1vdmVzOntyb3c6MCxjb2w6MX0sYXV0b1dyYXBSb3c6ITEsYXV0b1dyYXBDb2w6ITEsY29weVJvd3NMaW1pdDoxZTMsY29weUNvbHNMaW1pdDoxZTMscGFzdGVNb2RlOiJvdmVyd3JpdGUiLHBlcnNpc3RlbnRTdGF0ZTohMSxjdXJyZW50Um93Q2xhc3NOYW1lOnZvaWQgMCxjdXJyZW50Q29sQ2xhc3NOYW1lOnZvaWQgMCxjbGFzc05hbWU6dm9pZCAwLHRhYmxlQ2xhc3NOYW1lOnZvaWQgMCxzdHJldGNoSDoibm9uZSIsaXNFbXB0eVJvdzpmdW5jdGlvbihlKXt2YXIgdCxuLG8scjtmb3IodD0wLG49dGhpcy5jb3VudENvbHMoKTtuPnQ7dCsrKWlmKG89dGhpcy5nZXREYXRhQXRDZWxsKGUsdCksIiIhPT1vJiZudWxsIT09byYmInVuZGVmaW5lZCIhPXR5cGVvZiBvKXJldHVybiJvYmplY3QiPT10eXBlb2Ygbz8ocj10aGlzLmdldENlbGxNZXRhKGUsdCksTih0aGlzLmdldFNjaGVtYSgpW3IucHJvcF0sbykpOiExO3JldHVybiEwfSxpc0VtcHR5Q29sOmZ1bmN0aW9uKGUpe3ZhciB0LG4sbztmb3IodD0wLG49dGhpcy5jb3VudFJvd3MoKTtuPnQ7dCsrKWlmKG89dGhpcy5nZXREYXRhQXRDZWxsKHQsZSksIiIhPT1vJiZudWxsIT09byYmInVuZGVmaW5lZCIhPXR5cGVvZiBvKXJldHVybiExO3JldHVybiEwfSxvYnNlcnZlRE9NVmlzaWJpbGl0eTohMCxhbGxvd0ludmFsaWQ6ITAsaW52YWxpZENlbGxDbGFzc05hbWU6Imh0SW52YWxpZCIscGxhY2Vob2xkZXI6ITEscGxhY2Vob2xkZXJDZWxsQ2xhc3NOYW1lOiJodFBsYWNlaG9sZGVyIixyZWFkT25seUNlbGxDbGFzc05hbWU6Imh0RGltbWVkIixyZW5kZXJlcjp2b2lkIDAsY29tbWVudGVkQ2VsbENsYXNzTmFtZToiaHRDb21tZW50Q2VsbCIsZnJhZ21lbnRTZWxlY3Rpb246ITEscmVhZE9ubHk6ITEsc2tpcENvbHVtbk9uUGFzdGU6ITEsc2VhcmNoOiExLHR5cGU6InRleHQiLGNvcHlhYmxlOiEwLGVkaXRvcjp2b2lkIDAsYXV0b0NvbXBsZXRlOnZvaWQgMCx2aXNpYmxlUm93czoxMCx0cmltRHJvcGRvd246ITAsZGVidWc6ITEsd29yZFdyYXA6ITAsbm9Xb3JkV3JhcENsYXNzTmFtZToiaHROb1dyYXAiLGNvbnRleHRNZW51OnZvaWQgMCxjb250ZXh0TWVudUNvcHlQYXN0ZTp2b2lkIDAsY29weVBhc3RlOnZvaWQgMCx1bmRvOnZvaWQgMCxjb2x1bW5Tb3J0aW5nOnZvaWQgMCxtYW51YWxDb2x1bW5Nb3ZlOnZvaWQgMCxtYW51YWxDb2x1bW5SZXNpemU6dm9pZCAwLG1hbnVhbFJvd01vdmU6dm9pZCAwLG1hbnVhbFJvd1Jlc2l6ZTp2b2lkIDAsbWVyZ2VDZWxsczohMSx2aWV3cG9ydFJvd1JlbmRlcmluZ09mZnNldDoiYXV0byIsdmlld3BvcnRDb2x1bW5SZW5kZXJpbmdPZmZzZXQ6ImF1dG8iLHZhbGlkYXRvcjp2b2lkIDAsZGlzYWJsZVZpc3VhbFNlbGVjdGlvbjohMSxzb3J0SW5kaWNhdG9yOiExLG1hbnVhbENvbHVtbkZyZWV6ZTp2b2lkIDAsdHJpbVdoaXRlc3BhY2U6ITAsc2V0dGluZ3M6dm9pZCAwLHNvdXJjZTp2b2lkIDAsdGl0bGU6dm9pZCAwLGNoZWNrZWRUZW1wbGF0ZTp2b2lkIDAsdW5jaGVja2VkVGVtcGxhdGU6dm9pZCAwLGxhYmVsOnZvaWQgMCxmb3JtYXQ6dm9pZCAwLGxhbmd1YWdlOnZvaWQgMCxzZWxlY3RPcHRpb25zOnZvaWQgMCxhdXRvQ29sdW1uU2l6ZTp2b2lkIDAsYXV0b1Jvd1NpemU6dm9pZCAwLGRhdGVGb3JtYXQ6dm9pZCAwLGNvcnJlY3RGb3JtYXQ6ITEsZGVmYXVsdERhdGU6dm9pZCAwLHN0cmljdDp2b2lkIDAscmVuZGVyQWxsUm93czp2b2lkIDB9LEhhbmRzb250YWJsZS5EZWZhdWx0U2V0dGluZ3M9Wn0seyIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2FsY3VsYXRvci92aWV3cG9ydENvbHVtbnMiOjMsIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL2Nvb3JkcyI6NSwiM3JkcGFydHkvd2Fsa29udGFibGUvc3JjL2NlbGwvcmFuZ2UiOjYsIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9zZWxlY3Rpb24iOjE4LGRhdGFNYXA6MjYsZGF0YVNvdXJjZToyNyxlZGl0b3JNYW5hZ2VyOjI4LGV2ZW50TWFuYWdlcjo0MSwiaGVscGVycy9hcnJheSI6NDIsImhlbHBlcnMvZGF0YSI6NDQsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL251bWJlciI6NDksImhlbHBlcnMvb2JqZWN0Ijo1MCwiaGVscGVycy9zZXR0aW5nIjo1MSwiaGVscGVycy9zdHJpbmciOjUyLG51bWVyYWw6Im51bWVyYWwiLHBsdWdpbnM6NTcscmVuZGVyZXJzOjg4LHRhYmxlVmlldzo5N31dLDI2OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSx0LG4pe3RoaXMuaW5zdGFuY2U9ZSx0aGlzLnByaXY9dCx0aGlzLkdyaWRTZXR0aW5ncz1uLHRoaXMuZGF0YVNvdXJjZT10aGlzLmluc3RhbmNlLmdldFNldHRpbmdzKCkuZGF0YSx0aGlzLmRhdGFTb3VyY2VbMF0/dGhpcy5kdWNrU2NoZW1hPXRoaXMucmVjdXJzaXZlRHVja1NjaGVtYSh0aGlzLmRhdGFTb3VyY2VbMF0pOnRoaXMuZHVja1NjaGVtYT17fSx0aGlzLmNyZWF0ZU1hcCgpfU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0RhdGFNYXA6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGEsbCx1LGMsZD0ocj1lKCJTaGVldENsaXAiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pWyJkZWZhdWx0Il0saD0oaT1lKCJoZWxwZXJzL2RhdGEiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLmNlbGxNZXRob2RMb29rdXBGYWN0b3J5LGY9KHM9ZSgiaGVscGVycy9zZXR0aW5nIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5jb2x1bW5GYWN0b3J5LHA9KGE9ZSgiaGVscGVycy9vYmplY3QiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLGc9cC5kdWNrU2NoZW1hLG09cC5kZWVwRXh0ZW5kLHY9KGw9ZSgiaGVscGVycy9hcnJheSIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSksdz12LmV4dGVuZEFycmF5LHk9di50bzJkQXJyYXksYj0odT1lKCJoZWxwZXJzL251bWJlciIpLHUmJnUuX19lc01vZHVsZSYmdXx8eyJkZWZhdWx0Ijp1fSkucmFuZ2VFYWNoLEM9KGM9ZSgibXVsdGlNYXAiKSxjJiZjLl9fZXNNb2R1bGUmJmN8fHsiZGVmYXVsdCI6Y30pLk11bHRpTWFwO28ucHJvdG90eXBlLkRFU1RJTkFUSU9OX1JFTkRFUkVSPTEsby5wcm90b3R5cGUuREVTVElOQVRJT05fQ0xJUEJPQVJEX0dFTkVSQVRPUj0yLG8ucHJvdG90eXBlLnJlY3Vyc2l2ZUR1Y2tTY2hlbWE9ZnVuY3Rpb24oZSl7cmV0dXJuIGcoZSl9LG8ucHJvdG90eXBlLnJlY3Vyc2l2ZUR1Y2tDb2x1bW5zPWZ1bmN0aW9uKGUsdCxuKXt2YXIgbyxyO2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgdCYmKHQ9MCxuPSIiKSwib2JqZWN0Ij09dHlwZW9mIGUmJiFBcnJheS5pc0FycmF5KGUpKWZvcihyIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShyKSYmKG51bGw9PT1lW3JdPyhvPW4rcix0aGlzLmNvbFRvUHJvcENhY2hlLnB1c2gobyksdGhpcy5wcm9wVG9Db2xDYWNoZS5zZXQobyx0KSx0KyspOnQ9dGhpcy5yZWN1cnNpdmVEdWNrQ29sdW1ucyhlW3JdLHQscisiLiIpKTtyZXR1cm4gdH0sby5wcm90b3R5cGUuY3JlYXRlTWFwPWZ1bmN0aW9uKCl7dmFyIGUsdCxuPXRoaXMuZ2V0U2NoZW1hKCk7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBuKXRocm93IG5ldyBFcnJvcigidHJ5aW5nIHRvIGNyZWF0ZSBgY29sdW1uc2AgZGVmaW5pdGlvbiBidXQgeW91IGRpZG50JyBwcm92aWRlIGBzY2hlbWFgIG5vciBgZGF0YWAiKTt0aGlzLmNvbFRvUHJvcENhY2hlPVtdLHRoaXMucHJvcFRvQ29sQ2FjaGU9bmV3IEM7dmFyIG89dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5ncygpLmNvbHVtbnM7aWYobylmb3IoZT0wLHQ9by5sZW5ndGg7dD5lO2UrKykidW5kZWZpbmVkIiE9dHlwZW9mIG9bZV0uZGF0YSYmKHRoaXMuY29sVG9Qcm9wQ2FjaGVbZV09b1tlXS5kYXRhLHRoaXMucHJvcFRvQ29sQ2FjaGUuc2V0KG9bZV0uZGF0YSxlKSk7ZWxzZSB0aGlzLnJlY3Vyc2l2ZUR1Y2tDb2x1bW5zKG4pfSxvLnByb3RvdHlwZS5jb2xUb1Byb3A9ZnVuY3Rpb24oZSl7cmV0dXJuIGU9SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bih0aGlzLmluc3RhbmNlLCJtb2RpZnlDb2wiLGUpLHRoaXMuY29sVG9Qcm9wQ2FjaGUmJiJ1bmRlZmluZWQiIT10eXBlb2YgdGhpcy5jb2xUb1Byb3BDYWNoZVtlXT90aGlzLmNvbFRvUHJvcENhY2hlW2VdOmV9LG8ucHJvdG90eXBlLnByb3BUb0NvbD1mdW5jdGlvbihlKXt2YXIgdDtyZXR1cm4gdD0idW5kZWZpbmVkIj09dHlwZW9mIHRoaXMucHJvcFRvQ29sQ2FjaGUuZ2V0KGUpP2U6dGhpcy5wcm9wVG9Db2xDYWNoZS5nZXQoZSksdD1IYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaW5zdGFuY2UsIm1vZGlmeUNvbCIsdCl9LG8ucHJvdG90eXBlLmdldFNjaGVtYT1mdW5jdGlvbigpe3ZhciBlPXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZ3MoKS5kYXRhU2NoZW1hO3JldHVybiBlPyJmdW5jdGlvbiI9PXR5cGVvZiBlP2UoKTplOnRoaXMuZHVja1NjaGVtYX0sby5wcm90b3R5cGUuY3JlYXRlUm93PWZ1bmN0aW9uKGUsdCxuKXt2YXIgbyxyLGk9dGhpcy5pbnN0YW5jZS5jb3VudENvbHMoKSxzPTA7dHx8KHQ9MSksKCJudW1iZXIiIT10eXBlb2YgZXx8ZT49dGhpcy5pbnN0YW5jZS5jb3VudFNvdXJjZVJvd3MoKSkmJihlPXRoaXMuaW5zdGFuY2UuY291bnRTb3VyY2VSb3dzKCkpLHI9ZTtmb3IodmFyIGE9dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5ncygpLm1heFJvd3M7dD5zJiZ0aGlzLmluc3RhbmNlLmNvdW50U291cmNlUm93cygpPGE7KXtpZigiYXJyYXkiPT09dGhpcy5pbnN0YW5jZS5kYXRhVHlwZSl7bz1bXTtmb3IodmFyIGw9MDtpPmw7bCsrKW8ucHVzaChudWxsKX1lbHNlImZ1bmN0aW9uIj09PXRoaXMuaW5zdGFuY2UuZGF0YVR5cGU/bz10aGlzLmluc3RhbmNlLmdldFNldHRpbmdzKCkuZGF0YVNjaGVtYShlKToobz17fSxtKG8sdGhpcy5nZXRTY2hlbWEoKSkpO2U9PT10aGlzLmluc3RhbmNlLmNvdW50U291cmNlUm93cygpP3RoaXMuZGF0YVNvdXJjZS5wdXNoKG8pOnRoaXMuZGF0YVNvdXJjZS5zcGxpY2UoZSwwLG8pLHMrKyxyKyt9cmV0dXJuIEhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5pbnN0YW5jZSwiYWZ0ZXJDcmVhdGVSb3ciLGUscyxuKSx0aGlzLmluc3RhbmNlLmZvcmNlRnVsbFJlbmRlcj0hMCxzfSxvLnByb3RvdHlwZS5jcmVhdGVDb2w9ZnVuY3Rpb24oZSx0LG4pe2lmKCF0aGlzLmluc3RhbmNlLmlzQ29sdW1uTW9kaWZpY2F0aW9uQWxsb3dlZCgpKXRocm93IG5ldyBFcnJvcigiQ2Fubm90IGNyZWF0ZSBuZXcgY29sdW1uLiBXaGVuIGRhdGEgc291cmNlIGluIGFuIG9iamVjdCwgeW91IGNhbiBvbmx5IGhhdmUgYXMgbXVjaCBjb2x1bW5zIGFzIGRlZmluZWQgaW4gZmlyc3QgZGF0YSByb3csIGRhdGEgc2NoZW1hIG9yIGluIHRoZSAnY29sdW1ucycgc2V0dGluZy5JZiB5b3Ugd2FudCB0byBiZSBhYmxlIHRvIGFkZCBuZXcgY29sdW1ucywgeW91IGhhdmUgdG8gdXNlIGFycmF5IGRhdGFzb3VyY2UuIik7CnZhciBvLHIsaT10aGlzLmluc3RhbmNlLmNvdW50U291cmNlUm93cygpLHM9dGhpcy5kYXRhU291cmNlLGE9MDt0fHwodD0xKSxyPWU7Zm9yKHZhciBsPXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZ3MoKS5tYXhDb2xzO3Q+YSYmdGhpcy5pbnN0YW5jZS5jb3VudENvbHMoKTxsOyl7aWYobz1mKHRoaXMuR3JpZFNldHRpbmdzLHRoaXMucHJpdi5jb2x1bW5zU2V0dGluZ0NvbmZsaWN0cyksIm51bWJlciIhPXR5cGVvZiBlfHxlPj10aGlzLmluc3RhbmNlLmNvdW50Q29scygpKXtmb3IodmFyIHU9MDtpPnU7dSsrKSJ1bmRlZmluZWQiPT10eXBlb2Ygc1t1XSYmKHNbdV09W10pLHNbdV0ucHVzaChudWxsKTt0aGlzLnByaXYuY29sdW1uU2V0dGluZ3MucHVzaChvKX1lbHNle2Zvcih2YXIgdT0wO2k+dTt1Kyspc1t1XS5zcGxpY2UociwwLG51bGwpO3RoaXMucHJpdi5jb2x1bW5TZXR0aW5ncy5zcGxpY2UociwwLG8pfWErKyxyKyt9cmV0dXJuIEhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5pbnN0YW5jZSwiYWZ0ZXJDcmVhdGVDb2wiLGUsYSxuKSx0aGlzLmluc3RhbmNlLmZvcmNlRnVsbFJlbmRlcj0hMCxhfSxvLnByb3RvdHlwZS5yZW1vdmVSb3c9ZnVuY3Rpb24oZSx0KXt0fHwodD0xKSwibnVtYmVyIiE9dHlwZW9mIGUmJihlPS10KSxlPSh0aGlzLmluc3RhbmNlLmNvdW50U291cmNlUm93cygpK2UpJXRoaXMuaW5zdGFuY2UuY291bnRTb3VyY2VSb3dzKCk7dmFyIG49dGhpcy5waHlzaWNhbFJvd3NUb0xvZ2ljYWwoZSx0KSxvPUhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5pbnN0YW5jZSwiYmVmb3JlUmVtb3ZlUm93IixlLHQsbik7aWYobyE9PSExKXt2YXIgcj10aGlzLmRhdGFTb3VyY2UsaT1yLmZpbHRlcihmdW5jdGlvbihlLHQpe3JldHVybi0xPT1uLmluZGV4T2YodCl9KTtyLmxlbmd0aD0wLEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHIsaSksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bih0aGlzLmluc3RhbmNlLCJhZnRlclJlbW92ZVJvdyIsZSx0LG4pLHRoaXMuaW5zdGFuY2UuZm9yY2VGdWxsUmVuZGVyPSEwfX0sby5wcm90b3R5cGUucmVtb3ZlQ29sPWZ1bmN0aW9uKGUsdCl7aWYoIm9iamVjdCI9PT10aGlzLmluc3RhbmNlLmRhdGFUeXBlfHx0aGlzLmluc3RhbmNlLmdldFNldHRpbmdzKCkuY29sdW1ucyl0aHJvdyBuZXcgRXJyb3IoImNhbm5vdCByZW1vdmUgY29sdW1uIHdpdGggb2JqZWN0IGRhdGEgc291cmNlIG9yIGNvbHVtbnMgb3B0aW9uIHNwZWNpZmllZCIpO3R8fCh0PTEpLCJudW1iZXIiIT10eXBlb2YgZSYmKGU9LXQpLGU9KHRoaXMuaW5zdGFuY2UuY291bnRDb2xzKCkrZSkldGhpcy5pbnN0YW5jZS5jb3VudENvbHMoKTt2YXIgbj1IYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaW5zdGFuY2UsImJlZm9yZVJlbW92ZUNvbCIsZSx0KTtpZihuIT09ITEpe2Zvcih2YXIgbz10aGlzLmRhdGFTb3VyY2Uscj0wLGk9dGhpcy5pbnN0YW5jZS5jb3VudFNvdXJjZVJvd3MoKTtpPnI7cisrKW9bcl0uc3BsaWNlKGUsdCk7dGhpcy5wcml2LmNvbHVtblNldHRpbmdzLnNwbGljZShlLHQpLEhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5pbnN0YW5jZSwiYWZ0ZXJSZW1vdmVDb2wiLGUsdCksdGhpcy5pbnN0YW5jZS5mb3JjZUZ1bGxSZW5kZXI9ITB9fSxvLnByb3RvdHlwZS5zcGxpY2VDb2w9ZnVuY3Rpb24oZSx0LG4pe3ZhciBvPTQ8PWFyZ3VtZW50cy5sZW5ndGg/W10uc2xpY2UuY2FsbChhcmd1bWVudHMsMyk6W10scj10aGlzLmluc3RhbmNlLmdldERhdGFBdENvbChlKSxpPXIuc2xpY2UodCx0K24pLHM9ci5zbGljZSh0K24pO3cobyxzKTtmb3IodmFyIGE9MDtuPmE7KW8ucHVzaChudWxsKSxhKys7cmV0dXJuIHkobyksdGhpcy5pbnN0YW5jZS5wb3B1bGF0ZUZyb21BcnJheSh0LGUsbyxudWxsLG51bGwsInNwbGljZUNvbCIpLGl9LG8ucHJvdG90eXBlLnNwbGljZVJvdz1mdW5jdGlvbihlLHQsbil7dmFyIG89NDw9YXJndW1lbnRzLmxlbmd0aD9bXS5zbGljZS5jYWxsKGFyZ3VtZW50cywzKTpbXSxyPXRoaXMuaW5zdGFuY2UuZ2V0U291cmNlRGF0YUF0Um93KGUpLGk9ci5zbGljZSh0LHQrbikscz1yLnNsaWNlKHQrbik7dyhvLHMpO2Zvcih2YXIgYT0wO24+YTspby5wdXNoKG51bGwpLGErKztyZXR1cm4gdGhpcy5pbnN0YW5jZS5wb3B1bGF0ZUZyb21BcnJheShlLHQsW29dLG51bGwsbnVsbCwic3BsaWNlUm93IiksaX0sby5wcm90b3R5cGUuZ2V0PWZ1bmN0aW9uKGUsdCl7aWYoZT1IYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaW5zdGFuY2UsIm1vZGlmeVJvdyIsZSksInN0cmluZyI9PXR5cGVvZiB0JiZ0LmluZGV4T2YoIi4iKT4tMSl7dmFyIG49dC5zcGxpdCgiLiIpLG89dGhpcy5kYXRhU291cmNlW2VdO2lmKCFvKXJldHVybiBudWxsO2Zvcih2YXIgcj0wLGk9bi5sZW5ndGg7aT5yO3IrKylpZihvPW9bbltyXV0sInVuZGVmaW5lZCI9PXR5cGVvZiBvKXJldHVybiBudWxsO3JldHVybiBvfXJldHVybiJmdW5jdGlvbiI9PXR5cGVvZiB0P3QodGhpcy5kYXRhU291cmNlLnNsaWNlKGUsZSsxKVswXSk6dGhpcy5kYXRhU291cmNlW2VdJiZ0aGlzLmRhdGFTb3VyY2VbZV0uaGFzT3duUHJvcGVydHkmJnRoaXMuZGF0YVNvdXJjZVtlXS5oYXNPd25Qcm9wZXJ0eSh0KT90aGlzLmRhdGFTb3VyY2VbZV1bdF06bnVsbH07dmFyIFI9aCgiY29weWFibGUiLCExKTtvLnByb3RvdHlwZS5nZXRDb3B5YWJsZT1mdW5jdGlvbihlLHQpe3JldHVybiBSLmNhbGwodGhpcy5pbnN0YW5jZSxlLHRoaXMucHJvcFRvQ29sKHQpKT90aGlzLmdldChlLHQpOiIifSxvLnByb3RvdHlwZS5zZXQ9ZnVuY3Rpb24oZSx0LG4sbyl7aWYoZT1IYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaW5zdGFuY2UsIm1vZGlmeVJvdyIsZSxvfHwiZGF0YW1hcEdldCIpLCJzdHJpbmciPT10eXBlb2YgdCYmdC5pbmRleE9mKCIuIik+LTEpe2Zvcih2YXIgcj10LnNwbGl0KCIuIiksaT10aGlzLmRhdGFTb3VyY2VbZV0scz0wLGE9ci5sZW5ndGgtMTthPnM7cysrKSJ1bmRlZmluZWQiPT10eXBlb2YgaVtyW3NdXSYmKGlbcltzXV09e30pLGk9aVtyW3NdXTtpW3Jbc11dPW59ZWxzZSJmdW5jdGlvbiI9PXR5cGVvZiB0P3QodGhpcy5kYXRhU291cmNlLnNsaWNlKGUsZSsxKVswXSxuKTp0aGlzLmRhdGFTb3VyY2VbZV1bdF09bn0sby5wcm90b3R5cGUucGh5c2ljYWxSb3dzVG9Mb2dpY2FsPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuLG89dGhpcy5pbnN0YW5jZS5jb3VudFNvdXJjZVJvd3MoKSxyPShvK2UpJW8saT1bXSxzPXQ7bz5yJiZzOyluPUhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5pbnN0YW5jZSwibW9kaWZ5Um93IixyKSxpLnB1c2gobikscy0tLHIrKztyZXR1cm4gaX0sby5wcm90b3R5cGUuY2xlYXI9ZnVuY3Rpb24oKXtmb3IodmFyIGU9MDtlPHRoaXMuaW5zdGFuY2UuY291bnRTb3VyY2VSb3dzKCk7ZSsrKWZvcih2YXIgdD0wO3Q8dGhpcy5pbnN0YW5jZS5jb3VudENvbHMoKTt0KyspdGhpcy5zZXQoZSx0aGlzLmNvbFRvUHJvcCh0KSwiIil9LG8ucHJvdG90eXBlLmdldExlbmd0aD1mdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLmluc3RhbmNlLmNvdW50U291cmNlUm93cygpO3JldHVybiBIYW5kc29udGFibGUuaG9va3MuaGFzKCJtb2RpZnlSb3ciLHRoaXMuaW5zdGFuY2UpJiZiKHRoaXMuaW5zdGFuY2UuY291bnRTb3VyY2VSb3dzKCktMSxmdW5jdGlvbihuKXtuPUhhbmRzb250YWJsZS5ob29rcy5ydW4oZS5pbnN0YW5jZSwibW9kaWZ5Um93IixuKSxudWxsPT09biYmdC0tfSksdH0sby5wcm90b3R5cGUuZ2V0QWxsPWZ1bmN0aW9uKCl7dmFyIGU9e3JvdzowLGNvbDowfSx0PXtyb3c6TWF0aC5tYXgodGhpcy5pbnN0YW5jZS5jb3VudFNvdXJjZVJvd3MoKS0xLDApLGNvbDpNYXRoLm1heCh0aGlzLmluc3RhbmNlLmNvdW50Q29scygpLTEsMCl9O3JldHVybiBlLnJvdy10LnJvdyE9PTB8fHRoaXMuaW5zdGFuY2UuY291bnRTb3VyY2VSb3dzKCk/dGhpcy5nZXRSYW5nZShlLHQsby5wcm90b3R5cGUuREVTVElOQVRJT05fUkVOREVSRVIpOltdfSxvLnByb3RvdHlwZS5nZXRSYW5nZT1mdW5jdGlvbihlLHQsbil7dmFyIG8scixpLHMsYSxsPVtdLHU9bj09PXRoaXMuREVTVElOQVRJT05fQ0xJUEJPQVJEX0dFTkVSQVRPUj90aGlzLmdldENvcHlhYmxlOnRoaXMuZ2V0O2ZvcihyPU1hdGgubWF4KGUucm93LHQucm93KSxzPU1hdGgubWF4KGUuY29sLHQuY29sKSxvPU1hdGgubWluKGUucm93LHQucm93KTtyPj1vO28rKyl7YT1bXTt2YXIgYz1IYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaW5zdGFuY2UsIm1vZGlmeVJvdyIsbyk7Zm9yKGk9TWF0aC5taW4oZS5jb2wsdC5jb2wpO3M+PWk7aSsrKXtpZihudWxsPT09YylicmVhazthLnB1c2godS5jYWxsKHRoaXMsbyx0aGlzLmNvbFRvUHJvcChpKSkpfW51bGwhPT1jJiZsLnB1c2goYSl9cmV0dXJuIGx9LG8ucHJvdG90eXBlLmdldFRleHQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZC5zdHJpbmdpZnkodGhpcy5nZXRSYW5nZShlLHQsdGhpcy5ERVNUSU5BVElPTl9SRU5ERVJFUikpfSxvLnByb3RvdHlwZS5nZXRDb3B5YWJsZVRleHQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZC5zdHJpbmdpZnkodGhpcy5nZXRSYW5nZShlLHQsdGhpcy5ERVNUSU5BVElPTl9DTElQQk9BUkRfR0VORVJBVE9SKSl9LEhhbmRzb250YWJsZS5EYXRhTWFwPW99LHtTaGVldENsaXA6IlNoZWV0Q2xpcCIsImhlbHBlcnMvYXJyYXkiOjQyLCJoZWxwZXJzL2RhdGEiOjQ0LCJoZWxwZXJzL251bWJlciI6NDksImhlbHBlcnMvb2JqZWN0Ijo1MCwiaGVscGVycy9zZXR0aW5nIjo1MSxtdWx0aU1hcDo1NX1dLDI3OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0RhdGFTb3VyY2U6e2dldDpmdW5jdGlvbigpe3JldHVybiBmfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpLHMsYSxsPSgobz1lKCJoZWxwZXJzL2RhdGEiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLmNlbGxNZXRob2RMb29rdXBGYWN0b3J5LChyPWUoImhlbHBlcnMvc2V0dGluZyIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuY29sdW1uRmFjdG9yeSxpPWUoImhlbHBlcnMvb2JqZWN0IiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KSx1PShsLmR1Y2tTY2hlbWEsbC5kZWVwRXh0ZW5kLGwuZ2V0UHJvcGVydHkpLGM9KHM9ZSgiaGVscGVycy9hcnJheSIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSksZD0oYy5leHRlbmRBcnJheSxjLmFycmF5RWFjaCksaD0oYT1lKCJoZWxwZXJzL251bWJlciIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSkucmFuZ2VFYWNoLGY9ZnVuY3Rpb24oZSx0KXt0aGlzLmhvdD1lLHRoaXMuZGF0YT10LHRoaXMuZGF0YVR5cGU9ImFycmF5Iix0aGlzLmNvbFRvUHJvcD1mdW5jdGlvbigpe30sdGhpcy5wcm9wVG9Db2w9ZnVuY3Rpb24oKXt9fTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoZix7Z2V0RGF0YTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRhdGF9LGdldEF0Q29sdW1uOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMsbj1bXTtyZXR1cm4gZCh0aGlzLmRhdGEsZnVuY3Rpb24obyl7dmFyIHI9dC5jb2xUb1Byb3AoZSk7bz0ic3RyaW5nIj09dHlwZW9mIHI/dShvLHIpOm9bcl0sbi5wdXNoKG8pfSksbn0sZ2V0QXRSb3c6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZGF0YVtlXX0sZ2V0QXRDZWxsOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZGF0YVtlXVt0aGlzLmNvbFRvUHJvcCh0KV19LGdldEJ5UmFuZ2U6ZnVuY3Rpb24oZSx0KXt2YXIgbj10aGlzLG89TWF0aC5taW4oZS5yb3csdC5yb3cpLHI9TWF0aC5taW4oZS5jb2wsdC5jb2wpLGk9TWF0aC5tYXgoZS5yb3csdC5yb3cpLHM9TWF0aC5tYXgoZS5jb2wsdC5jb2wpLGE9W107cmV0dXJuIGgobyxpLGZ1bmN0aW9uKGUpe3ZhciB0LG89bi5nZXRBdFJvdyhlKTsiYXJyYXkiPT09bi5kYXRhVHlwZT90PW8uc2xpY2UocixzKToib2JqZWN0Ij09PW4uZGF0YVR5cGUmJih0PXt9LGgocixzLGZ1bmN0aW9uKGUpe3ZhciByPW4uY29sVG9Qcm9wKGUpO3Rbcl09b1tyXX0pKSxhLnB1c2godCl9KSxhfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5kYXRhPW51bGwsdGhpcy5ob3Q9bnVsbH19LHt9KX0seyJoZWxwZXJzL2FycmF5Ijo0MiwiaGVscGVycy9kYXRhIjo0NCwiaGVscGVycy9udW1iZXIiOjQ5LCJoZWxwZXJzL29iamVjdCI6NTAsImhlbHBlcnMvc2V0dGluZyI6NTF9XSwyODpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUsdCxuKXtmdW5jdGlvbiBvKGUpe3ZhciBvPSJmdW5jdGlvbiI9PXR5cGVvZiB0LnNldHRpbmdzLmVudGVyTW92ZXM/dC5zZXR0aW5ncy5lbnRlck1vdmVzKGV2ZW50KTp0LnNldHRpbmdzLmVudGVyTW92ZXM7ZT9uLnRyYW5zZm9ybVN0YXJ0KC1vLnJvdywtby5jb2wpOm4udHJhbnNmb3JtU3RhcnQoby5yb3csby5jb2wsITApfWZ1bmN0aW9uIHIoZSl7ZT9uLnRyYW5zZm9ybUVuZCgtMSwwKTpuLnRyYW5zZm9ybVN0YXJ0KC0xLDApfWZ1bmN0aW9uIGkoZSl7ZT9uLnRyYW5zZm9ybUVuZCgxLDApOm4udHJhbnNmb3JtU3RhcnQoMSwwKX1mdW5jdGlvbiBzKGUpe2U/bi50cmFuc2Zvcm1FbmQoMCwxKTpuLnRyYW5zZm9ybVN0YXJ0KDAsMSl9ZnVuY3Rpb24gYShlKXtlP24udHJhbnNmb3JtRW5kKDAsLTEpOm4udHJhbnNmb3JtU3RhcnQoMCwtMSl9ZnVuY3Rpb24gbChsKXt2YXIgYyxwO2lmKGUuaXNMaXN0ZW5pbmcoKSYmKEhhbmRzb250YWJsZS5ob29rcy5ydW4oZSwiYmVmb3JlS2V5RG93biIsbCksIUMmJiF2KGwpJiYodC5sYXN0S2V5Q29kZT1sLmtleUNvZGUsbi5pc1NlbGVjdGVkKCkpKSl7aWYoYz0obC5jdHJsS2V5fHxsLm1ldGFLZXkpJiYhbC5hbHRLZXkseSYmIXkuaXNXYWl0aW5nKCkmJiEoaChsLmtleUNvZGUpfHxmKGwua2V5Q29kZSl8fGN8fGIuaXNFZGl0b3JPcGVuZWQoKSkpcmV0dXJuIHZvaWQgYi5vcGVuRWRpdG9yKCIiLGwpO3N3aXRjaChwPWwuc2hpZnRLZXk/bi5zZXRSYW5nZUVuZDpuLnNldFJhbmdlU3RhcnQsbC5rZXlDb2RlKXtjYXNlIGQuQTohYi5pc0VkaXRvck9wZW5lZCgpJiZjJiYobi5zZWxlY3RBbGwoKSxsLnByZXZlbnREZWZhdWx0KCksZyhsKSk7YnJlYWs7Y2FzZSBkLkFSUk9XX1VQOmIuaXNFZGl0b3JPcGVuZWQoKSYmIXkuaXNXYWl0aW5nKCkmJmIuY2xvc2VFZGl0b3JBbmRTYXZlQ2hhbmdlcyhjKSxyKGwuc2hpZnRLZXkpLGwucHJldmVudERlZmF1bHQoKSxnKGwpO2JyZWFrO2Nhc2UgZC5BUlJPV19ET1dOOmIuaXNFZGl0b3JPcGVuZWQoKSYmIXkuaXNXYWl0aW5nKCkmJmIuY2xvc2VFZGl0b3JBbmRTYXZlQ2hhbmdlcyhjKSxpKGwuc2hpZnRLZXkpLGwucHJldmVudERlZmF1bHQoKSxnKGwpO2JyZWFrO2Nhc2UgZC5BUlJPV19SSUdIVDpiLmlzRWRpdG9yT3BlbmVkKCkmJiF5LmlzV2FpdGluZygpJiZiLmNsb3NlRWRpdG9yQW5kU2F2ZUNoYW5nZXMoYykscyhsLnNoaWZ0S2V5KSxsLnByZXZlbnREZWZhdWx0KCksZyhsKTticmVhaztjYXNlIGQuQVJST1dfTEVGVDpiLmlzRWRpdG9yT3BlbmVkKCkmJiF5LmlzV2FpdGluZygpJiZiLmNsb3NlRWRpdG9yQW5kU2F2ZUNoYW5nZXMoYyksYShsLnNoaWZ0S2V5KSxsLnByZXZlbnREZWZhdWx0KCksZyhsKTticmVhaztjYXNlIGQuVEFCOnZhciB3PSJmdW5jdGlvbiI9PXR5cGVvZiB0LnNldHRpbmdzLnRhYk1vdmVzP3Quc2V0dGluZ3MudGFiTW92ZXMobCk6dC5zZXR0aW5ncy50YWJNb3ZlcztsLnNoaWZ0S2V5P24udHJhbnNmb3JtU3RhcnQoLXcucm93LC13LmNvbCk6bi50cmFuc2Zvcm1TdGFydCh3LnJvdyx3LmNvbCwhMCksbC5wcmV2ZW50RGVmYXVsdCgpLGcobCk7YnJlYWs7Y2FzZSBkLkJBQ0tTUEFDRTpjYXNlIGQuREVMRVRFOm4uZW1wdHkobCksYi5wcmVwYXJlRWRpdG9yKCksbC5wcmV2ZW50RGVmYXVsdCgpO2JyZWFrO2Nhc2UgZC5GMjpiLm9wZW5FZGl0b3IobnVsbCxsKSx5JiZ5LmVuYWJsZUZ1bGxFZGl0TW9kZSgpLGwucHJldmVudERlZmF1bHQoKTticmVhaztjYXNlIGQuRU5URVI6Yi5pc0VkaXRvck9wZW5lZCgpPyh5JiZ5LnN0YXRlIT09SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLldBSVRJTkcmJmIuY2xvc2VFZGl0b3JBbmRTYXZlQ2hhbmdlcyhjKSxvKGwuc2hpZnRLZXkpKTplLmdldFNldHRpbmdzKCkuZW50ZXJCZWdpbnNFZGl0aW5nPyhiLm9wZW5FZGl0b3IobnVsbCxsKSx5JiZ5LmVuYWJsZUZ1bGxFZGl0TW9kZSgpKTpvKGwuc2hpZnRLZXkpLGwucHJldmVudERlZmF1bHQoKSxtKGwpO2JyZWFrO2Nhc2UgZC5FU0NBUEU6Yi5pc0VkaXRvck9wZW5lZCgpJiZiLmNsb3NlRWRpdG9yQW5kUmVzdG9yZU9yaWdpbmFsVmFsdWUoYyksbC5wcmV2ZW50RGVmYXVsdCgpO2JyZWFrO2Nhc2UgZC5IT01FOnAobC5jdHJsS2V5fHxsLm1ldGFLZXk/bmV3IHUoMCx0LnNlbFJhbmdlLmZyb20uY29sKTpuZXcgdSh0LnNlbFJhbmdlLmZyb20ucm93LDApKSxsLnByZXZlbnREZWZhdWx0KCksZyhsKTticmVhaztjYXNlIGQuRU5EOnAobC5jdHJsS2V5fHxsLm1ldGFLZXk/bmV3IHUoZS5jb3VudFJvd3MoKS0xLHQuc2VsUmFuZ2UuZnJvbS5jb2wpOm5ldyB1KHQuc2VsUmFuZ2UuZnJvbS5yb3csZS5jb3VudENvbHMoKS0xKSksbC5wcmV2ZW50RGVmYXVsdCgpLGcobCk7YnJlYWs7Y2FzZSBkLlBBR0VfVVA6bi50cmFuc2Zvcm1TdGFydCgtZS5jb3VudFZpc2libGVSb3dzKCksMCksbC5wcmV2ZW50RGVmYXVsdCgpLGcobCk7YnJlYWs7Y2FzZSBkLlBBR0VfRE9XTjpuLnRyYW5zZm9ybVN0YXJ0KGUuY291bnRWaXNpYmxlUm93cygpLDApLGwucHJldmVudERlZmF1bHQoKSxnKGwpfX19ZnVuY3Rpb24gYygpe2Z1bmN0aW9uIHQoZSx0LG4peyJURCI9PW4ubm9kZU5hbWUmJihiLm9wZW5FZGl0b3IoKSx5JiZ5LmVuYWJsZUZ1bGxFZGl0TW9kZSgpKX1lLmFkZEhvb2soImFmdGVyRG9jdW1lbnRLZXlEb3duIixsKSxwLmFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCJrZXlkb3duIixmdW5jdGlvbih0KXtlLnJ1bkhvb2tzKCJhZnRlckRvY3VtZW50S2V5RG93biIsdCl9KSxlLnZpZXcud3QudXBkYXRlKCJvbkNlbGxEYmxDbGljayIsdCksZS5hZGRIb29rKCJhZnRlckRlc3Ryb3kiLGZ1bmN0aW9uKCl7Qz0hMH0pfXZhciBwLHksYj10aGlzLEM9ITE7cD13KGUpLHRoaXMuZGVzdHJveUVkaXRvcj1mdW5jdGlvbihlKXt0aGlzLmNsb3NlRWRpdG9yKGUpfSx0aGlzLmdldEFjdGl2ZUVkaXRvcj1mdW5jdGlvbigpe3JldHVybiB5fSx0aGlzLnByZXBhcmVFZGl0b3I9ZnVuY3Rpb24oKXt2YXIgbixvLHIsaSxzLGEsbDtyZXR1cm4geSYmeS5pc1dhaXRpbmcoKT92b2lkIHRoaXMuY2xvc2VFZGl0b3IoITEsITEsZnVuY3Rpb24oZSl7ZSYmYi5wcmVwYXJlRWRpdG9yKCl9KToobj10LnNlbFJhbmdlLmhpZ2hsaWdodC5yb3csbz10LnNlbFJhbmdlLmhpZ2hsaWdodC5jb2wscj1lLmNvbFRvUHJvcChvKSxpPWUuZ2V0Q2VsbChuLG8pLHM9ZS5nZXREYXRhQXRDZWxsKG4sbyksYT1lLmdldENlbGxNZXRhKG4sbyksbD1lLmdldENlbGxFZGl0b3IoYSksdm9pZChsPyh5PUhhbmRzb250YWJsZS5lZGl0b3JzLmdldEVkaXRvcihsLGUpLHkucHJlcGFyZShuLG8scixpLHMsYSkpOnk9dm9pZCAwKSl9LHRoaXMuaXNFZGl0b3JPcGVuZWQ9ZnVuY3Rpb24oKXtyZXR1cm4geSYmeS5pc09wZW5lZCgpfSx0aGlzLm9wZW5FZGl0b3I9ZnVuY3Rpb24oZSx0KXt5JiYheS5jZWxsUHJvcGVydGllcy5yZWFkT25seT95LmJlZ2luRWRpdGluZyhlLHQpOnkmJnkuY2VsbFByb3BlcnRpZXMucmVhZE9ubHkmJnQmJnQua2V5Q29kZT09PWQuRU5URVImJm8oKX0sdGhpcy5jbG9zZUVkaXRvcj1mdW5jdGlvbihlLHQsbil7eT95LmZpbmlzaEVkaXRpbmcoZSx0LG4pOm4mJm4oITEpfSx0aGlzLmNsb3NlRWRpdG9yQW5kU2F2ZUNoYW5nZXM9ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuY2xvc2VFZGl0b3IoITEsZSl9LHRoaXMuY2xvc2VFZGl0b3JBbmRSZXN0b3JlT3JpZ2luYWxWYWx1ZT1mdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5jbG9zZUVkaXRvcighMCxlKX0sYygpfU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0VkaXRvck1hbmFnZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGEsbCx1PShyPWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL2Nvb3JkcyIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuV2Fsa29udGFibGVDZWxsQ29vcmRzLGM9KGk9ZSgiaGVscGVycy91bmljb2RlIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KSxkPWMuS0VZX0NPREVTLGg9Yy5pc01ldGFLZXksZj1jLmlzQ3RybEtleSxwPShzPWUoImhlbHBlcnMvZG9tL2V2ZW50IikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KSxnPXAuc3RvcFByb3BhZ2F0aW9uLG09cC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24sdj1wLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkLHc9KChhPWUoImVkaXRvcnMiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLmdldEVkaXRvciwobD1lKCJldmVudE1hbmFnZXIiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLmV2ZW50TWFuYWdlcik7SGFuZHNvbnRhYmxlLkVkaXRvck1hbmFnZXI9b30seyIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiOjUsZWRpdG9yczoyOSxldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2V2ZW50Ijo0NiwiaGVscGVycy91bmljb2RlIjo1M31dLDI5OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSl7dmFyIHQsbjtuPXt9LHQ9ZSx0aGlzLmdldENvbnN0cnVjdG9yPWZ1bmN0aW9uKCl7cmV0dXJuIGV9LHRoaXMuZ2V0SW5zdGFuY2U9ZnVuY3Rpb24oZSl7cmV0dXJuIGUuZ3VpZCBpbiBufHwobltlLmd1aWRdPW5ldyB0KGUpKSxuW2UuZ3VpZF19fWZ1bmN0aW9uIHIoZSx0KXt2YXIgbj1uZXcgbyh0KTsic3RyaW5nIj09dHlwZW9mIGUmJihjW2VdPW4sSGFuZHNvbnRhYmxlLmVkaXRvcnNbdShlKSsiRWRpdG9yIl09dCksZC5zZXQodCxuKX1mdW5jdGlvbiBpKGUsdCl7dmFyIG47aWYoImZ1bmN0aW9uIj09dHlwZW9mIGUpZC5nZXQoZSl8fHIobnVsbCxlKSxuPWQuZ2V0KGUpO2Vsc2V7aWYoInN0cmluZyIhPXR5cGVvZiBlKXRocm93IEVycm9yKCdPbmx5IHN0cmluZ3MgYW5kIGZ1bmN0aW9ucyBjYW4gYmUgcGFzc2VkIGFzICJlZGl0b3IiIHBhcmFtZXRlciAnKTtuPWNbZV19aWYoIW4pdGhyb3cgRXJyb3IoJ05vIGVkaXRvciByZWdpc3RlcmVkIHVuZGVyIG5hbWUgIicrZSsnIicpO3JldHVybiBuLmdldEluc3RhbmNlKHQpfWZ1bmN0aW9uIHMoZSl7dmFyIHQ7aWYoInN0cmluZyIhPXR5cGVvZiBlKXRocm93IEVycm9yKCdPbmx5IHN0cmluZ3MgYW5kIGZ1bmN0aW9ucyBjYW4gYmUgcGFzc2VkIGFzICJlZGl0b3IiIHBhcmFtZXRlciAnKTtpZih0PWNbZV0sIXQpdGhyb3cgRXJyb3IoJ05vIGVkaXRvciByZWdpc3RlcmVkIHVuZGVyIG5hbWUgIicrZSsnIicpO3JldHVybiB0LmdldENvbnN0cnVjdG9yKCl9ZnVuY3Rpb24gYShlKXtyZXR1cm4gY1tlXT8hMDohMX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtyZWdpc3RlckVkaXRvcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHJ9fSxnZXRFZGl0b3I6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0saGFzRWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYX19LGdldEVkaXRvckNvbnN0cnVjdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gc319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBsLHU9KGw9ZSgiaGVscGVycy9zdHJpbmciKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLnRvVXBwZXJDYXNlRmlyc3QsYz17fSxkPW5ldyBXZWFrTWFwO0hhbmRzb250YWJsZS5lZGl0b3JzPUhhbmRzb250YWJsZS5lZGl0b3JzfHx7fSxIYW5kc29udGFibGUuZWRpdG9ycy5yZWdpc3RlckVkaXRvcj1yLEhhbmRzb250YWJsZS5lZGl0b3JzLmdldEVkaXRvcj1pfSx7ImhlbHBlcnMvc3RyaW5nIjo1Mn1dLDMwOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSl7dGhpcy5pbnN0YW5jZT1lLHRoaXMuc3RhdGU9SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLlZJUkdJTix0aGlzLl9vcGVuZWQ9ITEsdGhpcy5fZnVsbEVkaXRNb2RlPSExLHRoaXMuX2Nsb3NlQ2FsbGJhY2s9bnVsbCx0aGlzLmluaXQoKX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtCYXNlRWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciByLGkscz0ocj1lKCJoZWxwZXJzL21peGVkIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5zdHJpbmdpZnksYT0oaT1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLldhbGtvbnRhYmxlQ2VsbENvb3JkcztIYW5kc29udGFibGUuZWRpdG9ycz1IYW5kc29udGFibGUuZWRpdG9yc3x8e30sSGFuZHNvbnRhYmxlLmVkaXRvcnMuQmFzZUVkaXRvcj1vLEhhbmRzb250YWJsZS5FZGl0b3JTdGF0ZT17VklSR0lOOiJTVEFURV9WSVJHSU4iLEVESVRJTkc6IlNUQVRFX0VESVRJTkciLFdBSVRJTkc6IlNUQVRFX1dBSVRJTkciLEZJTklTSEVEOiJTVEFURV9GSU5JU0hFRCJ9LG8ucHJvdG90eXBlLl9maXJlQ2FsbGJhY2tzPWZ1bmN0aW9uKGUpe3RoaXMuX2Nsb3NlQ2FsbGJhY2smJih0aGlzLl9jbG9zZUNhbGxiYWNrKGUpLHRoaXMuX2Nsb3NlQ2FsbGJhY2s9bnVsbCl9LG8ucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oKXt9LG8ucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKCl7dGhyb3cgRXJyb3IoIkVkaXRvciBnZXRWYWx1ZSgpIG1ldGhvZCB1bmltcGxlbWVudGVkIil9LG8ucHJvdG90eXBlLnNldFZhbHVlPWZ1bmN0aW9uKGUpe3Rocm93IEVycm9yKCJFZGl0b3Igc2V0VmFsdWUoKSBtZXRob2QgdW5pbXBsZW1lbnRlZCIpfSxvLnByb3RvdHlwZS5vcGVuPWZ1bmN0aW9uKCl7dGhyb3cgRXJyb3IoIkVkaXRvciBvcGVuKCkgbWV0aG9kIHVuaW1wbGVtZW50ZWQiKX0sby5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oKXt0aHJvdyBFcnJvcigiRWRpdG9yIGNsb3NlKCkgbWV0aG9kIHVuaW1wbGVtZW50ZWQiKX0sby5wcm90b3R5cGUucHJlcGFyZT1mdW5jdGlvbihlLHQsbixvLHIsaSl7dGhpcy5URD1vLHRoaXMucm93PWUsdGhpcy5jb2w9dCx0aGlzLnByb3A9bix0aGlzLm9yaWdpbmFsVmFsdWU9cix0aGlzLmNlbGxQcm9wZXJ0aWVzPWksdGhpcy5pbnN0YW5jZS52aWV3LmlzTW91c2VEb3duKCkmJmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQmJmRvY3VtZW50LmFjdGl2ZUVsZW1lbnQhPT1kb2N1bWVudC5ib2R5P2RvY3VtZW50LmFjdGl2ZUVsZW1lbnQuYmx1cigpOmRvY3VtZW50LmFjdGl2ZUVsZW1lbnR8fGRvY3VtZW50LmJvZHkuZm9jdXMoKSx0aGlzLnN0YXRlPUhhbmRzb250YWJsZS5FZGl0b3JTdGF0ZS5WSVJHSU59LG8ucHJvdG90eXBlLmV4dGVuZD1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtuLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1mdW5jdGlvbiB0KGUsdCl7ZnVuY3Rpb24gbigpe31yZXR1cm4gbi5wcm90b3R5cGU9dC5wcm90b3R5cGUsZS5wcm90b3R5cGU9bmV3IG4sZS5wcm90b3R5cGUuY29uc3RydWN0b3I9ZSxlfXZhciBuPXRoaXMuY29uc3RydWN0b3I7cmV0dXJuIHQoZSxuKX0sby5wcm90b3R5cGUuc2F2ZVZhbHVlPWZ1bmN0aW9uKGUsdCl7dmFyIG4sbzt0PyhuPXRoaXMuaW5zdGFuY2UuZ2V0U2VsZWN0ZWQoKSxuWzBdPm5bMl0mJihvPW5bMF0sblswXT1uWzJdLG5bMl09byksblsxXT5uWzNdJiYobz1uWzFdLG5bMV09blszXSxuWzNdPW8pLHRoaXMuaW5zdGFuY2UucG9wdWxhdGVGcm9tQXJyYXkoblswXSxuWzFdLGUsblsyXSxuWzNdLCJlZGl0IikpOnRoaXMuaW5zdGFuY2UucG9wdWxhdGVGcm9tQXJyYXkodGhpcy5yb3csdGhpcy5jb2wsZSxudWxsLG51bGwsImVkaXQiKX0sby5wcm90b3R5cGUuYmVnaW5FZGl0aW5nPWZ1bmN0aW9uKGUsdCl7dGhpcy5zdGF0ZT09SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLlZJUkdJTiYmKHRoaXMuaW5zdGFuY2Uudmlldy5zY3JvbGxWaWV3cG9ydChuZXcgYSh0aGlzLnJvdyx0aGlzLmNvbCkpLHRoaXMuaW5zdGFuY2Uudmlldy5yZW5kZXIoKSx0aGlzLnN0YXRlPUhhbmRzb250YWJsZS5FZGl0b3JTdGF0ZS5FRElUSU5HLGU9InN0cmluZyI9PXR5cGVvZiBlP2U6dGhpcy5vcmlnaW5hbFZhbHVlLHRoaXMuc2V0VmFsdWUocyhlKSksdGhpcy5vcGVuKHQpLHRoaXMuX29wZW5lZD0hMCx0aGlzLmZvY3VzKCksdGhpcy5pbnN0YW5jZS52aWV3LnJlbmRlcigpKX0sby5wcm90b3R5cGUuZmluaXNoRWRpdGluZz1mdW5jdGlvbihlLHQsbil7dmFyIG8scj10aGlzO2lmKG4pe3ZhciBpPXRoaXMuX2Nsb3NlQ2FsbGJhY2s7dGhpcy5fY2xvc2VDYWxsYmFjaz1mdW5jdGlvbihlKXtpJiZpKGUpLG4oZSl9fWlmKCF0aGlzLmlzV2FpdGluZygpKXtpZih0aGlzLnN0YXRlPT1IYW5kc29udGFibGUuRWRpdG9yU3RhdGUuVklSR0lOKXJldHVybiB2b2lkIHRoaXMuaW5zdGFuY2UuX3JlZ2lzdGVyVGltZW91dChzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ci5fZmlyZUNhbGxiYWNrcyghMCl9LDApKTtpZih0aGlzLnN0YXRlPT1IYW5kc29udGFibGUuRWRpdG9yU3RhdGUuRURJVElORyl7aWYoZSlyZXR1cm4gdGhpcy5jYW5jZWxDaGFuZ2VzKCksdm9pZCB0aGlzLmluc3RhbmNlLnZpZXcucmVuZGVyKCk7bz10aGlzLmluc3RhbmNlLmdldFNldHRpbmdzKCkudHJpbVdoaXRlc3BhY2U/W1sic3RyaW5nIj09dHlwZW9mIHRoaXMuZ2V0VmFsdWUoKT9TdHJpbmcucHJvdG90eXBlLnRyaW0uY2FsbCh0aGlzLmdldFZhbHVlKCl8fCIiKTp0aGlzLmdldFZhbHVlKCldXTpbW3RoaXMuZ2V0VmFsdWUoKV1dLHRoaXMuc3RhdGU9SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLldBSVRJTkcsdGhpcy5zYXZlVmFsdWUobyx0KSx0aGlzLmluc3RhbmNlLmdldENlbGxWYWxpZGF0b3IodGhpcy5jZWxsUHJvcGVydGllcyk/dGhpcy5pbnN0YW5jZS5hZGRIb29rT25jZSgicG9zdEFmdGVyVmFsaWRhdGUiLGZ1bmN0aW9uKGUpe3Iuc3RhdGU9SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLkZJTklTSEVELHIuZGlzY2FyZEVkaXRvcihlKX0pOih0aGlzLnN0YXRlPUhhbmRzb250YWJsZS5FZGl0b3JTdGF0ZS5GSU5JU0hFRCx0aGlzLmRpc2NhcmRFZGl0b3IoITApKX19fSxvLnByb3RvdHlwZS5jYW5jZWxDaGFuZ2VzPWZ1bmN0aW9uKCl7dGhpcy5zdGF0ZT1IYW5kc29udGFibGUuRWRpdG9yU3RhdGUuRklOSVNIRUQsdGhpcy5kaXNjYXJkRWRpdG9yKCl9LG8ucHJvdG90eXBlLmRpc2NhcmRFZGl0b3I9ZnVuY3Rpb24oZSl7dGhpcy5zdGF0ZT09PUhhbmRzb250YWJsZS5FZGl0b3JTdGF0ZS5GSU5JU0hFRCYmKGU9PT0hMSYmdGhpcy5jZWxsUHJvcGVydGllcy5hbGxvd0ludmFsaWQhPT0hMD8odGhpcy5pbnN0YW5jZS5zZWxlY3RDZWxsKHRoaXMucm93LHRoaXMuY29sKSx0aGlzLmZvY3VzKCksdGhpcy5zdGF0ZT1IYW5kc29udGFibGUuRWRpdG9yU3RhdGUuRURJVElORyx0aGlzLl9maXJlQ2FsbGJhY2tzKCExKSk6KHRoaXMuY2xvc2UoKSx0aGlzLl9vcGVuZWQ9ITEsdGhpcy5fZnVsbEVkaXRNb2RlPSExLHRoaXMuc3RhdGU9SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLlZJUkdJTix0aGlzLl9maXJlQ2FsbGJhY2tzKCEwKSkpfSxvLnByb3RvdHlwZS5lbmFibGVGdWxsRWRpdE1vZGU9ZnVuY3Rpb24oKXt0aGlzLl9mdWxsRWRpdE1vZGU9ITB9LG8ucHJvdG90eXBlLmlzSW5GdWxsRWRpdE1vZGU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZnVsbEVkaXRNb2RlfSxvLnByb3RvdHlwZS5pc09wZW5lZD1mdW5jdGlvbigpe3JldHVybiB0aGlzLl9vcGVuZWR9LG8ucHJvdG90eXBlLmlzV2FpdGluZz1mdW5jdGlvbigpe3JldHVybiB0aGlzLnN0YXRlPT09SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLldBSVRJTkd9LG8ucHJvdG90eXBlLmNoZWNrRWRpdG9yU2VjdGlvbj1mdW5jdGlvbigpe3ZhciBlPXRoaXMuaW5zdGFuY2UuY291bnRSb3dzKCksdD0iIjtyZXR1cm4gdGhpcy5yb3c8dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5ncygpLmZpeGVkUm93c1RvcD90PXRoaXMuY29sPHRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZ3MoKS5maXhlZENvbHVtbnNMZWZ0PyJ0b3AtbGVmdC1jb3JuZXIiOiJ0b3AiOnRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZ3MoKS5maXhlZFJvd3NCb3R0b20mJnRoaXMucm93Pj1lLXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZ3MoKS5maXhlZFJvd3NCb3R0b20/dD10aGlzLmNvbDx0aGlzLmluc3RhbmNlLmdldFNldHRpbmdzKCkuZml4ZWRDb2x1bW5zTGVmdD8iYm90dG9tLWxlZnQtY29ybmVyIjoiYm90dG9tIjp0aGlzLmNvbDx0aGlzLmluc3RhbmNlLmdldFNldHRpbmdzKCkuZml4ZWRDb2x1bW5zTGVmdCYmKHQ9ImxlZnQiKSx0fX0seyIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiOjUsImhlbHBlcnMvbWl4ZWQiOjQ4fV0sMzE6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlKXtUPSExO3ZhciB0PXRoaXMuZ2V0QWN0aXZlRWRpdG9yKCk7aWYoaChlLmtleUNvZGUpfHxlLmtleUNvZGU9PT1kLkJBQ0tTUEFDRXx8ZS5rZXlDb2RlPT09ZC5ERUxFVEV8fGUua2V5Q29kZT09PWQuSU5TRVJUKXt2YXIgbj0wO2lmKGUua2V5Q29kZT09PWQuQyYmKGUuY3RybEtleXx8ZS5tZXRhS2V5KSlyZXR1cm47dC5pc09wZW5lZCgpfHwobis9MTApLHQuaHRFZGl0b3ImJnQuaW5zdGFuY2UuX3JlZ2lzdGVyVGltZW91dChzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dC5xdWVyeUNob2ljZXModC5URVhUQVJFQS52YWx1ZSksVD0hMH0sbikpfX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtBdXRvY29tcGxldGVFZGl0b3I6e2dldDpmdW5jdGlvbigpe3JldHVybiBFfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGEsbCx1LGM9KHI9ZSgiaGVscGVycy91bmljb2RlIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KSxkPWMuS0VZX0NPREVTLGg9Yy5pc1ByaW50YWJsZUNoYXIsZj0oaT1lKCJoZWxwZXJzL21peGVkIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5zdHJpbmdpZnkscD0ocz1lKCJoZWxwZXJzL2FycmF5IikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5waXZvdCxnPShhPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLG09Zy5hZGRDbGFzcyx2PWcuZ2V0Q2FyZXRQb3NpdGlvbix3PWcuZ2V0U2Nyb2xsYmFyV2lkdGgseT1nLmdldFNlbGVjdGlvbkVuZFBvc2l0aW9uLGI9Zy5vdXRlcldpZHRoLEM9Zy5zZXRDYXJldFBvc2l0aW9uLFI9KGw9ZSgiZWRpdG9ycyIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSksXz0oUi5nZXRFZGl0b3JDb25zdHJ1Y3RvcixSLnJlZ2lzdGVyRWRpdG9yKSxTPSh1PWUoImhhbmRzb250YWJsZUVkaXRvciIpLHUmJnUuX19lc01vZHVsZSYmdXx8eyJkZWZhdWx0Ijp1fSkuSGFuZHNvbnRhYmxlRWRpdG9yLEU9Uy5wcm90b3R5cGUuZXh0ZW5kKCk7RS5wcm90b3R5cGUuaW5pdD1mdW5jdGlvbigpe1MucHJvdG90eXBlLmluaXQuYXBwbHkodGhpcyxhcmd1bWVudHMpLHRoaXMucXVlcnk9bnVsbCx0aGlzLmNob2ljZXM9W119LEUucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzPWZ1bmN0aW9uKCl7Uy5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHMuYXBwbHkodGhpcyxhcmd1bWVudHMpLG0odGhpcy5odENvbnRhaW5lciwiYXV0b2NvbXBsZXRlRWRpdG9yIiksbSh0aGlzLmh0Q29udGFpbmVyLC0xPT09d2luZG93Lm5hdmlnYXRvci5wbGF0Zm9ybS5pbmRleE9mKCJNYWMiKT8iIjoiaHRNYWNTY3JvbGwiKX07dmFyIFQ9ITE7RS5wcm90b3R5cGUucHJlcGFyZT1mdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UuYWRkSG9vaygiYmVmb3JlS2V5RG93biIsbyksUy5wcm90b3R5cGUucHJlcGFyZS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LEUucHJvdG90eXBlLm9wZW49ZnVuY3Rpb24oKXt0aGlzLlRFWFRBUkVBX1BBUkVOVC5zdHlsZS5vdmVyZmxvdz0iYXV0byIsUy5wcm90b3R5cGUub3Blbi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5URVhUQVJFQV9QQVJFTlQuc3R5bGUub3ZlcmZsb3c9IiI7dmFyIGU9dGhpcy5odEVkaXRvci5nZXRJbnN0YW5jZSgpLHQ9dGhpcyxuPXZvaWQgMD09PXRoaXMuY2VsbFByb3BlcnRpZXMudHJpbURyb3Bkb3duPyEwOnRoaXMuY2VsbFByb3BlcnRpZXMudHJpbURyb3Bkb3duO3RoaXMuVEVYVEFSRUEuc3R5bGUudmlzaWJpbGl0eT0idmlzaWJsZSIsdGhpcy5mb2N1cygpLGUudXBkYXRlU2V0dGluZ3Moe2NvbFdpZHRoczpuP1tiKHRoaXMuVEVYVEFSRUEpLTJdOnZvaWQgMCx3aWR0aDpuP2IodGhpcy5URVhUQVJFQSkrdygpKzI6dm9pZCAwLGFmdGVyUmVuZGVyZXI6ZnVuY3Rpb24oZSxuLG8scixpKXt2YXIgcyxhLGw9dGhpcy5nZXRDZWxsTWV0YShuLG8pLmZpbHRlcmluZ0Nhc2VTZW5zaXRpdmU9PT0hMCxpPWYoaSk7aSYmKHM9bD9pLmluZGV4T2YodGhpcy5xdWVyeSk6aS50b0xvd2VyQ2FzZSgpLmluZGV4T2YodC5xdWVyeS50b0xvd2VyQ2FzZSgpKSwtMSE9cyYmKGE9aS5zdWJzdHIocyx0LnF1ZXJ5Lmxlbmd0aCksZS5pbm5lckhUTUw9aS5yZXBsYWNlKGEsIjxzdHJvbmc+IithKyI8L3N0cm9uZz4iKSkpfSxhdXRvQ29sdW1uU2l6ZTohMCxtb2RpZnlDb2xXaWR0aDpmdW5jdGlvbihlLHQpe3ZhciBvPXRoaXMuZ2V0UGx1Z2luKCJhdXRvQ29sdW1uU2l6ZSIpLndpZHRocztyZXR1cm4gb1t0XSYmKGU9b1t0XSksbj9lOmUrMTV9fSksdGhpcy5odEVkaXRvci52aWV3Lnd0Lnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUuc3R5bGVbInBhZGRpbmctcmlnaHQiXT13KCkrMisicHgiLFQmJihUPSExKSx0Lmluc3RhbmNlLl9yZWdpc3RlclRpbWVvdXQoc2V0VGltZW91dChmdW5jdGlvbigpe3QucXVlcnlDaG9pY2VzKHQuVEVYVEFSRUEudmFsdWUpfSwwKSl9LEUucHJvdG90eXBlLmNsb3NlPWZ1bmN0aW9uKCl7Uy5wcm90b3R5cGUuY2xvc2UuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxFLnByb3RvdHlwZS5xdWVyeUNob2ljZXM9ZnVuY3Rpb24oZSl7aWYodGhpcy5xdWVyeT1lLCJmdW5jdGlvbiI9PXR5cGVvZiB0aGlzLmNlbGxQcm9wZXJ0aWVzLnNvdXJjZSl7dmFyIHQ9dGhpczt0aGlzLmNlbGxQcm9wZXJ0aWVzLnNvdXJjZShlLGZ1bmN0aW9uKGUpe3QudXBkYXRlQ2hvaWNlc0xpc3QoZSl9KX1lbHNlIGlmKEFycmF5LmlzQXJyYXkodGhpcy5jZWxsUHJvcGVydGllcy5zb3VyY2UpKXt2YXIgbjtpZihlJiZ0aGlzLmNlbGxQcm9wZXJ0aWVzLmZpbHRlciE9PSExKXt2YXIgbz10aGlzLmNlbGxQcm9wZXJ0aWVzLmZpbHRlcmluZ0Nhc2VTZW5zaXRpdmU9PT0hMCxyPWUudG9Mb3dlckNhc2UoKTtuPXRoaXMuY2VsbFByb3BlcnRpZXMuc291cmNlLmZpbHRlcihmdW5jdGlvbih0KXtyZXR1cm4gbz8tMSE9dC5pbmRleE9mKGUpOi0xIT10LnRvTG93ZXJDYXNlKCkuaW5kZXhPZihyKX0pfWVsc2Ugbj10aGlzLmNlbGxQcm9wZXJ0aWVzLnNvdXJjZTt0aGlzLnVwZGF0ZUNob2ljZXNMaXN0KG4pfWVsc2UgdGhpcy51cGRhdGVDaG9pY2VzTGlzdChbXSl9LEUucHJvdG90eXBlLnVwZGF0ZUNob2ljZXNMaXN0PWZ1bmN0aW9uKGUpe3ZhciB0LG49dih0aGlzLlRFWFRBUkVBKSxvPXkodGhpcy5URVhUQVJFQSkscj1FLnNvcnRCeVJlbGV2YW5jZSh0aGlzLmdldFZhbHVlKCksZSx0aGlzLmNlbGxQcm9wZXJ0aWVzLmZpbHRlcmluZ0Nhc2VTZW5zaXRpdmUpO2lmKDA9PXRoaXMuY2VsbFByb3BlcnRpZXMuZmlsdGVyKXQ9clswXTtlbHNle2Zvcih2YXIgaT1bXSxzPTAsYT1yLmxlbmd0aDthPnM7cysrKWkucHVzaChlW3Jbc11dKTt0PTAsZT1pfXRoaXMuY2hvaWNlcz1lLHRoaXMuaHRFZGl0b3IubG9hZERhdGEocChbZV0pKSx0aGlzLnVwZGF0ZURyb3Bkb3duSGVpZ2h0KCksdGhpcy5jZWxsUHJvcGVydGllcy5zdHJpY3Q9PT0hMCYmdGhpcy5oaWdobGlnaHRCZXN0TWF0Y2hpbmdDaG9pY2UodCksdGhpcy5pbnN0YW5jZS5saXN0ZW4oKSx0aGlzLlRFWFRBUkVBLmZvY3VzKCksQyh0aGlzLlRFWFRBUkVBLG4sbj09bz92b2lkIDA6byl9LEUucHJvdG90eXBlLnVwZGF0ZURyb3Bkb3duSGVpZ2h0PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5odEVkaXRvci5nZXRDb2xXaWR0aCgwKSt3KCkrMix0PXZvaWQgMD09PXRoaXMuY2VsbFByb3BlcnRpZXMudHJpbURyb3Bkb3duPyEwOnRoaXMuY2VsbFByb3BlcnRpZXMudHJpbURyb3Bkb3duO3RoaXMuaHRFZGl0b3IudXBkYXRlU2V0dGluZ3Moe2hlaWdodDp0aGlzLmdldERyb3Bkb3duSGVpZ2h0KCksd2lkdGg6dD92b2lkIDA6ZX0pLHRoaXMuaHRFZGl0b3Iudmlldy53dC53dFRhYmxlLmFsaWduT3ZlcmxheXNXaXRoVHJpbW1pbmdDb250YWluZXIoKX0sRS5wcm90b3R5cGUuZmluaXNoRWRpdGluZz1mdW5jdGlvbihlKXtlfHx0aGlzLmluc3RhbmNlLnJlbW92ZUhvb2soImJlZm9yZUtleURvd24iLG8pLFMucHJvdG90eXBlLmZpbmlzaEVkaXRpbmcuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxFLnByb3RvdHlwZS5oaWdobGlnaHRCZXN0TWF0Y2hpbmdDaG9pY2U9ZnVuY3Rpb24oZSl7Im51bWJlciI9PXR5cGVvZiBlP3RoaXMuaHRFZGl0b3Iuc2VsZWN0Q2VsbChlLDApOnRoaXMuaHRFZGl0b3IuZGVzZWxlY3RDZWxsKCl9LEUuc29ydEJ5UmVsZXZhbmNlPWZ1bmN0aW9uKGUsdCxuKXt2YXIgbyxyLGkscyxhLGw9W10sdT1lLmxlbmd0aCxjPVtdO2lmKDA9PT11KXtmb3Iocz0wLGE9dC5sZW5ndGg7YT5zO3MrKyljLnB1c2gocyk7cmV0dXJuIGN9Zm9yKHM9MCxhPXQubGVuZ3RoO2E+cztzKyspbz1mKHRbc10pLHI9bj9vLmluZGV4T2YoZSk6by50b0xvd2VyQ2FzZSgpLmluZGV4T2YoZS50b0xvd2VyQ2FzZSgpKSwtMSE9ciYmKGk9by5sZW5ndGgtci11LGwucHVzaCh7YmFzZUluZGV4OnMsaW5kZXg6cixjaGFyc0xlZnQ6aSx2YWx1ZTpvfSkpO2ZvcihsLnNvcnQoZnVuY3Rpb24oZSx0KXtyZXR1cm4tMT09PXQuaW5kZXg/LTE6LTE9PT1lLmluZGV4PzE6ZS5pbmRleDx0LmluZGV4Py0xOnQuaW5kZXg8ZS5pbmRleD8xOmUuaW5kZXg9PT10LmluZGV4P2UuY2hhcnNMZWZ0PHQuY2hhcnNMZWZ0Py0xOmUuY2hhcnNMZWZ0PnQuY2hhcnNMZWZ0PzE6MDp2b2lkIDB9KSxzPTAsYT1sLmxlbmd0aDthPnM7cysrKWMucHVzaChsW3NdLmJhc2VJbmRleCk7cmV0dXJuIGN9LEUucHJvdG90eXBlLmdldERyb3Bkb3duSGVpZ2h0PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5odEVkaXRvci5nZXRJbnN0YW5jZSgpLmdldFJvd0hlaWdodCgwKXx8MjMsdD10aGlzLmNlbGxQcm9wZXJ0aWVzLnZpc2libGVSb3dzO3JldHVybiB0aGlzLmNob2ljZXMubGVuZ3RoPj10P3QqZTp0aGlzLmNob2ljZXMubGVuZ3RoKmUrOH0sRS5wcm90b3R5cGUuYWxsb3dLZXlFdmVudFByb3BhZ2F0aW9uPWZ1bmN0aW9uKGUpe3ZhciB0PXtyb3c6dGhpcy5odEVkaXRvci5nZXRTZWxlY3RlZFJhbmdlKCk/dGhpcy5odEVkaXRvci5nZXRTZWxlY3RlZFJhbmdlKCkuZnJvbS5yb3c6LTF9LG49ITE7cmV0dXJuIGU9PT1kLkFSUk9XX0RPV04mJnQucm93PHRoaXMuaHRFZGl0b3IuY291bnRSb3dzKCktMSYmKG49ITApLGU9PT1kLkFSUk9XX1VQJiZ0LnJvdz4tMSYmKG49ITApLG59LF8oImF1dG9jb21wbGV0ZSIsRSl9LHtlZGl0b3JzOjI5LGhhbmRzb250YWJsZUVkaXRvcjozNSwiaGVscGVycy9hcnJheSI6NDIsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL21peGVkIjo0OCwiaGVscGVycy91bmljb2RlIjo1M31dLDMyOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0NoZWNrYm94RWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdX19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzPShvPWUoImVkaXRvcnMiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLnJlZ2lzdGVyRWRpdG9yLGE9KHI9ZSgiX2Jhc2VFZGl0b3IiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLkJhc2VFZGl0b3IsbD0oaT1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5oYXNDbGFzcyx1PWZ1bmN0aW9uKCl7JHRyYWNldXJSdW50aW1lLnN1cGVyQ29uc3RydWN0b3IoYykuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxjPXU7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKHUse2JlZ2luRWRpdGluZzpmdW5jdGlvbigpe3ZhciBlPXRoaXMuVEQucXVlcnlTZWxlY3RvcignaW5wdXRbdHlwZT0iY2hlY2tib3giXScpO2woZSwiaHRCYWRWYWx1ZSIpfHxlLmNsaWNrKCl9LGZpbmlzaEVkaXRpbmc6ZnVuY3Rpb24oKXt9LGluaXQ6ZnVuY3Rpb24oKXt9LG9wZW46ZnVuY3Rpb24oKXt9LGNsb3NlOmZ1bmN0aW9uKCl7fSxnZXRWYWx1ZTpmdW5jdGlvbigpe30sc2V0VmFsdWU6ZnVuY3Rpb24oKXt9LGZvY3VzOmZ1bmN0aW9uKCl7fX0se30sYSkscygiY2hlY2tib3giLHUpfSx7X2Jhc2VFZGl0b3I6MzAsZWRpdG9yczoyOSwiaGVscGVycy9kb20vZWxlbWVudCI6NDV9XSwzMzpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtEYXRlRWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gU319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbCx1LGMsZCxoPShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLGY9aC5hZGRDbGFzcyxwPWgub3V0ZXJIZWlnaHQsZz0ocj1lKCJoZWxwZXJzL29iamVjdCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuZGVlcEV4dGVuZCxtPShpPWUoImV2ZW50TWFuYWdlciIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuRXZlbnRNYW5hZ2VyLHY9KHM9ZSgiZWRpdG9ycyIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSksdz0odi5nZXRFZGl0b3Isdi5yZWdpc3RlckVkaXRvcikseT0oYT1lKCJoZWxwZXJzL3VuaWNvZGUiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLmlzTWV0YUtleSxiPShsPWUoImhlbHBlcnMvZG9tL2V2ZW50IiksbCYmbC5fX2VzTW9kdWxlJiZsfHx7ImRlZmF1bHQiOmx9KS5zdG9wUHJvcGFnYXRpb24sQz0odT1lKCJ0ZXh0RWRpdG9yIiksdSYmdS5fX2VzTW9kdWxlJiZ1fHx7ImRlZmF1bHQiOnV9KS5UZXh0RWRpdG9yLFI9KGM9ZSgibW9tZW50IiksYyYmYy5fX2VzTW9kdWxlJiZjfHx7ImRlZmF1bHQiOmN9KVsiZGVmYXVsdCJdLF89KGQ9ZSgicGlrYWRheSIpLGQmJmQuX19lc01vZHVsZSYmZHx8eyJkZWZhdWx0IjpkfSlbImRlZmF1bHQiXTtIYW5kc29udGFibGUuZWRpdG9ycz1IYW5kc29udGFibGUuZWRpdG9yc3x8e30sSGFuZHNvbnRhYmxlLmVkaXRvcnMuRGF0ZUVkaXRvcj1TO3ZhciBTPWZ1bmN0aW9uKGUpe3RoaXMuJGRhdGVQaWNrZXI9bnVsbCx0aGlzLmRhdGVQaWNrZXI9bnVsbCx0aGlzLmRhdGVQaWNrZXJTdHlsZT1udWxsLHRoaXMuZGVmYXVsdERhdGVGb3JtYXQ9IkREL01NL1lZWVkiLHRoaXMuaXNDZWxsRWRpdGVkPSExLHRoaXMucGFyZW50RGVzdHJveWVkPSExLCR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yKEUpLmNhbGwodGhpcyxlKX0sRT1TOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhTLHtpbml0OmZ1bmN0aW9uKCl7dmFyIGU9dGhpcztpZigiZnVuY3Rpb24iIT10eXBlb2YgUil0aHJvdyBuZXcgRXJyb3IoIllvdSBuZWVkIHRvIGluY2x1ZGUgbW9tZW50LmpzIHRvIHlvdXIgcHJvamVjdC4iKTtpZigiZnVuY3Rpb24iIT10eXBlb2YgXyl0aHJvdyBuZXcgRXJyb3IoIllvdSBuZWVkIHRvIGluY2x1ZGUgUGlrYWRheSB0byB5b3VyIHByb2plY3QuIik7JHRyYWNldXJSdW50aW1lLnN1cGVyR2V0KHRoaXMsRS5wcm90b3R5cGUsImluaXQiKS5jYWxsKHRoaXMpLHRoaXMuaW5zdGFuY2UuYWRkSG9vaygiYWZ0ZXJEZXN0cm95IixmdW5jdGlvbigpe2UucGFyZW50RGVzdHJveWVkPSEwLGUuZGVzdHJveUVsZW1lbnRzKCl9KX0sY3JlYXRlRWxlbWVudHM6ZnVuY3Rpb24oKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxFLnByb3RvdHlwZSwiY3JlYXRlRWxlbWVudHMiKS5jYWxsKHRoaXMpLHRoaXMuZGF0ZVBpY2tlcj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKSx0aGlzLmRhdGVQaWNrZXJTdHlsZT10aGlzLmRhdGVQaWNrZXIuc3R5bGUsdGhpcy5kYXRlUGlja2VyU3R5bGUucG9zaXRpb249ImFic29sdXRlIix0aGlzLmRhdGVQaWNrZXJTdHlsZS50b3A9MCx0aGlzLmRhdGVQaWNrZXJTdHlsZS5sZWZ0PTAsdGhpcy5kYXRlUGlja2VyU3R5bGUuekluZGV4PTk5OTksZih0aGlzLmRhdGVQaWNrZXIsImh0RGF0ZXBpY2tlckhvbGRlciIpLGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5kYXRlUGlja2VyKSx0aGlzLiRkYXRlUGlja2VyPW5ldyBfKHRoaXMuZ2V0RGF0ZVBpY2tlckNvbmZpZygpKTt2YXIgZT1uZXcgbSh0aGlzKTtlLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5kYXRlUGlja2VyLCJtb3VzZWRvd24iLGZ1bmN0aW9uKGUpe3JldHVybiBiKGUpfSksdGhpcy5oaWRlRGF0ZXBpY2tlcigpfSxkZXN0cm95RWxlbWVudHM6ZnVuY3Rpb24oKXt0aGlzLiRkYXRlUGlja2VyLmRlc3Ryb3koKX0scHJlcGFyZTpmdW5jdGlvbihlLHQsbixvLHIsaSl7dGhpcy5fb3BlbmVkPSExLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLEUucHJvdG90eXBlLCJwcmVwYXJlIikuY2FsbCh0aGlzLGUsdCxuLG8scixpKX0sb3BlbjpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06bnVsbDskdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxFLnByb3RvdHlwZSwib3BlbiIpLmNhbGwodGhpcyksdGhpcy5zaG93RGF0ZXBpY2tlcihlKX0sY2xvc2U6ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3RoaXMuX29wZW5lZD0hMSx0aGlzLmluc3RhbmNlLl9yZWdpc3RlclRpbWVvdXQoc2V0VGltZW91dChmdW5jdGlvbigpe2UuaW5zdGFuY2Uuc2VsZWN0aW9uLnJlZnJlc2hCb3JkZXJzKCl9LDApKSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxFLnByb3RvdHlwZSwiY2xvc2UiKS5jYWxsKHRoaXMpfSxmaW5pc2hFZGl0aW5nOmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTohMSx0PXZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06ITE7aWYoZSl7dmFyIG49dGhpcy5vcmlnaW5hbFZhbHVlO3ZvaWQgMCE9PW4mJnRoaXMuc2V0VmFsdWUobil9dGhpcy5oaWRlRGF0ZXBpY2tlcigpLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLEUucHJvdG90eXBlLCJmaW5pc2hFZGl0aW5nIikuY2FsbCh0aGlzLGUsdCl9LHNob3dEYXRlcGlja2VyOmZ1bmN0aW9uKGUpe3RoaXMuJGRhdGVQaWNrZXIuY29uZmlnKHRoaXMuZ2V0RGF0ZVBpY2tlckNvbmZpZygpKTt2YXIgdCxuPXRoaXMuVEQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksbz10aGlzLmNlbGxQcm9wZXJ0aWVzLmRhdGVGb3JtYXR8fHRoaXMuZGVmYXVsdERhdGVGb3JtYXQscj10aGlzLiRkYXRlUGlja2VyLmNvbmZpZygpLGk9dGhpcy5pbnN0YW5jZS52aWV3LmlzTW91c2VEb3duKCkscz1lP3koZS5rZXlDb2RlKTohMTt0aGlzLmRhdGVQaWNrZXJTdHlsZS50b3A9d2luZG93LnBhZ2VZT2Zmc2V0K24udG9wK3AodGhpcy5URCkrInB4Iix0aGlzLmRhdGVQaWNrZXJTdHlsZS5sZWZ0PXdpbmRvdy5wYWdlWE9mZnNldCtuLmxlZnQrInB4Iix0aGlzLiRkYXRlUGlja2VyLl9vbklucHV0Rm9jdXM9ZnVuY3Rpb24oKXt9LHIuZm9ybWF0PW8sdGhpcy5vcmlnaW5hbFZhbHVlPyh0PXRoaXMub3JpZ2luYWxWYWx1ZSxSKHQsbywhMCkuaXNWYWxpZCgpJiZ0aGlzLiRkYXRlUGlja2VyLnNldE1vbWVudChSKHQsbyksITApLHN8fGl8fHRoaXMuc2V0VmFsdWUoIiIpKTp0aGlzLmNlbGxQcm9wZXJ0aWVzLmRlZmF1bHREYXRlPyh0PXRoaXMuY2VsbFByb3BlcnRpZXMuZGVmYXVsdERhdGUsci5kZWZhdWx0RGF0ZT10LFIodCxvLCEwKS5pc1ZhbGlkKCkmJnRoaXMuJGRhdGVQaWNrZXIuc2V0TW9tZW50KFIodCxvKSwhMCksc3x8aXx8dGhpcy5zZXRWYWx1ZSgiIikpOnRoaXMuJGRhdGVQaWNrZXIuZ290b1RvZGF5KCksdGhpcy5kYXRlUGlja2VyU3R5bGUuZGlzcGxheT0iYmxvY2siLHRoaXMuJGRhdGVQaWNrZXIuc2hvdygpfSxoaWRlRGF0ZXBpY2tlcjpmdW5jdGlvbigpe3RoaXMuZGF0ZVBpY2tlclN0eWxlLmRpc3BsYXk9Im5vbmUiLHRoaXMuJGRhdGVQaWNrZXIuaGlkZSgpfSxnZXREYXRlUGlja2VyQ29uZmlnOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMuVEVYVEFSRUEsbj17fTt0aGlzLmNlbGxQcm9wZXJ0aWVzJiZ0aGlzLmNlbGxQcm9wZXJ0aWVzLmRhdGVQaWNrZXJDb25maWcmJmcobix0aGlzLmNlbGxQcm9wZXJ0aWVzLmRhdGVQaWNrZXJDb25maWcpO3ZhciBvPW4ub25TZWxlY3Qscj1uLm9uQ2xvc2U7cmV0dXJuIG4uZmllbGQ9dCxuLnRyaWdnZXI9dCxuLmNvbnRhaW5lcj10aGlzLmRhdGVQaWNrZXIsbi5ib3VuZD0hMSxuLmZvcm1hdD1uLmZvcm1hdHx8dGhpcy5kZWZhdWx0RGF0ZUZvcm1hdCxuLnJlcG9zaXRpb249bi5yZXBvc2l0aW9ufHwhMSxuLm9uU2VsZWN0PWZ1bmN0aW9uKHQpe2lzTmFOKHQuZ2V0VGltZSgpKXx8KHQ9Uih0KS5mb3JtYXQoZS5jZWxsUHJvcGVydGllcy5kYXRlRm9ybWF0fHxlLmRlZmF1bHREYXRlRm9ybWF0KSksZS5zZXRWYWx1ZSh0KSxlLmhpZGVEYXRlcGlja2VyKCksbyYmbygpfSxuLm9uQ2xvc2U9ZnVuY3Rpb24oKXtlLnBhcmVudERlc3Ryb3llZHx8ZS5maW5pc2hFZGl0aW5nKCExKSxyJiZyKCl9LG59fSx7fSxDKSx3KCJkYXRlIixTKX0se2VkaXRvcnM6MjksZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy9kb20vZXZlbnQiOjQ2LCJoZWxwZXJzL29iamVjdCI6NTAsImhlbHBlcnMvdW5pY29kZSI6NTMsbW9tZW50OiJtb21lbnQiLHBpa2FkYXk6InBpa2FkYXkiLHRleHRFZGl0b3I6NDB9XSwzNDpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtEcm9wZG93bkVkaXRvcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGx9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGk9KG89ZSgiZWRpdG9ycyIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSkscz0oaS5nZXRFZGl0b3IsaS5yZWdpc3RlckVkaXRvciksYT0ocj1lKCJhdXRvY29tcGxldGVFZGl0b3IiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLkF1dG9jb21wbGV0ZUVkaXRvcixsPWZ1bmN0aW9uKCl7JHRyYWNldXJSdW50aW1lLnN1cGVyQ29uc3RydWN0b3IodSkuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx1PWw7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGwse3ByZXBhcmU6ZnVuY3Rpb24oZSx0LG4sbyxyLGkpeyR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLHUucHJvdG90eXBlLCJwcmVwYXJlIikuY2FsbCh0aGlzLGUsdCxuLG8scixpKSx0aGlzLmNlbGxQcm9wZXJ0aWVzLmZpbHRlcj0hMSx0aGlzLmNlbGxQcm9wZXJ0aWVzLnN0cmljdD0hMH19LHt9LGEpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImJlZm9yZVZhbGlkYXRlIixmdW5jdGlvbihlLHQsbixvKXt2YXIgcj10aGlzLmdldENlbGxNZXRhKHQsbik7ci5lZGl0b3I9PT1IYW5kc29udGFibGUuZWRpdG9ycy5Ecm9wZG93bkVkaXRvciYmdm9pZCAwPT09ci5zdHJpY3QmJihyLmZpbHRlcj0hMSxyLnN0cmljdD0hMCl9KSxzKCJkcm9wZG93biIsbCl9LHthdXRvY29tcGxldGVFZGl0b3I6MzEsZWRpdG9yczoyOX1dLDM1OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0hhbmRzb250YWJsZUVkaXRvcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHd9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscyxhLGwsdT0obz1lKCJoZWxwZXJzL3VuaWNvZGUiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLktFWV9DT0RFUyxjPShyPWUoImhlbHBlcnMvb2JqZWN0IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5leHRlbmQsZD0oaT1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5zZXRDYXJldFBvc2l0aW9uLGg9KHM9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLGY9aC5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24scD1oLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkLGc9KGE9ZSgiZWRpdG9ycyIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSksbT0oZy5nZXRFZGl0b3IsZy5yZWdpc3RlckVkaXRvciksdj0obD1lKCJ0ZXh0RWRpdG9yIiksbCYmbC5fX2VzTW9kdWxlJiZsfHx7ImRlZmF1bHQiOmx9KS5UZXh0RWRpdG9yLHc9di5wcm90b3R5cGUuZXh0ZW5kKCk7dy5wcm90b3R5cGUuY3JlYXRlRWxlbWVudHM9ZnVuY3Rpb24oKXt2LnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cy5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7ZS5jbGFzc05hbWU9ImhhbmRzb250YWJsZUVkaXRvciIsdGhpcy5URVhUQVJFQV9QQVJFTlQuYXBwZW5kQ2hpbGQoZSksdGhpcy5odENvbnRhaW5lcj1lLHRoaXMuYXNzaWduSG9va3MoKX0sdy5wcm90b3R5cGUucHJlcGFyZT1mdW5jdGlvbihlLHQsbixvLHIsaSl7di5wcm90b3R5cGUucHJlcGFyZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dmFyIHM9dGhpcyxhPXtzdGFydFJvd3M6MCxzdGFydENvbHM6MCxtaW5Sb3dzOjAsbWluQ29sczowLGNsYXNzTmFtZToibGlzdGJveCIsY29weVBhc3RlOiExLGF1dG9Db2x1bW5TaXplOiExLGF1dG9Sb3dTaXplOiExLHJlYWRPbmx5OiEwLGZpbGxIYW5kbGU6ITEsYWZ0ZXJPbkNlbGxNb3VzZURvd246ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmdldFZhbHVlKCk7dm9pZCAwIT09ZSYmcy5zZXRWYWx1ZShlKSxzLmluc3RhbmNlLmRlc3Ryb3lFZGl0b3IoKX19O3RoaXMuY2VsbFByb3BlcnRpZXMuaGFuZHNvbnRhYmxlJiZjKGEsaS5oYW5kc29udGFibGUpLHRoaXMuaHRPcHRpb25zPWF9O3ZhciB5PWZ1bmN0aW9uKGUpe2lmKCFwKGUpKXt2YXIgdCxuPXRoaXMuZ2V0QWN0aXZlRWRpdG9yKCksbz1uLmh0RWRpdG9yLmdldEluc3RhbmNlKCk7aWYoZS5rZXlDb2RlPT11LkFSUk9XX0RPV04paWYoby5nZXRTZWxlY3RlZCgpKXt2YXIgcj1vLmdldFNlbGVjdGVkKClbMF0saT1vLmNvdW50Um93cygpLTE7dD1NYXRoLm1pbihpLHIrMSl9ZWxzZSB0PTA7ZWxzZSBpZihlLmtleUNvZGU9PXUuQVJST1dfVVAmJm8uZ2V0U2VsZWN0ZWQoKSl7dmFyIHI9by5nZXRTZWxlY3RlZCgpWzBdO3Q9ci0xfXZvaWQgMCE9PXQmJigwPnQ/by5kZXNlbGVjdENlbGwoKTpvLnNlbGVjdENlbGwodCwwKSxvLmdldERhdGEoKS5sZW5ndGgmJihlLnByZXZlbnREZWZhdWx0KCksZihlKSxuLmluc3RhbmNlLmxpc3RlbigpLG4uVEVYVEFSRUEuZm9jdXMoKSkpfX07dy5wcm90b3R5cGUub3Blbj1mdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UuYWRkSG9vaygiYmVmb3JlS2V5RG93biIseSksdi5wcm90b3R5cGUub3Blbi5hcHBseSh0aGlzLGFyZ3VtZW50cyksdGhpcy5odEVkaXRvciYmdGhpcy5odEVkaXRvci5kZXN0cm95KCksdGhpcy5odEVkaXRvcj1uZXcgSGFuZHNvbnRhYmxlKHRoaXMuaHRDb250YWluZXIsdGhpcy5odE9wdGlvbnMpLHRoaXMuY2VsbFByb3BlcnRpZXMuc3RyaWN0Pyh0aGlzLmh0RWRpdG9yLnNlbGVjdENlbGwoMCwwKSx0aGlzLlRFWFRBUkVBLnN0eWxlLnZpc2liaWxpdHk9ImhpZGRlbiIpOih0aGlzLmh0RWRpdG9yLmRlc2VsZWN0Q2VsbCgpLHRoaXMuVEVYVEFSRUEuc3R5bGUudmlzaWJpbGl0eT0idmlzaWJsZSIpLGQodGhpcy5URVhUQVJFQSwwLHRoaXMuVEVYVEFSRUEudmFsdWUubGVuZ3RoKX0sdy5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oKXt0aGlzLmluc3RhbmNlLnJlbW92ZUhvb2soImJlZm9yZUtleURvd24iLHkpLHRoaXMuaW5zdGFuY2UubGlzdGVuKCksdi5wcm90b3R5cGUuY2xvc2UuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx3LnByb3RvdHlwZS5mb2N1cz1mdW5jdGlvbigpe3RoaXMuaW5zdGFuY2UubGlzdGVuKCksdi5wcm90b3R5cGUuZm9jdXMuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx3LnByb3RvdHlwZS5iZWdpbkVkaXRpbmc9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5ncygpLm9uQmVnaW5FZGl0aW5nO3QmJnQoKT09PSExfHx2LnByb3RvdHlwZS5iZWdpbkVkaXRpbmcuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx3LnByb3RvdHlwZS5maW5pc2hFZGl0aW5nPWZ1bmN0aW9uKGUsdCl7aWYodGhpcy5odEVkaXRvciYmdGhpcy5odEVkaXRvci5pc0xpc3RlbmluZygpJiZ0aGlzLmluc3RhbmNlLmxpc3RlbigpLHRoaXMuaHRFZGl0b3ImJnRoaXMuaHRFZGl0b3IuZ2V0U2VsZWN0ZWQoKSl7dmFyIG49dGhpcy5odEVkaXRvci5nZXRJbnN0YW5jZSgpLmdldFZhbHVlKCk7dm9pZCAwIT09biYmdGhpcy5zZXRWYWx1ZShuKX1yZXR1cm4gdi5wcm90b3R5cGUuZmluaXNoRWRpdGluZy5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LHcucHJvdG90eXBlLmFzc2lnbkhvb2tzPWZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmluc3RhbmNlLmFkZEhvb2soImFmdGVyRGVzdHJveSIsZnVuY3Rpb24oKXtlLmh0RWRpdG9yJiZlLmh0RWRpdG9yLmRlc3Ryb3koKX0pfSxtKCJoYW5kc29udGFibGUiLHcpfSx7ZWRpdG9yczoyOSwiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvZG9tL2V2ZW50Ijo0NiwiaGVscGVycy9vYmplY3QiOjUwLCJoZWxwZXJzL3VuaWNvZGUiOjUzLHRleHRFZGl0b3I6NDB9XSwzNjpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtNb2JpbGVUZXh0RWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gTX19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbCx1PShvPWUoImhlbHBlcnMvdW5pY29kZSIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSkuS0VZX0NPREVTLGM9KHI9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLGQ9Yy5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24saD1jLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkLGY9KGk9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkscD1mLmFkZENsYXNzLGc9Zi5nZXRTY3JvbGxMZWZ0LG09Zi5nZXRTY3JvbGxUb3Asdj1mLmhhc0NsYXNzLHc9Zi5pc0NoaWxkT2YseT1mLm9mZnNldCxiPWYub3V0ZXJIZWlnaHQsQz1mLm91dGVyV2lkdGgsUj1mLnJlbW92ZUNsYXNzLF89Zi5zZXRDYXJldFBvc2l0aW9uLFM9KHM9ZSgiZWRpdG9ycyIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSksRT0oUy5nZXRFZGl0b3IsUy5yZWdpc3RlckVkaXRvciksVD0oYT1lKCJfYmFzZUVkaXRvciIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSkuQmFzZUVkaXRvcixPPShsPWUoImV2ZW50TWFuYWdlciIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSkuZXZlbnRNYW5hZ2VyLE09VC5wcm90b3R5cGUuZXh0ZW5kKCksaz17fSxIPWZ1bmN0aW9uKCl7dGhpcy5jb250cm9scz17fSx0aGlzLmNvbnRyb2xzLmxlZnRCdXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdGhpcy5jb250cm9scy5sZWZ0QnV0dG9uLmNsYXNzTmFtZT0ibGVmdEJ1dHRvbiIsCnRoaXMuY29udHJvbHMucmlnaHRCdXR0b249ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdGhpcy5jb250cm9scy5yaWdodEJ1dHRvbi5jbGFzc05hbWU9InJpZ2h0QnV0dG9uIix0aGlzLmNvbnRyb2xzLnVwQnV0dG9uPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHRoaXMuY29udHJvbHMudXBCdXR0b24uY2xhc3NOYW1lPSJ1cEJ1dHRvbiIsdGhpcy5jb250cm9scy5kb3duQnV0dG9uPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHRoaXMuY29udHJvbHMuZG93bkJ1dHRvbi5jbGFzc05hbWU9ImRvd25CdXR0b24iO2Zvcih2YXIgZSBpbiB0aGlzLmNvbnRyb2xzKXRoaXMuY29udHJvbHMuaGFzT3duUHJvcGVydHkoZSkmJnRoaXMucG9zaXRpb25Db250cm9scy5hcHBlbmRDaGlsZCh0aGlzLmNvbnRyb2xzW2VdKX07TS5wcm90b3R5cGUudmFsdWVDaGFuZ2VkPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdFZhbHVlIT10aGlzLmdldFZhbHVlKCl9LE0ucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3RoaXMuZXZlbnRNYW5hZ2VyPU8odGhpcy5pbnN0YW5jZSksdGhpcy5jcmVhdGVFbGVtZW50cygpLHRoaXMuYmluZEV2ZW50cygpLHRoaXMuaW5zdGFuY2UuYWRkSG9vaygiYWZ0ZXJEZXN0cm95IixmdW5jdGlvbigpe2UuZGVzdHJveSgpfSl9LE0ucHJvdG90eXBlLmdldFZhbHVlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuVEVYVEFSRUEudmFsdWV9LE0ucHJvdG90eXBlLnNldFZhbHVlPWZ1bmN0aW9uKGUpe3RoaXMuaW5pdFZhbHVlPWUsdGhpcy5URVhUQVJFQS52YWx1ZT1lfSxNLnByb3RvdHlwZS5jcmVhdGVFbGVtZW50cz1mdW5jdGlvbigpe3RoaXMuZWRpdG9yQ29udGFpbmVyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHRoaXMuZWRpdG9yQ29udGFpbmVyLmNsYXNzTmFtZT0iaHRNb2JpbGVFZGl0b3JDb250YWluZXIiLHRoaXMuY2VsbFBvaW50ZXI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdGhpcy5jZWxsUG9pbnRlci5jbGFzc05hbWU9ImNlbGxQb2ludGVyIix0aGlzLm1vdmVIYW5kbGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdGhpcy5tb3ZlSGFuZGxlLmNsYXNzTmFtZT0ibW92ZUhhbmRsZSIsdGhpcy5pbnB1dFBhbmU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdGhpcy5pbnB1dFBhbmUuY2xhc3NOYW1lPSJpbnB1dHMiLHRoaXMucG9zaXRpb25Db250cm9scz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKSx0aGlzLnBvc2l0aW9uQ29udHJvbHMuY2xhc3NOYW1lPSJwb3NpdGlvbkNvbnRyb2xzIix0aGlzLlRFWFRBUkVBPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIlRFWFRBUkVBIikscCh0aGlzLlRFWFRBUkVBLCJoYW5kc29udGFibGVJbnB1dCIpLHRoaXMuaW5wdXRQYW5lLmFwcGVuZENoaWxkKHRoaXMuVEVYVEFSRUEpLHRoaXMuZWRpdG9yQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuY2VsbFBvaW50ZXIpLHRoaXMuZWRpdG9yQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMubW92ZUhhbmRsZSksdGhpcy5lZGl0b3JDb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5pbnB1dFBhbmUpLHRoaXMuZWRpdG9yQ29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMucG9zaXRpb25Db250cm9scyksSC5jYWxsKHRoaXMpLGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5lZGl0b3JDb250YWluZXIpfSxNLnByb3RvdHlwZS5vbkJlZm9yZUtleURvd249ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxuPXQuZ2V0QWN0aXZlRWRpdG9yKCk7aWYoZS50YXJnZXQ9PT1uLlRFWFRBUkVBJiYhaChlKSlzd2l0Y2goZS5rZXlDb2RlKXtjYXNlIHUuRU5URVI6bi5jbG9zZSgpLGUucHJldmVudERlZmF1bHQoKTticmVhaztjYXNlIHUuQkFDS1NQQUNFOmQoZSl9fSxNLnByb3RvdHlwZS5vcGVuPWZ1bmN0aW9uKCl7dGhpcy5pbnN0YW5jZS5hZGRIb29rKCJiZWZvcmVLZXlEb3duIix0aGlzLm9uQmVmb3JlS2V5RG93bikscCh0aGlzLmVkaXRvckNvbnRhaW5lciwiYWN0aXZlIiksUih0aGlzLmNlbGxQb2ludGVyLCJoaWRkZW4iKSx0aGlzLnVwZGF0ZUVkaXRvclBvc2l0aW9uKCl9LE0ucHJvdG90eXBlLmZvY3VzPWZ1bmN0aW9uKCl7dGhpcy5URVhUQVJFQS5mb2N1cygpLF8odGhpcy5URVhUQVJFQSx0aGlzLlRFWFRBUkVBLnZhbHVlLmxlbmd0aCl9LE0ucHJvdG90eXBlLmNsb3NlPWZ1bmN0aW9uKCl7dGhpcy5URVhUQVJFQS5ibHVyKCksdGhpcy5pbnN0YW5jZS5yZW1vdmVIb29rKCJiZWZvcmVLZXlEb3duIix0aGlzLm9uQmVmb3JlS2V5RG93biksUih0aGlzLmVkaXRvckNvbnRhaW5lciwiYWN0aXZlIil9LE0ucHJvdG90eXBlLnNjcm9sbFRvVmlldz1mdW5jdGlvbigpe3ZhciBlPXRoaXMuaW5zdGFuY2UuZ2V0U2VsZWN0ZWRSYW5nZSgpLmhpZ2hsaWdodDt0aGlzLmluc3RhbmNlLnZpZXcuc2Nyb2xsVmlld3BvcnQoZSl9LE0ucHJvdG90eXBlLmhpZGVDZWxsUG9pbnRlcj1mdW5jdGlvbigpe3YodGhpcy5jZWxsUG9pbnRlciwiaGlkZGVuIil8fHAodGhpcy5jZWxsUG9pbnRlciwiaGlkZGVuIil9LE0ucHJvdG90eXBlLnVwZGF0ZUVkaXRvclBvc2l0aW9uPWZ1bmN0aW9uKGUsdCl7aWYoZSYmdCllPXBhcnNlSW50KGUsMTApLHQ9cGFyc2VJbnQodCwxMCksdGhpcy5lZGl0b3JDb250YWluZXIuc3R5bGUudG9wPXQrInB4Iix0aGlzLmVkaXRvckNvbnRhaW5lci5zdHlsZS5sZWZ0PWUrInB4IjtlbHNle3ZhciBuPXRoaXMuaW5zdGFuY2UuZ2V0U2VsZWN0ZWQoKSxvPXRoaXMuaW5zdGFuY2UuZ2V0Q2VsbChuWzBdLG5bMV0pO2lmKGsuY2VsbFBvaW50ZXJ8fChrLmNlbGxQb2ludGVyPXtoZWlnaHQ6Yih0aGlzLmNlbGxQb2ludGVyKSx3aWR0aDpDKHRoaXMuY2VsbFBvaW50ZXIpfSksay5lZGl0b3JDb250YWluZXJ8fChrLmVkaXRvckNvbnRhaW5lcj17d2lkdGg6Qyh0aGlzLmVkaXRvckNvbnRhaW5lcil9KSx2b2lkIDAhPT1vKXt2YXIgcj10aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS50cmltbWluZ0NvbnRhaW5lcj09d2luZG93PzA6Zyh0aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5ob2xkZXIpLGk9dGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMudG9wT3ZlcmxheS50cmltbWluZ0NvbnRhaW5lcj09d2luZG93PzA6bSh0aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy50b3BPdmVybGF5LmhvbGRlcikscz15KG8pLGE9QyhvKSxsPXt4OnIseTppfTt0aGlzLmVkaXRvckNvbnRhaW5lci5zdHlsZS50b3A9cGFyc2VJbnQocy50b3ArYihvKS1sLnkray5jZWxsUG9pbnRlci5oZWlnaHQsMTApKyJweCIsdGhpcy5lZGl0b3JDb250YWluZXIuc3R5bGUubGVmdD1wYXJzZUludCh3aW5kb3cuaW5uZXJXaWR0aC8yLWsuZWRpdG9yQ29udGFpbmVyLndpZHRoLzIsMTApKyJweCIscy5sZWZ0K2EvMj5wYXJzZUludCh0aGlzLmVkaXRvckNvbnRhaW5lci5zdHlsZS5sZWZ0LDEwKStrLmVkaXRvckNvbnRhaW5lci53aWR0aD90aGlzLmVkaXRvckNvbnRhaW5lci5zdHlsZS5sZWZ0PXdpbmRvdy5pbm5lcldpZHRoLWsuZWRpdG9yQ29udGFpbmVyLndpZHRoKyJweCI6cy5sZWZ0K2EvMjxwYXJzZUludCh0aGlzLmVkaXRvckNvbnRhaW5lci5zdHlsZS5sZWZ0LDEwKSsyMCYmKHRoaXMuZWRpdG9yQ29udGFpbmVyLnN0eWxlLmxlZnQ9IjBweCIpLHRoaXMuY2VsbFBvaW50ZXIuc3R5bGUubGVmdD1wYXJzZUludChzLmxlZnQtay5jZWxsUG9pbnRlci53aWR0aC8yLXkodGhpcy5lZGl0b3JDb250YWluZXIpLmxlZnQrYS8yLWwueCwxMCkrInB4In19fSxNLnByb3RvdHlwZS51cGRhdGVFZGl0b3JEYXRhPWZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5pbnN0YW5jZS5nZXRTZWxlY3RlZCgpLHQ9dGhpcy5pbnN0YW5jZS5nZXREYXRhQXRDZWxsKGVbMF0sZVsxXSk7dGhpcy5yb3c9ZVswXSx0aGlzLmNvbD1lWzFdLHRoaXMuc2V0VmFsdWUodCksdGhpcy51cGRhdGVFZGl0b3JQb3NpdGlvbigpfSxNLnByb3RvdHlwZS5wcmVwYXJlQW5kU2F2ZT1mdW5jdGlvbigpe3ZhciBlO3JldHVybiB0aGlzLnZhbHVlQ2hhbmdlZCgpPyhlPXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZ3MoKS50cmltV2hpdGVzcGFjZT9bW1N0cmluZy5wcm90b3R5cGUudHJpbS5jYWxsKHRoaXMuZ2V0VmFsdWUoKSldXTpbW3RoaXMuZ2V0VmFsdWUoKV1dLHZvaWQgdGhpcy5zYXZlVmFsdWUoZSkpOiEwfSxNLnByb3RvdHlwZS5iaW5kRXZlbnRzPWZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuY29udHJvbHMubGVmdEJ1dHRvbiwidG91Y2hlbmQiLGZ1bmN0aW9uKHQpe2UucHJlcGFyZUFuZFNhdmUoKSxlLmluc3RhbmNlLnNlbGVjdGlvbi50cmFuc2Zvcm1TdGFydCgwLC0xLG51bGwsITApLGUudXBkYXRlRWRpdG9yRGF0YSgpLHQucHJldmVudERlZmF1bHQoKX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5jb250cm9scy5yaWdodEJ1dHRvbiwidG91Y2hlbmQiLGZ1bmN0aW9uKHQpe2UucHJlcGFyZUFuZFNhdmUoKSxlLmluc3RhbmNlLnNlbGVjdGlvbi50cmFuc2Zvcm1TdGFydCgwLDEsbnVsbCwhMCksZS51cGRhdGVFZGl0b3JEYXRhKCksdC5wcmV2ZW50RGVmYXVsdCgpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmNvbnRyb2xzLnVwQnV0dG9uLCJ0b3VjaGVuZCIsZnVuY3Rpb24odCl7ZS5wcmVwYXJlQW5kU2F2ZSgpLGUuaW5zdGFuY2Uuc2VsZWN0aW9uLnRyYW5zZm9ybVN0YXJ0KC0xLDAsbnVsbCwhMCksZS51cGRhdGVFZGl0b3JEYXRhKCksdC5wcmV2ZW50RGVmYXVsdCgpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmNvbnRyb2xzLmRvd25CdXR0b24sInRvdWNoZW5kIixmdW5jdGlvbih0KXtlLnByZXBhcmVBbmRTYXZlKCksZS5pbnN0YW5jZS5zZWxlY3Rpb24udHJhbnNmb3JtU3RhcnQoMSwwLG51bGwsITApLGUudXBkYXRlRWRpdG9yRGF0YSgpLHQucHJldmVudERlZmF1bHQoKX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5tb3ZlSGFuZGxlLCJ0b3VjaHN0YXJ0IixmdW5jdGlvbih0KXtpZigxPT10LnRvdWNoZXMubGVuZ3RoKXt2YXIgbj10LnRvdWNoZXNbMF0sbz17eDplLmVkaXRvckNvbnRhaW5lci5vZmZzZXRMZWZ0LHk6ZS5lZGl0b3JDb250YWluZXIub2Zmc2V0VG9wfSxyPXt4Om4ucGFnZVgtby54LHk6bi5wYWdlWS1vLnl9O2UuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcywidG91Y2htb3ZlIixmdW5jdGlvbih0KXt2YXIgbj10LnRvdWNoZXNbMF07ZS51cGRhdGVFZGl0b3JQb3NpdGlvbihuLnBhZ2VYLXIueCxuLnBhZ2VZLXIueSksZS5oaWRlQ2VsbFBvaW50ZXIoKSx0LnByZXZlbnREZWZhdWx0KCl9KX19KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LmJvZHksInRvdWNoZW5kIixmdW5jdGlvbih0KXt3KHQudGFyZ2V0LGUuZWRpdG9yQ29udGFpbmVyKXx8dyh0LnRhcmdldCxlLmluc3RhbmNlLnJvb3RFbGVtZW50KXx8ZS5jbG9zZSgpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5ob2xkZXIsInNjcm9sbCIsZnVuY3Rpb24odCl7ZS5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMubGVmdE92ZXJsYXkudHJpbW1pbmdDb250YWluZXIhPXdpbmRvdyYmZS5oaWRlQ2VsbFBvaW50ZXIoKX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMudG9wT3ZlcmxheS5ob2xkZXIsInNjcm9sbCIsZnVuY3Rpb24odCl7ZS5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMudG9wT3ZlcmxheS50cmltbWluZ0NvbnRhaW5lciE9d2luZG93JiZlLmhpZGVDZWxsUG9pbnRlcigpfSl9LE0ucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLmV2ZW50TWFuYWdlci5jbGVhcigpLHRoaXMuZWRpdG9yQ29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lZGl0b3JDb250YWluZXIpfSxFKCJtb2JpbGUiLE0pfSx7X2Jhc2VFZGl0b3I6MzAsZWRpdG9yczoyOSxldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDYsImhlbHBlcnMvdW5pY29kZSI6NTN9XSwzNzpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtOdW1lcmljRWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gY319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzPShvPWUoIm51bWVyYWwiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pWyJkZWZhdWx0Il0sYT0ocj1lKCJlZGl0b3JzIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KSxsPShhLmdldEVkaXRvcixhLnJlZ2lzdGVyRWRpdG9yKSx1PShpPWUoInRleHRFZGl0b3IiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLlRleHRFZGl0b3IsYz1mdW5jdGlvbigpeyR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yKGQpLmFwcGx5KHRoaXMsYXJndW1lbnRzKX0sZD1jOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhjLHtiZWdpbkVkaXRpbmc6ZnVuY3Rpb24oZSl7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBlJiZ0aGlzLm9yaWdpbmFsVmFsdWUpeyJ1bmRlZmluZWQiIT10eXBlb2YgdGhpcy5jZWxsUHJvcGVydGllcy5sYW5ndWFnZSYmcy5sYW5ndWFnZSh0aGlzLmNlbGxQcm9wZXJ0aWVzLmxhbmd1YWdlKTt2YXIgdD1zLmxhbmd1YWdlRGF0YSgpLmRlbGltaXRlcnMuZGVjaW1hbDtlPSgiIit0aGlzLm9yaWdpbmFsVmFsdWUpLnJlcGxhY2UoIi4iLHQpfSR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLGQucHJvdG90eXBlLCJiZWdpbkVkaXRpbmciKS5jYWxsKHRoaXMsZSl9fSx7fSx1KSxsKCJudW1lcmljIixjKX0se2VkaXRvcnM6MjksbnVtZXJhbDoibnVtZXJhbCIsdGV4dEVkaXRvcjo0MH1dLDM4OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1Bhc3N3b3JkRWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gY319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzPShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLmVtcHR5LGE9KHI9ZSgiZWRpdG9ycyIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksbD0oYS5nZXRFZGl0b3IsYS5yZWdpc3RlckVkaXRvciksdT0oaT1lKCJ0ZXh0RWRpdG9yIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5UZXh0RWRpdG9yLGM9ZnVuY3Rpb24oKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJDb25zdHJ1Y3RvcihkKS5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LGQ9YzskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoYyx7Y3JlYXRlRWxlbWVudHM6ZnVuY3Rpb24oKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxkLnByb3RvdHlwZSwiY3JlYXRlRWxlbWVudHMiKS5jYWxsKHRoaXMpLHRoaXMuVEVYVEFSRUE9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKSx0aGlzLlRFWFRBUkVBLnNldEF0dHJpYnV0ZSgidHlwZSIsInBhc3N3b3JkIiksdGhpcy5URVhUQVJFQS5jbGFzc05hbWU9ImhhbmRzb250YWJsZUlucHV0Iix0aGlzLnRleHRhcmVhU3R5bGU9dGhpcy5URVhUQVJFQS5zdHlsZSx0aGlzLnRleHRhcmVhU3R5bGUud2lkdGg9MCx0aGlzLnRleHRhcmVhU3R5bGUuaGVpZ2h0PTAscyh0aGlzLlRFWFRBUkVBX1BBUkVOVCksdGhpcy5URVhUQVJFQV9QQVJFTlQuYXBwZW5kQ2hpbGQodGhpcy5URVhUQVJFQSl9fSx7fSx1KSxsKCJwYXNzd29yZCIsYyl9LHtlZGl0b3JzOjI5LCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSx0ZXh0RWRpdG9yOjQwfV0sMzk6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7U2VsZWN0RWRpdG9yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gU319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbD0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSx1PWwuYWRkQ2xhc3MsYz1sLmVtcHR5LGQ9bC5mYXN0SW5uZXJIVE1MLGg9bC5nZXRDb21wdXRlZFN0eWxlLGY9bC5nZXRDc3NUcmFuc2Zvcm0scD1sLmdldFNjcm9sbGFibGVFbGVtZW50LGc9bC5vZmZzZXQsbT1sLm91dGVySGVpZ2h0LHY9bC5vdXRlcldpZHRoLHc9bC5yZXNldENzc1RyYW5zZm9ybSx5PShyPWUoImhlbHBlcnMvZG9tL2V2ZW50IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24sYj0oaT1lKCJoZWxwZXJzL3VuaWNvZGUiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLktFWV9DT0RFUyxDPShzPWUoImVkaXRvcnMiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLFI9KEMuZ2V0RWRpdG9yLEMucmVnaXN0ZXJFZGl0b3IpLF89KGE9ZSgiX2Jhc2VFZGl0b3IiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLkJhc2VFZGl0b3IsUz1fLnByb3RvdHlwZS5leHRlbmQoKTtTLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKCl7dGhpcy5zZWxlY3Q9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiU0VMRUNUIiksdSh0aGlzLnNlbGVjdCwiaHRTZWxlY3RFZGl0b3IiKSx0aGlzLnNlbGVjdC5zdHlsZS5kaXNwbGF5PSJub25lIix0aGlzLmluc3RhbmNlLnJvb3RFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuc2VsZWN0KSx0aGlzLnJlZ2lzdGVySG9va3MoKX0sUy5wcm90b3R5cGUucmVnaXN0ZXJIb29rcz1mdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5pbnN0YW5jZS5hZGRIb29rKCJhZnRlclNjcm9sbFZlcnRpY2FsbHkiLGZ1bmN0aW9uKCl7cmV0dXJuIGUucmVmcmVzaERpbWVuc2lvbnMoKX0pLHRoaXMuaW5zdGFuY2UuYWRkSG9vaygiYWZ0ZXJDb2x1bW5SZXNpemUiLGZ1bmN0aW9uKCl7cmV0dXJuIGUucmVmcmVzaERpbWVuc2lvbnMoKX0pLHRoaXMuaW5zdGFuY2UuYWRkSG9vaygiYWZ0ZXJSb3dSZXNpemUiLGZ1bmN0aW9uKCl7cmV0dXJuIGUucmVmcmVzaERpbWVuc2lvbnMoKX0pfSxTLnByb3RvdHlwZS5wcmVwYXJlPWZ1bmN0aW9uKCl7Xy5wcm90b3R5cGUucHJlcGFyZS5hcHBseSh0aGlzLGFyZ3VtZW50cyk7dmFyIGUsdD10aGlzLmNlbGxQcm9wZXJ0aWVzLnNlbGVjdE9wdGlvbnM7ZT0iZnVuY3Rpb24iPT10eXBlb2YgdD90aGlzLnByZXBhcmVPcHRpb25zKHQodGhpcy5yb3csdGhpcy5jb2wsdGhpcy5wcm9wKSk6dGhpcy5wcmVwYXJlT3B0aW9ucyh0KSxjKHRoaXMuc2VsZWN0KTtmb3IodmFyIG4gaW4gZSlpZihlLmhhc093blByb3BlcnR5KG4pKXt2YXIgbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJPUFRJT04iKTtvLnZhbHVlPW4sZChvLGVbbl0pLHRoaXMuc2VsZWN0LmFwcGVuZENoaWxkKG8pfX0sUy5wcm90b3R5cGUucHJlcGFyZU9wdGlvbnM9ZnVuY3Rpb24oZSl7dmFyIHQ9e307aWYoQXJyYXkuaXNBcnJheShlKSlmb3IodmFyIG49MCxvPWUubGVuZ3RoO28+bjtuKyspdFtlW25dXT1lW25dO2Vsc2Uib2JqZWN0Ij09dHlwZW9mIGUmJih0PWUpO3JldHVybiB0fSxTLnByb3RvdHlwZS5nZXRWYWx1ZT1mdW5jdGlvbigpe3JldHVybiB0aGlzLnNlbGVjdC52YWx1ZX0sUy5wcm90b3R5cGUuc2V0VmFsdWU9ZnVuY3Rpb24oZSl7dGhpcy5zZWxlY3QudmFsdWU9ZX07dmFyIEU9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxuPXQuZ2V0QWN0aXZlRWRpdG9yKCk7c3dpdGNoKGUua2V5Q29kZSl7Y2FzZSBiLkFSUk9XX1VQOnZhciBvPW4uc2VsZWN0LnNlbGVjdGVkSW5kZXgtMTtvPj0wJiYobi5zZWxlY3Rbb10uc2VsZWN0ZWQ9ITApLHkoZSksZS5wcmV2ZW50RGVmYXVsdCgpO2JyZWFrO2Nhc2UgYi5BUlJPV19ET1dOOnZhciByPW4uc2VsZWN0LnNlbGVjdGVkSW5kZXgrMTtyPD1uLnNlbGVjdC5sZW5ndGgtMSYmKG4uc2VsZWN0W3JdLnNlbGVjdGVkPSEwKSx5KGUpLGUucHJldmVudERlZmF1bHQoKX19O1MucHJvdG90eXBlLm9wZW49ZnVuY3Rpb24oKXt0aGlzLl9vcGVuZWQ9ITAsdGhpcy5yZWZyZXNoRGltZW5zaW9ucygpLHRoaXMuc2VsZWN0LnN0eWxlLmRpc3BsYXk9IiIsdGhpcy5pbnN0YW5jZS5hZGRIb29rKCJiZWZvcmVLZXlEb3duIixFKX0sUy5wcm90b3R5cGUuY2xvc2U9ZnVuY3Rpb24oKXt0aGlzLl9vcGVuZWQ9ITEsdGhpcy5zZWxlY3Quc3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5pbnN0YW5jZS5yZW1vdmVIb29rKCJiZWZvcmVLZXlEb3duIixFKX0sUy5wcm90b3R5cGUuZm9jdXM9ZnVuY3Rpb24oKXt0aGlzLnNlbGVjdC5mb2N1cygpfSxTLnByb3RvdHlwZS5yZWZyZXNoRGltZW5zaW9ucz1mdW5jdGlvbigpe2lmKHRoaXMuc3RhdGU9PT1IYW5kc29udGFibGUuRWRpdG9yU3RhdGUuRURJVElORyl7aWYodGhpcy5URD10aGlzLmdldEVkaXRlZENlbGwoKSwhdGhpcy5URClyZXR1cm4gdm9pZCB0aGlzLmNsb3NlKCk7dmFyIGUsdD12KHRoaXMuVEQpKzEsbj1tKHRoaXMuVEQpKzEsbz1nKHRoaXMuVEQpLHI9Zyh0aGlzLmluc3RhbmNlLnJvb3RFbGVtZW50KSxpPXAodGhpcy5URCkscz1vLnRvcC1yLnRvcC0xLShpLnNjcm9sbFRvcHx8MCksYT1vLmxlZnQtci5sZWZ0LTEtKGkuc2Nyb2xsTGVmdHx8MCksbD10aGlzLmNoZWNrRWRpdG9yU2VjdGlvbigpLHU9dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5ncygpO3Uucm93SGVhZGVycz8xOjAsdS5jb2xIZWFkZXJzPzE6MDtzd2l0Y2gobCl7Y2FzZSJ0b3AiOmU9Zih0aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy50b3BPdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUpO2JyZWFrO2Nhc2UibGVmdCI6ZT1mKHRoaXMuaW5zdGFuY2Uudmlldy53dC53dE92ZXJsYXlzLmxlZnRPdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUpO2JyZWFrO2Nhc2UidG9wLWxlZnQtY29ybmVyIjplPWYodGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMudG9wTGVmdENvcm5lck92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIucGFyZW50Tm9kZSk7YnJlYWs7Y2FzZSJib3R0b20tbGVmdC1jb3JuZXIiOmU9Zih0aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKTticmVhaztjYXNlImJvdHRvbSI6ZT1mKHRoaXMuaW5zdGFuY2Uudmlldy53dC53dE92ZXJsYXlzLmJvdHRvbU92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIucGFyZW50Tm9kZSl9MD09PXRoaXMuaW5zdGFuY2UuZ2V0U2VsZWN0ZWQoKVswXSYmKHMrPTEpLDA9PT10aGlzLmluc3RhbmNlLmdldFNlbGVjdGVkKClbMV0mJihhKz0xKTt2YXIgYz10aGlzLnNlbGVjdC5zdHlsZTtlJiYtMSE9ZT9jW2VbMF1dPWVbMV06dyh0aGlzLnNlbGVjdCk7dmFyIGQ9aCh0aGlzLlREKTtwYXJzZUludChkLmJvcmRlclRvcFdpZHRoLDEwKT4wJiYobi09MSkscGFyc2VJbnQoZC5ib3JkZXJMZWZ0V2lkdGgsMTApPjAmJih0LT0xKSxjLmhlaWdodD1uKyJweCIsYy5taW5XaWR0aD10KyJweCIsYy50b3A9cysicHgiLGMubGVmdD1hKyJweCIsYy5tYXJnaW49IjBweCJ9fSxTLnByb3RvdHlwZS5nZXRFZGl0ZWRDZWxsPWZ1bmN0aW9uKCl7dmFyIGUsdD10aGlzLmNoZWNrRWRpdG9yU2VjdGlvbigpO3N3aXRjaCh0KXtjYXNlInRvcCI6ZT10aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy50b3BPdmVybGF5LmNsb25lLnd0VGFibGUuZ2V0Q2VsbCh7cm93OnRoaXMucm93LGNvbDp0aGlzLmNvbH0pLHRoaXMuc2VsZWN0LnN0eWxlLnpJbmRleD0xMDE7YnJlYWs7Y2FzZSJjb3JuZXIiOmU9dGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMudG9wTGVmdENvcm5lck92ZXJsYXkuY2xvbmUud3RUYWJsZS5nZXRDZWxsKHtyb3c6dGhpcy5yb3csY29sOnRoaXMuY29sfSksdGhpcy5zZWxlY3Quc3R5bGUuekluZGV4PTEwMzticmVhaztjYXNlImxlZnQiOmU9dGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMubGVmdE92ZXJsYXkuY2xvbmUud3RUYWJsZS5nZXRDZWxsKHtyb3c6dGhpcy5yb3csY29sOnRoaXMuY29sfSksdGhpcy5zZWxlY3Quc3R5bGUuekluZGV4PTEwMjticmVhaztkZWZhdWx0OmU9dGhpcy5pbnN0YW5jZS5nZXRDZWxsKHRoaXMucm93LHRoaXMuY29sKSx0aGlzLnNlbGVjdC5zdHlsZS56SW5kZXg9IiJ9cmV0dXJuLTEhPWUmJi0yIT1lP2U6dm9pZCAwfSxSKCJzZWxlY3QiLFMpfSx7X2Jhc2VFZGl0b3I6MzAsZWRpdG9yczoyOSwiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvZG9tL2V2ZW50Ijo0NiwiaGVscGVycy91bmljb2RlIjo1M31dLDQwOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1RleHRFZGl0b3I6e2dldDpmdW5jdGlvbigpe3JldHVybiBIfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpLHMsYSxsLHUsYz0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxkPWMuYWRkQ2xhc3MsaD1jLmdldENhcmV0UG9zaXRpb24sZj1jLmdldENvbXB1dGVkU3R5bGUscD1jLmdldENzc1RyYW5zZm9ybSxnPWMuZ2V0U2Nyb2xsYWJsZUVsZW1lbnQsbT1jLmlubmVyV2lkdGgsdj1jLm9mZnNldCx3PWMucmVzZXRDc3NUcmFuc2Zvcm0seT1jLnNldENhcmV0UG9zaXRpb24sYj0ocj1lKCJhdXRvUmVzaXplIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KVsiZGVmYXVsdCJdLEM9KGk9ZSgiX2Jhc2VFZGl0b3IiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLkJhc2VFZGl0b3IsUj0ocz1lKCJldmVudE1hbmFnZXIiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLmV2ZW50TWFuYWdlcixfPShhPWUoImVkaXRvcnMiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLFM9KF8uZ2V0RWRpdG9yLF8ucmVnaXN0ZXJFZGl0b3IpLEU9KGw9ZSgiaGVscGVycy91bmljb2RlIiksbCYmbC5fX2VzTW9kdWxlJiZsfHx7ImRlZmF1bHQiOmx9KS5LRVlfQ09ERVMsVD0odT1lKCJoZWxwZXJzL2RvbS9ldmVudCIpLHUmJnUuX19lc01vZHVsZSYmdXx8eyJkZWZhdWx0Ijp1fSksTz1ULnN0b3BQcm9wYWdhdGlvbixNPVQuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uLGs9VC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCxIPUMucHJvdG90eXBlLmV4dGVuZCgpO0gucHJvdG90eXBlLmluaXQ9ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3RoaXMuY3JlYXRlRWxlbWVudHMoKSx0aGlzLmV2ZW50TWFuYWdlcj1SKHRoaXMpLHRoaXMuYmluZEV2ZW50cygpLHRoaXMuYXV0b1Jlc2l6ZT1iKCksdGhpcy5pbnN0YW5jZS5hZGRIb29rKCJhZnRlckRlc3Ryb3kiLGZ1bmN0aW9uKCl7ZS5kZXN0cm95KCl9KX0sSC5wcm90b3R5cGUuZ2V0VmFsdWU9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5URVhUQVJFQS52YWx1ZX0sSC5wcm90b3R5cGUuc2V0VmFsdWU9ZnVuY3Rpb24oZSl7dGhpcy5URVhUQVJFQS52YWx1ZT1lfTt2YXIgRD1mdW5jdGlvbihlKXt2YXIgdCxuPXRoaXMsbz1uLmdldEFjdGl2ZUVkaXRvcigpO2lmKHQ9KGUuY3RybEtleXx8ZS5tZXRhS2V5KSYmIWUuYWx0S2V5LGUudGFyZ2V0PT09by5URVhUQVJFQSYmIWsoZSkpe2lmKDE3PT09ZS5rZXlDb2RlfHwyMjQ9PT1lLmtleUNvZGV8fDkxPT09ZS5rZXlDb2RlfHw5Mz09PWUua2V5Q29kZSlyZXR1cm4gdm9pZCBNKGUpO3N3aXRjaChlLmtleUNvZGUpe2Nhc2UgRS5BUlJPV19SSUdIVDpvLmlzSW5GdWxsRWRpdE1vZGUoKSYmKCFvLmlzV2FpdGluZygpJiYhby5hbGxvd0tleUV2ZW50UHJvcGFnYXRpb258fCFvLmlzV2FpdGluZygpJiZvLmFsbG93S2V5RXZlbnRQcm9wYWdhdGlvbiYmIW8uYWxsb3dLZXlFdmVudFByb3BhZ2F0aW9uKGUua2V5Q29kZSkpJiZNKGUpO2JyZWFrO2Nhc2UgRS5BUlJPV19MRUZUOm8uaXNJbkZ1bGxFZGl0TW9kZSgpJiYoIW8uaXNXYWl0aW5nKCkmJiFvLmFsbG93S2V5RXZlbnRQcm9wYWdhdGlvbnx8IW8uaXNXYWl0aW5nKCkmJm8uYWxsb3dLZXlFdmVudFByb3BhZ2F0aW9uJiYhby5hbGxvd0tleUV2ZW50UHJvcGFnYXRpb24oZS5rZXlDb2RlKSkmJk0oZSk7YnJlYWs7Y2FzZSBFLkFSUk9XX1VQOmNhc2UgRS5BUlJPV19ET1dOOm8uaXNJbkZ1bGxFZGl0TW9kZSgpJiYoIW8uaXNXYWl0aW5nKCkmJiFvLmFsbG93S2V5RXZlbnRQcm9wYWdhdGlvbnx8IW8uaXNXYWl0aW5nKCkmJm8uYWxsb3dLZXlFdmVudFByb3BhZ2F0aW9uJiYhby5hbGxvd0tleUV2ZW50UHJvcGFnYXRpb24oZS5rZXlDb2RlKSkmJk0oZSk7YnJlYWs7Y2FzZSBFLkVOVEVSOnZhciByPW8uaW5zdGFuY2UuZ2V0U2VsZWN0ZWQoKSxpPSEoclswXT09PXJbMl0mJnJbMV09PT1yWzNdKTtpZih0JiYhaXx8ZS5hbHRLZXkpe2lmKG8uaXNPcGVuZWQoKSl7dmFyIHM9aChvLlRFWFRBUkVBKSxhPW8uZ2V0VmFsdWUoKSxsPWEuc2xpY2UoMCxzKSsiXG4iK2Euc2xpY2Uocyk7by5zZXRWYWx1ZShsKSx5KG8uVEVYVEFSRUEscysxKX1lbHNlIG8uYmVnaW5FZGl0aW5nKG8ub3JpZ2luYWxWYWx1ZSsiXG4iKTtNKGUpfWUucHJldmVudERlZmF1bHQoKTticmVhaztjYXNlIEUuQTpjYXNlIEUuWDpjYXNlIEUuQzpjYXNlIEUuVjp0JiZNKGUpO2JyZWFrO2Nhc2UgRS5CQUNLU1BBQ0U6Y2FzZSBFLkRFTEVURTpjYXNlIEUuSE9NRTpjYXNlIEUuRU5EOk0oZSl9LTE9PT1bRS5BUlJPV19VUCxFLkFSUk9XX1JJR0hULEUuQVJST1dfRE9XTixFLkFSUk9XX0xFRlRdLmluZGV4T2YoZS5rZXlDb2RlKSYmby5hdXRvUmVzaXplLnJlc2l6ZShTdHJpbmcuZnJvbUNoYXJDb2RlKGUua2V5Q29kZSkpfX07SC5wcm90b3R5cGUub3Blbj1mdW5jdGlvbigpe3RoaXMucmVmcmVzaERpbWVuc2lvbnMoKSx0aGlzLmluc3RhbmNlLmFkZEhvb2soImJlZm9yZUtleURvd24iLEQpfSxILnByb3RvdHlwZS5jbG9zZT1mdW5jdGlvbihlKXt0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5hdXRvUmVzaXplLnVuT2JzZXJ2ZSgpLGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ9PT10aGlzLlRFWFRBUkVBJiZ0aGlzLmluc3RhbmNlLmxpc3RlbigpLHRoaXMuaW5zdGFuY2UucmVtb3ZlSG9vaygiYmVmb3JlS2V5RG93biIsRCl9LEgucHJvdG90eXBlLmZvY3VzPWZ1bmN0aW9uKCl7dGhpcy5URVhUQVJFQS5mb2N1cygpLHkodGhpcy5URVhUQVJFQSx0aGlzLlRFWFRBUkVBLnZhbHVlLmxlbmd0aCl9LEgucHJvdG90eXBlLmNyZWF0ZUVsZW1lbnRzPWZ1bmN0aW9uKCl7dGhpcy5URVhUQVJFQT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJURVhUQVJFQSIpLGQodGhpcy5URVhUQVJFQSwiaGFuZHNvbnRhYmxlSW5wdXQiKSx0aGlzLnRleHRhcmVhU3R5bGU9dGhpcy5URVhUQVJFQS5zdHlsZSx0aGlzLnRleHRhcmVhU3R5bGUud2lkdGg9MCx0aGlzLnRleHRhcmVhU3R5bGUuaGVpZ2h0PTAsdGhpcy5URVhUQVJFQV9QQVJFTlQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksZCh0aGlzLlRFWFRBUkVBX1BBUkVOVCwiaGFuZHNvbnRhYmxlSW5wdXRIb2xkZXIiKSx0aGlzLnRleHRhcmVhUGFyZW50U3R5bGU9dGhpcy5URVhUQVJFQV9QQVJFTlQuc3R5bGUsdGhpcy50ZXh0YXJlYVBhcmVudFN0eWxlLnRvcD0wLHRoaXMudGV4dGFyZWFQYXJlbnRTdHlsZS5sZWZ0PTAsdGhpcy50ZXh0YXJlYVBhcmVudFN0eWxlLmRpc3BsYXk9Im5vbmUiLHRoaXMuVEVYVEFSRUFfUEFSRU5ULmFwcGVuZENoaWxkKHRoaXMuVEVYVEFSRUEpLHRoaXMuaW5zdGFuY2Uucm9vdEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5URVhUQVJFQV9QQVJFTlQpO3ZhciBlPXRoaXM7dGhpcy5pbnN0YW5jZS5fcmVnaXN0ZXJUaW1lb3V0KHNldFRpbWVvdXQoZnVuY3Rpb24oKXtlLnJlZnJlc2hEaW1lbnNpb25zKCl9LDApKX0sSC5wcm90b3R5cGUuZ2V0RWRpdGVkQ2VsbD1mdW5jdGlvbigpe3ZhciBlLHQ9dGhpcy5jaGVja0VkaXRvclNlY3Rpb24oKTtzd2l0Y2godCl7Y2FzZSJ0b3AiOmU9dGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMudG9wT3ZlcmxheS5jbG9uZS53dFRhYmxlLmdldENlbGwoe3Jvdzp0aGlzLnJvdyxjb2w6dGhpcy5jb2x9KSx0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUuekluZGV4PTEwMTticmVhaztjYXNlInRvcC1sZWZ0LWNvcm5lciI6ZT10aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy50b3BMZWZ0Q29ybmVyT3ZlcmxheS5jbG9uZS53dFRhYmxlLmdldENlbGwoe3Jvdzp0aGlzLnJvdyxjb2w6dGhpcy5jb2x9KSx0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUuekluZGV4PTEwMzticmVhaztjYXNlImJvdHRvbS1sZWZ0LWNvcm5lciI6ZT10aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheS5jbG9uZS53dFRhYmxlLmdldENlbGwoe3Jvdzp0aGlzLnJvdyxjb2w6dGhpcy5jb2x9KSx0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUuekluZGV4PTEwMzticmVhaztjYXNlImxlZnQiOmU9dGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMubGVmdE92ZXJsYXkuY2xvbmUud3RUYWJsZS5nZXRDZWxsKHtyb3c6dGhpcy5yb3csY29sOnRoaXMuY29sfSksdGhpcy50ZXh0YXJlYVBhcmVudFN0eWxlLnpJbmRleD0xMDI7YnJlYWs7Y2FzZSJib3R0b20iOmU9dGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMuYm90dG9tT3ZlcmxheS5jbG9uZS53dFRhYmxlLmdldENlbGwoe3Jvdzp0aGlzLnJvdyxjb2w6dGhpcy5jb2x9KSx0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUuekluZGV4PTEwMjticmVhaztkZWZhdWx0OmU9dGhpcy5pbnN0YW5jZS5nZXRDZWxsKHRoaXMucm93LHRoaXMuY29sKSx0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUuekluZGV4PSIifXJldHVybi0xIT1lJiYtMiE9ZT9lOnZvaWQgMH0sSC5wcm90b3R5cGUucmVmcmVzaERpbWVuc2lvbnM9ZnVuY3Rpb24oKXtpZih0aGlzLnN0YXRlPT09SGFuZHNvbnRhYmxlLkVkaXRvclN0YXRlLkVESVRJTkcpe2lmKHRoaXMuVEQ9dGhpcy5nZXRFZGl0ZWRDZWxsKCksIXRoaXMuVEQpcmV0dXJuIHZvaWQgdGhpcy5jbG9zZSghMCk7dmFyIGUsdD12KHRoaXMuVEQpLG49dih0aGlzLmluc3RhbmNlLnJvb3RFbGVtZW50KSxvPWcodGhpcy5URCkscj10aGlzLmluc3RhbmNlLmNvdW50Um93cygpLGk9dC50b3Atbi50b3AtMS0oby5zY3JvbGxUb3B8fDApLHM9dC5sZWZ0LW4ubGVmdC0xLShvLnNjcm9sbExlZnR8fDApLGE9dGhpcy5pbnN0YW5jZS5nZXRTZXR0aW5ncygpLGw9KGEucm93SGVhZGVycz8xOjAsYS5jb2xIZWFkZXJzPzE6MCksdT10aGlzLmNoZWNrRWRpdG9yU2VjdGlvbigpLGM9dGhpcy5URC5zdHlsZS5iYWNrZ3JvdW5kQ29sb3I7c3dpdGNoKHUpe2Nhc2UidG9wIjplPXAodGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMudG9wT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKTticmVhaztjYXNlImxlZnQiOmU9cCh0aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKTticmVhaztjYXNlInRvcC1sZWZ0LWNvcm5lciI6ZT1wKHRoaXMuaW5zdGFuY2Uudmlldy53dC53dE92ZXJsYXlzLnRvcExlZnRDb3JuZXJPdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUpO2JyZWFrO2Nhc2UiYm90dG9tLWxlZnQtY29ybmVyIjplPXAodGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMuYm90dG9tTGVmdENvcm5lck92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIucGFyZW50Tm9kZSk7YnJlYWs7Y2FzZSJib3R0b20iOmU9cCh0aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy5ib3R0b21PdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUpfShsJiYwPT09dGhpcy5pbnN0YW5jZS5nZXRTZWxlY3RlZCgpWzBdfHxhLmZpeGVkUm93c0JvdHRvbSYmdGhpcy5pbnN0YW5jZS5nZXRTZWxlY3RlZCgpWzBdPT09ci1hLmZpeGVkUm93c0JvdHRvbSkmJihpKz0xKSwwPT09dGhpcy5pbnN0YW5jZS5nZXRTZWxlY3RlZCgpWzFdJiYocys9MSksZSYmLTEhPWU/dGhpcy50ZXh0YXJlYVBhcmVudFN0eWxlW2VbMF1dPWVbMV06dyh0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUpLHRoaXMudGV4dGFyZWFQYXJlbnRTdHlsZS50b3A9aSsicHgiLHRoaXMudGV4dGFyZWFQYXJlbnRTdHlsZS5sZWZ0PXMrInB4Ijt2YXIgZD10aGlzLlRELm9mZnNldFRvcC10aGlzLmluc3RhbmNlLnZpZXcud3Qud3RPdmVybGF5cy50b3BPdmVybGF5LmdldFNjcm9sbFBvc2l0aW9uKCksaD10aGlzLlRELm9mZnNldExlZnQtdGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0T3ZlcmxheXMubGVmdE92ZXJsYXkuZ2V0U2Nyb2xsUG9zaXRpb24oKSx5PW0odGhpcy5URCktOCxiPXRoaXMuaW5zdGFuY2Uudmlldy5tYXhpbXVtVmlzaWJsZUVsZW1lbnRXaWR0aChoKS05LEM9dGhpcy5URC5zY3JvbGxIZWlnaHQrMSxSPU1hdGgubWF4KHRoaXMuaW5zdGFuY2Uudmlldy5tYXhpbXVtVmlzaWJsZUVsZW1lbnRIZWlnaHQoZCktMiwyMyksXz1mKHRoaXMuVEQpO3RoaXMuVEVYVEFSRUEuc3R5bGUuZm9udFNpemU9Xy5mb250U2l6ZSx0aGlzLlRFWFRBUkVBLnN0eWxlLmZvbnRGYW1pbHk9Xy5mb250RmFtaWx5LHRoaXMuVEVYVEFSRUEuc3R5bGUuYmFja2dyb3VuZENvbG9yPSIiLHRoaXMuVEVYVEFSRUEuc3R5bGUuYmFja2dyb3VuZENvbG9yPWM/YzpmKHRoaXMuVEVYVEFSRUEpLmJhY2tncm91bmRDb2xvcix0aGlzLmF1dG9SZXNpemUuaW5pdCh0aGlzLlRFWFRBUkVBLHttaW5IZWlnaHQ6TWF0aC5taW4oQyxSKSxtYXhIZWlnaHQ6UixtaW5XaWR0aDpNYXRoLm1pbih5LGIpLG1heFdpZHRoOmJ9LCEwKSx0aGlzLnRleHRhcmVhUGFyZW50U3R5bGUuZGlzcGxheT0iYmxvY2sifX0sSC5wcm90b3R5cGUuYmluZEV2ZW50cz1mdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLlRFWFRBUkVBLCJjdXQiLGZ1bmN0aW9uKGUpe08oZSl9KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuVEVYVEFSRUEsInBhc3RlIixmdW5jdGlvbihlKXtPKGUpfSksdGhpcy5pbnN0YW5jZS5hZGRIb29rKCJhZnRlclNjcm9sbFZlcnRpY2FsbHkiLGZ1bmN0aW9uKCl7ZS5yZWZyZXNoRGltZW5zaW9ucygpfSksdGhpcy5pbnN0YW5jZS5hZGRIb29rKCJhZnRlckNvbHVtblJlc2l6ZSIsZnVuY3Rpb24oKXtlLnJlZnJlc2hEaW1lbnNpb25zKCksZS5mb2N1cygpfSksdGhpcy5pbnN0YW5jZS5hZGRIb29rKCJhZnRlclJvd1Jlc2l6ZSIsZnVuY3Rpb24oKXtlLnJlZnJlc2hEaW1lbnNpb25zKCksZS5mb2N1cygpfSksdGhpcy5pbnN0YW5jZS5hZGRIb29rKCJhZnRlckRlc3Ryb3kiLGZ1bmN0aW9uKCl7ZS5ldmVudE1hbmFnZXIuZGVzdHJveSgpfSl9LEgucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXt0aGlzLmV2ZW50TWFuYWdlci5kZXN0cm95KCl9LFMoInRleHQiLEgpfSx7X2Jhc2VFZGl0b3I6MzAsYXV0b1Jlc2l6ZToiYXV0b1Jlc2l6ZSIsZWRpdG9yczoyOSxldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDYsImhlbHBlcnMvdW5pY29kZSI6NTN9XSw0MTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUsdCl7dmFyIG4sbyxyLGkscyxhPSJIT1QtVEFCTEUiO2lmKHQuaXNUYXJnZXRXZWJDb21wb25lbnQ9ITEsdC5yZWFsVGFyZ2V0PXQudGFyZ2V0LCFIYW5kc29udGFibGUuZXZlbnRNYW5hZ2VyLmlzSG90VGFibGVFbnYpcmV0dXJuIHQ7Zm9yKHQ9bCh0KSxzPXQucGF0aD90LnBhdGgubGVuZ3RoOjA7cy0tOyl7aWYodC5wYXRoW3NdLm5vZGVOYW1lPT09YSluPSEwO2Vsc2UgaWYobiYmdC5wYXRoW3NdLnNoYWRvd1Jvb3Qpe2k9dC5wYXRoW3NdO2JyZWFrfTAhPT1zfHxpfHwoaT10LnBhdGhbc10pfXJldHVybiBpfHwoaT10LnRhcmdldCksdC5pc1RhcmdldFdlYkNvbXBvbmVudD0hMCxjKCk/dC5yZWFsVGFyZ2V0PXQuc3JjRWxlbWVudHx8dC50b0VsZW1lbnQ6KGUgaW5zdGFuY2VvZiBIYW5kc29udGFibGUuQ29yZXx8ZSBpbnN0YW5jZW9mIFdhbGtvbnRhYmxlKSYmKGUgaW5zdGFuY2VvZiBIYW5kc29udGFibGUuQ29yZT9vPWUudmlldz9lLnZpZXcud3Qud3RUYWJsZS5UQUJMRTpudWxsOmUgaW5zdGFuY2VvZiBXYWxrb250YWJsZSYmKG89ZS53dFRhYmxlLlRBQkxFLnBhcmVudE5vZGUucGFyZW50Tm9kZSkscj11KHQudGFyZ2V0LFthXSxvKSxyP3QucmVhbFRhcmdldD1vLnF1ZXJ5U2VsZWN0b3IoYSl8fHQudGFyZ2V0OnQucmVhbFRhcmdldD10LnRhcmdldCksT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsInRhcmdldCIse2dldDpmdW5jdGlvbigpe3JldHVybiBsKGkpfSxlbnVtZXJhYmxlOiEwLGNvbmZpZ3VyYWJsZTohMH0pLHR9ZnVuY3Rpb24gcihlKXtyZXR1cm4gbmV3IGQoZSl9T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7RXZlbnRNYW5hZ2VyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZH19LGV2ZW50TWFuYWdlcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHJ9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgaSxzLGE9KGk9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSksbD1hLnBvbHltZXJXcmFwLHU9YS5jbG9zZXN0LGM9KHM9ZSgiaGVscGVycy9icm93c2VyIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5pc1dlYkNvbXBvbmVudFN1cHBvcnRlZE5hdGl2ZWx5LGQ9ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOm51bGw7dGhpcy5jb250ZXh0PWV8fHRoaXMsdGhpcy5jb250ZXh0LmV2ZW50TGlzdGVuZXJzfHwodGhpcy5jb250ZXh0LmV2ZW50TGlzdGVuZXJzPVtdKX07JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGQse2FkZEV2ZW50TGlzdGVuZXI6ZnVuY3Rpb24oZSx0LG4pe2Z1bmN0aW9uIHIoZSl7dm9pZCAwPT1lLnRhcmdldCYmdm9pZCAwIT1lLnNyY0VsZW1lbnQmJihlLmRlZmluZVBvcGVydHk/ZS5kZWZpbmVQb3BlcnR5KCJ0YXJnZXQiLHt2YWx1ZTplLnNyY0VsZW1lbnR9KTplLnRhcmdldD1lLnNyY0VsZW1lbnQpLHZvaWQgMD09ZS5wcmV2ZW50RGVmYXVsdCYmKGUuZGVmaW5lUG9wZXJ0eT9lLmRlZmluZVBvcGVydHkoInByZXZlbnREZWZhdWx0Iix7dmFsdWU6ZnVuY3Rpb24oKXt0aGlzLnJldHVyblZhbHVlPSExfX0pOmUucHJldmVudERlZmF1bHQ9ZnVuY3Rpb24oKXt0aGlzLnJldHVyblZhbHVlPSExfSksZT1vKHMsZSksbi5jYWxsKHRoaXMsZSl9dmFyIGk9dGhpcyxzPXRoaXMuY29udGV4dDtyZXR1cm4gdGhpcy5jb250ZXh0LmV2ZW50TGlzdGVuZXJzLnB1c2goe2VsZW1lbnQ6ZSxldmVudDp0LGNhbGxiYWNrOm4sY2FsbGJhY2tQcm94eTpyfSksd2luZG93LmFkZEV2ZW50TGlzdGVuZXI/ZS5hZGRFdmVudExpc3RlbmVyKHQsciwhMSk6ZS5hdHRhY2hFdmVudCgib24iK3QsciksSGFuZHNvbnRhYmxlLmNvdW50RXZlbnRNYW5hZ2VyTGlzdGVuZXJzKyssZnVuY3Rpb24oKXtpLnJlbW92ZUV2ZW50TGlzdGVuZXIoZSx0LG4pfX0scmVtb3ZlRXZlbnRMaXN0ZW5lcjpmdW5jdGlvbihlLHQsbil7Zm9yKHZhciBvLHI9dGhpcy5jb250ZXh0LmV2ZW50TGlzdGVuZXJzLmxlbmd0aDtyLS07KWlmKG89dGhpcy5jb250ZXh0LmV2ZW50TGlzdGVuZXJzW3JdLG8uZXZlbnQ9PXQmJm8uZWxlbWVudD09ZSl7aWYobiYmbiE9by5jYWxsYmFjayljb250aW51ZTt0aGlzLmNvbnRleHQuZXZlbnRMaXN0ZW5lcnMuc3BsaWNlKHIsMSksby5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXI/by5lbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoby5ldmVudCxvLmNhbGxiYWNrUHJveHksITEpOm8uZWxlbWVudC5kZXRhY2hFdmVudCgib24iK28uZXZlbnQsby5jYWxsYmFja1Byb3h5KSxIYW5kc29udGFibGUuY291bnRFdmVudE1hbmFnZXJMaXN0ZW5lcnMtLX19LGNsZWFyRXZlbnRzOmZ1bmN0aW9uKCl7aWYodGhpcy5jb250ZXh0KWZvcih2YXIgZT10aGlzLmNvbnRleHQuZXZlbnRMaXN0ZW5lcnMubGVuZ3RoO2UtLTspe3ZhciB0PXRoaXMuY29udGV4dC5ldmVudExpc3RlbmVyc1tlXTt0JiZ0aGlzLnJlbW92ZUV2ZW50TGlzdGVuZXIodC5lbGVtZW50LHQuZXZlbnQsdC5jYWxsYmFjayl9fSxjbGVhcjpmdW5jdGlvbigpe3RoaXMuY2xlYXJFdmVudHMoKX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuY2xlYXJFdmVudHMoKSx0aGlzLmNvbnRleHQ9bnVsbH0sZmlyZUV2ZW50OmZ1bmN0aW9uKGUsdCl7dmFyIG4sbz17YnViYmxlczohMCxjYW5jZWxhYmxlOiJtb3VzZW1vdmUiIT09dCx2aWV3OndpbmRvdyxkZXRhaWw6MCxzY3JlZW5YOjAsc2NyZWVuWTowLGNsaWVudFg6MSxjbGllbnRZOjEsY3RybEtleTohMSxhbHRLZXk6ITEsc2hpZnRLZXk6ITEsbWV0YUtleTohMSxidXR0b246MCxyZWxhdGVkVGFyZ2V0OnZvaWQgMH07ZG9jdW1lbnQuY3JlYXRlRXZlbnQ/KG49ZG9jdW1lbnQuY3JlYXRlRXZlbnQoIk1vdXNlRXZlbnRzIiksbi5pbml0TW91c2VFdmVudCh0LG8uYnViYmxlcyxvLmNhbmNlbGFibGUsby52aWV3LG8uZGV0YWlsLG8uc2NyZWVuWCxvLnNjcmVlblksby5jbGllbnRYLG8uY2xpZW50WSxvLmN0cmxLZXksby5hbHRLZXksby5zaGlmdEtleSxvLm1ldGFLZXksby5idXR0b24sby5yZWxhdGVkVGFyZ2V0fHxkb2N1bWVudC5ib2R5LnBhcmVudE5vZGUpKTpuPWRvY3VtZW50LmNyZWF0ZUV2ZW50T2JqZWN0KCksZS5kaXNwYXRjaEV2ZW50P2UuZGlzcGF0Y2hFdmVudChuKTplLmZpcmVFdmVudCgib24iK3Qsbil9fSx7fSksd2luZG93LkhhbmRzb250YWJsZT13aW5kb3cuSGFuZHNvbnRhYmxlfHx7fSxIYW5kc29udGFibGUuY291bnRFdmVudE1hbmFnZXJMaXN0ZW5lcnM9MCxIYW5kc29udGFibGUuZXZlbnRNYW5hZ2VyPXJ9LHsiaGVscGVycy9icm93c2VyIjo0MywiaGVscGVycy9kb20vZWxlbWVudCI6NDV9XSw0MjpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUpe2Zvcih2YXIgdD0wLG49ZS5sZW5ndGg7bj50OyllW3RdPVtlW3RdXSx0Kyt9ZnVuY3Rpb24gcihlLHQpe2Zvcih2YXIgbj0wLG89dC5sZW5ndGg7bz5uOyllLnB1c2godFtuXSksbisrfWZ1bmN0aW9uIGkoZSl7dmFyIHQ9W107aWYoIWV8fDA9PT1lLmxlbmd0aHx8IWVbMF18fDA9PT1lWzBdLmxlbmd0aClyZXR1cm4gdDtmb3IodmFyIG49ZS5sZW5ndGgsbz1lWzBdLmxlbmd0aCxyPTA7bj5yO3IrKylmb3IodmFyIGk9MDtvPmk7aSsrKXRbaV18fCh0W2ldPVtdKSx0W2ldW3JdPWVbcl1baV07cmV0dXJuIHR9ZnVuY3Rpb24gcyhlLHQsbixvKXt2YXIgcj0tMSxpPWUubGVuZ3RoO2ZvcihvJiZpJiYobj1lWysrcl0pOysrcjxpOyluPXQobixlW3JdLHIsZSk7cmV0dXJuIG59ZnVuY3Rpb24gYShlLHQpe2Zvcih2YXIgbj0tMSxvPWUubGVuZ3RoLHI9LTEsaT1bXTsrK248bzspe3ZhciBzPWVbbl07dChzLG4sZSkmJihpWysrcl09cyl9cmV0dXJuIGl9ZnVuY3Rpb24gbChlLHQpe2Zvcih2YXIgbj0tMSxvPWUubGVuZ3RoLHI9LTEsaT1bXTsrK248bzspe3ZhciBzPWVbbl07aVsrK3JdPXQocyxuLGUpfXJldHVybiBpfWZ1bmN0aW9uIHUoZSx0KXtmb3IodmFyIG49LTEsbz1lLmxlbmd0aDsrK248byYmdChlW25dLG4sZSkhPT0hMTspO3JldHVybiBlfWZ1bmN0aW9uIGMoZSl7cmV0dXJuIHMoZSxmdW5jdGlvbihlLHQpe3JldHVybiBlK3R9LDApfWZ1bmN0aW9uIGQoZSl7cmV0dXJuIHMoZSxmdW5jdGlvbihlLHQpe3JldHVybiBlPnQ/ZTp0fSxBcnJheS5pc0FycmF5KGUpP2VbMF06dm9pZCAwKX1mdW5jdGlvbiBoKGUpe3JldHVybiBzKGUsZnVuY3Rpb24oZSx0KXtyZXR1cm4gdD5lP2U6dH0sQXJyYXkuaXNBcnJheShlKT9lWzBdOnZvaWQgMCl9ZnVuY3Rpb24gZihlKXtyZXR1cm4gZS5sZW5ndGg/YyhlKS9lLmxlbmd0aDowfWZ1bmN0aW9uIHAoZSl7cmV0dXJuIHMoZSxmdW5jdGlvbihlLHQpe3JldHVybiBlLmNvbmNhdChBcnJheS5pc0FycmF5KHQpP3AodCk6dCl9LFtdKX1mdW5jdGlvbiBnKGUpe3ZhciB0PVtdO3JldHVybiB1KGUsZnVuY3Rpb24oZSl7LTE9PT10LmluZGV4T2YoZSkmJnQucHVzaChlKX0pLHR9T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7dG8yZEFycmF5OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb319LGV4dGVuZEFycmF5OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gcn19LHBpdm90OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaX19LGFycmF5UmVkdWNlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gc319LGFycmF5RmlsdGVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYX19LGFycmF5TWFwOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gbH19LGFycmF5RWFjaDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHV9fSxhcnJheVN1bTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGN9fSxhcnJheU1heDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGR9fSxhcnJheU1pbjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGh9fSxhcnJheUF2Zzp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGZ9fSxhcnJheUZsYXR0ZW46e2dldDpmdW5jdGlvbigpe3JldHVybiBwfX0sYXJyYXlVbmlxdWU6e2dldDpmdW5jdGlvbigpe3JldHVybiBnfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSl9LHt9XSw0MzpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKCl7cmV0dXJuIGZ9ZnVuY3Rpb24gcigpe3JldHVybiBwfWZ1bmN0aW9uIGkoKXtyZXR1cm4gZ31mdW5jdGlvbiBzKCl7cmV0dXJuIG19ZnVuY3Rpb24gYShlKXtyZXR1cm4gZXx8KGU9bmF2aWdhdG9yLnVzZXJBZ2VudCksL0FuZHJvaWR8d2ViT1N8aVBob25lfGlQYWR8aVBvZHxCbGFja0JlcnJ5fElFTW9iaWxlfE9wZXJhIE1pbmkvaS50ZXN0KGUpfWZ1bmN0aW9uIGwoKXtyZXR1cm4ib250b3VjaHN0YXJ0ImluIHdpbmRvd31mdW5jdGlvbiB1KCl7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7cmV0dXJuIGUuY3JlYXRlU2hhZG93Um9vdCYmZS5jcmVhdGVTaGFkb3dSb290LnRvU3RyaW5nKCkubWF0Y2goL1xbbmF0aXZlIGNvZGVcXS8pPyEwOiExfWZ1bmN0aW9uIGMoKXt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUQUJMRSIpO2Uuc3R5bGUuYm9yZGVyU3BhY2luZz0wLGUuc3R5bGUuYm9yZGVyV2lkdGg9MCxlLnN0eWxlLnBhZGRpbmc9MDt2YXIgdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUQk9EWSIpO2UuYXBwZW5kQ2hpbGQodCksdC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUUiIpKSx0LmZpcnN0Q2hpbGQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiVEQiKSksdC5maXJzdENoaWxkLmZpcnN0Q2hpbGQuaW5uZXJIVE1MPSI8dHI+PHRkPnQ8YnI+dDwvdGQ+PC90cj4iO3ZhciBuPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkNBUFRJT04iKTtuLmlubmVySFRNTD0iYzxicj5jPGJyPmM8YnI+YyIsbi5zdHlsZS5wYWRkaW5nPTAsbi5zdHlsZS5tYXJnaW49MCxlLmluc2VydEJlZm9yZShuLHQpLGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZSksaD1lLm9mZnNldEhlaWdodDwyKmUubGFzdENoaWxkLm9mZnNldEhlaWdodCxkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGUpfWZ1bmN0aW9uIGQoKXtyZXR1cm4gdm9pZCAwPT09aCYmYygpLGh9T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7aXNJRTg6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0saXNJRTk6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0saXNTYWZhcmk6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0saXNDaHJvbWU6e2dldDpmdW5jdGlvbigpe3JldHVybiBzfX0saXNNb2JpbGVCcm93c2VyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYX19LGlzVG91Y2hTdXBwb3J0ZWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiBsfX0saXNXZWJDb21wb25lbnRTdXBwb3J0ZWROYXRpdmVseTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHV9fSxoYXNDYXB0aW9uUHJvYmxlbTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGR9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgaCxmPSFkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgidGVzdCIpLnRleHRDb250ZW50LHA9ISFkb2N1bWVudC5kb2N1bWVudE1vZGUsZz0vU2FmYXJpLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpJiYvQXBwbGUgQ29tcHV0ZXIvLnRlc3QobmF2aWdhdG9yLnZlbmRvciksbT0vQ2hyb21lLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpJiYvR29vZ2xlLy50ZXN0KG5hdmlnYXRvci52ZW5kb3IpfSx7fV0sNDQ6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlKXtmb3IodmFyIHQsbj1lKzEsbz0iIjtuPjA7KXQ9KG4tMSklMjYsbz1TdHJpbmcuZnJvbUNoYXJDb2RlKDY1K3QpK28sbj1wYXJzZUludCgobi10KS8yNiwxMCk7cmV0dXJuIG99ZnVuY3Rpb24gcihlLHQpe2U9Im51bWJlciI9PXR5cGVvZiBlP2U6MTAwLHQ9Im51bWJlciI9PXR5cGVvZiB0P3Q6NDt2YXIgbixyLGk9W107Zm9yKG49MDtlPm47bisrKXt2YXIgcz1bXTtmb3Iocj0wO3Q+cjtyKyspcy5wdXNoKG8ocikrKG4rMSkpO2kucHVzaChzKX1yZXR1cm4gaX1mdW5jdGlvbiBpKGUsdCl7ZT0ibnVtYmVyIj09dHlwZW9mIGU/ZToxMDAsdD0ibnVtYmVyIj09dHlwZW9mIHQ/dDo0O3ZhciBuLHIsaT1bXTtmb3Iobj0wO2U+bjtuKyspe3ZhciBzPXt9O2ZvcihyPTA7dD5yO3IrKylzWyJwcm9wIityXT1vKHIpKyhuKzEpO2kucHVzaChzKX1yZXR1cm4gaX1mdW5jdGlvbiBzKGUsdCl7Zm9yKHZhciBuLG89W10scj0wO2U+cjtyKyspe249W107Zm9yKHZhciBpPTA7dD5pO2krKyluLnB1c2goIiIpO28ucHVzaChuKX1yZXR1cm4gb31mdW5jdGlvbiBhKGUpe3ZhciB0LG4sbyxyLGk9W10scz0wO2Zvcih0PTAsbj1lLmxlbmd0aDtuPnQ7dCsrKWZvcihvPTAscj1lW3RdLmxlbmd0aDtyPm87bysrKW89PXMmJihpLnB1c2goW10pLHMrKyksaVtvXS5wdXNoKGVbdF1bb10pO3JldHVybiBpfWZ1bmN0aW9uIGwoZSx0KXtmdW5jdGlvbiBuKGUpe3ZhciB0PUhhbmRzb250YWJsZS5jZWxsVHlwZXNbZV07aWYoInVuZGVmaW5lZCI9PXR5cGVvZiB0KXRocm93IG5ldyBFcnJvcignWW91IGRlY2xhcmVkIGNlbGwgdHlwZSAiJytlKyciIGFzIGEgc3RyaW5nIHRoYXQgaXMgbm90IG1hcHBlZCB0byBhIGtub3duIG9iamVjdC4gQ2VsbCB0eXBlIG11c3QgYmUgYW4gb2JqZWN0IG9yIGEgc3RyaW5nIG1hcHBlZCB0byBhbiBvYmplY3QgaW4gSGFuZHNvbnRhYmxlLmNlbGxUeXBlcycpO3JldHVybiB0fXJldHVybiB0PSJ1bmRlZmluZWQiPT10eXBlb2YgdD8hMDp0LGZ1bmN0aW9uKG8scil7cmV0dXJuIGZ1bmN0aW9uIGkobyl7aWYobyl7aWYoby5oYXNPd25Qcm9wZXJ0eShlKSYmdm9pZCAwIT09b1tlXSlyZXR1cm4gb1tlXTtpZihvLmhhc093blByb3BlcnR5KCJ0eXBlIikmJm8udHlwZSl7dmFyIHI7aWYoInN0cmluZyIhPXR5cGVvZiBvLnR5cGUpdGhyb3cgbmV3IEVycm9yKCJDZWxsIHR5cGUgbXVzdCBiZSBhIHN0cmluZyAiKTtpZihyPW4oby50eXBlKSxyLmhhc093blByb3BlcnR5KGUpKXJldHVybiByW2VdO2lmKHQpcmV0dXJufXJldHVybiBpKGMobykpfX0oIm51bWJlciI9PXR5cGVvZiBvP3RoaXMuZ2V0Q2VsbE1ldGEobyxyKTpvKX19T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7c3ByZWFkc2hlZXRDb2x1bW5MYWJlbDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxjcmVhdGVTcHJlYWRzaGVldERhdGE6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0sY3JlYXRlU3ByZWFkc2hlZXRPYmplY3REYXRhOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaX19LGNyZWF0ZUVtcHR5U3ByZWFkc2hlZXREYXRhOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gc319LHRyYW5zbGF0ZVJvd3NUb0NvbHVtbnM6e2dldDpmdW5jdGlvbigpe3JldHVybiBhfX0sY2VsbE1ldGhvZExvb2t1cEZhY3Rvcnk6e2dldDpmdW5jdGlvbigpe3JldHVybiBsfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHUsYz0odT1lKCJvYmplY3QiKSx1JiZ1Ll9fZXNNb2R1bGUmJnV8fHsiZGVmYXVsdCI6dX0pLmdldFByb3RvdHlwZU9mfSx7b2JqZWN0OjUwfV0sNDU6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQsbil7Zm9yKDtudWxsIT1lJiZlIT09bjspe2lmKGUubm9kZVR5cGU9PT1Ob2RlLkVMRU1FTlRfTk9ERSYmKHQuaW5kZXhPZihlLm5vZGVOYW1lKT4tMXx8dC5pbmRleE9mKGUpPi0xKSlyZXR1cm4gZTtlPWUuaG9zdCYmZS5ub2RlVHlwZT09PU5vZGUuRE9DVU1FTlRfRlJBR01FTlRfTk9ERT9lLmhvc3Q6ZS5wYXJlbnROb2RlfXJldHVybiBudWxsfWZ1bmN0aW9uIHIoZSx0KXt2YXIgbj1lLnBhcmVudE5vZGUsbz1bXTtmb3IoInN0cmluZyI9PXR5cGVvZiB0P289QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCh0KSwwKTpvLnB1c2godCk7bnVsbCE9bjspe2lmKG8uaW5kZXhPZihuKT4tMSlyZXR1cm4hMDtuPW4ucGFyZW50Tm9kZX1yZXR1cm4hMX1mdW5jdGlvbiBpKGUpe2Z1bmN0aW9uIHQoZSl7cmV0dXJuIGUubm9kZVR5cGU9PT1Ob2RlLkVMRU1FTlRfTk9ERSYmZS5ub2RlTmFtZT09PW8udG9VcHBlckNhc2UoKX12YXIgbixvPSJob3QtdGFibGUiLHI9ITE7Zm9yKG49cyhlKTtudWxsIT1uOyl7aWYodChuKSl7cj0hMDticmVha31pZihuLmhvc3QmJm4ubm9kZVR5cGU9PT1Ob2RlLkRPQ1VNRU5UX0ZSQUdNRU5UX05PREUpe2lmKHI9dChuLmhvc3QpKWJyZWFrO249bi5ob3N0fW49bi5wYXJlbnROb2RlfXJldHVybiByfWZ1bmN0aW9uIHMoZSl7cmV0dXJuInVuZGVmaW5lZCIhPXR5cGVvZiBQb2x5bWVyJiYiZnVuY3Rpb24iPT10eXBlb2Ygd3JhcD93cmFwKGUpOmV9ZnVuY3Rpb24gYShlKXtyZXR1cm4idW5kZWZpbmVkIiE9dHlwZW9mIFBvbHltZXImJiJmdW5jdGlvbiI9PXR5cGVvZiB1bndyYXA/dW53cmFwKGUpOmV9ZnVuY3Rpb24gbChlKXt2YXIgdD0wO2lmKGUucHJldmlvdXNTaWJsaW5nKWZvcig7ZT1lLnByZXZpb3VzU2libGluZzspKyt0O3JldHVybiB0fWZ1bmN0aW9uIHUoZSx0KXt2YXIgbj1kb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIuaHRfY2xvbmVfIitlKTtyZXR1cm4gbj9uLmNvbnRhaW5zKHQpOm51bGx9ZnVuY3Rpb24gYyhlKXt2YXIgdD0wLG49W107aWYoIWV8fCFlLmxlbmd0aClyZXR1cm4gbjtmb3IoO2VbdF07KW4ucHVzaChlW3RdKSx0Kys7cmV0dXJuIG59ZnVuY3Rpb24gZChlLHQpe3JldHVybiBLKGUsdCl9ZnVuY3Rpb24gaChlLHQpe3JldHVybiBYKGUsdCl9ZnVuY3Rpb24gZihlLHQpe3JldHVybiBxKGUsdCl9ZnVuY3Rpb24gcChlLHQpe2lmKDM9PT1lLm5vZGVUeXBlKXQucmVtb3ZlQ2hpbGQoZSk7ZWxzZSBpZihbIlRBQkxFIiwiVEhFQUQiLCJUQk9EWSIsIlRGT09UIiwiVFIiXS5pbmRleE9mKGUubm9kZU5hbWUpPi0xKWZvcih2YXIgbj1lLmNoaWxkTm9kZXMsbz1uLmxlbmd0aC0xO28+PTA7by0tKXAobltvXSxlKX1mdW5jdGlvbiBnKGUpe2Zvcih2YXIgdDt0PWUubGFzdENoaWxkOyllLnJlbW92ZUNoaWxkKHQpfWZ1bmN0aW9uIG0oZSx0KXtzZS50ZXN0KHQpP2UuaW5uZXJIVE1MPXQ6dihlLHQpfWZ1bmN0aW9uIHYoZSx0KXt2YXIgbj1lLmZpcnN0Q2hpbGQ7biYmMz09PW4ubm9kZVR5cGUmJm51bGw9PT1uLm5leHRTaWJsaW5nP2FlP24udGV4dENvbnRlbnQ9dDpuLmRhdGE9dDooZyhlKSxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHQpKSl9ZnVuY3Rpb24gdyhlKXtmb3IodmFyIHQ9ZTthKHQpIT09ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Oyl7aWYobnVsbD09PXQpcmV0dXJuITE7aWYodC5ub2RlVHlwZT09PU5vZGUuRE9DVU1FTlRfRlJBR01FTlRfTk9ERSl7aWYodC5ob3N0KXtpZih0Lmhvc3QuaW1wbClyZXR1cm4gdyh0Lmhvc3QuaW1wbCk7aWYodC5ob3N0KXJldHVybiB3KHQuaG9zdCk7dGhyb3cgbmV3IEVycm9yKCJMb3N0IGluIFdlYiBDb21wb25lbnRzIHdvcmxkIil9cmV0dXJuITF9aWYoIm5vbmUiPT09dC5zdHlsZS5kaXNwbGF5KXJldHVybiExO3Q9dC5wYXJlbnROb2RlfXJldHVybiEwfWZ1bmN0aW9uIHkoZSl7dmFyIHQsbixvLHIsaTtpZihyPWRvY3VtZW50LmRvY3VtZW50RWxlbWVudCx0ZSgpJiZlLmZpcnN0Q2hpbGQmJiJDQVBUSU9OIj09PWUuZmlyc3RDaGlsZC5ub2RlTmFtZSlyZXR1cm4gaT1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLHt0b3A6aS50b3ArKHdpbmRvdy5wYWdlWU9mZnNldHx8ci5zY3JvbGxUb3ApLShyLmNsaWVudFRvcHx8MCksbGVmdDppLmxlZnQrKHdpbmRvdy5wYWdlWE9mZnNldHx8ci5zY3JvbGxMZWZ0KS0oci5jbGllbnRMZWZ0fHwwKX07Zm9yKHQ9ZS5vZmZzZXRMZWZ0LG49ZS5vZmZzZXRUb3Asbz1lOyhlPWUub2Zmc2V0UGFyZW50KSYmZSE9PWRvY3VtZW50LmJvZHk7KXQrPWUub2Zmc2V0TGVmdCxuKz1lLm9mZnNldFRvcCxvPWU7cmV0dXJuIG8mJiJmaXhlZCI9PT1vLnN0eWxlLnBvc2l0aW9uJiYodCs9d2luZG93LnBhZ2VYT2Zmc2V0fHxyLnNjcm9sbExlZnQsbis9d2luZG93LnBhZ2VZT2Zmc2V0fHxyLnNjcm9sbFRvcCkse2xlZnQ6dCx0b3A6bn19ZnVuY3Rpb24gYigpe3ZhciBlPXdpbmRvdy5zY3JvbGxZO3JldHVybiB2b2lkIDA9PT1lJiYoZT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wKSxlfWZ1bmN0aW9uIEMoKXt2YXIgZT13aW5kb3cuc2Nyb2xsWDtyZXR1cm4gdm9pZCAwPT09ZSYmKGU9ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbExlZnQpLGV9ZnVuY3Rpb24gUihlKXtyZXR1cm4gZT09PXdpbmRvdz9iKCk6ZS5zY3JvbGxUb3B9ZnVuY3Rpb24gXyhlKXtyZXR1cm4gZT09PXdpbmRvdz9DKCk6ZS5zY3JvbGxMZWZ0fWZ1bmN0aW9uIFMoZSl7Zm9yKHZhciB0LG4sbyxyPWUucGFyZW50Tm9kZSxpPVsiYXV0byIsInNjcm9sbCJdLHM9IiIsYT0iIixsPSIiLHU9IiI7ciYmci5zdHlsZSYmZG9jdW1lbnQuYm9keSE9PXI7KXtpZih0PXIuc3R5bGUub3ZlcmZsb3csbj1yLnN0eWxlLm92ZXJmbG93WCxvPXIuc3R5bGUub3ZlcmZsb3dZLCJzY3JvbGwiPT10fHwic2Nyb2xsIj09bnx8InNjcm9sbCI9PW8pcmV0dXJuIHI7aWYod2luZG93LmdldENvbXB1dGVkU3R5bGUmJihzPXdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKHIpLGE9cy5nZXRQcm9wZXJ0eVZhbHVlKCJvdmVyZmxvdyIpLGw9cy5nZXRQcm9wZXJ0eVZhbHVlKCJvdmVyZmxvdy15IiksdT1zLmdldFByb3BlcnR5VmFsdWUoIm92ZXJmbG93LXgiKSwic2Nyb2xsIj09PWF8fCJzY3JvbGwiPT09dXx8InNjcm9sbCI9PT1sKSlyZXR1cm4gcjtpZihyLmNsaWVudEhlaWdodDw9ci5zY3JvbGxIZWlnaHQmJigtMSE9PWkuaW5kZXhPZihvKXx8LTEhPT1pLmluZGV4T2YodCl8fC0xIT09aS5pbmRleE9mKGEpfHwtMSE9PWkuaW5kZXhPZihsKSkpcmV0dXJuIHI7aWYoci5jbGllbnRXaWR0aDw9ci5zY3JvbGxXaWR0aCYmKC0xIT09aS5pbmRleE9mKG4pfHwtMSE9PWkuaW5kZXhPZih0KXx8LTEhPT1pLmluZGV4T2YoYSl8fC0xIT09aS5pbmRleE9mKHUpKSlyZXR1cm4gcjtyPXIucGFyZW50Tm9kZX1yZXR1cm4gd2luZG93fWZ1bmN0aW9uIEUoZSl7Zm9yKHZhciB0PWUucGFyZW50Tm9kZTt0JiZ0LnN0eWxlJiZkb2N1bWVudC5ib2R5IT09dDspe2lmKCJ2aXNpYmxlIiE9PXQuc3R5bGUub3ZlcmZsb3cmJiIiIT09dC5zdHlsZS5vdmVyZmxvdylyZXR1cm4gdDtpZih3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSl7dmFyIG49d2luZG93LmdldENvbXB1dGVkU3R5bGUodCk7aWYoInZpc2libGUiIT09bi5nZXRQcm9wZXJ0eVZhbHVlKCJvdmVyZmxvdyIpJiYiIiE9PW4uZ2V0UHJvcGVydHlWYWx1ZSgib3ZlcmZsb3ciKSlyZXR1cm4gdDsKfXQ9dC5wYXJlbnROb2RlfXJldHVybiB3aW5kb3d9ZnVuY3Rpb24gVChlLHQpe2lmKGUpe2lmKGUhPT13aW5kb3cpe3ZhciBuLG89ZS5zdHlsZVt0XTtyZXR1cm4iIiE9PW8mJnZvaWQgMCE9PW8/bzoobj1PKGUpLCIiIT09blt0XSYmdm9pZCAwIT09blt0XT9uW3RdOnZvaWQgMCl9aWYoIndpZHRoIj09PXQpcmV0dXJuIHdpbmRvdy5pbm5lcldpZHRoKyJweCI7aWYoImhlaWdodCI9PT10KXJldHVybiB3aW5kb3cuaW5uZXJIZWlnaHQrInB4In19ZnVuY3Rpb24gTyhlKXtyZXR1cm4gZS5jdXJyZW50U3R5bGV8fGRvY3VtZW50LmRlZmF1bHRWaWV3LmdldENvbXB1dGVkU3R5bGUoZSl9ZnVuY3Rpb24gTShlKXtyZXR1cm4gZS5vZmZzZXRXaWR0aH1mdW5jdGlvbiBrKGUpe3JldHVybiB0ZSgpJiZlLmZpcnN0Q2hpbGQmJiJDQVBUSU9OIj09PWUuZmlyc3RDaGlsZC5ub2RlTmFtZT9lLm9mZnNldEhlaWdodCtlLmZpcnN0Q2hpbGQub2Zmc2V0SGVpZ2h0OmUub2Zmc2V0SGVpZ2h0fWZ1bmN0aW9uIEgoZSl7cmV0dXJuIGUuY2xpZW50SGVpZ2h0fHxlLmlubmVySGVpZ2h0fWZ1bmN0aW9uIEQoZSl7cmV0dXJuIGUuY2xpZW50V2lkdGh8fGUuaW5uZXJXaWR0aH1mdW5jdGlvbiB4KGUsdCxuKXt3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcj9lLmFkZEV2ZW50TGlzdGVuZXIodCxuLCExKTplLmF0dGFjaEV2ZW50KCJvbiIrdCxuKX1mdW5jdGlvbiBBKGUsdCxuKXt3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcj9lLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxuLCExKTplLmRldGFjaEV2ZW50KCJvbiIrdCxuKX1mdW5jdGlvbiBQKGUpe2lmKGUuc2VsZWN0aW9uU3RhcnQpcmV0dXJuIGUuc2VsZWN0aW9uU3RhcnQ7aWYoZG9jdW1lbnQuc2VsZWN0aW9uKXtlLmZvY3VzKCk7dmFyIHQ9ZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7aWYobnVsbD09dClyZXR1cm4gMDt2YXIgbj1lLmNyZWF0ZVRleHRSYW5nZSgpLG89bi5kdXBsaWNhdGUoKTtyZXR1cm4gbi5tb3ZlVG9Cb29rbWFyayh0LmdldEJvb2ttYXJrKCkpLG8uc2V0RW5kUG9pbnQoIkVuZFRvU3RhcnQiLG4pLG8udGV4dC5sZW5ndGh9cmV0dXJuIDB9ZnVuY3Rpb24gTihlKXtpZihlLnNlbGVjdGlvbkVuZClyZXR1cm4gZS5zZWxlY3Rpb25FbmQ7aWYoZG9jdW1lbnQuc2VsZWN0aW9uKXt2YXIgdD1kb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTtpZihudWxsPT10KXJldHVybiAwO3ZhciBuPWUuY3JlYXRlVGV4dFJhbmdlKCk7cmV0dXJuIG4udGV4dC5pbmRleE9mKHQudGV4dCkrdC50ZXh0Lmxlbmd0aH19ZnVuY3Rpb24gTCgpe3ZhciBlPSIiO3JldHVybiB3aW5kb3cuZ2V0U2VsZWN0aW9uP2U9d2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCk6ZG9jdW1lbnQuc2VsZWN0aW9uJiYiQ29udHJvbCIhPT1kb2N1bWVudC5zZWxlY3Rpb24udHlwZSYmKGU9ZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkudGV4dCksZX1mdW5jdGlvbiBXKGUsdCxuKXtpZih2b2lkIDA9PT1uJiYobj10KSxlLnNldFNlbGVjdGlvblJhbmdlKXtlLmZvY3VzKCk7dHJ5e2Uuc2V0U2VsZWN0aW9uUmFuZ2UodCxuKX1jYXRjaChvKXt2YXIgcj1lLnBhcmVudE5vZGUsaT1yLnN0eWxlLmRpc3BsYXk7ci5zdHlsZS5kaXNwbGF5PSJibG9jayIsZS5zZXRTZWxlY3Rpb25SYW5nZSh0LG4pLHIuc3R5bGUuZGlzcGxheT1pfX1lbHNlIGlmKGUuY3JlYXRlVGV4dFJhbmdlKXt2YXIgcz1lLmNyZWF0ZVRleHRSYW5nZSgpO3MuY29sbGFwc2UoITApLHMubW92ZUVuZCgiY2hhcmFjdGVyIixuKSxzLm1vdmVTdGFydCgiY2hhcmFjdGVyIix0KSxzLnNlbGVjdCgpfX1mdW5jdGlvbiBJKCl7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgicCIpO2Uuc3R5bGUud2lkdGg9IjEwMCUiLGUuc3R5bGUuaGVpZ2h0PSIyMDBweCI7dmFyIHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7dC5zdHlsZS5wb3NpdGlvbj0iYWJzb2x1dGUiLHQuc3R5bGUudG9wPSIwcHgiLHQuc3R5bGUubGVmdD0iMHB4Iix0LnN0eWxlLnZpc2liaWxpdHk9ImhpZGRlbiIsdC5zdHlsZS53aWR0aD0iMjAwcHgiLHQuc3R5bGUuaGVpZ2h0PSIxNTBweCIsdC5zdHlsZS5vdmVyZmxvdz0iaGlkZGVuIix0LmFwcGVuZENoaWxkKGUpLChkb2N1bWVudC5ib2R5fHxkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQpLmFwcGVuZENoaWxkKHQpO3ZhciBuPWUub2Zmc2V0V2lkdGg7dC5zdHlsZS5vdmVyZmxvdz0ic2Nyb2xsIjt2YXIgbz1lLm9mZnNldFdpZHRoO3JldHVybiBuPT1vJiYobz10LmNsaWVudFdpZHRoKSwoZG9jdW1lbnQuYm9keXx8ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50KS5yZW1vdmVDaGlsZCh0KSxuLW99ZnVuY3Rpb24gaigpe3JldHVybiB2b2lkIDA9PT1pZSYmKGllPUkoKSksaWV9ZnVuY3Rpb24gQihlLHQsbil7SigpfHxRKCk/KGUuc3R5bGUudG9wPW4sZS5zdHlsZS5sZWZ0PXQpOmVlKCk/ZS5zdHlsZVsiLXdlYmtpdC10cmFuc2Zvcm0iXT0idHJhbnNsYXRlM2QoIit0KyIsIituKyIsMCkiOmUuc3R5bGUudHJhbnNmb3JtPSJ0cmFuc2xhdGUzZCgiK3QrIiwiK24rIiwwKSJ9ZnVuY3Rpb24gRihlKXt2YXIgdDtyZXR1cm4gZS5zdHlsZS50cmFuc2Zvcm0mJiIiIT09KHQ9ZS5zdHlsZS50cmFuc2Zvcm0pP1sidHJhbnNmb3JtIix0XTplLnN0eWxlWyItd2Via2l0LXRyYW5zZm9ybSJdJiYiIiE9PSh0PWUuc3R5bGVbIi13ZWJraXQtdHJhbnNmb3JtIl0pP1siLXdlYmtpdC10cmFuc2Zvcm0iLHRdOi0xfWZ1bmN0aW9uIFYoZSl7ZS50cmFuc2Zvcm0mJiIiIT09ZS50cmFuc2Zvcm0/ZS50cmFuc2Zvcm09IiI6ZVsiLXdlYmtpdC10cmFuc2Zvcm0iXSYmIiIhPT1lWyItd2Via2l0LXRyYW5zZm9ybSJdJiYoZVsiLXdlYmtpdC10cmFuc2Zvcm0iXT0iIil9ZnVuY3Rpb24geihlKXt2YXIgdD1bIklOUFVUIiwiU0VMRUNUIiwiVEVYVEFSRUEiXTtyZXR1cm4gdC5pbmRleE9mKGUubm9kZU5hbWUpPi0xfHwidHJ1ZSI9PT1lLmNvbnRlbnRFZGl0YWJsZX1mdW5jdGlvbiBZKGUpe3JldHVybiB6KGUpJiYtMT09ZS5jbGFzc05hbWUuaW5kZXhPZigiaGFuZHNvbnRhYmxlSW5wdXQiKSYmLTE9PWUuY2xhc3NOYW1lLmluZGV4T2YoImNvcHlQYXN0ZSIpfWZ1bmN0aW9uIFUoZSl7cmV0dXJuIGNlLmNhbGwod2luZG93LGUpfWZ1bmN0aW9uIEcoZSl7ZGUuY2FsbCh3aW5kb3csZSl9T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7Y2xvc2VzdDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxpc0NoaWxkT2Y6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0saXNDaGlsZE9mV2ViQ29tcG9uZW50VGFibGU6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0scG9seW1lcldyYXA6e2dldDpmdW5jdGlvbigpe3JldHVybiBzfX0scG9seW1lclVud3JhcDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGF9fSxpbmRleDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGx9fSxvdmVybGF5Q29udGFpbnNFbGVtZW50OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdX19LGhhc0NsYXNzOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZH19LGFkZENsYXNzOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaH19LHJlbW92ZUNsYXNzOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZn19LHJlbW92ZVRleHROb2Rlczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHB9fSxlbXB0eTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGd9fSxIVE1MX0NIQVJBQ1RFUlM6e2dldDpmdW5jdGlvbigpe3JldHVybiBzZX19LGZhc3RJbm5lckhUTUw6e2dldDpmdW5jdGlvbigpe3JldHVybiBtfX0sZmFzdElubmVyVGV4dDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHZ9fSxpc1Zpc2libGU6e2dldDpmdW5jdGlvbigpe3JldHVybiB3fX0sb2Zmc2V0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4geX19LGdldFdpbmRvd1Njcm9sbFRvcDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGJ9fSxnZXRXaW5kb3dTY3JvbGxMZWZ0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gQ319LGdldFNjcm9sbFRvcDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIFJ9fSxnZXRTY3JvbGxMZWZ0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gX319LGdldFNjcm9sbGFibGVFbGVtZW50OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gU319LGdldFRyaW1taW5nQ29udGFpbmVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gRX19LGdldFN0eWxlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gVH19LGdldENvbXB1dGVkU3R5bGU6e2dldDpmdW5jdGlvbigpe3JldHVybiBPfX0sb3V0ZXJXaWR0aDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIE19fSxvdXRlckhlaWdodDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGt9fSxpbm5lckhlaWdodDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEh9fSxpbm5lcldpZHRoOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gRH19LGFkZEV2ZW50OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4geH19LHJlbW92ZUV2ZW50OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gQX19LGdldENhcmV0UG9zaXRpb246e2dldDpmdW5jdGlvbigpe3JldHVybiBQfX0sZ2V0U2VsZWN0aW9uRW5kUG9zaXRpb246e2dldDpmdW5jdGlvbigpe3JldHVybiBOfX0sZ2V0U2VsZWN0aW9uVGV4dDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEx9fSxzZXRDYXJldFBvc2l0aW9uOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gV319LGdldFNjcm9sbGJhcldpZHRoOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gan19LHNldE92ZXJsYXlQb3NpdGlvbjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEJ9fSxnZXRDc3NUcmFuc2Zvcm06e2dldDpmdW5jdGlvbigpe3JldHVybiBGfX0scmVzZXRDc3NUcmFuc2Zvcm06e2dldDpmdW5jdGlvbigpe3JldHVybiBWfX0saXNJbnB1dDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHp9fSxpc091dHNpZGVJbnB1dDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIFl9fSxyZXF1ZXN0QW5pbWF0aW9uRnJhbWU6e2dldDpmdW5jdGlvbigpe3JldHVybiBVfX0sY2FuY2VsQW5pbWF0aW9uRnJhbWU6e2dldDpmdW5jdGlvbigpe3JldHVybiBHfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyICQsSyxYLHEsWj0oJD1lKCIuLi9icm93c2VyIiksJCYmJC5fX2VzTW9kdWxlJiYkfHx7ImRlZmF1bHQiOiR9KSxKPVouaXNJRTgsUT1aLmlzSUU5LGVlPVouaXNTYWZhcmksdGU9Wi5oYXNDYXB0aW9uUHJvYmxlbSxuZT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xhc3NMaXN0PyEwOiExO2lmKG5lKXt2YXIgb2U9ZnVuY3Rpb24oKXt2YXIgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTtyZXR1cm4gZS5jbGFzc0xpc3QuYWRkKCJ0ZXN0IiwidGVzdDIiKSxlLmNsYXNzTGlzdC5jb250YWlucygidGVzdDIiKX0oKTtLPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIiI9PT10PyExOmUuY2xhc3NMaXN0LmNvbnRhaW5zKHQpfSxYPWZ1bmN0aW9uKGUsdCl7dmFyIG49MDtpZigic3RyaW5nIj09dHlwZW9mIHQmJih0PXQuc3BsaXQoIiAiKSksdD1jKHQpLG9lKWUuY2xhc3NMaXN0LmFkZC5hcHBseShlLmNsYXNzTGlzdCx0KTtlbHNlIGZvcig7dCYmdFtuXTspZS5jbGFzc0xpc3QuYWRkKHRbbl0pLG4rK30scT1mdW5jdGlvbihlLHQpe3ZhciBuPTA7aWYoInN0cmluZyI9PXR5cGVvZiB0JiYodD10LnNwbGl0KCIgIikpLHQ9Yyh0KSxvZSllLmNsYXNzTGlzdC5yZW1vdmUuYXBwbHkoZS5jbGFzc0xpc3QsdCk7ZWxzZSBmb3IoO3QmJnRbbl07KWUuY2xhc3NMaXN0LnJlbW92ZSh0W25dKSxuKyt9fWVsc2V7dmFyIHJlPWZ1bmN0aW9uKGUpe3JldHVybiBuZXcgUmVnRXhwKCIoXFxzfF4pIitlKyIoXFxzfCQpIil9O0s9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5jbGFzc05hbWUubWF0Y2gocmUodCkpPyEwOiExfSxYPWZ1bmN0aW9uKGUsdCl7dmFyIG49MCxvPWUuY2xhc3NOYW1lO2lmKCJzdHJpbmciPT10eXBlb2YgdCYmKHQ9dC5zcGxpdCgiICIpKSwiIj09PW8pbz10LmpvaW4oIiAiKTtlbHNlIGZvcig7dCYmdFtuXTspcmUodFtuXSkudGVzdChvKXx8KG8rPSIgIit0W25dKSxuKys7ZS5jbGFzc05hbWU9b30scT1mdW5jdGlvbihlLHQpe3ZhciBuPTAsbz1lLmNsYXNzTmFtZTtmb3IoInN0cmluZyI9PXR5cGVvZiB0JiYodD10LnNwbGl0KCIgIikpO3QmJnRbbl07KW89by5yZXBsYWNlKHJlKHRbbl0pLCIgIikudHJpbSgpLG4rKztlLmNsYXNzTmFtZSE9PW8mJihlLmNsYXNzTmFtZT1vKX19Zm9yKHZhciBpZSxzZT0vKDwoLiopPnwmKC4qKTspLyxhZT1kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgidGVzdCIpLnRleHRDb250ZW50PyEwOiExLGxlPTAsdWU9WyJtcyIsIm1veiIsIndlYmtpdCIsIm8iXSxjZT13aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lLGRlPXdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZSxoZT0wO2hlPHVlLmxlbmd0aCYmIWNlOysraGUpY2U9d2luZG93W3VlW2hlXSsiUmVxdWVzdEFuaW1hdGlvbkZyYW1lIl0sZGU9d2luZG93W3VlW2hlXSsiQ2FuY2VsQW5pbWF0aW9uRnJhbWUiXXx8d2luZG93W3VlW2hlXSsiQ2FuY2VsUmVxdWVzdEFuaW1hdGlvbkZyYW1lIl07Y2V8fChjZT1mdW5jdGlvbihlKXt2YXIgdD0obmV3IERhdGUpLmdldFRpbWUoKSxuPU1hdGgubWF4KDAsMTYtKHQtbGUpKSxvPXdpbmRvdy5zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZSh0K24pfSxuKTtyZXR1cm4gbGU9dCtuLG99KSxkZXx8KGRlPWZ1bmN0aW9uKGUpe2NsZWFyVGltZW91dChlKX0pfSx7Ii4uL2Jyb3dzZXIiOjQzfV0sNDY6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlKXtlLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25FbmFibGVkPSExLGUuY2FuY2VsQnViYmxlPSEwfWZ1bmN0aW9uIHIoZSl7cmV0dXJuIGUuaXNJbW1lZGlhdGVQcm9wYWdhdGlvbkVuYWJsZWQ9PT0hMX1mdW5jdGlvbiBpKGUpeyJmdW5jdGlvbiI9PXR5cGVvZiBlLnN0b3BQcm9wYWdhdGlvbj9lLnN0b3BQcm9wYWdhdGlvbigpOmUuY2FuY2VsQnViYmxlPSEwfWZ1bmN0aW9uIHMoZSl7aWYoZS5wYWdlWClyZXR1cm4gZS5wYWdlWDt2YXIgdD1nZXRXaW5kb3dTY3JvbGxMZWZ0KCksbj1lLmNsaWVudFgrdDtyZXR1cm4gbn1mdW5jdGlvbiBhKGUpe2lmKGUucGFnZVkpcmV0dXJuIGUucGFnZVk7dmFyIHQ9Z2V0V2luZG93U2Nyb2xsVG9wKCksbj1lLmNsaWVudFkrdDtyZXR1cm4gbn1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtzdG9wSW1tZWRpYXRlUHJvcGFnYXRpb246e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0saXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0sc3RvcFByb3BhZ2F0aW9uOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaX19LHBhZ2VYOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gc319LHBhZ2VZOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYX19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pfSx7fV0sNDc6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiBlLmFwcGx5KHQsYXJndW1lbnRzKX19ZnVuY3Rpb24gcihlKXtmdW5jdGlvbiB0KCl7dmFyIHQ9dGhpcyxzPWFyZ3VtZW50cyxhPURhdGUubm93KCksbD0hMTtyLmxhc3RDYWxsVGhyb3R0bGVkPSEwLG98fChvPWEsbD0hMCk7dmFyIHU9bi0oYS1vKTtyZXR1cm4gbD8oci5sYXN0Q2FsbFRocm90dGxlZD0hMSxlLmFwcGx5KHRoaXMscykpOihpJiZjbGVhclRpbWVvdXQoaSksaT1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ci5sYXN0Q2FsbFRocm90dGxlZD0hMSxlLmFwcGx5KHQscyksbz0wLGk9dm9pZCAwfSx1KSkscn12YXIgbj12b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOjIwMCxvPTAscj17bGFzdENhbGxUaHJvdHRsZWQ6ITB9LGk9bnVsbDtyZXR1cm4gdH1mdW5jdGlvbiBpKGUpe2Z1bmN0aW9uIHQoKXthPWl9ZnVuY3Rpb24gbigpe3JldHVybiBhPyhhLS0sZS5hcHBseSh0aGlzLGFyZ3VtZW50cykpOnMuYXBwbHkodGhpcyxhcmd1bWVudHMpfXZhciBvPXZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06MjAwLGk9dm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXToxMCxzPXIoZSxvKSxhPWk7cmV0dXJuIG4uY2xlYXJIaXRzPXQsbn1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtwcm94eTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSx0aHJvdHRsZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHJ9fSx0aHJvdHRsZUFmdGVySGl0czp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGl9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KX0se31dLDQ4OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSl7c3dpdGNoKHR5cGVvZiBlKXtjYXNlInN0cmluZyI6Y2FzZSJudW1iZXIiOnJldHVybiBlKyIiO2Nhc2Uib2JqZWN0IjpyZXR1cm4gbnVsbD09PWU/IiI6ZS50b1N0cmluZygpO2Nhc2UidW5kZWZpbmVkIjpyZXR1cm4iIjtkZWZhdWx0OnJldHVybiBlLnRvU3RyaW5nKCl9fU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se3N0cmluZ2lmeTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KX0se31dLDQ5OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSl7dmFyIHQ9dHlwZW9mIGU7cmV0dXJuIm51bWJlciI9PXQ/IWlzTmFOKGUpJiZpc0Zpbml0ZShlKToic3RyaW5nIj09dD9lLmxlbmd0aD8xPT1lLmxlbmd0aD8vXGQvLnRlc3QoZSk6L15ccypbKy1dP1xzKig/Oig/OlxkKyg/OlwuXGQrKT8oPzplWystXT9cZCspPyl8KD86MHhbYS1mXGRdKykpXHMqJC9pLnRlc3QoZSk6ITE6Im9iamVjdCI9PXQ/ISghZXx8Im51bWJlciIhPXR5cGVvZiBlLnZhbHVlT2YoKXx8ZSBpbnN0YW5jZW9mIERhdGUpOiExfWZ1bmN0aW9uIHIoZSx0LG4pe3ZhciBvPS0xO2ZvcigiZnVuY3Rpb24iPT10eXBlb2YgdD8obj10LHQ9ZSk6bz1lLTE7KytvPD10JiZuKG8pIT09ITE7KTt9ZnVuY3Rpb24gaShlLHQsbil7dmFyIG89ZSsxO2ZvcigiZnVuY3Rpb24iPT10eXBlb2YgdCYmKG49dCx0PTApOy0tbz49dCYmbihvKSE9PSExOyk7fWZ1bmN0aW9uIHMoZSx0KXtyZXR1cm4gdD1wYXJzZUludCh0LnRvU3RyaW5nKCkucmVwbGFjZSgiJSIsIiIpLDEwKSx0PXBhcnNlSW50KGUqdC8xMDApfU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se2lzTnVtZXJpYzp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxyYW5nZUVhY2g6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0scmFuZ2VFYWNoUmV2ZXJzZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGl9fSx2YWx1ZUFjY29yZGluZ1BlcmNlbnQ6e2dldDpmdW5jdGlvbigpe3JldHVybiBzfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSl9LHt9XSw1MDpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUpe3ZhciB0O3JldHVybiBBcnJheS5pc0FycmF5KGUpP3Q9W106KHQ9e30scChlLGZ1bmN0aW9uKGUsbil7ZSYmIm9iamVjdCI9PXR5cGVvZiBlJiYhQXJyYXkuaXNBcnJheShlKT90W25dPW8oZSk6QXJyYXkuaXNBcnJheShlKT9lLmxlbmd0aCYmIm9iamVjdCI9PXR5cGVvZiBlWzBdJiYhQXJyYXkuaXNBcnJheShlWzBdKT90W25dPVtvKGVbMF0pXTp0W25dPVtdOnRbbl09bnVsbH0pKSx0fWZ1bmN0aW9uIHIoZSx0KXtyZXR1cm4gdC5wcm90b3R5cGUuY29uc3RydWN0b3I9dCxlLnByb3RvdHlwZT1uZXcgdCxlLnByb3RvdHlwZS5jb25zdHJ1Y3Rvcj1lLGV9ZnVuY3Rpb24gaShlLHQpe3JldHVybiBwKHQsZnVuY3Rpb24odCxuKXtlW25dPXR9KSxlfWZ1bmN0aW9uIHMoZSx0KXtwKHQsZnVuY3Rpb24obixvKXt0W29dJiYib2JqZWN0Ij09dHlwZW9mIHRbb10/KGVbb118fChBcnJheS5pc0FycmF5KHRbb10pP2Vbb109W106ZVtvXT17fSkscyhlW29dLHRbb10pKTplW29dPXRbb119KX1mdW5jdGlvbiBhKGUpe3JldHVybiJvYmplY3QiPT10eXBlb2YgZT9KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGUpKTplfWZ1bmN0aW9uIGwoZSl7dmFyIHQ9e307cmV0dXJuIHAoZSxmdW5jdGlvbihlLG4pe3JldHVybiB0W25dPWV9KSx0fWZ1bmN0aW9uIHUoZSl7Zm9yKHZhciB0PVtdLG49MTtuPGFyZ3VtZW50cy5sZW5ndGg7bisrKXRbbi0xXT1hcmd1bWVudHNbbl07cmV0dXJuIGUuTUlYSU5TfHwoZS5NSVhJTlM9W10pLHYodCxmdW5jdGlvbih0KXtlLk1JWElOUy5wdXNoKHQuTUlYSU5fTkFNRSkscCh0LGZ1bmN0aW9uKHQsbil7aWYodm9pZCAwIT09ZS5wcm90b3R5cGVbbl0pdGhyb3cgbmV3IEVycm9yKCJNaXhpbiBjb25mbGljdC4gUHJvcGVydHkgJyIrbisiJyBhbHJlYWR5IGV4aXN0IGFuZCBjYW5ub3QgYmUgb3ZlcndyaXR0ZW4uIik7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQpZS5wcm90b3R5cGVbbl09dDtlbHNle3ZhciBvPWZ1bmN0aW9uKGUsdCl7ZT0iXyIrZTt2YXIgbj1mdW5jdGlvbihlKXtyZXR1cm4oQXJyYXkuaXNBcnJheShlKXx8ZChlKSkmJihlPWEoZSkpLGV9O3JldHVybiBmdW5jdGlvbigpe3JldHVybiB2b2lkIDA9PT10aGlzW2VdJiYodGhpc1tlXT1uKHQpKSx0aGlzW2VdfX0scj1mdW5jdGlvbihlKXtyZXR1cm4gZT0iXyIrZSxmdW5jdGlvbih0KXt0aGlzW2VdPXR9fTtPYmplY3QuZGVmaW5lUHJvcGVydHkoZS5wcm90b3R5cGUsbix7Z2V0Om8obix0KSxzZXQ6cihuKSxjb25maWd1cmFibGU6ITB9KX19KX0pLGV9ZnVuY3Rpb24gYyhlLHQpe3JldHVybiBKU09OLnN0cmluZ2lmeShlKT09PUpTT04uc3RyaW5naWZ5KHQpfWZ1bmN0aW9uIGQoZSl7cmV0dXJuIltvYmplY3QgT2JqZWN0XSI9PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKX1mdW5jdGlvbiBoKGUpe3ZhciB0O2lmKCJvYmplY3QiPT10eXBlb2YgZS5fX3Byb3RvX18pdD1lLl9fcHJvdG9fXztlbHNle3ZhciBuLG89ZS5jb25zdHJ1Y3RvcjsiZnVuY3Rpb24iPT10eXBlb2YgZS5jb25zdHJ1Y3RvciYmKG49byxkZWxldGUgZS5jb25zdHJ1Y3RvciYmKG89ZS5jb25zdHJ1Y3RvcixlLmNvbnN0cnVjdG9yPW4pKSx0PW8/by5wcm90b3R5cGU6bnVsbH1yZXR1cm4gdH1mdW5jdGlvbiBmKGUsdCxuLG8pe28udmFsdWU9bixvLndyaXRhYmxlPW8ud3JpdGFibGUhPT0hMSxvLmVudW1lcmFibGU9by5lbnVtZXJhYmxlIT09ITEsby5jb25maWd1cmFibGU9by5jb25maWd1cmFibGUhPT0hMSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSx0LG8pfWZ1bmN0aW9uIHAoZSx0KXtmb3IodmFyIG4gaW4gZSlpZigoIWUuaGFzT3duUHJvcGVydHl8fGUuaGFzT3duUHJvcGVydHkmJmUuaGFzT3duUHJvcGVydHkobikpJiZ0KGVbbl0sbixlKT09PSExKWJyZWFrO3JldHVybiBlfWZ1bmN0aW9uIGcoZSx0KXt2YXIgbj10LnNwbGl0KCIuIiksbz1lO3JldHVybiBwKG4sZnVuY3Rpb24oZSl7cmV0dXJuIG89b1tlXSx2b2lkIDA9PT1vPyhvPXZvaWQgMCwhMSk6dm9pZCAwfSksb31PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtkdWNrU2NoZW1hOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb319LGluaGVyaXQ6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0sZXh0ZW5kOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaX19LGRlZXBFeHRlbmQ6e2dldDpmdW5jdGlvbigpe3JldHVybiBzfX0sZGVlcENsb25lOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYX19LGNsb25lOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gbH19LG1peGluOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdX19LGlzT2JqZWN0RXF1YWxzOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gY319LGlzT2JqZWN0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZH19LGdldFByb3RvdHlwZU9mOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaH19LGRlZmluZUdldHRlcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGZ9fSxvYmplY3RFYWNoOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gcH19LGdldFByb3BlcnR5OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZ319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBtLHY9KG09ZSgiYXJyYXkiKSxtJiZtLl9fZXNNb2R1bGUmJm18fHsiZGVmYXVsdCI6bX0pLmFycmF5RWFjaH0se2FycmF5OjQyfV0sNTE6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQpe2Z1bmN0aW9uIG4oKXt9aShuLGUpO2Zvcih2YXIgbz0wLHI9dC5sZW5ndGg7cj5vO28rKyluLnByb3RvdHlwZVt0W29dXT12b2lkIDA7cmV0dXJuIG59T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7Y29sdW1uRmFjdG9yeTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgcixpPShyPWUoIm9iamVjdCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuaW5oZXJpdH0se29iamVjdDo1MH1dLDUyOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIGVbMF0udG9VcHBlckNhc2UoKStlLnN1YnN0cigxKX1mdW5jdGlvbiByKGUsdCl7dmFyIG49ITA7cmV0dXJuIGgodC5sZW5ndGgtMSxmdW5jdGlvbihvKXtyZXR1cm4gZS5jaGFyQXQobykhPT10LmNoYXJBdChvKT8obj0hMSwhMSk6dm9pZCAwfSksbn1mdW5jdGlvbiBpKGUsdCl7dmFyIG49ITAsbz10Lmxlbmd0aC0xLHI9ZS5sZW5ndGgtMTtyZXR1cm4gaChvLGZ1bmN0aW9uKGkpe3ZhciBzPXItaSxhPW8taTtyZXR1cm4gZS5jaGFyQXQocykhPT10LmNoYXJBdChhKT8obj0hMSwhMSk6dm9pZCAwfSksbn1mdW5jdGlvbiBzKCl7Zm9yKHZhciBlPVtdLHQ9MDt0PGFyZ3VtZW50cy5sZW5ndGg7dCsrKWVbdF09YXJndW1lbnRzW3RdO2Zvcih2YXIgbj1bXSxvPWUubGVuZ3RoO28tLTspe3ZhciByPWQoZVtvXSkudG9Mb3dlckNhc2UoKTstMT09PW4uaW5kZXhPZihyKSYmbi5wdXNoKHIpfXJldHVybiAxPT09bi5sZW5ndGh9ZnVuY3Rpb24gYSgpe2Z1bmN0aW9uIGUoKXtyZXR1cm4gTWF0aC5mbG9vcig2NTUzNiooMStNYXRoLnJhbmRvbSgpKSkudG9TdHJpbmcoMTYpLnN1YnN0cmluZygxKX1yZXR1cm4gZSgpK2UoKStlKCkrZSgpfWZ1bmN0aW9uIGwoZSl7cmV0dXJuL14oWzAtOV1bMC05XT9cJSQpfCheMTAwXCUkKS8udGVzdChlKX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHt0b1VwcGVyQ2FzZUZpcnN0OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb319LHN0YXJ0c1dpdGg6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0sZW5kc1dpdGg6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0sZXF1YWxzSWdub3JlQ2FzZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHN9fSxyYW5kb21TdHJpbmc6e2dldDpmdW5jdGlvbigpe3JldHVybiBhfX0saXNQZXJjZW50VmFsdWU6e2dldDpmdW5jdGlvbigpe3JldHVybiBsfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHUsYyxkPSh1PWUoIm1peGVkIiksdSYmdS5fX2VzTW9kdWxlJiZ1fHx7ImRlZmF1bHQiOnV9KS5zdHJpbmdpZnksaD0oYz1lKCJudW1iZXIiKSxjJiZjLl9fZXNNb2R1bGUmJmN8fHsiZGVmYXVsdCI6Y30pLnJhbmdlRWFjaH0se21peGVkOjQ4LG51bWJlcjo0OX1dLDUzOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSl7cmV0dXJuIDMyPT1lfHxlPj00OCYmNTc+PWV8fGU+PTk2JiYxMTE+PWV8fGU+PTE4NiYmMTkyPj1lfHxlPj0yMTkmJjIyMj49ZXx8ZT49MjI2fHxlPj02NSYmOTA+PWV9ZnVuY3Rpb24gcihlKXt2YXIgdD1bdS5BUlJPV19ET1dOLHUuQVJST1dfVVAsdS5BUlJPV19MRUZULHUuQVJST1dfUklHSFQsdS5IT01FLHUuRU5ELHUuREVMRVRFLHUuQkFDS1NQQUNFLHUuRjEsdS5GMix1LkYzLHUuRjQsdS5GNSx1LkY2LHUuRjcsdS5GOCx1LkY5LHUuRjEwLHUuRjExLHUuRjEyLHUuVEFCLHUuUEFHRV9ET1dOLHUuUEFHRV9VUCx1LkVOVEVSLHUuRVNDQVBFLHUuU0hJRlQsdS5DQVBTX0xPQ0ssdS5BTFRdO3JldHVybi0xIT09dC5pbmRleE9mKGUpfWZ1bmN0aW9uIGkoZSl7cmV0dXJuLTEhPT1bdS5DT05UUk9MX0xFRlQsMjI0LHUuQ09NTUFORF9MRUZULHUuQ09NTUFORF9SSUdIVF0uaW5kZXhPZihlKX1mdW5jdGlvbiBzKGUsdCl7dmFyIG49dC5zcGxpdCgifCIpLG89ITE7cmV0dXJuIGwobixmdW5jdGlvbih0KXtyZXR1cm4gZT09PXVbdF0/KG89ITAsITEpOnZvaWQgMH0pLG99T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7S0VZX0NPREVTOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdX19LGlzUHJpbnRhYmxlQ2hhcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxpc01ldGFLZXk6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0saXNDdHJsS2V5OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gaX19LGlzS2V5OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gc319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBhLGw9KGE9ZSgiYXJyYXkiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLmFycmF5RWFjaCx1PXtNT1VTRV9MRUZUOjEsTU9VU0VfUklHSFQ6MyxNT1VTRV9NSURETEU6MixCQUNLU1BBQ0U6OCxDT01NQToxODgsSU5TRVJUOjQ1LERFTEVURTo0NixFTkQ6MzUsRU5URVI6MTMsRVNDQVBFOjI3LENPTlRST0xfTEVGVDo5MSxDT01NQU5EX0xFRlQ6MTcsQ09NTUFORF9SSUdIVDo5MyxBTFQ6MTgsSE9NRTozNixQQUdFX0RPV046MzQsUEFHRV9VUDozMyxQRVJJT0Q6MTkwLFNQQUNFOjMyLFNISUZUOjE2LENBUFNfTE9DSzoyMCxUQUI6OSxBUlJPV19SSUdIVDozOSxBUlJPV19MRUZUOjM3LEFSUk9XX1VQOjM4LEFSUk9XX0RPV046NDAsRjE6MTEyLEYyOjExMyxGMzoxMTQsRjQ6MTE1LEY1OjExNixGNjoxMTcsRjc6MTE4LEY4OjExOSxGOToxMjAsRjEwOjEyMSxGMTE6MTIyLEYxMjoxMjMsQTo2NSxYOjg4LEM6NjcsVjo4Nn19LHthcnJheTo0Mn1dLDU0OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se2xvY2FsSG9va3M6e2dldDpmdW5jdGlvbigpe3JldHVybiBsfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpPShvPWUoImhlbHBlcnMvYXJyYXkiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLmFycmF5RWFjaCxzPShyPWUoImhlbHBlcnMvb2JqZWN0IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5kZWZpbmVHZXR0ZXIsYT0ibG9jYWxIb29rcyIsbD17X2xvY2FsSG9va3M6T2JqZWN0LmNyZWF0ZShudWxsKSxhZGRMb2NhbEhvb2s6ZnVuY3Rpb24oZSx0KXt0aGlzLl9sb2NhbEhvb2tzW2VdfHwodGhpcy5fbG9jYWxIb29rc1tlXT1bXSksdGhpcy5fbG9jYWxIb29rc1tlXS5wdXNoKHQpfSxydW5Mb2NhbEhvb2tzOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD1bXSxuPTE7bjxhcmd1bWVudHMubGVuZ3RoO24rKyl0W24tMV09YXJndW1lbnRzW25dO3ZhciBvPXRoaXM7dGhpcy5fbG9jYWxIb29rc1tlXSYmaSh0aGlzLl9sb2NhbEhvb2tzW2VdLGZ1bmN0aW9uKGUpe3JldHVybiBlLmFwcGx5KG8sdCl9KX0sY2xlYXJMb2NhbEhvb2tzOmZ1bmN0aW9uKCl7dGhpcy5fbG9jYWxIb29rcz17fX19O3MobCwiTUlYSU5fTkFNRSIsYSx7d3JpdGFibGU6ITEsZW51bWVyYWJsZTohMX0pLEhhbmRzb250YWJsZS51dGlscz1IYW5kc29udGFibGUudXRpbHN8fHt9LEhhbmRzb250YWJsZS51dGlscy5sb2NhbEhvb2tzPWx9LHsiaGVscGVycy9hcnJheSI6NDIsImhlbHBlcnMvb2JqZWN0Ijo1MH1dLDU1OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oKXtmdW5jdGlvbiBlKGUpe3JldHVybiBudWxsIT09ZSYmIW4oZSkmJigic3RyaW5nIj09dHlwZW9mIGV8fCJudW1iZXIiPT10eXBlb2YgZSl9ZnVuY3Rpb24gdChlKXtyZXR1cm4gbnVsbCE9PWUmJigib2JqZWN0Ij09dHlwZW9mIGV8fCJmdW5jdGlvbiI9PXR5cGVvZiBlKX1mdW5jdGlvbiBuKGUpe3JldHVybiBlIT09ZX12YXIgbz17YXJyYXlNYXA6W10sd2Vha01hcDpuZXcgV2Vha01hcH07cmV0dXJue2dldDpmdW5jdGlvbihuKXtyZXR1cm4gZShuKT9vLmFycmF5TWFwW25dOnQobik/by53ZWFrTWFwLmdldChuKTp2b2lkIDB9LHNldDpmdW5jdGlvbihuLHIpe2lmKGUobikpby5hcnJheU1hcFtuXT1yO2Vsc2V7aWYoIXQobikpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGtleSB0eXBlIik7by53ZWFrTWFwLnNldChuLHIpfX0sImRlbGV0ZSI6ZnVuY3Rpb24obil7ZShuKT9kZWxldGUgby5hcnJheU1hcFtuXTp0KG4pJiZvLndlYWtNYXBbImRlbGV0ZSJdKG4pfX19T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7TXVsdGlNYXA6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSksd2luZG93Lk11bHRpTWFwPW99LHt9XSw1NjpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtIb29rczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGx9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGk9WyJhZnRlckNlbGxNZXRhUmVzZXQiLCJhZnRlckNoYW5nZSIsImFmdGVyQ2hhbmdlc09ic2VydmVkIiwiYWZ0ZXJDb2x1bW5Nb3ZlIiwiYWZ0ZXJDb2x1bW5SZXNpemUiLCJhZnRlckNvbnRleHRNZW51RGVmYXVsdE9wdGlvbnMiLCJhZnRlckNvbnRleHRNZW51SGlkZSIsImFmdGVyQ29udGV4dE1lbnVTaG93IiwiYWZ0ZXJDb3B5TGltaXQiLCJhZnRlckNyZWF0ZUNvbCIsImFmdGVyQ3JlYXRlUm93IiwiYWZ0ZXJEZXNlbGVjdCIsImFmdGVyRGVzdHJveSIsImFmdGVyRG9jdW1lbnRLZXlEb3duIiwiYWZ0ZXJHZXRDZWxsTWV0YSIsImFmdGVyR2V0Q29sSGVhZGVyIiwiYWZ0ZXJHZXRSb3dIZWFkZXIiLCJhZnRlckluaXQiLCJhZnRlcklzTXVsdGlwbGVTZWxlY3Rpb25DaGVjayIsImFmdGVyTG9hZERhdGEiLCJhZnRlck1vbWVudHVtU2Nyb2xsIiwiYWZ0ZXJPbkNlbGxDb3JuZXJNb3VzZURvd24iLCJhZnRlck9uQ2VsbE1vdXNlRG93biIsImFmdGVyT25DZWxsTW91c2VPdmVyIiwiYWZ0ZXJSZW1vdmVDb2wiLCJhZnRlclJlbW92ZVJvdyIsImFmdGVyUmVuZGVyIiwiYWZ0ZXJSZW5kZXJlciIsImFmdGVyU2Nyb2xsSG9yaXpvbnRhbGx5IiwiYWZ0ZXJTY3JvbGxWZXJ0aWNhbGx5IiwiYWZ0ZXJTZWxlY3Rpb24iLCJhZnRlclNlbGVjdGlvbkJ5UHJvcCIsImFmdGVyU2VsZWN0aW9uRW5kIiwiYWZ0ZXJTZWxlY3Rpb25FbmRCeVByb3AiLCJhZnRlclNldENlbGxNZXRhIiwiYWZ0ZXJVcGRhdGVTZXR0aW5ncyIsImFmdGVyVmFsaWRhdGUiLCJiZWZvcmVBdXRvZmlsbCIsImJlZm9yZUNlbGxBbGlnbm1lbnQiLCJiZWZvcmVDaGFuZ2UiLCJiZWZvcmVDaGFuZ2VSZW5kZXIiLCJiZWZvcmVEcmF3Qm9yZGVycyIsImJlZm9yZUdldENlbGxNZXRhIiwiYmVmb3JlSW5pdCIsImJlZm9yZUluaXRXYWxrb250YWJsZSIsImJlZm9yZUtleURvd24iLCJiZWZvcmVPbkNlbGxNb3VzZURvd24iLCJiZWZvcmVSZW1vdmVDb2wiLCJiZWZvcmVSZW1vdmVSb3ciLCJiZWZvcmVSZW5kZXIiLCJiZWZvcmVTZXRSYW5nZUVuZCIsImJlZm9yZVRvdWNoU2Nyb2xsIiwiYmVmb3JlVmFsaWRhdGUiLCJjb25zdHJ1Y3QiLCJpbml0IiwibW9kaWZ5Q29sIiwibW9kaWZ5Q29sdW1uSGVhZGVyIiwibW9kaWZ5Q29sV2lkdGgiLCJtb2RpZnlSb3ciLCJtb2RpZnlSb3dIZWFkZXIiLCJtb2RpZnlSb3dIZWlnaHQiLCJwZXJzaXN0ZW50U3RhdGVMb2FkIiwicGVyc2lzdGVudFN0YXRlUmVzZXQiLCJwZXJzaXN0ZW50U3RhdGVTYXZlIiwiYmVmb3JlQ29sdW1uU29ydCIsImFmdGVyQ29sdW1uU29ydCIsImFmdGVyQXV0b2ZpbGxBcHBseVZhbHVlcyIsIm1vZGlmeUNvcHlhYmxlUmFuZ2UiLCJiZWZvcmVDb2x1bW5Nb3ZlIiwiYWZ0ZXJDb2x1bW5Nb3ZlIiwiYmVmb3JlUm93TW92ZSIsImFmdGVyUm93TW92ZSIsImJlZm9yZUNvbHVtblJlc2l6ZSIsImFmdGVyQ29sdW1uUmVzaXplIiwiYmVmb3JlUm93UmVzaXplIiwiYWZ0ZXJSb3dSZXNpemUiXSxzPShvPWUoImhlbHBlcnMvYXJyYXkiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLmFycmF5RWFjaCxhPShyPWUoImhlbHBlcnMvb2JqZWN0IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5vYmplY3RFYWNoLGw9ZnVuY3Rpb24oKXt0aGlzLmdsb2JhbEJ1Y2tldD10aGlzLmNyZWF0ZUVtcHR5QnVja2V0KCl9OyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhsLHtjcmVhdGVFbXB0eUJ1Y2tldDpmdW5jdGlvbigpe3ZhciBlPU9iamVjdC5jcmVhdGUobnVsbCk7cmV0dXJuIHMoaSxmdW5jdGlvbih0KXtyZXR1cm4gZVt0XT1bXX0pLGV9LGdldEJ1Y2tldDpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06bnVsbDtyZXR1cm4gZT8oZS5wbHVnaW5Ib29rQnVja2V0fHwoZS5wbHVnaW5Ib29rQnVja2V0PXRoaXMuY3JlYXRlRW1wdHlCdWNrZXQoKSksZS5wbHVnaW5Ib29rQnVja2V0KTp0aGlzLmdsb2JhbEJ1Y2tldH0sYWRkOmZ1bmN0aW9uKGUsdCl7dmFyIG49dm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTpudWxsLG89dGhpcztpZihBcnJheS5pc0FycmF5KHQpKXModCxmdW5jdGlvbih0KXtyZXR1cm4gby5hZGQoZSx0LG4pfSk7ZWxzZXt2YXIgcj10aGlzLmdldEJ1Y2tldChuKTsidW5kZWZpbmVkIj09dHlwZW9mIHJbZV0mJih0aGlzLnJlZ2lzdGVyKGUpLHJbZV09W10pLHQuc2tpcD0hMSwtMT09PXJbZV0uaW5kZXhPZih0KSYmcltlXS5wdXNoKHQpfXJldHVybiB0aGlzfSxvbmNlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTpudWxsLG89dGhpcztBcnJheS5pc0FycmF5KHQpP3ModCxmdW5jdGlvbih0KXtyZXR1cm4gby5vbmNlKGUsdCxuKX0pOih0LnJ1bk9uY2U9ITAsdGhpcy5hZGQoZSx0LG4pKX0scmVtb3ZlOmZ1bmN0aW9uKGUsdCl7dmFyIG49dm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTpudWxsLG89dGhpcy5nZXRCdWNrZXQobik7cmV0dXJuInVuZGVmaW5lZCIhPXR5cGVvZiBvW2VdJiZvW2VdLmluZGV4T2YodCk+PTA/KHQuc2tpcD0hMCwhMCk6ITF9LGhhczpmdW5jdGlvbihlKXt2YXIgdD12b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOm51bGwsbj10aGlzLmdldEJ1Y2tldCh0KTtyZXR1cm4gdm9pZCAwIT09bltlXSYmbltlXS5sZW5ndGg/ITA6ITF9LHJ1bjpmdW5jdGlvbihlLHQsbixvLHIsaSxzLGEpe3ZhciBsPXRoaXMuZ2xvYmFsQnVja2V0W3RdLHU9LTEsYz1sP2wubGVuZ3RoOjA7aWYoYylmb3IoOysrdTxjOylpZihsW3VdJiYhbFt1XS5za2lwKXt2YXIgZD1sW3VdLmNhbGwoZSxuLG8scixpLHMsYSk7dm9pZCAwIT09ZCYmKG49ZCksbFt1XSYmbFt1XS5ydW5PbmNlJiZ0aGlzLnJlbW92ZSh0LGxbdV0pfXZhciBoPXRoaXMuZ2V0QnVja2V0KGUpW3RdLGY9LTEscD1oP2gubGVuZ3RoOjA7aWYocClmb3IoOysrZjxwOylpZihoW2ZdJiYhaFtmXS5za2lwKXt2YXIgZz1oW2ZdLmNhbGwoZSxuLG8scixpLHMsYSk7dm9pZCAwIT09ZyYmKG49ZyksaFtmXSYmaFtmXS5ydW5PbmNlJiZ0aGlzLnJlbW92ZSh0LGhbZl0sZSl9cmV0dXJuIG59LGRlc3Ryb3k6ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOm51bGw7YSh0aGlzLmdldEJ1Y2tldChlKSxmdW5jdGlvbihlLHQsbil7cmV0dXJuIG5bdF0ubGVuZ3RoPTB9KX0scmVnaXN0ZXI6ZnVuY3Rpb24oZSl7dGhpcy5pc1JlZ2lzdGVyZWQoZSl8fGkucHVzaChlKX0sZGVyZWdpc3RlcjpmdW5jdGlvbihlKXt0aGlzLmlzUmVnaXN0ZXJlZChlKSYmaS5zcGxpY2UoaS5pbmRleE9mKGUpLDEpfSxpc1JlZ2lzdGVyZWQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGkuaW5kZXhPZihlKT49MH0sZ2V0UmVnaXN0ZXJlZDpmdW5jdGlvbigpe3JldHVybiBpfX0se30pLEhhbmRzb250YWJsZS51dGlscz1IYW5kc29udGFibGUudXRpbHN8fHt9LEhhbmRzb250YWJsZS51dGlscy5Ib29rcz1sfSx7ImhlbHBlcnMvYXJyYXkiOjQyLCJoZWxwZXJzL29iamVjdCI6NTB9XSw1NzpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUsdCl7ZT1jKGUpLEhhbmRzb250YWJsZS5wbHVnaW5zW2VdPXQsSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiY29uc3RydWN0IixmdW5jdGlvbigpe3ZhciBuO2QuaGFzKHRoaXMpfHxkLnNldCh0aGlzLHt9KSxuPWQuZ2V0KHRoaXMpLG5bZV18fChuW2VdPW5ldyB0KHRoaXMpKX0pLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyRGVzdHJveSIsZnVuY3Rpb24oKXtpZihkLmhhcyh0aGlzKSl7dmFyIGU9ZC5nZXQodGhpcyk7dShlLGZ1bmN0aW9uKGUpe3JldHVybiBlLmRlc3Ryb3koKX0pLGRbImRlbGV0ZSJdKHRoaXMpfX0pfWZ1bmN0aW9uIHIoZSx0KXtpZigic3RyaW5nIiE9dHlwZW9mIHQpdGhyb3cgRXJyb3IoJ09ubHkgc3RyaW5ncyBjYW4gYmUgcGFzc2VkIGFzICJwbHVnaW4iIHBhcmFtZXRlcicpO3ZhciBuPWModCk7aWYoZC5oYXMoZSkmJmQuZ2V0KGUpW25dKXJldHVybiBkLmdldChlKVtuXX1mdW5jdGlvbiBpKGUpe3JldHVybiBkLmhhcyhlKT9PYmplY3Qua2V5cyhkLmdldChlKSk6W119ZnVuY3Rpb24gcyhlLHQpe3ZhciBuPW51bGw7cmV0dXJuIGQuaGFzKGUpJiZ1KGQuZ2V0KGUpLGZ1bmN0aW9uKGUsbyl7ZT09PXQmJihuPW8pfSksbn1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtyZWdpc3RlclBsdWdpbjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxnZXRQbHVnaW46e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0sZ2V0UmVnaXN0cmVkUGx1Z2luTmFtZXM6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0sZ2V0UGx1Z2luTmFtZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHN9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgYSxsLHU9KGE9ZSgiaGVscGVycy9vYmplY3QiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLm9iamVjdEVhY2gsYz0obD1lKCJoZWxwZXJzL3N0cmluZyIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSkudG9VcHBlckNhc2VGaXJzdCxkPW5ldyBXZWFrTWFwO0hhbmRzb250YWJsZS5wbHVnaW5zPUhhbmRzb250YWJsZS5wbHVnaW5zfHx7fSxIYW5kc29udGFibGUucGx1Z2lucy51dGlscz1IYW5kc29udGFibGUucGx1Z2lucy51dGlsc3x8e30sSGFuZHNvbnRhYmxlLnBsdWdpbnMucmVnaXN0ZXJQbHVnaW49b30seyJoZWxwZXJzL29iamVjdCI6NTAsImhlbHBlcnMvc3RyaW5nIjo1Mn1dLDU4OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4seyJkZWZhdWx0Ijp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG19fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscz0obz1lKCJoZWxwZXJzL29iamVjdCIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSksYT1zLmRlZmluZUdldHRlcixsPXMub2JqZWN0RWFjaCx1PShyPWUoImhlbHBlcnMvYXJyYXkiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLmFycmF5RWFjaCxjPShpPWUoInBsdWdpbnMiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLGQ9Yy5nZXRSZWdpc3RyZWRQbHVnaW5OYW1lcyxoPWMuZ2V0UGx1Z2luTmFtZSxmPW5ldyBXZWFrTWFwLHA9bnVsbCxnPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7YSh0aGlzLCJob3QiLGUse3dyaXRhYmxlOiExfSksZi5zZXQodGhpcyx7aG9va3M6e319KSxwPW51bGwsdGhpcy5wbHVnaW5OYW1lPW51bGwsdGhpcy5wbHVnaW5zSW5pdGlhbGl6ZWRDYWxsYmFja3M9W10sdGhpcy5pc1BsdWdpbnNSZWFkeT0hMSx0aGlzLmVuYWJsZWQ9ITEsdGhpcy5pbml0aWFsaXplZD0hMSx0aGlzLmhvdC5hZGRIb29rKCJhZnRlclBsdWdpbnNJbml0aWFsaXplZCIsZnVuY3Rpb24oKXtyZXR1cm4gdC5vbkFmdGVyUGx1Z2luc0luaXRpYWxpemVkKCl9KSx0aGlzLmhvdC5hZGRIb29rKCJhZnRlclVwZGF0ZVNldHRpbmdzIixmdW5jdGlvbigpe3JldHVybiB0Lm9uVXBkYXRlU2V0dGluZ3MoKX0pLHRoaXMuaG90LmFkZEhvb2soImJlZm9yZUluaXQiLGZ1bmN0aW9uKCl7cmV0dXJuIHQuaW5pdCgpfSl9OyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhnLHtpbml0OmZ1bmN0aW9uKCl7dGhpcy5wbHVnaW5OYW1lPWgodGhpcy5ob3QsdGhpcyksdGhpcy5pc0VuYWJsZWQmJnRoaXMuaXNFbmFibGVkKCkmJnRoaXMuZW5hYmxlUGx1Z2luKCkscHx8KHA9ZCh0aGlzLmhvdCkpLHAuaW5kZXhPZih0aGlzLnBsdWdpbk5hbWUpPj0wJiZwLnNwbGljZShwLmluZGV4T2YodGhpcy5wbHVnaW5OYW1lKSwxKSxwLmxlbmd0aHx8dGhpcy5ob3QucnVuSG9va3MoImFmdGVyUGx1Z2luc0luaXRpYWxpemVkIiksdGhpcy5pbml0aWFsaXplZD0hMH0sZW5hYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dGhpcy5lbmFibGVkPSEwfSxkaXNhYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dGhpcy5ldmVudE1hbmFnZXImJnRoaXMuZXZlbnRNYW5hZ2VyLmNsZWFyKCksdGhpcy5jbGVhckhvb2tzKCksdGhpcy5lbmFibGVkPSExfSxhZGRIb29rOmZ1bmN0aW9uKGUsdCl7dmFyIG49Zi5nZXQodGhpcykuaG9va3NbZV09Zi5nZXQodGhpcykuaG9va3NbZV18fFtdO3RoaXMuaG90LmFkZEhvb2soZSx0KSxuLnB1c2godCksZi5nZXQodGhpcykuaG9va3NbZV09bn0scmVtb3ZlSG9va3M6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpczt1KGYuZ2V0KHRoaXMpLmhvb2tzW2VdfHxbXSxmdW5jdGlvbihuKXt0LmhvdC5yZW1vdmVIb29rKGUsbil9KX0sY2xlYXJIb29rczpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD1mLmdldCh0aGlzKS5ob29rcztsKHQsZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5yZW1vdmVIb29rcyhuKX0pLHQubGVuZ3RoPTB9LGNhbGxPblBsdWdpbnNSZWFkeTpmdW5jdGlvbihlKXt0aGlzLmlzUGx1Z2luc1JlYWR5P2UoKTp0aGlzLnBsdWdpbnNJbml0aWFsaXplZENhbGxiYWNrcy5wdXNoKGUpfSxvbkFmdGVyUGx1Z2luc0luaXRpYWxpemVkOmZ1bmN0aW9uKCl7dSh0aGlzLnBsdWdpbnNJbml0aWFsaXplZENhbGxiYWNrcyxmdW5jdGlvbihlKXtyZXR1cm4gZSgpfSksdGhpcy5wbHVnaW5zSW5pdGlhbGl6ZWRDYWxsYmFja3MubGVuZ3RoPTAsdGhpcy5pc1BsdWdpbnNSZWFkeT0hMH0sb25VcGRhdGVTZXR0aW5nczpmdW5jdGlvbigpe3RoaXMuaXNFbmFibGVkJiYodGhpcy5lbmFibGVkJiYhdGhpcy5pc0VuYWJsZWQoKSYmdGhpcy5kaXNhYmxlUGx1Z2luKCksIXRoaXMuZW5hYmxlZCYmdGhpcy5pc0VuYWJsZWQoKSYmdGhpcy5lbmFibGVQbHVnaW4oKSx0aGlzLmVuYWJsZWQmJnRoaXMuaXNFbmFibGVkKCkmJnRoaXMudXBkYXRlUGx1Z2luKCkpfSx1cGRhdGVQbHVnaW46ZnVuY3Rpb24oKXt9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3RoaXMuZXZlbnRNYW5hZ2VyJiZ0aGlzLmV2ZW50TWFuYWdlci5kZXN0cm95KCksdGhpcy5jbGVhckhvb2tzKCksbCh0aGlzLGZ1bmN0aW9uKHQsbil7ImhvdCIhPT1uJiYoZVtuXT1udWxsKX0pLGRlbGV0ZSB0aGlzLmhvdH19LHt9KTt2YXIgbT1nO0hhbmRzb250YWJsZS5wbHVnaW5zLkJhc2VQbHVnaW49Z30seyJoZWxwZXJzL2FycmF5Ijo0MiwiaGVscGVycy9vYmplY3QiOjUwLHBsdWdpbnM6NTd9XSw1OTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtBdXRvQ29sdW1uU2l6ZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIER9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscyxhLGwsdSxjLGQsaCxmPShvPWUoIl9iYXNlIiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KVsiZGVmYXVsdCJdLHA9KHI9ZSgiaGVscGVycy9hcnJheSIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksZz1wLmFycmF5RWFjaCxtPXAuYXJyYXlGaWx0ZXIsdj0oaT1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KSx3PXYuY2FuY2VsQW5pbWF0aW9uRnJhbWUseT12LnJlcXVlc3RBbmltYXRpb25GcmFtZSxiPXYuaXNWaXNpYmxlLEM9KHM9ZSgidXRpbHMvZ2hvc3RUYWJsZSIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkuR2hvc3RUYWJsZSxSPShhPWUoImhlbHBlcnMvb2JqZWN0IiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KSxfPVIuaXNPYmplY3QsUz0oUi5vYmplY3RFYWNoLGw9ZSgiaGVscGVycy9udW1iZXIiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLEU9Uy52YWx1ZUFjY29yZGluZ1BlcmNlbnQsVD1TLnJhbmdlRWFjaCxPPSh1PWUoInBsdWdpbnMiKSx1JiZ1Ll9fZXNNb2R1bGUmJnV8fHsiZGVmYXVsdCI6dX0pLnJlZ2lzdGVyUGx1Z2luLE09KGM9ZSgidXRpbHMvc2FtcGxlc0dlbmVyYXRvciIpLGMmJmMuX19lc01vZHVsZSYmY3x8eyJkZWZhdWx0IjpjfSkuU2FtcGxlc0dlbmVyYXRvcixrPShkPWUoImhlbHBlcnMvc3RyaW5nIiksZCYmZC5fX2VzTW9kdWxlJiZkfHx7ImRlZmF1bHQiOmR9KS5pc1BlcmNlbnRWYWx1ZSxIPShoPWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jYWxjdWxhdG9yL3ZpZXdwb3J0Q29sdW1ucyIpLGgmJmguX19lc01vZHVsZSYmaHx8eyJkZWZhdWx0IjpofSkuV2Fsa29udGFibGVWaWV3cG9ydENvbHVtbnNDYWxjdWxhdG9yLEQ9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpczskdHJhY2V1clJ1bnRpbWUuc3VwZXJDb25zdHJ1Y3Rvcih4KS5jYWxsKHRoaXMsZSksdGhpcy53aWR0aHM9W10sdGhpcy5naG9zdFRhYmxlPW5ldyBDKHRoaXMuaG90KSx0aGlzLnNhbXBsZXNHZW5lcmF0b3I9bmV3IE0oZnVuY3Rpb24oZSxuKXtyZXR1cm4gdC5ob3QuZ2V0RGF0YUF0Q2VsbChlLG4pfSksdGhpcy5maXJzdENhbGN1bGF0aW9uPSEwLHRoaXMuaW5Qcm9ncmVzcz0hMSx0aGlzLmFkZEhvb2soImJlZm9yZUNvbHVtblJlc2l6ZSIsZnVuY3Rpb24oZSxuLG8pe3JldHVybiB0Lm9uQmVmb3JlQ29sdW1uUmVzaXplKGUsbixvKX0pfSx4PUQ7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKEQse2lzRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmhvdC5nZXRTZXR0aW5ncygpLmF1dG9Db2x1bW5TaXplIT09ITEmJiF0aGlzLmhvdC5nZXRTZXR0aW5ncygpLmNvbFdpZHRoc30sZW5hYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmVuYWJsZWR8fCh0aGlzLmFkZEhvb2soImFmdGVyTG9hZERhdGEiLGZ1bmN0aW9uKCl7cmV0dXJuIGUub25BZnRlckxvYWREYXRhKCl9KSx0aGlzLmFkZEhvb2soImJlZm9yZUNoYW5nZSIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25CZWZvcmVDaGFuZ2UodCl9KSx0aGlzLmFkZEhvb2soImJlZm9yZVJlbmRlciIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25CZWZvcmVSZW5kZXIodCl9KSx0aGlzLmFkZEhvb2soIm1vZGlmeUNvbFdpZHRoIixmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENvbHVtbldpZHRoKG4sdCl9KSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyx4LnByb3RvdHlwZSwiZW5hYmxlUGx1Z2luIikuY2FsbCh0aGlzKSl9LGRpc2FibGVQbHVnaW46ZnVuY3Rpb24oKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyx4LnByb3RvdHlwZSwiZGlzYWJsZVBsdWdpbiIpLmNhbGwodGhpcyl9LGNhbGN1bGF0ZUNvbHVtbnNXaWR0aDpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06e2Zyb206MCx0bzp0aGlzLmhvdC5jb3VudENvbHMoKS0xfSx0PXZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e2Zyb206MCx0bzp0aGlzLmhvdC5jb3VudFJvd3MoKS0xfSxuPXZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06ITEsbz10aGlzOyJudW1iZXIiPT10eXBlb2YgZSYmKGU9e2Zyb206ZSx0bzplfSksIm51bWJlciI9PXR5cGVvZiB0JiYodD17ZnJvbTp0LHRvOnR9KSxUKGUuZnJvbSxlLnRvLGZ1bmN0aW9uKGUpe2lmKG58fHZvaWQgMD09PW8ud2lkdGhzW2VdJiYhby5ob3QuX2dldENvbFdpZHRoRnJvbVNldHRpbmdzKGUpKXt2YXIgcj1vLnNhbXBsZXNHZW5lcmF0b3IuZ2VuZXJhdGVDb2x1bW5TYW1wbGVzKGUsdCk7ci5mb3JFYWNoKGZ1bmN0aW9uKGUsdCl7cmV0dXJuIG8uZ2hvc3RUYWJsZS5hZGRDb2x1bW4odCxlKX0pfX0pLHRoaXMuZ2hvc3RUYWJsZS5jb2x1bW5zLmxlbmd0aCYmKHRoaXMuZ2hvc3RUYWJsZS5nZXRXaWR0aHMoZnVuY3Rpb24oZSx0KXtyZXR1cm4gby53aWR0aHNbZV09dH0pLHRoaXMuZ2hvc3RUYWJsZS5jbGVhbigpKX0sY2FsY3VsYXRlQWxsQ29sdW1uc1dpZHRoOmZ1bmN0aW9uKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTp7ZnJvbTowLHRvOnRoaXMuaG90LmNvdW50Um93cygpLTF9LHQ9dGhpcyxuPTAsbz10aGlzLmhvdC5jb3VudENvbHMoKS0xLHI9bnVsbDt0aGlzLmluUHJvZ3Jlc3M9ITA7dmFyIGk9ZnVuY3Rpb24oKXtyZXR1cm4gdC5ob3Q/KHQuY2FsY3VsYXRlQ29sdW1uc1dpZHRoKHtmcm9tOm4sdG86TWF0aC5taW4obit4LkNBTENVTEFUSU9OX1NURVAsbyl9LGUpLG49bit4LkNBTENVTEFUSU9OX1NURVArMSx2b2lkKG8+bj9yPXkoaSk6KHcociksdC5pblByb2dyZXNzPSExLHQuaG90LnZpZXcud3Qud3RPdmVybGF5cy5hZGp1c3RFbGVtZW50c1NpemUoITApLHQuaG90LnZpZXcud3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5uZWVkRnVsbFJlbmRlciYmdC5ob3Qudmlldy53dC53dE92ZXJsYXlzLmxlZnRPdmVybGF5LmNsb25lLmRyYXcoKSkpKToodyhyKSx2b2lkKHQuaW5Qcm9ncmVzcz0hMSkpfTt0aGlzLmZpcnN0Q2FsY3VsYXRpb24mJnRoaXMuZ2V0U3luY0NhbGN1bGF0aW9uTGltaXQoKSYmKHRoaXMuY2FsY3VsYXRlQ29sdW1uc1dpZHRoKHtmcm9tOjAsdG86dGhpcy5nZXRTeW5jQ2FsY3VsYXRpb25MaW1pdCgpfSxlKSx0aGlzLmZpcnN0Q2FsY3VsYXRpb249ITEsbj10aGlzLmdldFN5bmNDYWxjdWxhdGlvbkxpbWl0KCkrMSksbz5uP2koKTp0aGlzLmluUHJvZ3Jlc3M9ITF9LHJlY2FsY3VsYXRlQWxsQ29sdW1uc1dpZHRoOmZ1bmN0aW9uKCl7dGhpcy5ob3QudmlldyYmYih0aGlzLmhvdC52aWV3Lnd0Lnd0VGFibGUuVEFCTEUpJiYodGhpcy5jbGVhckNhY2hlKCksdGhpcy5jYWxjdWxhdGVBbGxDb2x1bW5zV2lkdGgoKSl9LGdldFN5bmNDYWxjdWxhdGlvbkxpbWl0OmZ1bmN0aW9uKCl7dmFyIGU9eC5TWU5DX0NBTENVTEFUSU9OX0xJTUlULHQ9dGhpcy5ob3QuY291bnRDb2xzKCktMTtyZXR1cm4gXyh0aGlzLmhvdC5nZXRTZXR0aW5ncygpLmF1dG9Db2x1bW5TaXplKSYmKGU9dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5hdXRvQ29sdW1uU2l6ZS5zeW5jTGltaXQsayhlKT9lPUUodCxlKTplPj49MCksTWF0aC5taW4oZSx0KX0sZ2V0Q29sdW1uV2lkdGg6ZnVuY3Rpb24oZSl7dmFyIHQ9YXJndW1lbnRzWzFdLG49dm9pZCAwIT09YXJndW1lbnRzWzJdP2FyZ3VtZW50c1syXTohMCxvPXQ7cmV0dXJuIHZvaWQgMD09PW8mJihvPXRoaXMud2lkdGhzW2VdLG4mJiJudW1iZXIiPT10eXBlb2YgbyYmKG89TWF0aC5tYXgobyxILkRFRkFVTFRfV0lEVEgpKSksb30sZ2V0Rmlyc3RWaXNpYmxlQ29sdW1uOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3Qudmlldy53dDtyZXR1cm4gZS53dFZpZXdwb3J0LmNvbHVtbnNWaXNpYmxlQ2FsY3VsYXRvcj9lLnd0VGFibGUuZ2V0Rmlyc3RWaXNpYmxlQ29sdW1uKCk6ZS53dFZpZXdwb3J0LmNvbHVtbnNSZW5kZXJDYWxjdWxhdG9yP2Uud3RUYWJsZS5nZXRGaXJzdFJlbmRlcmVkQ29sdW1uKCk6LTF9LGdldExhc3RWaXNpYmxlQ29sdW1uOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3Qudmlldy53dDtyZXR1cm4gZS53dFZpZXdwb3J0LmNvbHVtbnNWaXNpYmxlQ2FsY3VsYXRvcj9lLnd0VGFibGUuZ2V0TGFzdFZpc2libGVDb2x1bW4oKTplLnd0Vmlld3BvcnQuY29sdW1uc1JlbmRlckNhbGN1bGF0b3I/ZS53dFRhYmxlLmdldExhc3RSZW5kZXJlZENvbHVtbigpOi0xfSxjbGVhckNhY2hlOmZ1bmN0aW9uKCl7dGhpcy53aWR0aHMubGVuZ3RoPTB9LGlzTmVlZFJlY2FsY3VsYXRlOmZ1bmN0aW9uKCl7cmV0dXJuIG0odGhpcy53aWR0aHMsZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMD09PWV9KS5sZW5ndGg/ITA6ITF9LG9uQmVmb3JlUmVuZGVyOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3QucmVuZGVyQ2FsbDt0aGlzLmNhbGN1bGF0ZUNvbHVtbnNXaWR0aCh7ZnJvbTp0aGlzLmdldEZpcnN0VmlzaWJsZUNvbHVtbigpLHRvOnRoaXMuZ2V0TGFzdFZpc2libGVDb2x1bW4oKX0sdm9pZCAwLGUpLHRoaXMuaXNOZWVkUmVjYWxjdWxhdGUoKSYmIXRoaXMuaW5Qcm9ncmVzcyYmdGhpcy5jYWxjdWxhdGVBbGxDb2x1bW5zV2lkdGgoKX0sb25BZnRlckxvYWREYXRhOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmhvdC52aWV3P3RoaXMucmVjYWxjdWxhdGVBbGxDb2x1bW5zV2lkdGgoKTpzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZS5ob3QmJmUucmVjYWxjdWxhdGVBbGxDb2x1bW5zV2lkdGgoKX0sMCl9LG9uQmVmb3JlQ2hhbmdlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7ZyhlLGZ1bmN0aW9uKGUpe3JldHVybiB0LndpZHRoc1tlWzFdXT12b2lkIDB9KX0sb25CZWZvcmVDb2x1bW5SZXNpemU6ZnVuY3Rpb24oZSx0LG4pe3JldHVybiBuJiYodGhpcy5jYWxjdWxhdGVDb2x1bW5zV2lkdGgoZSx2b2lkIDAsITApLHQ9dGhpcy5nZXRDb2x1bW5XaWR0aChlLHZvaWQgMCwhMSkpLHR9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmdob3N0VGFibGUuY2xlYW4oKSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyx4LnByb3RvdHlwZSwiZGVzdHJveSIpLmNhbGwodGhpcyl9fSx7Z2V0IENBTENVTEFUSU9OX1NURVAoKXtyZXR1cm4gNTB9LGdldCBTWU5DX0NBTENVTEFUSU9OX0xJTUlUKCl7cmV0dXJuIDUwfX0sZiksTygiYXV0b0NvbHVtblNpemUiLEQpfSx7IjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jYWxjdWxhdG9yL3ZpZXdwb3J0Q29sdW1ucyI6MyxfYmFzZTo1OCwiaGVscGVycy9hcnJheSI6NDIsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL251bWJlciI6NDksImhlbHBlcnMvb2JqZWN0Ijo1MCwiaGVscGVycy9zdHJpbmciOjUyLHBsdWdpbnM6NTcsInV0aWxzL2dob3N0VGFibGUiOjk4LCJ1dGlscy9zYW1wbGVzR2VuZXJhdG9yIjo5OX1dLDYwOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0F1dG9Sb3dTaXplOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gTX19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbCx1LGMsZCxoPShvPWUoIl9iYXNlIiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KVsiZGVmYXVsdCJdLGY9KHI9ZSgiaGVscGVycy9hcnJheSIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkscD0oZi5hcnJheUVhY2gsZi5hcnJheUZpbHRlciksZz0oaT1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KSxtPWcuY2FuY2VsQW5pbWF0aW9uRnJhbWUsdj1nLnJlcXVlc3RBbmltYXRpb25GcmFtZSx3PWcuaXNWaXNpYmxlLHk9KHM9ZSgidXRpbHMvZ2hvc3RUYWJsZSIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkuR2hvc3RUYWJsZSxiPShhPWUoImhlbHBlcnMvb2JqZWN0IiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KSxDPWIuaXNPYmplY3QsUj0oYi5vYmplY3RFYWNoLGw9ZSgiaGVscGVycy9udW1iZXIiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLF89Ui52YWx1ZUFjY29yZGluZ1BlcmNlbnQsUz1SLnJhbmdlRWFjaCxFPSh1PWUoInBsdWdpbnMiKSx1JiZ1Ll9fZXNNb2R1bGUmJnV8fHsiZGVmYXVsdCI6dX0pLnJlZ2lzdGVyUGx1Z2luLFQ9KGM9ZSgidXRpbHMvc2FtcGxlc0dlbmVyYXRvciIpLGMmJmMuX19lc01vZHVsZSYmY3x8eyJkZWZhdWx0IjpjfSkuU2FtcGxlc0dlbmVyYXRvcixPPShkPWUoImhlbHBlcnMvc3RyaW5nIiksZCYmZC5fX2VzTW9kdWxlJiZkfHx7ImRlZmF1bHQiOmR9KS5pc1BlcmNlbnRWYWx1ZSxNPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7JHRyYWNldXJSdW50aW1lLnN1cGVyQ29uc3RydWN0b3IoaykuY2FsbCh0aGlzLGUpLHRoaXMuaGVpZ2h0cz1bXSx0aGlzLmdob3N0VGFibGU9bmV3IHkodGhpcy5ob3QpLHRoaXMuc2FtcGxlc0dlbmVyYXRvcj1uZXcgVChmdW5jdGlvbihlLG4pe3JldHVybiB0LmhvdC5nZXREYXRhQXRDZWxsKGUsbil9KSx0aGlzLmZpcnN0Q2FsY3VsYXRpb249ITAsdGhpcy5pblByb2dyZXNzPSExLHRoaXMuYWRkSG9vaygiYmVmb3JlUm93UmVzaXplIixmdW5jdGlvbihlLG4sbyl7cmV0dXJuIHQub25CZWZvcmVSb3dSZXNpemUoZSxuLG8pfSl9LGs9TTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoTSx7aXNFbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaG90LmdldFNldHRpbmdzKCkuYXV0b1Jvd1NpemU9PT0hMHx8Qyh0aGlzLmhvdC5nZXRTZXR0aW5ncygpLmF1dG9Sb3dTaXplKX0sZW5hYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmVuYWJsZWR8fCh0aGlzLmFkZEhvb2soImFmdGVyTG9hZERhdGEiLGZ1bmN0aW9uKCl7cmV0dXJuIGUub25BZnRlckxvYWREYXRhKCl9KSx0aGlzLmFkZEhvb2soImJlZm9yZUNoYW5nZSIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25CZWZvcmVDaGFuZ2UodCl9KSx0aGlzLmFkZEhvb2soImJlZm9yZUNvbHVtbk1vdmUiLGZ1bmN0aW9uKCl7cmV0dXJuIGUucmVjYWxjdWxhdGVBbGxSb3dzSGVpZ2h0KCl9KSx0aGlzLmFkZEhvb2soImJlZm9yZUNvbHVtblJlc2l6ZSIsZnVuY3Rpb24oKXtyZXR1cm4gZS5yZWNhbGN1bGF0ZUFsbFJvd3NIZWlnaHQoKX0pLHRoaXMuYWRkSG9vaygiYmVmb3JlQ29sdW1uU29ydCIsZnVuY3Rpb24oKXtyZXR1cm4gZS5jbGVhckNhY2hlKCl9KSx0aGlzLmFkZEhvb2soImJlZm9yZVJlbmRlciIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25CZWZvcmVSZW5kZXIodCl9KSx0aGlzLmFkZEhvb2soImJlZm9yZVJvd01vdmUiLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUub25CZWZvcmVSb3dNb3ZlKHQsbil9KSx0aGlzLmFkZEhvb2soIm1vZGlmeVJvd0hlaWdodCIsZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5nZXRSb3dIZWlnaHQobix0KX0pLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLGsucHJvdG90eXBlLCJlbmFibGVQbHVnaW4iKS5jYWxsKHRoaXMpKX0sZGlzYWJsZVBsdWdpbjpmdW5jdGlvbigpeyR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLGsucHJvdG90eXBlLCJkaXNhYmxlUGx1Z2luIikuY2FsbCh0aGlzKX0sY2FsY3VsYXRlUm93c0hlaWdodDpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06e2Zyb206MCx0bzp0aGlzLmhvdC5jb3VudFJvd3MoKS0xfSx0PXZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e2Zyb206MCx0bzp0aGlzLmhvdC5jb3VudENvbHMoKS0xfSxuPXZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06ITEsbz10aGlzOyJudW1iZXIiPT10eXBlb2YgZSYmKGU9e2Zyb206ZSx0bzplfSksIm51bWJlciI9PXR5cGVvZiB0JiYodD17ZnJvbTp0LHRvOnR9KSxTKGUuZnJvbSxlLnRvLGZ1bmN0aW9uKGUpe2lmKG58fHZvaWQgMD09PW8uaGVpZ2h0c1tlXSl7dmFyIHI9by5zYW1wbGVzR2VuZXJhdG9yLmdlbmVyYXRlUm93U2FtcGxlcyhlLHQpO3IuZm9yRWFjaChmdW5jdGlvbihlLHQpe3JldHVybiBvLmdob3N0VGFibGUuYWRkUm93KHQsZSl9KX19KSx0aGlzLmdob3N0VGFibGUucm93cy5sZW5ndGgmJih0aGlzLmdob3N0VGFibGUuZ2V0SGVpZ2h0cyhmdW5jdGlvbihlLHQpe3JldHVybiBvLmhlaWdodHNbZV09dH0pLHRoaXMuZ2hvc3RUYWJsZS5jbGVhbigpKX0sY2FsY3VsYXRlQWxsUm93c0hlaWdodDpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06e2Zyb206MCx0bzp0aGlzLmhvdC5jb3VudENvbHMoKS0xfSx0PXRoaXMsbj0wLG89dGhpcy5ob3QuY291bnRSb3dzKCktMSxyPW51bGw7dGhpcy5pblByb2dyZXNzPSEwO3ZhciBpPWZ1bmN0aW9uKCl7cmV0dXJuIHQuaG90Pyh0LmNhbGN1bGF0ZVJvd3NIZWlnaHQoe2Zyb206biwKdG86TWF0aC5taW4obitrLkNBTENVTEFUSU9OX1NURVAsbyl9LGUpLG49bitrLkNBTENVTEFUSU9OX1NURVArMSx2b2lkKG8+bj9yPXYoaSk6KG0ociksdC5pblByb2dyZXNzPSExLHQuaG90LnZpZXcud3Qud3RPdmVybGF5cy5hZGp1c3RFbGVtZW50c1NpemUoITApLHQuaG90LnZpZXcud3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5uZWVkRnVsbFJlbmRlciYmdC5ob3Qudmlldy53dC53dE92ZXJsYXlzLmxlZnRPdmVybGF5LmNsb25lLmRyYXcoKSkpKToobShyKSx2b2lkKHQuaW5Qcm9ncmVzcz0hMSkpfTt0aGlzLmZpcnN0Q2FsY3VsYXRpb24mJnRoaXMuZ2V0U3luY0NhbGN1bGF0aW9uTGltaXQoKSYmKHRoaXMuY2FsY3VsYXRlUm93c0hlaWdodCh7ZnJvbTowLHRvOnRoaXMuZ2V0U3luY0NhbGN1bGF0aW9uTGltaXQoKX0sZSksdGhpcy5maXJzdENhbGN1bGF0aW9uPSExLG49dGhpcy5nZXRTeW5jQ2FsY3VsYXRpb25MaW1pdCgpKzEpLG8+bj9pKCk6dGhpcy5pblByb2dyZXNzPSExfSxyZWNhbGN1bGF0ZUFsbFJvd3NIZWlnaHQ6ZnVuY3Rpb24oKXt3KHRoaXMuaG90LnZpZXcud3Qud3RUYWJsZS5UQUJMRSkmJih0aGlzLmNsZWFyQ2FjaGUoKSx0aGlzLmNhbGN1bGF0ZUFsbFJvd3NIZWlnaHQoKSl9LGdldFN5bmNDYWxjdWxhdGlvbkxpbWl0OmZ1bmN0aW9uKCl7dmFyIGU9ay5TWU5DX0NBTENVTEFUSU9OX0xJTUlULHQ9dGhpcy5ob3QuY291bnRSb3dzKCktMTtyZXR1cm4gQyh0aGlzLmhvdC5nZXRTZXR0aW5ncygpLmF1dG9Sb3dTaXplKSYmKGU9dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5hdXRvUm93U2l6ZS5zeW5jTGltaXQsTyhlKT9lPV8odCxlKTplPj49MCksTWF0aC5taW4oZSx0KX0sZ2V0Um93SGVpZ2h0OmZ1bmN0aW9uKGUpe3ZhciB0PWFyZ3VtZW50c1sxXSxuPXQ7cmV0dXJuIHZvaWQgMCE9PXRoaXMuaGVpZ2h0c1tlXSYmdGhpcy5oZWlnaHRzW2VdPih0fHwwKSYmKG49dGhpcy5oZWlnaHRzW2VdKSxufSxnZXRGaXJzdFZpc2libGVSb3c6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmhvdC52aWV3Lnd0O3JldHVybiBlLnd0Vmlld3BvcnQucm93c1Zpc2libGVDYWxjdWxhdG9yP2Uud3RUYWJsZS5nZXRGaXJzdFZpc2libGVSb3coKTplLnd0Vmlld3BvcnQucm93c1JlbmRlckNhbGN1bGF0b3I/ZS53dFRhYmxlLmdldEZpcnN0UmVuZGVyZWRSb3coKTotMX0sZ2V0TGFzdFZpc2libGVSb3c6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmhvdC52aWV3Lnd0O3JldHVybiBlLnd0Vmlld3BvcnQucm93c1Zpc2libGVDYWxjdWxhdG9yP2Uud3RUYWJsZS5nZXRMYXN0VmlzaWJsZVJvdygpOmUud3RWaWV3cG9ydC5yb3dzUmVuZGVyQ2FsY3VsYXRvcj9lLnd0VGFibGUuZ2V0TGFzdFJlbmRlcmVkUm93KCk6LTF9LGNsZWFyQ2FjaGU6ZnVuY3Rpb24oKXt0aGlzLmhlaWdodHMubGVuZ3RoPTB9LGNsZWFyQ2FjaGVCeVJhbmdlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7Im51bWJlciI9PXR5cGVvZiBlJiYoZT17ZnJvbTplLHRvOmV9KSxTKE1hdGgubWluKGUuZnJvbSxlLnRvKSxNYXRoLm1heChlLmZyb20sZS50byksZnVuY3Rpb24oZSl7cmV0dXJuIHQuaGVpZ2h0c1tlXT12b2lkIDB9KX0saXNOZWVkUmVjYWxjdWxhdGU6ZnVuY3Rpb24oKXtyZXR1cm4gcCh0aGlzLmhlaWdodHMsZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMD09PWV9KS5sZW5ndGg/ITA6ITF9LG9uQmVmb3JlUmVuZGVyOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3QucmVuZGVyQ2FsbDt0aGlzLmNhbGN1bGF0ZVJvd3NIZWlnaHQoe2Zyb206dGhpcy5nZXRGaXJzdFZpc2libGVSb3coKSx0bzp0aGlzLmdldExhc3RWaXNpYmxlUm93KCl9LHZvaWQgMCxlKSx0aGlzLmlzTmVlZFJlY2FsY3VsYXRlKCkmJiF0aGlzLmluUHJvZ3Jlc3MmJnRoaXMuY2FsY3VsYXRlQWxsUm93c0hlaWdodCgpfSxvbkJlZm9yZVJvd01vdmU6ZnVuY3Rpb24oZSx0KXt0aGlzLmNsZWFyQ2FjaGVCeVJhbmdlKHtmcm9tOmUsdG86dH0pLHRoaXMuY2FsY3VsYXRlQWxsUm93c0hlaWdodCgpfSxvbkJlZm9yZVJvd1Jlc2l6ZTpmdW5jdGlvbihlLHQsbil7cmV0dXJuIG4mJih0aGlzLmNhbGN1bGF0ZVJvd3NIZWlnaHQoZSx2b2lkIDAsITApLHQ9dGhpcy5nZXRSb3dIZWlnaHQoZSkpLHR9LG9uQWZ0ZXJMb2FkRGF0YTpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5ob3Qudmlldz90aGlzLnJlY2FsY3VsYXRlQWxsUm93c0hlaWdodCgpOnNldFRpbWVvdXQoZnVuY3Rpb24oKXtlLmhvdCYmZS5yZWNhbGN1bGF0ZUFsbFJvd3NIZWlnaHQoKX0sMCl9LG9uQmVmb3JlQ2hhbmdlOmZ1bmN0aW9uKGUpe3ZhciB0PW51bGw7MT09PWUubGVuZ3RoP3Q9ZVswXVswXTplLmxlbmd0aD4xJiYodD17ZnJvbTplWzBdWzBdLHRvOmVbZS5sZW5ndGgtMV1bMF19KSxudWxsIT09dCYmdGhpcy5jbGVhckNhY2hlQnlSYW5nZSh0KX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZ2hvc3RUYWJsZS5jbGVhbigpLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLGsucHJvdG90eXBlLCJkZXN0cm95IikuY2FsbCh0aGlzKX19LHtnZXQgQ0FMQ1VMQVRJT05fU1RFUCgpe3JldHVybiA1MH0sZ2V0IFNZTkNfQ0FMQ1VMQVRJT05fTElNSVQoKXtyZXR1cm4gNTAwfX0saCksRSgiYXV0b1Jvd1NpemUiLE0pfSx7X2Jhc2U6NTgsImhlbHBlcnMvYXJyYXkiOjQyLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy9udW1iZXIiOjQ5LCJoZWxwZXJzL29iamVjdCI6NTAsImhlbHBlcnMvc3RyaW5nIjo1MixwbHVnaW5zOjU3LCJ1dGlscy9naG9zdFRhYmxlIjo5OCwidXRpbHMvc2FtcGxlc0dlbmVyYXRvciI6OTl9XSw2MTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUsdCxuLG8pe3ZhciByLGkscyxhLGwsdT1uLmxlbmd0aCxjPW4/blswXS5sZW5ndGg6MCxkPVtdLGg9W107aWYocj10LnJvdy1lLnJvdyxpPXQuY29sLWUuY29sLC0xIT09WyJkb3duIiwidXAiXS5pbmRleE9mKG8pKXtmb3IodmFyIGY9MDtpPj1mO2YrKylzPXBhcnNlSW50KG5bMF1bZl0sMTApLGE9cGFyc2VJbnQoblt1LTFdW2ZdLDEwKSxsPSgiZG93biI9PT1vP2EtczpzLWEpLyh1LTEpfHwwLGgucHVzaChsKTtkLnB1c2goaCl9aWYoLTEhPT1bInJpZ2h0IiwibGVmdCJdLmluZGV4T2YobykpZm9yKHZhciBwPTA7cj49cDtwKyspcz1wYXJzZUludChuW3BdWzBdLDEwKSxhPXBhcnNlSW50KG5bcF1bYy0xXSwxMCksbD0oInJpZ2h0Ij09PW8/YS1zOnMtYSkvKGMtMSl8fDAsaD1bXSxoLnB1c2gobCksZC5wdXNoKGgpO3JldHVybiBkfWZ1bmN0aW9uIHIoZSl7ZnVuY3Rpb24gdCh0KXtyZXR1cm4gZS5hdXRvZmlsbD92b2lkKGUuYXV0b2ZpbGwuaGFuZGxlJiZlLmF1dG9maWxsLmhhbmRsZS5pc0RyYWdnZWQmJihlLmF1dG9maWxsLmhhbmRsZS5pc0RyYWdnZWQ+MSYmZS5hdXRvZmlsbC5hcHBseSgpLGUuYXV0b2ZpbGwuaGFuZGxlLmlzRHJhZ2dlZD0wLGE9ITEpKTohMH1mdW5jdGlvbiBuKGUpe3ZhciB0LG47cmV0dXJuIHMuaW5zdGFuY2UuYXV0b2ZpbGw/KHQ9YyhzLmluc3RhbmNlLnRhYmxlKS50b3AtKHdpbmRvdy5wYWdlWU9mZnNldHx8ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCkrZChzLmluc3RhbmNlLnRhYmxlKSxuPWMocy5pbnN0YW5jZS50YWJsZSkubGVmdC0od2luZG93LnBhZ2VYT2Zmc2V0fHxkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCkraChzLmluc3RhbmNlLnRhYmxlKSxzLmFkZGluZ1N0YXJ0ZWQ9PT0hMSYmcy5pbnN0YW5jZS5hdXRvZmlsbC5oYW5kbGUuaXNEcmFnZ2VkPjAmJmUuY2xpZW50WT50JiZlLmNsaWVudFg8PW4/KHMuaW5zdGFuY2UubW91c2VEcmFnT3V0c2lkZT0hMCxzLmFkZGluZ1N0YXJ0ZWQ9ITApOnMuaW5zdGFuY2UubW91c2VEcmFnT3V0c2lkZT0hMSx2b2lkKHMuaW5zdGFuY2UubW91c2VEcmFnT3V0c2lkZSYmc2V0VGltZW91dChmdW5jdGlvbigpe3MuYWRkaW5nU3RhcnRlZD0hMSxzLmluc3RhbmNlLmFsdGVyKCJpbnNlcnRfcm93Iil9LDIwMCkpKTohMX12YXIgbyxyLGkscz10aGlzLGE9ITE7dGhpcy5pbnN0YW5jZT1lLHRoaXMuYWRkaW5nU3RhcnRlZD0hMSxpPWYoZSksaS5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCJtb3VzZXVwIix0KSxpLmFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQsIm1vdXNlbW92ZSIsbiksbz10aGlzLmluc3RhbmNlLnZpZXcud3Qud3RTZXR0aW5ncy5zZXR0aW5ncy5vbkNlbGxDb3JuZXJNb3VzZURvd24sdGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0U2V0dGluZ3Muc2V0dGluZ3Mub25DZWxsQ29ybmVyTW91c2VEb3duPWZ1bmN0aW9uKHQpe2UuYXV0b2ZpbGwuaGFuZGxlLmlzRHJhZ2dlZD0xLGE9ITAsbyh0KX0scj10aGlzLmluc3RhbmNlLnZpZXcud3Qud3RTZXR0aW5ncy5zZXR0aW5ncy5vbkNlbGxNb3VzZU92ZXIsdGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0U2V0dGluZ3Muc2V0dGluZ3Mub25DZWxsTW91c2VPdmVyPWZ1bmN0aW9uKHQsbixvLGkpe2UuYXV0b2ZpbGwmJmEmJiFlLnZpZXcuaXNNb3VzZURvd24oKSYmZS5hdXRvZmlsbC5oYW5kbGUmJmUuYXV0b2ZpbGwuaGFuZGxlLmlzRHJhZ2dlZCYmKGUuYXV0b2ZpbGwuaGFuZGxlLmlzRHJhZ2dlZCsrLGUuYXV0b2ZpbGwuc2hvd0JvcmRlcihuKSxlLmF1dG9maWxsLmNoZWNrSWZOZXdSb3dOZWVkZWQoKSkscih0LG4sbyxpKX0sdGhpcy5pbnN0YW5jZS52aWV3Lnd0Lnd0U2V0dGluZ3Muc2V0dGluZ3Mub25DZWxsQ29ybmVyRGJsQ2xpY2s9ZnVuY3Rpb24oKXtlLmF1dG9maWxsLnNlbGVjdEFkamFjZW50KCl9fU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0F1dG9maWxsOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gcn19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBpLHMsYSxsLHU9KGk9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSksYz11Lm9mZnNldCxkPXUub3V0ZXJIZWlnaHQsaD11Lm91dGVyV2lkdGgsZj0ocz1lKCJldmVudE1hbmFnZXIiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLmV2ZW50TWFuYWdlcixwPSgoYT1lKCJwbHVnaW5zIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5yZWdpc3RlclBsdWdpbiwobD1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLldhbGtvbnRhYmxlQ2VsbENvb3Jkcyk7ci5wcm90b3R5cGUuaW5pdD1mdW5jdGlvbigpe3RoaXMuaGFuZGxlPXt9fSxyLnByb3RvdHlwZS5kaXNhYmxlPWZ1bmN0aW9uKCl7dGhpcy5oYW5kbGUuZGlzYWJsZWQ9ITB9LHIucHJvdG90eXBlLnNlbGVjdEFkamFjZW50PWZ1bmN0aW9uKCl7dmFyIGUsdCxuLG8scjtlPXRoaXMuaW5zdGFuY2Uuc2VsZWN0aW9uLmlzTXVsdGlwbGUoKT90aGlzLmluc3RhbmNlLnZpZXcud3Quc2VsZWN0aW9ucy5hcmVhLmdldENvcm5lcnMoKTp0aGlzLmluc3RhbmNlLnZpZXcud3Quc2VsZWN0aW9ucy5jdXJyZW50LmdldENvcm5lcnMoKSx0PXRoaXMuaW5zdGFuY2UuZ2V0RGF0YSgpO2U6Zm9yKG49ZVsyXSsxO248dGhpcy5pbnN0YW5jZS5jb3VudFJvd3MoKTtuKyspe2ZvcihyPWVbMV07cjw9ZVszXTtyKyspaWYodFtuXVtyXSlicmVhayBlOyh0W25dW2VbMV0tMV18fHRbbl1bZVszXSsxXSkmJihvPW4pfW8mJih0aGlzLmluc3RhbmNlLnZpZXcud3Quc2VsZWN0aW9ucy5maWxsLmNsZWFyKCksdGhpcy5pbnN0YW5jZS52aWV3Lnd0LnNlbGVjdGlvbnMuZmlsbC5hZGQobmV3IHAoZVswXSxlWzFdKSksdGhpcy5pbnN0YW5jZS52aWV3Lnd0LnNlbGVjdGlvbnMuZmlsbC5hZGQobmV3IHAobyxlWzNdKSksdGhpcy5hcHBseSgpKX0sci5wcm90b3R5cGUuYXBwbHk9ZnVuY3Rpb24oKXt2YXIgZSx0LG4scixpLHMsYSxsO3RoaXMuaGFuZGxlLmlzRHJhZ2dlZD0wLHRoaXMuaW5zdGFuY2Uudmlldy53dC5zZWxlY3Rpb25zLmZpbGwuaXNFbXB0eSgpfHwoZT10aGlzLmluc3RhbmNlLnZpZXcud3Quc2VsZWN0aW9ucy5maWxsLmdldENvcm5lcnMoKSx0aGlzLmluc3RhbmNlLnZpZXcud3Quc2VsZWN0aW9ucy5maWxsLmNsZWFyKCksdD10aGlzLmluc3RhbmNlLnNlbGVjdGlvbi5pc011bHRpcGxlKCk/dGhpcy5pbnN0YW5jZS52aWV3Lnd0LnNlbGVjdGlvbnMuYXJlYS5nZXRDb3JuZXJzKCk6dGhpcy5pbnN0YW5jZS52aWV3Lnd0LnNlbGVjdGlvbnMuY3VycmVudC5nZXRDb3JuZXJzKCksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bih0aGlzLmluc3RhbmNlLCJhZnRlckF1dG9maWxsQXBwbHlWYWx1ZXMiLHQsZSksZVswXT09PXRbMF0mJmVbMV08dFsxXT8ocz0ibGVmdCIsbj1uZXcgcChlWzBdLGVbMV0pLHI9bmV3IHAoZVsyXSx0WzFdLTEpKTplWzBdPT09dFswXSYmZVszXT50WzNdPyhzPSJyaWdodCIsbj1uZXcgcChlWzBdLHRbM10rMSkscj1uZXcgcChlWzJdLGVbM10pKTplWzBdPHRbMF0mJmVbMV09PT10WzFdPyhzPSJ1cCIsbj1uZXcgcChlWzBdLGVbMV0pLHI9bmV3IHAodFswXS0xLGVbM10pKTplWzJdPnRbMl0mJmVbMV09PT10WzFdJiYocz0iZG93biIsbj1uZXcgcCh0WzJdKzEsZVsxXSkscj1uZXcgcChlWzJdLGVbM10pKSxuJiZuLnJvdz4tMSYmbi5jb2w+LTE/KGw9e2Zyb206dGhpcy5pbnN0YW5jZS5nZXRTZWxlY3RlZFJhbmdlKCkuZnJvbSx0bzp0aGlzLmluc3RhbmNlLmdldFNlbGVjdGVkUmFuZ2UoKS50b30saT10aGlzLmluc3RhbmNlLmdldERhdGEobC5mcm9tLnJvdyxsLmZyb20uY29sLGwudG8ucm93LGwudG8uY29sKSxhPW8obixyLGkscyksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bih0aGlzLmluc3RhbmNlLCJiZWZvcmVBdXRvZmlsbCIsbixyLGkpLHRoaXMuaW5zdGFuY2UucG9wdWxhdGVGcm9tQXJyYXkobi5yb3csbi5jb2wsaSxyLnJvdyxyLmNvbCwiYXV0b2ZpbGwiLG51bGwscyxhKSx0aGlzLmluc3RhbmNlLnNlbGVjdGlvbi5zZXRSYW5nZVN0YXJ0KG5ldyBwKGVbMF0sZVsxXSkpLHRoaXMuaW5zdGFuY2Uuc2VsZWN0aW9uLnNldFJhbmdlRW5kKG5ldyBwKGVbMl0sZVszXSkpKTp0aGlzLmluc3RhbmNlLnNlbGVjdGlvbi5yZWZyZXNoQm9yZGVycygpKX0sci5wcm90b3R5cGUuc2hvd0JvcmRlcj1mdW5jdGlvbihlKXt2YXIgdD10aGlzLmluc3RhbmNlLmdldFNlbGVjdGVkUmFuZ2UoKS5nZXRUb3BMZWZ0Q29ybmVyKCksbj10aGlzLmluc3RhbmNlLmdldFNlbGVjdGVkUmFuZ2UoKS5nZXRCb3R0b21SaWdodENvcm5lcigpO2lmKCJob3Jpem9udGFsIiE9PXRoaXMuaW5zdGFuY2UuZ2V0U2V0dGluZ3MoKS5maWxsSGFuZGxlJiYobi5yb3c8ZS5yb3d8fHQucm93PmUucm93KSllPW5ldyBwKGUucm93LG4uY29sKTtlbHNle2lmKCJ2ZXJ0aWNhbCI9PT10aGlzLmluc3RhbmNlLmdldFNldHRpbmdzKCkuZmlsbEhhbmRsZSlyZXR1cm47ZT1uZXcgcChuLnJvdyxlLmNvbCl9dGhpcy5pbnN0YW5jZS52aWV3Lnd0LnNlbGVjdGlvbnMuZmlsbC5jbGVhcigpLHRoaXMuaW5zdGFuY2Uudmlldy53dC5zZWxlY3Rpb25zLmZpbGwuYWRkKHRoaXMuaW5zdGFuY2UuZ2V0U2VsZWN0ZWRSYW5nZSgpLmZyb20pLHRoaXMuaW5zdGFuY2Uudmlldy53dC5zZWxlY3Rpb25zLmZpbGwuYWRkKHRoaXMuaW5zdGFuY2UuZ2V0U2VsZWN0ZWRSYW5nZSgpLnRvKSx0aGlzLmluc3RhbmNlLnZpZXcud3Quc2VsZWN0aW9ucy5maWxsLmFkZChlKSx0aGlzLmluc3RhbmNlLnZpZXcucmVuZGVyKCl9LHIucHJvdG90eXBlLmNoZWNrSWZOZXdSb3dOZWVkZWQ9ZnVuY3Rpb24oKXt2YXIgZSx0LG49dGhpcy5pbnN0YW5jZS5jb3VudFJvd3MoKSxvPXRoaXM7dGhpcy5pbnN0YW5jZS52aWV3Lnd0LnNlbGVjdGlvbnMuZmlsbC5jZWxsUmFuZ2UmJnRoaXMuYWRkaW5nU3RhcnRlZD09PSExJiYodD10aGlzLmluc3RhbmNlLmdldFNlbGVjdGVkKCksZT10aGlzLmluc3RhbmNlLnZpZXcud3Quc2VsZWN0aW9ucy5maWxsLmdldENvcm5lcnMoKSx0WzJdPG4tMSYmZVsyXT09PW4tMSYmKHRoaXMuYWRkaW5nU3RhcnRlZD0hMCx0aGlzLmluc3RhbmNlLl9yZWdpc3RlclRpbWVvdXQoc2V0VGltZW91dChmdW5jdGlvbigpe28uaW5zdGFuY2UuYWx0ZXIoImluc2VydF9yb3ciKSxvLmFkZGluZ1N0YXJ0ZWQ9ITF9LDIwMCkpKSl9LEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVySW5pdCIsZnVuY3Rpb24oKXt2YXIgZT1uZXcgcih0aGlzKTsidW5kZWZpbmVkIiE9dHlwZW9mIHRoaXMuZ2V0U2V0dGluZ3MoKS5maWxsSGFuZGxlJiYoZS5oYW5kbGUmJnRoaXMuZ2V0U2V0dGluZ3MoKS5maWxsSGFuZGxlPT09ITE/ZS5kaXNhYmxlKCk6ZS5oYW5kbGV8fHRoaXMuZ2V0U2V0dGluZ3MoKS5maWxsSGFuZGxlPT09ITF8fCh0aGlzLmF1dG9maWxsPWUsdGhpcy5hdXRvZmlsbC5pbml0KCkpKX0pLEhhbmRzb250YWJsZS5BdXRvZmlsbD1yfSx7IjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL2Nvb3JkcyI6NSxldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LHBsdWdpbnM6NTd9XSw2MjpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtDb2x1bW5Tb3J0aW5nOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYn19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbD0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSx1PWwuYWRkQ2xhc3MsYz1sLmNsb3Nlc3QsZD1sLmhhc0NsYXNzLGg9bC5pbmRleCxmPWwucmVtb3ZlQ2xhc3MscD0ocj1lKCJoZWxwZXJzL2FycmF5IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KSxnPShwLmFycmF5RWFjaCxwLmFycmF5TWFwKSxtPXAuYXJyYXlSZWR1Y2Usdj0oaT1lKCJldmVudE1hbmFnZXIiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLmV2ZW50TWFuYWdlcix3PShzPWUoIl9iYXNlIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KVsiZGVmYXVsdCJdLHk9KGE9ZSgicGx1Z2lucyIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSkucmVnaXN0ZXJQbHVnaW47SGFuZHNvbnRhYmxlLmhvb2tzLnJlZ2lzdGVyKCJiZWZvcmVDb2x1bW5Tb3J0IiksSGFuZHNvbnRhYmxlLmhvb2tzLnJlZ2lzdGVyKCJhZnRlckNvbHVtblNvcnQiKTt2YXIgYj1mdW5jdGlvbihlKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJDb25zdHJ1Y3RvcihDKS5jYWxsKHRoaXMsZSksdGhpcy5zb3J0SW5kaWNhdG9ycz1bXX0sQz1iOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhiLHtpc0VuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuaG90LmdldFNldHRpbmdzKCkuY29sdW1uU29ydGluZ30sZW5hYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcztpZighdGhpcy5lbmFibGVkKXt2YXIgdD10aGlzO3RoaXMuaG90LnNvcnRJbmRleD1bXSx0aGlzLmhvdC5zb3J0PWZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtyZXR1cm4gdC5zb3J0QnlDb2x1bW4uYXBwbHkodCxlKX0sInVuZGVmaW5lZCI9PXR5cGVvZiB0aGlzLmhvdC5nZXRTZXR0aW5ncygpLm9ic2VydmVDaGFuZ2VzJiZ0aGlzLmVuYWJsZU9ic2VydmVDaGFuZ2VzUGx1Z2luKCksdGhpcy5iaW5kQ29sdW1uU29ydGluZ0FmdGVyQ2xpY2soKSx0aGlzLmFkZEhvb2soImFmdGVyVHJpbVJvdyIsZnVuY3Rpb24odCl7cmV0dXJuIGUuc29ydCgpfSksdGhpcy5hZGRIb29rKCJhZnRlclVudHJpbVJvdyIsZnVuY3Rpb24odCl7cmV0dXJuIGUuc29ydCgpfSksdGhpcy5hZGRIb29rKCJtb2RpZnlSb3ciLGZ1bmN0aW9uKHQpe3JldHVybiBlLnRyYW5zbGF0ZVJvdyh0KX0pLHRoaXMuYWRkSG9vaygiYWZ0ZXJVcGRhdGVTZXR0aW5ncyIsZnVuY3Rpb24oKXtyZXR1cm4gZS5vbkFmdGVyVXBkYXRlU2V0dGluZ3MoKX0pLHRoaXMuYWRkSG9vaygiYWZ0ZXJHZXRDb2xIZWFkZXIiLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUuZ2V0Q29sSGVhZGVyKHQsbil9KSx0aGlzLmFkZEhvb2soImFmdGVyQ3JlYXRlUm93IixmdW5jdGlvbigpe3QuYWZ0ZXJDcmVhdGVSb3cuYXBwbHkodCxhcmd1bWVudHMpfSksdGhpcy5hZGRIb29rKCJhZnRlclJlbW92ZVJvdyIsZnVuY3Rpb24oKXt0LmFmdGVyUmVtb3ZlUm93LmFwcGx5KHQsYXJndW1lbnRzKX0pLHRoaXMuYWRkSG9vaygiYWZ0ZXJJbml0IixmdW5jdGlvbigpe3JldHVybiBlLnNvcnRCeVNldHRpbmdzKCl9KSx0aGlzLmFkZEhvb2soImFmdGVyTG9hZERhdGEiLGZ1bmN0aW9uKCl7ZS5ob3Quc29ydEluZGV4PVtdLGUuaG90LnZpZXcmJmUuc29ydEJ5U2V0dGluZ3MoKX0pLHRoaXMuaG90LnZpZXcmJnRoaXMuc29ydEJ5U2V0dGluZ3MoKSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxDLnByb3RvdHlwZSwiZW5hYmxlUGx1Z2luIikuY2FsbCh0aGlzKX19LGRpc2FibGVQbHVnaW46ZnVuY3Rpb24oKXt0aGlzLmhvdC5zb3J0PXZvaWQgMCwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxDLnByb3RvdHlwZSwiZGlzYWJsZVBsdWdpbiIpLmNhbGwodGhpcyl9LG9uQWZ0ZXJVcGRhdGVTZXR0aW5nczpmdW5jdGlvbigpe3RoaXMuc29ydEJ5U2V0dGluZ3MoKX0sc29ydEJ5U2V0dGluZ3M6ZnVuY3Rpb24oKXt2YXIgZSx0LG49dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5jb2x1bW5Tb3J0aW5nLG89dGhpcy5sb2FkU29ydGluZ1N0YXRlKCk7InVuZGVmaW5lZCI9PXR5cGVvZiBvPyhlPW4uY29sdW1uLHQ9bi5zb3J0T3JkZXIpOihlPW8uc29ydENvbHVtbix0PW8uc29ydE9yZGVyKSx0aGlzLnNvcnRCeUNvbHVtbihlLHQpfSxzZXRTb3J0aW5nQ29sdW1uOmZ1bmN0aW9uKGUsdCl7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiBlPyh0aGlzLmhvdC5zb3J0Q29sdW1uPXZvaWQgMCx2b2lkKHRoaXMuaG90LnNvcnRPcmRlcj12b2lkIDApKToodGhpcy5ob3Quc29ydENvbHVtbj09PWUmJiJ1bmRlZmluZWQiPT10eXBlb2YgdD90aGlzLmhvdC5zb3J0T3JkZXI9PT0hMT90aGlzLmhvdC5zb3J0T3JkZXI9dm9pZCAwOnRoaXMuaG90LnNvcnRPcmRlcj0hdGhpcy5ob3Quc29ydE9yZGVyOnRoaXMuaG90LnNvcnRPcmRlcj0idW5kZWZpbmVkIj09dHlwZW9mIHQ/ITA6dCx2b2lkKHRoaXMuaG90LnNvcnRDb2x1bW49ZSkpfSxzb3J0QnlDb2x1bW46ZnVuY3Rpb24oZSx0KXt0aGlzLnNldFNvcnRpbmdDb2x1bW4oZSx0KSwidW5kZWZpbmVkIiE9dHlwZW9mIHRoaXMuaG90LnNvcnRDb2x1bW4mJihIYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaG90LCJiZWZvcmVDb2x1bW5Tb3J0Iix0aGlzLmhvdC5zb3J0Q29sdW1uLHRoaXMuaG90LnNvcnRPcmRlciksdGhpcy5zb3J0KCksdGhpcy5ob3QucmVuZGVyKCksdGhpcy5zYXZlU29ydGluZ1N0YXRlKCksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bih0aGlzLmhvdCwiYWZ0ZXJDb2x1bW5Tb3J0Iix0aGlzLmhvdC5zb3J0Q29sdW1uLHRoaXMuaG90LnNvcnRPcmRlcikpfSxzYXZlU29ydGluZ1N0YXRlOmZ1bmN0aW9uKCl7dmFyIGU9e307InVuZGVmaW5lZCIhPXR5cGVvZiB0aGlzLmhvdC5zb3J0Q29sdW1uJiYoZS5zb3J0Q29sdW1uPXRoaXMuaG90LnNvcnRDb2x1bW4pLCJ1bmRlZmluZWQiIT10eXBlb2YgdGhpcy5ob3Quc29ydE9yZGVyJiYoZS5zb3J0T3JkZXI9dGhpcy5ob3Quc29ydE9yZGVyKSwoZS5oYXNPd25Qcm9wZXJ0eSgic29ydENvbHVtbiIpfHxlLmhhc093blByb3BlcnR5KCJzb3J0T3JkZXIiKSkmJkhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5ob3QsInBlcnNpc3RlbnRTdGF0ZVNhdmUiLCJjb2x1bW5Tb3J0aW5nIixlKX0sbG9hZFNvcnRpbmdTdGF0ZTpmdW5jdGlvbigpe3ZhciBlPXt9O3JldHVybiBIYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaG90LCJwZXJzaXN0ZW50U3RhdGVMb2FkIiwiY29sdW1uU29ydGluZyIsZSksZS52YWx1ZX0sYmluZENvbHVtblNvcnRpbmdBZnRlckNsaWNrOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe3ZhciBlPW8uaG90LnZpZXcuVEJPRFkucXVlcnlTZWxlY3RvcigidHIiKSx0PTE7cmV0dXJuIGUmJih0PWUucXVlcnlTZWxlY3RvckFsbCgidGgiKS5sZW5ndGgpLHR9ZnVuY3Rpb24gdCh0KXt2YXIgbj1jKHQsIlRIIik7cmV0dXJuIG8uaG90LnZpZXcud3Qud3RUYWJsZS5nZXRGaXJzdFJlbmRlcmVkQ29sdW1uKCkraChuKS1lKCl9aWYoIXRoaXMuYmluZGVkU29ydEV2ZW50KXt2YXIgbj12KHRoaXMuaG90KSxvPXRoaXM7dGhpcy5iaW5kZWRTb3J0RXZlbnQ9ITAsbi5hZGRFdmVudExpc3RlbmVyKHRoaXMuaG90LnJvb3RFbGVtZW50LCJjbGljayIsZnVuY3Rpb24oZSl7aWYoZChlLnRhcmdldCwiY29sdW1uU29ydGluZyIpKXt2YXIgbj10KGUudGFyZ2V0KTtpZihuPT09dGhpcy5sYXN0U29ydGVkQ29sdW1uKXN3aXRjaChvLmhvdC5zb3J0T3JkZXIpe2Nhc2Ugdm9pZCAwOm8uc29ydE9yZGVyQ2xhc3M9ImFzY2VuZGluZyI7YnJlYWs7Y2FzZSEwOm8uc29ydE9yZGVyQ2xhc3M9ImRlc2NlbmRpbmciO2JyZWFrO2Nhc2UhMTpvLnNvcnRPcmRlckNsYXNzPXZvaWQgMH1lbHNlIG8uc29ydE9yZGVyQ2xhc3M9ImFzY2VuZGluZyI7dGhpcy5sYXN0U29ydGVkQ29sdW1uPW4sby5zb3J0QnlDb2x1bW4obil9fSl9fSxlbmFibGVPYnNlcnZlQ2hhbmdlc1BsdWdpbjpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5ob3QuX3JlZ2lzdGVyVGltZW91dChzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZS5ob3QudXBkYXRlU2V0dGluZ3Moe29ic2VydmVDaGFuZ2VzOiEwfSl9LDApKX0sZGVmYXVsdFNvcnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQsbil7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0WzFdJiYodFsxXT10WzFdLnRvTG93ZXJDYXNlKCkpLCJzdHJpbmciPT10eXBlb2YgblsxXSYmKG5bMV09blsxXS50b0xvd2VyQ2FzZSgpKSx0WzFdPT09blsxXT8wOm51bGw9PT10WzFdfHwiIj09PXRbMV0/MTpudWxsPT09blsxXXx8IiI9PT1uWzFdPy0xOmlzTmFOKHRbMV0pJiYhaXNOYU4oblsxXSk/ZT8xOi0xOiFpc05hTih0WzFdKSYmaXNOYU4oblsxXSk/ZT8tMToxOnRbMV08blsxXT9lPy0xOjE6dFsxXT5uWzFdP2U/MTotMTowfX0sZGF0ZVNvcnQ6ZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQsbil7aWYodFsxXT09PW5bMV0pcmV0dXJuIDA7aWYobnVsbD09PXRbMV18fCIiPT09dFsxXSlyZXR1cm4gMTtpZihudWxsPT09blsxXXx8IiI9PT1uWzFdKXJldHVybi0xO3ZhciBvPW5ldyBEYXRlKHRbMV0pLHI9bmV3IERhdGUoblsxXSk7cmV0dXJuIHI+bz9lPy0xOjE6bz5yP2U/MTotMTowfX0sc29ydDpmdW5jdGlvbigpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgdGhpcy5ob3Quc29ydE9yZGVyKXJldHVybiB2b2lkKHRoaXMuaG90LnNvcnRJbmRleC5sZW5ndGg9MCk7dmFyIGUsdDt0aGlzLmhvdC5zb3J0aW5nRW5hYmxlZD0hMSx0aGlzLmhvdC5zb3J0SW5kZXgubGVuZ3RoPTA7Zm9yKHZhciBuPXRoaXMuaG90LmNvbE9mZnNldCgpLG89MCxyPXRoaXMuaG90LmNvdW50Um93cygpLXRoaXMuaG90LmdldFNldHRpbmdzKCkubWluU3BhcmVSb3dzO3I+bztvKyspdGhpcy5ob3Quc29ydEluZGV4LnB1c2goW28sdGhpcy5ob3QuZ2V0RGF0YUF0Q2VsbChvLHRoaXMuaG90LnNvcnRDb2x1bW4rbildKTtzd2l0Y2goZT10aGlzLmhvdC5nZXRDZWxsTWV0YSgwLHRoaXMuaG90LnNvcnRDb2x1bW4pLHRoaXMuc29ydEluZGljYXRvcnNbdGhpcy5ob3Quc29ydENvbHVtbl09ZS5zb3J0SW5kaWNhdG9yLGUudHlwZSl7Y2FzZSJkYXRlIjp0PXRoaXMuZGF0ZVNvcnQ7YnJlYWs7ZGVmYXVsdDp0PXRoaXMuZGVmYXVsdFNvcnR9dGhpcy5ob3Quc29ydEluZGV4LnNvcnQodCh0aGlzLmhvdC5zb3J0T3JkZXIpKTtmb3IodmFyIG89dGhpcy5ob3Quc29ydEluZGV4Lmxlbmd0aDtvPHRoaXMuaG90LmNvdW50Um93cygpO28rKyl0aGlzLmhvdC5zb3J0SW5kZXgucHVzaChbbyx0aGlzLmhvdC5nZXREYXRhQXRDZWxsKG8sdGhpcy5ob3Quc29ydENvbHVtbituKV0pO3RoaXMuaG90LnNvcnRpbmdFbmFibGVkPSEwfSx0cmFuc2xhdGVSb3c6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaG90LnNvcnRpbmdFbmFibGVkJiYidW5kZWZpbmVkIiE9dHlwZW9mIHRoaXMuaG90LnNvcnRPcmRlciYmdGhpcy5ob3Quc29ydEluZGV4JiZ0aGlzLmhvdC5zb3J0SW5kZXgubGVuZ3RoJiZ0aGlzLmhvdC5zb3J0SW5kZXhbZV0/dGhpcy5ob3Quc29ydEluZGV4W2VdWzBdOmV9LHVudHJhbnNsYXRlUm93OmZ1bmN0aW9uKGUpe2lmKHRoaXMuaG90LnNvcnRpbmdFbmFibGVkJiZ0aGlzLmhvdC5zb3J0SW5kZXgmJnRoaXMuaG90LnNvcnRJbmRleC5sZW5ndGgpZm9yKHZhciB0PTA7dDx0aGlzLmhvdC5zb3J0SW5kZXgubGVuZ3RoO3QrKylpZih0aGlzLmhvdC5zb3J0SW5kZXhbdF1bMF09PWUpcmV0dXJuIHR9LGdldENvbEhlYWRlcjpmdW5jdGlvbihlLHQpe3ZhciBuPXQucXVlcnlTZWxlY3RvcigiLmNvbEhlYWRlciIpLG89KHQuZ2V0QXR0cmlidXRlKCJjb2xzcGFuIiksdC5wYXJlbnROb2RlLnBhcmVudE5vZGUuY2hpbGROb2Rlcykscj1BcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKG8sdC5wYXJlbnROb2RlKTtyLT1vLmxlbmd0aCxuJiYodGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5jb2x1bW5Tb3J0aW5nJiZlPj0wJiYtMT09PXImJnUobiwiY29sdW1uU29ydGluZyIpLGYobiwiZGVzY2VuZGluZyIpLGYobiwiYXNjZW5kaW5nIiksdGhpcy5zb3J0SW5kaWNhdG9yc1tlXSYmZT09PXRoaXMuaG90LnNvcnRDb2x1bW4mJigiYXNjZW5kaW5nIj09PXRoaXMuc29ydE9yZGVyQ2xhc3M/dShuLCJhc2NlbmRpbmciKToiZGVzY2VuZGluZyI9PT10aGlzLnNvcnRPcmRlckNsYXNzJiZ1KG4sImRlc2NlbmRpbmciKSkpfSxpc1NvcnRlZDpmdW5jdGlvbigpe3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgdGhpcy5ob3Quc29ydENvbHVtbn0sYWZ0ZXJDcmVhdGVSb3c6ZnVuY3Rpb24oZSx0KXtpZih0aGlzLmlzU29ydGVkKCkpe2Zvcih2YXIgbj0wO248dGhpcy5ob3Quc29ydEluZGV4Lmxlbmd0aDtuKyspdGhpcy5ob3Quc29ydEluZGV4W25dWzBdPj1lJiYodGhpcy5ob3Quc29ydEluZGV4W25dWzBdKz10KTtmb3IodmFyIG49MDt0Pm47bisrKXRoaXMuaG90LnNvcnRJbmRleC5zcGxpY2UoZStuLDAsW2Urbix0aGlzLmhvdC5nZXRTb3VyY2VEYXRhKClbZStuXVt0aGlzLmhvdC5zb3J0Q29sdW1uK3RoaXMuaG90LmNvbE9mZnNldCgpXV0pO3RoaXMuc2F2ZVNvcnRpbmdTdGF0ZSgpfX0sYWZ0ZXJSZW1vdmVSb3c6ZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBuKGUpe3JldHVybiBtKG8sZnVuY3Rpb24odCxuKXtyZXR1cm4gZT5uJiZ0KyssdH0sMCl9aWYodGhpcy5pc1NvcnRlZCgpKXt2YXIgbz10aGlzLmhvdC5zb3J0SW5kZXguc3BsaWNlKGUsdCk7bz1nKG8sZnVuY3Rpb24oZSl7cmV0dXJuIGVbMF19KSx0aGlzLmhvdC5zb3J0SW5kZXg9Zyh0aGlzLmhvdC5zb3J0SW5kZXgsZnVuY3Rpb24oZSx0KXt2YXIgbz1uKGVbMF0pO3JldHVybiBvJiYoZVswXS09byksZX0pLHRoaXMuc2F2ZVNvcnRpbmdTdGF0ZSgpfX19LHt9LHcpLHkoImNvbHVtblNvcnRpbmciLGIpfSx7X2Jhc2U6NTgsZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2FycmF5Ijo0MiwiaGVscGVycy9kb20vZWxlbWVudCI6NDUscGx1Z2luczo1N31dLDYzOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0NvbW1lbnRFZGl0b3I6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scj0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KS5hZGRDbGFzcyxpPWZ1bmN0aW9uKCl7dGhpcy5lZGl0b3I9dGhpcy5jcmVhdGVFZGl0b3IoKSx0aGlzLmVkaXRvclN0eWxlPXRoaXMuZWRpdG9yLnN0eWxlLHRoaXMuZWRpdG9yU3R5bGUucG9zaXRpb249ImFic29sdXRlIix0aGlzLmVkaXRvclN0eWxlLnpJbmRleD0xMDAsdGhpcy5oaWRlKCl9LHM9aTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoaSx7c2V0UG9zaXRpb246ZnVuY3Rpb24oZSx0KXt0aGlzLmVkaXRvclN0eWxlLmxlZnQ9ZSsicHgiLHRoaXMuZWRpdG9yU3R5bGUudG9wPXQrInB4In0sc2hvdzpmdW5jdGlvbigpe3RoaXMuZWRpdG9yU3R5bGUuZGlzcGxheT0iYmxvY2sifSxoaWRlOmZ1bmN0aW9uKCl7dGhpcy5lZGl0b3JTdHlsZS5kaXNwbGF5PSJub25lIn0saXNWaXNpYmxlOmZ1bmN0aW9uKCl7cmV0dXJuImJsb2NrIj09PXRoaXMuZWRpdG9yU3R5bGUuZGlzcGxheX0sc2V0VmFsdWU6ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiIiO2U9ZXx8IiIsdGhpcy5nZXRJbnB1dEVsZW1lbnQoKS52YWx1ZT1lfSxnZXRWYWx1ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLmdldElucHV0RWxlbWVudCgpLnZhbHVlfSxpc0ZvY3VzZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudD09PXRoaXMuZ2V0SW5wdXRFbGVtZW50KCl9LGZvY3VzOmZ1bmN0aW9uKCl7dGhpcy5nZXRJbnB1dEVsZW1lbnQoKS5mb2N1cygpfSxjcmVhdGVFZGl0b3I6ZnVuY3Rpb24oKXt2YXIgZSx0LG49ZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLiIrcy5DTEFTU19FRElUT1JfQ09OVEFJTkVSKTtyZXR1cm4gbnx8KG49ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikscihuLHMuQ0xBU1NfRURJVE9SX0NPTlRBSU5FUiksZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChuKSksZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSxyKGUscy5DTEFTU19FRElUT1IpLHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgidGV4dGFyZWEiKSxyKHQscy5DTEFTU19JTlBVVCksZS5hcHBlbmRDaGlsZCh0KSxuLmFwcGVuZENoaWxkKGUpLGV9LGdldElucHV0RWxlbWVudDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmVkaXRvci5xdWVyeVNlbGVjdG9yKCIuIitzLkNMQVNTX0lOUFVUKX0sZGVzdHJveTpmdW5jdGlvbigpe3RoaXMuZWRpdG9yLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lZGl0b3IpLHRoaXMuZWRpdG9yPW51bGwsdGhpcy5lZGl0b3JTdHlsZT1udWxsfX0se2dldCBDTEFTU19FRElUT1JfQ09OVEFJTkVSKCl7cmV0dXJuImh0Q29tbWVudHNDb250YWluZXIifSxnZXQgQ0xBU1NfRURJVE9SKCl7cmV0dXJuImh0Q29tbWVudHMifSxnZXQgQ0xBU1NfSU5QVVQoKXtyZXR1cm4iaHRDb21tZW50VGV4dEFyZWEifSxnZXQgQ0xBU1NfQ0VMTCgpe3JldHVybiJodENvbW1lbnRDZWxsIn19KX0seyJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NX1dLDY0OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0NvbW1lbnRzOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gUn19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbCx1PShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLGM9dS5hZGRDbGFzcyxkPXUuY2xvc2VzdCxoPXUuZ2V0V2luZG93U2Nyb2xsTGVmdCxmPXUuZ2V0V2luZG93U2Nyb2xsVG9wLHA9dS5oYXNDbGFzcyxnPXUub2Zmc2V0LG09KHI9ZSgiZXZlbnRNYW5hZ2VyIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5FdmVudE1hbmFnZXIsdj0oaT1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLldhbGtvbnRhYmxlQ2VsbENvb3Jkcyx3PShzPWUoInBsdWdpbnMiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLHk9dy5yZWdpc3RlclBsdWdpbixiPSh3LmdldFBsdWdpbiwoYT1lKCJfYmFzZSIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSlbImRlZmF1bHQiXSksQz0obD1lKCJjb21tZW50RWRpdG9yIiksbCYmbC5fX2VzTW9kdWxlJiZsfHx7ImRlZmF1bHQiOmx9KS5Db21tZW50RWRpdG9yLFI9ZnVuY3Rpb24oZSl7JHRyYWNldXJSdW50aW1lLnN1cGVyQ29uc3RydWN0b3IoXykuY2FsbCh0aGlzLGUpLHRoaXMuZWRpdG9yPW51bGwsdGhpcy5ldmVudE1hbmFnZXI9bnVsbCx0aGlzLnJhbmdlPXt9LHRoaXMubW91c2VEb3duPSExLHRoaXMuY29udGV4dE1lbnVFdmVudD0hMSx0aGlzLnRpbWVyPW51bGx9LF89UjskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoUix7aXNFbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaG90LmdldFNldHRpbmdzKCkuY29tbWVudHN9LGVuYWJsZVBsdWdpbjpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5lbmFibGVkfHwodGhpcy5lZGl0b3J8fCh0aGlzLmVkaXRvcj1uZXcgQyksdGhpcy5ldmVudE1hbmFnZXJ8fCh0aGlzLmV2ZW50TWFuYWdlcj1uZXcgbSh0aGlzKSksdGhpcy5hZGRIb29rKCJhZnRlckNvbnRleHRNZW51RGVmYXVsdE9wdGlvbnMiLGZ1bmN0aW9uKHQpe3JldHVybiBlLmFkZFRvQ29udGV4dE1lbnUodCl9KSx0aGlzLmFkZEhvb2soImFmdGVyUmVuZGVyZXIiLGZ1bmN0aW9uKHQsbixvLHIsaSxzKXtyZXR1cm4gZS5vbkFmdGVyUmVuZGVyZXIodCxzKX0pLHRoaXMuYWRkSG9vaygiYWZ0ZXJTY3JvbGxWZXJ0aWNhbGx5IixmdW5jdGlvbigpe3JldHVybiBlLnJlZnJlc2hFZGl0b3JQb3NpdGlvbigpfSksdGhpcy5hZGRIb29rKCJhZnRlckNvbHVtblJlc2l6ZSIsZnVuY3Rpb24oKXtyZXR1cm4gZS5yZWZyZXNoRWRpdG9yUG9zaXRpb24oKX0pLHRoaXMuYWRkSG9vaygiYWZ0ZXJSb3dSZXNpemUiLGZ1bmN0aW9uKCl7cmV0dXJuIGUucmVmcmVzaEVkaXRvclBvc2l0aW9uKCl9KSx0aGlzLnJlZ2lzdGVyTGlzdGVuZXJzKCksJHRyYWNldXJSdW50aW1lLnN1cGVyR2V0KHRoaXMsXy5wcm90b3R5cGUsImVuYWJsZVBsdWdpbiIpLmNhbGwodGhpcykpfSxkaXNhYmxlUGx1Z2luOmZ1bmN0aW9uKCl7JHRyYWNldXJSdW50aW1lLnN1cGVyR2V0KHRoaXMsXy5wcm90b3R5cGUsImRpc2FibGVQbHVnaW4iKS5jYWxsKHRoaXMpfSxyZWdpc3Rlckxpc3RlbmVyczpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwibW91c2VvdmVyIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbk1vdXNlT3Zlcih0KX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQsIm1vdXNlZG93biIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25Nb3VzZURvd24odCl9KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCJtb3VzZW1vdmUiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uTW91c2VNb3ZlKHQpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwibW91c2V1cCIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25Nb3VzZVVwKHQpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmVkaXRvci5nZXRJbnB1dEVsZW1lbnQoKSwiYmx1ciIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25FZGl0b3JCbHVyKHQpfSl9LHNldFJhbmdlOmZ1bmN0aW9uKGUpe3RoaXMucmFuZ2U9ZX0sY2xlYXJSYW5nZTpmdW5jdGlvbigpe3RoaXMucmFuZ2U9e319LHRhcmdldElzQ2VsbFdpdGhDb21tZW50OmZ1bmN0aW9uKGUpe3JldHVybiBwKGUudGFyZ2V0LCJodENvbW1lbnRDZWxsIikmJmQoZS50YXJnZXQsW3RoaXMuaG90LnJvb3RFbGVtZW50XSk/ITA6ITF9LHRhcmdldElzQ29tbWVudFRleHRBcmVhOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmVkaXRvci5nZXRJbnB1dEVsZW1lbnQoKT09PWUudGFyZ2V0fSxzYXZlQ29tbWVudDpmdW5jdGlvbigpe2lmKCF0aGlzLnJhbmdlLmZyb20pdGhyb3cgbmV3IEVycm9yKCdCZWZvcmUgdXNpbmcgdGhpcyBtZXRob2QsIGZpcnN0IHNldCBjZWxsIHJhbmdlIChob3QuZ2V0UGx1Z2luKCJjb21tZW50Iikuc2V0UmFuZ2UoKSknKTt2YXIgZT10aGlzLmVkaXRvci5nZXRWYWx1ZSgpLHQ9dGhpcy5yYW5nZS5mcm9tLnJvdyxuPXRoaXMucmFuZ2UuZnJvbS5jb2w7dGhpcy5ob3Quc2V0Q2VsbE1ldGEodCxuLCJjb21tZW50IixlKSx0aGlzLmhvdC5yZW5kZXIoKX0sc2F2ZUNvbW1lbnRBdENlbGw6ZnVuY3Rpb24oZSx0KXt0aGlzLnNldFJhbmdlKHtmcm9tOm5ldyB2KGUsdCl9KSx0aGlzLnNhdmVDb21tZW50KCl9LHJlbW92ZUNvbW1lbnQ6ZnVuY3Rpb24oKXtpZighdGhpcy5yYW5nZS5mcm9tKXRocm93IG5ldyBFcnJvcignQmVmb3JlIHVzaW5nIHRoaXMgbWV0aG9kLCBmaXJzdCBzZXQgY2VsbCByYW5nZSAoaG90LmdldFBsdWdpbigiY29tbWVudCIpLnNldFJhbmdlKCkpJyk7dGhpcy5ob3QucmVtb3ZlQ2VsbE1ldGEodGhpcy5yYW5nZS5mcm9tLnJvdyx0aGlzLnJhbmdlLmZyb20uY29sLCJjb21tZW50IiksdGhpcy5ob3QucmVuZGVyKCksdGhpcy5oaWRlKCl9LHJlbW92ZUNvbW1lbnRBdENlbGw6ZnVuY3Rpb24oZSx0KXt0aGlzLnNldFJhbmdlKHtmcm9tOm5ldyB2KGUsdCl9KSx0aGlzLnJlbW92ZUNvbW1lbnQoKX0sc2hvdzpmdW5jdGlvbigpe2lmKCF0aGlzLnJhbmdlLmZyb20pdGhyb3cgbmV3IEVycm9yKCdCZWZvcmUgdXNpbmcgdGhpcyBtZXRob2QsIGZpcnN0IHNldCBjZWxsIHJhbmdlIChob3QuZ2V0UGx1Z2luKCJjb21tZW50Iikuc2V0UmFuZ2UoKSknKTt2YXIgZT10aGlzLmhvdC5nZXRDZWxsTWV0YSh0aGlzLnJhbmdlLmZyb20ucm93LHRoaXMucmFuZ2UuZnJvbS5jb2wpO3JldHVybiB0aGlzLnJlZnJlc2hFZGl0b3JQb3NpdGlvbighMCksdGhpcy5lZGl0b3Iuc2V0VmFsdWUoZS5jb21tZW50fHwiIiksdGhpcy5lZGl0b3Iuc2hvdygpLCEwfSxzaG93QXRDZWxsOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuc2V0UmFuZ2Uoe2Zyb206bmV3IHYoZSx0KX0pLHRoaXMuc2hvdygpfSxoaWRlOmZ1bmN0aW9uKCl7dGhpcy5lZGl0b3IuaGlkZSgpfSxyZWZyZXNoRWRpdG9yUG9zaXRpb246ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiExO2lmKGV8fHRoaXMucmFuZ2UuZnJvbSYmdGhpcy5lZGl0b3IuaXNWaXNpYmxlKCkpe3ZhciB0PXRoaXMuaG90LnZpZXcud3Qud3RUYWJsZS5nZXRDZWxsKHRoaXMucmFuZ2UuZnJvbSksbj1nKHQpLG89dGhpcy5ob3QuZ2V0Q29sV2lkdGgodGhpcy5yYW5nZS5mcm9tLmNvbCkscj1uLnRvcCxpPW4ubGVmdCxzPTAsYT0wO3RoaXMuaG90LnZpZXcud3Qud3RWaWV3cG9ydC5oYXNWZXJ0aWNhbFNjcm9sbCgpJiYoci09dGhpcy5ob3Qudmlldy53dC53dE92ZXJsYXlzLnRvcE92ZXJsYXkuZ2V0U2Nyb2xsUG9zaXRpb24oKSxzPTIwKSx0aGlzLmhvdC52aWV3Lnd0Lnd0Vmlld3BvcnQuaGFzSG9yaXpvbnRhbFNjcm9sbCgpJiYoaS09dGhpcy5ob3Qudmlldy53dC53dE92ZXJsYXlzLmxlZnRPdmVybGF5LmdldFNjcm9sbFBvc2l0aW9uKCksYT0yMCk7dmFyIGw9aStvLHU9cixjPXRoaXMuaG90LnZpZXcud3Qud3RUYWJsZS5ob2xkZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksZD17bGVmdDpjLmxlZnQraCgpK2EscmlnaHQ6Yy5yaWdodCtoKCktMTUsdG9wOmMudG9wK2YoKStzLGJvdHRvbTpjLmJvdHRvbStmKCl9O2w8PWQubGVmdHx8bD5kLnJpZ2h0fHx1PD1kLnRvcHx8dT5kLmJvdHRvbT90aGlzLmhpZGUoKTp0aGlzLmVkaXRvci5zZXRQb3NpdGlvbihsLHUpfX0sb25Nb3VzZURvd246ZnVuY3Rpb24oZSl7dGhpcy5tb3VzZURvd249ITAsdGhpcy5ob3QudmlldyYmdGhpcy5ob3Qudmlldy53dCYmKHRoaXMuY29udGV4dE1lbnVFdmVudHx8dGhpcy50YXJnZXRJc0NvbW1lbnRUZXh0QXJlYShlKXx8dGhpcy50YXJnZXRJc0NlbGxXaXRoQ29tbWVudChlKXx8dGhpcy5oaWRlKCksdGhpcy5jb250ZXh0TWVudUV2ZW50PSExKX0sb25Nb3VzZU92ZXI6ZnVuY3Rpb24oZSl7aWYoIXRoaXMubW91c2VEb3duJiYhdGhpcy5lZGl0b3IuaXNGb2N1c2VkKCkpaWYodGhpcy50YXJnZXRJc0NlbGxXaXRoQ29tbWVudChlKSl7dmFyIHQ9dGhpcy5ob3Qudmlldy53dC53dFRhYmxlLmdldENvb3JkcyhlLnRhcmdldCksbj17ZnJvbTpuZXcgdih0LnJvdyx0LmNvbCl9O3RoaXMuc2V0UmFuZ2UobiksdGhpcy5zaG93KCl9ZWxzZSB0aGlzLnRhcmdldElzQ29tbWVudFRleHRBcmVhKGUpfHx0aGlzLmVkaXRvci5pc0ZvY3VzZWQoKXx8dGhpcy5oaWRlKCl9LG9uTW91c2VNb3ZlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7dGhpcy50YXJnZXRJc0NvbW1lbnRUZXh0QXJlYShlKSYmKHRoaXMubW91c2VEb3duPSEwLGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKSx0aGlzLnRpbWVyPXNldFRpbWVvdXQoZnVuY3Rpb24oKXt0Lm1vdXNlRG93bj0hMX0sMjAwKSl9LG9uTW91c2VVcDpmdW5jdGlvbihlKXt0aGlzLm1vdXNlRG93bj0hMX0sb25BZnRlclJlbmRlcmVyOmZ1bmN0aW9uKGUsdCl7dC5jb21tZW50JiZjKGUsdC5jb21tZW50ZWRDZWxsQ2xhc3NOYW1lKX0sb25FZGl0b3JCbHVyOmZ1bmN0aW9uKGUpe3RoaXMuc2F2ZUNvbW1lbnQoKX0sY2hlY2tTZWxlY3Rpb25Db21tZW50c0NvbnNpc3RlbmN5OmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3QuZ2V0U2VsZWN0ZWRSYW5nZSgpO2lmKCFlKXJldHVybiExO3ZhciB0PSExLG49ZS5mcm9tO3JldHVybiB0aGlzLmhvdC5nZXRDZWxsTWV0YShuLnJvdyxuLmNvbCkuY29tbWVudCYmKHQ9ITApLHR9LG9uQ29udGV4dE1lbnVBZGRDb21tZW50OmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMuaG90LmdldFNlbGVjdGVkUmFuZ2UoKTt0aGlzLmNvbnRleHRNZW51RXZlbnQ9ITAsdGhpcy5zZXRSYW5nZSh7ZnJvbTp0LmZyb219KSx0aGlzLnNob3coKSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZS5ob3QmJihlLmhvdC5kZXNlbGVjdENlbGwoKSxlLmVkaXRvci5mb2N1cygpKX0sMTApfSxvbkNvbnRleHRNZW51UmVtb3ZlQ29tbWVudDpmdW5jdGlvbihlLHQpe3RoaXMuY29udGV4dE1lbnVFdmVudD0hMCx0aGlzLnJlbW92ZUNvbW1lbnRBdENlbGwodC5zdGFydC5yb3csdC5zdGFydC5jb2wpfSxhZGRUb0NvbnRleHRNZW51OmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7ZS5pdGVtcy5wdXNoKEhhbmRzb250YWJsZS5wbHVnaW5zLkNvbnRleHRNZW51LlNFUEFSQVRPUix7a2V5OiJjb21tZW50c0FkZEVkaXQiLG5hbWU6ZnVuY3Rpb24oKXtyZXR1cm4gdC5jaGVja1NlbGVjdGlvbkNvbW1lbnRzQ29uc2lzdGVuY3koKT8iRWRpdCBDb21tZW50IjoiQWRkIENvbW1lbnQifSxjYWxsYmFjazpmdW5jdGlvbigpe3JldHVybiB0Lm9uQ29udGV4dE1lbnVBZGRDb21tZW50KCl9LGRpc2FibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0U2VsZWN0ZWQoKT8hMTohMH19LHtrZXk6ImNvbW1lbnRzUmVtb3ZlIixuYW1lOmZ1bmN0aW9uKCl7cmV0dXJuIkRlbGV0ZSBDb21tZW50In0sY2FsbGJhY2s6ZnVuY3Rpb24oZSxuKXtyZXR1cm4gdC5vbkNvbnRleHRNZW51UmVtb3ZlQ29tbWVudChlLG4pfSxkaXNhYmxlZDpmdW5jdGlvbigpe3JldHVybiF0LmNoZWNrU2VsZWN0aW9uQ29tbWVudHNDb25zaXN0ZW5jeSgpfX0pfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5lZGl0b3ImJnRoaXMuZWRpdG9yLmRlc3Ryb3koKSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxfLnByb3RvdHlwZSwiZGVzdHJveSIpLmNhbGwodGhpcyl9fSx7fSxiKSx5KCJjb21tZW50cyIsUil9LHsiM3JkcGFydHkvd2Fsa29udGFibGUvc3JjL2NlbGwvY29vcmRzIjo1LF9iYXNlOjU4LGNvbW1lbnRFZGl0b3I6NjMsZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSxwbHVnaW5zOjU3fV0sNjU6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQpe3ZhciBuO3JldHVybiBpKHQsZnVuY3Rpb24odCl7dmFyIG89dC5rZXk/dC5rZXkuc3BsaXQoIjoiKTpudWxsO3JldHVybiBBcnJheS5pc0FycmF5KG8pJiZvWzFdPT09ZT8obj10LCExKTp2b2lkIDB9KSxufU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0NvbW1hbmRFeGVjdXRvcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHN9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgcixpPShyPWUoImhlbHBlcnMvYXJyYXkiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLmFycmF5RWFjaCxzPWZ1bmN0aW9uKGUpe3RoaXMuaG90PWUsdGhpcy5jb21tYW5kcz17fSx0aGlzLmNvbW1vbkNhbGxiYWNrPW51bGx9OyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhzLHtyZWdpc3RlckNvbW1hbmQ6ZnVuY3Rpb24oZSx0KXt0aGlzLmNvbW1hbmRzW2VdPXR9LHNldENvbW1vbkNhbGxiYWNrOmZ1bmN0aW9uKGUpe3RoaXMuY29tbW9uQ2FsbGJhY2s9ZX0sZXhlY3V0ZTpmdW5jdGlvbihlKXtmb3IodmFyIHQ9W10sbj0xO248YXJndW1lbnRzLmxlbmd0aDtuKyspdFtuLTFdPWFyZ3VtZW50c1tuXTt2YXIgcj10aGlzLHM9ZS5zcGxpdCgiOiIpO2U9c1swXTt2YXIgYT0yPT09cy5sZW5ndGg/c1sxXTpudWxsLGw9dGhpcy5jb21tYW5kc1tlXTtpZighbCl0aHJvdyBuZXcgRXJyb3IoIk1lbnUgY29tbWFuZCAnIitlKyInIG5vdCBleGlzdHMuIik7aWYoYSYmbC5zdWJtZW51JiYobD1vKGEsbC5zdWJtZW51Lml0ZW1zKSksbC5kaXNhYmxlZCE9PSEwJiYoImZ1bmN0aW9uIiE9dHlwZW9mIGwuZGlzYWJsZWR8fGwuZGlzYWJsZWQuY2FsbCh0aGlzLmhvdCkhPT0hMCkmJiFsLmhhc093blByb3BlcnR5KCJzdWJtZW51Iikpe3ZhciB1PVtdOyJmdW5jdGlvbiI9PXR5cGVvZiBsLmNhbGxiYWNrJiZ1LnB1c2gobC5jYWxsYmFjayksImZ1bmN0aW9uIj09dHlwZW9mIHRoaXMuY29tbW9uQ2FsbGJhY2smJnUucHVzaCh0aGlzLmNvbW1vbkNhbGxiYWNrKSx0LnVuc2hpZnQocy5qb2luKCI6IikpLGkodSxmdW5jdGlvbihlKXtyZXR1cm4gZS5hcHBseShyLmhvdCx0KX0pfX19LHt9KX0seyJoZWxwZXJzL2FycmF5Ijo0Mn1dLDY2OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0NvbnRleHRNZW51OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gTH19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbCx1LGMsZCxoLGYscD0obz1lKCJfYmFzZSIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSlbImRlZmF1bHQiXSxnPShyPWUoImhlbHBlcnMvYXJyYXkiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLmFycmF5RWFjaCxtPShpPWUoImNvbW1hbmRFeGVjdXRvciIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuQ29tbWFuZEV4ZWN1dG9yLHY9KHM9ZSgiZXZlbnRNYW5hZ2VyIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5FdmVudE1hbmFnZXIsdz0oYT1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5oYXNDbGFzcyx5PShsPWUoIml0ZW1zRmFjdG9yeSIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSkuSXRlbXNGYWN0b3J5LGI9KHU9ZSgibWVudSIpLHUmJnUuX19lc01vZHVsZSYmdXx8eyJkZWZhdWx0Ijp1fSkuTWVudSxDPShjPWUoImhlbHBlcnMvb2JqZWN0IiksYyYmYy5fX2VzTW9kdWxlJiZjfHx7ImRlZmF1bHQiOmN9KSxSPShDLm9iamVjdEVhY2gsQy5taXhpbiwoZD1lKCJwbHVnaW5zIiksZCYmZC5fX2VzTW9kdWxlJiZkfHx7ImRlZmF1bHQiOmR9KS5yZWdpc3RlclBsdWdpbiksXz0oaD1lKCJoZWxwZXJzL2RvbS9ldmVudCIpLGgmJmguX19lc01vZHVsZSYmaHx8eyJkZWZhdWx0IjpofSkuc3RvcFByb3BhZ2F0aW9uLFM9KGY9ZSgicHJlZGVmaW5lZEl0ZW1zIiksZiYmZi5fX2VzTW9kdWxlJiZmfHx7ImRlZmF1bHQiOmZ9KSxFPVMuUk9XX0FCT1ZFLFQ9Uy5ST1dfQkVMT1csTz1TLkNPTFVNTl9MRUZULE09Uy5DT0xVTU5fUklHSFQsaz1TLlJFTU9WRV9ST1csSD1TLlJFTU9WRV9DT0xVTU4sRD1TLlVORE8seD1TLlJFRE8sQT1TLlJFQURfT05MWSxQPVMuQUxJR05NRU5ULE49Uy5TRVBBUkFUT1IsTD0oUy5wcmVkZWZpbmVkSXRlbXMsZnVuY3Rpb24oZSl7JHRyYWNldXJSdW50aW1lLnN1cGVyQ29uc3RydWN0b3IoVykuY2FsbCh0aGlzLGUpLHRoaXMuZXZlbnRNYW5hZ2VyPW5ldyB2KHRoaXMpLHRoaXMuY29tbWFuZEV4ZWN1dG9yPW5ldyBtKHRoaXMuaG90KSx0aGlzLml0ZW1zRmFjdG9yeT1udWxsLHRoaXMubWVudT1udWxsfSksVz1MOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhMLHtpc0VuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5jb250ZXh0TWVudX0sZW5hYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcztpZighdGhpcy5lbmFibGVkKXt0aGlzLml0ZW1zRmFjdG9yeT1uZXcgeSh0aGlzLmhvdCxXLkRFRkFVTFRfSVRFTVMpO3ZhciB0PXRoaXMuaG90LmdldFNldHRpbmdzKCkuY29udGV4dE1lbnUsbj17aXRlbXM6dGhpcy5pdGVtc0ZhY3RvcnkuZ2V0VmlzaWJsZUl0ZW1zKHQpfTt0aGlzLnJlZ2lzdGVyRXZlbnRzKCksImZ1bmN0aW9uIj09dHlwZW9mIHQuY2FsbGJhY2smJnRoaXMuY29tbWFuZEV4ZWN1dG9yLnNldENvbW1vbkNhbGxiYWNrKHQuY2FsbGJhY2spLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLFcucHJvdG90eXBlLCJlbmFibGVQbHVnaW4iKS5jYWxsKHRoaXMpLHRoaXMuY2FsbE9uUGx1Z2luc1JlYWR5KGZ1bmN0aW9uKCl7ZS5ob3QucnVuSG9va3MoImFmdGVyQ29udGV4dE1lbnVEZWZhdWx0T3B0aW9ucyIsbiksZS5pdGVtc0ZhY3Rvcnkuc2V0UHJlZGVmaW5lZEl0ZW1zKG4uaXRlbXMpO3ZhciBvPWUuaXRlbXNGYWN0b3J5LmdldFZpc2libGVJdGVtcyh0KTtlLm1lbnU9bmV3IGIoZS5ob3Qse2NsYXNzTmFtZToiaHRDb250ZXh0TWVudSJ9KSxlLm1lbnUuc2V0TWVudUl0ZW1zKG8pLGUubWVudS5hZGRMb2NhbEhvb2soImFmdGVyT3BlbiIsZnVuY3Rpb24oKXtyZXR1cm4gZS5vbk1lbnVBZnRlck9wZW4oKX0pLGUubWVudS5hZGRMb2NhbEhvb2soImFmdGVyQ2xvc2UiLGZ1bmN0aW9uKCl7cmV0dXJuIGUub25NZW51QWZ0ZXJDbG9zZSgpfSksZS5tZW51LmFkZExvY2FsSG9vaygiZXhlY3V0ZUNvbW1hbmQiLGZ1bmN0aW9uKCl7Zm9yKHZhciB0PVtdLG49MDtuPGFyZ3VtZW50cy5sZW5ndGg7bisrKXRbbl09YXJndW1lbnRzW25dO3JldHVybiBlLmV4ZWN1dGVDb21tYW5kLmFwcGx5KGUsdCl9KSxnKG8sZnVuY3Rpb24odCl7cmV0dXJuIGUuY29tbWFuZEV4ZWN1dG9yLnJlZ2lzdGVyQ29tbWFuZCh0LmtleSx0KX0pfSl9fSxkaXNhYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dGhpcy5jbG9zZSgpLHRoaXMubWVudSYmKHRoaXMubWVudS5kZXN0cm95KCksdGhpcy5tZW51PW51bGwpLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLFcucHJvdG90eXBlLCJkaXNhYmxlUGx1Z2luIikuY2FsbCh0aGlzKX0scmVnaXN0ZXJFdmVudHM6ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3RoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ob3Qucm9vdEVsZW1lbnQsImNvbnRleHRtZW51IixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbkNvbnRleHRNZW51KHQpfSl9LG9wZW46ZnVuY3Rpb24oZSl7dGhpcy5tZW51JiYodGhpcy5tZW51Lm9wZW4oKSx0aGlzLm1lbnUuc2V0UG9zaXRpb24oZSksdGhpcy5tZW51LmhvdE1lbnUuaXNIb3RUYWJsZUVudj10aGlzLmhvdC5pc0hvdFRhYmxlRW52LEhhbmRzb250YWJsZS5ldmVudE1hbmFnZXIuaXNIb3RUYWJsZUVudj10aGlzLmhvdC5pc0hvdFRhYmxlRW52KX0sY2xvc2U6ZnVuY3Rpb24oKXt0aGlzLm1lbnUmJnRoaXMubWVudS5jbG9zZSgpfSxleGVjdXRlQ29tbWFuZDpmdW5jdGlvbigpe2Zvcih2YXIgZT1bXSx0PTA7dDxhcmd1bWVudHMubGVuZ3RoO3QrKyllW3RdPWFyZ3VtZW50c1t0XTt0aGlzLmNvbW1hbmRFeGVjdXRvci5leGVjdXRlLmFwcGx5KHRoaXMuY29tbWFuZEV4ZWN1dG9yLGUpfSxvbkNvbnRleHRNZW51OmZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSl7cmV0dXJuIlREIj09PWUubm9kZU5hbWV8fCJURCI9PT1lLnBhcmVudE5vZGUubm9kZU5hbWV9dmFyIG49dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKSxvPW4ucm93SGVhZGVycyxyPW4uY29sSGVhZGVycyxpPWUucmVhbFRhcmdldDtpZih0aGlzLmNsb3NlKCksZS5wcmV2ZW50RGVmYXVsdCgpLF8oZSksb3x8cil7aWYobyYmcil7dmFyIHM9aS5wYXJlbnROb2RlLnF1ZXJ5U2VsZWN0b3JBbGwoIi5jb3JuZXJIZWFkZXIiKS5sZW5ndGg+MDtpZihzKXJldHVybn19ZWxzZSBpZighKHQoaSl8fHcoaSwiY3VycmVudCIpJiZ3KGksInd0Qm9yZGVyIikpKXJldHVybjt0aGlzLm9wZW4oZSl9LG9uTWVudUFmdGVyT3BlbjpmdW5jdGlvbigpe3RoaXMuaG90LnJ1bkhvb2tzKCJhZnRlckNvbnRleHRNZW51U2hvdyIsdGhpcyl9LG9uTWVudUFmdGVyQ2xvc2U6ZnVuY3Rpb24oKXt0aGlzLmhvdC5saXN0ZW4oKSx0aGlzLmhvdC5ydW5Ib29rcygiYWZ0ZXJDb250ZXh0TWVudUhpZGUiLHRoaXMpfSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5jbG9zZSgpLHRoaXMubWVudSYmdGhpcy5tZW51LmRlc3Ryb3koKSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxXLnByb3RvdHlwZSwiZGVzdHJveSIpLmNhbGwodGhpcyl9fSx7Z2V0IERFRkFVTFRfSVRFTVMoKXtyZXR1cm5bRSxULE4sTyxNLE4sayxILE4sRCx4LE4sQSxOLFBdfX0scCksTC5TRVBBUkFUT1I9e25hbWU6Tn0sSGFuZHNvbnRhYmxlLmhvb2tzLnJlZ2lzdGVyKCJhZnRlckNvbnRleHRNZW51RGVmYXVsdE9wdGlvbnMiKSxIYW5kc29udGFibGUuaG9va3MucmVnaXN0ZXIoImFmdGVyQ29udGV4dE1lbnVTaG93IiksSGFuZHNvbnRhYmxlLmhvb2tzLnJlZ2lzdGVyKCJhZnRlckNvbnRleHRNZW51SGlkZSIpLEhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcigiYWZ0ZXJDb250ZXh0TWVudUV4ZWN1dGUiKSxSKCJjb250ZXh0TWVudSIsTCl9LHtfYmFzZTo1OCxjb21tYW5kRXhlY3V0b3I6NjUsZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2FycmF5Ijo0MiwiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvZG9tL2V2ZW50Ijo0NiwiaGVscGVycy9vYmplY3QiOjUwLGl0ZW1zRmFjdG9yeTo2OCxtZW51OjY5LHBsdWdpbnM6NTcscHJlZGVmaW5lZEl0ZW1zOjcwfV0sNjc6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7Q3Vyc29yOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZH19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaT0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxzPWkuZ2V0V2luZG93U2Nyb2xsTGVmdCxhPWkuZ2V0V2luZG93U2Nyb2xsVG9wLGw9KHI9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLHU9bC5wYWdlWCxjPWwucGFnZVksZD1mdW5jdGlvbihlKXt2YXIgdCxuLG8scixpLGwsZCxoLGY9YSgpLHA9cygpO3RoaXMudHlwZT10aGlzLmdldFNvdXJjZVR5cGUoZSksImxpdGVyYWwiPT09dGhpcy50eXBlPyh0PXBhcnNlSW50KGUudG9wLDEwKSxvPXBhcnNlSW50KGUubGVmdCwxMCksZD1lLmhlaWdodCxoPWUud2lkdGgpOiJldmVudCI9PT10aGlzLnR5cGUmJih0PXBhcnNlSW50KGMoZSksMTApLG89cGFyc2VJbnQodShlKSwxMCksZD1lLnRhcmdldC5jbGllbnRIZWlnaHQsaD1lLnRhcmdldC5jbGllbnRXaWR0aCksbj10LWYscj1vLXAsaT1mLGw9cCx0aGlzLnRvcD10LHRoaXMudG9wUmVsYXRpdmU9bix0aGlzLmxlZnQ9byx0aGlzLmxlZnRSZWxhdGl2ZT1yLHRoaXMuc2Nyb2xsVG9wPWksdGhpcy5zY3JvbGxMZWZ0PWwsdGhpcy5jZWxsSGVpZ2h0PWQsdGhpcy5jZWxsV2lkdGg9aH07JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGQse2dldFNvdXJjZVR5cGU6ZnVuY3Rpb24oZSl7dmFyIHQ9ImxpdGVyYWwiO3JldHVybiBlIGluc3RhbmNlb2YgRXZlbnQmJih0PSJldmVudCIpLHR9LGZpdHNBYm92ZTpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy50b3BSZWxhdGl2ZT49ZS5vZmZzZXRIZWlnaHR9LGZpdHNCZWxvdzpmdW5jdGlvbihlKXt2YXIgdD12b2lkIDAhPT1hcmd1bWVudHNbMV0/YXJndW1lbnRzWzFdOndpbmRvdy5pbm5lckhlaWdodDtyZXR1cm4gdGhpcy50b3BSZWxhdGl2ZStlLm9mZnNldEhlaWdodDw9dH0sZml0c09uUmlnaHQ6ZnVuY3Rpb24oZSl7dmFyIHQ9dm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTp3aW5kb3cuaW5uZXJXaWR0aDtyZXR1cm4gdGhpcy5sZWZ0UmVsYXRpdmUrdGhpcy5jZWxsV2lkdGgrZS5vZmZzZXRXaWR0aDw9dH0sZml0c09uTGVmdDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5sZWZ0UmVsYXRpdmU+PWUub2Zmc2V0V2lkdGh9fSx7fSksSGFuZHNvbnRhYmxlLnBsdWdpbnMudXRpbHM9SGFuZHNvbnRhYmxlLnBsdWdpbnMudXRpbHN8fHt9LEhhbmRzb250YWJsZS5wbHVnaW5zLnV0aWxzLkN1cnNvcj1kfSx7ImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDZ9XSw2ODpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKCl7dmFyIGU9dm9pZCAwIT09YXJndW1lbnRzWzBdP2FyZ3VtZW50c1swXTpudWxsLHQ9dm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpbXSxuPXZvaWQgMCE9PWFyZ3VtZW50c1syXT9hcmd1bWVudHNbMl06e30sbz1bXTtyZXR1cm4gZSYmZS5pdGVtcz9lPWUuaXRlbXM6QXJyYXkuaXNBcnJheShlKXx8KGU9dCksdShlKT9sKGUsZnVuY3Rpb24oZSx0KXt2YXIgcj1uWyJzdHJpbmciPT10eXBlb2YgZT9lOnRdO3J8fChyPWUpLHUoZSk/YyhyLGUpOiJzdHJpbmciPT10eXBlb2YgciYmKHI9e25hbWU6cn0pLHZvaWQgMD09PXIua2V5JiYoci5rZXk9dCksby5wdXNoKHIpfSk6ZChlLGZ1bmN0aW9uKGUsdCl7dmFyIHI9bltlXTshciYmcC5pbmRleE9mKGUpPj0wfHwocnx8KHI9e25hbWU6ZSxrZXk6dCsiIn0pLHUoZSkmJmMocixlKSx2b2lkIDA9PT1yLmtleSYmKHIua2V5PXQpLG8ucHVzaChyKSl9KSxvWzBdLm5hbWU9PT1mJiZvLnNoaWZ0KCksb31PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtJdGVtc0ZhY3Rvcnk6e2dldDpmdW5jdGlvbigpe3JldHVybiBtfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGE9KHI9ZSgiaGVscGVycy9vYmplY3QiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLGw9YS5vYmplY3RFYWNoLHU9YS5pc09iamVjdCxjPWEuZXh0ZW5kLGQ9KGk9ZSgiaGVscGVycy9hcnJheSIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuYXJyYXlFYWNoLGg9KHM9ZSgicHJlZGVmaW5lZEl0ZW1zIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KSxmPWguU0VQQVJBVE9SLHA9aC5JVEVNUyxnPWgucHJlZGVmaW5lZEl0ZW1zLG09ZnVuY3Rpb24oZSl7dmFyIHQ9dm9pZCAwIT09YXJndW1lbnRzWzFdP2FyZ3VtZW50c1sxXTpudWxsO3RoaXMuaG90PWUsdGhpcy5wcmVkZWZpbmVkSXRlbXM9ZygpLHRoaXMuZGVmYXVsdE9yZGVyUGF0dGVybj10fTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MobSx7c2V0UHJlZGVmaW5lZEl0ZW1zOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMsbj17fTt0aGlzLmRlZmF1bHRPcmRlclBhdHRlcm4ubGVuZ3RoPTAsbChlLGZ1bmN0aW9uKGUsbyl7dmFyIHI9IiI7ZS5uYW1lPT09Zj8obltmXT1lLHI9Zik6aXNOYU4ocGFyc2VJbnQobywxMCkpPyhlLmtleT12b2lkIDA9PT1lLmtleT9vOmUua2V5LG5bb109ZSxyPWUua2V5KToobltlLmtleV09ZSxyPWUua2V5KSx0LmRlZmF1bHRPcmRlclBhdHRlcm4ucHVzaChyKX0pLHRoaXMucHJlZGVmaW5lZEl0ZW1zPW59LGdldFZpc2libGVJdGVtczpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06bnVsbCx0PXRoaXMsbj17fTtyZXR1cm4gbCh0aGlzLnByZWRlZmluZWRJdGVtcyxmdW5jdGlvbihlLG8peyghZS5oaWRkZW58fGUuaGlkZGVuJiYhZS5oaWRkZW4uYXBwbHkodC5ob3QpKSYmKG5bb109ZSl9KSxvKGUsdGhpcy5kZWZhdWx0T3JkZXJQYXR0ZXJuLG4pfSxnZXRJdGVtczpmdW5jdGlvbigpewp2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOm51bGw7cmV0dXJuIG8oZSx0aGlzLmRlZmF1bHRPcmRlclBhdHRlcm4sdGhpcy5wcmVkZWZpbmVkSXRlbXMpfX0se30pfSx7ImhlbHBlcnMvYXJyYXkiOjQyLCJoZWxwZXJzL29iamVjdCI6NTAscHJlZGVmaW5lZEl0ZW1zOjcwfV0sNjk6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7TWVudTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIFd9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscyxhLGwsdSxjLGQsaCxmPShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLHA9Zi5hZGRDbGFzcyxnPWYuZW1wdHksbT1mLmZhc3RJbm5lckhUTUwsdj0oZi5nZXRDb21wdXRlZFN0eWxlLGYuZ2V0U2Nyb2xsYmFyV2lkdGgpLHc9KGYuZ2V0V2luZG93U2Nyb2xsTGVmdCxmLmdldFdpbmRvd1Njcm9sbFRvcCxmLmhhc0NsYXNzLGYuaXNDaGlsZE9mKSx5PWYucmVtb3ZlQ2xhc3MsYj0ocj1lKCJoZWxwZXJzL2FycmF5IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5hcnJheUVhY2gsQz0oaT1lKCJjdXJzb3IiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLkN1cnNvcixSPShzPWUoImV2ZW50TWFuYWdlciIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkuRXZlbnRNYW5hZ2VyLF89KGE9ZSgiaGVscGVycy9vYmplY3QiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLFM9KF8uZXh0ZW5kLF8uaXNPYmplY3QsXy5vYmplY3RFYWNoLF8ubWl4aW4pLEU9KGw9ZSgidXRpbHMiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLFQ9RS5pc1NlcGFyYXRvcixPPUUuaXNEaXNhYmxlZCxNPUUuaXNTZWxlY3Rpb25EaXNhYmxlZCxrPUUuaGFzU3ViTWVudSxIPUUubm9ybWFsaXplU2VsZWN0aW9uLEQ9KHU9ZSgiaGVscGVycy91bmljb2RlIiksdSYmdS5fX2VzTW9kdWxlJiZ1fHx7ImRlZmF1bHQiOnV9KS5LRVlfQ09ERVMseD0oYz1lKCJtaXhpbnMvbG9jYWxIb29rcyIpLGMmJmMuX19lc01vZHVsZSYmY3x8eyJkZWZhdWx0IjpjfSkubG9jYWxIb29rcyxBPShkPWUoInByZWRlZmluZWRJdGVtcyIpLGQmJmQuX19lc01vZHVsZSYmZHx8eyJkZWZhdWx0IjpkfSksUD1BLlNFUEFSQVRPUixOPShBLnByZWRlZmluZWRJdGVtcyxoPWUoImhlbHBlcnMvZG9tL2V2ZW50IiksaCYmaC5fX2VzTW9kdWxlJiZofHx7ImRlZmF1bHQiOmh9KSxMPShOLnN0b3BQcm9wYWdhdGlvbixOLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiksVz0oTi5wYWdlWCxOLnBhZ2VZLGZ1bmN0aW9uKGUpe3ZhciB0PXZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06e3BhcmVudDpudWxsLG5hbWU6bnVsbCxjbGFzc05hbWU6IiIsa2VlcEluVmlld3BvcnQ6ITB9O3RoaXMuaG90PWUsdGhpcy5vcHRpb25zPXQsdGhpcy5ldmVudE1hbmFnZXI9bmV3IFIodGhpcyksdGhpcy5jb250YWluZXI9dGhpcy5jcmVhdGVDb250YWluZXIodGhpcy5vcHRpb25zLm5hbWUpLHRoaXMuaG90TWVudT1udWxsLHRoaXMuaG90U3ViTWVudXM9e30sdGhpcy5wYXJlbnRNZW51PXRoaXMub3B0aW9ucy5wYXJlbnR8fG51bGwsdGhpcy5tZW51SXRlbXM9bnVsbCx0aGlzLm9yaWdPdXRzaWRlQ2xpY2tEZXNlbGVjdHM9bnVsbCx0aGlzLl9hZnRlclNjcm9sbENhbGxiYWNrPW51bGwsdGhpcy5yZWdpc3RlckV2ZW50cygpfSksST1XOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhXLHtyZWdpc3RlckV2ZW50czpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIm1vdXNlZG93biIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25Eb2N1bWVudE1vdXNlRG93bih0KX0pfSxzZXRNZW51SXRlbXM6ZnVuY3Rpb24oZSl7dGhpcy5tZW51SXRlbXM9ZX0saXNTdWJNZW51OmZ1bmN0aW9uKCl7cmV0dXJuIG51bGwhPT10aGlzLnBhcmVudE1lbnV9LG9wZW46ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3RoaXMuY29udGFpbmVyLnJlbW92ZUF0dHJpYnV0ZSgic3R5bGUiKSx0aGlzLmNvbnRhaW5lci5zdHlsZS5kaXNwbGF5PSJibG9jayI7dmFyIHQ9e2RhdGE6dGhpcy5tZW51SXRlbXMsY29sSGVhZGVyczohMSxjb2xXaWR0aHM6WzIwMF0sYXV0b1Jvd1NpemU6ITEscmVhZE9ubHk6ITAsY29weVBhc3RlOiExLGNvbHVtbnM6W3tkYXRhOiJuYW1lIixyZW5kZXJlcjpmdW5jdGlvbih0LG4sbyxyLGkscyl7cmV0dXJuIGUubWVudUl0ZW1SZW5kZXJlcih0LG4sbyxyLGkscyl9fV0scmVuZGVyQWxsUm93czohMCxmcmFnbWVudFNlbGVjdGlvbjoiY2VsbCIsYmVmb3JlS2V5RG93bjpmdW5jdGlvbih0KXtyZXR1cm4gZS5vbkJlZm9yZUtleURvd24odCl9LGFmdGVyT25DZWxsTW91c2VPdmVyOmZ1bmN0aW9uKHQsbixvKXtyZXR1cm4gZS5vcGVuU3ViTWVudShuLnJvdyl9fTt0aGlzLm9yaWdPdXRzaWRlQ2xpY2tEZXNlbGVjdHM9dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5vdXRzaWRlQ2xpY2tEZXNlbGVjdHMsdGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5vdXRzaWRlQ2xpY2tEZXNlbGVjdHM9ITEsdGhpcy5ob3RNZW51PW5ldyBIYW5kc29udGFibGUuQ29yZSh0aGlzLmNvbnRhaW5lcix0KSx0aGlzLmhvdE1lbnUuYWRkSG9vaygiYWZ0ZXJJbml0IixmdW5jdGlvbigpe3JldHVybiBlLm9uQWZ0ZXJJbml0KCl9KSx0aGlzLmhvdE1lbnUuaW5pdCgpLHRoaXMuaG90TWVudS5saXN0ZW4oKSx0aGlzLmJsb2NrTWFpblRhYmxlQ2FsbGJhY2tzKCksdGhpcy5ydW5Mb2NhbEhvb2tzKCJhZnRlck9wZW4iKX0sY2xvc2U6ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiExO3RoaXMuaXNPcGVuZWQoKSYmKGUmJnRoaXMucGFyZW50TWVudT90aGlzLnBhcmVudE1lbnUuY2xvc2UoKToodGhpcy5jbG9zZUFsbFN1Yk1lbnVzKCksdGhpcy5jb250YWluZXIuc3R5bGUuZGlzcGxheT0ibm9uZSIsdGhpcy5yZWxlYXNlTWFpblRhYmxlQ2FsbGJhY2tzKCksdGhpcy5ob3RNZW51LmRlc3Ryb3koKSx0aGlzLmhvdE1lbnU9bnVsbCx0aGlzLmhvdC5nZXRTZXR0aW5ncygpLm91dHNpZGVDbGlja0Rlc2VsZWN0cz10aGlzLm9yaWdPdXRzaWRlQ2xpY2tEZXNlbGVjdHMsdGhpcy5ydW5Mb2NhbEhvb2tzKCJhZnRlckNsb3NlIikpKX0sb3BlblN1Yk1lbnU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5ob3RNZW51LmdldENlbGwoZSwwKTtpZih0aGlzLmNsb3NlQWxsU3ViTWVudXMoKSwhdHx8IWsodCkpcmV0dXJuITE7dmFyIG49dGhpcy5ob3RNZW51LmdldFNvdXJjZURhdGFBdFJvdyhlKSxvPW5ldyBJKHRoaXMuaG90LHtwYXJlbnQ6dGhpcyxuYW1lOm4ubmFtZSxjbGFzc05hbWU6dGhpcy5vcHRpb25zLmNsYXNzTmFtZX0pO3JldHVybiBvLnNldE1lbnVJdGVtcyhuLnN1Ym1lbnUuaXRlbXMpLG8ub3BlbigpLG8uc2V0UG9zaXRpb24odC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSksdGhpcy5ob3RTdWJNZW51c1tuLmtleV09byxvfSxjbG9zZVN1Yk1lbnU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5ob3RNZW51LmdldFNvdXJjZURhdGFBdFJvdyhlKSxuPXRoaXMuaG90U3ViTWVudXNbdC5rZXldO24mJihuLmRlc3Ryb3koKSxkZWxldGUgdGhpcy5ob3RTdWJNZW51c1t0LmtleV0pfSxjbG9zZUFsbFN1Yk1lbnVzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcztiKHRoaXMuaG90TWVudS5nZXREYXRhKCksZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5jbG9zZVN1Yk1lbnUobil9KX0saXNBbGxTdWJNZW51c0Nsb3NlZDpmdW5jdGlvbigpe3JldHVybiAwPT09T2JqZWN0LmtleXModGhpcy5ob3RTdWJNZW51cykubGVuZ3RofSxkZXN0cm95OmZ1bmN0aW9uKCl7dGhpcy5jbGVhckxvY2FsSG9va3MoKSx0aGlzLmNsb3NlKCksdGhpcy5wYXJlbnRNZW51PW51bGwsdGhpcy5ldmVudE1hbmFnZXIuZGVzdHJveSgpfSxpc09wZW5lZDpmdW5jdGlvbigpe3JldHVybiBudWxsIT09dGhpcy5ob3RNZW51fSxleGVjdXRlQ29tbWFuZDpmdW5jdGlvbihlKXtpZih0aGlzLmlzT3BlbmVkKCkmJnRoaXMuaG90TWVudS5nZXRTZWxlY3RlZCgpKXt2YXIgdD10aGlzLmhvdE1lbnUuZ2V0U291cmNlRGF0YUF0Um93KHRoaXMuaG90TWVudS5nZXRTZWxlY3RlZCgpWzBdKTtpZih0aGlzLnJ1bkxvY2FsSG9va3MoInNlbGVjdCIsdCxlKSx0LmlzQ29tbWFuZCE9PSExKXt2YXIgbj10aGlzLmhvdC5nZXRTZWxlY3RlZFJhbmdlKCksbz1uP0gobik6e307dGhpcy5ydW5Mb2NhbEhvb2tzKCJleGVjdXRlQ29tbWFuZCIsdC5rZXksbyxlKSx0aGlzLmlzU3ViTWVudSgpJiZ0aGlzLnBhcmVudE1lbnUucnVuTG9jYWxIb29rcygiZXhlY3V0ZUNvbW1hbmQiLHQua2V5LG8sZSksdGhpcy5jbG9zZSghMCl9fX0sc2V0UG9zaXRpb246ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IEMoZSk7dGhpcy5vcHRpb25zLmtlZXBJblZpZXdwb3J0Pyh0LmZpdHNCZWxvdyh0aGlzLmNvbnRhaW5lcik/dGhpcy5zZXRQb3NpdGlvbkJlbG93Q3Vyc29yKHQpOnQuZml0c0Fib3ZlKHRoaXMuY29udGFpbmVyKT90aGlzLnNldFBvc2l0aW9uQWJvdmVDdXJzb3IodCk6dGhpcy5zZXRQb3NpdGlvbkJlbG93Q3Vyc29yKHQpLHQuZml0c09uUmlnaHQodGhpcy5jb250YWluZXIpP3RoaXMuc2V0UG9zaXRpb25PblJpZ2h0T2ZDdXJzb3IodCk6dGhpcy5zZXRQb3NpdGlvbk9uTGVmdE9mQ3Vyc29yKHQpKToodGhpcy5zZXRQb3NpdGlvbkJlbG93Q3Vyc29yKHQpLHRoaXMuc2V0UG9zaXRpb25PblJpZ2h0T2ZDdXJzb3IodCkpfSxzZXRQb3NpdGlvbkFib3ZlQ3Vyc29yOmZ1bmN0aW9uKGUpe3ZhciB0PWUudG9wLXRoaXMuY29udGFpbmVyLm9mZnNldEhlaWdodDt0aGlzLmlzU3ViTWVudSgpJiYodD13aW5kb3cuc2Nyb2xsWStlLnRvcCtlLmNlbGxIZWlnaHQtdGhpcy5jb250YWluZXIub2Zmc2V0SGVpZ2h0KzMpLHRoaXMuY29udGFpbmVyLnN0eWxlLnRvcD10KyJweCJ9LHNldFBvc2l0aW9uQmVsb3dDdXJzb3I6ZnVuY3Rpb24oZSl7dmFyIHQ9ZS50b3AtMTt0aGlzLmlzU3ViTWVudSgpJiYodD1lLnRvcCt3aW5kb3cuc2Nyb2xsWS0xKSx0aGlzLmNvbnRhaW5lci5zdHlsZS50b3A9dCsicHgifSxzZXRQb3NpdGlvbk9uUmlnaHRPZkN1cnNvcjpmdW5jdGlvbihlKXt2YXIgdDt0PXRoaXMuaXNTdWJNZW51KCk/d2luZG93LnNjcm9sbFgrMStlLmxlZnQrZS5jZWxsV2lkdGg6MStlLmxlZnQsdGhpcy5jb250YWluZXIuc3R5bGUubGVmdD10KyJweCJ9LHNldFBvc2l0aW9uT25MZWZ0T2ZDdXJzb3I6ZnVuY3Rpb24oZSl7dGhpcy5jb250YWluZXIuc3R5bGUubGVmdD1lLmxlZnQtdGhpcy5jb250YWluZXIub2Zmc2V0V2lkdGgrdigpKzQrInB4In0sc2VsZWN0Rmlyc3RDZWxsOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3RNZW51LmdldENlbGwoMCwwKTtUKGUpfHxPKGUpfHxNKGUpP3RoaXMuc2VsZWN0TmV4dENlbGwoMCwwKTp0aGlzLmhvdE1lbnUuc2VsZWN0Q2VsbCgwLDApfSxzZWxlY3RMYXN0Q2VsbDpmdW5jdGlvbigpe3ZhciBlPXRoaXMuaG90TWVudS5jb3VudFJvd3MoKS0xLHQ9dGhpcy5ob3RNZW51LmdldENlbGwoZSwwKTtUKHQpfHxPKHQpfHxNKHQpP3RoaXMuc2VsZWN0UHJldkNlbGwoZSwwKTp0aGlzLmhvdE1lbnUuc2VsZWN0Q2VsbChlLDApfSxzZWxlY3ROZXh0Q2VsbDpmdW5jdGlvbihlLHQpe3ZhciBuPWUrMSxvPW48dGhpcy5ob3RNZW51LmNvdW50Um93cygpP3RoaXMuaG90TWVudS5nZXRDZWxsKG4sdCk6bnVsbDtvJiYoVChvKXx8TyhvKXx8TShvKT90aGlzLnNlbGVjdE5leHRDZWxsKG4sdCk6dGhpcy5ob3RNZW51LnNlbGVjdENlbGwobix0KSl9LHNlbGVjdFByZXZDZWxsOmZ1bmN0aW9uKGUsdCl7dmFyIG49ZS0xLG89bj49MD90aGlzLmhvdE1lbnUuZ2V0Q2VsbChuLHQpOm51bGw7byYmKFQobyl8fE8obyl8fE0obyk/dGhpcy5zZWxlY3RQcmV2Q2VsbChuLHQpOnRoaXMuaG90TWVudS5zZWxlY3RDZWxsKG4sdCkpfSxtZW51SXRlbVJlbmRlcmVyOmZ1bmN0aW9uKGUsdCxuLG8scixpKXt2YXIgcz10aGlzLGE9ZS5nZXRTb3VyY2VEYXRhQXRSb3cobiksbD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSx1PWZ1bmN0aW9uKGUpe3JldHVybiBlLmhhc093blByb3BlcnR5KCJzdWJtZW51Iil9LGM9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBSZWdFeHAoUCwiaSIpLnRlc3QoZS5uYW1lKX0sZD1mdW5jdGlvbihlKXtyZXR1cm4gZS5kaXNhYmxlZD09PSEwfHwiZnVuY3Rpb24iPT10eXBlb2YgZS5kaXNhYmxlZCYmZS5kaXNhYmxlZC5jYWxsKHMuaG90KT09PSEwfSxoPWZ1bmN0aW9uKGUpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBlLmhpZGRlbiYmZS5oaWRkZW4uY2FsbChzLmhvdCk9PT0hMH0sZj1mdW5jdGlvbihlKXtyZXR1cm4gZS5kaXNhYmxlU2VsZWN0aW9ufSx2PWgoYSk7ImZ1bmN0aW9uIj09dHlwZW9mIGkmJihpPWkuY2FsbCh0aGlzLmhvdCkpLGcodCkscChsLCJodEl0ZW1XcmFwcGVyIiksdC5hcHBlbmRDaGlsZChsKSxjKGEpP3AodCwiaHRTZXBhcmF0b3IiKTp2fHwiZnVuY3Rpb24iIT10eXBlb2YgYS5yZW5kZXJlcj9tKGwsaSk6KHAodCwiaHRDdXN0b21NZW51UmVuZGVyZXIiKSx0LmFwcGVuZENoaWxkKGEucmVuZGVyZXIoZSxsLG4sbyxyLGkpKSksdj90LnBhcmVudE5vZGUmJnAodC5wYXJlbnROb2RlLCJodEhpZGRlbiIpOmQoYSk/KHAodCwiaHREaXNhYmxlZCIpLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIobCwibW91c2VlbnRlciIsZnVuY3Rpb24oKXtyZXR1cm4gZS5kZXNlbGVjdENlbGwoKX0pKTpmKGEpPyhwKHQsImh0U2VsZWN0aW9uRGlzYWJsZWQiKSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGwsIm1vdXNlZW50ZXIiLGZ1bmN0aW9uKCl7cmV0dXJuIGUuZGVzZWxlY3RDZWxsKCl9KSk6dShhKT8ocCh0LCJodFN1Ym1lbnUiKSxmKGEpP3RoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIobCwibW91c2VlbnRlciIsZnVuY3Rpb24oKXtyZXR1cm4gZS5kZXNlbGVjdENlbGwoKX0pOnRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIobCwibW91c2VlbnRlciIsZnVuY3Rpb24oKXtyZXR1cm4gZS5zZWxlY3RDZWxsKG4sbyx2b2lkIDAsdm9pZCAwLHZvaWQgMCwhMSl9KSk6KHkodCwiaHRTdWJtZW51IikseSh0LCJodERpc2FibGVkIiksZihhKT90aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGwsIm1vdXNlZW50ZXIiLGZ1bmN0aW9uKCl7cmV0dXJuIGUuZGVzZWxlY3RDZWxsKCl9KTp0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGwsIm1vdXNlZW50ZXIiLGZ1bmN0aW9uKCl7cmV0dXJuIGUuc2VsZWN0Q2VsbChuLG8sdm9pZCAwLHZvaWQgMCx2b2lkIDAsITEpfSkpfSxjcmVhdGVDb250YWluZXI6ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOm51bGw7ZSYmKGU9ZS5yZXBsYWNlKC8gL2csIl8iKSxlPXRoaXMub3B0aW9ucy5jbGFzc05hbWUrIlN1Yl8iK2UpO3ZhciB0O3JldHVybiB0PWU/ZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLiIrdGhpcy5vcHRpb25zLmNsYXNzTmFtZSsiLiIrZSk6ZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLiIrdGhpcy5vcHRpb25zLmNsYXNzTmFtZSksdHx8KHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2IikscCh0LCJodE1lbnUgIit0aGlzLm9wdGlvbnMuY2xhc3NOYW1lKSxlJiZwKHQsZSksZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImJvZHkiKVswXS5hcHBlbmRDaGlsZCh0KSksdH0sYmxvY2tNYWluVGFibGVDYWxsYmFja3M6ZnVuY3Rpb24oKXt0aGlzLl9hZnRlclNjcm9sbENhbGxiYWNrPWZ1bmN0aW9uKCl7fSx0aGlzLmhvdC5hZGRIb29rKCJhZnRlclNjcm9sbFZlcnRpY2FsbHkiLHRoaXMuX2FmdGVyU2Nyb2xsQ2FsbGJhY2spLHRoaXMuaG90LmFkZEhvb2soImFmdGVyU2Nyb2xsSG9yaXpvbnRhbGx5Iix0aGlzLl9hZnRlclNjcm9sbENhbGxiYWNrKX0scmVsZWFzZU1haW5UYWJsZUNhbGxiYWNrczpmdW5jdGlvbigpe3RoaXMuX2FmdGVyU2Nyb2xsQ2FsbGJhY2smJih0aGlzLmhvdC5yZW1vdmVIb29rKCJhZnRlclNjcm9sbFZlcnRpY2FsbHkiLHRoaXMuX2FmdGVyU2Nyb2xsQ2FsbGJhY2spLHRoaXMuaG90LnJlbW92ZUhvb2soImFmdGVyU2Nyb2xsSG9yaXpvbnRhbGx5Iix0aGlzLl9hZnRlclNjcm9sbENhbGxiYWNrKSx0aGlzLl9hZnRlclNjcm9sbENhbGxiYWNrPW51bGwpfSxvbkJlZm9yZUtleURvd246ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5ob3RNZW51LmdldFNlbGVjdGVkKCksbj0hMTtzd2l0Y2goZS5rZXlDb2RlKXtjYXNlIEQuRVNDQVBFOnRoaXMuY2xvc2UoKSxuPSEwO2JyZWFrO2Nhc2UgRC5FTlRFUjp0JiYodGhpcy5ob3RNZW51LmdldFNvdXJjZURhdGFBdFJvdyh0WzBdKS5zdWJtZW51P249ITA6KHRoaXMuZXhlY3V0ZUNvbW1hbmQoZSksdGhpcy5jbG9zZSghMCkpKTticmVhaztjYXNlIEQuQVJST1dfRE9XTjp0P3RoaXMuc2VsZWN0TmV4dENlbGwodFswXSx0WzFdKTp0aGlzLnNlbGVjdEZpcnN0Q2VsbCgpLG49ITA7YnJlYWs7Y2FzZSBELkFSUk9XX1VQOnQ/dGhpcy5zZWxlY3RQcmV2Q2VsbCh0WzBdLHRbMV0pOnRoaXMuc2VsZWN0TGFzdENlbGwoKSxuPSEwO2JyZWFrO2Nhc2UgRC5BUlJPV19SSUdIVDppZih0KXt2YXIgbz10aGlzLm9wZW5TdWJNZW51KHRbMF0pO28mJm8uc2VsZWN0Rmlyc3RDZWxsKCl9bj0hMDticmVhaztjYXNlIEQuQVJST1dfTEVGVDp0JiZ0aGlzLmlzU3ViTWVudSgpJiYodGhpcy5jbG9zZSgpLHRoaXMucGFyZW50TWVudSYmdGhpcy5wYXJlbnRNZW51LmhvdE1lbnUubGlzdGVuKCksbj0hMCl9biYmKGUucHJldmVudERlZmF1bHQoKSxMKGUpKX0sb25BZnRlckluaXQ6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmhvdE1lbnUuZ2V0U2V0dGluZ3MoKS5kYXRhLHQ9dGhpcy5ob3RNZW51LnZpZXcud3Qud3RUYWJsZS5oaWRlci5zdHlsZSxuPXRoaXMuaG90TWVudS52aWV3Lnd0Lnd0VGFibGUuaG9sZGVyLnN0eWxlLG89cGFyc2VJbnQodC53aWR0aCwxMCkscj0wO2IoZSxmdW5jdGlvbihlKXtyZXR1cm4gcis9ZS5uYW1lPT09UD8xOjI2fSksbi53aWR0aD1vKzIyKyJweCIsbi5oZWlnaHQ9cis0KyJweCJ9LG9uRG9jdW1lbnRNb3VzZURvd246ZnVuY3Rpb24oZSl7dGhpcy5pc09wZW5lZCgpJiYodGhpcy5jb250YWluZXImJncoZS50YXJnZXQsdGhpcy5jb250YWluZXIpJiZ0aGlzLmV4ZWN1dGVDb21tYW5kKGUpLCh0aGlzLmlzQWxsU3ViTWVudXNDbG9zZWQoKXx8dGhpcy5pc1N1Yk1lbnUoKSkmJiF3KGUudGFyZ2V0LCIuaHRNZW51IikmJncoZS50YXJnZXQsZG9jdW1lbnQpJiZ0aGlzLmNsb3NlKCEwKSl9fSx7fSksUyhXLHgpfSx7Y3Vyc29yOjY3LGV2ZW50TWFuYWdlcjo0MSwiaGVscGVycy9hcnJheSI6NDIsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDYsImhlbHBlcnMvb2JqZWN0Ijo1MCwiaGVscGVycy91bmljb2RlIjo1MywibWl4aW5zL2xvY2FsSG9va3MiOjU0LHByZWRlZmluZWRJdGVtczo3MCx1dGlsczo3MX1dLDcwOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oKXt2YXIgZT17fTtyZXR1cm4gYyhELGZ1bmN0aW9uKHQsbil7cmV0dXJuIGVbbl09ZCh0KX0pLGV9ZnVuY3Rpb24gcihlLHQpey0xPT09SC5pbmRleE9mKGUpJiYoRFtlXT10KX12YXIgaTtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtST1dfQUJPVkU6e2dldDpmdW5jdGlvbigpe3JldHVybiB3fX0sUk9XX0JFTE9XOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4geX19LENPTFVNTl9MRUZUOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gYn19LENPTFVNTl9SSUdIVDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEN9fSxDTEVBUl9DT0xVTU46e2dldDpmdW5jdGlvbigpe3JldHVybiBSfX0sUkVNT1ZFX1JPVzp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIF99fSxSRU1PVkVfQ09MVU1OOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gU319LFVORE86e2dldDpmdW5jdGlvbigpe3JldHVybiBFfX0sUkVETzp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIFR9fSxSRUFEX09OTFk6e2dldDpmdW5jdGlvbigpe3JldHVybiBPfX0sQUxJR05NRU5UOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gTX19LFNFUEFSQVRPUjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGt9fSxJVEVNUzp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIEh9fSxwcmVkZWZpbmVkSXRlbXM6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sYWRkSXRlbTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHJ9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgcyxhLGwsdT0ocz1lKCJoZWxwZXJzL29iamVjdCIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSksYz11Lm9iamVjdEVhY2gsZD11LmNsb25lLGg9KChhPWUoImhlbHBlcnMvbnVtYmVyIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5yYW5nZUVhY2gsbD1lKCJ1dGlscyIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSksZj1oLmFsaWduLHA9aC5nZXRBbGlnbm1lbnRDbGFzc2VzLGc9aC5nZXRWYWxpZFNlbGVjdGlvbixtPWguY2hlY2tTZWxlY3Rpb25Db25zaXN0ZW5jeSx2PWgubWFya0xhYmVsQXNTZWxlY3RlZCx3PSJyb3dfYWJvdmUiLHk9InJvd19iZWxvdyIsYj0iY29sX2xlZnQiLEM9ImNvbF9yaWdodCIsUj0iY2xlYXJfY29sdW1uIixfPSJyZW1vdmVfcm93IixTPSJyZW1vdmVfY29sIixFPSJ1bmRvIixUPSJyZWRvIixPPSJtYWtlX3JlYWRfb25seSIsTT0iYWxpZ25tZW50IixrPSItLS0tLS0tLS0iLEg9W3cseSxiLEMsUixfLFMsRSxULE8sTSxrXSxEPShpPXt9LE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpLGsse3ZhbHVlOntuYW1lOmt9LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGksdyx7dmFsdWU6e2tleTp3LG5hbWU6Ikluc2VydCByb3cgYWJvdmUiLGNhbGxiYWNrOmZ1bmN0aW9uKGUsdCl7dGhpcy5hbHRlcigiaW5zZXJ0X3JvdyIsdC5zdGFydC5yb3cpfSxkaXNhYmxlZDpmdW5jdGlvbigpe3ZhciBlPWcodGhpcyk7aWYoIWUpcmV0dXJuITA7dmFyIHQ9dGhpcy5jb3VudFJvd3MoKSxuPVswLGVbMV0sdC0xLGVbMV1dO3JldHVybiBuLmpvaW4oIiwiKT09PWUuam9pbigiLCIpJiZ0PjF9LGhpZGRlbjpmdW5jdGlvbigpe3JldHVybiF0aGlzLmdldFNldHRpbmdzKCkuYWxsb3dJbnNlcnRSb3d9fSxjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMCx3cml0YWJsZTohMH0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpLHkse3ZhbHVlOntrZXk6eSxuYW1lOiJJbnNlcnQgcm93IGJlbG93IixjYWxsYmFjazpmdW5jdGlvbihlLHQpe3RoaXMuYWx0ZXIoImluc2VydF9yb3ciLHQuZW5kLnJvdysxKX0sZGlzYWJsZWQ6ZnVuY3Rpb24oKXt2YXIgZT1nKHRoaXMpO2lmKCFlKXJldHVybiEwO3ZhciB0PXRoaXMuY291bnRSb3dzKCksbj1bMCxlWzFdLHQtMSxlWzFdXTtyZXR1cm4gbi5qb2luKCIsIik9PT1lLmpvaW4oIiwiKSYmdD4xfSxoaWRkZW46ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5nZXRTZXR0aW5ncygpLmFsbG93SW5zZXJ0Um93fX0sY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsd3JpdGFibGU6ITB9KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoaSxiLHt2YWx1ZTp7a2V5OmIsbmFtZToiSW5zZXJ0IGNvbHVtbiBvbiB0aGUgbGVmdCIsY2FsbGJhY2s6ZnVuY3Rpb24oZSx0KXt0aGlzLmFsdGVyKCJpbnNlcnRfY29sIix0LnN0YXJ0LmNvbCl9LGRpc2FibGVkOmZ1bmN0aW9uKCl7dmFyIGU9Zyh0aGlzKTtpZighZSlyZXR1cm4hMDtpZighdGhpcy5pc0NvbHVtbk1vZGlmaWNhdGlvbkFsbG93ZWQoKSlyZXR1cm4hMDt2YXIgdD1bZVswXSwwLGVbMF0sdGhpcy5jb3VudENvbHMoKS0xXSxuPXQuam9pbigiLCIpPT1lLmpvaW4oIiwiKTtyZXR1cm4gZVsxXTwwfHx0aGlzLmNvdW50Q29scygpPj10aGlzLmdldFNldHRpbmdzKCkubWF4Q29sc3x8bn0saGlkZGVuOmZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuZ2V0U2V0dGluZ3MoKS5hbGxvd0luc2VydENvbHVtbn19LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGksQyx7dmFsdWU6e2tleTpDLG5hbWU6Ikluc2VydCBjb2x1bW4gb24gdGhlIHJpZ2h0IixjYWxsYmFjazpmdW5jdGlvbihlLHQpe3RoaXMuYWx0ZXIoImluc2VydF9jb2wiLHQuZW5kLmNvbCsxKX0sZGlzYWJsZWQ6ZnVuY3Rpb24oKXt2YXIgZT1nKHRoaXMpO2lmKCFlKXJldHVybiEwO2lmKCF0aGlzLmlzQ29sdW1uTW9kaWZpY2F0aW9uQWxsb3dlZCgpKXJldHVybiEwO3ZhciB0PVtlWzBdLDAsZVswXSx0aGlzLmNvdW50Q29scygpLTFdLG49dC5qb2luKCIsIik9PWUuam9pbigiLCIpO3JldHVybiBlWzFdPDB8fHRoaXMuY291bnRDb2xzKCk+PXRoaXMuZ2V0U2V0dGluZ3MoKS5tYXhDb2xzfHxufSxoaWRkZW46ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5nZXRTZXR0aW5ncygpLmFsbG93SW5zZXJ0Q29sdW1ufX0sY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsd3JpdGFibGU6ITB9KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoaSxSLHt2YWx1ZTp7a2V5OlIsbmFtZToiQ2xlYXIgY29sdW1uIixjYWxsYmFjazpmdW5jdGlvbihlLHQpe3ZhciBuPXQuc3RhcnQuY29sO3RoaXMuY291bnRSb3dzKCkmJnRoaXMucG9wdWxhdGVGcm9tQXJyYXkoMCxuLFtbbnVsbF1dLE1hdGgubWF4KHQuc3RhcnQucm93LHQuZW5kLnJvdyksbil9LGRpc2FibGVkOmZ1bmN0aW9uKCl7dmFyIGU9Zyh0aGlzKTtpZighZSlyZXR1cm4hMDt2YXIgdD1bZVswXSwwLGVbMF0sdGhpcy5jb3VudENvbHMoKS0xXSxuPXQuam9pbigiLCIpPT1lLmpvaW4oIiwiKTtyZXR1cm4gZVsxXTwwfHx0aGlzLmNvdW50Q29scygpPj10aGlzLmdldFNldHRpbmdzKCkubWF4Q29sc3x8bn19LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGksXyx7dmFsdWU6e2tleTpfLG5hbWU6IlJlbW92ZSByb3ciLGNhbGxiYWNrOmZ1bmN0aW9uKGUsdCl7dmFyIG49dC5lbmQucm93LXQuc3RhcnQucm93KzE7dGhpcy5hbHRlcigicmVtb3ZlX3JvdyIsdC5zdGFydC5yb3csbil9LGRpc2FibGVkOmZ1bmN0aW9uKCl7dmFyIGU9Zyh0aGlzKTtpZighZSlyZXR1cm4hMDt2YXIgdD1bMCxlWzFdLHRoaXMuY291bnRSb3dzKCktMSxlWzFdXTtyZXR1cm4gdC5qb2luKCIsIik9PT1lLmpvaW4oIiwiKX0saGlkZGVuOmZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMuZ2V0U2V0dGluZ3MoKS5hbGxvd1JlbW92ZVJvd319LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGksUyx7dmFsdWU6e2tleTpTLG5hbWU6IlJlbW92ZSBjb2x1bW4iLGNhbGxiYWNrOmZ1bmN0aW9uKGUsdCl7dmFyIG49dC5lbmQuY29sLXQuc3RhcnQuY29sKzE7dGhpcy5hbHRlcigicmVtb3ZlX2NvbCIsdC5zdGFydC5jb2wsbil9LGRpc2FibGVkOmZ1bmN0aW9uKCl7dmFyIGU9Zyh0aGlzKTtpZighZSlyZXR1cm4hMDtpZighdGhpcy5pc0NvbHVtbk1vZGlmaWNhdGlvbkFsbG93ZWQoKSlyZXR1cm4hMDt2YXIgdD1bZVswXSwwLGVbMF0sdGhpcy5jb3VudENvbHMoKS0xXSxuPXQuam9pbigiLCIpPT1lLmpvaW4oIiwiKTtyZXR1cm4gZVsxXTwwfHxufSxoaWRkZW46ZnVuY3Rpb24oKXtyZXR1cm4hdGhpcy5nZXRTZXR0aW5ncygpLmFsbG93UmVtb3ZlQ29sdW1ufX0sY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsd3JpdGFibGU6ITB9KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoaSxFLHt2YWx1ZTp7a2V5OkUsbmFtZToiVW5kbyIsY2FsbGJhY2s6ZnVuY3Rpb24oKXt0aGlzLnVuZG8oKX0sZGlzYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy51bmRvUmVkbyYmIXRoaXMudW5kb1JlZG8uaXNVbmRvQXZhaWxhYmxlKCl9fSxjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMCx3cml0YWJsZTohMH0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpLFQse3ZhbHVlOntrZXk6VCxuYW1lOiJSZWRvIixjYWxsYmFjazpmdW5jdGlvbigpe3RoaXMucmVkbygpfSxkaXNhYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLnVuZG9SZWRvJiYhdGhpcy51bmRvUmVkby5pc1JlZG9BdmFpbGFibGUoKX19LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KGksTyx7dmFsdWU6e2tleTpPLG5hbWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9IlJlYWQgb25seSIsbj1tKHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUuZ2V0Q2VsbE1ldGEodCxuKS5yZWFkT25seX0pO3JldHVybiBuJiYodD12KHQpKSx0fSxjYWxsYmFjazpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLmdldFNlbGVjdGVkUmFuZ2UoKSxuPW0odCxmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbikucmVhZE9ubHl9KTt0LmZvckFsbChmdW5jdGlvbih0LG8pe2UuZ2V0Q2VsbE1ldGEodCxvKS5yZWFkT25seT1uPyExOiEwfSksdGhpcy5yZW5kZXIoKX0sZGlzYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5nZXRTZWxlY3RlZFJhbmdlKCk/ITE6ITB9fSxjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMCx3cml0YWJsZTohMH0pLE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpLE0se3ZhbHVlOntrZXk6TSxuYW1lOiJBbGlnbm1lbnQiLGRpc2FibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpPyExOiEwfSxzdWJtZW51OntpdGVtczpbe2tleTpNKyI6bGVmdCIsbmFtZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD0iTGVmdCIsbj1tKHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLGZ1bmN0aW9uKHQsbil7dmFyIG89ZS5nZXRDZWxsTWV0YSh0LG4pLmNsYXNzTmFtZTtyZXR1cm4gbyYmLTEhPT1vLmluZGV4T2YoImh0TGVmdCIpPyEwOnZvaWQgMH0pO3JldHVybiBuJiYodD12KHQpKSx0fSxjYWxsYmFjazpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLmdldFNlbGVjdGVkUmFuZ2UoKSxuPXAodCxmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbikuY2xhc3NOYW1lfSksbz0iaG9yaXpvbnRhbCIscj0iaHRMZWZ0Ijt0aGlzLnJ1bkhvb2tzKCJiZWZvcmVDZWxsQWxpZ25tZW50IixuLHQsbyxyKSxmKHQsbyxyLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUuZ2V0Q2VsbE1ldGEodCxuKX0pLHRoaXMucmVuZGVyKCl9LGRpc2FibGVkOiExfSx7a2V5Ok0rIjpjZW50ZXIiLG5hbWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9IkNlbnRlciIsbj1tKHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLGZ1bmN0aW9uKHQsbil7dmFyIG89ZS5nZXRDZWxsTWV0YSh0LG4pLmNsYXNzTmFtZTtyZXR1cm4gbyYmLTEhPT1vLmluZGV4T2YoImh0Q2VudGVyIik/ITA6dm9pZCAwfSk7cmV0dXJuIG4mJih0PXYodCkpLHR9LGNhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLG49cCh0LGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUuZ2V0Q2VsbE1ldGEodCxuKS5jbGFzc05hbWV9KSxvPSJob3Jpem9udGFsIixyPSJodENlbnRlciI7dGhpcy5ydW5Ib29rcygiYmVmb3JlQ2VsbEFsaWdubWVudCIsbix0LG8sciksZih0LG8scixmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbil9KSx0aGlzLnJlbmRlcigpfSxkaXNhYmxlZDohMX0se2tleTpNKyI6cmlnaHQiLG5hbWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9IlJpZ2h0IixuPW0odGhpcy5nZXRTZWxlY3RlZFJhbmdlKCksZnVuY3Rpb24odCxuKXt2YXIgbz1lLmdldENlbGxNZXRhKHQsbikuY2xhc3NOYW1lO3JldHVybiBvJiYtMSE9PW8uaW5kZXhPZigiaHRSaWdodCIpPyEwOnZvaWQgMH0pO3JldHVybiBuJiYodD12KHQpKSx0fSxjYWxsYmFjazpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLmdldFNlbGVjdGVkUmFuZ2UoKSxuPXAodCxmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbikuY2xhc3NOYW1lfSksbz0iaG9yaXpvbnRhbCIscj0iaHRSaWdodCI7dGhpcy5ydW5Ib29rcygiYmVmb3JlQ2VsbEFsaWdubWVudCIsbix0LG8sciksZih0LG8scixmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbil9KSx0aGlzLnJlbmRlcigpfSxkaXNhYmxlZDohMX0se2tleTpNKyI6anVzdGlmeSIsbmFtZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD0iSnVzdGlmeSIsbj1tKHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLGZ1bmN0aW9uKHQsbil7dmFyIG89ZS5nZXRDZWxsTWV0YSh0LG4pLmNsYXNzTmFtZTtyZXR1cm4gbyYmLTEhPT1vLmluZGV4T2YoImh0SnVzdGlmeSIpPyEwOnZvaWQgMH0pO3JldHVybiBuJiYodD12KHQpKSx0fSxjYWxsYmFjazpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLmdldFNlbGVjdGVkUmFuZ2UoKSxuPXAodCxmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbikuY2xhc3NOYW1lfSksbz0iaG9yaXpvbnRhbCIscj0iaHRKdXN0aWZ5Ijt0aGlzLnJ1bkhvb2tzKCJiZWZvcmVDZWxsQWxpZ25tZW50IixuLHQsbyxyKSxmKHQsbyxyLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUuZ2V0Q2VsbE1ldGEodCxuKX0pLHRoaXMucmVuZGVyKCl9LGRpc2FibGVkOiExfSx7bmFtZTprfSx7a2V5Ok0rIjp0b3AiLG5hbWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9IlRvcCIsbj1tKHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLGZ1bmN0aW9uKHQsbil7dmFyIG89ZS5nZXRDZWxsTWV0YSh0LG4pLmNsYXNzTmFtZTtyZXR1cm4gbyYmLTEhPT1vLmluZGV4T2YoImh0VG9wIik/ITA6dm9pZCAwfSk7cmV0dXJuIG4mJih0PXYodCkpLHR9LGNhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PXRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLG49cCh0LGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUuZ2V0Q2VsbE1ldGEodCxuKS5jbGFzc05hbWV9KSxvPSJ2ZXJ0aWNhbCIscj0iaHRUb3AiO3RoaXMucnVuSG9va3MoImJlZm9yZUNlbGxBbGlnbm1lbnQiLG4sdCxvLHIpLGYodCxvLHIsZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5nZXRDZWxsTWV0YSh0LG4pfSksdGhpcy5yZW5kZXIoKX0sZGlzYWJsZWQ6ITF9LHtrZXk6TSsiOm1pZGRsZSIsbmFtZTpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD0iTWlkZGxlIixuPW0odGhpcy5nZXRTZWxlY3RlZFJhbmdlKCksZnVuY3Rpb24odCxuKXt2YXIgbz1lLmdldENlbGxNZXRhKHQsbikuY2xhc3NOYW1lO3JldHVybiBvJiYtMSE9PW8uaW5kZXhPZigiaHRNaWRkbGUiKT8hMDp2b2lkIDB9KTtyZXR1cm4gbiYmKHQ9dih0KSksdH0sY2FsbGJhY2s6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9dGhpcy5nZXRTZWxlY3RlZFJhbmdlKCksbj1wKHQsZnVuY3Rpb24odCxuKXtyZXR1cm4gZS5nZXRDZWxsTWV0YSh0LG4pLmNsYXNzTmFtZX0pLG89InZlcnRpY2FsIixyPSJodE1pZGRsZSI7dGhpcy5ydW5Ib29rcygiYmVmb3JlQ2VsbEFsaWdubWVudCIsbix0LG8sciksZih0LG8scixmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbil9KSx0aGlzLnJlbmRlcigpfSxkaXNhYmxlZDohMX0se2tleTpNKyI6Ym90dG9tIixuYW1lOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PSJCb3R0b20iLG49bSh0aGlzLmdldFNlbGVjdGVkUmFuZ2UoKSxmdW5jdGlvbih0LG4pe3ZhciBvPWUuZ2V0Q2VsbE1ldGEodCxuKS5jbGFzc05hbWU7cmV0dXJuIG8mJi0xIT09by5pbmRleE9mKCJodEJvdHRvbSIpPyEwOnZvaWQgMH0pO3JldHVybiBuJiYodD12KHQpKSx0fSxjYWxsYmFjazpmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD10aGlzLmdldFNlbGVjdGVkUmFuZ2UoKSxuPXAodCxmdW5jdGlvbih0LG4pe3JldHVybiBlLmdldENlbGxNZXRhKHQsbikuY2xhc3NOYW1lfSksbz0idmVydGljYWwiLHI9Imh0Qm90dG9tIjt0aGlzLnJ1bkhvb2tzKCJiZWZvcmVDZWxsQWxpZ25tZW50IixuLHQsbyxyKSxmKHQsbyxyLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUuZ2V0Q2VsbE1ldGEodCxuKX0pLHRoaXMucmVuZGVyKCl9LGRpc2FibGVkOiExfV19fSxjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMCx3cml0YWJsZTohMH0pLGkpfSx7ImhlbHBlcnMvbnVtYmVyIjo0OSwiaGVscGVycy9vYmplY3QiOjUwLHV0aWxzOjcxfV0sNzE6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlKXtyZXR1cm57c3RhcnQ6ZS5nZXRUb3BMZWZ0Q29ybmVyKCksZW5kOmUuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKX19ZnVuY3Rpb24gcihlKXtyZXR1cm4gdihlLCJodFNlcGFyYXRvciIpfWZ1bmN0aW9uIGkoZSl7cmV0dXJuIHYoZSwiaHRTdWJtZW51Iil9ZnVuY3Rpb24gcyhlKXtyZXR1cm4gdihlLCJodERpc2FibGVkIil9ZnVuY3Rpb24gYShlKXtyZXR1cm4gdihlLCJodFNlbGVjdGlvbkRpc2FibGVkIil9ZnVuY3Rpb24gbChlKXt2YXIgdD1lLmdldFNlbGVjdGVkKCk7cmV0dXJuIHQ/dFswXTwwP251bGw6ZS5jb3VudFJvd3MoKT49ZS5nZXRTZXR0aW5ncygpLm1heFJvd3M/bnVsbDp0Om51bGx9ZnVuY3Rpb24gdShlLHQpe3JldHVybi0xIT1lLmluZGV4T2YodCk/ZTooZT1lLnJlcGxhY2UoImh0VG9wIiwiIikucmVwbGFjZSgiaHRNaWRkbGUiLCIiKS5yZXBsYWNlKCJodEJvdHRvbSIsIiIpLnJlcGxhY2UoIiAgIiwiIiksZSs9IiAiK3QpfWZ1bmN0aW9uIGMoZSx0KXtyZXR1cm4tMSE9ZS5pbmRleE9mKHQpP2U6KGU9ZS5yZXBsYWNlKCJodExlZnQiLCIiKS5yZXBsYWNlKCJodENlbnRlciIsIiIpLnJlcGxhY2UoImh0UmlnaHQiLCIiKS5yZXBsYWNlKCJodEp1c3RpZnkiLCIiKS5yZXBsYWNlKCIgICIsIiIpLGUrPSIgIit0KX1mdW5jdGlvbiBkKGUsdCl7Zm9yKHZhciBuPXt9LG89ZS5mcm9tLnJvdztvPD1lLnRvLnJvdztvKyspZm9yKHZhciByPWUuZnJvbS5jb2w7cjw9ZS50by5jb2w7cisrKW5bb118fChuW29dPVtdKSxuW29dW3JdPXQobyxyKTtyZXR1cm4gbn1mdW5jdGlvbiBoKGUsdCxuLG8pe2lmKGUuZnJvbS5yb3c9PWUudG8ucm93JiZlLmZyb20uY29sPT1lLnRvLmNvbClmKGUuZnJvbS5yb3csZS5mcm9tLmNvbCx0LG4sbyk7ZWxzZSBmb3IodmFyIHI9ZS5mcm9tLnJvdztyPD1lLnRvLnJvdztyKyspZm9yKHZhciBpPWUuZnJvbS5jb2w7aTw9ZS50by5jb2w7aSsrKWYocixpLHQsbixvKX1mdW5jdGlvbiBmKGUsdCxuLG8scil7dmFyIGk9cihlLHQpLHM9bztpLmNsYXNzTmFtZSYmKHM9InZlcnRpY2FsIj09PW4/dShpLmNsYXNzTmFtZSxvKTpjKGkuY2xhc3NOYW1lLG8pKSxpLmNsYXNzTmFtZT1zfWZ1bmN0aW9uIHAoZSx0KXt2YXIgbj0hMTtyZXR1cm4gZSYmZS5mb3JBbGwoZnVuY3Rpb24oZSxvKXtyZXR1cm4gdChlLG8pPyhuPSEwLCExKTp2b2lkIDB9KSxufWZ1bmN0aW9uIGcoZSl7cmV0dXJuJzxzcGFuIGNsYXNzPSJzZWxlY3RlZCI+JytTdHJpbmcuZnJvbUNoYXJDb2RlKDEwMDAzKSsiPC9zcGFuPiIrZX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtub3JtYWxpemVTZWxlY3Rpb246e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0saXNTZXBhcmF0b3I6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0saGFzU3ViTWVudTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGl9fSxpc0Rpc2FibGVkOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gc319LGlzU2VsZWN0aW9uRGlzYWJsZWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiBhfX0sZ2V0VmFsaWRTZWxlY3Rpb246e2dldDpmdW5jdGlvbigpe3JldHVybiBsfX0scHJlcGFyZVZlcnRpY2FsQWxpZ25DbGFzczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHV9fSxwcmVwYXJlSG9yaXpvbnRhbEFsaWduQ2xhc3M6e2dldDpmdW5jdGlvbigpe3JldHVybiBjfX0sZ2V0QWxpZ25tZW50Q2xhc3Nlczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGR9fSxhbGlnbjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGh9fSxjaGVja1NlbGVjdGlvbkNvbnNpc3RlbmN5OntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gcH19LG1hcmtMYWJlbEFzU2VsZWN0ZWQ6e2dldDpmdW5jdGlvbigpe3JldHVybiBnfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG0sdj0obT1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbSYmbS5fX2VzTW9kdWxlJiZtfHx7ImRlZmF1bHQiOm19KS5oYXNDbGFzc30seyJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NX1dLDcyOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0NvbnRleHRNZW51Q29weVBhc3RlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZ319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbCx1PShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLnJlbW92ZUNsYXNzLGM9KHI9ZSgiaGVscGVycy9hcnJheSIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuYXJyYXlFYWNoLGQ9KGk9ZSgiZXZlbnRNYW5hZ2VyIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5FdmVudE1hbmFnZXIsaD0ocz1lKCJwbHVnaW5zIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5yZWdpc3RlclBsdWdpbixmPShhPWUoIl9iYXNlIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KVsiZGVmYXVsdCJdLHA9KGw9ZSgiemVyb2NsaXBib2FyZCIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSlbImRlZmF1bHQiXSxnPWZ1bmN0aW9uKGUpeyR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yKG0pLmNhbGwodGhpcyxlKSx0aGlzLmV2ZW50TWFuYWdlcj1uZXcgZCh0aGlzKSx0aGlzLnN3ZlBhdGg9bnVsbCx0aGlzLm91dHNpZGVDbGlja0Rlc2VsZWN0c0NhY2hlPW51bGx9LG09ZzskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoZyx7aXNFbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaG90LmdldFNldHRpbmdzKCkuY29udGV4dE1lbnVDb3B5UGFzdGV9LGVuYWJsZVBsdWdpbjpmdW5jdGlvbigpe3ZhciBlPXRoaXM7aWYoIXRoaXMuZW5hYmxlZCl7Im9iamVjdCI9PXR5cGVvZiB0aGlzLmhvdC5nZXRTZXR0aW5ncygpLmNvbnRleHRNZW51Q29weVBhc3RlJiYodGhpcy5zd2ZQYXRoPXRoaXMuaG90LmdldFNldHRpbmdzKCkuY29udGV4dE1lbnVDb3B5UGFzdGUuc3dmUGF0aCksInVuZGVmaW5lZCI9PXR5cGVvZiBwJiZjb25zb2xlLmVycm9yKCJUbyBiZSBhYmxlIHRvIHVzZSB0aGUgQ29weS9QYXN0ZSBmZWF0dXJlIGZyb20gdGhlIGNvbnRleHQgbWVudSwgeW91IG5lZWQgdG8gbWFudWFsbHkgaW5jbHVkZSBaZXJvQ2xpcGJvYXJkLmpzIGZpbGUgdG8geW91ciB3ZWJzaXRlLiIpO3RyeXtuZXcgQWN0aXZlWE9iamVjdCgiU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2giKX1jYXRjaCh0KXsidW5kZWZpbmVkIj09dHlwZW9mIG5hdmlnYXRvci5taW1lVHlwZXNbImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIl0mJmNvbnNvbGUuZXJyb3IoIlRvIGJlIGFibGUgdG8gdXNlIHRoZSBDb3B5L1Bhc3RlIGZlYXR1cmUgZnJvbSB0aGUgY29udGV4dCBtZW51LCB5b3VyIGJyb3dzZXIgbmVlZHMgdG8gaGF2ZSBGbGFzaCBQbHVnaW4gaW5zdGFsbGVkLiIpfXRoaXMuc3dmUGF0aCYmcC5jb25maWcoe3N3ZlBhdGg6dGhpcy5zd2ZQYXRofSksdGhpcy5ob3QuYWRkSG9vaygiYWZ0ZXJDb250ZXh0TWVudVNob3ciLGZ1bmN0aW9uKCl7cmV0dXJuIGUub25BZnRlckNvbnRleHRNZW51U2hvdygpfSksdGhpcy5ob3QuYWRkSG9vaygiYWZ0ZXJDb250ZXh0TWVudURlZmF1bHRPcHRpb25zIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbkFmdGVyQ29udGV4dE1lbnVEZWZhdWx0T3B0aW9ucyh0KX0pLHRoaXMucmVnaXN0ZXJFdmVudHMoKSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxtLnByb3RvdHlwZSwiZW5hYmxlUGx1Z2luIikuY2FsbCh0aGlzKX19LGRpc2FibGVQbHVnaW46ZnVuY3Rpb24oKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxtLnByb3RvdHlwZSwiZGlzYWJsZVBsdWdpbiIpLmNhbGwodGhpcyl9LHJlZ2lzdGVyRXZlbnRzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LCJtb3VzZWVudGVyIixmdW5jdGlvbigpe3JldHVybiBlLnJlbW92ZUN1cnJlbnRDbGFzcygpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwibW91c2VsZWF2ZSIsZnVuY3Rpb24oKXtyZXR1cm4gZS5yZW1vdmVaZXJvQ2xpcGJvYXJkQ2xhc3MoKX0pfSxnZXRDb3B5VmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ob3QuY29weVBhc3RlLnNldENvcHlhYmxlVGV4dCgpLHRoaXMuaG90LmNvcHlQYXN0ZS5jb3B5UGFzdGVJbnN0YW5jZS5lbFRleHRhcmVhLnZhbHVlfSxvbkFmdGVyQ29udGV4dE1lbnVEZWZhdWx0T3B0aW9uczpmdW5jdGlvbihlKXtlLml0ZW1zLnVuc2hpZnQoe2tleToiY29weSIsbmFtZToiQ29weSJ9LHtrZXk6InBhc3RlIixuYW1lOiJQYXN0ZSIsY2FsbGJhY2s6ZnVuY3Rpb24oKXt0aGlzLmNvcHlQYXN0ZS50cmlnZ2VyUGFzdGUoKX19LEhhbmRzb250YWJsZS5wbHVnaW5zLkNvbnRleHRNZW51LlNFUEFSQVRPUil9LG9uQWZ0ZXJDb250ZXh0TWVudVNob3c6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9dGhpcy5ob3QuZ2V0UGx1Z2luKCJjb250ZXh0TWVudSIpLG49dC5tZW51LmhvdE1lbnUuZ2V0U291cmNlRGF0YSgpO2MobixmdW5jdGlvbihuLG8pe2lmKCJjb3B5Ij09PW4ua2V5KXt2YXIgcj1uZXcgcCh0Lm1lbnUuaG90TWVudS5nZXRDZWxsKG8sMCkpO3JldHVybiByLm9mZigpLHIub24oImNvcHkiLGZ1bmN0aW9uKHQpe3ZhciBuPXQuY2xpcGJvYXJkRGF0YTtuLnNldERhdGEoInRleHQvcGxhaW4iLGUuZ2V0Q29weVZhbHVlKCkpLGUuaG90LmdldFNldHRpbmdzKCkub3V0c2lkZUNsaWNrRGVzZWxlY3RzPWUub3V0c2lkZUNsaWNrRGVzZWxlY3RzQ2FjaGV9KSwhMX19KX0scmVtb3ZlQ3VycmVudENsYXNzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3QuZ2V0UGx1Z2luKCJjb250ZXh0TWVudSIpO2lmKGUubWVudS5pc09wZW5lZCgpKXt2YXIgdD1lLm1lbnUuaG90TWVudS5yb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKCJ0ZC5jdXJyZW50Iik7dCYmdSh0LCJjdXJyZW50Iil9dGhpcy5vdXRzaWRlQ2xpY2tEZXNlbGVjdHNDYWNoZT10aGlzLmhvdC5nZXRTZXR0aW5ncygpLm91dHNpZGVDbGlja0Rlc2VsZWN0cyx0aGlzLmhvdC5nZXRTZXR0aW5ncygpLm91dHNpZGVDbGlja0Rlc2VsZWN0cz0hMX0scmVtb3ZlWmVyb0NsaXBib2FyZENsYXNzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3QuZ2V0UGx1Z2luKCJjb250ZXh0TWVudSIpO2lmKGUubWVudS5pc09wZW5lZCgpKXt2YXIgdD1lLm1lbnUuaG90TWVudS5yb290RWxlbWVudC5xdWVyeVNlbGVjdG9yKCJ0ZC56ZXJvY2xpcGJvYXJkLWlzLWhvdmVyIik7dCYmdSh0LCJ6ZXJvY2xpcGJvYXJkLWlzLWhvdmVyIil9dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5vdXRzaWRlQ2xpY2tEZXNlbGVjdHM9dGhpcy5vdXRzaWRlQ2xpY2tEZXNlbGVjdHNDYWNoZX19LHt9LGYpLGgoImNvbnRleHRNZW51Q29weVBhc3RlIixnKX0se19iYXNlOjU4LGV2ZW50TWFuYWdlcjo0MSwiaGVscGVycy9hcnJheSI6NDIsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LHBsdWdpbnM6NTcsemVyb2NsaXBib2FyZDoiemVyb2NsaXBib2FyZCJ9XSw3MzpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUpe2Z1bmN0aW9uIHQoKXtlLmlzTGlzdGVuaW5nKCkmJmUuc2VsZWN0aW9uLmVtcHR5KCl9ZnVuY3Rpb24gbih0KXt2YXIgbixvLHIsaSxzLGEsbCx1LGMsZDtpZihlLmlzTGlzdGVuaW5nKCkmJmUuc2VsZWN0aW9uLmlzU2VsZWN0ZWQoKSl7bj10LG89di5wYXJzZShuKSxyPWUuZ2V0U2VsZWN0ZWQoKSxpPW5ldyBNKHJbMF0sclsxXSkscz1uZXcgTShyWzJdLHJbM10pLGE9bmV3IGsoaSxpLHMpLGw9YS5nZXRUb3BMZWZ0Q29ybmVyKCksdT1hLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCksYz1sLGQ9bmV3IE0oTWF0aC5tYXgodS5yb3csby5sZW5ndGgtMStsLnJvdyksTWF0aC5tYXgodS5jb2wsb1swXS5sZW5ndGgtMStsLmNvbCkpO3ZhciBoPXMucm93LWkucm93Pj1vLmxlbmd0aC0xLGY9cy5jb2wtaS5jb2w+PW9bMF0ubGVuZ3RoLTE7ZS5hZGRIb29rT25jZSgiYWZ0ZXJDaGFuZ2UiLGZ1bmN0aW9uKHQsbil7dmFyIG89dD90Lmxlbmd0aDowO2lmKG8pe3ZhciByPXtyb3c6MCxjb2w6MH0saT0tMTtDKHQsZnVuY3Rpb24oZSxuKXt2YXIgcz1vPm4rMT90W24rMV06bnVsbDtzJiYoaHx8KHIucm93PXIucm93K01hdGgubWF4KHNbMF0tZVswXS0xLDApKSwhZiYmZVsxXT5pJiYoaT1lWzFdLHIuY29sPXIuY29sK01hdGgubWF4KHNbMV0tZVsxXS0xLDApKSl9KSxlLnNlbGVjdENlbGwoYy5yb3csYy5jb2wsZC5yb3crci5yb3csZC5jb2wrci5jb2wpfX0pLGUucG9wdWxhdGVGcm9tQXJyYXkoYy5yb3csYy5jb2wsbyxkLnJvdyxkLmNvbCwicGFzdGUiLGUuZ2V0U2V0dGluZ3MoKS5wYXN0ZU1vZGUpfX1mdW5jdGlvbiBvKHQpe2lmKGUuZ2V0U2VsZWN0ZWQoKSYmIShlLmdldEFjdGl2ZUVkaXRvcigpJiZlLmdldEFjdGl2ZUVkaXRvcigpLmlzT3BlbmVkKCl8fEUodCkpKXtpZihiKHQua2V5Q29kZSkpe2lmKGUuZ2V0U2V0dGluZ3MoKS5mcmFnbWVudFNlbGVjdGlvbiYmVCgpKXJldHVybjtyZXR1cm4gci5zZXRDb3B5YWJsZVRleHQoKSx2b2lkIFModCl9dmFyIG49KHQuY3RybEtleXx8dC5tZXRhS2V5KSYmIXQuYWx0S2V5O3Qua2V5Q29kZT09eS5BJiZuJiZlLl9yZWdpc3RlclRpbWVvdXQoc2V0VGltZW91dChPKHIuc2V0Q29weWFibGVUZXh0LHIpLDApKX19dmFyIHI9dGhpczt0aGlzLmNvcHlQYXN0ZUluc3RhbmNlPW0oKSx0aGlzLmNvcHlQYXN0ZUluc3RhbmNlLm9uQ3V0KHQpLHRoaXMuY29weVBhc3RlSW5zdGFuY2Uub25QYXN0ZShuKSx0aGlzLm9uUGFzdGU9bixlLmFkZEhvb2soImJlZm9yZUtleURvd24iLG8pLHRoaXMuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuY29weVBhc3RlSW5zdGFuY2UmJih0aGlzLmNvcHlQYXN0ZUluc3RhbmNlLnJlbW92ZUNhbGxiYWNrKHQpLHRoaXMuY29weVBhc3RlSW5zdGFuY2UucmVtb3ZlQ2FsbGJhY2sobiksdGhpcy5jb3B5UGFzdGVJbnN0YW5jZS5kZXN0cm95KCksdGhpcy5jb3B5UGFzdGVJbnN0YW5jZT1udWxsKSxlLnJlbW92ZUhvb2soImJlZm9yZUtleURvd24iLG8pfSxlLmFkZEhvb2soImFmdGVyRGVzdHJveSIsTyh0aGlzLmRlc3Ryb3ksdGhpcykpLHRoaXMudHJpZ2dlclBhc3RlPU8odGhpcy5jb3B5UGFzdGVJbnN0YW5jZS50cmlnZ2VyUGFzdGUsdGhpcy5jb3B5UGFzdGVJbnN0YW5jZSksdGhpcy50cmlnZ2VyQ3V0PU8odGhpcy5jb3B5UGFzdGVJbnN0YW5jZS50cmlnZ2VyQ3V0LHRoaXMuY29weVBhc3RlSW5zdGFuY2UpLHRoaXMuc2V0Q29weWFibGVUZXh0PWZ1bmN0aW9uKCl7dmFyIHQ9ZS5nZXRTZXR0aW5ncygpLG49dC5jb3B5Um93c0xpbWl0LG89dC5jb3B5Q29sc0xpbWl0LHI9ZS5nZXRTZWxlY3RlZFJhbmdlKCksaT1yLmdldFRvcExlZnRDb3JuZXIoKSxzPXIuZ2V0Qm90dG9tUmlnaHRDb3JuZXIoKSxhPWkucm93LGw9aS5jb2wsdT1zLnJvdyxjPXMuY29sLGQ9TWF0aC5taW4odSxhK24tMSksaD1NYXRoLm1pbihjLGwrby0xKSxmPVtdO2YucHVzaCh7c3RhcnRSb3c6YSxzdGFydENvbDpsLGVuZFJvdzpkLGVuZENvbDpofSksZj1IYW5kc29udGFibGUuaG9va3MucnVuKGUsIm1vZGlmeUNvcHlhYmxlUmFuZ2UiLGYpO3ZhciBwPXRoaXMuZ2V0UmFuZ2VkQ29weWFibGVEYXRhKGYpO2UuY29weVBhc3RlLmNvcHlQYXN0ZUluc3RhbmNlLmNvcHlhYmxlKHApLCh1IT09ZHx8YyE9PWgpJiZIYW5kc29udGFibGUuaG9va3MucnVuKGUsImFmdGVyQ29weUxpbWl0Iix1LWErMSxjLWwrMSxuLG8pfSx0aGlzLmdldFJhbmdlZENvcHlhYmxlRGF0YT1mdW5jdGlvbih0KXt2YXIgbj1bXSxvPVtdLHI9W107cmV0dXJuIEModCxmdW5jdGlvbihlKXtSKGUuc3RhcnRSb3csZS5lbmRSb3csZnVuY3Rpb24oZSl7LTE9PT1vLmluZGV4T2YoZSkmJm8ucHVzaChlKX0pLFIoZS5zdGFydENvbCxlLmVuZENvbCxmdW5jdGlvbihlKXstMT09PXIuaW5kZXhPZihlKSYmci5wdXNoKGUpfSl9KSxDKG8sZnVuY3Rpb24odCl7dmFyIG89W107QyhyLGZ1bmN0aW9uKG4pe28ucHVzaChlLmdldENvcHlhYmxlRGF0YSh0LG4pKX0pLG4ucHVzaChvKX0pLHYuc3RyaW5naWZ5KG4pfX1mdW5jdGlvbiByKCl7dmFyIGU9dGhpcyx0PWUuZ2V0U2V0dGluZ3MoKS5jb3B5UGFzdGUhPT0hMTt0JiYhZS5jb3B5UGFzdGU/ZS5jb3B5UGFzdGU9bmV3IG8oZSk6IXQmJmUuY29weVBhc3RlJiYoZS5jb3B5UGFzdGUuZGVzdHJveSgpLGUuY29weVBhc3RlPW51bGwpfU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se0NvcHlQYXN0ZVBsdWdpbjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgaSxzLGEsbCx1LGMsZCxoLGYscCxnLG09KGk9ZSgiY29weVBhc3RlIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KVsiZGVmYXVsdCJdLHY9KHM9ZSgiU2hlZXRDbGlwIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KVsiZGVmYXVsdCJdLHc9KGE9ZSgiaGVscGVycy91bmljb2RlIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KSx5PXcuS0VZX0NPREVTLGI9dy5pc0N0cmxLZXksQz0obD1lKCJoZWxwZXJzL2FycmF5IiksbCYmbC5fX2VzTW9kdWxlJiZsfHx7ImRlZmF1bHQiOmx9KS5hcnJheUVhY2gsUj0odT1lKCJoZWxwZXJzL251bWJlciIpLHUmJnUuX19lc01vZHVsZSYmdXx8eyJkZWZhdWx0Ijp1fSkucmFuZ2VFYWNoLF89KGM9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxjJiZjLl9fZXNNb2R1bGUmJmN8fHsiZGVmYXVsdCI6Y30pLFM9Xy5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24sRT1fLmlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkLFQ9KGQ9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLGQmJmQuX19lc01vZHVsZSYmZHx8eyJkZWZhdWx0IjpkfSkuZ2V0U2VsZWN0aW9uVGV4dCxPPShoPWUoImhlbHBlcnMvZnVuY3Rpb24iKSxoJiZoLl9fZXNNb2R1bGUmJmh8fHsiZGVmYXVsdCI6aH0pLnByb3h5LE09KChmPWUoInBsdWdpbnMiKSxmJiZmLl9fZXNNb2R1bGUmJmZ8fHsiZGVmYXVsdCI6Zn0pLnJlZ2lzdGVyUGx1Z2luLChwPWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL2Nvb3JkcyIpLHAmJnAuX19lc01vZHVsZSYmcHx8eyJkZWZhdWx0IjpwfSkuV2Fsa29udGFibGVDZWxsQ29vcmRzKSxrPShnPWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL3JhbmdlIiksZyYmZy5fX2VzTW9kdWxlJiZnfHx7ImRlZmF1bHQiOmd9KS5XYWxrb250YWJsZUNlbGxSYW5nZTtIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlckluaXQiLHIpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyVXBkYXRlU2V0dGluZ3MiLHIpLEhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcigiYWZ0ZXJDb3B5TGltaXQiKSxIYW5kc29udGFibGUuaG9va3MucmVnaXN0ZXIoIm1vZGlmeUNvcHlhYmxlUmFuZ2UiKX0seyIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiOjUsIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL3JhbmdlIjo2LFNoZWV0Q2xpcDoiU2hlZXRDbGlwIixjb3B5UGFzdGU6ImNvcHlQYXN0ZSIsImhlbHBlcnMvYXJyYXkiOjQyLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy9kb20vZXZlbnQiOjQ2LCJoZWxwZXJzL2Z1bmN0aW9uIjo0NywiaGVscGVycy9udW1iZXIiOjQ5LCJoZWxwZXJzL3VuaWNvZGUiOjUzLHBsdWdpbnM6NTd9XSw3NDpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKCl7fXZhciByLGkscyxhLGw9KChyPWUoInBsdWdpbnMiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLnJlZ2lzdGVyUGx1Z2luLChpPWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL3JhbmdlIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5XYWxrb250YWJsZUNlbGxSYW5nZSksdT0ocz1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvc2VsZWN0aW9uIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5XYWxrb250YWJsZVNlbGVjdGlvbixjPWZ1bmN0aW9uKGUpe3JldHVybiJib29sZWFuIj09dHlwZW9mIGUmJmU9PT0hMD8hMDoib2JqZWN0Ij09dHlwZW9mIGUmJmUubGVuZ3RoPjA/ITA6ITF9LGQ9ZnVuY3Rpb24oKXtjKHRoaXMuZ2V0U2V0dGluZ3MoKS5jdXN0b21Cb3JkZXJzKSYmKHRoaXMuY3VzdG9tQm9yZGVyc3x8KGE9dGhpcyx0aGlzLmN1c3RvbUJvcmRlcnM9bmV3IG8pKX0saD1mdW5jdGlvbihlKXtmb3IodmFyIHQ9MDt0PGEudmlldy53dC5zZWxlY3Rpb25zLmxlbmd0aDt0KyspaWYoYS52aWV3Lnd0LnNlbGVjdGlvbnNbdF0uc2V0dGluZ3MuY2xhc3NOYW1lPT1lKXJldHVybiB0O3JldHVybi0xfSxmPWZ1bmN0aW9uKGUpe3ZhciB0PXtyb3c6ZS5yb3csY29sOmUuY29sfSxuPW5ldyB1KGUsbmV3IGwodCx0LHQpKSxvPWgoZS5jbGFzc05hbWUpO28+PTA/YS52aWV3Lnd0LnNlbGVjdGlvbnNbb109bjphLnZpZXcud3Quc2VsZWN0aW9ucy5wdXNoKG4pfSxwPWZ1bmN0aW9uKGUsdCxuKXt2YXIgbz1iKGUsdCk7bz1DKG8sbiksdGhpcy5zZXRDZWxsTWV0YShlLHQsImJvcmRlcnMiLG8pLGYobyl9LGc9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWUucmFuZ2Usbj10LmZyb20ucm93O248PXQudG8ucm93O24rKylmb3IodmFyIG89dC5mcm9tLmNvbDtvPD10LnRvLmNvbDtvKyspe3ZhciByPWIobixvKSxpPTA7bj09dC5mcm9tLnJvdyYmKGkrKyxlLmhhc093blByb3BlcnR5KCJ0b3AiKSYmKHIudG9wPWUudG9wKSksbj09dC50by5yb3cmJihpKyssZS5oYXNPd25Qcm9wZXJ0eSgiYm90dG9tIikmJihyLmJvdHRvbT1lLmJvdHRvbSkpLG89PXQuZnJvbS5jb2wmJihpKyssZS5oYXNPd25Qcm9wZXJ0eSgibGVmdCIpJiYoci5sZWZ0PWUubGVmdCkpLG89PXQudG8uY29sJiYoaSsrLGUuaGFzT3duUHJvcGVydHkoInJpZ2h0IikmJihyLnJpZ2h0PWUucmlnaHQpKSxpPjAmJih0aGlzLnNldENlbGxNZXRhKG4sbywiYm9yZGVycyIsciksZihyKSl9fSxtPWZ1bmN0aW9uKGUsdCl7cmV0dXJuImJvcmRlcl9yb3ciK2UrImNvbCIrdH0sdj1mdW5jdGlvbigpe3JldHVybnt3aWR0aDoxLGNvbG9yOiIjMDAwIn19LHc9ZnVuY3Rpb24oKXtyZXR1cm57aGlkZTohMH19LHk9ZnVuY3Rpb24oKXtyZXR1cm57d2lkdGg6MSxjb2xvcjoiIzAwMCIsY29ybmVyVmlzaWJsZTohMX19LGI9ZnVuY3Rpb24oZSx0KXtyZXR1cm57Y2xhc3NOYW1lOm0oZSx0KSxib3JkZXI6eSgpLHJvdzplLGNvbDp0LHRvcDp3KCkscmlnaHQ6dygpLGJvdHRvbTp3KCksbGVmdDp3KCl9fSxDPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQuaGFzT3duUHJvcGVydHkoImJvcmRlciIpJiYoZS5ib3JkZXI9dC5ib3JkZXIpLHQuaGFzT3duUHJvcGVydHkoInRvcCIpJiYoZS50b3A9dC50b3ApLHQuaGFzT3duUHJvcGVydHkoInJpZ2h0IikmJihlLnJpZ2h0PXQucmlnaHQpLHQuaGFzT3duUHJvcGVydHkoImJvdHRvbSIpJiYoZS5ib3R0b209dC5ib3R0b20pLHQuaGFzT3duUHJvcGVydHkoImxlZnQiKSYmKGUubGVmdD10LmxlZnQpLGV9LFI9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoIi4iK2UpLG49MDtuPHQubGVuZ3RoO24rKylpZih0W25dJiYiVEQiIT10W25dLm5vZGVOYW1lKXt2YXIgbz10W25dLnBhcmVudE5vZGU7by5wYXJlbnROb2RlJiZvLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobyl9fSxfPWZ1bmN0aW9uKGUsdCl7dmFyIG49bShlLHQpO1IobiksdGhpcy5yZW1vdmVDZWxsTWV0YShlLHQsImJvcmRlcnMiKX0sUz1mdW5jdGlvbihlLHQsbixvKXt2YXIgcj10aGlzLmdldENlbGxNZXRhKGUsdCkuYm9yZGVycztyJiZ2b2lkIDAhPXIuYm9yZGVyfHwocj1iKGUsdCkpLG8/cltuXT13KCk6cltuXT12KCksdGhpcy5zZXRDZWxsTWV0YShlLHQsImJvcmRlcnMiLHIpO3ZhciBpPW0oZSx0KTtSKGkpLGYociksdGhpcy5yZW5kZXIoKX0sRT1mdW5jdGlvbihlLHQsbil7aWYoZS5mcm9tLnJvdz09ZS50by5yb3cmJmUuZnJvbS5jb2w9PWUudG8uY29sKSJub0JvcmRlcnMiPT10P18uY2FsbCh0aGlzLGUuZnJvbS5yb3csZS5mcm9tLmNvbCk6Uy5jYWxsKHRoaXMsZS5mcm9tLnJvdyxlLmZyb20uY29sLHQsbik7ZWxzZSBzd2l0Y2godCl7Y2FzZSJub0JvcmRlcnMiOmZvcih2YXIgbz1lLmZyb20uY29sO288PWUudG8uY29sO28rKylmb3IodmFyIHI9ZS5mcm9tLnJvdztyPD1lLnRvLnJvdztyKyspXy5jYWxsKHRoaXMscixvKTticmVhaztjYXNlInRvcCI6Zm9yKHZhciBpPWUuZnJvbS5jb2w7aTw9ZS50by5jb2w7aSsrKVMuY2FsbCh0aGlzLGUuZnJvbS5yb3csaSx0LG4pO2JyZWFrO2Nhc2UicmlnaHQiOmZvcih2YXIgcz1lLmZyb20ucm93O3M8PWUudG8ucm93O3MrKylTLmNhbGwodGhpcyxzLGUudG8uY29sLHQpO2JyZWFrO2Nhc2UiYm90dG9tIjpmb3IodmFyIGE9ZS5mcm9tLmNvbDthPD1lLnRvLmNvbDthKyspUy5jYWxsKHRoaXMsZS50by5yb3csYSx0KTticmVhaztjYXNlImxlZnQiOmZvcih2YXIgbD1lLmZyb20ucm93O2w8PWUudG8ucm93O2wrKylTLmNhbGwodGhpcyxsLGUuZnJvbS5jb2wsdCl9fSxUPWZ1bmN0aW9uKGUsdCl7dmFyIG49ITE7cmV0dXJuIGUuZ2V0U2VsZWN0ZWRSYW5nZSgpLmZvckFsbChmdW5jdGlvbihvLHIpe3ZhciBpPWUuZ2V0Q2VsbE1ldGEobyxyKS5ib3JkZXJzO2lmKGkpe2lmKCF0KXJldHVybiBuPSEwLCExO2lmKCFpW3RdLmhhc093blByb3BlcnR5KCJoaWRlIikpcmV0dXJuIG49ITAsITF9fSksbn0sTz1mdW5jdGlvbihlKXtyZXR1cm4nPHNwYW4gY2xhc3M9InNlbGVjdGVkIj4nK1N0cmluZy5mcm9tQ2hhckNvZGUoMTAwMDMpKyI8L3NwYW4+IitlfSxNPWZ1bmN0aW9uKGUpe3RoaXMuZ2V0U2V0dGluZ3MoKS5jdXN0b21Cb3JkZXJzJiYoZS5pdGVtcy5wdXNoKEhhbmRzb250YWJsZS5wbHVnaW5zLkNvbnRleHRNZW51LlNFUEFSQVRPUiksZS5pdGVtcy5wdXNoKHtrZXk6ImJvcmRlcnMiLG5hbWU6IkJvcmRlcnMiLHN1Ym1lbnU6e2l0ZW1zOlt7a2V5OiJib3JkZXJzOnRvcCIsbmFtZTpmdW5jdGlvbigpe3ZhciBlPSJUb3AiLHQ9VCh0aGlzLCJ0b3AiKTtyZXR1cm4gdCYmKGU9TyhlKSksZX0sY2FsbGJhY2s6ZnVuY3Rpb24oKXt2YXIgZT1UKHRoaXMsInRvcCIpO0UuY2FsbCh0aGlzLHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLCJ0b3AiLGUpfSxkaXNhYmxlZDohMX0se2tleToiYm9yZGVyczpyaWdodCIsbmFtZTpmdW5jdGlvbigpe3ZhciBlPSJSaWdodCIsdD1UKHRoaXMsInJpZ2h0Iik7cmV0dXJuIHQmJihlPU8oZSkpLGV9LGNhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGU9VCh0aGlzLCJyaWdodCIpO0UuY2FsbCh0aGlzLHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLCJyaWdodCIsZSl9LGRpc2FibGVkOiExfSx7a2V5OiJib3JkZXJzOmJvdHRvbSIsbmFtZTpmdW5jdGlvbigpe3ZhciBlPSJCb3R0b20iLHQ9VCh0aGlzLCJib3R0b20iKTtyZXR1cm4gdCYmKGU9TyhlKSksZX0sY2FsbGJhY2s6ZnVuY3Rpb24oKXt2YXIgZT1UKHRoaXMsImJvdHRvbSIpO0UuY2FsbCh0aGlzLHRoaXMuZ2V0U2VsZWN0ZWRSYW5nZSgpLCJib3R0b20iLGUpfSxkaXNhYmxlZDohMX0se2tleToiYm9yZGVyczpsZWZ0IixuYW1lOmZ1bmN0aW9uKCl7dmFyIGU9IkxlZnQiLHQ9VCh0aGlzLCJsZWZ0Iik7cmV0dXJuIHQmJihlPU8oZSkpLGV9LGNhbGxiYWNrOmZ1bmN0aW9uKCl7dmFyIGU9VCh0aGlzLCJsZWZ0Iik7RS5jYWxsKHRoaXMsdGhpcy5nZXRTZWxlY3RlZFJhbmdlKCksImxlZnQiLGUpOwp9LGRpc2FibGVkOiExfSx7a2V5OiJib3JkZXJzOm5vX2JvcmRlcnMiLG5hbWU6IlJlbW92ZSBib3JkZXIocykiLGNhbGxiYWNrOmZ1bmN0aW9uKCl7RS5jYWxsKHRoaXMsdGhpcy5nZXRTZWxlY3RlZFJhbmdlKCksIm5vQm9yZGVycyIpfSxkaXNhYmxlZDpmdW5jdGlvbigpe3JldHVybiFUKHRoaXMpfX1dfX0pKX07SGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYmVmb3JlSW5pdCIsZCksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJDb250ZXh0TWVudURlZmF1bHRPcHRpb25zIixNKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlckluaXQiLGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5nZXRTZXR0aW5ncygpLmN1c3RvbUJvcmRlcnM7aWYoZSl7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aDt0KyspZVt0XS5yYW5nZT9nLmNhbGwodGhpcyxlW3RdKTpwLmNhbGwodGhpcyxlW3RdLnJvdyxlW3RdLmNvbCxlW3RdKTt0aGlzLnJlbmRlcigpLHRoaXMudmlldy53dC5kcmF3KCEwKX19KSxIYW5kc29udGFibGUuQ3VzdG9tQm9yZGVycz1vfSx7IjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL3JhbmdlIjo2LCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvc2VsZWN0aW9uIjoxOCxwbHVnaW5zOjU3fV0sNzU6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbygpe3RoaXMuYm91bmRhcmllcz1udWxsLHRoaXMuY2FsbGJhY2s9bnVsbH1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtEcmFnVG9TY3JvbGw6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzPShyPWUoImV2ZW50TWFuYWdlciIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuZXZlbnRNYW5hZ2VyOyhpPWUoInBsdWdpbnMiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLnJlZ2lzdGVyUGx1Z2luO0hhbmRzb250YWJsZS5wbHVnaW5zLkRyYWdUb1Njcm9sbD1vLG8ucHJvdG90eXBlLnNldEJvdW5kYXJpZXM9ZnVuY3Rpb24oZSl7dGhpcy5ib3VuZGFyaWVzPWV9LG8ucHJvdG90eXBlLnNldENhbGxiYWNrPWZ1bmN0aW9uKGUpe3RoaXMuY2FsbGJhY2s9ZX0sby5wcm90b3R5cGUuY2hlY2s9ZnVuY3Rpb24oZSx0KXt2YXIgbj0wLG89MDt0PHRoaXMuYm91bmRhcmllcy50b3A/bz10LXRoaXMuYm91bmRhcmllcy50b3A6dD50aGlzLmJvdW5kYXJpZXMuYm90dG9tJiYobz10LXRoaXMuYm91bmRhcmllcy5ib3R0b20pLGU8dGhpcy5ib3VuZGFyaWVzLmxlZnQ/bj1lLXRoaXMuYm91bmRhcmllcy5sZWZ0OmU+dGhpcy5ib3VuZGFyaWVzLnJpZ2h0JiYobj1lLXRoaXMuYm91bmRhcmllcy5yaWdodCksdGhpcy5jYWxsYmFjayhuLG8pfTt2YXIgYSxsPWZ1bmN0aW9uKGUpe2UuZHJhZ1RvU2Nyb2xsTGlzdGVuaW5nPSExO3ZhciB0PWUudmlldy53dC53dFRhYmxlLmhvbGRlcjthPW5ldyBvLHQhPT13aW5kb3cmJihhLnNldEJvdW5kYXJpZXModC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSksYS5zZXRDYWxsYmFjayhmdW5jdGlvbihlLG4pezA+ZT90LnNjcm9sbExlZnQtPTUwOmU+MCYmKHQuc2Nyb2xsTGVmdCs9NTApLDA+bj90LnNjcm9sbFRvcC09MjA6bj4wJiYodC5zY3JvbGxUb3ArPTIwKX0pLGUuZHJhZ1RvU2Nyb2xsTGlzdGVuaW5nPSEwKX07SGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJJbml0IixmdW5jdGlvbigpe3ZhciBlPXRoaXMsdD1zKHRoaXMpO3QuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwibW91c2V1cCIsZnVuY3Rpb24oKXtlLmRyYWdUb1Njcm9sbExpc3RlbmluZz0hMX0pLHQuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudCwibW91c2Vtb3ZlIixmdW5jdGlvbih0KXtlLmRyYWdUb1Njcm9sbExpc3RlbmluZyYmYS5jaGVjayh0LmNsaWVudFgsdC5jbGllbnRZKX0pfSksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJEZXN0cm95IixmdW5jdGlvbigpe3ModGhpcykuY2xlYXIoKX0pLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyT25DZWxsTW91c2VEb3duIixmdW5jdGlvbigpe2wodGhpcyl9KSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlck9uQ2VsbENvcm5lck1vdXNlRG93biIsZnVuY3Rpb24oKXtsKHRoaXMpfSksSGFuZHNvbnRhYmxlLnBsdWdpbnMuRHJhZ1RvU2Nyb2xsPW99LHtldmVudE1hbmFnZXI6NDEscGx1Z2luczo1N31dLDc2OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se01hbnVhbENvbHVtbkZyZWV6ZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGF9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGk9KG89ZSgiX2Jhc2UiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pWyJkZWZhdWx0Il0scz0ocj1lKCJwbHVnaW5zIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5yZWdpc3RlclBsdWdpbixhPWZ1bmN0aW9uKGUpeyR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yKGwpLmNhbGwodGhpcyxlKX0sbD1hOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhhLHtpc0VuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4hIXRoaXMuaG90LmdldFNldHRpbmdzKCkubWFudWFsQ29sdW1uRnJlZXplfSxlbmFibGVQbHVnaW46ZnVuY3Rpb24oKXt2YXIgZT10aGlzO3RoaXMuZW5hYmxlZHx8KHRoaXMuYWRkSG9vaygibW9kaWZ5Q29sIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbk1vZGlmeUNvbCh0KX0pLHRoaXMuYWRkSG9vaygiYWZ0ZXJDb250ZXh0TWVudURlZmF1bHRPcHRpb25zIixmdW5jdGlvbih0KXtyZXR1cm4gZS5hZGRDb250ZXh0TWVudUVudHJ5KHQpfSksJHRyYWNldXJSdW50aW1lLnN1cGVyR2V0KHRoaXMsbC5wcm90b3R5cGUsImVuYWJsZVBsdWdpbiIpLmNhbGwodGhpcykpfSxkaXNhYmxlUGx1Z2luOmZ1bmN0aW9uKCl7JHRyYWNldXJSdW50aW1lLnN1cGVyR2V0KHRoaXMsbC5wcm90b3R5cGUsImRpc2FibGVQbHVnaW4iKS5jYWxsKHRoaXMpfSxpbml0OmZ1bmN0aW9uKCl7JHRyYWNldXJSdW50aW1lLnN1cGVyR2V0KHRoaXMsbC5wcm90b3R5cGUsImluaXQiKS5jYWxsKHRoaXMpLCJ1bmRlZmluZWQiPT10eXBlb2YgdGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zUGx1Z2luVXNhZ2VzP3RoaXMuaG90Lm1hbnVhbENvbHVtblBvc2l0aW9uc1BsdWdpblVzYWdlcz1bIm1hbnVhbENvbHVtbkZyZWV6ZSJdOnRoaXMuaG90Lm1hbnVhbENvbHVtblBvc2l0aW9uc1BsdWdpblVzYWdlcy5wdXNoKCJtYW51YWxDb2x1bW5GcmVlemUiKSx0aGlzLmZpeGVkQ29sdW1uc0NvdW50PXRoaXMuaG90LmdldFNldHRpbmdzKCkuZml4ZWRDb2x1bW5zTGVmdH0sb25Nb2RpZnlDb2w6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuaG90Lm1hbnVhbENvbHVtblBvc2l0aW9uc1BsdWdpblVzYWdlcy5sZW5ndGg+MT9lOnRoaXMuZ2V0TW9kaWZpZWRDb2x1bW5JbmRleChlKX0sZ2V0TW9kaWZpZWRDb2x1bW5JbmRleDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zW2VdfSxhZGRDb250ZXh0TWVudUVudHJ5OmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7ZS5pdGVtcy5wdXNoKEhhbmRzb250YWJsZS5wbHVnaW5zLkNvbnRleHRNZW51LlNFUEFSQVRPUix7a2V5OiJmcmVlemVfY29sdW1uIixuYW1lOmZ1bmN0aW9uKCl7dmFyIGU9dC5ob3QuZ2V0U2VsZWN0ZWQoKVsxXTtyZXR1cm4gZT50LmZpeGVkQ29sdW1uc0NvdW50LTE/IkZyZWV6ZSB0aGlzIGNvbHVtbiI6IlVuZnJlZXplIHRoaXMgY29sdW1uIn0sZGlzYWJsZWQ6ZnVuY3Rpb24oKXt2YXIgZT10LmhvdC5nZXRTZWxlY3RlZCgpO3JldHVybiBlWzFdIT09ZVszXX0sY2FsbGJhY2s6ZnVuY3Rpb24oKXt2YXIgZT10LmhvdC5nZXRTZWxlY3RlZCgpWzFdO2U+dC5maXhlZENvbHVtbnNDb3VudC0xP3QuZnJlZXplQ29sdW1uKGUpOnQudW5mcmVlemVDb2x1bW4oZSl9fSl9LGZyZWV6ZUNvbHVtbjpmdW5jdGlvbihlKXtpZighKGU8PXRoaXMuZml4ZWRDb2x1bW5zQ291bnQtMSkpe3ZhciB0PXRoaXMuZ2V0TW9kaWZpZWRDb2x1bW5JbmRleChlKXx8ZTt0aGlzLmNoZWNrUG9zaXRpb25EYXRhKHQpLHRoaXMubW9kaWZ5Q29sdW1uT3JkZXIodCxlLG51bGwsImZyZWV6ZSIpLHRoaXMuYWRkRml4ZWRDb2x1bW4oKSx0aGlzLmhvdC52aWV3Lnd0Lnd0T3ZlcmxheXMubGVmdE92ZXJsYXkucmVmcmVzaCgpLHRoaXMuaG90LnZpZXcud3Qud3RPdmVybGF5cy5hZGp1c3RFbGVtZW50c1NpemUoKX19LHVuZnJlZXplQ29sdW1uOmZ1bmN0aW9uKGUpe2lmKCEoZT50aGlzLmZpeGVkQ29sdW1uc0NvdW50LTEpKXt2YXIgdD10aGlzLmdldEJlc3RDb2x1bW5SZXR1cm5Qb3NpdGlvbihlKSxuPXRoaXMuZ2V0TW9kaWZpZWRDb2x1bW5JbmRleChlKXx8ZTt0aGlzLmNoZWNrUG9zaXRpb25EYXRhKG4pLHRoaXMubW9kaWZ5Q29sdW1uT3JkZXIobixlLHQsInVuZnJlZXplIiksdGhpcy5yZW1vdmVGaXhlZENvbHVtbigpLHRoaXMuaG90LnZpZXcud3Qud3RPdmVybGF5cy5sZWZ0T3ZlcmxheS5yZWZyZXNoKCksdGhpcy5ob3Qudmlldy53dC53dE92ZXJsYXlzLmFkanVzdEVsZW1lbnRzU2l6ZSgpfX0sYWRkRml4ZWRDb2x1bW46ZnVuY3Rpb24oKXt0aGlzLmhvdC51cGRhdGVTZXR0aW5ncyh7Zml4ZWRDb2x1bW5zTGVmdDp0aGlzLmZpeGVkQ29sdW1uc0NvdW50KzF9KSx0aGlzLmZpeGVkQ29sdW1uc0NvdW50Kyt9LHJlbW92ZUZpeGVkQ29sdW1uOmZ1bmN0aW9uKCl7dGhpcy5ob3QudXBkYXRlU2V0dGluZ3Moe2ZpeGVkQ29sdW1uc0xlZnQ6dGhpcy5maXhlZENvbHVtbnNDb3VudC0xfSksdGhpcy5maXhlZENvbHVtbnNDb3VudC0tfSxjaGVja1Bvc2l0aW9uRGF0YTpmdW5jdGlvbihlKXt0aGlzLmhvdC5tYW51YWxDb2x1bW5Qb3NpdGlvbnMmJjAhPT10aGlzLmhvdC5tYW51YWxDb2x1bW5Qb3NpdGlvbnMubGVuZ3RofHx0aGlzLmhvdC5tYW51YWxDb2x1bW5Qb3NpdGlvbnN8fCh0aGlzLmhvdC5tYW51YWxDb2x1bW5Qb3NpdGlvbnM9W10pLGU/dGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zW2VdfHx0aGlzLmNyZWF0ZVBvc2l0aW9uRGF0YShlKzEpOnRoaXMuY3JlYXRlUG9zaXRpb25EYXRhKHRoaXMuaG90LmNvdW50Q29scygpKX0sY3JlYXRlUG9zaXRpb25EYXRhOmZ1bmN0aW9uKGUpe2lmKHRoaXMuaG90Lm1hbnVhbENvbHVtblBvc2l0aW9ucy5sZW5ndGg8ZSlmb3IodmFyIHQ9dGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zLmxlbmd0aDtlPnQ7dCsrKXRoaXMuaG90Lm1hbnVhbENvbHVtblBvc2l0aW9uc1t0XT10fSxtb2RpZnlDb2x1bW5PcmRlcjpmdW5jdGlvbihlLHQsbixvKXtudWxsPT1uJiYobj1lKSwiZnJlZXplIj09PW8/dGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zLnNwbGljZSh0aGlzLmZpeGVkQ29sdW1uc0NvdW50LDAsdGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zLnNwbGljZSh0LDEpWzBdKToidW5mcmVlemUiPT09byYmdGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zLnNwbGljZShuLDAsdGhpcy5ob3QubWFudWFsQ29sdW1uUG9zaXRpb25zLnNwbGljZSh0LDEpWzBdKX0sZ2V0QmVzdENvbHVtblJldHVyblBvc2l0aW9uOmZ1bmN0aW9uKGUpe2Zvcih2YXIgdD10aGlzLmZpeGVkQ29sdW1uc0NvdW50LG49dGhpcy5nZXRNb2RpZmllZENvbHVtbkluZGV4KHQpLG89dGhpcy5nZXRNb2RpZmllZENvbHVtbkluZGV4KGUpO28+bjspdCsrLG49dGhpcy5nZXRNb2RpZmllZENvbHVtbkluZGV4KHQpO3JldHVybiB0LTF9fSx7fSxpKSxzKCJtYW51YWxDb2x1bW5GcmVlemUiLGEpfSx7X2Jhc2U6NTgscGx1Z2luczo1N31dLDc3OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oKXtmdW5jdGlvbiBlKGUpe2c9dGhpcyxtPWU7dmFyIHQ9dGhpcy52aWV3Lnd0Lnd0VGFibGUuZ2V0Q29vcmRzKGUpLmNvbDtpZih0Pj0wKXtmPXQ7dmFyIG49bS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtsPW4ubGVmdCx2LnN0eWxlLnRvcD1uLnRvcCsicHgiLHYuc3R5bGUubGVmdD1sKyJweCIsZy5yb290RWxlbWVudC5hcHBlbmRDaGlsZCh2KX19ZnVuY3Rpb24gdChlLHQpe3ZhciBuPWUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksbz02O3Q+MD92LnN0eWxlLmxlZnQ9bi5sZWZ0K24ud2lkdGgtbysicHgiOnYuc3R5bGUubGVmdD1uLmxlZnQrInB4In1mdW5jdGlvbiBuKCl7dmFyIGU9dGhpczt1KHYsImFjdGl2ZSIpLHUodywiYWN0aXZlIik7dmFyIHQ9bS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTt3LnN0eWxlLndpZHRoPXQud2lkdGgrInB4Iix3LnN0eWxlLmhlaWdodD1lLnZpZXcubWF4aW11bVZpc2libGVFbGVtZW50SGVpZ2h0KDApKyJweCIsdy5zdHlsZS50b3A9di5zdHlsZS50b3Asdy5zdHlsZS5sZWZ0PWwrInB4IixlLnJvb3RFbGVtZW50LmFwcGVuZENoaWxkKHcpfWZ1bmN0aW9uIG8oZSl7dy5zdHlsZS5sZWZ0PWwrZSsicHgifWZ1bmN0aW9uIHIoKXtkKHYsImFjdGl2ZSIpLGQodywiYWN0aXZlIil9dmFyIGkscyxhLGwsZixnLG0sdj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKSx3PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHk9aCh0aGlzKTt2LmNsYXNzTmFtZT0ibWFudWFsQ29sdW1uTW92ZXIiLHcuY2xhc3NOYW1lPSJtYW51YWxDb2x1bW5Nb3Zlckd1aWRlIjt2YXIgYj1mdW5jdGlvbigpe3ZhciBlPXRoaXM7SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihlLCJwZXJzaXN0ZW50U3RhdGVTYXZlIiwibWFudWFsQ29sdW1uUG9zaXRpb25zIixlLm1hbnVhbENvbHVtblBvc2l0aW9ucyl9LEM9ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9e307cmV0dXJuIEhhbmRzb250YWJsZS5ob29rcy5ydW4oZSwicGVyc2lzdGVudFN0YXRlTG9hZCIsIm1hbnVhbENvbHVtblBvc2l0aW9ucyIsdCksdC52YWx1ZX0sUj1mdW5jdGlvbihlKXtyZXR1cm4iQk9EWSIhPWUudGFnTmFtZT8iVEhFQUQiPT1lLnBhcmVudE5vZGUudGFnTmFtZT8hMDooZT1lLnBhcmVudE5vZGUsUihlKSk6ITF9LF89ZnVuY3Rpb24oZSl7cmV0dXJuIlRBQkxFIiE9ZS50YWdOYW1lPyJUSCI9PWUudGFnTmFtZT9lOl8oZS5wYXJlbnROb2RlKTpudWxsfSxTPWZ1bmN0aW9uKCl7dmFyIGwsdT10aGlzO3kuYWRkRXZlbnRMaXN0ZW5lcih1LnJvb3RFbGVtZW50LCJtb3VzZW92ZXIiLGZ1bmN0aW9uKG4pe2lmKFIobi50YXJnZXQpKXt2YXIgbz1fKG4udGFyZ2V0KTtpZihvKWlmKGwpe3ZhciByPXUudmlldy53dC53dFRhYmxlLmdldENvb3JkcyhvKS5jb2w7cj49MCYmKHM9cix0KG4udGFyZ2V0LHMtaSkpfWVsc2UgZS5jYWxsKHUsbyl9fSkseS5hZGRFdmVudExpc3RlbmVyKHUucm9vdEVsZW1lbnQsIm1vdXNlZG93biIsZnVuY3Rpb24oZSl7YyhlLnRhcmdldCwibWFudWFsQ29sdW1uTW92ZXIiKSYmKGE9cChlKSxuLmNhbGwodSksbD11LGk9ZixzPWYpfSkseS5hZGRFdmVudExpc3RlbmVyKHdpbmRvdywibW91c2Vtb3ZlIixmdW5jdGlvbihlKXtsJiZvKHAoZSktYSl9KSx5LmFkZEV2ZW50TGlzdGVuZXIod2luZG93LCJtb3VzZXVwIixmdW5jdGlvbih0KXtsJiYocigpLGw9ITEsVCh1Lm1hbnVhbENvbHVtblBvc2l0aW9ucyx1LmNvdW50Q29scygpKSx1Lm1hbnVhbENvbHVtblBvc2l0aW9ucy5zcGxpY2UocywwLHUubWFudWFsQ29sdW1uUG9zaXRpb25zLnNwbGljZShpLDEpWzBdKSxIYW5kc29udGFibGUuaG9va3MucnVuKHUsImJlZm9yZUNvbHVtbk1vdmUiLGkscyksdS5mb3JjZUZ1bGxSZW5kZXI9ITAsdS52aWV3LnJlbmRlcigpLGIuY2FsbCh1KSxIYW5kc29udGFibGUuaG9va3MucnVuKHUsImFmdGVyQ29sdW1uTW92ZSIsaSxzKSxlLmNhbGwodSxtKSl9KSx1LmFkZEhvb2soImFmdGVyRGVzdHJveSIsRSl9LEU9ZnVuY3Rpb24oKXt5LmNsZWFyKCl9LFQ9ZnVuY3Rpb24oZSx0KXtpZihlLmxlbmd0aDx0KWZvcih2YXIgbj1lLmxlbmd0aDt0Pm47bisrKWVbbl09bn07dGhpcy5iZWZvcmVJbml0PWZ1bmN0aW9uKCl7dGhpcy5tYW51YWxDb2x1bW5Qb3NpdGlvbnM9W119LHRoaXMuaW5pdD1mdW5jdGlvbihlKXt2YXIgdD10aGlzLG49ISF0aGlzLmdldFNldHRpbmdzKCkubWFudWFsQ29sdW1uTW92ZTtpZihuKXt2YXIgbz10aGlzLmdldFNldHRpbmdzKCkubWFudWFsQ29sdW1uTW92ZSxyPUMuY2FsbCh0KTsidW5kZWZpbmVkIiE9dHlwZW9mIHI/dGhpcy5tYW51YWxDb2x1bW5Qb3NpdGlvbnM9cjpBcnJheS5pc0FycmF5KG8pP3RoaXMubWFudWFsQ29sdW1uUG9zaXRpb25zPW86dGhpcy5tYW51YWxDb2x1bW5Qb3NpdGlvbnM9W10sKCJhZnRlckluaXQiPT09ZXx8ImFmdGVyVXBkYXRlU2V0dGluZ3MiPT09ZSYmMD09PXkuY29udGV4dC5ldmVudExpc3RlbmVycy5sZW5ndGgpJiYoInVuZGVmaW5lZCI9PXR5cGVvZiB0Lm1hbnVhbENvbHVtblBvc2l0aW9uc1BsdWdpblVzYWdlcz90Lm1hbnVhbENvbHVtblBvc2l0aW9uc1BsdWdpblVzYWdlcz1bIm1hbnVhbENvbHVtbk1vdmUiXTp0Lm1hbnVhbENvbHVtblBvc2l0aW9uc1BsdWdpblVzYWdlcy5wdXNoKCJtYW51YWxDb2x1bW5Nb3ZlIiksUy5jYWxsKHRoaXMpLHRoaXMubWFudWFsQ29sdW1uUG9zaXRpb25zLmxlbmd0aD4wJiYodGhpcy5mb3JjZUZ1bGxSZW5kZXI9ITAsdGhpcy5yZW5kZXIoKSkpfWVsc2V7dmFyIGk9dC5tYW51YWxDb2x1bW5Qb3NpdGlvbnNQbHVnaW5Vc2FnZXM/dC5tYW51YWxDb2x1bW5Qb3NpdGlvbnNQbHVnaW5Vc2FnZXMuaW5kZXhPZigibWFudWFsQ29sdW1uTW92ZSIpOi0xO2k+LTEmJihFLmNhbGwodGhpcyksdGhpcy5tYW51YWxDb2x1bW5Qb3NpdGlvbnM9W10sdC5tYW51YWxDb2x1bW5Qb3NpdGlvbnNQbHVnaW5Vc2FnZXNbaV09dm9pZCAwKX19LHRoaXMubW9kaWZ5Q29sPWZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmdldFNldHRpbmdzKCkubWFudWFsQ29sdW1uTW92ZT8oInVuZGVmaW5lZCI9PXR5cGVvZiB0aGlzLm1hbnVhbENvbHVtblBvc2l0aW9uc1tlXSYmVCh0aGlzLm1hbnVhbENvbHVtblBvc2l0aW9ucyxlKzEpLHRoaXMubWFudWFsQ29sdW1uUG9zaXRpb25zW2VdKTplfSx0aGlzLmFmdGVyUmVtb3ZlQ29sPWZ1bmN0aW9uKGUsdCl7aWYodGhpcy5nZXRTZXR0aW5ncygpLm1hbnVhbENvbHVtbk1vdmUpe3ZhciBuLG89dGhpcy5tYW51YWxDb2x1bW5Qb3NpdGlvbnM7bj1vLnNwbGljZShlLHQpLG89by5tYXAoZnVuY3Rpb24oZSl7dmFyIHQsbz1lO2Zvcih0PTA7dDxuLmxlbmd0aDt0KyspZT5uW3RdJiZvLS07cmV0dXJuIG99KSx0aGlzLm1hbnVhbENvbHVtblBvc2l0aW9ucz1vfX0sdGhpcy5hZnRlckNyZWF0ZUNvbD1mdW5jdGlvbihlLHQpe2lmKHRoaXMuZ2V0U2V0dGluZ3MoKS5tYW51YWxDb2x1bW5Nb3ZlKXt2YXIgbj10aGlzLm1hbnVhbENvbHVtblBvc2l0aW9ucztpZihuLmxlbmd0aCl7Zm9yKHZhciBvPVtdLHI9MDt0PnI7cisrKW8ucHVzaChlK3IpO2U+PW4ubGVuZ3RoP24uY29uY2F0KG8pOihuPW4ubWFwKGZ1bmN0aW9uKG4pe3JldHVybiBuPj1lP24rdDpufSksbi5zcGxpY2UuYXBwbHkobixbZSwwXS5jb25jYXQobykpKSx0aGlzLm1hbnVhbENvbHVtblBvc2l0aW9ucz1ufX19fU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se01hbnVhbENvbHVtbk1vdmU6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGEsbD0ocj1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KSx1PWwuYWRkQ2xhc3MsYz1sLmhhc0NsYXNzLGQ9bC5yZW1vdmVDbGFzcyxoPShpPWUoImV2ZW50TWFuYWdlciIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuZXZlbnRNYW5hZ2VyLGY9KHM9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLHA9Zi5wYWdlWCxnPShmLnBhZ2VZLChhPWUoInBsdWdpbnMiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLnJlZ2lzdGVyUGx1Z2luLG5ldyBvKTtIYW5kc29udGFibGUuaG9va3MuYWRkKCJiZWZvcmVJbml0IixnLmJlZm9yZUluaXQpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVySW5pdCIsZnVuY3Rpb24oKXtnLmluaXQuY2FsbCh0aGlzLCJhZnRlckluaXQiKX0pLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyVXBkYXRlU2V0dGluZ3MiLGZ1bmN0aW9uKCl7Zy5pbml0LmNhbGwodGhpcywiYWZ0ZXJVcGRhdGVTZXR0aW5ncyIpfSksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgibW9kaWZ5Q29sIixnLm1vZGlmeUNvbCksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJSZW1vdmVDb2wiLGcuYWZ0ZXJSZW1vdmVDb2wpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyQ3JlYXRlQ29sIixnLmFmdGVyQ3JlYXRlQ29sKSxIYW5kc29udGFibGUuaG9va3MucmVnaXN0ZXIoImJlZm9yZUNvbHVtbk1vdmUiKSxIYW5kc29udGFibGUuaG9va3MucmVnaXN0ZXIoImFmdGVyQ29sdW1uTW92ZSIpfSx7ZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy9kb20vZXZlbnQiOjQ2LHBsdWdpbnM6NTd9XSw3ODpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtNYW51YWxDb2x1bW5SZXNpemU6e2dldDpmdW5jdGlvbigpe3JldHVybiB2fX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIG8scixpLHMsYSxsPShvPWUoIl9iYXNlLmpzIiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KVsiZGVmYXVsdCJdLHU9KHI9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksYz11LmFkZENsYXNzLGQ9dS5oYXNDbGFzcyxoPXUucmVtb3ZlQ2xhc3MsZj0oaT1lKCJldmVudE1hbmFnZXIiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLmV2ZW50TWFuYWdlcixwPShzPWUoImhlbHBlcnMvZG9tL2V2ZW50IikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KSxnPXAucGFnZVgsbT0ocC5wYWdlWSwoYT1lKCJwbHVnaW5zIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5yZWdpc3RlclBsdWdpbiksdj1mdW5jdGlvbihlKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJDb25zdHJ1Y3Rvcih3KS5jYWxsKHRoaXMsZSksdGhpcy5jdXJyZW50VEg9bnVsbCx0aGlzLmN1cnJlbnRDb2w9bnVsbCx0aGlzLmN1cnJlbnRXaWR0aD1udWxsLHRoaXMubmV3U2l6ZT1udWxsLHRoaXMuc3RhcnRZPW51bGwsdGhpcy5zdGFydFdpZHRoPW51bGwsdGhpcy5zdGFydE9mZnNldD1udWxsLHRoaXMuaGFuZGxlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHRoaXMuZ3VpZGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdGhpcy5ldmVudE1hbmFnZXI9Zih0aGlzKSx0aGlzLnByZXNzZWQ9bnVsbCx0aGlzLmRibGNsaWNrPTAsdGhpcy5hdXRvcmVzaXplVGltZW91dD1udWxsLHRoaXMubWFudWFsQ29sdW1uV2lkdGhzPVtdLGModGhpcy5oYW5kbGUsIm1hbnVhbENvbHVtblJlc2l6ZXIiKSxjKHRoaXMuZ3VpZGUsIm1hbnVhbENvbHVtblJlc2l6ZXJHdWlkZSIpfSx3PXY7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKHYse2lzRW5hYmxlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmhvdC5nZXRTZXR0aW5ncygpLm1hbnVhbENvbHVtblJlc2l6ZX0sZW5hYmxlUGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcztpZighdGhpcy5lbmFibGVkKXt0aGlzLm1hbnVhbENvbHVtbldpZHRocz1bXTt2YXIgdD10aGlzLmhvdC5nZXRTZXR0aW5ncygpLm1hbnVhbENvbHVtblJlc2l6ZSxuPXRoaXMubG9hZE1hbnVhbENvbHVtbldpZHRocygpO3RoaXMuYWRkSG9vaygibW9kaWZ5Q29sV2lkdGgiLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUub25Nb2RpZnlDb2xXaWR0aCh0LG4pfSksInVuZGVmaW5lZCIhPXR5cGVvZiBuP3RoaXMubWFudWFsQ29sdW1uV2lkdGhzPW46QXJyYXkuaXNBcnJheSh0KT90aGlzLm1hbnVhbENvbHVtbldpZHRocz10OnRoaXMubWFudWFsQ29sdW1uV2lkdGhzPVtdLEhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcigiYmVmb3JlQ29sdW1uUmVzaXplIiksSGFuZHNvbnRhYmxlLmhvb2tzLnJlZ2lzdGVyKCJhZnRlckNvbHVtblJlc2l6ZSIpLHRoaXMuYmluZEV2ZW50cygpLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLHcucHJvdG90eXBlLCJlbmFibGVQbHVnaW4iKS5jYWxsKHRoaXMpfX0sdXBkYXRlUGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5tYW51YWxDb2x1bW5SZXNpemU7QXJyYXkuaXNBcnJheShlKT90aGlzLm1hbnVhbENvbHVtbldpZHRocz1lOnRoaXMubWFudWFsQ29sdW1uV2lkdGhzPVtdfSxkaXNhYmxlUGx1Z2luOmZ1bmN0aW9uKCl7JHRyYWNldXJSdW50aW1lLnN1cGVyR2V0KHRoaXMsdy5wcm90b3R5cGUsImRpc2FibGVQbHVnaW4iKS5jYWxsKHRoaXMpfSxzYXZlTWFudWFsQ29sdW1uV2lkdGhzOmZ1bmN0aW9uKCl7dGhpcy5ob3QucnVuSG9va3MoInBlcnNpc3RlbnRTdGF0ZVNhdmUiLCJtYW51YWxDb2x1bW5XaWR0aHMiLHRoaXMubWFudWFsQ29sdW1uV2lkdGhzKX0sbG9hZE1hbnVhbENvbHVtbldpZHRoczpmdW5jdGlvbigpe3ZhciBlPXt9O3JldHVybiB0aGlzLmhvdC5ydW5Ib29rcygicGVyc2lzdGVudFN0YXRlTG9hZCIsIm1hbnVhbENvbHVtbldpZHRocyIsZSksZS52YWx1ZX0sc2V0dXBIYW5kbGVQb3NpdGlvbjpmdW5jdGlvbihlKXt0aGlzLmN1cnJlbnRUSD1lO3ZhciB0PXRoaXMuaG90LnZpZXcud3Qud3RUYWJsZS5nZXRDb29yZHMoZSkuY29sO2lmKHQ+PTApe3ZhciBuPXRoaXMuY3VycmVudFRILmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO3RoaXMuY3VycmVudENvbD10LHRoaXMuc3RhcnRPZmZzZXQ9bi5sZWZ0LTYsdGhpcy5zdGFydFdpZHRoPXBhcnNlSW50KG4ud2lkdGgsMTApLHRoaXMuaGFuZGxlLnN0eWxlLnRvcD1uLnRvcCsicHgiLHRoaXMuaGFuZGxlLnN0eWxlLmxlZnQ9dGhpcy5zdGFydE9mZnNldCt0aGlzLnN0YXJ0V2lkdGgrInB4Iix0aGlzLmhvdC5yb290RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmhhbmRsZSl9fSxyZWZyZXNoSGFuZGxlUG9zaXRpb246ZnVuY3Rpb24oKXt0aGlzLmhhbmRsZS5zdHlsZS5sZWZ0PXRoaXMuc3RhcnRPZmZzZXQrdGhpcy5jdXJyZW50V2lkdGgrInB4In0sc2V0dXBHdWlkZVBvc2l0aW9uOmZ1bmN0aW9uKCl7Yyh0aGlzLmhhbmRsZSwiYWN0aXZlIiksYyh0aGlzLmd1aWRlLCJhY3RpdmUiKSx0aGlzLmd1aWRlLnN0eWxlLnRvcD10aGlzLmhhbmRsZS5zdHlsZS50b3AsdGhpcy5ndWlkZS5zdHlsZS5sZWZ0PXRoaXMuaGFuZGxlLnN0eWxlLmxlZnQsdGhpcy5ndWlkZS5zdHlsZS5oZWlnaHQ9dGhpcy5ob3Qudmlldy5tYXhpbXVtVmlzaWJsZUVsZW1lbnRIZWlnaHQoMCkrInB4Iix0aGlzLmhvdC5yb290RWxlbWVudC5hcHBlbmRDaGlsZCh0aGlzLmd1aWRlKX0scmVmcmVzaEd1aWRlUG9zaXRpb246ZnVuY3Rpb24oKXt0aGlzLmd1aWRlLnN0eWxlLmxlZnQ9dGhpcy5oYW5kbGUuc3R5bGUubGVmdH0saGlkZUhhbmRsZUFuZEd1aWRlOmZ1bmN0aW9uKCl7aCh0aGlzLmhhbmRsZSwiYWN0aXZlIiksaCh0aGlzLmd1aWRlLCJhY3RpdmUiKX0sY2hlY2tJZkNvbHVtbkhlYWRlcjpmdW5jdGlvbihlKXtyZXR1cm4iQk9EWSIhPWUudGFnTmFtZT8iVEhFQUQiPT1lLnBhcmVudE5vZGUudGFnTmFtZT8hMDooZT1lLnBhcmVudE5vZGUsdGhpcy5jaGVja0lmQ29sdW1uSGVhZGVyKGUpKTohMX0sZ2V0VEhGcm9tVGFyZ2V0RWxlbWVudDpmdW5jdGlvbihlKXtyZXR1cm4iVEFCTEUiIT1lLnRhZ05hbWU/IlRIIj09ZS50YWdOYW1lP2U6dGhpcy5nZXRUSEZyb21UYXJnZXRFbGVtZW50KGUucGFyZW50Tm9kZSk6bnVsbH0sb25Nb3VzZU92ZXI6ZnVuY3Rpb24oZSl7aWYodGhpcy5jaGVja0lmQ29sdW1uSGVhZGVyKGUudGFyZ2V0KSl7dmFyIHQ9dGhpcy5nZXRUSEZyb21UYXJnZXRFbGVtZW50KGUudGFyZ2V0KTtpZighdClyZXR1cm47dmFyIG49dC5nZXRBdHRyaWJ1dGUoImNvbHNwYW4iKTshdHx8bnVsbCE9PW4mJjEhPT1ufHx0aGlzLnByZXNzZWR8fHRoaXMuc2V0dXBIYW5kbGVQb3NpdGlvbih0KX19LGFmdGVyTW91c2VEb3duVGltZW91dDpmdW5jdGlvbigpe2lmKHRoaXMuZGJsY2xpY2s+PTIpe3ZhciBlPXRoaXMuaG90LnJ1bkhvb2tzKCJiZWZvcmVDb2x1bW5SZXNpemUiLHRoaXMuY3VycmVudENvbCx0aGlzLm5ld1NpemUsITApO3ZvaWQgMCE9PWUmJih0aGlzLm5ld1NpemU9ZSksdGhpcy5zZXRNYW51YWxTaXplKHRoaXMuY3VycmVudENvbCx0aGlzLm5ld1NpemUpLHRoaXMuaG90LmZvcmNlRnVsbFJlbmRlcj0hMCx0aGlzLmhvdC52aWV3LnJlbmRlcigpLHRoaXMuaG90LnZpZXcud3Qud3RPdmVybGF5cy5hZGp1c3RFbGVtZW50c1NpemUoITApLHRoaXMuaG90LnJ1bkhvb2tzKCJhZnRlckNvbHVtblJlc2l6ZSIsdGhpcy5jdXJyZW50Q29sLHRoaXMubmV3U2l6ZSwhMCl9dGhpcy5kYmxjbGljaz0wLHRoaXMuYXV0b3Jlc2l6ZVRpbWVvdXQ9bnVsbH0sb25Nb3VzZURvd246ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcztkKGUudGFyZ2V0LCJtYW51YWxDb2x1bW5SZXNpemVyIikmJih0aGlzLnNldHVwR3VpZGVQb3NpdGlvbigpLHRoaXMucHJlc3NlZD10aGlzLmhvdCxudWxsPT09dGhpcy5hdXRvcmVzaXplVGltZW91dCYmKHRoaXMuYXV0b3Jlc2l6ZVRpbWVvdXQ9c2V0VGltZW91dChmdW5jdGlvbigpe3JldHVybiB0LmFmdGVyTW91c2VEb3duVGltZW91dCgpfSw1MDApLHRoaXMuaG90Ll9yZWdpc3RlclRpbWVvdXQodGhpcy5hdXRvcmVzaXplVGltZW91dCkpLHRoaXMuZGJsY2xpY2srKyx0aGlzLnN0YXJ0WD1nKGUpLHRoaXMubmV3U2l6ZT10aGlzLnN0YXJ0V2lkdGgpfSxvbk1vdXNlTW92ZTpmdW5jdGlvbihlKXt0aGlzLnByZXNzZWQmJih0aGlzLmN1cnJlbnRXaWR0aD10aGlzLnN0YXJ0V2lkdGgrKGcoZSktdGhpcy5zdGFydFgpLHRoaXMubmV3U2l6ZT10aGlzLnNldE1hbnVhbFNpemUodGhpcy5jdXJyZW50Q29sLHRoaXMuY3VycmVudFdpZHRoKSx0aGlzLnJlZnJlc2hIYW5kbGVQb3NpdGlvbigpLHRoaXMucmVmcmVzaEd1aWRlUG9zaXRpb24oKSl9LG9uTW91c2VVcDpmdW5jdGlvbihlKXt0aGlzLnByZXNzZWQmJih0aGlzLmhpZGVIYW5kbGVBbmRHdWlkZSgpLHRoaXMucHJlc3NlZD0hMSx0aGlzLm5ld1NpemUhPXRoaXMuc3RhcnRXaWR0aCYmKHRoaXMuaG90LnJ1bkhvb2tzKCJiZWZvcmVDb2x1bW5SZXNpemUiLHRoaXMuY3VycmVudENvbCx0aGlzLm5ld1NpemUpLHRoaXMuaG90LmZvcmNlRnVsbFJlbmRlcj0hMCx0aGlzLmhvdC52aWV3LnJlbmRlcigpLHRoaXMuaG90LnZpZXcud3Qud3RPdmVybGF5cy5hZGp1c3RFbGVtZW50c1NpemUoITApLHRoaXMuc2F2ZU1hbnVhbENvbHVtbldpZHRocygpLHRoaXMuaG90LnJ1bkhvb2tzKCJhZnRlckNvbHVtblJlc2l6ZSIsdGhpcy5jdXJyZW50Q29sLHRoaXMubmV3U2l6ZSkpLHRoaXMuc2V0dXBIYW5kbGVQb3NpdGlvbih0aGlzLmN1cnJlbnRUSCkpfSxiaW5kRXZlbnRzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuaG90LnJvb3RFbGVtZW50LCJtb3VzZW92ZXIiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uTW91c2VPdmVyKHQpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmhvdC5yb290RWxlbWVudCwibW91c2Vkb3duIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbk1vdXNlRG93bih0KX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIod2luZG93LCJtb3VzZW1vdmUiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uTW91c2VNb3ZlKHQpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih3aW5kb3csIm1vdXNldXAiLGZ1bmN0aW9uKHQpe3JldHVybiBlLm9uTW91c2VVcCh0KX0pfSxzZXRNYW51YWxTaXplOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHQ9TWF0aC5tYXgodCwyMCksZT10aGlzLmhvdC5ydW5Ib29rcygibW9kaWZ5Q29sIixlKSx0aGlzLm1hbnVhbENvbHVtbldpZHRoc1tlXT10LHR9LG9uTW9kaWZ5Q29sV2lkdGg6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdGhpcy5lbmFibGVkJiYodD10aGlzLmhvdC5ydW5Ib29rcygibW9kaWZ5Q29sIix0KSx0aGlzLmhvdC5nZXRTZXR0aW5ncygpLm1hbnVhbENvbHVtblJlc2l6ZSYmdGhpcy5tYW51YWxDb2x1bW5XaWR0aHNbdF0pP3RoaXMubWFudWFsQ29sdW1uV2lkdGhzW3RdOmV9fSx7fSxsKSxtKCJtYW51YWxDb2x1bW5SZXNpemUiLHYpfSx7Il9iYXNlLmpzIjo1OCxldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDYscGx1Z2luczo1N31dLDc5OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oKXtmdW5jdGlvbiBlKGUpe3ZhciB0PXRoaXM7Zz1lO3ZhciBuPXRoaXMudmlldy53dC53dFRhYmxlLmdldENvb3JkcyhlKS5yb3c7aWYobj49MCl7Zj1uO3ZhciBvPWcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7bD1vLnRvcCxtLnN0eWxlLnRvcD1sKyJweCIsbS5zdHlsZS5sZWZ0PW8ubGVmdCsicHgiLHQucm9vdEVsZW1lbnQuYXBwZW5kQ2hpbGQobSl9fWZ1bmN0aW9uIHQoZSx0KXt2YXIgbj1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLG89Njt0PjA/bS5zdHlsZS50b3A9bi50b3Arbi5oZWlnaHQtbysicHgiOm0uc3R5bGUudG9wPW4udG9wKyJweCJ9ZnVuY3Rpb24gbigpe3ZhciBlPXRoaXM7dShtLCJhY3RpdmUiKSx1KHYsImFjdGl2ZSIpO3ZhciB0PWcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7di5zdHlsZS53aWR0aD1lLnZpZXcubWF4aW11bVZpc2libGVFbGVtZW50V2lkdGgoMCkrInB4Iix2LnN0eWxlLmhlaWdodD10LmhlaWdodCsicHgiLHYuc3R5bGUudG9wPWwrInB4Iix2LnN0eWxlLmxlZnQ9bS5zdHlsZS5sZWZ0LGUucm9vdEVsZW1lbnQuYXBwZW5kQ2hpbGQodil9ZnVuY3Rpb24gbyhlKXt2LnN0eWxlLnRvcD1sK2UrInB4In1mdW5jdGlvbiByKCl7ZChtLCJhY3RpdmUiKSxkKHYsImFjdGl2ZSIpfXZhciBpLHMsYSxsLGYsZyxtPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIiksdz1oKHRoaXMpO20uY2xhc3NOYW1lPSJtYW51YWxSb3dNb3ZlciIsdi5jbGFzc05hbWU9Im1hbnVhbFJvd01vdmVyR3VpZGUiO3ZhciB5PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcztIYW5kc29udGFibGUuaG9va3MucnVuKGUsInBlcnNpc3RlbnRTdGF0ZVNhdmUiLCJtYW51YWxSb3dQb3NpdGlvbnMiLGUubWFudWFsUm93UG9zaXRpb25zKX0sYj1mdW5jdGlvbigpe3ZhciBlPXRoaXMsdD17fTtyZXR1cm4gSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihlLCJwZXJzaXN0ZW50U3RhdGVMb2FkIiwibWFudWFsUm93UG9zaXRpb25zIix0KSx0LnZhbHVlfSxDPWZ1bmN0aW9uKGUpe3JldHVybiJCT0RZIiE9ZS50YWdOYW1lPyJUQk9EWSI9PWUucGFyZW50Tm9kZS50YWdOYW1lPyEwOihlPWUucGFyZW50Tm9kZSxDKGUpKTohMX0sUj1mdW5jdGlvbihlKXtyZXR1cm4iVEFCTEUiIT1lLnRhZ05hbWU/IlRIIj09ZS50YWdOYW1lP2U6UihlLnBhcmVudE5vZGUpOm51bGx9LF89ZnVuY3Rpb24oKXt2YXIgbCx1PXRoaXM7dy5hZGRFdmVudExpc3RlbmVyKHUucm9vdEVsZW1lbnQsIm1vdXNlb3ZlciIsZnVuY3Rpb24obil7aWYoQyhuLnRhcmdldCkpe3ZhciBvPVIobi50YXJnZXQpO28mJihsPyhzPXUudmlldy53dC53dFRhYmxlLmdldENvb3JkcyhvKS5yb3csdChvLHMtaSkpOmUuY2FsbCh1LG8pKX19KSx3LmFkZEV2ZW50TGlzdGVuZXIodS5yb290RWxlbWVudCwibW91c2Vkb3duIixmdW5jdGlvbihlKXtjKGUudGFyZ2V0LCJtYW51YWxSb3dNb3ZlciIpJiYoYT1wKGUpLG4uY2FsbCh1KSxsPXUsaT1mLHM9Zil9KSx3LmFkZEV2ZW50TGlzdGVuZXIod2luZG93LCJtb3VzZW1vdmUiLGZ1bmN0aW9uKGUpe2wmJm8ocChlKS1hKX0pLHcuYWRkRXZlbnRMaXN0ZW5lcih3aW5kb3csIm1vdXNldXAiLGZ1bmN0aW9uKHQpe2wmJihyKCksbD0hMSxFKHUubWFudWFsUm93UG9zaXRpb25zLHUuY291bnRSb3dzKCkpLHUubWFudWFsUm93UG9zaXRpb25zLnNwbGljZShzLDAsdS5tYW51YWxSb3dQb3NpdGlvbnMuc3BsaWNlKGksMSlbMF0pLEhhbmRzb250YWJsZS5ob29rcy5ydW4odSwiYmVmb3JlUm93TW92ZSIsaSxzKSx1LmZvcmNlRnVsbFJlbmRlcj0hMCx1LnZpZXcucmVuZGVyKCkseS5jYWxsKHUpLEhhbmRzb250YWJsZS5ob29rcy5ydW4odSwiYWZ0ZXJSb3dNb3ZlIixpLHMpLGUuY2FsbCh1LGcpKX0pLHUuYWRkSG9vaygiYWZ0ZXJEZXN0cm95IixTKX0sUz1mdW5jdGlvbigpe3cuY2xlYXIoKX0sRT1mdW5jdGlvbihlLHQpe2lmKGUubGVuZ3RoPHQpZm9yKHZhciBuPWUubGVuZ3RoO3Q+bjtuKyspZVtuXT1ufTt0aGlzLmJlZm9yZUluaXQ9ZnVuY3Rpb24oKXt0aGlzLm1hbnVhbFJvd1Bvc2l0aW9ucz1bXX0sdGhpcy5pbml0PWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMsbj0hIXQuZ2V0U2V0dGluZ3MoKS5tYW51YWxSb3dNb3ZlO2lmKG4pe3ZhciBvPXQuZ2V0U2V0dGluZ3MoKS5tYW51YWxSb3dNb3ZlLHI9Yi5jYWxsKHQpOyJ1bmRlZmluZWQiPT10eXBlb2YgdC5tYW51YWxSb3dQb3NpdGlvbnNQbHVnaW5Vc2FnZXM/dC5tYW51YWxSb3dQb3NpdGlvbnNQbHVnaW5Vc2FnZXM9WyJtYW51YWxDb2x1bW5Nb3ZlIl06dC5tYW51YWxSb3dQb3NpdGlvbnNQbHVnaW5Vc2FnZXMucHVzaCgibWFudWFsQ29sdW1uTW92ZSIpLCJ1bmRlZmluZWQiIT10eXBlb2Ygcj90aGlzLm1hbnVhbFJvd1Bvc2l0aW9ucz1yOkFycmF5LmlzQXJyYXkobyk/dGhpcy5tYW51YWxSb3dQb3NpdGlvbnM9bzp0aGlzLm1hbnVhbFJvd1Bvc2l0aW9ucz1bXSwoImFmdGVySW5pdCI9PT1lfHwiYWZ0ZXJVcGRhdGVTZXR0aW5ncyI9PT1lJiYwPT09dy5jb250ZXh0LmV2ZW50TGlzdGVuZXJzLmxlbmd0aCkmJihfLmNhbGwodGhpcyksdGhpcy5tYW51YWxSb3dQb3NpdGlvbnMubGVuZ3RoPjAmJih0LmZvcmNlRnVsbFJlbmRlcj0hMCx0LnJlbmRlcigpKSl9ZWxzZXt2YXIgaT10Lm1hbnVhbFJvd1Bvc2l0aW9uc1BsdWdpblVzYWdlcz90Lm1hbnVhbFJvd1Bvc2l0aW9uc1BsdWdpblVzYWdlcy5pbmRleE9mKCJtYW51YWxDb2x1bW5Nb3ZlIik6LTE7aT4tMSYmKFMuY2FsbCh0aGlzKSx0Lm1hbnVhbFJvd1Bvc2l0aW9ucz1bXSx0Lm1hbnVhbFJvd1Bvc2l0aW9uc1BsdWdpblVzYWdlc1tpXT12b2lkIDApfX0sdGhpcy5tb2RpZnlSb3c9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcztyZXR1cm4gdC5nZXRTZXR0aW5ncygpLm1hbnVhbFJvd01vdmU/KCJ1bmRlZmluZWQiPT10eXBlb2YgdC5tYW51YWxSb3dQb3NpdGlvbnNbZV0mJkUodGhpcy5tYW51YWxSb3dQb3NpdGlvbnMsZSsxKSx0Lm1hbnVhbFJvd1Bvc2l0aW9uc1tlXSk6ZX19T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7TWFudWFsUm93TW92ZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgcixpLHMsYSxsPShyPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLHU9bC5hZGRDbGFzcyxjPWwuaGFzQ2xhc3MsZD1sLnJlbW92ZUNsYXNzLGg9KGk9ZSgiZXZlbnRNYW5hZ2VyIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5ldmVudE1hbmFnZXIsZj0ocz1lKCJoZWxwZXJzL2RvbS9ldmVudCIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkscD0oZi5wYWdlWCxmLnBhZ2VZKSxnPSgoYT1lKCJwbHVnaW5zIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5yZWdpc3RlclBsdWdpbixuZXcgbyk7SGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYmVmb3JlSW5pdCIsZy5iZWZvcmVJbml0KSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlckluaXQiLGZ1bmN0aW9uKCl7Zy5pbml0LmNhbGwodGhpcywiYWZ0ZXJJbml0Iil9KSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlclVwZGF0ZVNldHRpbmdzIixmdW5jdGlvbigpe2cuaW5pdC5jYWxsKHRoaXMsImFmdGVyVXBkYXRlU2V0dGluZ3MiKX0pLEhhbmRzb250YWJsZS5ob29rcy5hZGQoIm1vZGlmeVJvdyIsZy5tb2RpZnlSb3cpLEhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcigiYmVmb3JlUm93TW92ZSIpLEhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcigiYWZ0ZXJSb3dNb3ZlIil9LHtldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDYscGx1Z2luczo1N31dLDgwOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se01hbnVhbFJvd1Jlc2l6ZTp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHZ9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscyxhLGw9KG89ZSgiX2Jhc2UuanMiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pWyJkZWZhdWx0Il0sdT0ocj1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KSxjPXUuYWRkQ2xhc3MsZD11Lmhhc0NsYXNzLGg9dS5yZW1vdmVDbGFzcyxmPShpPWUoImV2ZW50TWFuYWdlciIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuZXZlbnRNYW5hZ2VyLHA9KHM9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLGc9KHAucGFnZVgscC5wYWdlWSksbT0oYT1lKCJwbHVnaW5zIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5yZWdpc3RlclBsdWdpbix2PWZ1bmN0aW9uKGUpeyR0cmFjZXVyUnVudGltZS5zdXBlckNvbnN0cnVjdG9yKHcpLmNhbGwodGhpcyxlKSx0aGlzLmN1cnJlbnRUSD1udWxsLHRoaXMuY3VycmVudFJvdz1udWxsLHRoaXMuY3VycmVudEhlaWdodD1udWxsLHRoaXMubmV3U2l6ZT1udWxsLHRoaXMuc3RhcnRZPW51bGwsdGhpcy5zdGFydEhlaWdodD1udWxsLHRoaXMuc3RhcnRPZmZzZXQ9bnVsbCx0aGlzLmhhbmRsZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJESVYiKSx0aGlzLmd1aWRlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoIkRJViIpLHRoaXMuZXZlbnRNYW5hZ2VyPWYodGhpcyksdGhpcy5wcmVzc2VkPW51bGwsdGhpcy5kYmxjbGljaz0wLHRoaXMuYXV0b3Jlc2l6ZVRpbWVvdXQ9bnVsbCx0aGlzLm1hbnVhbFJvd0hlaWdodHM9W10sYyh0aGlzLmhhbmRsZSwibWFudWFsUm93UmVzaXplciIpLGModGhpcy5ndWlkZSwibWFudWFsUm93UmVzaXplckd1aWRlIil9LHc9djskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3Modix7aXNFbmFibGVkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaG90LmdldFNldHRpbmdzKCkubWFudWFsUm93UmVzaXplfSxlbmFibGVQbHVnaW46ZnVuY3Rpb24oKXt2YXIgZT10aGlzO2lmKCF0aGlzLmVuYWJsZWQpe3RoaXMubWFudWFsUm93SGVpZ2h0cz1bXTt2YXIgdD10aGlzLmhvdC5nZXRTZXR0aW5ncygpLm1hbnVhbFJvd1Jlc2l6ZSxuPXRoaXMubG9hZE1hbnVhbFJvd0hlaWdodHMoKTsidW5kZWZpbmVkIiE9dHlwZW9mIG4/dGhpcy5tYW51YWxSb3dIZWlnaHRzPW46QXJyYXkuaXNBcnJheSh0KT90aGlzLm1hbnVhbFJvd0hlaWdodHM9dDp0aGlzLm1hbnVhbFJvd0hlaWdodHM9W10sdGhpcy5hZGRIb29rKCJtb2RpZnlSb3dIZWlnaHQiLGZ1bmN0aW9uKHQsbil7cmV0dXJuIGUub25Nb2RpZnlSb3dIZWlnaHQodCxuKX0pLEhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcigiYmVmb3JlUm93UmVzaXplIiksSGFuZHNvbnRhYmxlLmhvb2tzLnJlZ2lzdGVyKCJhZnRlclJvd1Jlc2l6ZSIpLHRoaXMuYmluZEV2ZW50cygpLCR0cmFjZXVyUnVudGltZS5zdXBlckdldCh0aGlzLHcucHJvdG90eXBlLCJlbmFibGVQbHVnaW4iKS5jYWxsKHRoaXMpfX0sdXBkYXRlUGx1Z2luOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5ob3QuZ2V0U2V0dGluZ3MoKS5tYW51YWxSb3dSZXNpemU7QXJyYXkuaXNBcnJheShlKT90aGlzLm1hbnVhbFJvd0hlaWdodHM9ZTp0aGlzLm1hbnVhbFJvd0hlaWdodHM9W119LGRpc2FibGVQbHVnaW46ZnVuY3Rpb24oKXskdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyx3LnByb3RvdHlwZSwiZGlzYWJsZVBsdWdpbiIpLmNhbGwodGhpcyl9LHNhdmVNYW51YWxSb3dIZWlnaHRzOmZ1bmN0aW9uKCl7dGhpcy5ob3QucnVuSG9va3MoInBlcnNpc3RlbnRTdGF0ZVNhdmUiLCJtYW51YWxSb3dIZWlnaHRzIix0aGlzLm1hbnVhbFJvd0hlaWdodHMpfSxsb2FkTWFudWFsUm93SGVpZ2h0czpmdW5jdGlvbigpe3ZhciBlPXt9O3JldHVybiB0aGlzLmhvdC5ydW5Ib29rcygicGVyc2lzdGVudFN0YXRlTG9hZCIsIm1hbnVhbFJvd0hlaWdodHMiLGUpLGUudmFsdWV9LHNldHVwSGFuZGxlUG9zaXRpb246ZnVuY3Rpb24oZSl7dGhpcy5jdXJyZW50VEg9ZTt2YXIgdD10aGlzLmhvdC52aWV3Lnd0Lnd0VGFibGUuZ2V0Q29vcmRzKGUpLnJvdztpZih0Pj0wKXt2YXIgbj10aGlzLmN1cnJlbnRUSC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTt0aGlzLmN1cnJlbnRSb3c9dCx0aGlzLnN0YXJ0T2Zmc2V0PW4udG9wLTYsdGhpcy5zdGFydEhlaWdodD1wYXJzZUludChuLmhlaWdodCwxMCksdGhpcy5oYW5kbGUuc3R5bGUubGVmdD1uLmxlZnQrInB4Iix0aGlzLmhhbmRsZS5zdHlsZS50b3A9dGhpcy5zdGFydE9mZnNldCt0aGlzLnN0YXJ0SGVpZ2h0KyJweCIsdGhpcy5ob3Qucm9vdEVsZW1lbnQuYXBwZW5kQ2hpbGQodGhpcy5oYW5kbGUpfX0scmVmcmVzaEhhbmRsZVBvc2l0aW9uOmZ1bmN0aW9uKCl7dGhpcy5oYW5kbGUuc3R5bGUudG9wPXRoaXMuc3RhcnRPZmZzZXQrdGhpcy5jdXJyZW50SGVpZ2h0KyJweCJ9LHNldHVwR3VpZGVQb3NpdGlvbjpmdW5jdGlvbigpe2ModGhpcy5oYW5kbGUsImFjdGl2ZSIpLGModGhpcy5ndWlkZSwiYWN0aXZlIiksdGhpcy5ndWlkZS5zdHlsZS50b3A9dGhpcy5oYW5kbGUuc3R5bGUudG9wLHRoaXMuZ3VpZGUuc3R5bGUubGVmdD10aGlzLmhhbmRsZS5zdHlsZS5sZWZ0LHRoaXMuZ3VpZGUuc3R5bGUud2lkdGg9dGhpcy5ob3Qudmlldy5tYXhpbXVtVmlzaWJsZUVsZW1lbnRXaWR0aCgwKSsicHgiLHRoaXMuaG90LnJvb3RFbGVtZW50LmFwcGVuZENoaWxkKHRoaXMuZ3VpZGUpfSxyZWZyZXNoR3VpZGVQb3NpdGlvbjpmdW5jdGlvbigpe3RoaXMuZ3VpZGUuc3R5bGUudG9wPXRoaXMuaGFuZGxlLnN0eWxlLnRvcH0saGlkZUhhbmRsZUFuZEd1aWRlOmZ1bmN0aW9uKCl7aCh0aGlzLmhhbmRsZSwiYWN0aXZlIiksaCh0aGlzLmd1aWRlLCJhY3RpdmUiKX0sY2hlY2tJZlJvd0hlYWRlcjpmdW5jdGlvbihlKXtyZXR1cm4iQk9EWSIhPWUudGFnTmFtZT8iVEJPRFkiPT1lLnBhcmVudE5vZGUudGFnTmFtZT8hMDooZT1lLnBhcmVudE5vZGUsdGhpcy5jaGVja0lmUm93SGVhZGVyKGUpKTohMX0sZ2V0VEhGcm9tVGFyZ2V0RWxlbWVudDpmdW5jdGlvbihlKXtyZXR1cm4iVEFCTEUiIT1lLnRhZ05hbWU/IlRIIj09ZS50YWdOYW1lP2U6dGhpcy5nZXRUSEZyb21UYXJnZXRFbGVtZW50KGUucGFyZW50Tm9kZSk6bnVsbH0sb25Nb3VzZU92ZXI6ZnVuY3Rpb24oZSl7aWYodGhpcy5jaGVja0lmUm93SGVhZGVyKGUudGFyZ2V0KSl7dmFyIHQ9dGhpcy5nZXRUSEZyb21UYXJnZXRFbGVtZW50KGUudGFyZ2V0KTt0JiYodGhpcy5wcmVzc2VkfHx0aGlzLnNldHVwSGFuZGxlUG9zaXRpb24odCkpfX0sYWZ0ZXJNb3VzZURvd25UaW1lb3V0OmZ1bmN0aW9uKCl7aWYodGhpcy5kYmxjbGljaz49Mil7dmFyIGU9dGhpcy5ob3QucnVuSG9va3MoImJlZm9yZVJvd1Jlc2l6ZSIsdGhpcy5jdXJyZW50Um93LHRoaXMubmV3U2l6ZSwhMCk7dm9pZCAwIT09ZSYmKHRoaXMubmV3U2l6ZT1lKSx0aGlzLnNldE1hbnVhbFNpemUodGhpcy5jdXJyZW50Um93LHRoaXMubmV3U2l6ZSksdGhpcy5ob3QuZm9yY2VGdWxsUmVuZGVyPSEwLHRoaXMuaG90LnZpZXcucmVuZGVyKCksdGhpcy5ob3Qudmlldy53dC53dE92ZXJsYXlzLmFkanVzdEVsZW1lbnRzU2l6ZSghMCksdGhpcy5ob3QucnVuSG9va3MoImFmdGVyUm93UmVzaXplIix0aGlzLmN1cnJlbnRSb3csdGhpcy5uZXdTaXplLCEwKX10aGlzLmRibGNsaWNrPTAsdGhpcy5hdXRvcmVzaXplVGltZW91dD1udWxsfSxvbk1vdXNlRG93bjpmdW5jdGlvbihlKXt2YXIgdD10aGlzO2QoZS50YXJnZXQsIm1hbnVhbFJvd1Jlc2l6ZXIiKSYmKHRoaXMuc2V0dXBHdWlkZVBvc2l0aW9uKCksdGhpcy5wcmVzc2VkPXRoaXMuaG90LG51bGw9PXRoaXMuYXV0b3Jlc2l6ZVRpbWVvdXQmJih0aGlzLmF1dG9yZXNpemVUaW1lb3V0PXNldFRpbWVvdXQoZnVuY3Rpb24oKXtyZXR1cm4gdC5hZnRlck1vdXNlRG93blRpbWVvdXQoKX0sNTAwKSx0aGlzLmhvdC5fcmVnaXN0ZXJUaW1lb3V0KHRoaXMuYXV0b3Jlc2l6ZVRpbWVvdXQpKSx0aGlzLmRibGNsaWNrKyssdGhpcy5zdGFydFk9ZyhlKSx0aGlzLm5ld1NpemU9dGhpcy5zdGFydEhlaWdodCl9LG9uTW91c2VNb3ZlOmZ1bmN0aW9uKGUpe3RoaXMucHJlc3NlZCYmKHRoaXMuY3VycmVudEhlaWdodD10aGlzLnN0YXJ0SGVpZ2h0KyhnKGUpLXRoaXMuc3RhcnRZKSx0aGlzLm5ld1NpemU9dGhpcy5zZXRNYW51YWxTaXplKHRoaXMuY3VycmVudFJvdyx0aGlzLmN1cnJlbnRIZWlnaHQpLHRoaXMucmVmcmVzaEhhbmRsZVBvc2l0aW9uKCksdGhpcy5yZWZyZXNoR3VpZGVQb3NpdGlvbigpKX0sb25Nb3VzZVVwOmZ1bmN0aW9uKGUpe3RoaXMucHJlc3NlZCYmKHRoaXMuaGlkZUhhbmRsZUFuZEd1aWRlKCksdGhpcy5wcmVzc2VkPSExLHRoaXMubmV3U2l6ZSE9dGhpcy5zdGFydEhlaWdodCYmKHRoaXMuaG90LnJ1bkhvb2tzKCJiZWZvcmVSb3dSZXNpemUiLHRoaXMuY3VycmVudFJvdyx0aGlzLm5ld1NpemUpLHRoaXMuaG90LmZvcmNlRnVsbFJlbmRlcj0hMCx0aGlzLmhvdC52aWV3LnJlbmRlcigpLHRoaXMuaG90LnZpZXcud3Qud3RPdmVybGF5cy5hZGp1c3RFbGVtZW50c1NpemUoITApLHRoaXMuc2F2ZU1hbnVhbFJvd0hlaWdodHMoKSx0aGlzLmhvdC5ydW5Ib29rcygiYWZ0ZXJSb3dSZXNpemUiLHRoaXMuY3VycmVudFJvdyx0aGlzLm5ld1NpemUpKSx0aGlzLnNldHVwSGFuZGxlUG9zaXRpb24odGhpcy5jdXJyZW50VEgpKX0sYmluZEV2ZW50czpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmhvdC5yb290RWxlbWVudCwibW91c2VvdmVyIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbk1vdXNlT3Zlcih0KX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ob3Qucm9vdEVsZW1lbnQsIm1vdXNlZG93biIsZnVuY3Rpb24odCl7cmV0dXJuIGUub25Nb3VzZURvd24odCl9KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHdpbmRvdywibW91c2Vtb3ZlIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbk1vdXNlTW92ZSh0KX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIod2luZG93LCJtb3VzZXVwIixmdW5jdGlvbih0KXtyZXR1cm4gZS5vbk1vdXNlVXAodCl9KX0sc2V0TWFudWFsU2l6ZTpmdW5jdGlvbihlLHQpe3JldHVybiBlPXRoaXMuaG90LnJ1bkhvb2tzKCJtb2RpZnlSb3ciLGUpLHRoaXMubWFudWFsUm93SGVpZ2h0c1tlXT10LHR9LG9uTW9kaWZ5Um93SGVpZ2h0OmZ1bmN0aW9uKGUsdCl7aWYodGhpcy5lbmFibGVkKXt2YXIgbj10aGlzLmhvdC5nZXRQbHVnaW4oImF1dG9Sb3dTaXplIiksbz1uP24uaGVpZ2h0c1t0XTpudWxsO3Q9dGhpcy5ob3QucnVuSG9va3MoIm1vZGlmeVJvdyIsdCk7dmFyIHI9dGhpcy5tYW51YWxSb3dIZWlnaHRzW3RdO2lmKHZvaWQgMCE9PXImJihyPT09b3x8cj4oZXx8MCkpKXJldHVybiByfXJldHVybiBlfX0se30sbCksbSgibWFudWFsUm93UmVzaXplIix2KX0seyJfYmFzZS5qcyI6NTgsZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSwiaGVscGVycy9kb20vZXZlbnQiOjQ2LHBsdWdpbnM6NTd9XSw4MTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKCl7dmFyIGU9W107cmV0dXJuIGUuZ2V0SW5mbz1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbj0wLG89dGhpcy5sZW5ndGg7bz5uO24rKylpZih0aGlzW25dLnJvdzw9ZSYmdGhpc1tuXS5yb3crdGhpc1tuXS5yb3dzcGFuLTE+PWUmJnRoaXNbbl0uY29sPD10JiZ0aGlzW25dLmNvbCt0aGlzW25dLmNvbHNwYW4tMT49dClyZXR1cm4gdGhpc1tuXX0sZS5zZXRJbmZvPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0wLG49dGhpcy5sZW5ndGg7bj50O3QrKylpZih0aGlzW3RdLnJvdz09PWUucm93JiZ0aGlzW3RdLmNvbD09PWUuY29sKXJldHVybiB2b2lkKHRoaXNbdF09ZSk7dGhpcy5wdXNoKGUpfSxlLnJlbW92ZUluZm89ZnVuY3Rpb24oZSx0KXtmb3IodmFyIG49MCxvPXRoaXMubGVuZ3RoO28+bjtuKyspaWYodGhpc1tuXS5yb3c9PT1lJiZ0aGlzW25dLmNvbD09PXQpe3RoaXMuc3BsaWNlKG4sMSk7YnJlYWt9fSxlfWZ1bmN0aW9uIHIoZSl7aWYodGhpcy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb249bmV3IG8sQXJyYXkuaXNBcnJheShlKSlmb3IodmFyIHQ9MCxuPWUubGVuZ3RoO24+dDt0KyspdGhpcy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb24uc2V0SW5mbyhlW3RdKX1mdW5jdGlvbiBpKGUsdCl7dmFyIG49dGhpcy5nZXRTZXR0aW5ncygpLm1lcmdlQ2VsbHM7aWYobiYmIXRoaXMuc2VsZWN0aW9uLmlzTXVsdGlwbGUoKSl7dmFyIG89dGhpcy5tZXJnZUNlbGxzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5nZXRJbmZvKGVbMF0sZVsxXSk7byYmKGVbMF09by5yb3csZVsxXT1vLmNvbCxlWzJdPW8ucm93K28ucm93c3Bhbi0xLGVbM109by5jb2wrby5jb2xzcGFuLTEpfX1mdW5jdGlvbiBzKGUsdCl7dGhpcy5tZXJnZUNlbGxzJiZ0aGlzLm1lcmdlQ2VsbHMuc2hpZnRDb2xsZWN0aW9uKCJyaWdodCIsZSx0KX1mdW5jdGlvbiBhKGUsdCl7dGhpcy5tZXJnZUNlbGxzJiZ0aGlzLm1lcmdlQ2VsbHMuc2hpZnRDb2xsZWN0aW9uKCJsZWZ0IixlLHQpfWZ1bmN0aW9uIGwoZSx0KXt0aGlzLm1lcmdlQ2VsbHMmJnRoaXMubWVyZ2VDZWxscy5zaGlmdENvbGxlY3Rpb24oImRvd24iLGUsdCl9ZnVuY3Rpb24gdShlLHQpe3RoaXMubWVyZ2VDZWxscyYmdGhpcy5tZXJnZUNlbGxzLnNoaWZ0Q29sbGVjdGlvbigidXAiLGUsdCl9T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7TWVyZ2VDZWxsczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHJ9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgYyxkLGgsZixwLGc9KChjPWUoInBsdWdpbnMiKSxjJiZjLl9fZXNNb2R1bGUmJmN8fHsiZGVmYXVsdCI6Y30pLnJlZ2lzdGVyUGx1Z2luLChkPWUoImhlbHBlcnMvZG9tL2V2ZW50IiksZCYmZC5fX2VzTW9kdWxlJiZkfHx7ImRlZmF1bHQiOmR9KS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24pLG09KGg9ZSgiM3JkcGFydHkvd2Fsa29udGFibGUvc3JjL2NlbGwvY29vcmRzIiksaCYmaC5fX2VzTW9kdWxlJiZofHx7ImRlZmF1bHQiOmh9KS5XYWxrb250YWJsZUNlbGxDb29yZHMsdj0oZj1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9yYW5nZSIpLGYmJmYuX19lc01vZHVsZSYmZnx8eyJkZWZhdWx0IjpmfSkuV2Fsa29udGFibGVDZWxsUmFuZ2Usdz0ocD1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvdGFibGUiKSxwJiZwLl9fZXNNb2R1bGUmJnB8fHsiZGVmYXVsdCI6cH0pLldhbGtvbnRhYmxlVGFibGU7ci5wcm90b3R5cGUuY2FuTWVyZ2VSYW5nZT1mdW5jdGlvbihlKXtyZXR1cm4hZS5pc1NpbmdsZSgpfSxyLnByb3RvdHlwZS5tZXJnZVJhbmdlPWZ1bmN0aW9uKGUpe2lmKHRoaXMuY2FuTWVyZ2VSYW5nZShlKSl7dmFyIHQ9ZS5nZXRUb3BMZWZ0Q29ybmVyKCksbj1lLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCksbz17fTtvLnJvdz10LnJvdyxvLmNvbD10LmNvbCxvLnJvd3NwYW49bi5yb3ctdC5yb3crMSxvLmNvbHNwYW49bi5jb2wtdC5jb2wrMSx0aGlzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5zZXRJbmZvKG8pfX0sci5wcm90b3R5cGUubWVyZ2VPclVubWVyZ2VTZWxlY3Rpb249ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb24uZ2V0SW5mbyhlLmZyb20ucm93LGUuZnJvbS5jb2wpO3Q/dGhpcy51bm1lcmdlU2VsZWN0aW9uKGUuZnJvbSk6dGhpcy5tZXJnZVNlbGVjdGlvbihlKX0sci5wcm90b3R5cGUubWVyZ2VTZWxlY3Rpb249ZnVuY3Rpb24oZSl7dGhpcy5tZXJnZVJhbmdlKGUpfSxyLnByb3RvdHlwZS51bm1lcmdlU2VsZWN0aW9uPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uLmdldEluZm8oZS5yb3csZS5jb2wpO3RoaXMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uLnJlbW92ZUluZm8odC5yb3csdC5jb2wpfSxyLnByb3RvdHlwZS5hcHBseVNwYW5Qcm9wZXJ0aWVzPWZ1bmN0aW9uKGUsdCxuKXt2YXIgbz10aGlzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5nZXRJbmZvKHQsbik7bz9vLnJvdz09PXQmJm8uY29sPT09bj8oZS5zZXRBdHRyaWJ1dGUoInJvd3NwYW4iLG8ucm93c3BhbiksZS5zZXRBdHRyaWJ1dGUoImNvbHNwYW4iLG8uY29sc3BhbikpOihlLnJlbW92ZUF0dHJpYnV0ZSgicm93c3BhbiIpLGUucmVtb3ZlQXR0cmlidXRlKCJjb2xzcGFuIiksZS5zdHlsZS5kaXNwbGF5PSJub25lIik6KGUucmVtb3ZlQXR0cmlidXRlKCJyb3dzcGFuIiksZS5yZW1vdmVBdHRyaWJ1dGUoImNvbHNwYW4iKSl9LHIucHJvdG90eXBlLm1vZGlmeVRyYW5zZm9ybT1mdW5jdGlvbihlLHQsbil7dmFyIG89ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdC5yb3c+PWUucm93JiZ0LnJvdzw9ZS5yb3crZS5yb3dzcGFuLTE/ITA6ITF9LHI9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdC5jb2w+PWUuY29sJiZ0LmNvbDw9ZS5jb2wrZS5jb2xzcGFuLTE/ITA6ITF9LGk9ZnVuY3Rpb24oZSl7cmV0dXJuIG5ldyBtKHQudG8ucm93K2Uucm93LHQudG8uY29sK2UuY29sKX0scz17cm93Om4ucm93LGNvbDpuLmNvbH07aWYoIm1vZGlmeVRyYW5zZm9ybVN0YXJ0Ij09ZSl7dGhpcy5sYXN0RGVzaXJlZENvb3Jkc3x8KHRoaXMubGFzdERlc2lyZWRDb29yZHM9bmV3IG0obnVsbCxudWxsKSk7Zm9yKHZhciBhLGw9bmV3IG0odC5oaWdobGlnaHQucm93LHQuaGlnaGxpZ2h0LmNvbCksdT10aGlzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5nZXRJbmZvKGwucm93LGwuY29sKSxjPTAsZD10aGlzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5sZW5ndGg7ZD5jO2MrKyl7dmFyIGg9dGhpcy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb25bY107aWYoaD1uZXcgbShoLnJvdytoLnJvd3NwYW4tMSxoLmNvbCtoLmNvbHNwYW4tMSksdC5pbmNsdWRlcyhoKSl7YT0hMDticmVha319aWYodSl7dmFyIGY9bmV3IG0odS5yb3csdS5jb2wpLHA9bmV3IG0odS5yb3crdS5yb3dzcGFuLTEsdS5jb2wrdS5jb2xzcGFuLTEpLGc9bmV3IHYoZixmLHApO2cuaW5jbHVkZXModGhpcy5sYXN0RGVzaXJlZENvb3Jkcyl8fCh0aGlzLmxhc3REZXNpcmVkQ29vcmRzPW5ldyBtKG51bGwsbnVsbCkpLHMucm93PXRoaXMubGFzdERlc2lyZWRDb29yZHMucm93P3RoaXMubGFzdERlc2lyZWRDb29yZHMucm93LWwucm93OnMucm93LHMuY29sPXRoaXMubGFzdERlc2lyZWRDb29yZHMuY29sP3RoaXMubGFzdERlc2lyZWRDb29yZHMuY29sLWwuY29sOnMuY29sLG4ucm93PjA/cy5yb3c9dS5yb3crdS5yb3dzcGFuLTEtbC5yb3crbi5yb3c6bi5yb3c8MCYmKHMucm93PWwucm93LXUucm93K24ucm93KSxuLmNvbD4wP3MuY29sPXUuY29sK3UuY29sc3Bhbi0xLWwuY29sK24uY29sOm4uY29sPDAmJihzLmNvbD1sLmNvbC11LmNvbCtuLmNvbCl9dmFyIHc9bmV3IG0odC5oaWdobGlnaHQucm93K3Mucm93LHQuaGlnaGxpZ2h0LmNvbCtzLmNvbCkseT10aGlzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5nZXRJbmZvKHcucm93LHcuY29sKTt5JiYodGhpcy5sYXN0RGVzaXJlZENvb3Jkcz13LHM9e3Jvdzp5LnJvdy1sLnJvdyxjb2w6eS5jb2wtbC5jb2x9KX1lbHNlIGlmKCJtb2RpZnlUcmFuc2Zvcm1FbmQiPT1lKWZvcih2YXIgYz0wLGQ9dGhpcy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb24ubGVuZ3RoO2Q+YztjKyspe3ZhciBiPXRoaXMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uW2NdLGY9bmV3IG0oYi5yb3csYi5jb2wpLHA9bmV3IG0oYi5yb3crYi5yb3dzcGFuLTEsYi5jb2wrYi5jb2xzcGFuLTEpLEM9bmV3IHYoZixmLHApLFI9dC5nZXRCb3JkZXJzU2hhcmVkV2l0aChDKTtpZihDLmlzRXF1YWwodCkpdC5zZXREaXJlY3Rpb24oIk5XLVNFIik7ZWxzZSBpZihSLmxlbmd0aD4wKXt2YXIgXz10LmhpZ2hsaWdodC5pc0VxdWFsKEMuZnJvbSk7Ui5pbmRleE9mKCJ0b3AiKT4tMT90LnRvLmlzU291dGhFYXN0T2YoQy5mcm9tKSYmXz90LnNldERpcmVjdGlvbigiTlctU0UiKTp0LnRvLmlzU291dGhXZXN0T2YoQy5mcm9tKSYmXyYmdC5zZXREaXJlY3Rpb24oIk5FLVNXIik6Ui5pbmRleE9mKCJib3R0b20iKT4tMSYmKHQudG8uaXNOb3J0aEVhc3RPZihDLmZyb20pJiZfP3Quc2V0RGlyZWN0aW9uKCJTVy1ORSIpOnQudG8uaXNOb3J0aFdlc3RPZihDLmZyb20pJiZfJiZ0LnNldERpcmVjdGlvbigiU0UtTlciKSl9dmFyIHc9aShzKSxTPW8oYix3KSxFPXIoYix3KTt0LmluY2x1ZGVzUmFuZ2UoQykmJihDLmluY2x1ZGVzKHcpfHxTfHxFKSYmKFMmJihzLnJvdzwwP3Mucm93LT1iLnJvd3NwYW4tMTpzLnJvdz4wJiYocy5yb3crPWIucm93c3Bhbi0xKSksRSYmKHMuY29sPDA/cy5jb2wtPWIuY29sc3Bhbi0xOnMuY29sPjAmJihzLmNvbCs9Yi5jb2xzcGFuLTEpKSl9MCE9PXMucm93JiYobi5yb3c9cy5yb3cpLDAhPT1zLmNvbCYmKG4uY29sPXMuY29sKX0sci5wcm90b3R5cGUuc2hpZnRDb2xsZWN0aW9uPWZ1bmN0aW9uKGUsdCxuKXt2YXIgbz1bMCwwXTtzd2l0Y2goZSl7Y2FzZSJyaWdodCI6b1swXSs9MTticmVhaztjYXNlImxlZnQiOm9bMF0tPTE7YnJlYWs7Y2FzZSJkb3duIjpvWzFdKz0xO2JyZWFrO2Nhc2UidXAiOm9bMV0tPTF9Zm9yKHZhciByPTA7cjx0aGlzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5sZW5ndGg7cisrKXt2YXIgaT10aGlzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbltyXTsicmlnaHQiPT09ZXx8ImxlZnQiPT09ZT90PD1pLmNvbCYmKGkuY29sKz1vWzBdKTp0PD1pLnJvdyYmKGkucm93Kz1vWzFdKX19O3ZhciB5PWZ1bmN0aW9uKCl7dmFyIGU9dGhpcyx0PWUuZ2V0U2V0dGluZ3MoKS5tZXJnZUNlbGxzO3QmJihlLm1lcmdlQ2VsbHN8fChlLm1lcmdlQ2VsbHM9bmV3IHIodCkpKX0sYj1mdW5jdGlvbigpe3ZhciBlPXRoaXM7ZS5tZXJnZUNlbGxzJiYoZS52aWV3Lnd0Lnd0VGFibGUuZ2V0Q2VsbD1mdW5jdGlvbih0KXtpZihlLmdldFNldHRpbmdzKCkubWVyZ2VDZWxscyl7dmFyIG49ZS5tZXJnZUNlbGxzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5nZXRJbmZvKHQucm93LHQuY29sKTtuJiYodD1uKX1yZXR1cm4gdy5wcm90b3R5cGUuZ2V0Q2VsbC5jYWxsKHRoaXMsdCl9KX0sQz1mdW5jdGlvbigpe3ZhciBlPXRoaXMsdD1lLmdldFNldHRpbmdzKCkubWVyZ2VDZWxscztpZih0KWlmKGUubWVyZ2VDZWxscyl7aWYoZS5tZXJnZUNlbGxzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbj1uZXcgbyxBcnJheS5pc0FycmF5KHQpKWZvcih2YXIgbj0wLGk9dC5sZW5ndGg7aT5uO24rKyllLm1lcmdlQ2VsbHMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uLnNldEluZm8odFtuXSl9ZWxzZSBlLm1lcmdlQ2VsbHM9bmV3IHIodCk7ZWxzZSBlLm1lcmdlQ2VsbHMmJihlLm1lcmdlQ2VsbHMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uPW5ldyBvKX0sUj1mdW5jdGlvbihlKXtpZih0aGlzLm1lcmdlQ2VsbHMpe3ZhciB0PShlLmN0cmxLZXl8fGUubWV0YUtleSkmJiFlLmFsdEtleTt0JiY3Nz09PWUua2V5Q29kZSYmKHRoaXMubWVyZ2VDZWxscy5tZXJnZU9yVW5tZXJnZVNlbGVjdGlvbih0aGlzLmdldFNlbGVjdGVkUmFuZ2UoKSksdGhpcy5yZW5kZXIoKSwKZyhlKSl9fSxfPWZ1bmN0aW9uKGUpe3RoaXMuZ2V0U2V0dGluZ3MoKS5tZXJnZUNlbGxzJiYoZS5pdGVtcy5wdXNoKEhhbmRzb250YWJsZS5wbHVnaW5zLkNvbnRleHRNZW51LlNFUEFSQVRPUiksZS5pdGVtcy5wdXNoKHtrZXk6Im1lcmdlQ2VsbHMiLG5hbWU6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLmdldFNlbGVjdGVkKCksdD10aGlzLm1lcmdlQ2VsbHMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uLmdldEluZm8oZVswXSxlWzFdKTtyZXR1cm4gdD8iVW5tZXJnZSBjZWxscyI6Ik1lcmdlIGNlbGxzIn0sY2FsbGJhY2s6ZnVuY3Rpb24oKXt0aGlzLm1lcmdlQ2VsbHMubWVyZ2VPclVubWVyZ2VTZWxlY3Rpb24odGhpcy5nZXRTZWxlY3RlZFJhbmdlKCkpLHRoaXMucmVuZGVyKCl9LGRpc2FibGVkOmZ1bmN0aW9uKCl7cmV0dXJuITF9fSkpfSxTPWZ1bmN0aW9uKGUsdCxuLG8scixpKXt0aGlzLm1lcmdlQ2VsbHMmJnRoaXMubWVyZ2VDZWxscy5hcHBseVNwYW5Qcm9wZXJ0aWVzKGUsdCxuKX0sRT1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7dmFyIG49dGhpcy5nZXRTZXR0aW5ncygpLm1lcmdlQ2VsbHM7aWYobil7dmFyIG89dGhpcy5nZXRTZWxlY3RlZFJhbmdlKCk7aWYodGhpcy5tZXJnZUNlbGxzLm1vZGlmeVRyYW5zZm9ybShlLG8sdCksIm1vZGlmeVRyYW5zZm9ybUVuZCI9PT1lKXt2YXIgcj10aGlzLmNvdW50Um93cygpLGk9dGhpcy5jb3VudENvbHMoKTtvLmZyb20ucm93PDA/by5mcm9tLnJvdz0wOm8uZnJvbS5yb3c+MCYmby5mcm9tLnJvdz49ciYmKG8uZnJvbS5yb3c9by5mcm9tLTEpLG8uZnJvbS5jb2w8MD9vLmZyb20uY29sPTA6by5mcm9tLmNvbD4wJiZvLmZyb20uY29sPj1pJiYoby5mcm9tLmNvbD1pLTEpfX19fSxUPWZ1bmN0aW9uKGUpe3RoaXMubGFzdERlc2lyZWRDb29yZHM9bnVsbDt2YXIgdD10aGlzLmdldFNldHRpbmdzKCkubWVyZ2VDZWxscztpZih0KXt2YXIgbj10aGlzLmdldFNlbGVjdGVkUmFuZ2UoKTtuLmhpZ2hsaWdodD1uZXcgbShuLmhpZ2hsaWdodC5yb3csbi5oaWdobGlnaHQuY29sKSxuLnRvPWU7dmFyIG89ITE7ZG97bz0hMTtmb3IodmFyIHI9MCxpPXRoaXMubWVyZ2VDZWxscy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb24ubGVuZ3RoO2k+cjtyKyspe3ZhciBzPXRoaXMubWVyZ2VDZWxscy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb25bcl0sYT1uZXcgbShzLnJvdyxzLmNvbCksbD1uZXcgbShzLnJvdytzLnJvd3NwYW4tMSxzLmNvbCtzLmNvbHNwYW4tMSksdT1uZXcgdihhLGEsbCk7bi5leHBhbmRCeVJhbmdlKHUpJiYoZS5yb3c9bi50by5yb3csZS5jb2w9bi50by5jb2wsbz0hMCl9fXdoaWxlKG8pfX0sTz1mdW5jdGlvbihlLHQpe2lmKHQmJiJhcmVhIj09dCl7dmFyIG49dGhpcy5nZXRTZXR0aW5ncygpLm1lcmdlQ2VsbHM7aWYobilmb3IodmFyIG89dGhpcy5nZXRTZWxlY3RlZFJhbmdlKCkscj1uZXcgdihvLmZyb20sby5mcm9tLG8uZnJvbSksaT1uZXcgdihvLnRvLG8udG8sby50bykscz0wLGE9dGhpcy5tZXJnZUNlbGxzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5sZW5ndGg7YT5zO3MrKyl7dmFyIGw9dGhpcy5tZXJnZUNlbGxzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbltzXSx1PW5ldyBtKGwucm93LGwuY29sKSxjPW5ldyBtKGwucm93K2wucm93c3Bhbi0xLGwuY29sK2wuY29sc3Bhbi0xKSxkPW5ldyB2KHUsdSxjKTtyLmV4cGFuZEJ5UmFuZ2UoZCkmJihlWzBdPXIuZnJvbS5yb3csZVsxXT1yLmZyb20uY29sKSxpLmV4cGFuZEJ5UmFuZ2UoZCkmJihlWzJdPWkuZnJvbS5yb3csZVszXT1pLmZyb20uY29sKX19fSxNPWZ1bmN0aW9uKGUsdCxuKXt2YXIgbz10aGlzLmdldFNldHRpbmdzKCkubWVyZ2VDZWxscztpZihvKXt2YXIgcj10aGlzLm1lcmdlQ2VsbHMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uLmdldEluZm8oZSx0KTshcnx8ci5yb3c9PWUmJnIuY29sPT10fHwobi5jb3B5YWJsZT0hMSl9fSxrPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuZ2V0U2V0dGluZ3MoKS5tZXJnZUNlbGxzO2lmKHQpZm9yKHZhciBuLG89dGhpcy5jb3VudENvbHMoKSxyPTA7bz5yO3IrKyl7aWYobj10aGlzLm1lcmdlQ2VsbHMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uLmdldEluZm8oZS5zdGFydFJvdyxyKSxuJiZuLnJvdzxlLnN0YXJ0Um93KXJldHVybiBlLnN0YXJ0Um93PW4ucm93LGsuY2FsbCh0aGlzLGUpO2lmKG49dGhpcy5tZXJnZUNlbGxzLm1lcmdlZENlbGxJbmZvQ29sbGVjdGlvbi5nZXRJbmZvKGUuZW5kUm93LHIpKXt2YXIgaT1uLnJvdytuLnJvd3NwYW4tMTtpZihpPmUuZW5kUm93KXJldHVybiBlLmVuZFJvdz1pLGsuY2FsbCh0aGlzLGUpfX19LEg9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy5nZXRTZXR0aW5ncygpLm1lcmdlQ2VsbHM7aWYodClmb3IodmFyIG4sbz10aGlzLmNvdW50Um93cygpLHI9MDtvPnI7cisrKXtpZihuPXRoaXMubWVyZ2VDZWxscy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb24uZ2V0SW5mbyhyLGUuc3RhcnRDb2x1bW4pLG4mJm4uY29sPGUuc3RhcnRDb2x1bW4pcmV0dXJuIGUuc3RhcnRDb2x1bW49bi5jb2wsSC5jYWxsKHRoaXMsZSk7aWYobj10aGlzLm1lcmdlQ2VsbHMubWVyZ2VkQ2VsbEluZm9Db2xsZWN0aW9uLmdldEluZm8ocixlLmVuZENvbHVtbikpe3ZhciBpPW4uY29sK24uY29sc3Bhbi0xO2lmKGk+ZS5lbmRDb2x1bW4pcmV0dXJuIGUuZW5kQ29sdW1uPWksSC5jYWxsKHRoaXMsZSl9fX0sRD1mdW5jdGlvbihlKXtpZihlJiZ0aGlzLm1lcmdlQ2VsbHMpe3ZhciB0PXRoaXMubWVyZ2VDZWxscy5tZXJnZWRDZWxsSW5mb0NvbGxlY3Rpb24sbj10aGlzLmdldFNlbGVjdGVkUmFuZ2UoKTtmb3IodmFyIG8gaW4gdClpZihuLmhpZ2hsaWdodC5yb3c9PXRbb10ucm93JiZuLmhpZ2hsaWdodC5jb2w9PXRbb10uY29sJiZuLnRvLnJvdz09dFtvXS5yb3crdFtvXS5yb3dzcGFuLTEmJm4udG8uY29sPT10W29dLmNvbCt0W29dLmNvbHNwYW4tMSlyZXR1cm4hMX1yZXR1cm4gZX07SGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYmVmb3JlSW5pdCIseSksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJJbml0IixiKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlclVwZGF0ZVNldHRpbmdzIixDKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJiZWZvcmVLZXlEb3duIixSKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJtb2RpZnlUcmFuc2Zvcm1TdGFydCIsRSgibW9kaWZ5VHJhbnNmb3JtU3RhcnQiKSksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgibW9kaWZ5VHJhbnNmb3JtRW5kIixFKCJtb2RpZnlUcmFuc2Zvcm1FbmQiKSksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYmVmb3JlU2V0UmFuZ2VFbmQiLFQpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImJlZm9yZURyYXdCb3JkZXJzIixPKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlcklzTXVsdGlwbGVTZWxlY3Rpb24iLEQpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyUmVuZGVyZXIiLFMpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyQ29udGV4dE1lbnVEZWZhdWx0T3B0aW9ucyIsXyksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJHZXRDZWxsTWV0YSIsTSksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJWaWV3cG9ydFJvd0NhbGN1bGF0b3JPdmVycmlkZSIsayksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJWaWV3cG9ydENvbHVtbkNhbGN1bGF0b3JPdmVycmlkZSIsSCksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJBdXRvZmlsbEFwcGx5VmFsdWVzIixpKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlckNyZWF0ZUNvbCIscyksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJSZW1vdmVDb2wiLGEpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyQ3JlYXRlUm93IixsKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlclJlbW92ZVJvdyIsdSksSGFuZHNvbnRhYmxlLk1lcmdlQ2VsbHM9cn0seyIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiOjUsIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL3JhbmdlIjo2LCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvdGFibGUiOjIwLCJoZWxwZXJzL2RvbS9ldmVudCI6NDYscGx1Z2luczo1N31dLDgyOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se011bHRpcGxlU2VsZWN0aW9uSGFuZGxlczp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHB9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscyxhPShvPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxvJiZvLl9fZXNNb2R1bGUmJm98fHsiZGVmYXVsdCI6b30pLGw9YS5nZXRXaW5kb3dTY3JvbGxUb3AsdT1hLmhhc0NsYXNzLGM9YS5nZXRXaW5kb3dTY3JvbGxMZWZ0LGQ9KHI9ZSgiX2Jhc2UiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pWyJkZWZhdWx0Il0saD0oaT1lKCJldmVudE1hbmFnZXIiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLkV2ZW50TWFuYWdlcixmPShzPWUoInBsdWdpbnMiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLnJlZ2lzdGVyUGx1Z2luLHA9ZnVuY3Rpb24oZSl7JHRyYWNldXJSdW50aW1lLnN1cGVyQ29uc3RydWN0b3IoZykuY2FsbCh0aGlzLGUpLHRoaXMuZHJhZ2dlZD1bXSx0aGlzLmV2ZW50TWFuYWdlcj1udWxsLHRoaXMubGFzdFNldENlbGw9bnVsbH0sZz1wOyR0cmFjZXVyUnVudGltZS5jcmVhdGVDbGFzcyhwLHtpc0VuYWJsZWQ6ZnVuY3Rpb24oKXtyZXR1cm4gSGFuZHNvbnRhYmxlLm1vYmlsZUJyb3dzZXJ9LGVuYWJsZVBsdWdpbjpmdW5jdGlvbigpe3RoaXMuZW5hYmxlZHx8KHRoaXMuZXZlbnRNYW5hZ2VyfHwodGhpcy5ldmVudE1hbmFnZXI9bmV3IGgodGhpcykpLHRoaXMucmVnaXN0ZXJMaXN0ZW5lcnMoKSwkdHJhY2V1clJ1bnRpbWUuc3VwZXJHZXQodGhpcyxnLnByb3RvdHlwZSwiZW5hYmxlUGx1Z2luIikuY2FsbCh0aGlzKSl9LHJlZ2lzdGVyTGlzdGVuZXJzOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlKXtpZigxPT09dC5kcmFnZ2VkLmxlbmd0aClyZXR1cm4gdC5kcmFnZ2VkLnNwbGljZSgwLHQuZHJhZ2dlZC5sZW5ndGgpLCEwO3ZhciBuPXQuZHJhZ2dlZC5pbmRleE9mKGUpO3JldHVybi0xPT1uPyExOnZvaWQoMD09PW4/dC5kcmFnZ2VkPXQuZHJhZ2dlZC5zbGljZSgwLDEpOjE9PW4mJih0LmRyYWdnZWQ9dC5kcmFnZ2VkLnNsaWNlKC0xKSkpfXZhciB0PXRoaXM7dGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLmhvdC5yb290RWxlbWVudCwidG91Y2hzdGFydCIsZnVuY3Rpb24oZSl7dmFyIG47cmV0dXJuIHUoZS50YXJnZXQsInRvcExlZnRTZWxlY3Rpb25IYW5kbGUtSGl0QXJlYSIpPyhuPXQuaG90LmdldFNlbGVjdGVkUmFuZ2UoKSx0LmRyYWdnZWQucHVzaCgidG9wTGVmdCIpLHQudG91Y2hTdGFydFJhbmdlPXt3aWR0aDpuLmdldFdpZHRoKCksaGVpZ2h0Om4uZ2V0SGVpZ2h0KCksZGlyZWN0aW9uOm4uZ2V0RGlyZWN0aW9uKCl9LGUucHJldmVudERlZmF1bHQoKSwhMSk6dShlLnRhcmdldCwiYm90dG9tUmlnaHRTZWxlY3Rpb25IYW5kbGUtSGl0QXJlYSIpPyhuPXQuaG90LmdldFNlbGVjdGVkUmFuZ2UoKSx0LmRyYWdnZWQucHVzaCgiYm90dG9tUmlnaHQiKSx0LnRvdWNoU3RhcnRSYW5nZT17d2lkdGg6bi5nZXRXaWR0aCgpLGhlaWdodDpuLmdldEhlaWdodCgpLGRpcmVjdGlvbjpuLmdldERpcmVjdGlvbigpfSxlLnByZXZlbnREZWZhdWx0KCksITEpOnZvaWQgMH0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodGhpcy5ob3Qucm9vdEVsZW1lbnQsInRvdWNoZW5kIixmdW5jdGlvbihuKXtyZXR1cm4gdShuLnRhcmdldCwidG9wTGVmdFNlbGVjdGlvbkhhbmRsZS1IaXRBcmVhIik/KGUuY2FsbCh0LCJ0b3BMZWZ0IiksdC50b3VjaFN0YXJ0UmFuZ2U9dm9pZCAwLG4ucHJldmVudERlZmF1bHQoKSwhMSk6dShuLnRhcmdldCwiYm90dG9tUmlnaHRTZWxlY3Rpb25IYW5kbGUtSGl0QXJlYSIpPyhlLmNhbGwodCwiYm90dG9tUmlnaHQiKSx0LnRvdWNoU3RhcnRSYW5nZT12b2lkIDAsbi5wcmV2ZW50RGVmYXVsdCgpLCExKTp2b2lkIDB9KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKHRoaXMuaG90LnJvb3RFbGVtZW50LCJ0b3VjaG1vdmUiLGZ1bmN0aW9uKGUpe3ZhciBuLG8scixpLHMsYSx1LGQ9bCgpLGg9YygpOzAhPT10LmRyYWdnZWQubGVuZ3RoJiYobj1kb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGUudG91Y2hlc1swXS5zY3JlZW5YLWgsZS50b3VjaGVzWzBdLnNjcmVlblktZCksbiYmbiE9PXQubGFzdFNldENlbGwmJigoIlREIj09bi5ub2RlTmFtZXx8IlRIIj09bi5ub2RlTmFtZSkmJihvPXQuaG90LmdldENvb3JkcyhuKSwtMT09by5jb2wmJihvLmNvbD0wKSxyPXQuaG90LmdldFNlbGVjdGVkUmFuZ2UoKSxpPXIuZ2V0V2lkdGgoKSxzPXIuZ2V0SGVpZ2h0KCksYT1yLmdldERpcmVjdGlvbigpLDE9PWkmJjE9PXMmJnQuaG90LnNlbGVjdGlvbi5zZXRSYW5nZUVuZChvKSx1PXQuZ2V0Q3VycmVudFJhbmdlQ29vcmRzKHIsbyx0LnRvdWNoU3RhcnRSYW5nZS5kaXJlY3Rpb24sYSx0LmRyYWdnZWRbMF0pLG51bGwhPT11LnN0YXJ0JiZ0LmhvdC5zZWxlY3Rpb24uc2V0UmFuZ2VTdGFydCh1LnN0YXJ0KSx0LmhvdC5zZWxlY3Rpb24uc2V0UmFuZ2VFbmQodS5lbmQpLHQubGFzdFNldENlbGw9biksZS5wcmV2ZW50RGVmYXVsdCgpKSl9KX0sZ2V0Q3VycmVudFJhbmdlQ29vcmRzOmZ1bmN0aW9uKGUsdCxuLG8scil7dmFyIGk9ZS5nZXRUb3BMZWZ0Q29ybmVyKCkscz1lLmdldEJvdHRvbVJpZ2h0Q29ybmVyKCksYT1lLmdldEJvdHRvbUxlZnRDb3JuZXIoKSxsPWUuZ2V0VG9wUmlnaHRDb3JuZXIoKSx1PXtzdGFydDpudWxsLGVuZDpudWxsfTtzd2l0Y2gobil7Y2FzZSJORS1TVyI6c3dpdGNoKG8pe2Nhc2UiTkUtU1ciOmNhc2UiTlctU0UiOnU9InRvcExlZnQiPT1yP3tzdGFydDpuZXcgV2Fsa29udGFibGVDZWxsQ29vcmRzKHQucm93LGUuaGlnaGxpZ2h0LmNvbCksZW5kOm5ldyBXYWxrb250YWJsZUNlbGxDb29yZHMoYS5yb3csdC5jb2wpfTp7c3RhcnQ6bmV3IFdhbGtvbnRhYmxlQ2VsbENvb3JkcyhlLmhpZ2hsaWdodC5yb3csdC5jb2wpLGVuZDpuZXcgV2Fsa29udGFibGVDZWxsQ29vcmRzKHQucm93LGkuY29sKX07YnJlYWs7Y2FzZSJTRS1OVyI6ImJvdHRvbVJpZ2h0Ij09ciYmKHU9e3N0YXJ0Om5ldyBXYWxrb250YWJsZUNlbGxDb29yZHMocy5yb3csdC5jb2wpLGVuZDpuZXcgV2Fsa29udGFibGVDZWxsQ29vcmRzKHQucm93LGkuY29sKX0pfWJyZWFrO2Nhc2UiTlctU0UiOnN3aXRjaChvKXtjYXNlIk5FLVNXIjoidG9wTGVmdCI9PXI/dT17c3RhcnQ6dCxlbmQ6YX06dS5lbmQ9dDticmVhaztjYXNlIk5XLVNFIjoidG9wTGVmdCI9PXI/dT17c3RhcnQ6dCxlbmQ6c306dS5lbmQ9dDticmVhaztjYXNlIlNFLU5XIjoidG9wTGVmdCI9PXI/dT17c3RhcnQ6dCxlbmQ6aX06dS5lbmQ9dDticmVhaztjYXNlIlNXLU5FIjoidG9wTGVmdCI9PXI/dT17c3RhcnQ6dCxlbmQ6bH06dS5lbmQ9dH1icmVhaztjYXNlIlNXLU5FIjpzd2l0Y2gobyl7Y2FzZSJOVy1TRSI6dT0iYm90dG9tUmlnaHQiPT1yP3tzdGFydDpuZXcgV2Fsa29udGFibGVDZWxsQ29vcmRzKHQucm93LGkuY29sKSxlbmQ6bmV3IFdhbGtvbnRhYmxlQ2VsbENvb3JkcyhhLnJvdyx0LmNvbCl9OntzdGFydDpuZXcgV2Fsa29udGFibGVDZWxsQ29vcmRzKGkucm93LHQuY29sKSxlbmQ6bmV3IFdhbGtvbnRhYmxlQ2VsbENvb3Jkcyh0LnJvdyxzLmNvbCl9O2JyZWFrO2Nhc2UiU1ctTkUiOnU9InRvcExlZnQiPT1yP3tzdGFydDpuZXcgV2Fsa29udGFibGVDZWxsQ29vcmRzKGUuaGlnaGxpZ2h0LnJvdyx0LmNvbCksZW5kOm5ldyBXYWxrb250YWJsZUNlbGxDb29yZHModC5yb3cscy5jb2wpfTp7c3RhcnQ6bmV3IFdhbGtvbnRhYmxlQ2VsbENvb3Jkcyh0LnJvdyxpLmNvbCksZW5kOm5ldyBXYWxrb250YWJsZUNlbGxDb29yZHMoaS5yb3csdC5jb2wpfTticmVhaztjYXNlIlNFLU5XIjoiYm90dG9tUmlnaHQiPT1yP3U9e3N0YXJ0Om5ldyBXYWxrb250YWJsZUNlbGxDb29yZHModC5yb3csbC5jb2wpLGVuZDpuZXcgV2Fsa29udGFibGVDZWxsQ29vcmRzKGkucm93LHQuY29sKX06InRvcExlZnQiPT1yJiYodT17c3RhcnQ6YSxlbmQ6dH0pfWJyZWFrO2Nhc2UiU0UtTlciOnN3aXRjaChvKXtjYXNlIk5XLVNFIjpjYXNlIk5FLVNXIjpjYXNlIlNXLU5FIjoidG9wTGVmdCI9PXImJih1LmVuZD10KTticmVhaztjYXNlIlNFLU5XIjoidG9wTGVmdCI9PXI/dS5lbmQ9dDp1PXtzdGFydDp0LGVuZDppfX19cmV0dXJuIHV9LGlzRHJhZ2dlZDpmdW5jdGlvbigpe3JldHVybiB0aGlzLmRyYWdnZWQubGVuZ3RoPjB9fSx7fSxkKSxmKCJtdWx0aXBsZVNlbGVjdGlvbkhhbmRsZXMiLHApfSx7X2Jhc2U6NTgsZXZlbnRNYW5hZ2VyOjQxLCJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSxwbHVnaW5zOjU3fV0sODM6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbygpe31mdW5jdGlvbiByKCl7dmFyIGU9dGhpcyx0PWUuZ2V0U2V0dGluZ3MoKS5vYnNlcnZlQ2hhbmdlczt0PyhlLm9ic2VydmVyJiZhLmNhbGwoZSksaS5jYWxsKGUpLHUuY2FsbChlKSk6dHx8YS5jYWxsKGUpfWZ1bmN0aW9uIGkoKXt2YXIgZT10aGlzO2Uub2JzZXJ2ZUNoYW5nZXNBY3RpdmU9ITAsZS5wYXVzZU9ic2VydmluZ0NoYW5nZXM9ZnVuY3Rpb24oKXtlLm9ic2VydmVDaGFuZ2VzQWN0aXZlPSExfSxlLnJlc3VtZU9ic2VydmluZ0NoYW5nZXM9ZnVuY3Rpb24oKXtlLm9ic2VydmVDaGFuZ2VzQWN0aXZlPSEwfSxlLm9ic2VydmVkRGF0YT1lLmdldFNvdXJjZURhdGEoKSxlLm9ic2VydmVyPXAub2JzZXJ2ZShlLm9ic2VydmVkRGF0YSxmdW5jdGlvbih0KXtlLm9ic2VydmVDaGFuZ2VzQWN0aXZlJiYocy5jYWxsKGUsdCksZS5yZW5kZXIoKSksZS5ydW5Ib29rcygiYWZ0ZXJDaGFuZ2VzT2JzZXJ2ZWQiKX0pfWZ1bmN0aW9uIHMoZSl7ZnVuY3Rpb24gdChlKXt2YXIgdDtyZXR1cm4gdD1vKGUpLHQ9bih0KX1mdW5jdGlvbiBuKGUpe3ZhciB0PVtdO3JldHVybiBlLmZpbHRlcihmdW5jdGlvbihlKXt2YXIgbj1yKGUucGF0aCk7aWYoLTEhPVsiYWRkIiwicmVtb3ZlIl0uaW5kZXhPZihlLm9wKSYmIWlzTmFOKG4uY29sKSl7aWYoLTEhPXQuaW5kZXhPZihuLmNvbCkpcmV0dXJuITE7dC5wdXNoKG4uY29sKX1yZXR1cm4hMH0pfWZ1bmN0aW9uIG8oZSl7cmV0dXJuIGUuZmlsdGVyKGZ1bmN0aW9uKGUpe3JldHVybiEvW1wvXWxlbmd0aC9naS50ZXN0KGUucGF0aCl9KX1mdW5jdGlvbiByKGUpe3ZhciB0PWUubWF0Y2goL15cLyhcZCspXC8/KC4qKT8kLyk7cmV0dXJue3JvdzpwYXJzZUludCh0WzFdLDEwKSxjb2w6L15cZCokLy50ZXN0KHRbMl0pP3BhcnNlSW50KHRbMl0sMTApOnRbMl19fWZvcih2YXIgaT10aGlzLHM9dChlKSxhPTAsbD1zLmxlbmd0aDtsPmE7YSsrKXt2YXIgdT1zW2FdLGM9cih1LnBhdGgpO3N3aXRjaCh1Lm9wKXtjYXNlImFkZCI6aXNOYU4oYy5jb2wpP2kucnVuSG9va3MoImFmdGVyQ3JlYXRlUm93IixjLnJvdyk6aS5ydW5Ib29rcygiYWZ0ZXJDcmVhdGVDb2wiLGMuY29sKTticmVhaztjYXNlInJlbW92ZSI6aXNOYU4oYy5jb2wpP2kucnVuSG9va3MoImFmdGVyUmVtb3ZlUm93IixjLnJvdywxKTppLnJ1bkhvb2tzKCJhZnRlclJlbW92ZUNvbCIsYy5jb2wsMSk7YnJlYWs7Y2FzZSJyZXBsYWNlIjppLnJ1bkhvb2tzKCJhZnRlckNoYW5nZSIsW2Mucm93LGMuY29sLG51bGwsdS52YWx1ZV0sImV4dGVybmFsIil9fX1mdW5jdGlvbiBhKCl7dmFyIGU9dGhpcztlLm9ic2VydmVyJiYobC5jYWxsKGUpLGMuY2FsbChlKSl9ZnVuY3Rpb24gbCgpe3ZhciBlPXRoaXM7cC51bm9ic2VydmUoZS5vYnNlcnZlZERhdGEsZS5vYnNlcnZlciksZGVsZXRlIGUub2JzZXJ2ZWREYXRhLGRlbGV0ZSBlLm9ic2VydmVDaGFuZ2VzQWN0aXZlLGRlbGV0ZSBlLnBhdXNlT2JzZXJ2aW5nQ2hhbmdlcyxkZWxldGUgZS5yZXN1bWVPYnNlcnZpbmdDaGFuZ2VzfWZ1bmN0aW9uIHUoKXt2YXIgZT10aGlzO2UuYWRkSG9vaygiYWZ0ZXJEZXN0cm95IixhKSxlLmFkZEhvb2soImFmdGVyQ3JlYXRlUm93IixkKSxlLmFkZEhvb2soImFmdGVyUmVtb3ZlUm93IixkKSxlLmFkZEhvb2soImFmdGVyQ3JlYXRlQ29sIixkKSxlLmFkZEhvb2soImFmdGVyUmVtb3ZlQ29sIixkKSxlLmFkZEhvb2soImFmdGVyQ2hhbmdlIixmdW5jdGlvbihlLHQpeyJsb2FkRGF0YSIhPXQmJmQuY2FsbCh0aGlzKX0pfWZ1bmN0aW9uIGMoKXt2YXIgZT10aGlzO2UucmVtb3ZlSG9vaygiYWZ0ZXJEZXN0cm95IixhKSxlLnJlbW92ZUhvb2soImFmdGVyQ3JlYXRlUm93IixkKSxlLnJlbW92ZUhvb2soImFmdGVyUmVtb3ZlUm93IixkKSxlLnJlbW92ZUhvb2soImFmdGVyQ3JlYXRlQ29sIixkKSxlLnJlbW92ZUhvb2soImFmdGVyUmVtb3ZlQ29sIixkKSxlLnJlbW92ZUhvb2soImFmdGVyQ2hhbmdlIixkKX1mdW5jdGlvbiBkKCl7dmFyIGU9dGhpcztlLnBhdXNlT2JzZXJ2aW5nQ2hhbmdlcygpLGUuYWRkSG9va09uY2UoImFmdGVyQ2hhbmdlc09ic2VydmVkIixmdW5jdGlvbigpe2UucmVzdW1lT2JzZXJ2aW5nQ2hhbmdlcygpfSl9T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7T2JzZXJ2ZUNoYW5nZXM6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIGgsZixwPSgoaD1lKCJwbHVnaW5zIiksaCYmaC5fX2VzTW9kdWxlJiZofHx7ImRlZmF1bHQiOmh9KS5yZWdpc3RlclBsdWdpbiwoZj1lKCJqc29ucGF0Y2giKSxmJiZmLl9fZXNNb2R1bGUmJmZ8fHsiZGVmYXVsdCI6Zn0pWyJkZWZhdWx0Il0pO0hhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyTG9hZERhdGEiLHIpLEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVyVXBkYXRlU2V0dGluZ3MiLHIpLEhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcigiYWZ0ZXJDaGFuZ2VzT2JzZXJ2ZWQiKX0se2pzb25wYXRjaDoianNvbnBhdGNoIixwbHVnaW5zOjU3fV0sODQ6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlKXt2YXIgdCxuPWZ1bmN0aW9uKCl7d2luZG93LmxvY2FsU3RvcmFnZVtlKyJfX3BlcnNpc3RlbnRTdGF0ZUtleXMiXT1KU09OLnN0cmluZ2lmeSh0KX0sbz1mdW5jdGlvbigpe3ZhciBuPXdpbmRvdy5sb2NhbFN0b3JhZ2VbZSsiX19wZXJzaXN0ZW50U3RhdGVLZXlzIl0sbz0ic3RyaW5nIj09dHlwZW9mIG4/SlNPTi5wYXJzZShuKTp2b2lkIDA7dD1vP286W119LHI9ZnVuY3Rpb24oKXt0PVtdLG4oKX07bygpLHRoaXMuc2F2ZVZhbHVlPWZ1bmN0aW9uKG8scil7d2luZG93LmxvY2FsU3RvcmFnZVtlKyJfIitvXT1KU09OLnN0cmluZ2lmeShyKSwtMT09dC5pbmRleE9mKG8pJiYodC5wdXNoKG8pLG4oKSl9LHRoaXMubG9hZFZhbHVlPWZ1bmN0aW9uKHQsbil7dD0idW5kZWZpbmVkIj09dHlwZW9mIHQ/bjp0O3ZhciBvPXdpbmRvdy5sb2NhbFN0b3JhZ2VbZSsiXyIrdF07cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiBvP3ZvaWQgMDpKU09OLnBhcnNlKG8pfSx0aGlzLnJlc2V0PWZ1bmN0aW9uKHQpe3dpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShlKyJfIit0KX0sdGhpcy5yZXNldEFsbD1mdW5jdGlvbigpe2Zvcih2YXIgbj0wO248dC5sZW5ndGg7bisrKXdpbmRvdy5sb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShlKyJfIit0W25dKTtyKCl9fWZ1bmN0aW9uIHIoKXtmdW5jdGlvbiBlKCl7dmFyIGU9dGhpcztmb3IodmFyIHQgaW4gcilyLmhhc093blByb3BlcnR5KHQpJiZlLmFkZEhvb2sodCxyW3RdKX1mdW5jdGlvbiB0KCl7dmFyIGU9dGhpcztmb3IodmFyIHQgaW4gcilyLmhhc093blByb3BlcnR5KHQpJiZlLnJlbW92ZUhvb2sodCxyW3RdKX12YXIgbj10aGlzO3RoaXMuaW5pdD1mdW5jdGlvbigpe3ZhciByPXRoaXMsaT1yLmdldFNldHRpbmdzKCkucGVyc2lzdGVudFN0YXRlO3JldHVybiBuLmVuYWJsZWQ9ISFpLG4uZW5hYmxlZD8oci5zdG9yYWdlfHwoci5zdG9yYWdlPW5ldyBvKHIucm9vdEVsZW1lbnQuaWQpKSxyLnJlc2V0U3RhdGU9bi5yZXNldFZhbHVlLHZvaWQgZS5jYWxsKHIpKTp2b2lkIHQuY2FsbChyKX0sdGhpcy5zYXZlVmFsdWU9ZnVuY3Rpb24oZSx0KXt2YXIgbj10aGlzO24uc3RvcmFnZS5zYXZlVmFsdWUoZSx0KX0sdGhpcy5sb2FkVmFsdWU9ZnVuY3Rpb24oZSx0KXt2YXIgbj10aGlzO3QudmFsdWU9bi5zdG9yYWdlLmxvYWRWYWx1ZShlKX0sdGhpcy5yZXNldFZhbHVlPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7InVuZGVmaW5lZCI9PXR5cGVvZiBlP3Quc3RvcmFnZS5yZXNldEFsbCgpOnQuc3RvcmFnZS5yZXNldChlKX07dmFyIHI9e3BlcnNpc3RlbnRTdGF0ZVNhdmU6bi5zYXZlVmFsdWUscGVyc2lzdGVudFN0YXRlTG9hZDpuLmxvYWRWYWx1ZSxwZXJzaXN0ZW50U3RhdGVSZXNldDpuLnJlc2V0VmFsdWV9O2Zvcih2YXIgaSBpbiByKXIuaGFzT3duUHJvcGVydHkoaSkmJkhhbmRzb250YWJsZS5ob29rcy5yZWdpc3RlcihpKX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtIYW5kc29udGFibGVQZXJzaXN0ZW50U3RhdGU6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIGkscz0oKGk9ZSgicGx1Z2lucyIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkucmVnaXN0ZXJQbHVnaW4sbmV3IHIpO0hhbmRzb250YWJsZS5ob29rcy5hZGQoImJlZm9yZUluaXQiLHMuaW5pdCksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJVcGRhdGVTZXR0aW5ncyIscy5pbml0KX0se3BsdWdpbnM6NTd9XSw4NTpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKCl7dmFyIGU9dGhpcyx0PSEhZS5nZXRTZXR0aW5ncygpLnNlYXJjaDt0P2Uuc2VhcmNoPW5ldyBIYW5kc29udGFibGUuU2VhcmNoKGUpOmRlbGV0ZSBlLnNlYXJjaH12YXIgcixpLHM9KHI9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksYT1zLmFkZENsYXNzLGw9cy5yZW1vdmVDbGFzcyx1PShpPWUoInJlbmRlcmVycyIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSksYz11LnJlZ2lzdGVyUmVuZGVyZXIsZD11LmdldFJlbmRlcmVyO0hhbmRzb250YWJsZS5TZWFyY2g9ZnVuY3Rpb24oZSl7dGhpcy5xdWVyeT1mdW5jdGlvbih0LG4sbyl7dmFyIHI9ZS5jb3VudFJvd3MoKSxpPWUuY291bnRDb2xzKCkscz1bXTtufHwobj1IYW5kc29udGFibGUuU2VhcmNoLmdsb2JhbC5nZXREZWZhdWx0Q2FsbGJhY2soKSksb3x8KG89SGFuZHNvbnRhYmxlLlNlYXJjaC5nbG9iYWwuZ2V0RGVmYXVsdFF1ZXJ5TWV0aG9kKCkpO2Zvcih2YXIgYT0wO3I+YTthKyspZm9yKHZhciBsPTA7aT5sO2wrKyl7dmFyIHU9ZS5nZXREYXRhQXRDZWxsKGEsbCksYz1lLmdldENlbGxNZXRhKGEsbCksZD1jLnNlYXJjaC5jYWxsYmFja3x8bixoPWMuc2VhcmNoLnF1ZXJ5TWV0aG9kfHxvLGY9aCh0LHUpO2lmKGYpe3ZhciBwPXtyb3c6YSxjb2w6bCxkYXRhOnV9O3MucHVzaChwKX1kJiZkKGUsYSxsLHUsZil9cmV0dXJuIHN9fSxIYW5kc29udGFibGUuU2VhcmNoLkRFRkFVTFRfQ0FMTEJBQ0s9ZnVuY3Rpb24oZSx0LG4sbyxyKXtlLmdldENlbGxNZXRhKHQsbikuaXNTZWFyY2hSZXN1bHQ9cn0sSGFuZHNvbnRhYmxlLlNlYXJjaC5ERUZBVUxUX1FVRVJZX01FVEhPRD1mdW5jdGlvbihlLHQpe3JldHVybiJ1bmRlZmluZWQiIT10eXBlb2YgZSYmbnVsbCE9ZSYmZS50b0xvd2VyQ2FzZSYmMCE9PWUubGVuZ3RoPyJ1bmRlZmluZWQiPT10eXBlb2YgdHx8bnVsbD09dD8hMTotMSE9dC50b1N0cmluZygpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihlLnRvTG93ZXJDYXNlKCkpOiExfSxIYW5kc29udGFibGUuU2VhcmNoLkRFRkFVTFRfU0VBUkNIX1JFU1VMVF9DTEFTUz0iaHRTZWFyY2hSZXN1bHQiLEhhbmRzb250YWJsZS5TZWFyY2guZ2xvYmFsPWZ1bmN0aW9uKCl7dmFyIGU9SGFuZHNvbnRhYmxlLlNlYXJjaC5ERUZBVUxUX0NBTExCQUNLLHQ9SGFuZHNvbnRhYmxlLlNlYXJjaC5ERUZBVUxUX1FVRVJZX01FVEhPRCxuPUhhbmRzb250YWJsZS5TZWFyY2guREVGQVVMVF9TRUFSQ0hfUkVTVUxUX0NMQVNTO3JldHVybntnZXREZWZhdWx0Q2FsbGJhY2s6ZnVuY3Rpb24oKXtyZXR1cm4gZX0sc2V0RGVmYXVsdENhbGxiYWNrOmZ1bmN0aW9uKHQpe2U9dH0sZ2V0RGVmYXVsdFF1ZXJ5TWV0aG9kOmZ1bmN0aW9uKCl7cmV0dXJuIHR9LHNldERlZmF1bHRRdWVyeU1ldGhvZDpmdW5jdGlvbihlKXt0PWV9LGdldERlZmF1bHRTZWFyY2hSZXN1bHRDbGFzczpmdW5jdGlvbigpe3JldHVybiBufSxzZXREZWZhdWx0U2VhcmNoUmVzdWx0Q2xhc3M6ZnVuY3Rpb24oZSl7bj1lfX19KCksSGFuZHNvbnRhYmxlLlNlYXJjaENlbGxEZWNvcmF0b3I9ZnVuY3Rpb24oZSx0LG4sbyxyLGkscyl7dmFyIHU9bnVsbCE9PXMuc2VhcmNoJiYib2JqZWN0Ij09dHlwZW9mIHMuc2VhcmNoJiZzLnNlYXJjaC5zZWFyY2hSZXN1bHRDbGFzc3x8SGFuZHNvbnRhYmxlLlNlYXJjaC5nbG9iYWwuZ2V0RGVmYXVsdFNlYXJjaFJlc3VsdENsYXNzKCk7cy5pc1NlYXJjaFJlc3VsdD9hKHQsdSk6bCh0LHUpfTt2YXIgaD1kKCJiYXNlIik7YygiYmFzZSIsZnVuY3Rpb24oZSx0LG4sbyxyLGkscyl7aC5hcHBseSh0aGlzLGFyZ3VtZW50cyksSGFuZHNvbnRhYmxlLlNlYXJjaENlbGxEZWNvcmF0b3IuYXBwbHkodGhpcyxhcmd1bWVudHMpfSksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJJbml0IixvKSxIYW5kc29udGFibGUuaG9va3MuYWRkKCJhZnRlclVwZGF0ZVNldHRpbmdzIixvKX0seyJoZWxwZXJzL2RvbS9lbGVtZW50Ijo0NSxyZW5kZXJlcnM6ODh9XSw4NjpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtUb3VjaFNjcm9sbDp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGR9fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgbyxyLGkscz0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSxhPXMuYWRkQ2xhc3MsbD1zLnJlbW92ZUNsYXNzLHU9KHI9ZSgiX2Jhc2UiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pWyJkZWZhdWx0Il0sYz0oaT1lKCJwbHVnaW5zIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5yZWdpc3RlclBsdWdpbixkPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7JHRyYWNldXJSdW50aW1lLnN1cGVyQ29uc3RydWN0b3IoaCkuY2FsbCh0aGlzLGUpLHRoaXMuaG90LmFkZEhvb2soImFmdGVySW5pdCIsZnVuY3Rpb24oKXtyZXR1cm4gdC5hZnRlckluaXQoKX0pLHRoaXMuaG90LmFkZEhvb2soImFmdGVyVXBkYXRlU2V0dGluZ3MiLGZ1bmN0aW9uKCl7cmV0dXJuIHQub25BZnRlclVwZGF0ZVNldHRpbmdzKCl9KSx0aGlzLnNjcm9sbGJhcnM9W10sdGhpcy5jbG9uZXM9W119LGg9ZDskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoZCx7YWZ0ZXJJbml0OmZ1bmN0aW9uKCl7dGhpcy5yZWdpc3RlckV2ZW50cygpLHRoaXMub25BZnRlclVwZGF0ZVNldHRpbmdzKCl9LG9uQWZ0ZXJVcGRhdGVTZXR0aW5nczpmdW5jdGlvbigpe3ZhciBlPXRoaXM7dGhpcy5ob3QuYWRkSG9va09uY2UoImFmdGVyUmVuZGVyIixmdW5jdGlvbigpe3ZhciB0PWUuaG90LnZpZXcud3Qud3RPdmVybGF5cztlLnNjcm9sbGJhcnM9W10sZS5zY3JvbGxiYXJzLnB1c2godC50b3BPdmVybGF5KSx0LmJvdHRvbU92ZXJsYXkuY2xvbmUmJmUuc2Nyb2xsYmFycy5wdXNoKHQuYm90dG9tT3ZlcmxheSksZS5zY3JvbGxiYXJzLnB1c2godC5sZWZ0T3ZlcmxheSksdC50b3BMZWZ0Q29ybmVyT3ZlcmxheSYmZS5zY3JvbGxiYXJzLnB1c2godC50b3BMZWZ0Q29ybmVyT3ZlcmxheSksdC5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheSYmdC5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheS5jbG9uZSYmZS5zY3JvbGxiYXJzLnB1c2godC5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheSksZS5jbG9uZXM9W10sdC50b3BPdmVybGF5Lm5lZWRGdWxsUmVuZGVyJiZlLmNsb25lcy5wdXNoKHQudG9wT3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKSx0LmJvdHRvbU92ZXJsYXkubmVlZEZ1bGxSZW5kZXImJmUuY2xvbmVzLnB1c2godC5ib3R0b21PdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUpLHQubGVmdE92ZXJsYXkubmVlZEZ1bGxSZW5kZXImJmUuY2xvbmVzLnB1c2godC5sZWZ0T3ZlcmxheS5jbG9uZS53dFRhYmxlLmhvbGRlci5wYXJlbnROb2RlKSx0LnRvcExlZnRDb3JuZXJPdmVybGF5JiZlLmNsb25lcy5wdXNoKHQudG9wTGVmdENvcm5lck92ZXJsYXkuY2xvbmUud3RUYWJsZS5ob2xkZXIucGFyZW50Tm9kZSksdC5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheSYmdC5ib3R0b21MZWZ0Q29ybmVyT3ZlcmxheS5jbG9uZSYmZS5jbG9uZXMucHVzaCh0LmJvdHRvbUxlZnRDb3JuZXJPdmVybGF5LmNsb25lLnd0VGFibGUuaG9sZGVyLnBhcmVudE5vZGUpfSl9LHJlZ2lzdGVyRXZlbnRzOmZ1bmN0aW9uKCl7dmFyIGU9dGhpczt0aGlzLmhvdC5hZGRIb29rKCJiZWZvcmVUb3VjaFNjcm9sbCIsZnVuY3Rpb24oKXtyZXR1cm4gZS5vbkJlZm9yZVRvdWNoU2Nyb2xsKCl9KSx0aGlzLmhvdC5hZGRIb29rKCJhZnRlck1vbWVudHVtU2Nyb2xsIixmdW5jdGlvbigpe3JldHVybiBlLm9uQWZ0ZXJNb21lbnR1bVNjcm9sbCgpfSl9LG9uQmVmb3JlVG91Y2hTY3JvbGw6ZnVuY3Rpb24oKXtIYW5kc29udGFibGUuZnJlZXplT3ZlcmxheXM9ITA7Zm9yKHZhciBlPTAsdD10aGlzLmNsb25lcy5sZW5ndGg7dD5lO2UrKylhKHRoaXMuY2xvbmVzW2VdLCJoaWRlLXR3ZWVuIil9LG9uQWZ0ZXJNb21lbnR1bVNjcm9sbDpmdW5jdGlvbigpe0hhbmRzb250YWJsZS5mcmVlemVPdmVybGF5cz0hMTtmb3IodmFyIGU9dGhpcyx0PTAsbj10aGlzLmNsb25lcy5sZW5ndGg7bj50O3QrKylsKHRoaXMuY2xvbmVzW3RdLCJoaWRlLXR3ZWVuIik7Zm9yKHZhciBvPTAscj10aGlzLmNsb25lcy5sZW5ndGg7cj5vO28rKylhKHRoaXMuY2xvbmVzW29dLCJzaG93LXR3ZWVuIik7c2V0VGltZW91dChmdW5jdGlvbigpe2Zvcih2YXIgdD0wLG49ZS5jbG9uZXMubGVuZ3RoO24+dDt0KyspbChlLmNsb25lc1t0XSwic2hvdy10d2VlbiIpfSw0MDApO2Zvcih2YXIgaT0wLHM9dGhpcy5zY3JvbGxiYXJzLmxlbmd0aDtzPmk7aSsrKXRoaXMuc2Nyb2xsYmFyc1tpXS5yZWZyZXNoKCksdGhpcy5zY3JvbGxiYXJzW2ldLnJlc2V0Rml4ZWRQb3NpdGlvbigpO3RoaXMuaG90LnZpZXcud3Qud3RPdmVybGF5cy5zeW5jU2Nyb2xsV2l0aE1hc3RlcigpfX0se30sdSksYygidG91Y2hTY3JvbGwiLGQpfSx7X2Jhc2U6NTgsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LHBsdWdpbnM6NTd9XSw4NzpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKCl7dmFyIGU9dGhpcyx0PSJ1bmRlZmluZWQiPT10eXBlb2YgZS5nZXRTZXR0aW5ncygpLnVuZG98fGUuZ2V0U2V0dGluZ3MoKS51bmRvO3Q/ZS51bmRvUmVkb3x8KGUudW5kb1JlZG89bmV3IEhhbmRzb250YWJsZS5VbmRvUmVkbyhlKSxzKGUpLGUuYWRkSG9vaygiYmVmb3JlS2V5RG93biIsciksZS5hZGRIb29rKCJhZnRlckNoYW5nZSIsaSkpOmUudW5kb1JlZG8mJihkZWxldGUgZS51bmRvUmVkbyxhKGUpLGUucmVtb3ZlSG9vaygiYmVmb3JlS2V5RG93biIsciksZS5yZW1vdmVIb29rKCJhZnRlckNoYW5nZSIsaSkpfWZ1bmN0aW9uIHIoZSl7dmFyIHQ9dGhpcyxuPShlLmN0cmxLZXl8fGUubWV0YUtleSkmJiFlLmFsdEtleTtuJiYoODk9PT1lLmtleUNvZGV8fGUuc2hpZnRLZXkmJjkwPT09ZS5rZXlDb2RlPyh0LnVuZG9SZWRvLnJlZG8oKSxmKGUpKTo5MD09PWUua2V5Q29kZSYmKHQudW5kb1JlZG8udW5kbygpLGYoZSkpKX1mdW5jdGlvbiBpKGUsdCl7dmFyIG49dGhpcztyZXR1cm4ibG9hZERhdGEiPT10P24udW5kb1JlZG8uY2xlYXIoKTp2b2lkIDB9ZnVuY3Rpb24gcyhlKXtlLnVuZG89ZnVuY3Rpb24oKXtyZXR1cm4gZS51bmRvUmVkby51bmRvKCl9LGUucmVkbz1mdW5jdGlvbigpe3JldHVybiBlLnVuZG9SZWRvLnJlZG8oKX0sZS5pc1VuZG9BdmFpbGFibGU9ZnVuY3Rpb24oKXtyZXR1cm4gZS51bmRvUmVkby5pc1VuZG9BdmFpbGFibGUoKX0sZS5pc1JlZG9BdmFpbGFibGU9ZnVuY3Rpb24oKXtyZXR1cm4gZS51bmRvUmVkby5pc1JlZG9BdmFpbGFibGUoKX0sZS5jbGVhclVuZG89ZnVuY3Rpb24oKXtyZXR1cm4gZS51bmRvUmVkby5jbGVhcigpfX1mdW5jdGlvbiBhKGUpe2RlbGV0ZSBlLnVuZG8sZGVsZXRlIGUucmVkbyxkZWxldGUgZS5pc1VuZG9BdmFpbGFibGUsZGVsZXRlIGUuaXNSZWRvQXZhaWxhYmxlLGRlbGV0ZSBlLmNsZWFyVW5kb312YXIgbCx1LGM9KGw9ZSgiaGVscGVycy9vYmplY3QiKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLGQ9Yy5pbmhlcml0LGg9Yy5kZWVwQ2xvbmUsZj0odT1lKCJoZWxwZXJzL2RvbS9ldmVudCIpLHUmJnUuX19lc01vZHVsZSYmdXx8eyJkZWZhdWx0Ijp1fSkuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uO0hhbmRzb250YWJsZS5VbmRvUmVkbz1mdW5jdGlvbihlKXt2YXIgdD10aGlzO3RoaXMuaW5zdGFuY2U9ZSx0aGlzLmRvbmVBY3Rpb25zPVtdLHRoaXMudW5kb25lQWN0aW9ucz1bXSx0aGlzLmlnbm9yZU5ld0FjdGlvbnM9ITEsZS5hZGRIb29rKCJhZnRlckNoYW5nZSIsZnVuY3Rpb24oZSxuKXtpZihlKXt2YXIgbz1uZXcgSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNoYW5nZUFjdGlvbihlKTt0LmRvbmUobyl9fSksZS5hZGRIb29rKCJhZnRlckNyZWF0ZVJvdyIsZnVuY3Rpb24oZSxuLG8pe2lmKCFvKXt2YXIgcj1uZXcgSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNyZWF0ZVJvd0FjdGlvbihlLG4pO3QuZG9uZShyKX19KSxlLmFkZEhvb2soImJlZm9yZVJlbW92ZVJvdyIsZnVuY3Rpb24oZSxuKXt2YXIgbz10Lmluc3RhbmNlLmdldFNvdXJjZURhdGEoKTtlPShvLmxlbmd0aCtlKSVvLmxlbmd0aDt2YXIgcj1vLnNsaWNlKGUsZStuKSxpPW5ldyBIYW5kc29udGFibGUuVW5kb1JlZG8uUmVtb3ZlUm93QWN0aW9uKGUscik7dC5kb25lKGkpfSksZS5hZGRIb29rKCJhZnRlckNyZWF0ZUNvbCIsZnVuY3Rpb24oZSxuLG8pe2lmKCFvKXt2YXIgcj1uZXcgSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNyZWF0ZUNvbHVtbkFjdGlvbihlLG4pO3QuZG9uZShyKX19KSxlLmFkZEhvb2soImJlZm9yZVJlbW92ZUNvbCIsZnVuY3Rpb24obixvKXt2YXIgcj10Lmluc3RhbmNlLmdldFNvdXJjZURhdGEoKTtuPSh0Lmluc3RhbmNlLmNvdW50Q29scygpK24pJXQuaW5zdGFuY2UuY291bnRDb2xzKCk7Zm9yKHZhciBpPVtdLHM9MCxhPXIubGVuZ3RoO2E+cztzKyspaVtzXT1yW3NdLnNsaWNlKG4sbitvKTt2YXIgbDtBcnJheS5pc0FycmF5KGUuZ2V0U2V0dGluZ3MoKS5jb2xIZWFkZXJzKSYmKGw9ZS5nZXRTZXR0aW5ncygpLmNvbEhlYWRlcnMuc2xpY2UobixuK2kubGVuZ3RoKSk7dmFyIHU9bmV3IEhhbmRzb250YWJsZS5VbmRvUmVkby5SZW1vdmVDb2x1bW5BY3Rpb24obixpLGwpO3QuZG9uZSh1KX0pLGUuYWRkSG9vaygiYmVmb3JlQ2VsbEFsaWdubWVudCIsZnVuY3Rpb24oZSxuLG8scil7dmFyIGk9bmV3IEhhbmRzb250YWJsZS5VbmRvUmVkby5DZWxsQWxpZ25tZW50QWN0aW9uKGUsbixvLHIpO3QuZG9uZShpKX0pfSxIYW5kc29udGFibGUuVW5kb1JlZG8ucHJvdG90eXBlLmRvbmU9ZnVuY3Rpb24oZSl7dGhpcy5pZ25vcmVOZXdBY3Rpb25zfHwodGhpcy5kb25lQWN0aW9ucy5wdXNoKGUpLHRoaXMudW5kb25lQWN0aW9ucy5sZW5ndGg9MCl9LEhhbmRzb250YWJsZS5VbmRvUmVkby5wcm90b3R5cGUudW5kbz1mdW5jdGlvbigpe2lmKHRoaXMuaXNVbmRvQXZhaWxhYmxlKCkpe3ZhciBlPXRoaXMuZG9uZUFjdGlvbnMucG9wKCk7dGhpcy5pZ25vcmVOZXdBY3Rpb25zPSEwO3ZhciB0PXRoaXM7ZS51bmRvKHRoaXMuaW5zdGFuY2UsZnVuY3Rpb24oKXt0Lmlnbm9yZU5ld0FjdGlvbnM9ITEsdC51bmRvbmVBY3Rpb25zLnB1c2goZSl9KX19LEhhbmRzb250YWJsZS5VbmRvUmVkby5wcm90b3R5cGUucmVkbz1mdW5jdGlvbigpe2lmKHRoaXMuaXNSZWRvQXZhaWxhYmxlKCkpe3ZhciBlPXRoaXMudW5kb25lQWN0aW9ucy5wb3AoKTt0aGlzLmlnbm9yZU5ld0FjdGlvbnM9ITA7dmFyIHQ9dGhpcztlLnJlZG8odGhpcy5pbnN0YW5jZSxmdW5jdGlvbigpe3QuaWdub3JlTmV3QWN0aW9ucz0hMSx0LmRvbmVBY3Rpb25zLnB1c2goZSl9KX19LEhhbmRzb250YWJsZS5VbmRvUmVkby5wcm90b3R5cGUuaXNVbmRvQXZhaWxhYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZG9uZUFjdGlvbnMubGVuZ3RoPjB9LEhhbmRzb250YWJsZS5VbmRvUmVkby5wcm90b3R5cGUuaXNSZWRvQXZhaWxhYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMudW5kb25lQWN0aW9ucy5sZW5ndGg+MH0sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLnByb3RvdHlwZS5jbGVhcj1mdW5jdGlvbigpe3RoaXMuZG9uZUFjdGlvbnMubGVuZ3RoPTAsdGhpcy51bmRvbmVBY3Rpb25zLmxlbmd0aD0wfSxIYW5kc29udGFibGUuVW5kb1JlZG8uQWN0aW9uPWZ1bmN0aW9uKCl7fSxIYW5kc29udGFibGUuVW5kb1JlZG8uQWN0aW9uLnByb3RvdHlwZS51bmRvPWZ1bmN0aW9uKCl7fSxIYW5kc29udGFibGUuVW5kb1JlZG8uQWN0aW9uLnByb3RvdHlwZS5yZWRvPWZ1bmN0aW9uKCl7fSxIYW5kc29udGFibGUuVW5kb1JlZG8uQ2hhbmdlQWN0aW9uPWZ1bmN0aW9uKGUpe3RoaXMuY2hhbmdlcz1lfSxkKEhhbmRzb250YWJsZS5VbmRvUmVkby5DaGFuZ2VBY3Rpb24sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkFjdGlvbiksSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNoYW5nZUFjdGlvbi5wcm90b3R5cGUudW5kbz1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbj1oKHRoaXMuY2hhbmdlcyksbz1lLmNvdW50RW1wdHlSb3dzKCEwKSxyPWUuY291bnRFbXB0eUNvbHMoITApLGk9MCxzPW4ubGVuZ3RoO3M+aTtpKyspbltpXS5zcGxpY2UoMywxKTtlLmFkZEhvb2tPbmNlKCJhZnRlckNoYW5nZSIsdCksZS5zZXREYXRhQXRSb3dQcm9wKG4sbnVsbCxudWxsLCJ1bmRvIik7Zm9yKHZhciBpPTAscz1uLmxlbmd0aDtzPmk7aSsrKWUuZ2V0U2V0dGluZ3MoKS5taW5TcGFyZVJvd3MmJm5baV1bMF0rMStlLmdldFNldHRpbmdzKCkubWluU3BhcmVSb3dzPT09ZS5jb3VudFJvd3MoKSYmbz09ZS5nZXRTZXR0aW5ncygpLm1pblNwYXJlUm93cyYmKGUuYWx0ZXIoInJlbW92ZV9yb3ciLHBhcnNlSW50KG5baV1bMF0rMSwxMCksZS5nZXRTZXR0aW5ncygpLm1pblNwYXJlUm93cyksZS51bmRvUmVkby5kb25lQWN0aW9ucy5wb3AoKSksZS5nZXRTZXR0aW5ncygpLm1pblNwYXJlQ29scyYmbltpXVsxXSsxK2UuZ2V0U2V0dGluZ3MoKS5taW5TcGFyZUNvbHM9PT1lLmNvdW50Q29scygpJiZyPT1lLmdldFNldHRpbmdzKCkubWluU3BhcmVDb2xzJiYoZS5hbHRlcigicmVtb3ZlX2NvbCIscGFyc2VJbnQobltpXVsxXSsxLDEwKSxlLmdldFNldHRpbmdzKCkubWluU3BhcmVDb2xzKSxlLnVuZG9SZWRvLmRvbmVBY3Rpb25zLnBvcCgpKX0sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNoYW5nZUFjdGlvbi5wcm90b3R5cGUucmVkbz1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbj1oKHRoaXMuY2hhbmdlcyksbz0wLHI9bi5sZW5ndGg7cj5vO28rKyluW29dLnNwbGljZSgyLDEpO2UuYWRkSG9va09uY2UoImFmdGVyQ2hhbmdlIix0KSxlLnNldERhdGFBdFJvd1Byb3AobixudWxsLG51bGwsInJlZG8iKX0sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNyZWF0ZVJvd0FjdGlvbj1mdW5jdGlvbihlLHQpe3RoaXMuaW5kZXg9ZSx0aGlzLmFtb3VudD10fSxkKEhhbmRzb250YWJsZS5VbmRvUmVkby5DcmVhdGVSb3dBY3Rpb24sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkFjdGlvbiksSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNyZWF0ZVJvd0FjdGlvbi5wcm90b3R5cGUudW5kbz1mdW5jdGlvbihlLHQpe3ZhciBuPWUuY291bnRSb3dzKCksbz1lLmdldFNldHRpbmdzKCkubWluU3BhcmVSb3dzO3RoaXMuaW5kZXg+PW4mJnRoaXMuaW5kZXgtbzxuJiYodGhpcy5pbmRleC09byksZS5hZGRIb29rT25jZSgiYWZ0ZXJSZW1vdmVSb3ciLHQpLGUuYWx0ZXIoInJlbW92ZV9yb3ciLHRoaXMuaW5kZXgsdGhpcy5hbW91bnQpfSxIYW5kc29udGFibGUuVW5kb1JlZG8uQ3JlYXRlUm93QWN0aW9uLnByb3RvdHlwZS5yZWRvPWZ1bmN0aW9uKGUsdCl7ZS5hZGRIb29rT25jZSgiYWZ0ZXJDcmVhdGVSb3ciLHQpLGUuYWx0ZXIoImluc2VydF9yb3ciLHRoaXMuaW5kZXgrMSx0aGlzLmFtb3VudCl9LEhhbmRzb250YWJsZS5VbmRvUmVkby5SZW1vdmVSb3dBY3Rpb249ZnVuY3Rpb24oZSx0KXt0aGlzLmluZGV4PWUsdGhpcy5kYXRhPXR9LGQoSGFuZHNvbnRhYmxlLlVuZG9SZWRvLlJlbW92ZVJvd0FjdGlvbixIYW5kc29udGFibGUuVW5kb1JlZG8uQWN0aW9uKSxIYW5kc29udGFibGUuVW5kb1JlZG8uUmVtb3ZlUm93QWN0aW9uLnByb3RvdHlwZS51bmRvPWZ1bmN0aW9uKGUsdCl7dmFyIG49W3RoaXMuaW5kZXgsMF07QXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkobix0aGlzLmRhdGEpLEFycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoZS5nZXRTb3VyY2VEYXRhKCksbiksZS5hZGRIb29rT25jZSgiYWZ0ZXJSZW5kZXIiLHQpLGUucmVuZGVyKCl9LEhhbmRzb250YWJsZS5VbmRvUmVkby5SZW1vdmVSb3dBY3Rpb24ucHJvdG90eXBlLnJlZG89ZnVuY3Rpb24oZSx0KXtlLmFkZEhvb2tPbmNlKCJhZnRlclJlbW92ZVJvdyIsdCksZS5hbHRlcigicmVtb3ZlX3JvdyIsdGhpcy5pbmRleCx0aGlzLmRhdGEubGVuZ3RoKX0sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNyZWF0ZUNvbHVtbkFjdGlvbj1mdW5jdGlvbihlLHQpe3RoaXMuaW5kZXg9ZSx0aGlzLmFtb3VudD10fSxkKEhhbmRzb250YWJsZS5VbmRvUmVkby5DcmVhdGVDb2x1bW5BY3Rpb24sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkFjdGlvbiksSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNyZWF0ZUNvbHVtbkFjdGlvbi5wcm90b3R5cGUudW5kbz1mdW5jdGlvbihlLHQpe2UuYWRkSG9va09uY2UoImFmdGVyUmVtb3ZlQ29sIix0KSxlLmFsdGVyKCJyZW1vdmVfY29sIix0aGlzLmluZGV4LHRoaXMuYW1vdW50KX0sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkNyZWF0ZUNvbHVtbkFjdGlvbi5wcm90b3R5cGUucmVkbz1mdW5jdGlvbihlLHQpe2UuYWRkSG9va09uY2UoImFmdGVyQ3JlYXRlQ29sIix0KSxlLmFsdGVyKCJpbnNlcnRfY29sIix0aGlzLmluZGV4KzEsdGhpcy5hbW91bnQpfSxIYW5kc29udGFibGUuVW5kb1JlZG8uQ2VsbEFsaWdubWVudEFjdGlvbj1mdW5jdGlvbihlLHQsbixvKXt0aGlzLnN0YXRlQmVmb3JlPWUsdGhpcy5yYW5nZT10LHRoaXMudHlwZT1uLHRoaXMuYWxpZ25tZW50PW99LEhhbmRzb250YWJsZS5VbmRvUmVkby5DZWxsQWxpZ25tZW50QWN0aW9uLnByb3RvdHlwZS51bmRvPWZ1bmN0aW9uKGUsdCl7aWYoZS5nZXRQbHVnaW4oImNvbnRleHRNZW51IikuaXNFbmFibGVkKCkpe2Zvcih2YXIgbj10aGlzLnJhbmdlLmZyb20ucm93O248PXRoaXMucmFuZ2UudG8ucm93O24rKylmb3IodmFyIG89dGhpcy5yYW5nZS5mcm9tLmNvbDtvPD10aGlzLnJhbmdlLnRvLmNvbDtvKyspZS5zZXRDZWxsTWV0YShuLG8sImNsYXNzTmFtZSIsdGhpcy5zdGF0ZUJlZm9yZVtuXVtvXXx8IiBodExlZnQiKTtlLmFkZEhvb2tPbmNlKCJhZnRlclJlbmRlciIsdCksZS5yZW5kZXIoKX19LEhhbmRzb250YWJsZS5VbmRvUmVkby5DZWxsQWxpZ25tZW50QWN0aW9uLnByb3RvdHlwZS5yZWRvPWZ1bmN0aW9uKGUsdCl7ZS5nZXRQbHVnaW4oImNvbnRleHRNZW51IikuaXNFbmFibGVkKCkmJihlLnNlbGVjdENlbGwodGhpcy5yYW5nZS5mcm9tLnJvdyx0aGlzLnJhbmdlLmZyb20uY29sLHRoaXMucmFuZ2UudG8ucm93LHRoaXMucmFuZ2UudG8uY29sKSxlLmdldFBsdWdpbigiY29udGV4dE1lbnUiKS5leGVjdXRlQ29tbWFuZCgiYWxpZ25tZW50OiIrdGhpcy5hbGlnbm1lbnQucmVwbGFjZSgiaHQiLCIiKS50b0xvd2VyQ2FzZSgpKSxlLmFkZEhvb2tPbmNlKCJhZnRlclJlbmRlciIsdCksZS5yZW5kZXIoKSl9LEhhbmRzb250YWJsZS5VbmRvUmVkby5SZW1vdmVDb2x1bW5BY3Rpb249ZnVuY3Rpb24oZSx0LG4pe3RoaXMuaW5kZXg9ZSx0aGlzLmRhdGE9dCx0aGlzLmFtb3VudD10aGlzLmRhdGFbMF0ubGVuZ3RoLHRoaXMuaGVhZGVycz1ufSxkKEhhbmRzb250YWJsZS5VbmRvUmVkby5SZW1vdmVDb2x1bW5BY3Rpb24sSGFuZHNvbnRhYmxlLlVuZG9SZWRvLkFjdGlvbiksSGFuZHNvbnRhYmxlLlVuZG9SZWRvLlJlbW92ZUNvbHVtbkFjdGlvbi5wcm90b3R5cGUudW5kbz1mdW5jdGlvbihlLHQpe2Zvcih2YXIgbixvLHI9MCxpPWUuZ2V0U291cmNlRGF0YSgpLmxlbmd0aDtpPnI7cisrKW49ZS5nZXRTb3VyY2VEYXRhQXRSb3cociksbz1bdGhpcy5pbmRleCwwXSxBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShvLHRoaXMuZGF0YVtyXSksQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShuLG8pOyJ1bmRlZmluZWQiIT10eXBlb2YgdGhpcy5oZWFkZXJzJiYobz1bdGhpcy5pbmRleCwwXSxBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShvLHRoaXMuaGVhZGVycyksQXJyYXkucHJvdG90eXBlLnNwbGljZS5hcHBseShlLmdldFNldHRpbmdzKCkuY29sSGVhZGVycyxvKSksZS5hZGRIb29rT25jZSgiYWZ0ZXJSZW5kZXIiLHQpLGUucmVuZGVyKCl9LEhhbmRzb250YWJsZS5VbmRvUmVkby5SZW1vdmVDb2x1bW5BY3Rpb24ucHJvdG90eXBlLnJlZG89ZnVuY3Rpb24oZSx0KXtlLmFkZEhvb2tPbmNlKCJhZnRlclJlbW92ZUNvbCIsdCksZS5hbHRlcigicmVtb3ZlX2NvbCIsdGhpcy5pbmRleCx0aGlzLmFtb3VudCl9LEhhbmRzb250YWJsZS5ob29rcy5hZGQoImFmdGVySW5pdCIsbyksSGFuZHNvbnRhYmxlLmhvb2tzLmFkZCgiYWZ0ZXJVcGRhdGVTZXR0aW5ncyIsbyl9LHsiaGVscGVycy9kb20vZXZlbnQiOjQ2LCJoZWxwZXJzL29iamVjdCI6NTB9XSw4ODpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUsdCl7dmFyIG47bFtlXT10LG49YShlKSsiUmVuZGVyZXIiLEhhbmRzb250YWJsZS5yZW5kZXJlcnNbbl09dCxIYW5kc29udGFibGVbbl09dH1mdW5jdGlvbiByKGUpe2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlKXJldHVybiBlO2lmKCJzdHJpbmciIT10eXBlb2YgZSl0aHJvdyBFcnJvcignT25seSBzdHJpbmdzIGFuZCBmdW5jdGlvbnMgY2FuIGJlIHBhc3NlZCBhcyAicmVuZGVyZXIiIHBhcmFtZXRlcicpO2lmKCEoZSBpbiBsKSl0aHJvdyBFcnJvcignTm8gZWRpdG9yIHJlZ2lzdGVyZWQgdW5kZXIgbmFtZSAiJytlKyciJyk7cmV0dXJuIGxbZV19ZnVuY3Rpb24gaShlKXtyZXR1cm4gZSBpbiBsfU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se3JlZ2lzdGVyUmVuZGVyZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sZ2V0UmVuZGVyZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiByfX0saGFzUmVuZGVyZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBpfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHMsYT0ocz1lKCJoZWxwZXJzL3N0cmluZyIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSkudG9VcHBlckNhc2VGaXJzdCxsPXt9O0hhbmRzb250YWJsZS5yZW5kZXJlcnM9SGFuZHNvbnRhYmxlLnJlbmRlcmVyc3x8e30sSGFuZHNvbnRhYmxlLnJlbmRlcmVycy5yZWdpc3RlclJlbmRlcmVyPW8sSGFuZHNvbnRhYmxlLnJlbmRlcmVycy5nZXRSZW5kZXJlcj1yfSx7ImhlbHBlcnMvc3RyaW5nIjo1Mn1dLDg5OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSx0LG4sbyxyLGkscyl7cy5jbGFzc05hbWUmJih0LmNsYXNzTmFtZT90LmNsYXNzTmFtZT10LmNsYXNzTmFtZSsiICIrcy5jbGFzc05hbWU6dC5jbGFzc05hbWU9cy5jbGFzc05hbWUpLHMucmVhZE9ubHkmJmEodCxzLnJlYWRPbmx5Q2VsbENsYXNzTmFtZSkscy52YWxpZD09PSExJiZzLmludmFsaWRDZWxsQ2xhc3NOYW1lP2EodCxzLmludmFsaWRDZWxsQ2xhc3NOYW1lKTpsKHQscy5pbnZhbGlkQ2VsbENsYXNzTmFtZSkscy53b3JkV3JhcD09PSExJiZzLm5vV29yZFdyYXBDbGFzc05hbWUmJmEodCxzLm5vV29yZFdyYXBDbGFzc05hbWUpLCFpJiZzLnBsYWNlaG9sZGVyJiZhKHQscy5wbGFjZWhvbGRlckNlbGxDbGFzc05hbWUpfU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se2NlbGxEZWNvcmF0b3I6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzPShyPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLGE9cy5hZGRDbGFzcyxsPXMucmVtb3ZlQ2xhc3MsdT0oaT1lKCJyZW5kZXJlcnMiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLnJlZ2lzdGVyUmVuZGVyZXI7dSgiYmFzZSIsbyksSGFuZHNvbnRhYmxlLnJlbmRlcmVycy5jZWxsRGVjb3JhdG9yPW99LHsiaGVscGVycy9kb20vZWxlbWVudCI6NDUscmVuZGVyZXJzOjg4fV0sOTA6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQsbixvLHIsaSxzKXt2YXIgYT0obS5jbG9uZU5vZGUoITApLHYuY2xvbmVOb2RlKCEwKSk7aWYoZigidGV4dCIpKGUsdCxuLG8scixpLHMpLHQuYXBwZW5kQ2hpbGQoYSksdSh0LCJodEF1dG9jb21wbGV0ZSIpLHQuZmlyc3RDaGlsZHx8dC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShTdHJpbmcuZnJvbUNoYXJDb2RlKDE2MCkpKSwhZS5hY0Fycm93TGlzdGVuZXIpe3ZhciBsPWQoZSk7ZS5hY0Fycm93TGlzdGVuZXI9ZnVuY3Rpb24ocil7YyhyLnRhcmdldCwiaHRBdXRvY29tcGxldGVBcnJvdyIpJiZlLnZpZXcud3QuZ2V0U2V0dGluZygib25DZWxsRGJsQ2xpY2siLG51bGwsbmV3IGcobixvKSx0KX0sbC5hZGRFdmVudExpc3RlbmVyKGUucm9vdEVsZW1lbnQsIm1vdXNlZG93biIsZS5hY0Fycm93TGlzdGVuZXIpLGUuYWRkSG9va09uY2UoImFmdGVyRGVzdHJveSIsZnVuY3Rpb24oKXtsLmRlc3Ryb3koKX0pfX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHthdXRvY29tcGxldGVSZW5kZXJlcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgcixpLHMsYSxsPShyPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLHU9bC5hZGRDbGFzcyxjPWwuaGFzQ2xhc3MsZD0obC5lbXB0eSwoaT1lKCJldmVudE1hbmFnZXIiKSxpJiZpLl9fZXNNb2R1bGUmJml8fHsiZGVmYXVsdCI6aX0pLmV2ZW50TWFuYWdlciksaD0ocz1lKCJyZW5kZXJlcnMiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLGY9aC5nZXRSZW5kZXJlcixwPWgucmVnaXN0ZXJSZW5kZXJlcixnPShhPWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jZWxsL2Nvb3JkcyIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSkuV2Fsa29udGFibGVDZWxsQ29vcmRzLG09ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7bS5jbGFzc05hbWU9Imh0QXV0b2NvbXBsZXRlV3JhcHBlciI7dmFyIHY9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiRElWIik7di5jbGFzc05hbWU9Imh0QXV0b2NvbXBsZXRlQXJyb3ciLHYuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoU3RyaW5nLmZyb21DaGFyQ29kZSg5NjYwKSkpO3AoImF1dG9jb21wbGV0ZSIsbyl9LHsiM3JkcGFydHkvd2Fsa29udGFibGUvc3JjL2NlbGwvY29vcmRzIjo1LGV2ZW50TWFuYWdlcjo0MSwiaGVscGVycy9kb20vZWxlbWVudCI6NDUscmVuZGVyZXJzOjg4fV0sOTE6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQsbixvLGEsbCx1KXtmdW5jdGlvbiBjKGUpe3ZhciB0PVtDLlNQQUNFLEMuRU5URVIsQy5ERUxFVEUsQy5CQUNLU1BBQ0VdOy0xPT09dC5pbmRleE9mKGUua2V5Q29kZSl8fEUoZSl8fGYoZnVuY3Rpb24oKXtTKGUpLGUucHJldmVudERlZmF1bHQoKX0pLChlLmtleUNvZGU9PUMuU1BBQ0V8fGUua2V5Q29kZT09Qy5FTlRFUikmJmQoKSwoZS5rZXlDb2RlPT1DLkRFTEVURXx8ZS5rZXlDb2RlPT1DLkJBQ0tTUEFDRSkmJmQoITEpfWZ1bmN0aW9uIGQoKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOm51bGw7ZihmdW5jdGlvbih0KXtmb3IodmFyIG49MCxvPXQubGVuZ3RoO28+bjtuKyspe2lmKG0odFtuXSxPKSYmbnVsbD09PWUpcmV0dXJuO2godFtuXSxlKX19KX1mdW5jdGlvbiBoKGUpe3ZhciB0PXZvaWQgMCE9PWFyZ3VtZW50c1sxXT9hcmd1bWVudHNbMV06bnVsbDtudWxsPT09dD9lLmNoZWNrZWQ9IWUuY2hlY2tlZDplLmNoZWNrZWQ9dCx5LmZpcmVFdmVudChlLCJjaGFuZ2UiKX1mdW5jdGlvbiBmKHQpe2Zvcih2YXIgbj1lLmdldFNlbGVjdGVkUmFuZ2UoKSxvPW4uZ2V0VG9wTGVmdENvcm5lcigpLHI9bi5nZXRCb3R0b21SaWdodENvcm5lcigpLGk9by5yb3c7aTw9ci5yb3c7aSsrKWZvcih2YXIgcz1vLmNvbDtzPD1yLmNvbDtzKyspe3ZhciBhPWUuZ2V0Q2VsbChpLHMpLGw9ZS5nZXRDZWxsTWV0YShpLHMpLHU9YS5xdWVyeVNlbGVjdG9yQWxsKCJpbnB1dFt0eXBlPWNoZWNrYm94XSIpO3UubGVuZ3RoPjAmJiFsLnJlYWRPbmx5JiZ0KHUpfX12YXIgeT1uZXcgdyhlKSxiPXIoKSxSPXUubGFiZWwsTT0hMTtpZigidW5kZWZpbmVkIj09dHlwZW9mIHUuY2hlY2tlZFRlbXBsYXRlJiYodS5jaGVja2VkVGVtcGxhdGU9ITApLCJ1bmRlZmluZWQiPT10eXBlb2YgdS51bmNoZWNrZWRUZW1wbGF0ZSYmKHUudW5jaGVja2VkVGVtcGxhdGU9ITEpLHAodCksbD09PXUuY2hlY2tlZFRlbXBsYXRlfHx2KGwsdS5jaGVja2VkVGVtcGxhdGUpP2IuY2hlY2tlZD0hMDpsPT09dS51bmNoZWNrZWRUZW1wbGF0ZXx8dihsLHUudW5jaGVja2VkVGVtcGxhdGUpP2IuY2hlY2tlZD0hMTpudWxsPT09bD9nKGIsIm5vVmFsdWUiKTooYi5zdHlsZS5kaXNwbGF5PSJub25lIixnKGIsTyksTT0hMCksIU0mJlIpe3ZhciBrPSIiO1IudmFsdWU/az0iZnVuY3Rpb24iPT10eXBlb2YgUi52YWx1ZT9SLnZhbHVlLmNhbGwodGhpcyxuLG8sYSxsKTpSLnZhbHVlOlIucHJvcGVydHkmJihrPWUuZ2V0RGF0YUF0Um93UHJvcChuLFIucHJvcGVydHkpKTt2YXIgSD1pKGspOyJiZWZvcmUiPT09Ui5wb3NpdGlvbj9ILmFwcGVuZENoaWxkKGIpOkguaW5zZXJ0QmVmb3JlKGIsSC5maXJzdENoaWxkKSxiPUh9dC5hcHBlbmRDaGlsZChiKSxNJiZ0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCIjYmFkLXZhbHVlIyIpKSx1LnJlYWRPbmx5P3kuYWRkRXZlbnRMaXN0ZW5lcihiLCJjbGljayIscyk6KHkuYWRkRXZlbnRMaXN0ZW5lcihiLCJtb3VzZWRvd24iLF8pLHkuYWRkRXZlbnRMaXN0ZW5lcihiLCJtb3VzZXVwIixfKSx5LmFkZEV2ZW50TGlzdGVuZXIoYiwiY2hhbmdlIixmdW5jdGlvbih0KXtlLnNldERhdGFBdFJvd1Byb3AobixhLHQudGFyZ2V0LmNoZWNrZWQ/dS5jaGVja2VkVGVtcGxhdGU6dS51bmNoZWNrZWRUZW1wbGF0ZSl9KSksVC5oYXMoZSl8fChULnNldChlLCEwKSxlLmFkZEhvb2soImJlZm9yZUtleURvd24iLGMpKX1mdW5jdGlvbiByKCl7dmFyIGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTtyZXR1cm4gZS5jbGFzc05hbWU9Imh0Q2hlY2tib3hSZW5kZXJlcklucHV0IixlLnR5cGU9ImNoZWNrYm94IixlLnNldEF0dHJpYnV0ZSgiYXV0b2NvbXBsZXRlIiwib2ZmIiksZS5jbG9uZU5vZGUoITEpfWZ1bmN0aW9uIGkoZSl7dmFyIHQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgibGFiZWwiKTtyZXR1cm4gdC5jbGFzc05hbWU9Imh0Q2hlY2tib3hSZW5kZXJlckxhYmVsIix0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGUpKSx0LmNsb25lTm9kZSghMCl9ZnVuY3Rpb24gcyhlKXtlLnByZXZlbnREZWZhdWx0KCl9T2JqZWN0LmRlZmluZVByb3BlcnRpZXMobix7Y2hlY2tib3hSZW5kZXJlcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgYSxsLHUsYyxkLGgsZj0oYT1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KSxwPWYuZW1wdHksZz1mLmFkZENsYXNzLG09Zi5oYXNDbGFzcyx2PShsPWUoImhlbHBlcnMvc3RyaW5nIiksbCYmbC5fX2VzTW9kdWxlJiZsfHx7ImRlZmF1bHQiOmx9KS5lcXVhbHNJZ25vcmVDYXNlLHc9KHU9ZSgiZXZlbnRNYW5hZ2VyIiksdSYmdS5fX2VzTW9kdWxlJiZ1fHx7ImRlZmF1bHQiOnV9KS5FdmVudE1hbmFnZXIseT0oYz1lKCJyZW5kZXJlcnMiKSxjJiZjLl9fZXNNb2R1bGUmJmN8fHsiZGVmYXVsdCI6Y30pLGI9KHkuZ2V0UmVuZGVyZXIseS5yZWdpc3RlclJlbmRlcmVyKSxDPShkPWUoImhlbHBlcnMvdW5pY29kZSIpLGQmJmQuX19lc01vZHVsZSYmZHx8eyJkZWZhdWx0IjpkfSkuS0VZX0NPREVTLFI9KGg9ZSgiaGVscGVycy9kb20vZXZlbnQiKSxoJiZoLl9fZXNNb2R1bGUmJmh8fHsiZGVmYXVsdCI6aH0pLF89Ui5zdG9wUHJvcGFnYXRpb24sUz1SLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbixFPVIuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQsVD1uZXcgV2Vha01hcCxPPSJodEJhZFZhbHVlIjtiKCJjaGVja2JveCIsbyl9LHtldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDYsImhlbHBlcnMvc3RyaW5nIjo1MiwiaGVscGVycy91bmljb2RlIjo1MyxyZW5kZXJlcnM6ODh9XSw5MjpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUsdCxuLG8scixpLGEpe2woImJhc2UiKS5hcHBseSh0aGlzLGFyZ3VtZW50cykscyh0LGkpfU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se2h0bWxSZW5kZXJlcjp7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIG99fSxfX2VzTW9kdWxlOnt2YWx1ZTohMH19KTt2YXIgcixpLHM9KHI9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuZmFzdElubmVySFRNTCxhPShpPWUoInJlbmRlcmVycyIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSksbD1hLmdldFJlbmRlcmVyLHU9YS5yZWdpc3RlclJlbmRlcmVyO3UoImh0bWwiLG8pfSx7ImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LHJlbmRlcmVyczo4OH1dLDkzOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSx0LG4sbyxyLGkscyl7ZihpKSYmKCJ1bmRlZmluZWQiIT10eXBlb2Ygcy5sYW5ndWFnZSYmbC5sYW5ndWFnZShzLmxhbmd1YWdlKSxpPWwoaSkuZm9ybWF0KHMuZm9ybWF0fHwiMCIpLHUodCwiaHROdW1lcmljIikpLGQoInRleHQiKShlLHQsbixvLHIsaSxzKX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtudW1lcmljUmVuZGVyZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGEsbD0ocj1lKCJudW1lcmFsIiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KVsiZGVmYXVsdCJdLHU9KGk9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuYWRkQ2xhc3MsYz0ocz1lKCJyZW5kZXJlcnMiKSxzJiZzLl9fZXNNb2R1bGUmJnN8fHsiZGVmYXVsdCI6c30pLGQ9Yy5nZXRSZW5kZXJlcixoPWMucmVnaXN0ZXJSZW5kZXJlcixmPShhPWUoImhlbHBlcnMvbnVtYmVyIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5pc051bWVyaWM7aCgibnVtZXJpYyIsbyl9LHsiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvbnVtYmVyIjo0OSxudW1lcmFsOiJudW1lcmFsIixyZW5kZXJlcnM6ODgKfV0sOTQ6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQsbixvLHIsaSxhKXtsKCJ0ZXh0IikuYXBwbHkodGhpcyxhcmd1bWVudHMpLGk9dC5pbm5lckhUTUw7dmFyIHUsYz1hLmhhc2hMZW5ndGh8fGkubGVuZ3RoLGQ9YS5oYXNoU3ltYm9sfHwiKiI7Zm9yKHU9IiI7dS5zcGxpdChkKS5sZW5ndGgtMTxjO3UrPWQpO3ModCx1KX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtwYXNzd29yZFJlbmRlcmVyOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gb319LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciByLGkscz0ocj1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksciYmci5fX2VzTW9kdWxlJiZyfHx7ImRlZmF1bHQiOnJ9KS5mYXN0SW5uZXJIVE1MLGE9KGk9ZSgicmVuZGVyZXJzIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KSxsPWEuZ2V0UmVuZGVyZXIsdT1hLnJlZ2lzdGVyUmVuZGVyZXI7dSgicGFzc3dvcmQiLG8pfSx7ImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LHJlbmRlcmVyczo4OH1dLDk1OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG8oZSx0LG4sbyxyLGkscyl7aCgiYmFzZSIpLmFwcGx5KHRoaXMsYXJndW1lbnRzKSwhaSYmcy5wbGFjZWhvbGRlciYmKGk9cy5wbGFjZWhvbGRlcik7dmFyIGE9YyhpKTtpZihlLmdldFNldHRpbmdzKCkudHJpbVdoaXRlc3BhY2V8fChhPWEucmVwbGFjZSgvIC9nLFN0cmluZy5mcm9tQ2hhckNvZGUoMTYwKSkpLHMucmVuZGVyZXJUZW1wbGF0ZSl7bCh0KTt2YXIgZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJURU1QTEFURSIpO2Quc2V0QXR0cmlidXRlKCJiaW5kIiwie3t9fSIpLGQuaW5uZXJIVE1MPXMucmVuZGVyZXJUZW1wbGF0ZSxIVE1MVGVtcGxhdGVFbGVtZW50LmRlY29yYXRlKGQpLGQubW9kZWw9ZS5nZXRTb3VyY2VEYXRhQXRSb3cobiksdC5hcHBlbmRDaGlsZChkKX1lbHNlIHUodCxhKX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHt0ZXh0UmVuZGVyZXI6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGE9KHI9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksbD1hLmVtcHR5LHU9YS5mYXN0SW5uZXJUZXh0LGM9KGk9ZSgiaGVscGVycy9taXhlZCIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuc3RyaW5naWZ5LGQ9KHM9ZSgicmVuZGVyZXJzIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KSxoPWQuZ2V0UmVuZGVyZXIsZj1kLnJlZ2lzdGVyUmVuZGVyZXI7ZigidGV4dCIsbyl9LHsiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvbWl4ZWQiOjQ4LHJlbmRlcmVyczo4OH1dLDk2OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiOyFmdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUpe3JldHVybntjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMSx2YWx1ZTplLHdyaXRhYmxlOiEwfX1mdW5jdGlvbiBuKCl7cmV0dXJuIl9fJCIrTWF0aC5mbG9vcigxZTkqTWF0aC5yYW5kb20oKSkrIiQiKyArK1krIiRfXyJ9ZnVuY3Rpb24gbyhlKXtyZXR1cm4gWFtlXX1mdW5jdGlvbiByKCl7dmFyIGU9bigpO3JldHVybiBYW2VdPSEwLGV9ZnVuY3Rpb24gaShlKXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIGUmJmUgaW5zdGFuY2VvZiBsfWZ1bmN0aW9uIHMoZSl7cmV0dXJuIGkoZSk/InN5bWJvbCI6dHlwZW9mIGV9ZnVuY3Rpb24gYShlKXt2YXIgdD1uZXcgbChlKTtpZighKHRoaXMgaW5zdGFuY2VvZiBhKSlyZXR1cm4gdDt0aHJvdyBuZXcgVHlwZUVycm9yKCJTeW1ib2wgY2Fubm90IGJlIG5ldydlZCIpfWZ1bmN0aW9uIGwoZSl7dmFyIHQ9bigpO1AodGhpcywkLHt2YWx1ZTp0aGlzfSksUCh0aGlzLFUse3ZhbHVlOnR9KSxQKHRoaXMsRyx7dmFsdWU6ZX0pLGModGhpcyksS1t0XT10aGlzfWZ1bmN0aW9uIHUoZSl7dmFyIHQ9ZVtxXTtyZXR1cm4gdCYmdC5zZWxmPT09ZT90OlYoZSk/KEouaGFzaC52YWx1ZT1RKyssSi5zZWxmLnZhbHVlPWUsWi52YWx1ZT14KG51bGwsSiksUChlLHEsWiksWi52YWx1ZSk6dm9pZCAwfWZ1bmN0aW9uIGMoZSl7cmV0dXJuIHUoZSksTi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZnVuY3Rpb24gZChlKXtyZXR1cm4gdShlKSxCLmFwcGx5KHRoaXMsYXJndW1lbnRzKX1mdW5jdGlvbiBoKGUpe3JldHVybiB1KGUpLEYuYXBwbHkodGhpcyxhcmd1bWVudHMpfWZ1bmN0aW9uIGYoZSl7cmV0dXJuIEtbZV18fFhbZV19ZnVuY3Rpb24gcChlKXtyZXR1cm4gaShlKT9lW1VdOmV9ZnVuY3Rpb24gZyhlKXtmb3IodmFyIHQ9W10sbj0wO248ZS5sZW5ndGg7bisrKWYoZVtuXSl8fHQucHVzaChlW25dKTtyZXR1cm4gdH1mdW5jdGlvbiBtKGUpe3JldHVybiBnKFcoZSkpfWZ1bmN0aW9uIHYoZSl7cmV0dXJuIGcoSShlKSl9ZnVuY3Rpb24gdyhlKXtmb3IodmFyIHQ9W10sbj1XKGUpLG89MDtvPG4ubGVuZ3RoO28rKyl7dmFyIHI9S1tuW29dXTtyJiZ0LnB1c2gocil9cmV0dXJuIHR9ZnVuY3Rpb24geShlLHQpe3JldHVybiBMKGUscCh0KSl9ZnVuY3Rpb24gYihlKXtyZXR1cm4gai5jYWxsKHRoaXMscChlKSl9ZnVuY3Rpb24gQyh0KXtyZXR1cm4gZS50cmFjZXVyJiZlLnRyYWNldXIub3B0aW9uc1t0XX1mdW5jdGlvbiBSKGUsdCxuKXtyZXR1cm4gaSh0KSYmKHQ9dFtVXSksUChlLHQsbiksZX1mdW5jdGlvbiBfKGUpe1AoZSwiZGVmaW5lUHJvcGVydHkiLHt2YWx1ZTpSfSksUChlLCJnZXRPd25Qcm9wZXJ0eU5hbWVzIix7dmFsdWU6bX0pLFAoZSwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIix7dmFsdWU6eX0pLFAoZS5wcm90b3R5cGUsImhhc093blByb3BlcnR5Iix7dmFsdWU6Yn0pLFAoZSwiZnJlZXplIix7dmFsdWU6Y30pLFAoZSwicHJldmVudEV4dGVuc2lvbnMiLHt2YWx1ZTpkfSksUChlLCJzZWFsIix7dmFsdWU6aH0pLFAoZSwia2V5cyIse3ZhbHVlOnZ9KX1mdW5jdGlvbiBTKGUpe2Zvcih2YXIgdD0xO3Q8YXJndW1lbnRzLmxlbmd0aDt0KyspZm9yKHZhciBuPVcoYXJndW1lbnRzW3RdKSxvPTA7bzxuLmxlbmd0aDtvKyspe3ZhciByPW5bb107ZihyKXx8IWZ1bmN0aW9uKHQsbil7UChlLG4se2dldDpmdW5jdGlvbigpe3JldHVybiB0W25dfSxlbnVtZXJhYmxlOiEwfSl9KGFyZ3VtZW50c1t0XSxuW29dKX1yZXR1cm4gZX1mdW5jdGlvbiBFKGUpe3JldHVybiBudWxsIT1lJiYoIm9iamVjdCI9PXR5cGVvZiBlfHwiZnVuY3Rpb24iPT10eXBlb2YgZSl9ZnVuY3Rpb24gVChlKXtpZihudWxsPT1lKXRocm93IEQoKTtyZXR1cm4gSChlKX1mdW5jdGlvbiBPKGUpe2lmKG51bGw9PWUpdGhyb3cgbmV3IFR5cGVFcnJvcigiVmFsdWUgY2Fubm90IGJlIGNvbnZlcnRlZCB0byBhbiBPYmplY3QiKTtyZXR1cm4gZX1mdW5jdGlvbiBNKGUsdCl7ZS5TeW1ib2x8fChlLlN5bWJvbD10LE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHM9dyksZS5TeW1ib2wuaXRlcmF0b3J8fChlLlN5bWJvbC5pdGVyYXRvcj10KCJTeW1ib2wuaXRlcmF0b3IiKSl9ZnVuY3Rpb24gayhlKXtNKGUsYSksZS5SZWZsZWN0PWUuUmVmbGVjdHx8e30sZS5SZWZsZWN0Lmdsb2JhbD1lLlJlZmxlY3QuZ2xvYmFsfHxlLF8oZS5PYmplY3QpfWlmKCFlLiR0cmFjZXVyUnVudGltZSl7dmFyIEg9T2JqZWN0LEQ9VHlwZUVycm9yLHg9SC5jcmVhdGUsQT1ILmRlZmluZVByb3BlcnRpZXMsUD1ILmRlZmluZVByb3BlcnR5LE49SC5mcmVlemUsTD1ILmdldE93blByb3BlcnR5RGVzY3JpcHRvcixXPUguZ2V0T3duUHJvcGVydHlOYW1lcyxJPUgua2V5cyxqPUgucHJvdG90eXBlLmhhc093blByb3BlcnR5LEI9T2JqZWN0LnByZXZlbnRFeHRlbnNpb25zLEY9T2JqZWN0LnNlYWwsVj1PYmplY3QuaXNFeHRlbnNpYmxlLHo9dCxZPTAsVT1uKCksRz1uKCksJD1uKCksSz14KG51bGwpLFg9eChudWxsKTtQKGEucHJvdG90eXBlLCJjb25zdHJ1Y3RvciIsdChhKSksUChhLnByb3RvdHlwZSwidG9TdHJpbmciLHooZnVuY3Rpb24oKXt2YXIgZT10aGlzWyRdO2lmKCFDKCJzeW1ib2xzIikpcmV0dXJuIGVbVV07aWYoIWUpdGhyb3cgVHlwZUVycm9yKCJDb252ZXJzaW9uIGZyb20gc3ltYm9sIHRvIHN0cmluZyIpO3ZhciB0PWVbR107cmV0dXJuIHZvaWQgMD09PXQmJih0PSIiKSwiU3ltYm9sKCIrdCsiKSJ9KSksUChhLnByb3RvdHlwZSwidmFsdWVPZiIseihmdW5jdGlvbigpe3ZhciBlPXRoaXNbJF07aWYoIWUpdGhyb3cgVHlwZUVycm9yKCJDb252ZXJzaW9uIGZyb20gc3ltYm9sIHRvIHN0cmluZyIpO3JldHVybiBDKCJzeW1ib2xzIik/ZTplW1VdfSkpLFAobC5wcm90b3R5cGUsImNvbnN0cnVjdG9yIix0KGEpKSxQKGwucHJvdG90eXBlLCJ0b1N0cmluZyIse3ZhbHVlOmEucHJvdG90eXBlLnRvU3RyaW5nLGVudW1lcmFibGU6ITF9KSxQKGwucHJvdG90eXBlLCJ2YWx1ZU9mIix7dmFsdWU6YS5wcm90b3R5cGUudmFsdWVPZixlbnVtZXJhYmxlOiExfSk7dmFyIHE9cigpLFo9e3ZhbHVlOnZvaWQgMH0sSj17aGFzaDp7dmFsdWU6dm9pZCAwfSxzZWxmOnt2YWx1ZTp2b2lkIDB9fSxRPTA7YyhsLnByb3RvdHlwZSksayhlKSxlLiR0cmFjZXVyUnVudGltZT17Y2hlY2tPYmplY3RDb2VyY2libGU6TyxjcmVhdGVQcml2YXRlTmFtZTpyLGRlZmluZVByb3BlcnRpZXM6QSxkZWZpbmVQcm9wZXJ0eTpQLGV4cG9ydFN0YXI6UyxnZXRPd25IYXNoT2JqZWN0OnUsZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOkwsZ2V0T3duUHJvcGVydHlOYW1lczpXLGlzT2JqZWN0OkUsaXNQcml2YXRlTmFtZTpvLGlzU3ltYm9sU3RyaW5nOmYsa2V5czpJLHNldHVwR2xvYmFsczprLHRvT2JqZWN0OlQsdG9Qcm9wZXJ0eTpwLCJ0eXBlb2YiOnN9fX0od2luZG93KSxmdW5jdGlvbigpe2Z1bmN0aW9uIGUoKXtmb3IodmFyIGUsbj1bXSxvPTAscj0wO3I8YXJndW1lbnRzLmxlbmd0aDtyKyspe3ZhciBpPSR0cmFjZXVyUnVudGltZS5jaGVja09iamVjdENvZXJjaWJsZShhcmd1bWVudHNbcl0pO2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBpW3QoU3ltYm9sLml0ZXJhdG9yKV0pdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IHNwcmVhZCBub24taXRlcmFibGUgb2JqZWN0LiIpO2Zvcih2YXIgcz1pW3QoU3ltYm9sLml0ZXJhdG9yKV0oKTshKGU9cy5uZXh0KCkpLmRvbmU7KW5bbysrXT1lLnZhbHVlfXJldHVybiBufXZhciB0PSR0cmFjZXVyUnVudGltZS50b1Byb3BlcnR5OyR0cmFjZXVyUnVudGltZS5zcHJlYWQ9ZX0oKSxmdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXt2YXIgbj1nKGUpO2Rve3ZhciBvPXAobix0KTtpZihvKXJldHVybiBvO249ZyhuKX13aGlsZShuKX1mdW5jdGlvbiB0KGUpe3JldHVybiBlLl9fcHJvdG9fX31mdW5jdGlvbiBuKGUsdCxuLHIpe3JldHVybiBvKGUsdCxuKS5hcHBseShlLHIpfWZ1bmN0aW9uIG8odCxuLG8pe3ZhciByPWUobixvKTtyZXR1cm4gcj9yLmdldD9yLmdldC5jYWxsKHQpOnIudmFsdWU6dm9pZCAwfWZ1bmN0aW9uIHIodCxuLG8scil7dmFyIGk9ZShuLG8pO2lmKGkmJmkuc2V0KXJldHVybiBpLnNldC5jYWxsKHQscikscjt0aHJvdyBjKCJzdXBlciBoYXMgbm8gc2V0dGVyICciK28rIicuIil9ZnVuY3Rpb24gaShlKXtmb3IodmFyIHQ9e30sbj13KGUpLG89MDtvPG4ubGVuZ3RoO28rKyl7dmFyIHI9bltvXTt0W3JdPXAoZSxyKX1mb3IodmFyIGk9eShlKSxvPTA7bzxpLmxlbmd0aDtvKyspe3ZhciBzPWlbb107dFttKHMpXT1wKGUsbShzKSl9cmV0dXJuIHR9ZnVuY3Rpb24gcyhlLHQsbixvKXtyZXR1cm4gZih0LCJjb25zdHJ1Y3RvciIse3ZhbHVlOmUsY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITEsd3JpdGFibGU6ITB9KSxhcmd1bWVudHMubGVuZ3RoPjM/KCJmdW5jdGlvbiI9PXR5cGVvZiBvJiYoZS5fX3Byb3RvX189byksZS5wcm90b3R5cGU9ZChhKG8pLGkodCkpKTplLnByb3RvdHlwZT10LGYoZSwicHJvdG90eXBlIix7Y29uZmlndXJhYmxlOiExLHdyaXRhYmxlOiExfSksaChlLGkobikpfWZ1bmN0aW9uIGEoZSl7aWYoImZ1bmN0aW9uIj09dHlwZW9mIGUpe3ZhciB0PWUucHJvdG90eXBlO2lmKHUodCk9PT10fHxudWxsPT09dClyZXR1cm4gZS5wcm90b3R5cGU7dGhyb3cgbmV3IGMoInN1cGVyIHByb3RvdHlwZSBtdXN0IGJlIGFuIE9iamVjdCBvciBudWxsIil9aWYobnVsbD09PWUpcmV0dXJuIG51bGw7dGhyb3cgbmV3IGMoIlN1cGVyIGV4cHJlc3Npb24gbXVzdCBlaXRoZXIgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLCBub3QgIit0eXBlb2YgZSsiLiIpfWZ1bmN0aW9uIGwoZSx0LG8pe251bGwhPT1nKHQpJiZuKGUsdCwiY29uc3RydWN0b3IiLG8pfXZhciB1PU9iamVjdCxjPVR5cGVFcnJvcixkPXUuY3JlYXRlLGg9JHRyYWNldXJSdW50aW1lLmRlZmluZVByb3BlcnRpZXMsZj0kdHJhY2V1clJ1bnRpbWUuZGVmaW5lUHJvcGVydHkscD0kdHJhY2V1clJ1bnRpbWUuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yLGc9T2JqZWN0LmdldFByb3RvdHlwZU9mLG09JHRyYWNldXJSdW50aW1lLnRvUHJvcGVydHksdj1PYmplY3Qsdz12LmdldE93blByb3BlcnR5TmFtZXMseT12LmdldE93blByb3BlcnR5U3ltYm9sczskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3M9cywkdHJhY2V1clJ1bnRpbWUuZGVmYXVsdFN1cGVyQ2FsbD1sLCR0cmFjZXVyUnVudGltZS5zdXBlckNhbGw9biwkdHJhY2V1clJ1bnRpbWUuc3VwZXJDb25zdHJ1Y3Rvcj10LCR0cmFjZXVyUnVudGltZS5zdXBlckdldD1vLCR0cmFjZXVyUnVudGltZS5zdXBlclNldD1yfSgpfSx7fV0sOTc6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlKXt2YXIgdD10aGlzO3RoaXMuZXZlbnRNYW5hZ2VyPWIoZSksdGhpcy5pbnN0YW5jZT1lLHRoaXMuc2V0dGluZ3M9ZS5nZXRTZXR0aW5ncygpLHRoaXMuc2VsZWN0aW9uTW91c2VEb3duPSExO3ZhciBuPWUucm9vdEVsZW1lbnQuZ2V0QXR0cmlidXRlKCJzdHlsZSIpO24mJmUucm9vdEVsZW1lbnQuc2V0QXR0cmlidXRlKCJkYXRhLW9yaWdpbmFsc3R5bGUiLG4pLGQoZS5yb290RWxlbWVudCwiaGFuZHNvbnRhYmxlIik7dmFyIG89ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiVEFCTEUiKTtkKG8sImh0Q29yZSIpLGUuZ2V0U2V0dGluZ3MoKS50YWJsZUNsYXNzTmFtZSYmZChvLGUuZ2V0U2V0dGluZ3MoKS50YWJsZUNsYXNzTmFtZSksdGhpcy5USEVBRD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUSEVBRCIpLG8uYXBwZW5kQ2hpbGQodGhpcy5USEVBRCksdGhpcy5UQk9EWT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJUQk9EWSIpLG8uYXBwZW5kQ2hpbGQodGhpcy5UQk9EWSksZS50YWJsZT1vLGUuY29udGFpbmVyLmluc2VydEJlZm9yZShvLGUuY29udGFpbmVyLmZpcnN0Q2hpbGQpLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIoZS5yb290RWxlbWVudCwibW91c2Vkb3duIixmdW5jdGlvbihlKXt0aGlzLnNlbGVjdGlvbk1vdXNlRG93bj0hMCx0LmlzVGV4dFNlbGVjdGlvbkFsbG93ZWQoZS50YXJnZXQpfHwoaSgpLGUucHJldmVudERlZmF1bHQoKSx3aW5kb3cuZm9jdXMoKSl9KSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGUucm9vdEVsZW1lbnQsIm1vdXNldXAiLGZ1bmN0aW9uKGUpe3RoaXMuc2VsZWN0aW9uTW91c2VEb3duPSExfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihlLnJvb3RFbGVtZW50LCJtb3VzZW1vdmUiLGZ1bmN0aW9uKGUpe3RoaXMuc2VsZWN0aW9uTW91c2VEb3duJiYhdC5pc1RleHRTZWxlY3Rpb25BbGxvd2VkKGUudGFyZ2V0KSYmKGkoKSxlLnByZXZlbnREZWZhdWx0KCkpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsImtleXVwIixmdW5jdGlvbih0KXtlLnNlbGVjdGlvbi5pc0luUHJvZ3Jlc3MoKSYmIXQuc2hpZnRLZXkmJmUuc2VsZWN0aW9uLmZpbmlzaCgpfSk7dmFyIHI7dGhpcy5pc01vdXNlRG93bj1mdW5jdGlvbigpe3JldHVybiByfSx0aGlzLmV2ZW50TWFuYWdlci5hZGRFdmVudExpc3RlbmVyKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwibW91c2V1cCIsZnVuY3Rpb24odCl7ZS5zZWxlY3Rpb24uaXNJblByb2dyZXNzKCkmJjE9PT10LndoaWNoJiZlLnNlbGVjdGlvbi5maW5pc2goKSxyPSExLHkoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCkmJmUudW5saXN0ZW4oKX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LCJtb3VzZWRvd24iLGZ1bmN0aW9uKG4pe3ZhciBvPW4udGFyZ2V0LGk9bi54fHxuLmNsaWVudFgscz1uLnl8fG4uY2xpZW50WTtpZighciYmZS5yb290RWxlbWVudCl7aWYobz09PWUudmlldy53dC53dFRhYmxlLmhvbGRlcil7dmFyIGE9ZygpO2lmKGRvY3VtZW50LmVsZW1lbnRGcm9tUG9pbnQoaSthLHMpIT09ZS52aWV3Lnd0Lnd0VGFibGUuaG9sZGVyfHxkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGkscythKSE9PWUudmlldy53dC53dFRhYmxlLmhvbGRlcilyZXR1cm59ZWxzZSBmb3IoO28hPT1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7KXtpZihudWxsPT09byl7aWYobi5pc1RhcmdldFdlYkNvbXBvbmVudClicmVhaztyZXR1cm59aWYobz09PWUucm9vdEVsZW1lbnQpcmV0dXJuO289by5wYXJlbnROb2RlfXQuc2V0dGluZ3Mub3V0c2lkZUNsaWNrRGVzZWxlY3RzP2UuZGVzZWxlY3RDZWxsKCk6ZS5kZXN0cm95RWRpdG9yKCl9fSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihvLCJzZWxlY3RzdGFydCIsZnVuY3Rpb24oZSl7dC5zZXR0aW5ncy5mcmFnbWVudFNlbGVjdGlvbnx8dyhlLnRhcmdldCl8fGUucHJldmVudERlZmF1bHQoKX0pO3ZhciBpPWZ1bmN0aW9uKCl7d2luZG93LmdldFNlbGVjdGlvbj93aW5kb3cuZ2V0U2VsZWN0aW9uKCkuZW1wdHk/d2luZG93LmdldFNlbGVjdGlvbigpLmVtcHR5KCk6d2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcyYmd2luZG93LmdldFNlbGVjdGlvbigpLnJlbW92ZUFsbFJhbmdlcygpOmRvY3VtZW50LnNlbGVjdGlvbiYmZG9jdW1lbnQuc2VsZWN0aW9uLmVtcHR5KCl9LHM9W25ldyBFKHtjbGFzc05hbWU6ImN1cnJlbnQiLGJvcmRlcjp7d2lkdGg6Mixjb2xvcjoiIzUyOTJGNyIsY29ybmVyVmlzaWJsZTpmdW5jdGlvbigpe3JldHVybiB0LnNldHRpbmdzLmZpbGxIYW5kbGUmJiF0LmlzQ2VsbEVkaXRlZCgpJiYhZS5zZWxlY3Rpb24uaXNNdWx0aXBsZSgpfSxtdWx0aXBsZVNlbGVjdGlvbkhhbmRsZXNWaXNpYmxlOmZ1bmN0aW9uKCl7cmV0dXJuIXQuaXNDZWxsRWRpdGVkKCkmJiFlLnNlbGVjdGlvbi5pc011bHRpcGxlKCl9fX0pLG5ldyBFKHtjbGFzc05hbWU6ImFyZWEiLGJvcmRlcjp7d2lkdGg6MSxjb2xvcjoiIzg5QUZGOSIsY29ybmVyVmlzaWJsZTpmdW5jdGlvbigpe3JldHVybiB0LnNldHRpbmdzLmZpbGxIYW5kbGUmJiF0LmlzQ2VsbEVkaXRlZCgpJiZlLnNlbGVjdGlvbi5pc011bHRpcGxlKCl9LG11bHRpcGxlU2VsZWN0aW9uSGFuZGxlc1Zpc2libGU6ZnVuY3Rpb24oKXtyZXR1cm4hdC5pc0NlbGxFZGl0ZWQoKSYmZS5zZWxlY3Rpb24uaXNNdWx0aXBsZSgpfX19KSxuZXcgRSh7Y2xhc3NOYW1lOiJoaWdobGlnaHQiLGhpZ2hsaWdodFJvd0NsYXNzTmFtZTp0LnNldHRpbmdzLmN1cnJlbnRSb3dDbGFzc05hbWUsaGlnaGxpZ2h0Q29sdW1uQ2xhc3NOYW1lOnQuc2V0dGluZ3MuY3VycmVudENvbENsYXNzTmFtZX0pLG5ldyBFKHtjbGFzc05hbWU6ImZpbGwiLGJvcmRlcjp7d2lkdGg6MSxjb2xvcjoicmVkIn19KV07cy5jdXJyZW50PXNbMF0scy5hcmVhPXNbMV0scy5oaWdobGlnaHQ9c1syXSxzLmZpbGw9c1szXTt2YXIgYT17ZGVidWc6ZnVuY3Rpb24oKXtyZXR1cm4gdC5zZXR0aW5ncy5kZWJ1Z30sZXh0ZXJuYWxSb3dDYWxjdWxhdG9yOnRoaXMuaW5zdGFuY2UuZ2V0UGx1Z2luKCJhdXRvUm93U2l6ZSIpJiZ0aGlzLmluc3RhbmNlLmdldFBsdWdpbigiYXV0b1Jvd1NpemUiKS5pc0VuYWJsZWQoKSx0YWJsZTpvLHN0cmV0Y2hIOnRoaXMuc2V0dGluZ3Muc3RyZXRjaEgsZGF0YTplLmdldERhdGFBdENlbGwsdG90YWxSb3dzOmZ1bmN0aW9uKCl7cmV0dXJuIGUuY291bnRSb3dzKCl9LHRvdGFsQ29sdW1uczpmdW5jdGlvbigpe3JldHVybiBlLmNvdW50Q29scygpfSxmaXhlZENvbHVtbnNMZWZ0OmZ1bmN0aW9uKCl7cmV0dXJuIHQuc2V0dGluZ3MuZml4ZWRDb2x1bW5zTGVmdH0sZml4ZWRSb3dzVG9wOmZ1bmN0aW9uKCl7cmV0dXJuIHQuc2V0dGluZ3MuZml4ZWRSb3dzVG9wfSxmaXhlZFJvd3NCb3R0b206ZnVuY3Rpb24oKXtyZXR1cm4gdC5zZXR0aW5ncy5maXhlZFJvd3NCb3R0b219LG1pblNwYXJlUm93czpmdW5jdGlvbigpe3JldHVybiB0LnNldHRpbmdzLm1pblNwYXJlUm93c30scmVuZGVyQWxsUm93czp0LnNldHRpbmdzLnJlbmRlckFsbFJvd3Mscm93SGVhZGVyczpmdW5jdGlvbigpe3ZhciBuPVtdO3JldHVybiBlLmhhc1Jvd0hlYWRlcnMoKSYmbi5wdXNoKGZ1bmN0aW9uKGUsbil7dC5hcHBlbmRSb3dIZWFkZXIoZSxuKX0pLEhhbmRzb250YWJsZS5ob29rcy5ydW4oZSwiYWZ0ZXJHZXRSb3dIZWFkZXJSZW5kZXJlcnMiLG4pLG59LGNvbHVtbkhlYWRlcnM6ZnVuY3Rpb24oKXt2YXIgbj1bXTtyZXR1cm4gZS5oYXNDb2xIZWFkZXJzKCkmJm4ucHVzaChmdW5jdGlvbihlLG4pe3QuYXBwZW5kQ29sSGVhZGVyKGUsbil9KSxIYW5kc29udGFibGUuaG9va3MucnVuKGUsImFmdGVyR2V0Q29sdW1uSGVhZGVyUmVuZGVyZXJzIixuKSxufSxjb2x1bW5XaWR0aDplLmdldENvbFdpZHRoLHJvd0hlaWdodDplLmdldFJvd0hlaWdodCxjZWxsUmVuZGVyZXI6ZnVuY3Rpb24oZSxuLG8pe3ZhciByPXQuaW5zdGFuY2UuY29sVG9Qcm9wKG4pLGk9dC5pbnN0YW5jZS5nZXRDZWxsTWV0YShlLG4pLHM9dC5pbnN0YW5jZS5nZXRDZWxsUmVuZGVyZXIoaSksYT10Lmluc3RhbmNlLmdldERhdGFBdFJvd1Byb3AoZSxyKTtzKHQuaW5zdGFuY2UsbyxlLG4scixhLGkpLEhhbmRzb250YWJsZS5ob29rcy5ydW4odC5pbnN0YW5jZSwiYWZ0ZXJSZW5kZXJlciIsbyxlLG4scixhLGkpfSxzZWxlY3Rpb25zOnMsaGlkZUJvcmRlck9uTW91c2VEb3duT3ZlcjpmdW5jdGlvbigpe3JldHVybiB0LnNldHRpbmdzLmZyYWdtZW50U2VsZWN0aW9ufSxvbkNlbGxNb3VzZURvd246ZnVuY3Rpb24obixvLGkscyl7dmFyIGEsbCx1PWkucGFyZW50Tm9kZSxjPXUucGFyZW50Tm9kZTtpZihlLmxpc3RlbigpLHQuYWN0aXZlV3Q9cyxyPSEwLEhhbmRzb250YWJsZS5ob29rcy5ydW4oZSwiYmVmb3JlT25DZWxsTW91c2VEb3duIixuLG8saSksZS5zZWxlY3Rpb24uc2V0U2VsZWN0ZWRIZWFkZXJzKCExLCExKSwhXyhuKSl7aWYoMj09PW4uYnV0dG9uJiZlLnNlbGVjdGlvbi5pbkluU2VsZWN0aW9uKG8pKTtlbHNlIG4uc2hpZnRLZXk/by5yb3c+PTAmJm8uY29sPj0wJiZlLnNlbGVjdGlvbi5zZXRSYW5nZUVuZChvKTooby5yb3c8MHx8by5jb2w8MCkmJihvLnJvdz49MHx8by5jb2w+PTApPyhvLnJvdzwwJiYoYT1jLmNoaWxkTm9kZXMubGVuZ3RoLUFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwoYy5jaGlsZE5vZGVzLHUpLTEsbD1lLmdldEhlYWRlckNvbHNwYW4oby5jb2wsYSksZS5zZWxlY3Rpb24uc2V0U2VsZWN0ZWRIZWFkZXJzKCExLCEwKSxlLnNlbGVjdENlbGwoMCxvLmNvbCxlLmNvdW50Um93cygpLTEsby5jb2wrTWF0aC5tYXgoMCxsLTEpKSksby5jb2w8MCYmKGUuc2VsZWN0aW9uLnNldFNlbGVjdGVkSGVhZGVycyghMCwhMSksZS5zZWxlY3RDZWxsKG8ucm93LDAsby5yb3csZS5jb3VudENvbHMoKS0xKSkpOihvLnJvdz1vLnJvdzwwPzA6by5yb3csby5jb2w9by5jb2w8MD8wOm8uY29sLGUuc2VsZWN0aW9uLnNldFJhbmdlU3RhcnQobykpO0hhbmRzb250YWJsZS5ob29rcy5ydW4oZSwiYWZ0ZXJPbkNlbGxNb3VzZURvd24iLG4sbyxpKSx0LmFjdGl2ZVd0PXQud3R9fSxvbkNlbGxNb3VzZU92ZXI6ZnVuY3Rpb24obixvLGkscyl7dC5hY3RpdmVXdD1zLG8ucm93Pj0wJiZvLmNvbD49MD9yJiZlLnNlbGVjdGlvbi5zZXRSYW5nZUVuZChvKTpyJiYoby5yb3c8MCYmKGUuc2VsZWN0aW9uLnNlbGVjdGVkSGVhZGVyLmNvbHM/KGUuc2VsZWN0aW9uLnNldFJhbmdlRW5kKG5ldyBTKGUuY291bnRSb3dzKCktMSxvLmNvbCkpLGUuc2VsZWN0aW9uLnNldFNlbGVjdGVkSGVhZGVycyghMSwhMCkpOmUuc2VsZWN0aW9uLnNldFJhbmdlRW5kKG5ldyBTKG8ucm93LG8uY29sKSkpLG8uY29sPDAmJihlLnNlbGVjdGlvbi5zZWxlY3RlZEhlYWRlci5yb3dzPyhlLnNlbGVjdGlvbi5zZXRSYW5nZUVuZChuZXcgUyhvLnJvdyxlLmNvdW50Q29scygpLTEpKSxlLnNlbGVjdGlvbi5zZXRTZWxlY3RlZEhlYWRlcnMoITAsITEpKTplLnNlbGVjdGlvbi5zZXRSYW5nZUVuZChuZXcgUyhvLnJvdyxvLmNvbCkpKSksSGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihlLCJhZnRlck9uQ2VsbE1vdXNlT3ZlciIsbixvLGkpLHQuYWN0aXZlV3Q9dC53dH0sb25DZWxsQ29ybmVyTW91c2VEb3duOmZ1bmN0aW9uKHQpe3QucHJldmVudERlZmF1bHQoKSxIYW5kc29udGFibGUuaG9va3MucnVuKGUsImFmdGVyT25DZWxsQ29ybmVyTW91c2VEb3duIix0KX0sYmVmb3JlRHJhdzpmdW5jdGlvbihlKXt0LmJlZm9yZVJlbmRlcihlKX0sb25EcmF3OmZ1bmN0aW9uKGUpe3Qub25EcmF3KGUpfSxvblNjcm9sbFZlcnRpY2FsbHk6ZnVuY3Rpb24oKXtlLnJ1bkhvb2tzKCJhZnRlclNjcm9sbFZlcnRpY2FsbHkiKX0sb25TY3JvbGxIb3Jpem9udGFsbHk6ZnVuY3Rpb24oKXtlLnJ1bkhvb2tzKCJhZnRlclNjcm9sbEhvcml6b250YWxseSIpfSxvbkJlZm9yZURyYXdCb3JkZXJzOmZ1bmN0aW9uKHQsbil7ZS5ydW5Ib29rcygiYmVmb3JlRHJhd0JvcmRlcnMiLHQsbil9LG9uQmVmb3JlVG91Y2hTY3JvbGw6ZnVuY3Rpb24oKXtlLnJ1bkhvb2tzKCJiZWZvcmVUb3VjaFNjcm9sbCIpfSxvbkFmdGVyTW9tZW50dW1TY3JvbGw6ZnVuY3Rpb24oKXtlLnJ1bkhvb2tzKCJhZnRlck1vbWVudHVtU2Nyb2xsIil9LHZpZXdwb3J0Um93Q2FsY3VsYXRvck92ZXJyaWRlOmZ1bmN0aW9uKG4pe3ZhciBvPWUuY291bnRSb3dzKCkscj10LnNldHRpbmdzLnZpZXdwb3J0Um93UmVuZGVyaW5nT2Zmc2V0O2lmKCJhdXRvIj09PXImJnQuc2V0dGluZ3MuZml4ZWRSb3dzVG9wJiYocj0xMCksIm51bWJlciI9PXR5cGVvZiByJiYobi5zdGFydFJvdz1NYXRoLm1heChuLnN0YXJ0Um93LXIsMCksbi5lbmRSb3c9TWF0aC5taW4obi5lbmRSb3crcixvLTEpKSwiYXV0byI9PT1yKXt2YXIgaT1uLnN0YXJ0Um93K24uZW5kUm93LW4uc3RhcnRSb3cscz1NYXRoLmNlaWwoaS9vKjEyKTtuLnN0YXJ0Um93PU1hdGgubWF4KG4uc3RhcnRSb3ctcywwKSxuLmVuZFJvdz1NYXRoLm1pbihuLmVuZFJvdytzLG8tMSl9ZS5ydW5Ib29rcygiYWZ0ZXJWaWV3cG9ydFJvd0NhbGN1bGF0b3JPdmVycmlkZSIsbil9LHZpZXdwb3J0Q29sdW1uQ2FsY3VsYXRvck92ZXJyaWRlOmZ1bmN0aW9uKG4pe3ZhciBvPWUuY291bnRDb2xzKCkscj10LnNldHRpbmdzLnZpZXdwb3J0Q29sdW1uUmVuZGVyaW5nT2Zmc2V0O2lmKCJhdXRvIj09PXImJnQuc2V0dGluZ3MuZml4ZWRDb2x1bW5zTGVmdCYmKHI9MTApLCJudW1iZXIiPT10eXBlb2YgciYmKG4uc3RhcnRDb2x1bW49TWF0aC5tYXgobi5zdGFydENvbHVtbi1yLDApLG4uZW5kQ29sdW1uPU1hdGgubWluKG4uZW5kQ29sdW1uK3Isby0xKSksImF1dG8iPT09cil7dmFyIGk9bi5zdGFydENvbHVtbituLmVuZENvbHVtbi1uLnN0YXJ0Q29sdW1uLHM9TWF0aC5jZWlsKGkvbyoxMik7bi5zdGFydFJvdz1NYXRoLm1heChuLnN0YXJ0Q29sdW1uLXMsMCksbi5lbmRDb2x1bW49TWF0aC5taW4obi5lbmRDb2x1bW4rcyxvLTEpfWUucnVuSG9va3MoImFmdGVyVmlld3BvcnRDb2x1bW5DYWxjdWxhdG9yT3ZlcnJpZGUiLG4pfX07SGFuZHNvbnRhYmxlLmhvb2tzLnJ1bihlLCJiZWZvcmVJbml0V2Fsa29udGFibGUiLGEpLHRoaXMud3Q9bmV3IFQoYSksdGhpcy5hY3RpdmVXdD10aGlzLnd0LHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodC53dC53dFRhYmxlLnNwcmVhZGVyLCJtb3VzZWRvd24iLGZ1bmN0aW9uKGUpe2UudGFyZ2V0PT09dC53dC53dFRhYmxlLnNwcmVhZGVyJiYzPT09ZS53aGljaCYmUihlKX0pLHRoaXMuZXZlbnRNYW5hZ2VyLmFkZEV2ZW50TGlzdGVuZXIodC53dC53dFRhYmxlLnNwcmVhZGVyLCJjb250ZXh0bWVudSIsZnVuY3Rpb24oZSl7ZS50YXJnZXQ9PT10Lnd0Lnd0VGFibGUuc3ByZWFkZXImJjM9PT1lLndoaWNoJiZSKGUpfSksdGhpcy5ldmVudE1hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lcihkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsImNsaWNrIixmdW5jdGlvbigpe3Quc2V0dGluZ3Mub2JzZXJ2ZURPTVZpc2liaWxpdHkmJnQud3QuZHJhd0ludGVycnVwdGVkJiYodC5pbnN0YW5jZS5mb3JjZUZ1bGxSZW5kZXI9ITAsdC5yZW5kZXIoKSl9KX1PYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtUYWJsZVZpZXc6e2dldDpmdW5jdGlvbigpe3JldHVybiBvfX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGEsbCx1LGM9KHI9ZSgiaGVscGVycy9kb20vZWxlbWVudCIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSksZD1jLmFkZENsYXNzLGg9Yy5lbXB0eSxmPWMuZmFzdElubmVySFRNTCxwPWMuZmFzdElubmVyVGV4dCxnPWMuZ2V0U2Nyb2xsYmFyV2lkdGgsbT1jLmhhc0NsYXNzLHY9Yy5pc0NoaWxkT2Ysdz1jLmlzSW5wdXQseT1jLmlzT3V0c2lkZUlucHV0LGI9KGk9ZSgiZXZlbnRNYW5hZ2VyIiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5ldmVudE1hbmFnZXIsQz0ocz1lKCJoZWxwZXJzL2RvbS9ldmVudCIpLHMmJnMuX19lc01vZHVsZSYmc3x8eyJkZWZhdWx0IjpzfSksUj1DLnN0b3BQcm9wYWdhdGlvbixfPUMuaXNJbW1lZGlhdGVQcm9wYWdhdGlvblN0b3BwZWQsUz0oYT1lKCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiKSxhJiZhLl9fZXNNb2R1bGUmJmF8fHsiZGVmYXVsdCI6YX0pLldhbGtvbnRhYmxlQ2VsbENvb3JkcyxFPShsPWUoIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9zZWxlY3Rpb24iKSxsJiZsLl9fZXNNb2R1bGUmJmx8fHsiZGVmYXVsdCI6bH0pLldhbGtvbnRhYmxlU2VsZWN0aW9uLFQ9KHU9ZSgiM3JkcGFydHkvd2Fsa29udGFibGUvc3JjL2NvcmUiKSx1JiZ1Ll9fZXNNb2R1bGUmJnV8fHsiZGVmYXVsdCI6dX0pLldhbGtvbnRhYmxlO0hhbmRzb250YWJsZS5UYWJsZVZpZXc9byxvLnByb3RvdHlwZS5pc1RleHRTZWxlY3Rpb25BbGxvd2VkPWZ1bmN0aW9uKGUpe2lmKHcoZSkpcmV0dXJuITA7dmFyIHQ9dihlLHRoaXMuaW5zdGFuY2Uudmlldy53dC53dFRhYmxlLnNwcmVhZGVyKTtyZXR1cm4gdGhpcy5zZXR0aW5ncy5mcmFnbWVudFNlbGVjdGlvbj09PSEwJiZ0PyEwOiJjZWxsIj09PXRoaXMuc2V0dGluZ3MuZnJhZ21lbnRTZWxlY3Rpb24mJnRoaXMuaXNTZWxlY3RlZE9ubHlDZWxsKCkmJnQ/ITA6ITF9LG8ucHJvdG90eXBlLmlzU2VsZWN0ZWRPbmx5Q2VsbD1mdW5jdGlvbigpe3ZhciBlPXRoaXMuaW5zdGFuY2UuZ2V0U2VsZWN0ZWQoKXx8W10sdD1lWzBdLG49ZVsxXSxvPWVbMl0scj1lWzNdO3JldHVybiB2b2lkIDAhPT10JiZ0PT09byYmbj09PXJ9LG8ucHJvdG90eXBlLmlzQ2VsbEVkaXRlZD1mdW5jdGlvbigpe3ZhciBlPXRoaXMuaW5zdGFuY2UuZ2V0QWN0aXZlRWRpdG9yKCk7cmV0dXJuIGUmJmUuaXNPcGVuZWQoKX0sby5wcm90b3R5cGUuYmVmb3JlUmVuZGVyPWZ1bmN0aW9uKGUpe2UmJkhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5pbnN0YW5jZSwiYmVmb3JlUmVuZGVyIix0aGlzLmluc3RhbmNlLmZvcmNlRnVsbFJlbmRlcil9LG8ucHJvdG90eXBlLm9uRHJhdz1mdW5jdGlvbihlKXtlJiZIYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaW5zdGFuY2UsImFmdGVyUmVuZGVyIix0aGlzLmluc3RhbmNlLmZvcmNlRnVsbFJlbmRlcil9LG8ucHJvdG90eXBlLnJlbmRlcj1mdW5jdGlvbigpe3RoaXMud3QuZHJhdyghdGhpcy5pbnN0YW5jZS5mb3JjZUZ1bGxSZW5kZXIpLHRoaXMuaW5zdGFuY2UuZm9yY2VGdWxsUmVuZGVyPSExLHRoaXMuaW5zdGFuY2UucmVuZGVyQ2FsbD0hMX0sby5wcm90b3R5cGUuZ2V0Q2VsbEF0Q29vcmRzPWZ1bmN0aW9uKGUsdCl7dmFyIG49dGhpcy53dC5nZXRDZWxsKGUsdCk7cmV0dXJuIDA+bj9udWxsOm59LG8ucHJvdG90eXBlLnNjcm9sbFZpZXdwb3J0PWZ1bmN0aW9uKGUpe3RoaXMud3Quc2Nyb2xsVmlld3BvcnQoZSl9LG8ucHJvdG90eXBlLmFwcGVuZFJvd0hlYWRlcj1mdW5jdGlvbihlLHQpe2lmKHQuZmlyc3RDaGlsZCl7dmFyIG49dC5maXJzdENoaWxkO2lmKCFtKG4sInJlbGF0aXZlIikpcmV0dXJuIGgodCksdm9pZCB0aGlzLmFwcGVuZFJvd0hlYWRlcihlLHQpO3RoaXMudXBkYXRlQ2VsbEhlYWRlcihuLnF1ZXJ5U2VsZWN0b3IoIi5yb3dIZWFkZXIiKSxlLHRoaXMuaW5zdGFuY2UuZ2V0Um93SGVhZGVyKX1lbHNle3ZhciBvPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLHI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpO28uY2xhc3NOYW1lPSJyZWxhdGl2ZSIsci5jbGFzc05hbWU9InJvd0hlYWRlciIsdGhpcy51cGRhdGVDZWxsSGVhZGVyKHIsZSx0aGlzLmluc3RhbmNlLmdldFJvd0hlYWRlciksby5hcHBlbmRDaGlsZChyKSx0LmFwcGVuZENoaWxkKG8pfUhhbmRzb250YWJsZS5ob29rcy5ydW4odGhpcy5pbnN0YW5jZSwiYWZ0ZXJHZXRSb3dIZWFkZXIiLGUsdCl9LG8ucHJvdG90eXBlLmFwcGVuZENvbEhlYWRlcj1mdW5jdGlvbihlLHQpe2lmKHQuZmlyc3RDaGlsZCl7dmFyIG49dC5maXJzdENoaWxkO20obiwicmVsYXRpdmUiKT90aGlzLnVwZGF0ZUNlbGxIZWFkZXIobi5xdWVyeVNlbGVjdG9yKCIuY29sSGVhZGVyIiksZSx0aGlzLmluc3RhbmNlLmdldENvbEhlYWRlcik6KGgodCksdGhpcy5hcHBlbmRDb2xIZWFkZXIoZSx0KSl9ZWxzZXt2YXIgbz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSxyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNwYW4iKTtvLmNsYXNzTmFtZT0icmVsYXRpdmUiLHIuY2xhc3NOYW1lPSJjb2xIZWFkZXIiLHRoaXMudXBkYXRlQ2VsbEhlYWRlcihyLGUsdGhpcy5pbnN0YW5jZS5nZXRDb2xIZWFkZXIpLG8uYXBwZW5kQ2hpbGQociksdC5hcHBlbmRDaGlsZChvKX1IYW5kc29udGFibGUuaG9va3MucnVuKHRoaXMuaW5zdGFuY2UsImFmdGVyR2V0Q29sSGVhZGVyIixlLHQpfSxvLnByb3RvdHlwZS51cGRhdGVDZWxsSGVhZGVyPWZ1bmN0aW9uKGUsdCxuKXt0Pi0xP2YoZSxuKHQpKToocChlLFN0cmluZy5mcm9tQ2hhckNvZGUoMTYwKSksZChlLCJjb3JuZXJIZWFkZXIiKSl9LG8ucHJvdG90eXBlLm1heGltdW1WaXNpYmxlRWxlbWVudFdpZHRoPWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMud3Qud3RWaWV3cG9ydC5nZXRXb3Jrc3BhY2VXaWR0aCgpLG49dC1lO3JldHVybiBuPjA/bjowfSxvLnByb3RvdHlwZS5tYXhpbXVtVmlzaWJsZUVsZW1lbnRIZWlnaHQ9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcy53dC53dFZpZXdwb3J0LmdldFdvcmtzcGFjZUhlaWdodCgpLG49dC1lO3JldHVybiBuPjA/bjowfSxvLnByb3RvdHlwZS5tYWluVmlld0lzQWN0aXZlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMud3Q9PT10aGlzLmFjdGl2ZVd0fSxvLnByb3RvdHlwZS5kZXN0cm95PWZ1bmN0aW9uKCl7dGhpcy53dC5kZXN0cm95KCksdGhpcy5ldmVudE1hbmFnZXIuZGVzdHJveSgpfX0seyIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvY2VsbC9jb29yZHMiOjUsIjNyZHBhcnR5L3dhbGtvbnRhYmxlL3NyYy9jb3JlIjo3LCIzcmRwYXJ0eS93YWxrb250YWJsZS9zcmMvc2VsZWN0aW9uIjoxOCxldmVudE1hbmFnZXI6NDEsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL2RvbS9ldmVudCI6NDZ9XSw5ODpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjtPYmplY3QuZGVmaW5lUHJvcGVydGllcyhuLHtHaG9zdFRhYmxlOntnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gZn19LF9fZXNNb2R1bGU6e3ZhbHVlOiEwfX0pO3ZhciBvLHIsaSxzLGEsbD0obz1lKCJoZWxwZXJzL2RvbS9lbGVtZW50IiksbyYmby5fX2VzTW9kdWxlJiZvfHx7ImRlZmF1bHQiOm99KSx1PWwuYWRkQ2xhc3MsYz1sLm91dGVySGVpZ2h0LGQ9bC5vdXRlcldpZHRoLGg9KHI9ZSgiaGVscGVycy9hcnJheSIpLHImJnIuX19lc01vZHVsZSYmcnx8eyJkZWZhdWx0IjpyfSkuYXJyYXlFYWNoLGY9KChpPWUoImhlbHBlcnMvb2JqZWN0IiksaSYmaS5fX2VzTW9kdWxlJiZpfHx7ImRlZmF1bHQiOml9KS5vYmplY3RFYWNoLChzPWUoImhlbHBlcnMvbnVtYmVyIikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5yYW5nZUVhY2gsKGE9ZSgiaGVscGVycy9taXhlZCIpLGEmJmEuX19lc01vZHVsZSYmYXx8eyJkZWZhdWx0IjphfSkuc3RyaW5naWZ5LGZ1bmN0aW9uKGUpe3RoaXMuaG90PWUsdGhpcy5jb250YWluZXI9bnVsbCx0aGlzLmluamVjdGVkPSExLHRoaXMucm93cz1bXSx0aGlzLmNvbHVtbnM9W10sdGhpcy5zYW1wbGVzPW51bGx9KTskdHJhY2V1clJ1bnRpbWUuY3JlYXRlQ2xhc3MoZix7YWRkUm93OmZ1bmN0aW9uKGUsdCl7aWYodGhpcy5jb2x1bW5zLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIkRvZXNuJ3Qgc3VwcG9ydCBtdWx0aS1kaW1lbnNpb25hbCB0YWJsZSIpO3RoaXMucm93cy5sZW5ndGh8fCh0aGlzLmNvbnRhaW5lcj10aGlzLmNyZWF0ZUNvbnRhaW5lcih0aGlzLmhvdC5yb290RWxlbWVudC5jbGFzc05hbWUpKTt2YXIgbj17cm93OmV9O3RoaXMucm93cy5wdXNoKG4pLHRoaXMuc2FtcGxlcz10LHRoaXMudGFibGU9dGhpcy5jcmVhdGVUYWJsZSh0aGlzLmhvdC50YWJsZS5jbGFzc05hbWUpLHRoaXMudGFibGUuY29sR3JvdXAuYXBwZW5kQ2hpbGQodGhpcy5jcmVhdGVDb2xHcm91cHNDb2woKSksdGhpcy50YWJsZS50ci5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZVJvdyhlKSksdGhpcy5jb250YWluZXIuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMudGFibGUuZnJhZ21lbnQpLG4udGFibGU9dGhpcy50YWJsZS50YWJsZX0sYWRkQ29sdW1uOmZ1bmN0aW9uKGUsdCl7aWYodGhpcy5yb3dzLmxlbmd0aCl0aHJvdyBuZXcgRXJyb3IoIkRvZXNuJ3Qgc3VwcG9ydCBtdWx0aS1kaW1lbnNpb25hbCB0YWJsZSIpO3RoaXMuY29sdW1ucy5sZW5ndGh8fCh0aGlzLmNvbnRhaW5lcj10aGlzLmNyZWF0ZUNvbnRhaW5lcih0aGlzLmhvdC5yb290RWxlbWVudC5jbGFzc05hbWUpKTt2YXIgbj17Y29sOmV9O3RoaXMuY29sdW1ucy5wdXNoKG4pLHRoaXMuc2FtcGxlcz10LHRoaXMudGFibGU9dGhpcy5jcmVhdGVUYWJsZSh0aGlzLmhvdC50YWJsZS5jbGFzc05hbWUpLG51bGwhPT10aGlzLmhvdC5nZXRDb2xIZWFkZXIoZSkmJnRoaXMuaG90LnZpZXcuYXBwZW5kQ29sSGVhZGVyKGUsdGhpcy50YWJsZS50aCksdGhpcy50YWJsZS50Qm9keS5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUNvbChlKSksdGhpcy5jb250YWluZXIuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMudGFibGUuZnJhZ21lbnQpLG4udGFibGU9dGhpcy50YWJsZS50YWJsZX0sZ2V0SGVpZ2h0czpmdW5jdGlvbihlKXt0aGlzLmluamVjdGVkfHx0aGlzLmluamVjdFRhYmxlKCksaCh0aGlzLnJvd3MsZnVuY3Rpb24odCl7ZSh0LnJvdyxjKHQudGFibGUpLTEpfSl9LGdldFdpZHRoczpmdW5jdGlvbihlKXt0aGlzLmluamVjdGVkfHx0aGlzLmluamVjdFRhYmxlKCksaCh0aGlzLmNvbHVtbnMsZnVuY3Rpb24odCl7ZSh0LmNvbCxkKHQudGFibGUpKX0pfSxjcmVhdGVDb2xHcm91cHNDb2w6ZnVuY3Rpb24oKXt2YXIgZT10aGlzLHQ9ZG9jdW1lbnQsbj10LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtyZXR1cm4gbi5hcHBlbmRDaGlsZCh0aGlzLmNyZWF0ZUNvbEVsZW1lbnQoLTEpKSx0aGlzLnNhbXBsZXMuZm9yRWFjaChmdW5jdGlvbih0KXtoKHQuc3RyaW5ncyxmdW5jdGlvbih0KXtuLmFwcGVuZENoaWxkKGUuY3JlYXRlQ29sRWxlbWVudCh0LmNvbCkpfSl9KSxufSxjcmVhdGVSb3c6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxuPWRvY3VtZW50LG89bi5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCkscj1uLmNyZWF0ZUVsZW1lbnQoInRoIik7cmV0dXJuIG51bGwhPT10aGlzLmhvdC5nZXRSb3dIZWFkZXIoZSkmJnRoaXMuaG90LnZpZXcuYXBwZW5kUm93SGVhZGVyKGUsciksby5hcHBlbmRDaGlsZChyKSx0aGlzLnNhbXBsZXMuZm9yRWFjaChmdW5jdGlvbihyKXtoKHIuc3RyaW5ncyxmdW5jdGlvbihyKXt2YXIgaT1yLmNvbCxzPXQuaG90LmdldENlbGxNZXRhKGUsaSk7cy5jb2w9aSxzLnJvdz1lO3ZhciBhPXQuaG90LmdldENlbGxSZW5kZXJlcihzKSxsPW4uY3JlYXRlRWxlbWVudCgidGQiKTthKHQuaG90LGwsZSxpLHQuaG90LmNvbFRvUHJvcChpKSxyLnZhbHVlLHMpLG8uYXBwZW5kQ2hpbGQobCl9KX0pLG99LGNyZWF0ZUNvbDpmdW5jdGlvbihlKXt2YXIgdD10aGlzLG49ZG9jdW1lbnQsbz1uLmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTtyZXR1cm4gdGhpcy5zYW1wbGVzLmZvckVhY2goZnVuY3Rpb24ocil7aChyLnN0cmluZ3MsZnVuY3Rpb24ocil7dmFyIGk9ci5yb3cscz10LmhvdC5nZXRDZWxsTWV0YShpLGUpO3MuY29sPWUscy5yb3c9aTt2YXIgYT10LmhvdC5nZXRDZWxsUmVuZGVyZXIocyksbD1uLmNyZWF0ZUVsZW1lbnQoInRkIiksdT1uLmNyZWF0ZUVsZW1lbnQoInRyIik7YSh0LmhvdCxsLGksZSx0LmhvdC5jb2xUb1Byb3AoaSksci52YWx1ZSxzKSx1LmFwcGVuZENoaWxkKGwpLG8uYXBwZW5kQ2hpbGQodSl9KX0pLG99LGNsZWFuOmZ1bmN0aW9uKCl7dGhpcy5yb3dzLmxlbmd0aD0wLHRoaXMuY29sdW1ucy5sZW5ndGg9MCx0aGlzLnNhbXBsZXMmJnRoaXMuc2FtcGxlcy5jbGVhcigpLHRoaXMuc2FtcGxlcz1udWxsLHRoaXMucmVtb3ZlVGFibGUoKX0saW5qZWN0VGFibGU6ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOm51bGw7dGhpcy5pbmplY3RlZHx8KChlfHx0aGlzLmhvdC5yb290RWxlbWVudCkuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXIuZnJhZ21lbnQpLHRoaXMuaW5qZWN0ZWQ9ITApfSxyZW1vdmVUYWJsZTpmdW5jdGlvbigpe3RoaXMuaW5qZWN0ZWQmJnRoaXMuY29udGFpbmVyLmNvbnRhaW5lci5wYXJlbnROb2RlJiYodGhpcy5jb250YWluZXIuY29udGFpbmVyLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5jb250YWluZXIuY29udGFpbmVyKSx0aGlzLmNvbnRhaW5lcj1udWxsLHRoaXMuaW5qZWN0ZWQ9ITEpfSxjcmVhdGVDb2xFbGVtZW50OmZ1bmN0aW9uKGUpe3ZhciB0PWRvY3VtZW50LG49dC5jcmVhdGVFbGVtZW50KCJjb2wiKTtyZXR1cm4gbi5zdHlsZS53aWR0aD10aGlzLmhvdC52aWV3Lnd0Lnd0VGFibGUuZ2V0U3RyZXRjaGVkQ29sdW1uV2lkdGgoZSkrInB4IixufSxjcmVhdGVUYWJsZTpmdW5jdGlvbigpe3ZhciBlPXZvaWQgMCE9PWFyZ3VtZW50c1swXT9hcmd1bWVudHNbMF06IiIsdD1kb2N1bWVudCxuPXQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLG89dC5jcmVhdGVFbGVtZW50KCJ0YWJsZSIpLHI9dC5jcmVhdGVFbGVtZW50KCJ0aGVhZCIpLGk9dC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpLHM9dC5jcmVhdGVFbGVtZW50KCJjb2xncm91cCIpLGE9dC5jcmVhdGVFbGVtZW50KCJ0ciIpLGw9dC5jcmVhdGVFbGVtZW50KCJ0aCIpO3JldHVybiB0aGlzLmlzVmVydGljYWwoKSYmby5hcHBlbmRDaGlsZChzKSx0aGlzLmlzSG9yaXpvbnRhbCgpJiYoYS5hcHBlbmRDaGlsZChsKSxyLmFwcGVuZENoaWxkKGEpLG8uc3R5bGUudGFibGVMYXlvdXQ9ImF1dG8iLG8uc3R5bGUud2lkdGg9ImF1dG8iKSxvLmFwcGVuZENoaWxkKHIpLHRoaXMuaXNWZXJ0aWNhbCgpJiZpLmFwcGVuZENoaWxkKGEpLG8uYXBwZW5kQ2hpbGQoaSksdShvLGUpLG4uYXBwZW5kQ2hpbGQobykse2ZyYWdtZW50Om4sdGFibGU6byx0SGVhZDpyLHRCb2R5OmksY29sR3JvdXA6cyx0cjphLHRoOmx9fSxjcmVhdGVDb250YWluZXI6ZnVuY3Rpb24oKXt2YXIgZT12b2lkIDAhPT1hcmd1bWVudHNbMF0/YXJndW1lbnRzWzBdOiIiLHQ9ZG9jdW1lbnQsbj10LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKSxvPXQuY3JlYXRlRWxlbWVudCgiZGl2Iik7cmV0dXJuIGU9Imh0R2hvc3RUYWJsZSBodEF1dG9TaXplICIrZS50cmltKCksdShvLGUpLG4uYXBwZW5kQ2hpbGQobykse2ZyYWdtZW50Om4sY29udGFpbmVyOm99fSxpc1ZlcnRpY2FsOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMucm93cy5sZW5ndGgmJiF0aGlzLmNvbHVtbnMubGVuZ3RoPyEwOiExfSxpc0hvcml6b250YWw6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5jb2x1bW5zLmxlbmd0aCYmIXRoaXMucm93cy5sZW5ndGg/ITA6ITF9fSx7fSksSGFuZHNvbnRhYmxlLnV0aWxzPUhhbmRzb250YWJsZS51dGlsc3x8e30sSGFuZHNvbnRhYmxlLnV0aWxzLkdob3N0VGFibGU9Zn0seyJoZWxwZXJzL2FycmF5Ijo0MiwiaGVscGVycy9kb20vZWxlbWVudCI6NDUsImhlbHBlcnMvbWl4ZWQiOjQ4LCJoZWxwZXJzL251bWJlciI6NDksImhlbHBlcnMvb2JqZWN0Ijo1MH1dLDk5OltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO3ZhciBvO09iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKG4se1NhbXBsZXNHZW5lcmF0b3I6e2dldDpmdW5jdGlvbigpe3JldHVybiBofX0sX19lc01vZHVsZTp7dmFsdWU6ITB9fSk7dmFyIHIsaSxzLGEsbCx1PShyPWUoImhlbHBlcnMvZG9tL2VsZW1lbnQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLGM9KHUuYWRkQ2xhc3MsdS5vdXRlckhlaWdodCx1Lm91dGVyV2lkdGgsKGk9ZSgiaGVscGVycy9hcnJheSIpLGkmJmkuX19lc01vZHVsZSYmaXx8eyJkZWZhdWx0IjppfSkuYXJyYXlFYWNoLChzPWUoImhlbHBlcnMvb2JqZWN0IikscyYmcy5fX2VzTW9kdWxlJiZzfHx7ImRlZmF1bHQiOnN9KS5vYmplY3RFYWNoLChhPWUoImhlbHBlcnMvbnVtYmVyIiksYSYmYS5fX2VzTW9kdWxlJiZhfHx7ImRlZmF1bHQiOmF9KS5yYW5nZUVhY2gpLGQ9KGw9ZSgiaGVscGVycy9taXhlZCIpLGwmJmwuX19lc01vZHVsZSYmbHx8eyJkZWZhdWx0IjpsfSkuc3RyaW5naWZ5LGg9ZnVuY3Rpb24oZSl7dGhpcy5zYW1wbGVzPW51bGwsdGhpcy5kYXRhRmFjdG9yeT1lfSxmPWg7JHRyYWNldXJSdW50aW1lLmNyZWF0ZUNsYXNzKGgsKG89e30sT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sImdlbmVyYXRlUm93U2FtcGxlcyIse3ZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZ2VuZXJhdGVTYW1wbGVzKCJyb3ciLHQsZSl9LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sImdlbmVyYXRlQ29sdW1uU2FtcGxlcyIse3ZhbHVlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHRoaXMuZ2VuZXJhdGVTYW1wbGVzKCJjb2wiLHQsZSl9LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sImdlbmVyYXRlU2FtcGxlcyIse3ZhbHVlOmZ1bmN0aW9uKGUsdCxuKXt2YXIgbz10aGlzLHI9bmV3IE1hcDtyZXR1cm4ibnVtYmVyIj09dHlwZW9mIG4mJihuPXtmcm9tOm4sdG86bn0pLGMobi5mcm9tLG4udG8sZnVuY3Rpb24obil7dmFyIGk9by5nZW5lcmF0ZVNhbXBsZShlLHQsbik7ci5zZXQobixpKX0pLHJ9LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sImdlbmVyYXRlU2FtcGxlIix7dmFsdWU6ZnVuY3Rpb24oZSx0LG4pe3ZhciBvPXRoaXMscj1uZXcgTWFwO3JldHVybiBjKHQuZnJvbSx0LnRvLGZ1bmN0aW9uKHQpe3ZhciBpLHM7aWYoInJvdyI9PT1lKXM9by5kYXRhRmFjdG9yeShuLHQpO2Vsc2V7aWYoImNvbCIhPT1lKXRocm93IG5ldyBFcnJvcigiVW5zdXBwb3J0ZWQgc2FtcGxlIHR5cGUiKTtzPW8uZGF0YUZhY3RvcnkodCxuKX1BcnJheS5pc0FycmF5KHMpfHwocz1kKHMpKTt2YXIgYT1zLmxlbmd0aDtyLmhhcyhhKXx8ci5zZXQoYSx7bmVlZGVkOmYuU0FNUExFX0NPVU5ULHN0cmluZ3M6W119KTt2YXIgbD1yLmdldChhKTtpZihsLm5lZWRlZCl7dmFyIHU9InJvdyI9PT1lPyJjb2wiOiJyb3ciO2wuc3RyaW5ncy5wdXNoKChpPXt9LE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpLCJ2YWx1ZSIse3ZhbHVlOnMsY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsd3JpdGFibGU6ITB9KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoaSx1LHt2YWx1ZTp0LGNvbmZpZ3VyYWJsZTohMCxlbnVtZXJhYmxlOiEwLHdyaXRhYmxlOiEwfSksaSkpLGwubmVlZGVkLS19fSkscn0sY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITAsd3JpdGFibGU6ITB9KSxvKSx7Z2V0IFNBTVBMRV9DT1VOVCgpe3JldHVybiAzfX0pLEhhbmRzb250YWJsZS51dGlscz1IYW5kc29udGFibGUudXRpbHN8fHt9LEhhbmRzb250YWJsZS51dGlscy5TYW1wbGVzR2VuZXJhdG9yPWh9LHsiaGVscGVycy9hcnJheSI6NDIsImhlbHBlcnMvZG9tL2VsZW1lbnQiOjQ1LCJoZWxwZXJzL21peGVkIjo0OCwiaGVscGVycy9udW1iZXIiOjQ5LCJoZWxwZXJzL29iamVjdCI6NTB9XSwxMDA6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbyhlLHQpe3ZhciBuPWUsbz0ic3RyaW5nIj09dHlwZW9mIG4/bi50b0xvd2VyQ2FzZSgpOm51bGw7cmV0dXJuIGZ1bmN0aW9uKGUpe2Zvcih2YXIgcj0hMSxzPTAsYT1lLmxlbmd0aDthPnM7cysrKXtpZihuPT09ZVtzXSl7cj0hMDticmVha31pZihvPT09aShlW3NdKS50b0xvd2VyQ2FzZSgpKXtyPSEwO2JyZWFrfX10KHIpfX12YXIgcixpPShyPWUoImhlbHBlcnMvbWl4ZWQiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLnN0cmluZ2lmeTtIYW5kc29udGFibGUuQXV0b2NvbXBsZXRlVmFsaWRhdG9yPWZ1bmN0aW9uKGUsdCl7dGhpcy5zdHJpY3QmJnRoaXMuc291cmNlPyJmdW5jdGlvbiI9PXR5cGVvZiB0aGlzLnNvdXJjZT90aGlzLnNvdXJjZShlLG8oZSx0KSk6byhlLHQpKHRoaXMuc291cmNlKTp0KCEwKX19LHsiaGVscGVycy9taXhlZCI6NDh9XSwxMDE6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7dmFyIG8scixpPShvPWUoIm1vbWVudCIpLG8mJm8uX19lc01vZHVsZSYmb3x8eyJkZWZhdWx0IjpvfSlbImRlZmF1bHQiXSxzPShyPWUoImVkaXRvcnMiKSxyJiZyLl9fZXNNb2R1bGUmJnJ8fHsiZGVmYXVsdCI6cn0pLmdldEVkaXRvcjtIYW5kc29udGFibGUuRGF0ZVZhbGlkYXRvcj1mdW5jdGlvbihlLHQpe3ZhciBuPSEwLG89cygiZGF0ZSIsdGhpcy5pbnN0YW5jZSk7bnVsbD09PWUmJihlPSIiKTt2YXIgcj1pKG5ldyBEYXRlKGUpKS5pc1ZhbGlkKCksbD1pKGUsdGhpcy5kYXRlRm9ybWF0fHxvLmRlZmF1bHREYXRlRm9ybWF0LCEwKS5pc1ZhbGlkKCk7aWYocnx8KG49ITEpLCFyJiZsJiYobj0hMCksciYmIWwpaWYodGhpcy5jb3JyZWN0Rm9ybWF0PT09ITApe3ZhciB1PWEoZSx0aGlzLmRhdGVGb3JtYXQpO3RoaXMuaW5zdGFuY2Uuc2V0RGF0YUF0Q2VsbCh0aGlzLnJvdyx0aGlzLmNvbCx1LCJkYXRlVmFsaWRhdG9yIiksbj0hMH1lbHNlIG49ITE7dChuKX07dmFyIGE9ZnVuY3Rpb24oZSx0KXt2YXIgbj1pKG5ldyBEYXRlKGUpKSxvPW4uZm9ybWF0KCJZWVlZIikscj1pKCkuZm9ybWF0KCJZWVlZIik7cmV0dXJuIG8uc3Vic3RyKDAsMikhPT1yLnN1YnN0cigwLDIpP2UubWF0Y2gobmV3IFJlZ0V4cChvKSl8fG4ueWVhcihvLnJlcGxhY2Uoby5zdWJzdHIoMCwyKSxyLnN1YnN0cigwLDIpKSk6by5sZW5ndGg+NCYmbi55ZWFyKChuLnllYXIoKSsiIikuc3Vic3RyKDAsNCkpLG4uZm9ybWF0KHQpfX0se2VkaXRvcnM6MjksbW9tZW50OiJtb21lbnQifV0sMTAyOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO0hhbmRzb250YWJsZS5OdW1lcmljVmFsaWRhdG9yPWZ1bmN0aW9uKGUsdCl7bnVsbD09PWUmJihlPSIiKSx0KC9eLT9cZCooXC58XCwpP1xkKiQvLnRlc3QoZSkpfX0se31dLFNoZWV0Q2xpcDpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjshZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlKXtyZXR1cm4gZS5zcGxpdCgnIicpLmxlbmd0aC0xfXZhciBvPXtwYXJzZTpmdW5jdGlvbihlKXt2YXIgbixvLHIsaSxzLGEsbCx1PVtdLGM9MDtmb3Iocj1lLnNwbGl0KCJcbiIpLHIubGVuZ3RoPjEmJiIiPT09cltyLmxlbmd0aC0xXSYmci5wb3AoKSxuPTAsbz1yLmxlbmd0aDtvPm47bis9MSl7Zm9yKHJbbl09cltuXS5zcGxpdCgiCSIpLGk9MCxzPXJbbl0ubGVuZ3RoO3M+aTtpKz0xKXVbY118fCh1W2NdPVtdKSxhJiYwPT09aT8obD11W2NdLmxlbmd0aC0xLHVbY11bbF09dVtjXVtsXSsiXG4iK3Jbbl1bMF0sYSYmMSZ0KHJbbl1bMF0pJiYoYT0hMSx1W2NdW2xdPXVbY11bbF0uc3Vic3RyaW5nKDAsdVtjXVtsXS5sZW5ndGgtMSkucmVwbGFjZSgvIiIvZywnIicpKSk6aT09PXMtMSYmMD09PXJbbl1baV0uaW5kZXhPZignIicpJiYxJnQocltuXVtpXSk/KHVbY10ucHVzaChyW25dW2ldLnN1YnN0cmluZygxKS5yZXBsYWNlKC8iIi9nLCciJykpLGE9ITApOih1W2NdLnB1c2gocltuXVtpXS5yZXBsYWNlKC8iIi9nLCciJykpLGE9ITEpO2F8fChjKz0xKX1yZXR1cm4gdX0sc3RyaW5naWZ5OmZ1bmN0aW9uKGUpe3ZhciB0LG4sbyxyLGkscz0iIjtmb3IodD0wLG49ZS5sZW5ndGg7bj50O3QrPTEpe2ZvcihyPWVbdF0ubGVuZ3RoLG89MDtyPm87bys9MSlvPjAmJihzKz0iCSIpLGk9ZVt0XVtvXSxzKz0ic3RyaW5nIj09dHlwZW9mIGk/aS5pbmRleE9mKCJcbiIpPi0xPyciJytpLnJlcGxhY2UoLyIvZywnIiInKSsnIic6aTpudWxsPT09aXx8dm9pZCAwPT09aT8iIjppO3MrPSJcbiJ9cmV0dXJuIHN9fTsidW5kZWZpbmVkIiE9dHlwZW9mIG4/KG4ucGFyc2U9by5wYXJzZSxuLnN0cmluZ2lmeT1vLnN0cmluZ2lmeSk6ZS5TaGVldENsaXA9b30od2luZG93KX0se31dLGF1dG9SZXNpemU6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbygpe3ZhciBlLHQ9e21pbkhlaWdodDoyMDAsbWF4SGVpZ2h0OjMwMCxtaW5XaWR0aDoxMDAsbWF4V2lkdGg6MzAwfSxuPWRvY3VtZW50LmJvZHksbz1kb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgiIikscj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJTUEFOIiksaT1mdW5jdGlvbihlLHQsbil7d2luZG93LmF0dGFjaEV2ZW50P2UuYXR0YWNoRXZlbnQoIm9uIit0LG4pOmUuYWRkRXZlbnRMaXN0ZW5lcih0LG4sITEpfSxzPWZ1bmN0aW9uKGUsdCxuKXt3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcj9lLnJlbW92ZUV2ZW50TGlzdGVuZXIodCxuLCExKTplLmRldGFjaEV2ZW50KCJvbiIrdCxuKX0sYT1mdW5jdGlvbihpKXt2YXIgcyxhO2k/L15bYS16QS1aIFwuLFxcXC9cfDAtOV0kLy50ZXN0KGkpfHwoaT0iLiIpOmk9IiIsdm9pZCAwIT09by50ZXh0Q29udGVudD9vLnRleHRDb250ZW50PWUudmFsdWUraTpvLmRhdGE9ZS52YWx1ZStpLHIuc3R5bGUuZm9udFNpemU9SGFuZHNvbnRhYmxlLkRvbS5nZXRDb21wdXRlZFN0eWxlKGUpLmZvbnRTaXplLHIuc3R5bGUuZm9udEZhbWlseT1IYW5kc29udGFibGUuRG9tLmdldENvbXB1dGVkU3R5bGUoZSkuZm9udEZhbWlseSxyLnN0eWxlLndoaXRlU3BhY2U9InByZSIsbi5hcHBlbmRDaGlsZChyKSxzPXIuY2xpZW50V2lkdGgrMixuLnJlbW92ZUNoaWxkKHIpLGUuc3R5bGUuaGVpZ2h0PXQubWluSGVpZ2h0KyJweCIsdC5taW5XaWR0aD5zP2Uuc3R5bGUud2lkdGg9dC5taW5XaWR0aCsicHgiOnM+dC5tYXhXaWR0aD9lLnN0eWxlLndpZHRoPXQubWF4V2lkdGgrInB4IjplLnN0eWxlLndpZHRoPXMrInB4IixhPWUuc2Nyb2xsSGVpZ2h0P2Uuc2Nyb2xsSGVpZ2h0LTE6MCx0Lm1pbkhlaWdodD5hP2Uuc3R5bGUuaGVpZ2h0PXQubWluSGVpZ2h0KyJweCI6dC5tYXhIZWlnaHQ8YT8oZS5zdHlsZS5oZWlnaHQ9dC5tYXhIZWlnaHQrInB4IixlLnN0eWxlLm92ZXJmbG93WT0idmlzaWJsZSIpOmUuc3R5bGUuaGVpZ2h0PWErInB4In0sbD1mdW5jdGlvbigpe3dpbmRvdy5zZXRUaW1lb3V0KGEsMCl9LHU9ZnVuY3Rpb24obil7aWYobiYmbi5taW5IZWlnaHQpaWYoImluaGVyaXQiPT1uLm1pbkhlaWdodCl0Lm1pbkhlaWdodD1lLmNsaWVudEhlaWdodDtlbHNle3ZhciBpPXBhcnNlSW50KG4ubWluSGVpZ2h0KTtpc05hTihpKXx8KHQubWluSGVpZ2h0PWkpfWlmKG4mJm4ubWF4SGVpZ2h0KWlmKCJpbmhlcml0Ij09bi5tYXhIZWlnaHQpdC5tYXhIZWlnaHQ9ZS5jbGllbnRIZWlnaHQ7ZWxzZXt2YXIgcz1wYXJzZUludChuLm1heEhlaWdodCk7aXNOYU4ocyl8fCh0Lm1heEhlaWdodD1zKX1pZihuJiZuLm1pbldpZHRoKWlmKCJpbmhlcml0Ij09bi5taW5XaWR0aCl0Lm1pbldpZHRoPWUuY2xpZW50V2lkdGg7ZWxzZXt2YXIgYT1wYXJzZUludChuLm1pbldpZHRoKTtpc05hTihhKXx8KHQubWluV2lkdGg9YSl9aWYobiYmbi5tYXhXaWR0aClpZigiaW5oZXJpdCI9PW4ubWF4V2lkdGgpdC5tYXhXaWR0aD1lLmNsaWVudFdpZHRoO2Vsc2V7dmFyIGw9cGFyc2VJbnQobi5tYXhXaWR0aCk7aXNOYU4obCl8fCh0Lm1heFdpZHRoPWwpfXIuZmlyc3RDaGlsZHx8KHIuY2xhc3NOYW1lPSJhdXRvUmVzaXplIixyLnN0eWxlLmRpc3BsYXk9ImlubGluZS1ibG9jayIsci5hcHBlbmRDaGlsZChvKSl9LGM9ZnVuY3Rpb24obixvLHIpe2U9bix1KG8pLCJURVhUQVJFQSI9PWUubm9kZU5hbWUmJihlLnN0eWxlLnJlc2l6ZT0ibm9uZSIsZS5zdHlsZS5vdmVyZmxvd1k9IiIsZS5zdHlsZS5oZWlnaHQ9dC5taW5IZWlnaHQrInB4IixlLnN0eWxlLm1pbldpZHRoPXQubWluV2lkdGgrInB4IixlLnN0eWxlLm1heFdpZHRoPXQubWF4V2lkdGgrInB4IixlLnN0eWxlLm92ZXJmbG93WT0iaGlkZGVuIiksciYmKGkoZSwiY2hhbmdlIixhKSxpKGUsImN1dCIsbCksaShlLCJwYXN0ZSIsbCksaShlLCJkcm9wIixsKSxpKGUsImtleWRvd24iLGwpKSxhKCl9O3JldHVybntpbml0OmZ1bmN0aW9uKGUsdCxuKXtjKGUsdCxuKX0sdW5PYnNlcnZlOmZ1bmN0aW9uKCl7cyhlLCJjaGFuZ2UiLGEpLHMoZSwiY3V0IixsKSxzKGUsInBhc3RlIixsKSxzKGUsImRyb3AiLGwpLHMoZSwia2V5ZG93biIsbCl9LHJlc2l6ZTphfX0idW5kZWZpbmVkIiE9dHlwZW9mIG4mJih0LmV4cG9ydHM9byl9LHt9XSxjb3B5UGFzdGU6W2Z1bmN0aW9uKGUsdCxuKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbygpe3JldHVybiBpP2kuaGFzQmVlbkRlc3Ryb3llZCgpJiZpLmluaXQoKTppPW5ldyByLGkucmVmQ291bnRlcisrLGl9ZnVuY3Rpb24gcigpe3RoaXMucmVmQ291bnRlcj0wLHRoaXMuaW5pdCgpfXZhciBpOyJ1bmRlZmluZWQiIT10eXBlb2YgbiYmKHQuZXhwb3J0cz1vKSxyLnByb3RvdHlwZS5pbml0PWZ1bmN0aW9uKCl7dmFyIGUsdDt0aGlzLmNvcHlDYWxsYmFja3M9W10sdGhpcy5jdXRDYWxsYmFja3M9W10sdGhpcy5wYXN0ZUNhbGxiYWNrcz1bXSx0PWRvY3VtZW50LmJvZHksZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkNvcHlQYXN0ZURpdiIpPyh0aGlzLmVsRGl2PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJDb3B5UGFzdGVEaXYiKSx0aGlzLmVsVGV4dGFyZWE9dGhpcy5lbERpdi5maXJzdENoaWxkKToodGhpcy5lbERpdj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSx0aGlzLmVsRGl2LmlkPSJDb3B5UGFzdGVEaXYiLGU9dGhpcy5lbERpdi5zdHlsZSxlLnBvc2l0aW9uPSJmaXhlZCIsZS50b3A9Ii0xMDAwMHB4IixlLmxlZnQ9Ii0xMDAwMHB4Iix0LmFwcGVuZENoaWxkKHRoaXMuZWxEaXYpLHRoaXMuZWxUZXh0YXJlYT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpLHRoaXMuZWxUZXh0YXJlYS5jbGFzc05hbWU9ImNvcHlQYXN0ZSIsdGhpcy5lbFRleHRhcmVhLm9ucGFzdGU9ZnVuY3Rpb24oZSl7dmFyIHQsbjtyZXR1cm4iV2Via2l0QXBwZWFyYW5jZSJpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGU/KHQ9ZS5jbGlwYm9hcmREYXRhLmdldERhdGEoIlRleHQiKSwtMSE9PW5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZigiU2FmYXJpIikmJi0xPT09bmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCJDaHJvbWUiKSYmKG49dC5zcGxpdCgiXG4iKSwiIj09PW5bbi5sZW5ndGgtMV0mJm4ucG9wKCksdD1uLmpvaW4oIlxuIikpLHRoaXMudmFsdWU9dCwhMSk6dm9pZCAwfSxlPXRoaXMuZWxUZXh0YXJlYS5zdHlsZSxlLndpZHRoPSIxMDAwMHB4IixlLmhlaWdodD0iMTAwMDBweCIsZS5vdmVyZmxvdz0iaGlkZGVuIix0aGlzLmVsRGl2LmFwcGVuZENoaWxkKHRoaXMuZWxUZXh0YXJlYSksInVuZGVmaW5lZCIhPXR5cGVvZiBlLm9wYWNpdHkmJihlLm9wYWNpdHk9MCkpLHRoaXMub25LZXlEb3duUmVmPXRoaXMub25LZXlEb3duLmJpbmQodGhpcyksZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoImtleWRvd24iLHRoaXMub25LZXlEb3duUmVmLCExKX0sci5wcm90b3R5cGUub25LZXlEb3duPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoKXt2YXIgZT1kb2N1bWVudC5hY3RpdmVFbGVtZW50O3JldHVybiBlLnNoYWRvd1Jvb3QmJmUuc2hhZG93Um9vdC5hY3RpdmVFbGVtZW50JiYoZT1lLnNoYWRvd1Jvb3QuYWN0aXZlRWxlbWVudCksWyJJTlBVVCIsIlNFTEVDVCIsIlRFWFRBUkVBIl0uaW5kZXhPZihlLm5vZGVOYW1lKT4tMXx8InRydWUiPT09ZS5jb250ZW50RWRpdGFibGV9dmFyIG49dGhpcyxvPSExO2lmKGUubWV0YUtleT9vPSEwOmUuY3RybEtleSYmLTE9PT1uYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoIk1hYyIpJiYobz0hMCksbyl7aWYoZG9jdW1lbnQuYWN0aXZlRWxlbWVudCE9PXRoaXMuZWxUZXh0YXJlYSYmKCIiIT09dGhpcy5nZXRTZWxlY3Rpb25UZXh0KCl8fHQoKSkpcmV0dXJuO3RoaXMuc2VsZWN0Tm9kZVRleHQodGhpcy5lbFRleHRhcmVhKSxzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7ZG9jdW1lbnQuYWN0aXZlRWxlbWVudCE9PW4uZWxUZXh0YXJlYSYmbi5zZWxlY3ROb2RlVGV4dChuLmVsVGV4dGFyZWEpfSwwKX0hb3x8NjchPT1lLmtleUNvZGUmJjg2IT09ZS5rZXlDb2RlJiY4OCE9PWUua2V5Q29kZXx8KDg4PT09ZS5rZXlDb2RlP3NldFRpbWVvdXQoZnVuY3Rpb24oKXtuLnRyaWdnZXJDdXQoZSl9LDApOjg2PT09ZS5rZXlDb2RlJiZzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7bi50cmlnZ2VyUGFzdGUoZSl9LDApKX0sci5wcm90b3R5cGUuc2VsZWN0Tm9kZVRleHQ9ZnVuY3Rpb24oZSl7ZSYmZS5zZWxlY3QoKX0sci5wcm90b3R5cGUuZ2V0U2VsZWN0aW9uVGV4dD1mdW5jdGlvbigpe3ZhciBlPSIiO3JldHVybiB3aW5kb3cuZ2V0U2VsZWN0aW9uP2U9d2luZG93LmdldFNlbGVjdGlvbigpLnRvU3RyaW5nKCk6ZG9jdW1lbnQuc2VsZWN0aW9uJiYiQ29udHJvbCIhPT1kb2N1bWVudC5zZWxlY3Rpb24udHlwZSYmKGU9ZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCkudGV4dCksZX0sci5wcm90b3R5cGUuY29weWFibGU9ZnVuY3Rpb24oZSl7aWYoInN0cmluZyIhPXR5cGVvZiBlJiZ2b2lkIDA9PT1lLnRvU3RyaW5nKXRocm93IG5ldyBFcnJvcigiY29weWFibGUgcmVxdWlyZXMgc3RyaW5nIHBhcmFtZXRlciIpO3RoaXMuZWxUZXh0YXJlYS52YWx1ZT1lLHRoaXMuc2VsZWN0Tm9kZVRleHQodGhpcy5lbFRleHRhcmVhKX0sci5wcm90b3R5cGUub25DdXQ9ZnVuY3Rpb24oZSl7dGhpcy5jdXRDYWxsYmFja3MucHVzaChlKX0sci5wcm90b3R5cGUub25QYXN0ZT1mdW5jdGlvbihlKXt0aGlzLnBhc3RlQ2FsbGJhY2tzLnB1c2goZSl9LHIucHJvdG90eXBlLnJlbW92ZUNhbGxiYWNrPWZ1bmN0aW9uKGUpe3ZhciB0LG47Zm9yKHQ9MCxuPXRoaXMuY29weUNhbGxiYWNrcy5sZW5ndGg7bj50O3QrKylpZih0aGlzLmNvcHlDYWxsYmFja3NbdF09PT1lKXJldHVybiB0aGlzLmNvcHlDYWxsYmFja3Muc3BsaWNlKHQsMSksITA7Zm9yKHQ9MCxuPXRoaXMuY3V0Q2FsbGJhY2tzLmxlbmd0aDtuPnQ7dCsrKWlmKHRoaXMuY3V0Q2FsbGJhY2tzW3RdPT09ZSlyZXR1cm4gdGhpcy5jdXRDYWxsYmFja3Muc3BsaWNlKHQsMSksCiEwO2Zvcih0PTAsbj10aGlzLnBhc3RlQ2FsbGJhY2tzLmxlbmd0aDtuPnQ7dCsrKWlmKHRoaXMucGFzdGVDYWxsYmFja3NbdF09PT1lKXJldHVybiB0aGlzLnBhc3RlQ2FsbGJhY2tzLnNwbGljZSh0LDEpLCEwO3JldHVybiExfSxyLnByb3RvdHlwZS50cmlnZ2VyQ3V0PWZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7dC5jdXRDYWxsYmFja3MmJnNldFRpbWVvdXQoZnVuY3Rpb24oKXtmb3IodmFyIG49MCxvPXQuY3V0Q2FsbGJhY2tzLmxlbmd0aDtvPm47bisrKXQuY3V0Q2FsbGJhY2tzW25dKGUpfSw1MCl9LHIucHJvdG90eXBlLnRyaWdnZXJQYXN0ZT1mdW5jdGlvbihlLHQpe3ZhciBuPXRoaXM7bi5wYXN0ZUNhbGxiYWNrcyYmc2V0VGltZW91dChmdW5jdGlvbigpe2Zvcih2YXIgbz10fHxuLmVsVGV4dGFyZWEudmFsdWUscj0wLGk9bi5wYXN0ZUNhbGxiYWNrcy5sZW5ndGg7aT5yO3IrKyluLnBhc3RlQ2FsbGJhY2tzW3JdKG8sZSl9LDUwKX0sci5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe3RoaXMuaGFzQmVlbkRlc3Ryb3llZCgpfHwwIT09LS10aGlzLnJlZkNvdW50ZXJ8fCh0aGlzLmVsRGl2JiZ0aGlzLmVsRGl2LnBhcmVudE5vZGUmJih0aGlzLmVsRGl2LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5lbERpdiksdGhpcy5lbERpdj1udWxsLHRoaXMuZWxUZXh0YXJlYT1udWxsKSxkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsdGhpcy5vbktleURvd25SZWYpLHRoaXMub25LZXlEb3duUmVmPW51bGwpfSxyLnByb3RvdHlwZS5oYXNCZWVuRGVzdHJveWVkPWZ1bmN0aW9uKCl7cmV0dXJuIXRoaXMucmVmQ291bnRlcn19LHt9XSxlczZjb2xsZWN0aW9uczpbZnVuY3Rpb24oZSx0LG4peyJ1c2Ugc3RyaWN0IjshZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQpe2Z1bmN0aW9uIG8oZSl7cmV0dXJuIHRoaXMmJnRoaXMuY29uc3RydWN0b3I9PT1vPyh0aGlzLl9rZXlzPVtdLHRoaXMuX3ZhbHVlcz1bXSx0aGlzLl9pdHA9W10sdGhpcy5vYmplY3RPbmx5PXQsdm9pZChlJiZuLmNhbGwodGhpcyxlKSkpOm5ldyBvKGUpfXJldHVybiB0fHx5KGUsInNpemUiLHtnZXQ6bX0pLGUuY29uc3RydWN0b3I9byxvLnByb3RvdHlwZT1lLG99ZnVuY3Rpb24gbihlKXt0aGlzLmFkZD9lLmZvckVhY2godGhpcy5hZGQsdGhpcyk6ZS5mb3JFYWNoKGZ1bmN0aW9uKGUpe3RoaXMuc2V0KGVbMF0sZVsxXSl9LHRoaXMpfWZ1bmN0aW9uIG8oZSl7cmV0dXJuIHRoaXMuaGFzKGUpJiYodGhpcy5fa2V5cy5zcGxpY2UodywxKSx0aGlzLl92YWx1ZXMuc3BsaWNlKHcsMSksdGhpcy5faXRwLmZvckVhY2goZnVuY3Rpb24oZSl7dzxlWzBdJiZlWzBdLS19KSksdz4tMX1mdW5jdGlvbiByKGUpe3JldHVybiB0aGlzLmhhcyhlKT90aGlzLl92YWx1ZXNbd106dm9pZCAwfWZ1bmN0aW9uIGkoZSx0KXtpZih0aGlzLm9iamVjdE9ubHkmJnQhPT1PYmplY3QodCkpdGhyb3cgbmV3IFR5cGVFcnJvcigiSW52YWxpZCB2YWx1ZSB1c2VkIGFzIHdlYWsgY29sbGVjdGlvbiBrZXkiKTtpZih0IT10fHwwPT09dClmb3Iodz1lLmxlbmd0aDt3LS0mJiFiKGVbd10sdCk7KTtlbHNlIHc9ZS5pbmRleE9mKHQpO3JldHVybiB3Pi0xfWZ1bmN0aW9uIHMoZSl7cmV0dXJuIGkuY2FsbCh0aGlzLHRoaXMuX3ZhbHVlcyxlKX1mdW5jdGlvbiBhKGUpe3JldHVybiBpLmNhbGwodGhpcyx0aGlzLl9rZXlzLGUpfWZ1bmN0aW9uIGwoZSx0KXtyZXR1cm4gdGhpcy5oYXMoZSk/dGhpcy5fdmFsdWVzW3ddPXQ6dGhpcy5fdmFsdWVzW3RoaXMuX2tleXMucHVzaChlKS0xXT10LHRoaXN9ZnVuY3Rpb24gdShlKXtyZXR1cm4gdGhpcy5oYXMoZSl8fHRoaXMuX3ZhbHVlcy5wdXNoKGUpLHRoaXN9ZnVuY3Rpb24gYygpe3RoaXMuX3ZhbHVlcy5sZW5ndGg9MH1mdW5jdGlvbiBkKCl7cmV0dXJuIGcodGhpcy5faXRwLHRoaXMuX2tleXMpfWZ1bmN0aW9uIGgoKXtyZXR1cm4gZyh0aGlzLl9pdHAsdGhpcy5fdmFsdWVzKX1mdW5jdGlvbiBmKCl7cmV0dXJuIGcodGhpcy5faXRwLHRoaXMuX2tleXMsdGhpcy5fdmFsdWVzKX1mdW5jdGlvbiBwKCl7cmV0dXJuIGcodGhpcy5faXRwLHRoaXMuX3ZhbHVlcyx0aGlzLl92YWx1ZXMpfWZ1bmN0aW9uIGcoZSx0LG4pe3ZhciBvPVswXSxyPSExO3JldHVybiBlLnB1c2gobykse25leHQ6ZnVuY3Rpb24oKXt2YXIgaSxzPW9bMF07cmV0dXJuIXImJnM8dC5sZW5ndGg/KGk9bj9bdFtzXSxuW3NdXTp0W3NdLG9bMF0rKyk6KHI9ITAsZS5zcGxpY2UoZS5pbmRleE9mKG8pLDEpKSx7ZG9uZTpyLHZhbHVlOml9fX19ZnVuY3Rpb24gbSgpe3JldHVybiB0aGlzLl92YWx1ZXMubGVuZ3RofWZ1bmN0aW9uIHYoZSx0KXtmb3IodmFyIG49dGhpcy5lbnRyaWVzKCk7Oyl7dmFyIG89bi5uZXh0KCk7aWYoby5kb25lKWJyZWFrO2UuY2FsbCh0LG8udmFsdWVbMV0sby52YWx1ZVswXSx0aGlzKX19dmFyIHcseT1PYmplY3QuZGVmaW5lUHJvcGVydHksYj1mdW5jdGlvbihlLHQpe3JldHVybiBpc05hTihlKT9pc05hTih0KTplPT09dH07InVuZGVmaW5lZCI9PXR5cGVvZiBXZWFrTWFwJiYoZS5XZWFrTWFwPXQoeyJkZWxldGUiOm8sY2xlYXI6YyxnZXQ6cixoYXM6YSxzZXQ6bH0sITApKSwidW5kZWZpbmVkIj09dHlwZW9mIE1hcCYmKGUuTWFwPXQoeyJkZWxldGUiOm8saGFzOmEsZ2V0OnIsc2V0Omwsa2V5czpkLHZhbHVlczpoLGVudHJpZXM6Zixmb3JFYWNoOnYsY2xlYXI6Y30pKSwidW5kZWZpbmVkIj09dHlwZW9mIFNldCYmKGUuU2V0PXQoe2hhczpzLGFkZDp1LCJkZWxldGUiOm8sY2xlYXI6YyxrZXlzOmgsdmFsdWVzOmgsZW50cmllczpwLGZvckVhY2g6dn0pKSwidW5kZWZpbmVkIj09dHlwZW9mIFdlYWtTZXQmJihlLldlYWtTZXQ9dCh7ImRlbGV0ZSI6byxhZGQ6dSxjbGVhcjpjLGhhczpzfSwhMCkpfSgidW5kZWZpbmVkIiE9dHlwZW9mIG4mJiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDp3aW5kb3cpfSx7fV0sanNvbnBhdGNoOltmdW5jdGlvbihlLHQsbil7InVzZSBzdHJpY3QiO3ZhciBvOyFmdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUpe3JldHVybi0xPT09ZS5pbmRleE9mKCIvIikmJi0xPT09ZS5pbmRleE9mKCJ+Iik/ZTplLnJlcGxhY2UoL34vZywifjAiKS5yZXBsYWNlKC9cLy9nLCJ+MSIpfWZ1bmN0aW9uIG4oZSxvKXt2YXIgcjtmb3IodmFyIGkgaW4gZSlpZihlLmhhc093blByb3BlcnR5KGkpKXtpZihlW2ldPT09bylyZXR1cm4gdChpKSsiLyI7aWYoIm9iamVjdCI9PXR5cGVvZiBlW2ldJiYocj1uKGVbaV0sbyksIiIhPXIpKXJldHVybiB0KGkpKyIvIityfXJldHVybiIifWZ1bmN0aW9uIG8oZSx0KXtpZihlPT09dClyZXR1cm4iLyI7dmFyIG89bihlLHQpO2lmKCIiPT09byl0aHJvdyBuZXcgRXJyb3IoIk9iamVjdCBub3QgZm91bmQgaW4gcm9vdCIpO3JldHVybiIvIitvfWZ1bmN0aW9uIHIoZSl7Zm9yKHZhciB0PTAsbj13Lmxlbmd0aDtuPnQ7dCsrKWlmKHdbdF0ub2JqPT09ZSlyZXR1cm4gd1t0XX1mdW5jdGlvbiBpKGUpe2Zvcih2YXIgdD0wLG49dy5sZW5ndGg7bj50O3QrKyl3W3RdPT09ZSYmdy5zcGxpY2UodCwxKX1mdW5jdGlvbiBzKGUsdCl7Zm9yKHZhciBuPTAsbz1lLm9ic2VydmVycy5sZW5ndGg7bz5uO24rKylpZihlLm9ic2VydmVyc1tuXS5jYWxsYmFjaz09PXQpcmV0dXJuIGUub2JzZXJ2ZXJzW25dLm9ic2VydmVyfWZ1bmN0aW9uIGEoZSx0KXtmb3IodmFyIG49MCxvPWUub2JzZXJ2ZXJzLmxlbmd0aDtvPm47bisrKWlmKGUub2JzZXJ2ZXJzW25dLm9ic2VydmVyPT09dClyZXR1cm4gZS5vYnNlcnZlcnMuc3BsaWNlKG4sMSksdm9pZChlLm9ic2VydmVycy5sZW5ndGh8fGkoZSkpfWZ1bmN0aW9uIGwoZSx0KXtoKHQpLE9iamVjdC5vYnNlcnZlP2QodCxlKTpjbGVhclRpbWVvdXQodC5uZXh0KTt2YXIgbj1yKGUpO2Eobix0KX1mdW5jdGlvbiB1KGUsdCl7dmFyIG4saT1bXSxhPWUsbD1yKGUpO2lmKGw/bj1zKGwsdCk6KGw9bmV3IHkoZSksdy5wdXNoKGwpKSxuKXJldHVybiBuO2lmKE9iamVjdC5vYnNlcnZlKW49ZnVuY3Rpb24ocil7ZChuLGUpLGMobixlKTtmb3IodmFyIHM9MCxsPXIubGVuZ3RoO2w+czspe2lmKCgibGVuZ3RoIiE9PXJbc10ubmFtZXx8IVIocltzXS5vYmplY3QpKSYmIl9fSmFzbWluZV9iZWVuX2hlcmVfYmVmb3JlX18iIT09cltzXS5uYW1lKXt2YXIgdT1yW3NdLnR5cGU7c3dpdGNoKHUpe2Nhc2UibmV3Ijp1PSJhZGQiO2JyZWFrO2Nhc2UiZGVsZXRlZCI6dT0iZGVsZXRlIjticmVhaztjYXNlInVwZGF0ZWQiOnU9InVwZGF0ZSJ9dlt1XS5jYWxsKHJbc10saSxvKGEscltzXS5vYmplY3QpKX1zKyt9aSYmdCYmdChpKSxuLnBhdGNoZXM9aSxpPVtdfTtlbHNlIGlmKG49e30sbC52YWx1ZT1KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KGUpKSx0KXtuLmNhbGxiYWNrPXQsbi5uZXh0PW51bGw7dmFyIHU9dGhpcy5pbnRlcnZhbHN8fFsxMDAsMWUzLDFlNCw2ZTRdLGY9MCxwPWZ1bmN0aW9uKCl7aChuKX0sZz1mdW5jdGlvbigpe2NsZWFyVGltZW91dChuLm5leHQpLG4ubmV4dD1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cCgpLGY9MCxuLm5leHQ9c2V0VGltZW91dChtLHVbZisrXSl9LDApfSxtPWZ1bmN0aW9uKCl7cCgpLGY9PXUubGVuZ3RoJiYoZj11Lmxlbmd0aC0xKSxuLm5leHQ9c2V0VGltZW91dChtLHVbZisrXSl9OyJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiYod2luZG93LmFkZEV2ZW50TGlzdGVuZXI/KHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZWRvd24iLGcpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtb3VzZXVwIixnKSx3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsZykpOih3aW5kb3cuYXR0YWNoRXZlbnQoIm9ubW91c2Vkb3duIixnKSx3aW5kb3cuYXR0YWNoRXZlbnQoIm9ubW91c2V1cCIsZyksd2luZG93LmF0dGFjaEV2ZW50KCJvbmtleWRvd24iLGcpKSksbi5uZXh0PXNldFRpbWVvdXQobSx1W2YrK10pfXJldHVybiBuLnBhdGNoZXM9aSxuLm9iamVjdD1lLGwub2JzZXJ2ZXJzLnB1c2gobmV3IGIodCxuKSksYyhuLGUpfWZ1bmN0aW9uIGMoZSx0KXtpZihPYmplY3Qub2JzZXJ2ZSl7T2JqZWN0Lm9ic2VydmUodCxlKTtmb3IodmFyIG4gaW4gdClpZih0Lmhhc093blByb3BlcnR5KG4pKXt2YXIgbz10W25dO28mJiJvYmplY3QiPT10eXBlb2YgbyYmYyhlLG8pfX1yZXR1cm4gZX1mdW5jdGlvbiBkKGUsdCl7aWYoT2JqZWN0Lm9ic2VydmUpe09iamVjdC51bm9ic2VydmUodCxlKTtmb3IodmFyIG4gaW4gdClpZih0Lmhhc093blByb3BlcnR5KG4pKXt2YXIgbz10W25dO28mJiJvYmplY3QiPT10eXBlb2YgbyYmZChlLG8pfX1yZXR1cm4gZX1mdW5jdGlvbiBoKGUpe2lmKE9iamVjdC5vYnNlcnZlKU9iamVjdC5kZWxpdmVyQ2hhbmdlUmVjb3JkcyhlKTtlbHNle2Zvcih2YXIgdCxuPTAsbz13Lmxlbmd0aDtvPm47bisrKWlmKHdbbl0ub2JqPT09ZS5vYmplY3Qpe3Q9d1tuXTticmVha310JiZmKHQudmFsdWUsZS5vYmplY3QsZS5wYXRjaGVzLCIiKX12YXIgcj1lLnBhdGNoZXM7cmV0dXJuIHIubGVuZ3RoPjAmJihlLnBhdGNoZXM9W10sZS5jYWxsYmFjayYmZS5jYWxsYmFjayhyKSkscn1mdW5jdGlvbiBmKGUsbixvLHIpe2Zvcih2YXIgaT1DKG4pLHM9QyhlKSxhPSExLGw9ITEsdT1zLmxlbmd0aC0xO3U+PTA7dS0tKXt2YXIgYz1zW3VdLGQ9ZVtjXTtpZihuLmhhc093blByb3BlcnR5KGMpKXt2YXIgaD1uW2NdO2QgaW5zdGFuY2VvZiBPYmplY3Q/ZihkLGgsbyxyKyIvIit0KGMpKTpkIT1oJiYoYT0hMCxvLnB1c2goe29wOiJyZXBsYWNlIixwYXRoOnIrIi8iK3QoYyksdmFsdWU6aH0pLGVbY109aCl9ZWxzZSBvLnB1c2goe29wOiJyZW1vdmUiLHBhdGg6cisiLyIrdChjKX0pLGRlbGV0ZSBlW2NdLGw9ITB9aWYobHx8aS5sZW5ndGghPXMubGVuZ3RoKWZvcih2YXIgdT0wO3U8aS5sZW5ndGg7dSsrKXt2YXIgYz1pW3VdO2UuaGFzT3duUHJvcGVydHkoYyl8fChvLnB1c2goe29wOiJhZGQiLHBhdGg6cisiLyIrdChjKSx2YWx1ZTpuW2NdfSksZVtjXT1KU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG5bY10pKSl9fWZ1bmN0aW9uIHAoZSx0KXtmb3IodmFyIG4sbz0hMSxyPTAsaT10Lmxlbmd0aDtpPnI7KXtuPXRbcl07Zm9yKHZhciBzPW4ucGF0aC5zcGxpdCgiLyIpLGE9ZSxsPTEsdT1zLmxlbmd0aDs7KWlmKFIoYSkpe3ZhciBjPXBhcnNlSW50KHNbbF0sMTApO2lmKGwrKyxsPj11KXtvPW1bbi5vcF0uY2FsbChuLGEsYyxlKTticmVha31hPWFbY119ZWxzZXt2YXIgZD1zW2xdO2lmKC0xIT1kLmluZGV4T2YoIn4iKSYmKGQ9ZC5yZXBsYWNlKC9+MS9nLCIvIikucmVwbGFjZSgvfjAvZywifiIpKSxsKyssbD49dSl7bz1nW24ub3BdLmNhbGwobixhLGQsZSk7YnJlYWt9YT1hW2RdfXIrK31yZXR1cm4gb312YXIgZz17YWRkOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGVbdF09dGhpcy52YWx1ZSwhMH0scmVtb3ZlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGRlbGV0ZSBlW3RdLCEwfSxyZXBsYWNlOmZ1bmN0aW9uKGUsdCl7cmV0dXJuIGVbdF09dGhpcy52YWx1ZSwhMH0sbW92ZTpmdW5jdGlvbihlLHQsbil7dmFyIG89e29wOiJfZ2V0IixwYXRoOnRoaXMuZnJvbX07cmV0dXJuIHAobixbb10pLHAobixbe29wOiJyZW1vdmUiLHBhdGg6dGhpcy5mcm9tfV0pLHAobixbe29wOiJhZGQiLHBhdGg6dGhpcy5wYXRoLHZhbHVlOm8udmFsdWV9XSksITB9LGNvcHk6ZnVuY3Rpb24oZSx0LG4pe3ZhciBvPXtvcDoiX2dldCIscGF0aDp0aGlzLmZyb219O3JldHVybiBwKG4sW29dKSxwKG4sW3tvcDoiYWRkIixwYXRoOnRoaXMucGF0aCx2YWx1ZTpvLnZhbHVlfV0pLCEwfSx0ZXN0OmZ1bmN0aW9uKGUsdCl7cmV0dXJuIEpTT04uc3RyaW5naWZ5KGVbdF0pPT09SlNPTi5zdHJpbmdpZnkodGhpcy52YWx1ZSl9LF9nZXQ6ZnVuY3Rpb24oZSx0KXt0aGlzLnZhbHVlPWVbdF19fSxtPXthZGQ6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5zcGxpY2UodCwwLHRoaXMudmFsdWUpLCEwfSxyZW1vdmU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5zcGxpY2UodCwxKSwhMH0scmVwbGFjZTpmdW5jdGlvbihlLHQpe3JldHVybiBlW3RdPXRoaXMudmFsdWUsITB9LG1vdmU6Zy5tb3ZlLGNvcHk6Zy5jb3B5LHRlc3Q6Zy50ZXN0LF9nZXQ6Zy5fZ2V0fSx2PXthZGQ6ZnVuY3Rpb24oZSxuKXt2YXIgbz17b3A6ImFkZCIscGF0aDpuK3QodGhpcy5uYW1lKSx2YWx1ZTp0aGlzLm9iamVjdFt0aGlzLm5hbWVdfTtlLnB1c2gobyl9LCJkZWxldGUiOmZ1bmN0aW9uKGUsbil7dmFyIG89e29wOiJyZW1vdmUiLHBhdGg6bit0KHRoaXMubmFtZSl9O2UucHVzaChvKX0sdXBkYXRlOmZ1bmN0aW9uKGUsbil7dmFyIG89e29wOiJyZXBsYWNlIixwYXRoOm4rdCh0aGlzLm5hbWUpLHZhbHVlOnRoaXMub2JqZWN0W3RoaXMubmFtZV19O2UucHVzaChvKX19LHc9W107ZS5pbnRlcnZhbHM7dmFyIHk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKGUpe3RoaXMub2JzZXJ2ZXJzPVtdLHRoaXMub2JqPWV9cmV0dXJuIGV9KCksYj1mdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSx0KXt0aGlzLmNhbGxiYWNrPWUsdGhpcy5vYnNlcnZlcj10fXJldHVybiBlfSgpO2UudW5vYnNlcnZlPWwsZS5vYnNlcnZlPXUsZS5nZW5lcmF0ZT1oO3ZhciBDO0M9T2JqZWN0LmtleXM/T2JqZWN0LmtleXM6ZnVuY3Rpb24oZSl7dmFyIHQ9W107Zm9yKHZhciBuIGluIGUpZS5oYXNPd25Qcm9wZXJ0eShuKSYmdC5wdXNoKG4pO3JldHVybiB0fTt2YXIgUjtSPUFycmF5LmlzQXJyYXk/QXJyYXkuaXNBcnJheTpmdW5jdGlvbihlKXtyZXR1cm4gZS5wdXNoJiYibnVtYmVyIj09dHlwZW9mIGUubGVuZ3RofSxlLmFwcGx5PXB9KG98fChvPXt9KSksInVuZGVmaW5lZCIhPXR5cGVvZiBuJiYobi5hcHBseT1vLmFwcGx5LG4ub2JzZXJ2ZT1vLm9ic2VydmUsbi51bm9ic2VydmU9by51bm9ic2VydmUsbi5nZW5lcmF0ZT1vLmdlbmVyYXRlKX0se31dLG1vbWVudDpbZnVuY3Rpb24odCxuLG8pewovLyEgbW9tZW50LmpzCi8vISB2ZXJzaW9uIDogMi4xMC42Ci8vISBhdXRob3JzIDogVGltIFdvb2QsIElza3JlbiBDaGVybmV2LCBNb21lbnQuanMgY29udHJpYnV0b3JzCi8vISBsaWNlbnNlIDogTUlUCi8vISBtb21lbnRqcy5jb20KIWZ1bmN0aW9uKHQscil7Im9iamVjdCI9PXR5cGVvZiBvJiYidW5kZWZpbmVkIiE9dHlwZW9mIG4/bi5leHBvcnRzPXIoKToiZnVuY3Rpb24iPT10eXBlb2YgZSYmZS5hbWQ/ZShyKTp0Lm1vbWVudD1yKCl9KHRoaXMsZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gZSgpe3JldHVybiBMbi5hcHBseShudWxsLGFyZ3VtZW50cyl9ZnVuY3Rpb24gbyhlKXtMbj1lfWZ1bmN0aW9uIHIoZSl7cmV0dXJuIltvYmplY3QgQXJyYXldIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKX1mdW5jdGlvbiBpKGUpe3JldHVybiBlIGluc3RhbmNlb2YgRGF0ZXx8IltvYmplY3QgRGF0ZV0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpfWZ1bmN0aW9uIHMoZSx0KXt2YXIgbixvPVtdO2ZvcihuPTA7bjxlLmxlbmd0aDsrK24pby5wdXNoKHQoZVtuXSxuKSk7cmV0dXJuIG99ZnVuY3Rpb24gYShlLHQpe3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KX1mdW5jdGlvbiBsKGUsdCl7Zm9yKHZhciBuIGluIHQpYSh0LG4pJiYoZVtuXT10W25dKTtyZXR1cm4gYSh0LCJ0b1N0cmluZyIpJiYoZS50b1N0cmluZz10LnRvU3RyaW5nKSxhKHQsInZhbHVlT2YiKSYmKGUudmFsdWVPZj10LnZhbHVlT2YpLGV9ZnVuY3Rpb24gdShlLHQsbixvKXtyZXR1cm4gSGUoZSx0LG4sbywhMCkudXRjKCl9ZnVuY3Rpb24gYygpe3JldHVybntlbXB0eTohMSx1bnVzZWRUb2tlbnM6W10sdW51c2VkSW5wdXQ6W10sb3ZlcmZsb3c6LTIsY2hhcnNMZWZ0T3ZlcjowLG51bGxJbnB1dDohMSxpbnZhbGlkTW9udGg6bnVsbCxpbnZhbGlkRm9ybWF0OiExLHVzZXJJbnZhbGlkYXRlZDohMSxpc286ITF9fWZ1bmN0aW9uIGQoZSl7cmV0dXJuIG51bGw9PWUuX3BmJiYoZS5fcGY9YygpKSxlLl9wZn1mdW5jdGlvbiBoKGUpe2lmKG51bGw9PWUuX2lzVmFsaWQpe3ZhciB0PWQoZSk7ZS5faXNWYWxpZD0hKGlzTmFOKGUuX2QuZ2V0VGltZSgpKXx8ISh0Lm92ZXJmbG93PDApfHx0LmVtcHR5fHx0LmludmFsaWRNb250aHx8dC5pbnZhbGlkV2Vla2RheXx8dC5udWxsSW5wdXR8fHQuaW52YWxpZEZvcm1hdHx8dC51c2VySW52YWxpZGF0ZWQpLGUuX3N0cmljdCYmKGUuX2lzVmFsaWQ9ZS5faXNWYWxpZCYmMD09PXQuY2hhcnNMZWZ0T3ZlciYmMD09PXQudW51c2VkVG9rZW5zLmxlbmd0aCYmdm9pZCAwPT09dC5iaWdIb3VyKX1yZXR1cm4gZS5faXNWYWxpZH1mdW5jdGlvbiBmKGUpe3ZhciB0PXUoTmFOKTtyZXR1cm4gbnVsbCE9ZT9sKGQodCksZSk6ZCh0KS51c2VySW52YWxpZGF0ZWQ9ITAsdH1mdW5jdGlvbiBwKGUsdCl7dmFyIG4sbyxyO2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgdC5faXNBTW9tZW50T2JqZWN0JiYoZS5faXNBTW9tZW50T2JqZWN0PXQuX2lzQU1vbWVudE9iamVjdCksInVuZGVmaW5lZCIhPXR5cGVvZiB0Ll9pJiYoZS5faT10Ll9pKSwidW5kZWZpbmVkIiE9dHlwZW9mIHQuX2YmJihlLl9mPXQuX2YpLCJ1bmRlZmluZWQiIT10eXBlb2YgdC5fbCYmKGUuX2w9dC5fbCksInVuZGVmaW5lZCIhPXR5cGVvZiB0Ll9zdHJpY3QmJihlLl9zdHJpY3Q9dC5fc3RyaWN0KSwidW5kZWZpbmVkIiE9dHlwZW9mIHQuX3R6bSYmKGUuX3R6bT10Ll90em0pLCJ1bmRlZmluZWQiIT10eXBlb2YgdC5faXNVVEMmJihlLl9pc1VUQz10Ll9pc1VUQyksInVuZGVmaW5lZCIhPXR5cGVvZiB0Ll9vZmZzZXQmJihlLl9vZmZzZXQ9dC5fb2Zmc2V0KSwidW5kZWZpbmVkIiE9dHlwZW9mIHQuX3BmJiYoZS5fcGY9ZCh0KSksInVuZGVmaW5lZCIhPXR5cGVvZiB0Ll9sb2NhbGUmJihlLl9sb2NhbGU9dC5fbG9jYWxlKSxJbi5sZW5ndGg+MClmb3IobiBpbiBJbilvPUluW25dLHI9dFtvXSwidW5kZWZpbmVkIiE9dHlwZW9mIHImJihlW29dPXIpO3JldHVybiBlfWZ1bmN0aW9uIGcodCl7cCh0aGlzLHQpLHRoaXMuX2Q9bmV3IERhdGUobnVsbCE9dC5fZD90Ll9kLmdldFRpbWUoKTpOYU4pLGpuPT09ITEmJihqbj0hMCxlLnVwZGF0ZU9mZnNldCh0aGlzKSxqbj0hMSl9ZnVuY3Rpb24gbShlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIGd8fG51bGwhPWUmJm51bGwhPWUuX2lzQU1vbWVudE9iamVjdH1mdW5jdGlvbiB2KGUpe3JldHVybiAwPmU/TWF0aC5jZWlsKGUpOk1hdGguZmxvb3IoZSl9ZnVuY3Rpb24gdyhlKXt2YXIgdD0rZSxuPTA7cmV0dXJuIDAhPT10JiZpc0Zpbml0ZSh0KSYmKG49dih0KSksbn1mdW5jdGlvbiB5KGUsdCxuKXt2YXIgbyxyPU1hdGgubWluKGUubGVuZ3RoLHQubGVuZ3RoKSxpPU1hdGguYWJzKGUubGVuZ3RoLXQubGVuZ3RoKSxzPTA7Zm9yKG89MDtyPm87bysrKShuJiZlW29dIT09dFtvXXx8IW4mJncoZVtvXSkhPT13KHRbb10pKSYmcysrO3JldHVybiBzK2l9ZnVuY3Rpb24gYigpe31mdW5jdGlvbiBDKGUpe3JldHVybiBlP2UudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCJfIiwiLSIpOmV9ZnVuY3Rpb24gUihlKXtmb3IodmFyIHQsbixvLHIsaT0wO2k8ZS5sZW5ndGg7KXtmb3Iocj1DKGVbaV0pLnNwbGl0KCItIiksdD1yLmxlbmd0aCxuPUMoZVtpKzFdKSxuPW4/bi5zcGxpdCgiLSIpOm51bGw7dD4wOyl7aWYobz1fKHIuc2xpY2UoMCx0KS5qb2luKCItIikpKXJldHVybiBvO2lmKG4mJm4ubGVuZ3RoPj10JiZ5KHIsbiwhMCk+PXQtMSlicmVhazt0LS19aSsrfXJldHVybiBudWxsfWZ1bmN0aW9uIF8oZSl7dmFyIG89bnVsbDtpZighQm5bZV0mJiJ1bmRlZmluZWQiIT10eXBlb2YgbiYmbiYmbi5leHBvcnRzKXRyeXtvPVduLl9hYmJyLHQoIi4vbG9jYWxlLyIrZSksUyhvKX1jYXRjaChyKXt9cmV0dXJuIEJuW2VdfWZ1bmN0aW9uIFMoZSx0KXt2YXIgbjtyZXR1cm4gZSYmKG49InVuZGVmaW5lZCI9PXR5cGVvZiB0P1QoZSk6RShlLHQpLG4mJihXbj1uKSksV24uX2FiYnJ9ZnVuY3Rpb24gRShlLHQpe3JldHVybiBudWxsIT09dD8odC5hYmJyPWUsQm5bZV09Qm5bZV18fG5ldyBiLEJuW2VdLnNldCh0KSxTKGUpLEJuW2VdKTooZGVsZXRlIEJuW2VdLG51bGwpfWZ1bmN0aW9uIFQoZSl7dmFyIHQ7aWYoZSYmZS5fbG9jYWxlJiZlLl9sb2NhbGUuX2FiYnImJihlPWUuX2xvY2FsZS5fYWJiciksIWUpcmV0dXJuIFduO2lmKCFyKGUpKXtpZih0PV8oZSkpcmV0dXJuIHQ7ZT1bZV19cmV0dXJuIFIoZSl9ZnVuY3Rpb24gTyhlLHQpe3ZhciBuPWUudG9Mb3dlckNhc2UoKTtGbltuXT1GbltuKyJzIl09Rm5bdF09ZX1mdW5jdGlvbiBNKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZT9GbltlXXx8Rm5bZS50b0xvd2VyQ2FzZSgpXTp2b2lkIDB9ZnVuY3Rpb24gayhlKXt2YXIgdCxuLG89e307Zm9yKG4gaW4gZSlhKGUsbikmJih0PU0obiksdCYmKG9bdF09ZVtuXSkpO3JldHVybiBvfWZ1bmN0aW9uIEgodCxuKXtyZXR1cm4gZnVuY3Rpb24obyl7cmV0dXJuIG51bGwhPW8/KHgodGhpcyx0LG8pLGUudXBkYXRlT2Zmc2V0KHRoaXMsbiksdGhpcyk6RCh0aGlzLHQpfX1mdW5jdGlvbiBEKGUsdCl7cmV0dXJuIGUuX2RbImdldCIrKGUuX2lzVVRDPyJVVEMiOiIiKSt0XSgpfWZ1bmN0aW9uIHgoZSx0LG4pe3JldHVybiBlLl9kWyJzZXQiKyhlLl9pc1VUQz8iVVRDIjoiIikrdF0obil9ZnVuY3Rpb24gQShlLHQpe3ZhciBuO2lmKCJvYmplY3QiPT10eXBlb2YgZSlmb3IobiBpbiBlKXRoaXMuc2V0KG4sZVtuXSk7ZWxzZSBpZihlPU0oZSksImZ1bmN0aW9uIj09dHlwZW9mIHRoaXNbZV0pcmV0dXJuIHRoaXNbZV0odCk7cmV0dXJuIHRoaXN9ZnVuY3Rpb24gUChlLHQsbil7dmFyIG89IiIrTWF0aC5hYnMoZSkscj10LW8ubGVuZ3RoLGk9ZT49MDtyZXR1cm4oaT9uPyIrIjoiIjoiLSIpK01hdGgucG93KDEwLE1hdGgubWF4KDAscikpLnRvU3RyaW5nKCkuc3Vic3RyKDEpK299ZnVuY3Rpb24gTihlLHQsbixvKXt2YXIgcj1vOyJzdHJpbmciPT10eXBlb2YgbyYmKHI9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpc1tvXSgpfSksZSYmKFVuW2VdPXIpLHQmJihVblt0WzBdXT1mdW5jdGlvbigpe3JldHVybiBQKHIuYXBwbHkodGhpcyxhcmd1bWVudHMpLHRbMV0sdFsyXSl9KSxuJiYoVW5bbl09ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkub3JkaW5hbChyLmFwcGx5KHRoaXMsYXJndW1lbnRzKSxlKX0pfWZ1bmN0aW9uIEwoZSl7cmV0dXJuIGUubWF0Y2goL1xbW1xzXFNdLyk/ZS5yZXBsYWNlKC9eXFt8XF0kL2csIiIpOmUucmVwbGFjZSgvXFwvZywiIil9ZnVuY3Rpb24gVyhlKXt2YXIgdCxuLG89ZS5tYXRjaChWbik7Zm9yKHQ9MCxuPW8ubGVuZ3RoO24+dDt0KyspVW5bb1t0XV0/b1t0XT1VbltvW3RdXTpvW3RdPUwob1t0XSk7cmV0dXJuIGZ1bmN0aW9uKHIpe3ZhciBpPSIiO2Zvcih0PTA7bj50O3QrKylpKz1vW3RdaW5zdGFuY2VvZiBGdW5jdGlvbj9vW3RdLmNhbGwocixlKTpvW3RdO3JldHVybiBpfX1mdW5jdGlvbiBJKGUsdCl7cmV0dXJuIGUuaXNWYWxpZCgpPyh0PWoodCxlLmxvY2FsZURhdGEoKSksWW5bdF09WW5bdF18fFcodCksWW5bdF0oZSkpOmUubG9jYWxlRGF0YSgpLmludmFsaWREYXRlKCl9ZnVuY3Rpb24gaihlLHQpe2Z1bmN0aW9uIG4oZSl7cmV0dXJuIHQubG9uZ0RhdGVGb3JtYXQoZSl8fGV9dmFyIG89NTtmb3Ioem4ubGFzdEluZGV4PTA7bz49MCYmem4udGVzdChlKTspZT1lLnJlcGxhY2Uoem4sbiksem4ubGFzdEluZGV4PTAsby09MTtyZXR1cm4gZX1mdW5jdGlvbiBCKGUpe3JldHVybiJmdW5jdGlvbiI9PXR5cGVvZiBlJiYiW29iamVjdCBGdW5jdGlvbl0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpfWZ1bmN0aW9uIEYoZSx0LG4pe3NvW2VdPUIodCk/dDpmdW5jdGlvbihlKXtyZXR1cm4gZSYmbj9uOnR9fWZ1bmN0aW9uIFYoZSx0KXtyZXR1cm4gYShzbyxlKT9zb1tlXSh0Ll9zdHJpY3QsdC5fbG9jYWxlKTpuZXcgUmVnRXhwKHooZSkpfWZ1bmN0aW9uIHooZSl7cmV0dXJuIGUucmVwbGFjZSgiXFwiLCIiKS5yZXBsYWNlKC9cXChcWyl8XFwoXF0pfFxbKFteXF1cW10qKVxdfFxcKC4pL2csZnVuY3Rpb24oZSx0LG4sbyxyKXtyZXR1cm4gdHx8bnx8b3x8cn0pLnJlcGxhY2UoL1stXC9cXF4kKis/LigpfFtcXXt9XS9nLCJcXCQmIil9ZnVuY3Rpb24gWShlLHQpe3ZhciBuLG89dDtmb3IoInN0cmluZyI9PXR5cGVvZiBlJiYoZT1bZV0pLCJudW1iZXIiPT10eXBlb2YgdCYmKG89ZnVuY3Rpb24oZSxuKXtuW3RdPXcoZSl9KSxuPTA7bjxlLmxlbmd0aDtuKyspYW9bZVtuXV09b31mdW5jdGlvbiBVKGUsdCl7WShlLGZ1bmN0aW9uKGUsbixvLHIpe28uX3c9by5fd3x8e30sdChlLG8uX3csbyxyKX0pfWZ1bmN0aW9uIEcoZSx0LG4pe251bGwhPXQmJmEoYW8sZSkmJmFvW2VdKHQsbi5fYSxuLGUpfWZ1bmN0aW9uICQoZSx0KXtyZXR1cm4gbmV3IERhdGUoRGF0ZS5VVEMoZSx0KzEsMCkpLmdldFVUQ0RhdGUoKX1mdW5jdGlvbiBLKGUpe3JldHVybiB0aGlzLl9tb250aHNbZS5tb250aCgpXX1mdW5jdGlvbiBYKGUpe3JldHVybiB0aGlzLl9tb250aHNTaG9ydFtlLm1vbnRoKCldfWZ1bmN0aW9uIHEoZSx0LG4pe3ZhciBvLHIsaTtmb3IodGhpcy5fbW9udGhzUGFyc2V8fCh0aGlzLl9tb250aHNQYXJzZT1bXSx0aGlzLl9sb25nTW9udGhzUGFyc2U9W10sdGhpcy5fc2hvcnRNb250aHNQYXJzZT1bXSksbz0wOzEyPm87bysrKXtpZihyPXUoWzJlMyxvXSksbiYmIXRoaXMuX2xvbmdNb250aHNQYXJzZVtvXSYmKHRoaXMuX2xvbmdNb250aHNQYXJzZVtvXT1uZXcgUmVnRXhwKCJeIit0aGlzLm1vbnRocyhyLCIiKS5yZXBsYWNlKCIuIiwiIikrIiQiLCJpIiksdGhpcy5fc2hvcnRNb250aHNQYXJzZVtvXT1uZXcgUmVnRXhwKCJeIit0aGlzLm1vbnRoc1Nob3J0KHIsIiIpLnJlcGxhY2UoIi4iLCIiKSsiJCIsImkiKSksbnx8dGhpcy5fbW9udGhzUGFyc2Vbb118fChpPSJeIit0aGlzLm1vbnRocyhyLCIiKSsifF4iK3RoaXMubW9udGhzU2hvcnQociwiIiksdGhpcy5fbW9udGhzUGFyc2Vbb109bmV3IFJlZ0V4cChpLnJlcGxhY2UoIi4iLCIiKSwiaSIpKSxuJiYiTU1NTSI9PT10JiZ0aGlzLl9sb25nTW9udGhzUGFyc2Vbb10udGVzdChlKSlyZXR1cm4gbztpZihuJiYiTU1NIj09PXQmJnRoaXMuX3Nob3J0TW9udGhzUGFyc2Vbb10udGVzdChlKSlyZXR1cm4gbztpZighbiYmdGhpcy5fbW9udGhzUGFyc2Vbb10udGVzdChlKSlyZXR1cm4gb319ZnVuY3Rpb24gWihlLHQpe3ZhciBuO3JldHVybiJzdHJpbmciPT10eXBlb2YgdCYmKHQ9ZS5sb2NhbGVEYXRhKCkubW9udGhzUGFyc2UodCksIm51bWJlciIhPXR5cGVvZiB0KT9lOihuPU1hdGgubWluKGUuZGF0ZSgpLCQoZS55ZWFyKCksdCkpLGUuX2RbInNldCIrKGUuX2lzVVRDPyJVVEMiOiIiKSsiTW9udGgiXSh0LG4pLGUpfWZ1bmN0aW9uIEoodCl7cmV0dXJuIG51bGwhPXQ/KFoodGhpcyx0KSxlLnVwZGF0ZU9mZnNldCh0aGlzLCEwKSx0aGlzKTpEKHRoaXMsIk1vbnRoIil9ZnVuY3Rpb24gUSgpe3JldHVybiAkKHRoaXMueWVhcigpLHRoaXMubW9udGgoKSl9ZnVuY3Rpb24gZWUoZSl7dmFyIHQsbj1lLl9hO3JldHVybiBuJiYtMj09PWQoZSkub3ZlcmZsb3cmJih0PW5bdW9dPDB8fG5bdW9dPjExP3VvOm5bY29dPDF8fG5bY29dPiQobltsb10sblt1b10pP2NvOm5baG9dPDB8fG5baG9dPjI0fHwyND09PW5baG9dJiYoMCE9PW5bZm9dfHwwIT09bltwb118fDAhPT1uW2dvXSk/aG86bltmb108MHx8bltmb10+NTk/Zm86bltwb108MHx8bltwb10+NTk/cG86bltnb108MHx8bltnb10+OTk5P2dvOi0xLGQoZSkuX292ZXJmbG93RGF5T2ZZZWFyJiYobG8+dHx8dD5jbykmJih0PWNvKSxkKGUpLm92ZXJmbG93PXQpLGV9ZnVuY3Rpb24gdGUodCl7ZS5zdXBwcmVzc0RlcHJlY2F0aW9uV2FybmluZ3M9PT0hMSYmInVuZGVmaW5lZCIhPXR5cGVvZiBjb25zb2xlJiZjb25zb2xlLndhcm4mJmNvbnNvbGUud2FybigiRGVwcmVjYXRpb24gd2FybmluZzogIit0KX1mdW5jdGlvbiBuZShlLHQpe3ZhciBuPSEwO3JldHVybiBsKGZ1bmN0aW9uKCl7cmV0dXJuIG4mJih0ZShlKyJcbiIrKG5ldyBFcnJvcikuc3RhY2spLG49ITEpLHQuYXBwbHkodGhpcyxhcmd1bWVudHMpfSx0KX1mdW5jdGlvbiBvZShlLHQpe3dvW2VdfHwodGUodCksd29bZV09ITApfWZ1bmN0aW9uIHJlKGUpe3ZhciB0LG4sbz1lLl9pLHI9eW8uZXhlYyhvKTtpZihyKXtmb3IoZChlKS5pc289ITAsdD0wLG49Ym8ubGVuZ3RoO24+dDt0KyspaWYoYm9bdF1bMV0uZXhlYyhvKSl7ZS5fZj1ib1t0XVswXTticmVha31mb3IodD0wLG49Q28ubGVuZ3RoO24+dDt0KyspaWYoQ29bdF1bMV0uZXhlYyhvKSl7ZS5fZis9KHJbNl18fCIgIikrQ29bdF1bMF07YnJlYWt9by5tYXRjaChvbykmJihlLl9mKz0iWiIpLF9lKGUpfWVsc2UgZS5faXNWYWxpZD0hMX1mdW5jdGlvbiBpZSh0KXt2YXIgbj1Sby5leGVjKHQuX2kpO3JldHVybiBudWxsIT09bj92b2lkKHQuX2Q9bmV3IERhdGUoK25bMV0pKToocmUodCksdm9pZCh0Ll9pc1ZhbGlkPT09ITEmJihkZWxldGUgdC5faXNWYWxpZCxlLmNyZWF0ZUZyb21JbnB1dEZhbGxiYWNrKHQpKSkpfWZ1bmN0aW9uIHNlKGUsdCxuLG8scixpLHMpe3ZhciBhPW5ldyBEYXRlKGUsdCxuLG8scixpLHMpO3JldHVybiAxOTcwPmUmJmEuc2V0RnVsbFllYXIoZSksYX1mdW5jdGlvbiBhZShlKXt2YXIgdD1uZXcgRGF0ZShEYXRlLlVUQy5hcHBseShudWxsLGFyZ3VtZW50cykpO3JldHVybiAxOTcwPmUmJnQuc2V0VVRDRnVsbFllYXIoZSksdH1mdW5jdGlvbiBsZShlKXtyZXR1cm4gdWUoZSk/MzY2OjM2NX1mdW5jdGlvbiB1ZShlKXtyZXR1cm4gZSU0PT09MCYmZSUxMDAhPT0wfHxlJTQwMD09PTB9ZnVuY3Rpb24gY2UoKXtyZXR1cm4gdWUodGhpcy55ZWFyKCkpfWZ1bmN0aW9uIGRlKGUsdCxuKXt2YXIgbyxyPW4tdCxpPW4tZS5kYXkoKTtyZXR1cm4gaT5yJiYoaS09Nyksci03PmkmJihpKz03KSxvPURlKGUpLmFkZChpLCJkIikse3dlZWs6TWF0aC5jZWlsKG8uZGF5T2ZZZWFyKCkvNykseWVhcjpvLnllYXIoKX19ZnVuY3Rpb24gaGUoZSl7cmV0dXJuIGRlKGUsdGhpcy5fd2Vlay5kb3csdGhpcy5fd2Vlay5kb3kpLndlZWt9ZnVuY3Rpb24gZmUoKXtyZXR1cm4gdGhpcy5fd2Vlay5kb3d9ZnVuY3Rpb24gcGUoKXtyZXR1cm4gdGhpcy5fd2Vlay5kb3l9ZnVuY3Rpb24gZ2UoZSl7dmFyIHQ9dGhpcy5sb2NhbGVEYXRhKCkud2Vlayh0aGlzKTtyZXR1cm4gbnVsbD09ZT90OnRoaXMuYWRkKDcqKGUtdCksImQiKX1mdW5jdGlvbiBtZShlKXt2YXIgdD1kZSh0aGlzLDEsNCkud2VlaztyZXR1cm4gbnVsbD09ZT90OnRoaXMuYWRkKDcqKGUtdCksImQiKX1mdW5jdGlvbiB2ZShlLHQsbixvLHIpe3ZhciBpLHM9NityLW8sYT1hZShlLDAsMStzKSxsPWEuZ2V0VVRDRGF5KCk7cmV0dXJuIHI+bCYmKGwrPTcpLG49bnVsbCE9bj8xKm46cixpPTErcys3Kih0LTEpLWwrbix7eWVhcjppPjA/ZTplLTEsZGF5T2ZZZWFyOmk+MD9pOmxlKGUtMSkraX19ZnVuY3Rpb24gd2UoZSl7dmFyIHQ9TWF0aC5yb3VuZCgodGhpcy5jbG9uZSgpLnN0YXJ0T2YoImRheSIpLXRoaXMuY2xvbmUoKS5zdGFydE9mKCJ5ZWFyIikpLzg2NGU1KSsxO3JldHVybiBudWxsPT1lP3Q6dGhpcy5hZGQoZS10LCJkIil9ZnVuY3Rpb24geWUoZSx0LG4pe3JldHVybiBudWxsIT1lP2U6bnVsbCE9dD90Om59ZnVuY3Rpb24gYmUoZSl7dmFyIHQ9bmV3IERhdGU7cmV0dXJuIGUuX3VzZVVUQz9bdC5nZXRVVENGdWxsWWVhcigpLHQuZ2V0VVRDTW9udGgoKSx0LmdldFVUQ0RhdGUoKV06W3QuZ2V0RnVsbFllYXIoKSx0LmdldE1vbnRoKCksdC5nZXREYXRlKCldfWZ1bmN0aW9uIENlKGUpe3ZhciB0LG4sbyxyLGk9W107aWYoIWUuX2Qpe2ZvcihvPWJlKGUpLGUuX3cmJm51bGw9PWUuX2FbY29dJiZudWxsPT1lLl9hW3VvXSYmUmUoZSksZS5fZGF5T2ZZZWFyJiYocj15ZShlLl9hW2xvXSxvW2xvXSksZS5fZGF5T2ZZZWFyPmxlKHIpJiYoZChlKS5fb3ZlcmZsb3dEYXlPZlllYXI9ITApLG49YWUociwwLGUuX2RheU9mWWVhciksZS5fYVt1b109bi5nZXRVVENNb250aCgpLGUuX2FbY29dPW4uZ2V0VVRDRGF0ZSgpKSx0PTA7Mz50JiZudWxsPT1lLl9hW3RdOysrdCllLl9hW3RdPWlbdF09b1t0XTtmb3IoOzc+dDt0KyspZS5fYVt0XT1pW3RdPW51bGw9PWUuX2FbdF0/Mj09PXQ/MTowOmUuX2FbdF07MjQ9PT1lLl9hW2hvXSYmMD09PWUuX2FbZm9dJiYwPT09ZS5fYVtwb10mJjA9PT1lLl9hW2dvXSYmKGUuX25leHREYXk9ITAsZS5fYVtob109MCksZS5fZD0oZS5fdXNlVVRDP2FlOnNlKS5hcHBseShudWxsLGkpLG51bGwhPWUuX3R6bSYmZS5fZC5zZXRVVENNaW51dGVzKGUuX2QuZ2V0VVRDTWludXRlcygpLWUuX3R6bSksZS5fbmV4dERheSYmKGUuX2FbaG9dPTI0KX19ZnVuY3Rpb24gUmUoZSl7dmFyIHQsbixvLHIsaSxzLGE7dD1lLl93LG51bGwhPXQuR0d8fG51bGwhPXQuV3x8bnVsbCE9dC5FPyhpPTEscz00LG49eWUodC5HRyxlLl9hW2xvXSxkZShEZSgpLDEsNCkueWVhciksbz15ZSh0LlcsMSkscj15ZSh0LkUsMSkpOihpPWUuX2xvY2FsZS5fd2Vlay5kb3cscz1lLl9sb2NhbGUuX3dlZWsuZG95LG49eWUodC5nZyxlLl9hW2xvXSxkZShEZSgpLGkscykueWVhciksbz15ZSh0LncsMSksbnVsbCE9dC5kPyhyPXQuZCxpPnImJisrbyk6cj1udWxsIT10LmU/dC5lK2k6aSksYT12ZShuLG8scixzLGkpLGUuX2FbbG9dPWEueWVhcixlLl9kYXlPZlllYXI9YS5kYXlPZlllYXJ9ZnVuY3Rpb24gX2UodCl7aWYodC5fZj09PWUuSVNPXzg2MDEpcmV0dXJuIHZvaWQgcmUodCk7dC5fYT1bXSxkKHQpLmVtcHR5PSEwO3ZhciBuLG8scixpLHMsYT0iIit0Ll9pLGw9YS5sZW5ndGgsdT0wO2ZvcihyPWoodC5fZix0Ll9sb2NhbGUpLm1hdGNoKFZuKXx8W10sbj0wO248ci5sZW5ndGg7bisrKWk9cltuXSxvPShhLm1hdGNoKFYoaSx0KSl8fFtdKVswXSxvJiYocz1hLnN1YnN0cigwLGEuaW5kZXhPZihvKSkscy5sZW5ndGg+MCYmZCh0KS51bnVzZWRJbnB1dC5wdXNoKHMpLGE9YS5zbGljZShhLmluZGV4T2Yobykrby5sZW5ndGgpLHUrPW8ubGVuZ3RoKSxVbltpXT8obz9kKHQpLmVtcHR5PSExOmQodCkudW51c2VkVG9rZW5zLnB1c2goaSksRyhpLG8sdCkpOnQuX3N0cmljdCYmIW8mJmQodCkudW51c2VkVG9rZW5zLnB1c2goaSk7ZCh0KS5jaGFyc0xlZnRPdmVyPWwtdSxhLmxlbmd0aD4wJiZkKHQpLnVudXNlZElucHV0LnB1c2goYSksZCh0KS5iaWdIb3VyPT09ITAmJnQuX2FbaG9dPD0xMiYmdC5fYVtob10+MCYmKGQodCkuYmlnSG91cj12b2lkIDApLHQuX2FbaG9dPVNlKHQuX2xvY2FsZSx0Ll9hW2hvXSx0Ll9tZXJpZGllbSksQ2UodCksZWUodCl9ZnVuY3Rpb24gU2UoZSx0LG4pe3ZhciBvO3JldHVybiBudWxsPT1uP3Q6bnVsbCE9ZS5tZXJpZGllbUhvdXI/ZS5tZXJpZGllbUhvdXIodCxuKTpudWxsIT1lLmlzUE0/KG89ZS5pc1BNKG4pLG8mJjEyPnQmJih0Kz0xMiksb3x8MTIhPT10fHwodD0wKSx0KTp0fWZ1bmN0aW9uIEVlKGUpe3ZhciB0LG4sbyxyLGk7aWYoMD09PWUuX2YubGVuZ3RoKXJldHVybiBkKGUpLmludmFsaWRGb3JtYXQ9ITAsdm9pZChlLl9kPW5ldyBEYXRlKE5hTikpO2ZvcihyPTA7cjxlLl9mLmxlbmd0aDtyKyspaT0wLHQ9cCh7fSxlKSxudWxsIT1lLl91c2VVVEMmJih0Ll91c2VVVEM9ZS5fdXNlVVRDKSx0Ll9mPWUuX2Zbcl0sX2UodCksaCh0KSYmKGkrPWQodCkuY2hhcnNMZWZ0T3ZlcixpKz0xMCpkKHQpLnVudXNlZFRva2Vucy5sZW5ndGgsZCh0KS5zY29yZT1pLChudWxsPT1vfHxvPmkpJiYobz1pLG49dCkpO2woZSxufHx0KX1mdW5jdGlvbiBUZShlKXtpZighZS5fZCl7dmFyIHQ9ayhlLl9pKTtlLl9hPVt0LnllYXIsdC5tb250aCx0LmRheXx8dC5kYXRlLHQuaG91cix0Lm1pbnV0ZSx0LnNlY29uZCx0Lm1pbGxpc2Vjb25kXSxDZShlKX19ZnVuY3Rpb24gT2UoZSl7dmFyIHQ9bmV3IGcoZWUoTWUoZSkpKTtyZXR1cm4gdC5fbmV4dERheSYmKHQuYWRkKDEsImQiKSx0Ll9uZXh0RGF5PXZvaWQgMCksdH1mdW5jdGlvbiBNZShlKXt2YXIgdD1lLl9pLG49ZS5fZjtyZXR1cm4gZS5fbG9jYWxlPWUuX2xvY2FsZXx8VChlLl9sKSxudWxsPT09dHx8dm9pZCAwPT09biYmIiI9PT10P2Yoe251bGxJbnB1dDohMH0pOigic3RyaW5nIj09dHlwZW9mIHQmJihlLl9pPXQ9ZS5fbG9jYWxlLnByZXBhcnNlKHQpKSxtKHQpP25ldyBnKGVlKHQpKToocihuKT9FZShlKTpuP19lKGUpOmkodCk/ZS5fZD10OmtlKGUpLGUpKX1mdW5jdGlvbiBrZSh0KXt2YXIgbj10Ll9pO3ZvaWQgMD09PW4/dC5fZD1uZXcgRGF0ZTppKG4pP3QuX2Q9bmV3IERhdGUoK24pOiJzdHJpbmciPT10eXBlb2Ygbj9pZSh0KTpyKG4pPyh0Ll9hPXMobi5zbGljZSgwKSxmdW5jdGlvbihlKXtyZXR1cm4gcGFyc2VJbnQoZSwxMCl9KSxDZSh0KSk6Im9iamVjdCI9PXR5cGVvZiBuP1RlKHQpOiJudW1iZXIiPT10eXBlb2Ygbj90Ll9kPW5ldyBEYXRlKG4pOmUuY3JlYXRlRnJvbUlucHV0RmFsbGJhY2sodCl9ZnVuY3Rpb24gSGUoZSx0LG4sbyxyKXt2YXIgaT17fTtyZXR1cm4iYm9vbGVhbiI9PXR5cGVvZiBuJiYobz1uLG49dm9pZCAwKSxpLl9pc0FNb21lbnRPYmplY3Q9ITAsaS5fdXNlVVRDPWkuX2lzVVRDPXIsaS5fbD1uLGkuX2k9ZSxpLl9mPXQsaS5fc3RyaWN0PW8sT2UoaSl9ZnVuY3Rpb24gRGUoZSx0LG4sbyl7cmV0dXJuIEhlKGUsdCxuLG8sITEpfWZ1bmN0aW9uIHhlKGUsdCl7dmFyIG4sbztpZigxPT09dC5sZW5ndGgmJnIodFswXSkmJih0PXRbMF0pLCF0Lmxlbmd0aClyZXR1cm4gRGUoKTtmb3Iobj10WzBdLG89MTtvPHQubGVuZ3RoOysrbykoIXRbb10uaXNWYWxpZCgpfHx0W29dW2VdKG4pKSYmKG49dFtvXSk7cmV0dXJuIG59ZnVuY3Rpb24gQWUoKXt2YXIgZT1bXS5zbGljZS5jYWxsKGFyZ3VtZW50cywwKTtyZXR1cm4geGUoImlzQmVmb3JlIixlKX1mdW5jdGlvbiBQZSgpe3ZhciBlPVtdLnNsaWNlLmNhbGwoYXJndW1lbnRzLDApO3JldHVybiB4ZSgiaXNBZnRlciIsZSl9ZnVuY3Rpb24gTmUoZSl7dmFyIHQ9ayhlKSxuPXQueWVhcnx8MCxvPXQucXVhcnRlcnx8MCxyPXQubW9udGh8fDAsaT10LndlZWt8fDAscz10LmRheXx8MCxhPXQuaG91cnx8MCxsPXQubWludXRlfHwwLHU9dC5zZWNvbmR8fDAsYz10Lm1pbGxpc2Vjb25kfHwwO3RoaXMuX21pbGxpc2Vjb25kcz0rYysxZTMqdSs2ZTQqbCszNmU1KmEsdGhpcy5fZGF5cz0rcys3KmksdGhpcy5fbW9udGhzPStyKzMqbysxMipuLHRoaXMuX2RhdGE9e30sdGhpcy5fbG9jYWxlPVQoKSx0aGlzLl9idWJibGUoKX1mdW5jdGlvbiBMZShlKXtyZXR1cm4gZSBpbnN0YW5jZW9mIE5lfWZ1bmN0aW9uIFdlKGUsdCl7TihlLDAsMCxmdW5jdGlvbigpe3ZhciBlPXRoaXMudXRjT2Zmc2V0KCksbj0iKyI7cmV0dXJuIDA+ZSYmKGU9LWUsbj0iLSIpLG4rUCh+fihlLzYwKSwyKSt0K1Aofn5lJTYwLDIpfSl9ZnVuY3Rpb24gSWUoZSl7dmFyIHQ9KGV8fCIiKS5tYXRjaChvbyl8fFtdLG49dFt0Lmxlbmd0aC0xXXx8W10sbz0obisiIikubWF0Y2goT28pfHxbIi0iLDAsMF0scj0rKDYwKm9bMV0pK3cob1syXSk7cmV0dXJuIisiPT09b1swXT9yOi1yfWZ1bmN0aW9uIGplKHQsbil7dmFyIG8scjtyZXR1cm4gbi5faXNVVEM/KG89bi5jbG9uZSgpLHI9KG0odCl8fGkodCk/K3Q6K0RlKHQpKS0rbyxvLl9kLnNldFRpbWUoK28uX2QrciksZS51cGRhdGVPZmZzZXQobywhMSksbyk6RGUodCkubG9jYWwoKX1mdW5jdGlvbiBCZShlKXtyZXR1cm4gMTUqLU1hdGgucm91bmQoZS5fZC5nZXRUaW1lem9uZU9mZnNldCgpLzE1KX1mdW5jdGlvbiBGZSh0LG4pe3ZhciBvLHI9dGhpcy5fb2Zmc2V0fHwwO3JldHVybiBudWxsIT10Pygic3RyaW5nIj09dHlwZW9mIHQmJih0PUllKHQpKSxNYXRoLmFicyh0KTwxNiYmKHQ9NjAqdCksIXRoaXMuX2lzVVRDJiZuJiYobz1CZSh0aGlzKSksdGhpcy5fb2Zmc2V0PXQsdGhpcy5faXNVVEM9ITAsbnVsbCE9byYmdGhpcy5hZGQobywibSIpLHIhPT10JiYoIW58fHRoaXMuX2NoYW5nZUluUHJvZ3Jlc3M/b3QodGhpcyxKZSh0LXIsIm0iKSwxLCExKTp0aGlzLl9jaGFuZ2VJblByb2dyZXNzfHwodGhpcy5fY2hhbmdlSW5Qcm9ncmVzcz0hMCxlLnVwZGF0ZU9mZnNldCh0aGlzLCEwKSx0aGlzLl9jaGFuZ2VJblByb2dyZXNzPW51bGwpKSx0aGlzKTp0aGlzLl9pc1VUQz9yOkJlKHRoaXMpfWZ1bmN0aW9uIFZlKGUsdCl7cmV0dXJuIG51bGwhPWU/KCJzdHJpbmciIT10eXBlb2YgZSYmKGU9LWUpLHRoaXMudXRjT2Zmc2V0KGUsdCksdGhpcyk6LXRoaXMudXRjT2Zmc2V0KCl9ZnVuY3Rpb24gemUoZSl7cmV0dXJuIHRoaXMudXRjT2Zmc2V0KDAsZSl9ZnVuY3Rpb24gWWUoZSl7cmV0dXJuIHRoaXMuX2lzVVRDJiYodGhpcy51dGNPZmZzZXQoMCxlKSx0aGlzLl9pc1VUQz0hMSxlJiZ0aGlzLnN1YnRyYWN0KEJlKHRoaXMpLCJtIikpLHRoaXN9ZnVuY3Rpb24gVWUoKXtyZXR1cm4gdGhpcy5fdHptP3RoaXMudXRjT2Zmc2V0KHRoaXMuX3R6bSk6InN0cmluZyI9PXR5cGVvZiB0aGlzLl9pJiZ0aGlzLnV0Y09mZnNldChJZSh0aGlzLl9pKSksdGhpc31mdW5jdGlvbiBHZShlKXtyZXR1cm4gZT1lP0RlKGUpLnV0Y09mZnNldCgpOjAsKHRoaXMudXRjT2Zmc2V0KCktZSklNjA9PT0wfWZ1bmN0aW9uICRlKCl7cmV0dXJuIHRoaXMudXRjT2Zmc2V0KCk+dGhpcy5jbG9uZSgpLm1vbnRoKDApLnV0Y09mZnNldCgpfHx0aGlzLnV0Y09mZnNldCgpPnRoaXMuY2xvbmUoKS5tb250aCg1KS51dGNPZmZzZXQoKX1mdW5jdGlvbiBLZSgpe2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgdGhpcy5faXNEU1RTaGlmdGVkKXJldHVybiB0aGlzLl9pc0RTVFNoaWZ0ZWQ7dmFyIGU9e307aWYocChlLHRoaXMpLGU9TWUoZSksZS5fYSl7dmFyIHQ9ZS5faXNVVEM/dShlLl9hKTpEZShlLl9hKTt0aGlzLl9pc0RTVFNoaWZ0ZWQ9dGhpcy5pc1ZhbGlkKCkmJnkoZS5fYSx0LnRvQXJyYXkoKSk+MH1lbHNlIHRoaXMuX2lzRFNUU2hpZnRlZD0hMTtyZXR1cm4gdGhpcy5faXNEU1RTaGlmdGVkfWZ1bmN0aW9uIFhlKCl7cmV0dXJuIXRoaXMuX2lzVVRDfWZ1bmN0aW9uIHFlKCl7cmV0dXJuIHRoaXMuX2lzVVRDfWZ1bmN0aW9uIFplKCl7cmV0dXJuIHRoaXMuX2lzVVRDJiYwPT09dGhpcy5fb2Zmc2V0fWZ1bmN0aW9uIEplKGUsdCl7dmFyIG4sbyxyLGk9ZSxzPW51bGw7cmV0dXJuIExlKGUpP2k9e21zOmUuX21pbGxpc2Vjb25kcyxkOmUuX2RheXMsTTplLl9tb250aHN9OiJudW1iZXIiPT10eXBlb2YgZT8oaT17fSx0P2lbdF09ZTppLm1pbGxpc2Vjb25kcz1lKToocz1Nby5leGVjKGUpKT8obj0iLSI9PT1zWzFdPy0xOjEsaT17eTowLGQ6dyhzW2NvXSkqbixoOncoc1tob10pKm4sbTp3KHNbZm9dKSpuLHM6dyhzW3BvXSkqbixtczp3KHNbZ29dKSpufSk6KHM9a28uZXhlYyhlKSk/KG49Ii0iPT09c1sxXT8tMToxLGk9e3k6UWUoc1syXSxuKSxNOlFlKHNbM10sbiksZDpRZShzWzRdLG4pLGg6UWUoc1s1XSxuKSxtOlFlKHNbNl0sbiksczpRZShzWzddLG4pLHc6UWUoc1s4XSxuKX0pOm51bGw9PWk/aT17fToib2JqZWN0Ij09dHlwZW9mIGkmJigiZnJvbSJpbiBpfHwidG8iaW4gaSkmJihyPXR0KERlKGkuZnJvbSksRGUoaS50bykpLGk9e30saS5tcz1yLm1pbGxpc2Vjb25kcyxpLk09ci5tb250aHMpLG89bmV3IE5lKGkpLExlKGUpJiZhKGUsIl9sb2NhbGUiKSYmKG8uX2xvY2FsZT1lLl9sb2NhbGUpLG99ZnVuY3Rpb24gUWUoZSx0KXt2YXIgbj1lJiZwYXJzZUZsb2F0KGUucmVwbGFjZSgiLCIsIi4iKSk7cmV0dXJuKGlzTmFOKG4pPzA6bikqdH1mdW5jdGlvbiBldChlLHQpe3ZhciBuPXttaWxsaXNlY29uZHM6MCxtb250aHM6MH07cmV0dXJuIG4ubW9udGhzPXQubW9udGgoKS1lLm1vbnRoKCkrMTIqKHQueWVhcigpLWUueWVhcigpKSxlLmNsb25lKCkuYWRkKG4ubW9udGhzLCJNIikuaXNBZnRlcih0KSYmLS1uLm1vbnRocyxuLm1pbGxpc2Vjb25kcz0rdC0rZS5jbG9uZSgpLmFkZChuLm1vbnRocywiTSIpLG59ZnVuY3Rpb24gdHQoZSx0KXt2YXIgbjtyZXR1cm4gdD1qZSh0LGUpLGUuaXNCZWZvcmUodCk/bj1ldChlLHQpOihuPWV0KHQsZSksbi5taWxsaXNlY29uZHM9LW4ubWlsbGlzZWNvbmRzLG4ubW9udGhzPS1uLm1vbnRocyksbn1mdW5jdGlvbiBudChlLHQpe3JldHVybiBmdW5jdGlvbihuLG8pe3ZhciByLGk7cmV0dXJuIG51bGw9PT1vfHxpc05hTigrbyl8fChvZSh0LCJtb21lbnQoKS4iK3QrIihwZXJpb2QsIG51bWJlcikgaXMgZGVwcmVjYXRlZC4gUGxlYXNlIHVzZSBtb21lbnQoKS4iK3QrIihudW1iZXIsIHBlcmlvZCkuIiksaT1uLG49byxvPWkpLG49InN0cmluZyI9PXR5cGVvZiBuPytuOm4scj1KZShuLG8pLG90KHRoaXMscixlKSx0aGlzfX1mdW5jdGlvbiBvdCh0LG4sbyxyKXt2YXIgaT1uLl9taWxsaXNlY29uZHMscz1uLl9kYXlzLGE9bi5fbW9udGhzO3I9bnVsbD09cj8hMDpyLGkmJnQuX2Quc2V0VGltZSgrdC5fZCtpKm8pLHMmJngodCwiRGF0ZSIsRCh0LCJEYXRlIikrcypvKSxhJiZaKHQsRCh0LCJNb250aCIpK2EqbyksciYmZS51cGRhdGVPZmZzZXQodCxzfHxhKX1mdW5jdGlvbiBydChlLHQpe3ZhciBuPWV8fERlKCksbz1qZShuLHRoaXMpLnN0YXJ0T2YoImRheSIpLHI9dGhpcy5kaWZmKG8sImRheXMiLCEwKSxpPS02PnI/InNhbWVFbHNlIjotMT5yPyJsYXN0V2VlayI6MD5yPyJsYXN0RGF5IjoxPnI/InNhbWVEYXkiOjI+cj8ibmV4dERheSI6Nz5yPyJuZXh0V2VlayI6InNhbWVFbHNlIjtyZXR1cm4gdGhpcy5mb3JtYXQodCYmdFtpXXx8dGhpcy5sb2NhbGVEYXRhKCkuY2FsZW5kYXIoaSx0aGlzLERlKG4pKSl9ZnVuY3Rpb24gaXQoKXtyZXR1cm4gbmV3IGcodGhpcyl9ZnVuY3Rpb24gc3QoZSx0KXt2YXIgbjtyZXR1cm4gdD1NKCJ1bmRlZmluZWQiIT10eXBlb2YgdD90OiJtaWxsaXNlY29uZCIpLCJtaWxsaXNlY29uZCI9PT10PyhlPW0oZSk/ZTpEZShlKSwrdGhpcz4rZSk6KG49bShlKT8rZTorRGUoZSksbjwrdGhpcy5jbG9uZSgpLnN0YXJ0T2YodCkpfWZ1bmN0aW9uIGF0KGUsdCl7dmFyIG47cmV0dXJuIHQ9TSgidW5kZWZpbmVkIiE9dHlwZW9mIHQ/dDoibWlsbGlzZWNvbmQiKSwibWlsbGlzZWNvbmQiPT09dD8oZT1tKGUpP2U6RGUoZSksK2U+K3RoaXMpOihuPW0oZSk/K2U6K0RlKGUpLCt0aGlzLmNsb25lKCkuZW5kT2YodCk8bil9ZnVuY3Rpb24gbHQoZSx0LG4pe3JldHVybiB0aGlzLmlzQWZ0ZXIoZSxuKSYmdGhpcy5pc0JlZm9yZSh0LG4pfWZ1bmN0aW9uIHV0KGUsdCl7dmFyIG47cmV0dXJuIHQ9TSh0fHwibWlsbGlzZWNvbmQiKSwibWlsbGlzZWNvbmQiPT09dD8oZT1tKGUpP2U6RGUoZSksK3RoaXM9PT0rZSk6KG49K0RlKGUpLCt0aGlzLmNsb25lKCkuc3RhcnRPZih0KTw9biYmbjw9K3RoaXMuY2xvbmUoKS5lbmRPZih0KSl9ZnVuY3Rpb24gY3QoZSx0LG4pe3ZhciBvLHIsaT1qZShlLHRoaXMpLHM9NmU0KihpLnV0Y09mZnNldCgpLXRoaXMudXRjT2Zmc2V0KCkpO3JldHVybiB0PU0odCksInllYXIiPT09dHx8Im1vbnRoIj09PXR8fCJxdWFydGVyIj09PXQ/KHI9ZHQodGhpcyxpKSwicXVhcnRlciI9PT10P3IvPTM6InllYXIiPT09dCYmKHIvPTEyKSk6KG89dGhpcy1pLHI9InNlY29uZCI9PT10P28vMWUzOiJtaW51dGUiPT09dD9vLzZlNDoiaG91ciI9PT10P28vMzZlNToiZGF5Ij09PXQ/KG8tcykvODY0ZTU6IndlZWsiPT09dD8oby1zKS82MDQ4ZTU6byksbj9yOnYocil9ZnVuY3Rpb24gZHQoZSx0KXt2YXIgbixvLHI9MTIqKHQueWVhcigpLWUueWVhcigpKSsodC5tb250aCgpLWUubW9udGgoKSksaT1lLmNsb25lKCkuYWRkKHIsIm1vbnRocyIpO3JldHVybiAwPnQtaT8obj1lLmNsb25lKCkuYWRkKHItMSwibW9udGhzIiksbz0odC1pKS8oaS1uKSk6KG49ZS5jbG9uZSgpLmFkZChyKzEsIm1vbnRocyIpLG89KHQtaSkvKG4taSkpLC0ocitvKX1mdW5jdGlvbiBodCgpe3JldHVybiB0aGlzLmNsb25lKCkubG9jYWxlKCJlbiIpLmZvcm1hdCgiZGRkIE1NTSBERCBZWVlZIEhIOm1tOnNzIFtHTVRdWloiKX1mdW5jdGlvbiBmdCgpe3ZhciBlPXRoaXMuY2xvbmUoKS51dGMoKTtyZXR1cm4gMDxlLnllYXIoKSYmZS55ZWFyKCk8PTk5OTk/ImZ1bmN0aW9uIj09dHlwZW9mIERhdGUucHJvdG90eXBlLnRvSVNPU3RyaW5nP3RoaXMudG9EYXRlKCkudG9JU09TdHJpbmcoKTpJKGUsIllZWVktTU0tRERbVF1ISDptbTpzcy5TU1NbWl0iKTpJKGUsIllZWVlZWS1NTS1ERFtUXUhIOm1tOnNzLlNTU1taXSIpfWZ1bmN0aW9uIHB0KHQpe3ZhciBuPUkodGhpcyx0fHxlLmRlZmF1bHRGb3JtYXQpO3JldHVybiB0aGlzLmxvY2FsZURhdGEoKS5wb3N0Zm9ybWF0KG4pfWZ1bmN0aW9uIGd0KGUsdCl7cmV0dXJuIHRoaXMuaXNWYWxpZCgpP0plKHt0bzp0aGlzLGZyb206ZX0pLmxvY2FsZSh0aGlzLmxvY2FsZSgpKS5odW1hbml6ZSghdCk6dGhpcy5sb2NhbGVEYXRhKCkuaW52YWxpZERhdGUoKX1mdW5jdGlvbiBtdChlKXtyZXR1cm4gdGhpcy5mcm9tKERlKCksZSl9ZnVuY3Rpb24gdnQoZSx0KXtyZXR1cm4gdGhpcy5pc1ZhbGlkKCk/SmUoe2Zyb206dGhpcyx0bzplfSkubG9jYWxlKHRoaXMubG9jYWxlKCkpLmh1bWFuaXplKCF0KTp0aGlzLmxvY2FsZURhdGEoKS5pbnZhbGlkRGF0ZSgpfWZ1bmN0aW9uIHd0KGUpe3JldHVybiB0aGlzLnRvKERlKCksZSl9ZnVuY3Rpb24geXQoZSl7dmFyIHQ7cmV0dXJuIHZvaWQgMD09PWU/dGhpcy5fbG9jYWxlLl9hYmJyOih0PVQoZSksbnVsbCE9dCYmKHRoaXMuX2xvY2FsZT10KSx0aGlzKX1mdW5jdGlvbiBidCgpe3JldHVybiB0aGlzLl9sb2NhbGV9ZnVuY3Rpb24gQ3QoZSl7c3dpdGNoKGU9TShlKSl7Y2FzZSJ5ZWFyIjp0aGlzLm1vbnRoKDApO2Nhc2UicXVhcnRlciI6Y2FzZSJtb250aCI6dGhpcy5kYXRlKDEpO2Nhc2Uid2VlayI6Y2FzZSJpc29XZWVrIjpjYXNlImRheSI6dGhpcy5ob3VycygwKTtjYXNlImhvdXIiOnRoaXMubWludXRlcygwKTtjYXNlIm1pbnV0ZSI6dGhpcy5zZWNvbmRzKDApO2Nhc2Uic2Vjb25kIjp0aGlzLm1pbGxpc2Vjb25kcygwKX1yZXR1cm4id2VlayI9PT1lJiZ0aGlzLndlZWtkYXkoMCksImlzb1dlZWsiPT09ZSYmdGhpcy5pc29XZWVrZGF5KDEpLCJxdWFydGVyIj09PWUmJnRoaXMubW9udGgoMypNYXRoLmZsb29yKHRoaXMubW9udGgoKS8zKSksdGhpc31mdW5jdGlvbiBSdChlKXtyZXR1cm4gZT1NKGUpLHZvaWQgMD09PWV8fCJtaWxsaXNlY29uZCI9PT1lP3RoaXM6dGhpcy5zdGFydE9mKGUpLmFkZCgxLCJpc29XZWVrIj09PWU/IndlZWsiOmUpLnN1YnRyYWN0KDEsIm1zIil9ZnVuY3Rpb24gX3QoKXtyZXR1cm4rdGhpcy5fZC02ZTQqKHRoaXMuX29mZnNldHx8MCl9ZnVuY3Rpb24gU3QoKXtyZXR1cm4gTWF0aC5mbG9vcigrdGhpcy8xZTMpfWZ1bmN0aW9uIEV0KCl7cmV0dXJuIHRoaXMuX29mZnNldD9uZXcgRGF0ZSgrdGhpcyk6dGhpcy5fZH1mdW5jdGlvbiBUdCgpe3ZhciBlPXRoaXM7cmV0dXJuW2UueWVhcigpLGUubW9udGgoKSxlLmRhdGUoKSxlLmhvdXIoKSxlLm1pbnV0ZSgpLGUuc2Vjb25kKCksZS5taWxsaXNlY29uZCgpXX1mdW5jdGlvbiBPdCgpe3ZhciBlPXRoaXM7cmV0dXJue3llYXJzOmUueWVhcigpLG1vbnRoczplLm1vbnRoKCksZGF0ZTplLmRhdGUoKSxob3VyczplLmhvdXJzKCksbWludXRlczplLm1pbnV0ZXMoKSxzZWNvbmRzOmUuc2Vjb25kcygpLG1pbGxpc2Vjb25kczplLm1pbGxpc2Vjb25kcygpfX1mdW5jdGlvbiBNdCgpe3JldHVybiBoKHRoaXMpfWZ1bmN0aW9uIGt0KCl7cmV0dXJuIGwoe30sZCh0aGlzKSl9ZnVuY3Rpb24gSHQoKXtyZXR1cm4gZCh0aGlzKS5vdmVyZmxvd31mdW5jdGlvbiBEdChlLHQpe04oMCxbZSxlLmxlbmd0aF0sMCx0KX1mdW5jdGlvbiB4dChlLHQsbil7cmV0dXJuIGRlKERlKFtlLDExLDMxK3Qtbl0pLHQsbikud2Vla31mdW5jdGlvbiBBdChlKXt2YXIgdD1kZSh0aGlzLHRoaXMubG9jYWxlRGF0YSgpLl93ZWVrLmRvdyx0aGlzLmxvY2FsZURhdGEoKS5fd2Vlay5kb3kpLnllYXI7cmV0dXJuIG51bGw9PWU/dDp0aGlzLmFkZChlLXQsInkiKX1mdW5jdGlvbiBQdChlKXt2YXIgdD1kZSh0aGlzLDEsNCkueWVhcjtyZXR1cm4gbnVsbD09ZT90OnRoaXMuYWRkKGUtdCwieSIpfWZ1bmN0aW9uIE50KCl7cmV0dXJuIHh0KHRoaXMueWVhcigpLDEsNCl9ZnVuY3Rpb24gTHQoKXt2YXIgZT10aGlzLmxvY2FsZURhdGEoKS5fd2VlaztyZXR1cm4geHQodGhpcy55ZWFyKCksZS5kb3csZS5kb3kpfWZ1bmN0aW9uIFd0KGUpe3JldHVybiBudWxsPT1lP01hdGguY2VpbCgodGhpcy5tb250aCgpKzEpLzMpOnRoaXMubW9udGgoMyooZS0xKSt0aGlzLm1vbnRoKCklMyl9ZnVuY3Rpb24gSXQoZSx0KXtyZXR1cm4ic3RyaW5nIiE9dHlwZW9mIGU/ZTppc05hTihlKT8oZT10LndlZWtkYXlzUGFyc2UoZSksIm51bWJlciI9PXR5cGVvZiBlP2U6bnVsbCk6cGFyc2VJbnQoZSwxMCl9ZnVuY3Rpb24ganQoZSl7cmV0dXJuIHRoaXMuX3dlZWtkYXlzW2UuZGF5KCldfWZ1bmN0aW9uIEJ0KGUpe3JldHVybiB0aGlzLl93ZWVrZGF5c1Nob3J0W2UuZGF5KCldfWZ1bmN0aW9uIEZ0KGUpe3JldHVybiB0aGlzLl93ZWVrZGF5c01pbltlLmRheSgpXX1mdW5jdGlvbiBWdChlKXt2YXIgdCxuLG87Zm9yKHRoaXMuX3dlZWtkYXlzUGFyc2U9dGhpcy5fd2Vla2RheXNQYXJzZXx8W10sdD0wOzc+dDt0KyspaWYodGhpcy5fd2Vla2RheXNQYXJzZVt0XXx8KG49RGUoWzJlMywxXSkuZGF5KHQpLG89Il4iK3RoaXMud2Vla2RheXMobiwiIikrInxeIit0aGlzLndlZWtkYXlzU2hvcnQobiwiIikrInxeIit0aGlzLndlZWtkYXlzTWluKG4sIiIpLHRoaXMuX3dlZWtkYXlzUGFyc2VbdF09bmV3IFJlZ0V4cChvLnJlcGxhY2UoIi4iLCIiKSwiaSIpKSx0aGlzLl93ZWVrZGF5c1BhcnNlW3RdLnRlc3QoZSkpcmV0dXJuIHR9ZnVuY3Rpb24genQoZSl7dmFyIHQ9dGhpcy5faXNVVEM/dGhpcy5fZC5nZXRVVENEYXkoKTp0aGlzLl9kLmdldERheSgpO3JldHVybiBudWxsIT1lPyhlPUl0KGUsdGhpcy5sb2NhbGVEYXRhKCkpLHRoaXMuYWRkKGUtdCwiZCIpKTp0fWZ1bmN0aW9uIFl0KGUpe3ZhciB0PSh0aGlzLmRheSgpKzctdGhpcy5sb2NhbGVEYXRhKCkuX3dlZWsuZG93KSU3O3JldHVybiBudWxsPT1lP3Q6dGhpcy5hZGQoZS10LCJkIil9ZnVuY3Rpb24gVXQoZSl7cmV0dXJuIG51bGw9PWU/dGhpcy5kYXkoKXx8Nzp0aGlzLmRheSh0aGlzLmRheSgpJTc/ZTplLTcpfWZ1bmN0aW9uIEd0KGUsdCl7TihlLDAsMCxmdW5jdGlvbigpe3JldHVybiB0aGlzLmxvY2FsZURhdGEoKS5tZXJpZGllbSh0aGlzLmhvdXJzKCksdGhpcy5taW51dGVzKCksdCl9KX1mdW5jdGlvbiAkdChlLHQpe3JldHVybiB0Ll9tZXJpZGllbVBhcnNlfWZ1bmN0aW9uIEt0KGUpe3JldHVybiJwIj09PShlKyIiKS50b0xvd2VyQ2FzZSgpLmNoYXJBdCgwKX1mdW5jdGlvbiBYdChlLHQsbil7cmV0dXJuIGU+MTE/bj8icG0iOiJQTSI6bj8iYW0iOiJBTSJ9ZnVuY3Rpb24gcXQoZSx0KXt0W2dvXT13KDFlMyooIjAuIitlKSl9ZnVuY3Rpb24gWnQoKXtyZXR1cm4gdGhpcy5faXNVVEM/IlVUQyI6IiJ9ZnVuY3Rpb24gSnQoKXtyZXR1cm4gdGhpcy5faXNVVEM/IkNvb3JkaW5hdGVkIFVuaXZlcnNhbCBUaW1lIjoiIn1mdW5jdGlvbiBRdChlKXtyZXR1cm4gRGUoMWUzKmUpfWZ1bmN0aW9uIGVuKCl7cmV0dXJuIERlLmFwcGx5KG51bGwsYXJndW1lbnRzKS5wYXJzZVpvbmUoKX1mdW5jdGlvbiB0bihlLHQsbil7dmFyIG89dGhpcy5fY2FsZW5kYXJbZV07cmV0dXJuImZ1bmN0aW9uIj09dHlwZW9mIG8/by5jYWxsKHQsbik6b31mdW5jdGlvbiBubihlKXt2YXIgdD10aGlzLl9sb25nRGF0ZUZvcm1hdFtlXSxuPXRoaXMuX2xvbmdEYXRlRm9ybWF0W2UudG9VcHBlckNhc2UoKV07cmV0dXJuIHR8fCFuP3Q6KHRoaXMuX2xvbmdEYXRlRm9ybWF0W2VdPW4ucmVwbGFjZSgvTU1NTXxNTXxERHxkZGRkL2csZnVuY3Rpb24oZSl7cmV0dXJuIGUuc2xpY2UoMSl9KSx0aGlzLl9sb25nRGF0ZUZvcm1hdFtlXSl9ZnVuY3Rpb24gb24oKXtyZXR1cm4gdGhpcy5faW52YWxpZERhdGV9ZnVuY3Rpb24gcm4oZSl7cmV0dXJuIHRoaXMuX29yZGluYWwucmVwbGFjZSgiJWQiLGUpfWZ1bmN0aW9uIHNuKGUpe3JldHVybiBlfWZ1bmN0aW9uIGFuKGUsdCxuLG8pe3ZhciByPXRoaXMuX3JlbGF0aXZlVGltZVtuXTtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2Ygcj9yKGUsdCxuLG8pOnIucmVwbGFjZSgvJWQvaSxlKX1mdW5jdGlvbiBsbihlLHQpe3ZhciBuPXRoaXMuX3JlbGF0aXZlVGltZVtlPjA/ImZ1dHVyZSI6InBhc3QiXTtyZXR1cm4iZnVuY3Rpb24iPT10eXBlb2Ygbj9uKHQpOm4ucmVwbGFjZSgvJXMvaSx0KX1mdW5jdGlvbiB1bihlKXt2YXIgdCxuO2ZvcihuIGluIGUpdD1lW25dLCJmdW5jdGlvbiI9PXR5cGVvZiB0P3RoaXNbbl09dDp0aGlzWyJfIituXT10O3RoaXMuX29yZGluYWxQYXJzZUxlbmllbnQ9bmV3IFJlZ0V4cCh0aGlzLl9vcmRpbmFsUGFyc2Uuc291cmNlKyJ8IisvXGR7MSwyfS8uc291cmNlKX1mdW5jdGlvbiBjbihlLHQsbixvKXt2YXIgcj1UKCksaT11KCkuc2V0KG8sdCk7cmV0dXJuIHJbbl0oaSxlKX1mdW5jdGlvbiBkbihlLHQsbixvLHIpe2lmKCJudW1iZXIiPT10eXBlb2YgZSYmKHQ9ZSxlPXZvaWQgMCksZT1lfHwiIixudWxsIT10KXJldHVybiBjbihlLHQsbixyKTt2YXIgaSxzPVtdO2ZvcihpPTA7bz5pO2krKylzW2ldPWNuKGUsaSxuLHIpO3JldHVybiBzfWZ1bmN0aW9uIGhuKGUsdCl7cmV0dXJuIGRuKGUsdCwibW9udGhzIiwxMiwibW9udGgiKX1mdW5jdGlvbiBmbihlLHQpe3JldHVybiBkbihlLHQsIm1vbnRoc1Nob3J0IiwxMiwibW9udGgiKX1mdW5jdGlvbiBwbihlLHQpe3JldHVybiBkbihlLHQsIndlZWtkYXlzIiw3LCJkYXkiKX1mdW5jdGlvbiBnbihlLHQpe3JldHVybiBkbihlLHQsIndlZWtkYXlzU2hvcnQiLDcsImRheSIpfWZ1bmN0aW9uIG1uKGUsdCl7cmV0dXJuIGRuKGUsdCwid2Vla2RheXNNaW4iLDcsImRheSIpfWZ1bmN0aW9uIHZuKCl7dmFyIGU9dGhpcy5fZGF0YTtyZXR1cm4gdGhpcy5fbWlsbGlzZWNvbmRzPUpvKHRoaXMuX21pbGxpc2Vjb25kcyksdGhpcy5fZGF5cz1Kbyh0aGlzLl9kYXlzKSx0aGlzLl9tb250aHM9Sm8odGhpcy5fbW9udGhzKSxlLm1pbGxpc2Vjb25kcz1KbyhlLm1pbGxpc2Vjb25kcyksZS5zZWNvbmRzPUpvKGUuc2Vjb25kcyksZS5taW51dGVzPUpvKGUubWludXRlcyksZS5ob3Vycz1KbyhlLmhvdXJzKSxlLm1vbnRocz1KbyhlLm1vbnRocyksZS55ZWFycz1KbyhlLnllYXJzKSx0aGlzfWZ1bmN0aW9uIHduKGUsdCxuLG8pe3ZhciByPUplKHQsbik7cmV0dXJuIGUuX21pbGxpc2Vjb25kcys9bypyLl9taWxsaXNlY29uZHMsZS5fZGF5cys9bypyLl9kYXlzLGUuX21vbnRocys9bypyLl9tb250aHMsZS5fYnViYmxlKCl9ZnVuY3Rpb24geW4oZSx0KXtyZXR1cm4gd24odGhpcyxlLHQsMSl9ZnVuY3Rpb24gYm4oZSx0KXtyZXR1cm4gd24odGhpcyxlLHQsLTEpfWZ1bmN0aW9uIENuKGUpe3JldHVybiAwPmU/TWF0aC5mbG9vcihlKTpNYXRoLmNlaWwoZSl9ZnVuY3Rpb24gUm4oKXt2YXIgZSx0LG4sbyxyLGk9dGhpcy5fbWlsbGlzZWNvbmRzLHM9dGhpcy5fZGF5cyxhPXRoaXMuX21vbnRocyxsPXRoaXMuX2RhdGE7cmV0dXJuIGk+PTAmJnM+PTAmJmE+PTB8fDA+PWkmJjA+PXMmJjA+PWF8fChpKz04NjRlNSpDbihTbihhKStzKSxzPTAsYT0wKSxsLm1pbGxpc2Vjb25kcz1pJTFlMyxlPXYoaS8xZTMpLGwuc2Vjb25kcz1lJTYwLHQ9dihlLzYwKSxsLm1pbnV0ZXM9dCU2MCxuPXYodC82MCksbC5ob3Vycz1uJTI0LHMrPXYobi8yNCkscj12KF9uKHMpKSxhKz1yLHMtPUNuKFNuKHIpKSxvPXYoYS8xMiksYSU9MTIsbC5kYXlzPXMsbC5tb250aHM9YSxsLnllYXJzPW8sdGhpc31mdW5jdGlvbiBfbihlKXtyZXR1cm4gNDgwMCplLzE0NjA5N31mdW5jdGlvbiBTbihlKXtyZXR1cm4gMTQ2MDk3KmUvNDgwMH1mdW5jdGlvbiBFbihlKXt2YXIgdCxuLG89dGhpcy5fbWlsbGlzZWNvbmRzO2lmKGU9TShlKSwibW9udGgiPT09ZXx8InllYXIiPT09ZSlyZXR1cm4gdD10aGlzLl9kYXlzK28vODY0ZTUsbj10aGlzLl9tb250aHMrX24odCksIm1vbnRoIj09PWU/bjpuLzEyO3N3aXRjaCh0PXRoaXMuX2RheXMrTWF0aC5yb3VuZChTbih0aGlzLl9tb250aHMpKSxlKXtjYXNlIndlZWsiOnJldHVybiB0Lzcrby82MDQ4ZTU7Y2FzZSJkYXkiOnJldHVybiB0K28vODY0ZTU7Y2FzZSJob3VyIjpyZXR1cm4gMjQqdCtvLzM2ZTU7Y2FzZSJtaW51dGUiOnJldHVybiAxNDQwKnQrby82ZTQ7Y2FzZSJzZWNvbmQiOnJldHVybiA4NjQwMCp0K28vMWUzO2Nhc2UibWlsbGlzZWNvbmQiOnJldHVybiBNYXRoLmZsb29yKDg2NGU1KnQpK287ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gdW5pdCAiK2UpfX1mdW5jdGlvbiBUbigpe3JldHVybiB0aGlzLl9taWxsaXNlY29uZHMrODY0ZTUqdGhpcy5fZGF5cyt0aGlzLl9tb250aHMlMTIqMjU5MmU2KzMxNTM2ZTYqdyh0aGlzLl9tb250aHMvMTIpfWZ1bmN0aW9uIE9uKGUpe3JldHVybiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmFzKGUpfX1mdW5jdGlvbiBNbihlKXtyZXR1cm4gZT1NKGUpLHRoaXNbZSsicyJdKCl9ZnVuY3Rpb24ga24oZSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2RhdGFbZV19fWZ1bmN0aW9uIEhuKCl7cmV0dXJuIHYodGhpcy5kYXlzKCkvNyl9ZnVuY3Rpb24gRG4oZSx0LG4sbyxyKXtyZXR1cm4gci5yZWxhdGl2ZVRpbWUodHx8MSwhIW4sZSxvKX1mdW5jdGlvbiB4bihlLHQsbil7dmFyIG89SmUoZSkuYWJzKCkscj1wcihvLmFzKCJzIikpLGk9cHIoby5hcygibSIpKSxzPXByKG8uYXMoImgiKSksYT1wcihvLmFzKCJkIikpLGw9cHIoby5hcygiTSIpKSx1PXByKG8uYXMoInkiKSksYz1yPGdyLnMmJlsicyIscl18fDE9PT1pJiZbIm0iXXx8aTxnci5tJiZbIm1tIixpXXx8MT09PXMmJlsiaCJdfHxzPGdyLmgmJlsiaGgiLHNdfHwxPT09YSYmWyJkIl18fGE8Z3IuZCYmWyJkZCIsYV18fDE9PT1sJiZbIk0iXXx8bDxnci5NJiZbIk1NIixsXXx8MT09PXUmJlsieSJdfHxbInl5Iix1XTtyZXR1cm4gY1syXT10LGNbM109K2U+MCxjWzRdPW4sRG4uYXBwbHkobnVsbCxjKX1mdW5jdGlvbiBBbihlLHQpe3JldHVybiB2b2lkIDA9PT1ncltlXT8hMTp2b2lkIDA9PT10P2dyW2VdOihncltlXT10LCEwKX1mdW5jdGlvbiBQbihlKXt2YXIgdD10aGlzLmxvY2FsZURhdGEoKSxuPXhuKHRoaXMsIWUsdCk7cmV0dXJuIGUmJihuPXQucGFzdEZ1dHVyZSgrdGhpcyxuKSksdC5wb3N0Zm9ybWF0KG4pfWZ1bmN0aW9uIE5uKCl7dmFyIGUsdCxuLG89bXIodGhpcy5fbWlsbGlzZWNvbmRzKS8xZTMscj1tcih0aGlzLl9kYXlzKSxpPW1yKHRoaXMuX21vbnRocyk7ZT12KG8vNjApLHQ9dihlLzYwKSxvJT02MCxlJT02MCxuPXYoaS8xMiksaSU9MTI7dmFyIHM9bixhPWksbD1yLHU9dCxjPWUsZD1vLGg9dGhpcy5hc1NlY29uZHMoKTtyZXR1cm4gaD8oMD5oPyItIjoiIikrIlAiKyhzP3MrIlkiOiIiKSsoYT9hKyJNIjoiIikrKGw/bCsiRCI6IiIpKyh1fHxjfHxkPyJUIjoiIikrKHU/dSsiSCI6IiIpKyhjP2MrIk0iOiIiKSsoZD9kKyJTIjoiIik6IlAwRCJ9dmFyIExuLFduLEluPWUubW9tZW50UHJvcGVydGllcz1bXSxqbj0hMSxCbj17fSxGbj17fSxWbj0vKFxbW15cW10qXF0pfChcXCk/KE1vfE1NP00/TT98RG98REREb3xERD9EP0Q/fGRkZD9kP3xkbz98d1tvfHddP3xXW298V10/fFF8WVlZWVlZfFlZWVlZfFlZWVl8WVl8Z2coZ2dnPyk/fEdHKEdHRz8pP3xlfEV8YXxBfGhoP3xISD98bW0/fHNzP3xTezEsOX18eHxYfHp6P3xaWj98LikvZyx6bj0vKFxbW15cW10qXF0pfChcXCk/KExUU3xMVHxMTD9MP0w/fGx7MSw0fSkvZyxZbj17fSxVbj17fSxHbj0vXGQvLCRuPS9cZFxkLyxLbj0vXGR7M30vLFhuPS9cZHs0fS8scW49L1srLV0/XGR7Nn0vLFpuPS9cZFxkPy8sSm49L1xkezEsM30vLFFuPS9cZHsxLDR9Lyxlbz0vWystXT9cZHsxLDZ9Lyx0bz0vXGQrLyxubz0vWystXT9cZCsvLG9vPS9afFsrLV1cZFxkOj9cZFxkL2dpLHJvPS9bKy1dP1xkKyhcLlxkezEsM30pPy8saW89L1swLTldKlsnYS16XHUwMEEwLVx1MDVGRlx1MDcwMC1cdUQ3RkZcdUY5MDAtXHVGRENGXHVGREYwLVx1RkZFRl0rfFtcdTA2MDAtXHUwNkZGXC9dKyhccyo/W1x1MDYwMC1cdTA2RkZdKyl7MSwyfS9pLHNvPXt9LGFvPXt9LGxvPTAsdW89MSxjbz0yLGhvPTMsZm89NCxwbz01LGdvPTY7TigiTSIsWyJNTSIsMl0sIk1vIixmdW5jdGlvbigpe3JldHVybiB0aGlzLm1vbnRoKCkrMX0pLE4oIk1NTSIsMCwwLGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmxvY2FsZURhdGEoKS5tb250aHNTaG9ydCh0aGlzLGUpfSksTigiTU1NTSIsMCwwLGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmxvY2FsZURhdGEoKS5tb250aHModGhpcyxlKX0pLE8oIm1vbnRoIiwiTSIpLEYoIk0iLFpuKSxGKCJNTSIsWm4sJG4pLEYoIk1NTSIsaW8pLEYoIk1NTU0iLGlvKSxZKFsiTSIsIk1NIl0sZnVuY3Rpb24oZSx0KXt0W3VvXT13KGUpLTF9KSxZKFsiTU1NIiwiTU1NTSJdLGZ1bmN0aW9uKGUsdCxuLG8pe3ZhciByPW4uX2xvY2FsZS5tb250aHNQYXJzZShlLG8sbi5fc3RyaWN0KTtudWxsIT1yP3RbdW9dPXI6ZChuKS5pbnZhbGlkTW9udGg9ZX0pO3ZhciBtbz0iSmFudWFyeV9GZWJydWFyeV9NYXJjaF9BcHJpbF9NYXlfSnVuZV9KdWx5X0F1Z3VzdF9TZXB0ZW1iZXJfT2N0b2Jlcl9Ob3ZlbWJlcl9EZWNlbWJlciIuc3BsaXQoIl8iKSx2bz0iSmFuX0ZlYl9NYXJfQXByX01heV9KdW5fSnVsX0F1Z19TZXBfT2N0X05vdl9EZWMiLnNwbGl0KCJfIiksd289e307ZS5zdXBwcmVzc0RlcHJlY2F0aW9uV2FybmluZ3M9ITE7dmFyIHlvPS9eXHMqKD86WystXVxkezZ9fFxkezR9KS0oPzooXGRcZC1cZFxkKXwoV1xkXGQkKXwoV1xkXGQtXGQpfChcZFxkXGQpKSgoVHwgKShcZFxkKDpcZFxkKDpcZFxkKFwuXGQrKT8pPyk/KT8oW1wrXC1dXGRcZCg/Ojo/XGRcZCk/fFxzKlopPyk/JC8sYm89W1siWVlZWVlZLU1NLUREIiwvWystXVxkezZ9LVxkezJ9LVxkezJ9L10sWyJZWVlZLU1NLUREIiwvXGR7NH0tXGR7Mn0tXGR7Mn0vXSxbIkdHR0ctW1ddV1ctRSIsL1xkezR9LVdcZHsyfS1cZC9dLFsiR0dHRy1bV11XVyIsL1xkezR9LVdcZHsyfS9dLFsiWVlZWS1EREQiLC9cZHs0fS1cZHszfS9dXSxDbz1bWyJISDptbTpzcy5TU1NTIiwvKFR8IClcZFxkOlxkXGQ6XGRcZFwuXGQrL10sWyJISDptbTpzcyIsLyhUfCApXGRcZDpcZFxkOlxkXGQvXSxbIkhIOm1tIiwvKFR8IClcZFxkOlxkXGQvXSxbIkhIIiwvKFR8IClcZFxkL11dLFJvPS9eXC8/RGF0ZVwoKFwtP1xkKykvaTtlLmNyZWF0ZUZyb21JbnB1dEZhbGxiYWNrPW5lKCJtb21lbnQgY29uc3RydWN0aW9uIGZhbGxzIGJhY2sgdG8ganMgRGF0ZS4gVGhpcyBpcyBkaXNjb3VyYWdlZCBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHVwY29taW5nIG1ham9yIHJlbGVhc2UuIFBsZWFzZSByZWZlciB0byBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTQwNyBmb3IgbW9yZSBpbmZvLiIsZnVuY3Rpb24oZSl7ZS5fZD1uZXcgRGF0ZShlLl9pKyhlLl91c2VVVEM/IiBVVEMiOiIiKSl9KSxOKDAsWyJZWSIsMl0sMCxmdW5jdGlvbigpe3JldHVybiB0aGlzLnllYXIoKSUxMDB9KSxOKDAsWyJZWVlZIiw0XSwwLCJ5ZWFyIiksTigwLFsiWVlZWVkiLDVdLDAsInllYXIiKSxOKDAsWyJZWVlZWVkiLDYsITBdLDAsInllYXIiKSxPKCJ5ZWFyIiwieSIpLEYoIlkiLG5vKSxGKCJZWSIsWm4sJG4pLEYoIllZWVkiLFFuLFhuKSxGKCJZWVlZWSIsZW8scW4pLEYoIllZWVlZWSIsZW8scW4pLFkoWyJZWVlZWSIsIllZWVlZWSJdLGxvKSxZKCJZWVlZIixmdW5jdGlvbih0LG4pe25bbG9dPTI9PT10Lmxlbmd0aD9lLnBhcnNlVHdvRGlnaXRZZWFyKHQpOncodCl9KSxZKCJZWSIsZnVuY3Rpb24odCxuKXtuW2xvXT1lLnBhcnNlVHdvRGlnaXRZZWFyKHQpfSksZS5wYXJzZVR3b0RpZ2l0WWVhcj1mdW5jdGlvbihlKXtyZXR1cm4gdyhlKSsodyhlKT42OD8xOTAwOjJlMyl9O3ZhciBfbz1IKCJGdWxsWWVhciIsITEpO04oInciLFsid3ciLDJdLCJ3byIsIndlZWsiKSxOKCJXIixbIldXIiwyXSwiV28iLCJpc29XZWVrIiksTygid2VlayIsInciKSxPKCJpc29XZWVrIiwiVyIpLEYoInciLFpuKSxGKCJ3dyIsWm4sJG4pLEYoIlciLFpuKSxGKCJXVyIsWm4sJG4pLFUoWyJ3Iiwid3ciLCJXIiwiV1ciXSxmdW5jdGlvbihlLHQsbixvKXt0W28uc3Vic3RyKDAsMSldPXcoZSl9KTt2YXIgU289e2RvdzowLGRveTo2fTtOKCJEREQiLFsiRERERCIsM10sIkRERG8iLCJkYXlPZlllYXIiKSxPKCJkYXlPZlllYXIiLCJEREQiKSxGKCJEREQiLEpuKSxGKCJEREREIixLbiksWShbIkRERCIsIkREREQiXSxmdW5jdGlvbihlLHQsbil7bi5fZGF5T2ZZZWFyPXcoZSl9KSxlLklTT184NjAxPWZ1bmN0aW9uKCl7fTt2YXIgRW89bmUoIm1vbWVudCgpLm1pbiBpcyBkZXByZWNhdGVkLCB1c2UgbW9tZW50Lm1pbiBpbnN0ZWFkLiBodHRwczovL2dpdGh1Yi5jb20vbW9tZW50L21vbWVudC9pc3N1ZXMvMTU0OCIsZnVuY3Rpb24oKXt2YXIgZT1EZS5hcHBseShudWxsLGFyZ3VtZW50cyk7cmV0dXJuIHRoaXM+ZT90aGlzOmV9KSxUbz1uZSgibW9tZW50KCkubWF4IGlzIGRlcHJlY2F0ZWQsIHVzZSBtb21lbnQubWF4IGluc3RlYWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9tb21lbnQvbW9tZW50L2lzc3Vlcy8xNTQ4IixmdW5jdGlvbigpe3ZhciBlPURlLmFwcGx5KG51bGwsYXJndW1lbnRzKTtyZXR1cm4gZT50aGlzP3RoaXM6ZX0pO1dlKCJaIiwiOiIpLFdlKCJaWiIsIiIpLEYoIloiLG9vKSxGKCJaWiIsb28pLFkoWyJaIiwiWloiXSxmdW5jdGlvbihlLHQsbil7bi5fdXNlVVRDPSEwLG4uX3R6bT1JZShlKX0pO3ZhciBPbz0vKFtcK1wtXXxcZFxkKS9naTtlLnVwZGF0ZU9mZnNldD1mdW5jdGlvbigpe307dmFyIE1vPS8oXC0pPyg/OihcZCopXC4pPyhcZCspXDooXGQrKSg/Olw6KFxkKylcLj8oXGR7M30pPyk/Lyxrbz0vXigtKT9QKD86KD86KFswLTksLl0qKVkpPyg/OihbMC05LC5dKilNKT8oPzooWzAtOSwuXSopRCk/KD86VCg/OihbMC05LC5dKilIKT8oPzooWzAtOSwuXSopTSk/KD86KFswLTksLl0qKVMpPyk/fChbMC05LC5dKilXKSQvO0plLmZuPU5lLnByb3RvdHlwZTt2YXIgSG89bnQoMSwiYWRkIiksRG89bnQoLTEsInN1YnRyYWN0Iik7ZS5kZWZhdWx0Rm9ybWF0PSJZWVlZLU1NLUREVEhIOm1tOnNzWiI7dmFyIHhvPW5lKCJtb21lbnQoKS5sYW5nKCkgaXMgZGVwcmVjYXRlZC4gSW5zdGVhZCwgdXNlIG1vbWVudCgpLmxvY2FsZURhdGEoKSB0byBnZXQgdGhlIGxhbmd1YWdlIGNvbmZpZ3VyYXRpb24uIFVzZSBtb21lbnQoKS5sb2NhbGUoKSB0byBjaGFuZ2UgbGFuZ3VhZ2VzLiIsZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMD09PWU/dGhpcy5sb2NhbGVEYXRhKCk6dGhpcy5sb2NhbGUoZSl9KTtOKDAsWyJnZyIsMl0sMCxmdW5jdGlvbigpe3JldHVybiB0aGlzLndlZWtZZWFyKCklMTAwfSksTigwLFsiR0ciLDJdLDAsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5pc29XZWVrWWVhcigpJTEwMH0pLER0KCJnZ2dnIiwid2Vla1llYXIiKSxEdCgiZ2dnZ2ciLCJ3ZWVrWWVhciIpLER0KCJHR0dHIiwiaXNvV2Vla1llYXIiKSxEdCgiR0dHR0ciLCJpc29XZWVrWWVhciIpLE8oIndlZWtZZWFyIiwiZ2ciKSxPKCJpc29XZWVrWWVhciIsIkdHIiksRigiRyIsbm8pLEYoImciLG5vKSxGKCJHRyIsWm4sJG4pLEYoImdnIixabiwkbiksRigiR0dHRyIsUW4sWG4pLEYoImdnZ2ciLFFuLFhuKSxGKCJHR0dHRyIsZW8scW4pLEYoImdnZ2dnIixlbyxxbiksVShbImdnZ2ciLCJnZ2dnZyIsIkdHR0ciLCJHR0dHRyJdLGZ1bmN0aW9uKGUsdCxuLG8pe3Rbby5zdWJzdHIoMCwyKV09dyhlKX0pLFUoWyJnZyIsIkdHIl0sZnVuY3Rpb24odCxuLG8scil7bltyXT1lLnBhcnNlVHdvRGlnaXRZZWFyKHQpfSksTigiUSIsMCwwLCJxdWFydGVyIiksTygicXVhcnRlciIsIlEiKSxGKCJRIixHbiksWSgiUSIsZnVuY3Rpb24oZSx0KXt0W3VvXT0zKih3KGUpLTEpfSksTigiRCIsWyJERCIsMl0sIkRvIiwiZGF0ZSIpLE8oImRhdGUiLCJEIiksRigiRCIsWm4pLEYoIkREIixabiwkbiksRigiRG8iLGZ1bmN0aW9uKGUsdCl7cmV0dXJuIGU/dC5fb3JkaW5hbFBhcnNlOnQuX29yZGluYWxQYXJzZUxlbmllbnR9KSxZKFsiRCIsIkREIl0sY28pLFkoIkRvIixmdW5jdGlvbihlLHQpe3RbY29dPXcoZS5tYXRjaChabilbMF0sMTApfSk7dmFyIEFvPUgoIkRhdGUiLCEwKTtOKCJkIiwwLCJkbyIsImRheSIpLE4oImRkIiwwLDAsZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMubG9jYWxlRGF0YSgpLndlZWtkYXlzTWluKHRoaXMsZSl9KSxOKCJkZGQiLDAsMCxmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5sb2NhbGVEYXRhKCkud2Vla2RheXNTaG9ydCh0aGlzLGUpfSksTigiZGRkZCIsMCwwLGZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLmxvY2FsZURhdGEoKS53ZWVrZGF5cyh0aGlzLGUpfSksTigiZSIsMCwwLCJ3ZWVrZGF5IiksTigiRSIsMCwwLCJpc29XZWVrZGF5IiksTygiZGF5IiwiZCIpLE8oIndlZWtkYXkiLCJlIiksTygiaXNvV2Vla2RheSIsIkUiKSxGKCJkIixabiksRigiZSIsWm4pLEYoIkUiLFpuKSxGKCJkZCIsaW8pLEYoImRkZCIsaW8pLEYoImRkZGQiLGlvKSxVKFsiZGQiLCJkZGQiLCJkZGRkIl0sZnVuY3Rpb24oZSx0LG4pe3ZhciBvPW4uX2xvY2FsZS53ZWVrZGF5c1BhcnNlKGUpO251bGwhPW8/dC5kPW86ZChuKS5pbnZhbGlkV2Vla2RheT1lfSksVShbImQiLCJlIiwiRSJdLGZ1bmN0aW9uKGUsdCxuLG8pe3Rbb109dyhlKX0pO3ZhciBQbz0iU3VuZGF5X01vbmRheV9UdWVzZGF5X1dlZG5lc2RheV9UaHVyc2RheV9GcmlkYXlfU2F0dXJkYXkiLnNwbGl0KCJfIiksTm89IlN1bl9Nb25fVHVlX1dlZF9UaHVfRnJpX1NhdCIuc3BsaXQoIl8iKSxMbz0iU3VfTW9fVHVfV2VfVGhfRnJfU2EiLnNwbGl0KCJfIik7TigiSCIsWyJISCIsMl0sMCwiaG91ciIpLE4oImgiLFsiaGgiLDJdLDAsZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5ob3VycygpJTEyfHwxMn0pLEd0KCJhIiwhMCksR3QoIkEiLCExKSxPKCJob3VyIiwiaCIpLEYoImEiLCR0KSxGKCJBIiwkdCksRigiSCIsWm4pLEYoImgiLFpuKSxGKCJISCIsWm4sJG4pLEYoImhoIixabiwkbiksWShbIkgiLCJISCJdLGhvKSxZKFsiYSIsIkEiXSxmdW5jdGlvbihlLHQsbil7bi5faXNQbT1uLl9sb2NhbGUuaXNQTShlKSxuLl9tZXJpZGllbT1lfSksWShbImgiLCJoaCJdLGZ1bmN0aW9uKGUsdCxuKXt0W2hvXT13KGUpLGQobikuYmlnSG91cj0hMH0pO3ZhciBXbz0vW2FwXVwuP20/XC4/L2ksSW89SCgiSG91cnMiLCEwKTtOKCJtIixbIm1tIiwyXSwwLCJtaW51dGUiKSxPKCJtaW51dGUiLCJtIiksRigibSIsWm4pLEYoIm1tIixabiwkbiksWShbIm0iLCJtbSJdLGZvKTt2YXIgam89SCgiTWludXRlcyIsITEpO04oInMiLFsic3MiLDJdLDAsInNlY29uZCIpLE8oInNlY29uZCIsInMiKSxGKCJzIixabiksRigic3MiLFpuLCRuKSxZKFsicyIsInNzIl0scG8pO3ZhciBCbz1IKCJTZWNvbmRzIiwhMSk7TigiUyIsMCwwLGZ1bmN0aW9uKCl7cmV0dXJufn4odGhpcy5taWxsaXNlY29uZCgpLzEwMCl9KSxOKDAsWyJTUyIsMl0sMCxmdW5jdGlvbigpe3JldHVybn5+KHRoaXMubWlsbGlzZWNvbmQoKS8xMCl9KSxOKDAsWyJTU1MiLDNdLDAsIm1pbGxpc2Vjb25kIiksTigwLFsiU1NTUyIsNF0sMCxmdW5jdGlvbigpe3JldHVybiAxMCp0aGlzLm1pbGxpc2Vjb25kKCl9KSxOKDAsWyJTU1NTUyIsNV0sMCxmdW5jdGlvbigpe3JldHVybiAxMDAqdGhpcy5taWxsaXNlY29uZCgpfSksTigwLFsiU1NTU1NTIiw2XSwwLGZ1bmN0aW9uKCl7cmV0dXJuIDFlMyp0aGlzLm1pbGxpc2Vjb25kKCl9KSxOKDAsWyJTU1NTU1NTIiw3XSwwLGZ1bmN0aW9uKCl7cmV0dXJuIDFlNCp0aGlzLm1pbGxpc2Vjb25kKCl9KSxOKDAsWyJTU1NTU1NTUyIsOF0sMCxmdW5jdGlvbigpe3JldHVybiAxZTUqdGhpcy5taWxsaXNlY29uZCgpfSksTigwLFsiU1NTU1NTU1NTIiw5XSwwLGZ1bmN0aW9uKCl7cmV0dXJuIDFlNip0aGlzLm1pbGxpc2Vjb25kKCl9KSxPKCJtaWxsaXNlY29uZCIsIm1zIiksRigiUyIsSm4sR24pLEYoIlNTIixKbiwkbiksRigiU1NTIixKbixLbik7dmFyIEZvO2ZvcihGbz0iU1NTUyI7Rm8ubGVuZ3RoPD05O0ZvKz0iUyIpRihGbyx0byk7Zm9yKEZvPSJTIjtGby5sZW5ndGg8PTk7Rm8rPSJTIilZKEZvLHF0KTt2YXIgVm89SCgiTWlsbGlzZWNvbmRzIiwhMSk7TigieiIsMCwwLCJ6b25lQWJiciIpLE4oInp6IiwwLDAsInpvbmVOYW1lIik7dmFyIHpvPWcucHJvdG90eXBlO3pvLmFkZD1Ibyx6by5jYWxlbmRhcj1ydCx6by5jbG9uZT1pdCx6by5kaWZmPWN0LHpvLmVuZE9mPVJ0LHpvLmZvcm1hdD1wdCx6by5mcm9tPWd0LHpvLmZyb21Ob3c9bXQsem8udG89dnQsem8udG9Ob3c9d3Qsem8uZ2V0PUEsem8uaW52YWxpZEF0PUh0LHpvLmlzQWZ0ZXI9c3Qsem8uaXNCZWZvcmU9YXQsem8uaXNCZXR3ZWVuPWx0LHpvLmlzU2FtZT11dCx6by5pc1ZhbGlkPU10LHpvLmxhbmc9eG8sem8ubG9jYWxlPXl0LHpvLmxvY2FsZURhdGE9YnQsem8ubWF4PVRvLHpvLm1pbj1Fbyx6by5wYXJzaW5nRmxhZ3M9a3Qsem8uc2V0PUEsem8uc3RhcnRPZj1DdCx6by5zdWJ0cmFjdD1Ebyx6by50b0FycmF5PVR0LHpvLnRvT2JqZWN0PU90LHpvLnRvRGF0ZT1FdCx6by50b0lTT1N0cmluZz1mdCx6by50b0pTT049ZnQsem8udG9TdHJpbmc9aHQsem8udW5peD1TdCx6by52YWx1ZU9mPV90LHpvLnllYXI9X28sem8uaXNMZWFwWWVhcj1jZSx6by53ZWVrWWVhcj1BdCx6by5pc29XZWVrWWVhcj1QdCx6by5xdWFydGVyPXpvLnF1YXJ0ZXJzPVd0LHpvLm1vbnRoPUosem8uZGF5c0luTW9udGg9USx6by53ZWVrPXpvLndlZWtzPWdlLHpvLmlzb1dlZWs9em8uaXNvV2Vla3M9bWUsem8ud2Vla3NJblllYXI9THQsem8uaXNvV2Vla3NJblllYXI9TnQsem8uZGF0ZT1Bbyx6by5kYXk9em8uZGF5cz16dCx6by53ZWVrZGF5PVl0LHpvLmlzb1dlZWtkYXk9VXQsem8uZGF5T2ZZZWFyPXdlLHpvLmhvdXI9em8uaG91cnM9SW8sem8ubWludXRlPXpvLm1pbnV0ZXM9am8sem8uc2Vjb25kPXpvLnNlY29uZHM9Qm8sem8ubWlsbGlzZWNvbmQ9em8ubWlsbGlzZWNvbmRzPVZvLHpvLnV0Y09mZnNldD1GZSwKem8udXRjPXplLHpvLmxvY2FsPVllLHpvLnBhcnNlWm9uZT1VZSx6by5oYXNBbGlnbmVkSG91ck9mZnNldD1HZSx6by5pc0RTVD0kZSx6by5pc0RTVFNoaWZ0ZWQ9S2Usem8uaXNMb2NhbD1YZSx6by5pc1V0Y09mZnNldD1xZSx6by5pc1V0Yz1aZSx6by5pc1VUQz1aZSx6by56b25lQWJicj1adCx6by56b25lTmFtZT1KdCx6by5kYXRlcz1uZSgiZGF0ZXMgYWNjZXNzb3IgaXMgZGVwcmVjYXRlZC4gVXNlIGRhdGUgaW5zdGVhZC4iLEFvKSx6by5tb250aHM9bmUoIm1vbnRocyBhY2Nlc3NvciBpcyBkZXByZWNhdGVkLiBVc2UgbW9udGggaW5zdGVhZCIsSiksem8ueWVhcnM9bmUoInllYXJzIGFjY2Vzc29yIGlzIGRlcHJlY2F0ZWQuIFVzZSB5ZWFyIGluc3RlYWQiLF9vKSx6by56b25lPW5lKCJtb21lbnQoKS56b25lIGlzIGRlcHJlY2F0ZWQsIHVzZSBtb21lbnQoKS51dGNPZmZzZXQgaW5zdGVhZC4gaHR0cHM6Ly9naXRodWIuY29tL21vbWVudC9tb21lbnQvaXNzdWVzLzE3NzkiLFZlKTt2YXIgWW89em8sVW89e3NhbWVEYXk6IltUb2RheSBhdF0gTFQiLG5leHREYXk6IltUb21vcnJvdyBhdF0gTFQiLG5leHRXZWVrOiJkZGRkIFthdF0gTFQiLGxhc3REYXk6IltZZXN0ZXJkYXkgYXRdIExUIixsYXN0V2VlazoiW0xhc3RdIGRkZGQgW2F0XSBMVCIsc2FtZUVsc2U6IkwifSxHbz17TFRTOiJoOm1tOnNzIEEiLExUOiJoOm1tIEEiLEw6Ik1NL0REL1lZWVkiLExMOiJNTU1NIEQsIFlZWVkiLExMTDoiTU1NTSBELCBZWVlZIGg6bW0gQSIsTExMTDoiZGRkZCwgTU1NTSBELCBZWVlZIGg6bW0gQSJ9LCRvPSJJbnZhbGlkIGRhdGUiLEtvPSIlZCIsWG89L1xkezEsMn0vLHFvPXtmdXR1cmU6ImluICVzIixwYXN0OiIlcyBhZ28iLHM6ImEgZmV3IHNlY29uZHMiLG06ImEgbWludXRlIixtbToiJWQgbWludXRlcyIsaDoiYW4gaG91ciIsaGg6IiVkIGhvdXJzIixkOiJhIGRheSIsZGQ6IiVkIGRheXMiLE06ImEgbW9udGgiLE1NOiIlZCBtb250aHMiLHk6ImEgeWVhciIseXk6IiVkIHllYXJzIn0sWm89Yi5wcm90b3R5cGU7Wm8uX2NhbGVuZGFyPVVvLFpvLmNhbGVuZGFyPXRuLFpvLl9sb25nRGF0ZUZvcm1hdD1Hbyxaby5sb25nRGF0ZUZvcm1hdD1ubixaby5faW52YWxpZERhdGU9JG8sWm8uaW52YWxpZERhdGU9b24sWm8uX29yZGluYWw9S28sWm8ub3JkaW5hbD1ybixaby5fb3JkaW5hbFBhcnNlPVhvLFpvLnByZXBhcnNlPXNuLFpvLnBvc3Rmb3JtYXQ9c24sWm8uX3JlbGF0aXZlVGltZT1xbyxaby5yZWxhdGl2ZVRpbWU9YW4sWm8ucGFzdEZ1dHVyZT1sbixaby5zZXQ9dW4sWm8ubW9udGhzPUssWm8uX21vbnRocz1tbyxaby5tb250aHNTaG9ydD1YLFpvLl9tb250aHNTaG9ydD12byxaby5tb250aHNQYXJzZT1xLFpvLndlZWs9aGUsWm8uX3dlZWs9U28sWm8uZmlyc3REYXlPZlllYXI9cGUsWm8uZmlyc3REYXlPZldlZWs9ZmUsWm8ud2Vla2RheXM9anQsWm8uX3dlZWtkYXlzPVBvLFpvLndlZWtkYXlzTWluPUZ0LFpvLl93ZWVrZGF5c01pbj1Mbyxaby53ZWVrZGF5c1Nob3J0PUJ0LFpvLl93ZWVrZGF5c1Nob3J0PU5vLFpvLndlZWtkYXlzUGFyc2U9VnQsWm8uaXNQTT1LdCxaby5fbWVyaWRpZW1QYXJzZT1Xbyxaby5tZXJpZGllbT1YdCxTKCJlbiIse29yZGluYWxQYXJzZTovXGR7MSwyfSh0aHxzdHxuZHxyZCkvLG9yZGluYWw6ZnVuY3Rpb24oZSl7dmFyIHQ9ZSUxMCxuPTE9PT13KGUlMTAwLzEwKT8idGgiOjE9PT10PyJzdCI6Mj09PXQ/Im5kIjozPT09dD8icmQiOiJ0aCI7cmV0dXJuIGUrbn19KSxlLmxhbmc9bmUoIm1vbWVudC5sYW5nIGlzIGRlcHJlY2F0ZWQuIFVzZSBtb21lbnQubG9jYWxlIGluc3RlYWQuIixTKSxlLmxhbmdEYXRhPW5lKCJtb21lbnQubGFuZ0RhdGEgaXMgZGVwcmVjYXRlZC4gVXNlIG1vbWVudC5sb2NhbGVEYXRhIGluc3RlYWQuIixUKTt2YXIgSm89TWF0aC5hYnMsUW89T24oIm1zIiksZXI9T24oInMiKSx0cj1PbigibSIpLG5yPU9uKCJoIiksb3I9T24oImQiKSxycj1PbigidyIpLGlyPU9uKCJNIiksc3I9T24oInkiKSxhcj1rbigibWlsbGlzZWNvbmRzIiksbHI9a24oInNlY29uZHMiKSx1cj1rbigibWludXRlcyIpLGNyPWtuKCJob3VycyIpLGRyPWtuKCJkYXlzIiksaHI9a24oIm1vbnRocyIpLGZyPWtuKCJ5ZWFycyIpLHByPU1hdGgucm91bmQsZ3I9e3M6NDUsbTo0NSxoOjIyLGQ6MjYsTToxMX0sbXI9TWF0aC5hYnMsdnI9TmUucHJvdG90eXBlO3ZyLmFicz12bix2ci5hZGQ9eW4sdnIuc3VidHJhY3Q9Ym4sdnIuYXM9RW4sdnIuYXNNaWxsaXNlY29uZHM9UW8sdnIuYXNTZWNvbmRzPWVyLHZyLmFzTWludXRlcz10cix2ci5hc0hvdXJzPW5yLHZyLmFzRGF5cz1vcix2ci5hc1dlZWtzPXJyLHZyLmFzTW9udGhzPWlyLHZyLmFzWWVhcnM9c3IsdnIudmFsdWVPZj1Ubix2ci5fYnViYmxlPVJuLHZyLmdldD1Nbix2ci5taWxsaXNlY29uZHM9YXIsdnIuc2Vjb25kcz1scix2ci5taW51dGVzPXVyLHZyLmhvdXJzPWNyLHZyLmRheXM9ZHIsdnIud2Vla3M9SG4sdnIubW9udGhzPWhyLHZyLnllYXJzPWZyLHZyLmh1bWFuaXplPVBuLHZyLnRvSVNPU3RyaW5nPU5uLHZyLnRvU3RyaW5nPU5uLHZyLnRvSlNPTj1Obix2ci5sb2NhbGU9eXQsdnIubG9jYWxlRGF0YT1idCx2ci50b0lzb1N0cmluZz1uZSgidG9Jc29TdHJpbmcoKSBpcyBkZXByZWNhdGVkLiBQbGVhc2UgdXNlIHRvSVNPU3RyaW5nKCkgaW5zdGVhZCAobm90aWNlIHRoZSBjYXBpdGFscykiLE5uKSx2ci5sYW5nPXhvLE4oIlgiLDAsMCwidW5peCIpLE4oIngiLDAsMCwidmFsdWVPZiIpLEYoIngiLG5vKSxGKCJYIixybyksWSgiWCIsZnVuY3Rpb24oZSx0LG4pe24uX2Q9bmV3IERhdGUoMWUzKnBhcnNlRmxvYXQoZSwxMCkpfSksWSgieCIsZnVuY3Rpb24oZSx0LG4pe24uX2Q9bmV3IERhdGUodyhlKSl9KSxlLnZlcnNpb249IjIuMTAuNiIsbyhEZSksZS5mbj1ZbyxlLm1pbj1BZSxlLm1heD1QZSxlLnV0Yz11LGUudW5peD1RdCxlLm1vbnRocz1obixlLmlzRGF0ZT1pLGUubG9jYWxlPVMsZS5pbnZhbGlkPWYsZS5kdXJhdGlvbj1KZSxlLmlzTW9tZW50PW0sZS53ZWVrZGF5cz1wbixlLnBhcnNlWm9uZT1lbixlLmxvY2FsZURhdGE9VCxlLmlzRHVyYXRpb249TGUsZS5tb250aHNTaG9ydD1mbixlLndlZWtkYXlzTWluPW1uLGUuZGVmaW5lTG9jYWxlPUUsZS53ZWVrZGF5c1Nob3J0PWduLGUubm9ybWFsaXplVW5pdHM9TSxlLnJlbGF0aXZlVGltZVRocmVzaG9sZD1Bbjt2YXIgd3I9ZTtyZXR1cm4gd3J9KX0se31dLG51bWVyYWw6W2Z1bmN0aW9uKHQsbixvKXsidXNlIHN0cmljdCI7KGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlKXt0aGlzLl92YWx1ZT1lfWZ1bmN0aW9uIG8oZSx0LG4sbyl7dmFyIHIsaSxzPU1hdGgucG93KDEwLHQpO3JldHVybiBpPShuKGUqcykvcykudG9GaXhlZCh0KSxvJiYocj1uZXcgUmVnRXhwKCIwezEsIitvKyJ9JCIpLGk9aS5yZXBsYWNlKHIsIiIpKSxpfWZ1bmN0aW9uIHIoZSx0LG4pe3ZhciBvO3JldHVybiBvPXQuaW5kZXhPZigiJCIpPi0xP3MoZSx0LG4pOnQuaW5kZXhPZigiJSIpPi0xP2EoZSx0LG4pOnQuaW5kZXhPZigiOiIpPi0xP2woZSx0KTpjKGUuX3ZhbHVlLHQsbil9ZnVuY3Rpb24gaShlLHQpe3ZhciBuLG8scixpLHMsYT10LGw9WyJLQiIsIk1CIiwiR0IiLCJUQiIsIlBCIiwiRUIiLCJaQiIsIllCIl0sYz0hMTtpZih0LmluZGV4T2YoIjoiKT4tMSllLl92YWx1ZT11KHQpO2Vsc2UgaWYodD09PXcpZS5fdmFsdWU9MDtlbHNle2ZvcigiLiIhPT1tW3ZdLmRlbGltaXRlcnMuZGVjaW1hbCYmKHQ9dC5yZXBsYWNlKC9cLi9nLCIiKS5yZXBsYWNlKG1bdl0uZGVsaW1pdGVycy5kZWNpbWFsLCIuIikpLG49bmV3IFJlZ0V4cCgiW15hLXpBLVpdIittW3ZdLmFiYnJldmlhdGlvbnMudGhvdXNhbmQrIig/OlxcKXwoXFwiK21bdl0uY3VycmVuY3kuc3ltYm9sKyIpPyg/OlxcKSk/KT8kIiksbz1uZXcgUmVnRXhwKCJbXmEtekEtWl0iK21bdl0uYWJicmV2aWF0aW9ucy5taWxsaW9uKyIoPzpcXCl8KFxcIittW3ZdLmN1cnJlbmN5LnN5bWJvbCsiKT8oPzpcXCkpPyk/JCIpLHI9bmV3IFJlZ0V4cCgiW15hLXpBLVpdIittW3ZdLmFiYnJldmlhdGlvbnMuYmlsbGlvbisiKD86XFwpfChcXCIrbVt2XS5jdXJyZW5jeS5zeW1ib2wrIik/KD86XFwpKT8pPyQiKSxpPW5ldyBSZWdFeHAoIlteYS16QS1aXSIrbVt2XS5hYmJyZXZpYXRpb25zLnRyaWxsaW9uKyIoPzpcXCl8KFxcIittW3ZdLmN1cnJlbmN5LnN5bWJvbCsiKT8oPzpcXCkpPyk/JCIpLHM9MDtzPD1sLmxlbmd0aCYmIShjPXQuaW5kZXhPZihsW3NdKT4tMT9NYXRoLnBvdygxMDI0LHMrMSk6ITEpO3MrKyk7ZS5fdmFsdWU9KGM/YzoxKSooYS5tYXRjaChuKT9NYXRoLnBvdygxMCwzKToxKSooYS5tYXRjaChvKT9NYXRoLnBvdygxMCw2KToxKSooYS5tYXRjaChyKT9NYXRoLnBvdygxMCw5KToxKSooYS5tYXRjaChpKT9NYXRoLnBvdygxMCwxMik6MSkqKHQuaW5kZXhPZigiJSIpPi0xPy4wMToxKSooKHQuc3BsaXQoIi0iKS5sZW5ndGgrTWF0aC5taW4odC5zcGxpdCgiKCIpLmxlbmd0aC0xLHQuc3BsaXQoIikiKS5sZW5ndGgtMSkpJTI/MTotMSkqTnVtYmVyKHQucmVwbGFjZSgvW14wLTlcLl0rL2csIiIpKSxlLl92YWx1ZT1jP01hdGguY2VpbChlLl92YWx1ZSk6ZS5fdmFsdWV9cmV0dXJuIGUuX3ZhbHVlfWZ1bmN0aW9uIHMoZSx0LG4pe3ZhciBvLHIsaT10LmluZGV4T2YoIiQiKSxzPXQuaW5kZXhPZigiKCIpLGE9dC5pbmRleE9mKCItIiksbD0iIjtyZXR1cm4gdC5pbmRleE9mKCIgJCIpPi0xPyhsPSIgIix0PXQucmVwbGFjZSgiICQiLCIiKSk6dC5pbmRleE9mKCIkICIpPi0xPyhsPSIgIix0PXQucmVwbGFjZSgiJCAiLCIiKSk6dD10LnJlcGxhY2UoIiQiLCIiKSxyPWMoZS5fdmFsdWUsdCxuKSwxPj1pP3IuaW5kZXhPZigiKCIpPi0xfHxyLmluZGV4T2YoIi0iKT4tMT8ocj1yLnNwbGl0KCIiKSxvPTEsKHM+aXx8YT5pKSYmKG89MCksci5zcGxpY2UobywwLG1bdl0uY3VycmVuY3kuc3ltYm9sK2wpLHI9ci5qb2luKCIiKSk6cj1tW3ZdLmN1cnJlbmN5LnN5bWJvbCtsK3I6ci5pbmRleE9mKCIpIik+LTE/KHI9ci5zcGxpdCgiIiksci5zcGxpY2UoLTEsMCxsK21bdl0uY3VycmVuY3kuc3ltYm9sKSxyPXIuam9pbigiIikpOnI9citsK21bdl0uY3VycmVuY3kuc3ltYm9sLHJ9ZnVuY3Rpb24gYShlLHQsbil7dmFyIG8scj0iIixpPTEwMCplLl92YWx1ZTtyZXR1cm4gdC5pbmRleE9mKCIgJSIpPi0xPyhyPSIgIix0PXQucmVwbGFjZSgiICUiLCIiKSk6dD10LnJlcGxhY2UoIiUiLCIiKSxvPWMoaSx0LG4pLG8uaW5kZXhPZigiKSIpPi0xPyhvPW8uc3BsaXQoIiIpLG8uc3BsaWNlKC0xLDAscisiJSIpLG89by5qb2luKCIiKSk6bz1vK3IrIiUiLG99ZnVuY3Rpb24gbChlKXt2YXIgdD1NYXRoLmZsb29yKGUuX3ZhbHVlLzYwLzYwKSxuPU1hdGguZmxvb3IoKGUuX3ZhbHVlLTYwKnQqNjApLzYwKSxvPU1hdGgucm91bmQoZS5fdmFsdWUtNjAqdCo2MC02MCpuKTtyZXR1cm4gdCsiOiIrKDEwPm4/IjAiK246bikrIjoiKygxMD5vPyIwIitvOm8pfWZ1bmN0aW9uIHUoZSl7dmFyIHQ9ZS5zcGxpdCgiOiIpLG49MDtyZXR1cm4gMz09PXQubGVuZ3RoPyhuKz02MCpOdW1iZXIodFswXSkqNjAsbis9NjAqTnVtYmVyKHRbMV0pLG4rPU51bWJlcih0WzJdKSk6Mj09PXQubGVuZ3RoJiYobis9NjAqTnVtYmVyKHRbMF0pLG4rPU51bWJlcih0WzFdKSksTnVtYmVyKG4pfWZ1bmN0aW9uIGMoZSx0LG4pe3ZhciByLGkscyxhLGwsdSxjPSExLGQ9ITEsaD0hMSxmPSIiLHA9ITEsZz0hMSx5PSExLGI9ITEsQz0hMSxSPSIiLF89IiIsUz1NYXRoLmFicyhlKSxFPVsiQiIsIktCIiwiTUIiLCJHQiIsIlRCIiwiUEIiLCJFQiIsIlpCIiwiWUIiXSxUPSIiLE89ITE7aWYoMD09PWUmJm51bGwhPT13KXJldHVybiB3O2lmKHQuaW5kZXhPZigiKCIpPi0xPyhjPSEwLHQ9dC5zbGljZSgxLC0xKSk6dC5pbmRleE9mKCIrIik+LTEmJihkPSEwLHQ9dC5yZXBsYWNlKC9cKy9nLCIiKSksdC5pbmRleE9mKCJhIik+LTEmJihwPXQuaW5kZXhPZigiYUsiKT49MCxnPXQuaW5kZXhPZigiYU0iKT49MCx5PXQuaW5kZXhPZigiYUIiKT49MCxiPXQuaW5kZXhPZigiYVQiKT49MCxDPXB8fGd8fHl8fGIsdC5pbmRleE9mKCIgYSIpPi0xPyhmPSIgIix0PXQucmVwbGFjZSgiIGEiLCIiKSk6dD10LnJlcGxhY2UoImEiLCIiKSxTPj1NYXRoLnBvdygxMCwxMikmJiFDfHxiPyhmKz1tW3ZdLmFiYnJldmlhdGlvbnMudHJpbGxpb24sZS89TWF0aC5wb3coMTAsMTIpKTpTPE1hdGgucG93KDEwLDEyKSYmUz49TWF0aC5wb3coMTAsOSkmJiFDfHx5PyhmKz1tW3ZdLmFiYnJldmlhdGlvbnMuYmlsbGlvbixlLz1NYXRoLnBvdygxMCw5KSk6UzxNYXRoLnBvdygxMCw5KSYmUz49TWF0aC5wb3coMTAsNikmJiFDfHxnPyhmKz1tW3ZdLmFiYnJldmlhdGlvbnMubWlsbGlvbixlLz1NYXRoLnBvdygxMCw2KSk6KFM8TWF0aC5wb3coMTAsNikmJlM+PU1hdGgucG93KDEwLDMpJiYhQ3x8cCkmJihmKz1tW3ZdLmFiYnJldmlhdGlvbnMudGhvdXNhbmQsZS89TWF0aC5wb3coMTAsMykpKSx0LmluZGV4T2YoImIiKT4tMSlmb3IodC5pbmRleE9mKCIgYiIpPi0xPyhSPSIgIix0PXQucmVwbGFjZSgiIGIiLCIiKSk6dD10LnJlcGxhY2UoImIiLCIiKSxzPTA7czw9RS5sZW5ndGg7cysrKWlmKHI9TWF0aC5wb3coMTAyNCxzKSxpPU1hdGgucG93KDEwMjQscysxKSxlPj1yJiZpPmUpe1IrPUVbc10scj4wJiYoZS89cik7YnJlYWt9cmV0dXJuIHQuaW5kZXhPZigibyIpPi0xJiYodC5pbmRleE9mKCIgbyIpPi0xPyhfPSIgIix0PXQucmVwbGFjZSgiIG8iLCIiKSk6dD10LnJlcGxhY2UoIm8iLCIiKSxfKz1tW3ZdLm9yZGluYWwoZSkpLHQuaW5kZXhPZigiWy5dIik+LTEmJihoPSEwLHQ9dC5yZXBsYWNlKCJbLl0iLCIuIikpLGE9ZS50b1N0cmluZygpLnNwbGl0KCIuIilbMF0sbD10LnNwbGl0KCIuIilbMV0sdT10LmluZGV4T2YoIiwiKSxsPyhsLmluZGV4T2YoIlsiKT4tMT8obD1sLnJlcGxhY2UoIl0iLCIiKSxsPWwuc3BsaXQoIlsiKSxUPW8oZSxsWzBdLmxlbmd0aCtsWzFdLmxlbmd0aCxuLGxbMV0ubGVuZ3RoKSk6VD1vKGUsbC5sZW5ndGgsbiksYT1ULnNwbGl0KCIuIilbMF0sVD1ULnNwbGl0KCIuIilbMV0ubGVuZ3RoP21bdl0uZGVsaW1pdGVycy5kZWNpbWFsK1Quc3BsaXQoIi4iKVsxXToiIixoJiYwPT09TnVtYmVyKFQuc2xpY2UoMSkpJiYoVD0iIikpOmE9byhlLG51bGwsbiksYS5pbmRleE9mKCItIik+LTEmJihhPWEuc2xpY2UoMSksTz0hMCksdT4tMSYmKGE9YS50b1N0cmluZygpLnJlcGxhY2UoLyhcZCkoPz0oXGR7M30pKyg/IVxkKSkvZywiJDEiK21bdl0uZGVsaW1pdGVycy50aG91c2FuZHMpKSwwPT09dC5pbmRleE9mKCIuIikmJihhPSIiKSwoYyYmTz8iKCI6IiIpKyghYyYmTz8iLSI6IiIpKyghTyYmZD8iKyI6IiIpK2ErVCsoXz9fOiIiKSsoZj9mOiIiKSsoUj9SOiIiKSsoYyYmTz8iKSI6IiIpfWZ1bmN0aW9uIGQoZSx0KXttW2VdPXR9ZnVuY3Rpb24gaChlKXt2YXIgdD1lLnRvU3RyaW5nKCkuc3BsaXQoIi4iKTtyZXR1cm4gdC5sZW5ndGg8Mj8xOk1hdGgucG93KDEwLHRbMV0ubGVuZ3RoKX1mdW5jdGlvbiBmKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtyZXR1cm4gZS5yZWR1Y2UoZnVuY3Rpb24oZSx0KXt2YXIgbj1oKGUpLG89aCh0KTtyZXR1cm4gbj5vP246b30sLSgxLzApKX12YXIgcCxnPSIxLjUuMyIsbT17fSx2PSJlbiIsdz1udWxsLHk9IjAsMCIsYj0idW5kZWZpbmVkIiE9dHlwZW9mIG4mJm4uZXhwb3J0cztwPWZ1bmN0aW9uKGUpe3JldHVybiBwLmlzTnVtZXJhbChlKT9lPWUudmFsdWUoKTowPT09ZXx8InVuZGVmaW5lZCI9PXR5cGVvZiBlP2U9MDpOdW1iZXIoZSl8fChlPXAuZm4udW5mb3JtYXQoZSkpLG5ldyB0KE51bWJlcihlKSl9LHAudmVyc2lvbj1nLHAuaXNOdW1lcmFsPWZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2YgdH0scC5sYW5ndWFnZT1mdW5jdGlvbihlLHQpe2lmKCFlKXJldHVybiB2O2lmKGUmJiF0KXtpZighbVtlXSl0aHJvdyBuZXcgRXJyb3IoIlVua25vd24gbGFuZ3VhZ2UgOiAiK2UpO3Y9ZX1yZXR1cm4odHx8IW1bZV0pJiZkKGUsdCkscH0scC5sYW5ndWFnZURhdGE9ZnVuY3Rpb24oZSl7aWYoIWUpcmV0dXJuIG1bdl07aWYoIW1bZV0pdGhyb3cgbmV3IEVycm9yKCJVbmtub3duIGxhbmd1YWdlIDogIitlKTtyZXR1cm4gbVtlXX0scC5sYW5ndWFnZSgiZW4iLHtkZWxpbWl0ZXJzOnt0aG91c2FuZHM6IiwiLGRlY2ltYWw6Ii4ifSxhYmJyZXZpYXRpb25zOnt0aG91c2FuZDoiayIsbWlsbGlvbjoibSIsYmlsbGlvbjoiYiIsdHJpbGxpb246InQifSxvcmRpbmFsOmZ1bmN0aW9uKGUpe3ZhciB0PWUlMTA7cmV0dXJuIDE9PT1+fihlJTEwMC8xMCk/InRoIjoxPT09dD8ic3QiOjI9PT10PyJuZCI6Mz09PXQ/InJkIjoidGgifSxjdXJyZW5jeTp7c3ltYm9sOiIkIn19KSxwLnplcm9Gb3JtYXQ9ZnVuY3Rpb24oZSl7dz0ic3RyaW5nIj09dHlwZW9mIGU/ZTpudWxsfSxwLmRlZmF1bHRGb3JtYXQ9ZnVuY3Rpb24oZSl7eT0ic3RyaW5nIj09dHlwZW9mIGU/ZToiMC4wIn0scC52YWxpZGF0ZT1mdW5jdGlvbihlLHQpe3ZhciBuLG8scixpLHMsYSxsLHU7aWYoInN0cmluZyIhPXR5cGVvZiBlJiYoZSs9IiIsY29uc29sZS53YXJuJiZjb25zb2xlLndhcm4oIk51bWVyYWwuanM6IFZhbHVlIGlzIG5vdCBzdHJpbmcuIEl0IGhhcyBiZWVuIGNvLWVyY2VkIHRvOiAiLGUpKSxlPWUudHJpbSgpLCIiPT09ZSlyZXR1cm4hMTtlPWUucmVwbGFjZSgvXlsrLV0/LywiIik7dHJ5e2w9cC5sYW5ndWFnZURhdGEodCl9Y2F0Y2goYyl7bD1wLmxhbmd1YWdlRGF0YShwLmxhbmd1YWdlKCkpfXJldHVybiByPWwuY3VycmVuY3kuc3ltYm9sLHM9bC5hYmJyZXZpYXRpb25zLG49bC5kZWxpbWl0ZXJzLmRlY2ltYWwsbz0iLiI9PT1sLmRlbGltaXRlcnMudGhvdXNhbmRzPyJcXC4iOmwuZGVsaW1pdGVycy50aG91c2FuZHMsdT1lLm1hdGNoKC9eW15cZFwuXCxdKy8pLG51bGwhPT11JiYoZT1lLnN1YnN0cigxKSx1WzBdIT09cik/ITE6KHU9ZS5tYXRjaCgvW15cZF0rJC8pLG51bGwhPT11JiYoZT1lLnNsaWNlKDAsLTEpLHVbMF0hPT1zLnRob3VzYW5kJiZ1WzBdIT09cy5taWxsaW9uJiZ1WzBdIT09cy5iaWxsaW9uJiZ1WzBdIT09cy50cmlsbGlvbik/ITE6ZS5tYXRjaCgvXlxkKyQvKT8hMDooYT1uZXcgUmVnRXhwKG8rInsyfSIpLGUubWF0Y2goL1teXGQuLF0vZyk/ITE6KGk9ZS5zcGxpdChuKSxpLmxlbmd0aD4yPyExOmkubGVuZ3RoPDI/ISFpWzBdLm1hdGNoKC9eXGQrLipcZCQvKSYmIWlbMF0ubWF0Y2goYSk6IiI9PT1pWzBdPyFpWzBdLm1hdGNoKGEpJiYhIWlbMV0ubWF0Y2goL15cZCskLyk6MT09PWlbMF0ubGVuZ3RoPyEhaVswXS5tYXRjaCgvXlxkKyQvKSYmIWlbMF0ubWF0Y2goYSkmJiEhaVsxXS5tYXRjaCgvXlxkKyQvKTohIWlbMF0ubWF0Y2goL15cZCsuKlxkJC8pJiYhaVswXS5tYXRjaChhKSYmISFpWzFdLm1hdGNoKC9eXGQrJC8pKSkpfSwiZnVuY3Rpb24iIT10eXBlb2YgQXJyYXkucHJvdG90eXBlLnJlZHVjZSYmKEFycmF5LnByb3RvdHlwZS5yZWR1Y2U9ZnVuY3Rpb24oZSx0KXtpZihudWxsPT09dGhpc3x8InVuZGVmaW5lZCI9PXR5cGVvZiB0aGlzKXRocm93IG5ldyBUeXBlRXJyb3IoIkFycmF5LnByb3RvdHlwZS5yZWR1Y2UgY2FsbGVkIG9uIG51bGwgb3IgdW5kZWZpbmVkIik7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGUpdGhyb3cgbmV3IFR5cGVFcnJvcihlKyIgaXMgbm90IGEgZnVuY3Rpb24iKTt2YXIgbixvLHI9dGhpcy5sZW5ndGg+Pj4wLGk9ITE7Zm9yKDE8YXJndW1lbnRzLmxlbmd0aCYmKG89dCxpPSEwKSxuPTA7cj5uOysrbil0aGlzLmhhc093blByb3BlcnR5KG4pJiYoaT9vPWUobyx0aGlzW25dLG4sdGhpcyk6KG89dGhpc1tuXSxpPSEwKSk7aWYoIWkpdGhyb3cgbmV3IFR5cGVFcnJvcigiUmVkdWNlIG9mIGVtcHR5IGFycmF5IHdpdGggbm8gaW5pdGlhbCB2YWx1ZSIpO3JldHVybiBvfSkscC5mbj10LnByb3RvdHlwZT17Y2xvbmU6ZnVuY3Rpb24oKXtyZXR1cm4gcCh0aGlzKX0sZm9ybWF0OmZ1bmN0aW9uKGUsdCl7cmV0dXJuIHIodGhpcyxlP2U6eSx2b2lkIDAhPT10P3Q6TWF0aC5yb3VuZCl9LHVuZm9ybWF0OmZ1bmN0aW9uKGUpe3JldHVybiJbb2JqZWN0IE51bWJlcl0iPT09T2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpP2U6aSh0aGlzLGU/ZTp5KX0sdmFsdWU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fdmFsdWV9LHZhbHVlT2Y6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fdmFsdWV9LHNldDpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy5fdmFsdWU9TnVtYmVyKGUpLHRoaXN9LGFkZDpmdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUsdCxvLHIpe3JldHVybiBlK24qdH12YXIgbj1mLmNhbGwobnVsbCx0aGlzLl92YWx1ZSxlKTtyZXR1cm4gdGhpcy5fdmFsdWU9W3RoaXMuX3ZhbHVlLGVdLnJlZHVjZSh0LDApL24sdGhpc30sc3VidHJhY3Q6ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQsbyxyKXtyZXR1cm4gZS1uKnR9dmFyIG49Zi5jYWxsKG51bGwsdGhpcy5fdmFsdWUsZSk7cmV0dXJuIHRoaXMuX3ZhbHVlPVtlXS5yZWR1Y2UodCx0aGlzLl92YWx1ZSpuKS9uLHRoaXN9LG11bHRpcGx5OmZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSx0LG4sbyl7dmFyIHI9ZihlLHQpO3JldHVybiBlKnIqKHQqcikvKHIqcil9cmV0dXJuIHRoaXMuX3ZhbHVlPVt0aGlzLl92YWx1ZSxlXS5yZWR1Y2UodCwxKSx0aGlzfSxkaXZpZGU6ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHQsbixvKXt2YXIgcj1mKGUsdCk7cmV0dXJuIGUqci8odCpyKX1yZXR1cm4gdGhpcy5fdmFsdWU9W3RoaXMuX3ZhbHVlLGVdLnJlZHVjZSh0KSx0aGlzfSxkaWZmZXJlbmNlOmZ1bmN0aW9uKGUpe3JldHVybiBNYXRoLmFicyhwKHRoaXMuX3ZhbHVlKS5zdWJ0cmFjdChlKS52YWx1ZSgpKX19LGImJihuLmV4cG9ydHM9cCksInVuZGVmaW5lZCI9PXR5cGVvZiBlbmRlciYmKHRoaXMubnVtZXJhbD1wKSwiZnVuY3Rpb24iPT10eXBlb2YgZSYmZS5hbWQmJmUoW10sZnVuY3Rpb24oKXtyZXR1cm4gcH0pfSkuY2FsbCh3aW5kb3cpfSx7fV0scGlrYWRheTpbZnVuY3Rpb24odCxuLG8pey8qIQogKiBQaWthZGF5CiAqCiAqIENvcHlyaWdodCDCqSAyMDE0IERhdmlkIEJ1c2hlbGwgfCBCU0QgJiBNSVQgbGljZW5zZSB8IGh0dHBzOi8vZ2l0aHViLmNvbS9kYnVzaGVsbC9QaWthZGF5CiAqLwohZnVuY3Rpb24ocixpKXsidXNlIHN0cmljdCI7dmFyIHM7aWYoIm9iamVjdCI9PXR5cGVvZiBvKXt0cnl7cz10KCJtb21lbnQiKX1jYXRjaChhKXt9bi5leHBvcnRzPWkocyl9ZWxzZSJmdW5jdGlvbiI9PXR5cGVvZiBlJiZlLmFtZD9lKGZ1bmN0aW9uKGUpe3ZhciB0PSJtb21lbnQiO3RyeXtzPWUodCl9Y2F0Y2gobil7fXJldHVybiBpKHMpfSk6ci5QaWthZGF5PWkoci5tb21lbnQpfSh0aGlzLGZ1bmN0aW9uKGUpeyJ1c2Ugc3RyaWN0Ijt2YXIgdD0iZnVuY3Rpb24iPT10eXBlb2YgZSxuPSEhd2luZG93LmFkZEV2ZW50TGlzdGVuZXIsbz13aW5kb3cuZG9jdW1lbnQscj13aW5kb3cuc2V0VGltZW91dCxpPWZ1bmN0aW9uKGUsdCxvLHIpe24/ZS5hZGRFdmVudExpc3RlbmVyKHQsbywhIXIpOmUuYXR0YWNoRXZlbnQoIm9uIit0LG8pfSxzPWZ1bmN0aW9uKGUsdCxvLHIpe24/ZS5yZW1vdmVFdmVudExpc3RlbmVyKHQsbywhIXIpOmUuZGV0YWNoRXZlbnQoIm9uIit0LG8pfSxhPWZ1bmN0aW9uKGUsdCxuKXt2YXIgcjtvLmNyZWF0ZUV2ZW50PyhyPW8uY3JlYXRlRXZlbnQoIkhUTUxFdmVudHMiKSxyLmluaXRFdmVudCh0LCEwLCExKSxyPXkocixuKSxlLmRpc3BhdGNoRXZlbnQocikpOm8uY3JlYXRlRXZlbnRPYmplY3QmJihyPW8uY3JlYXRlRXZlbnRPYmplY3QoKSxyPXkocixuKSxlLmZpcmVFdmVudCgib24iK3QscikpfSxsPWZ1bmN0aW9uKGUpe3JldHVybiBlLnRyaW0/ZS50cmltKCk6ZS5yZXBsYWNlKC9eXHMrfFxzKyQvZywiIil9LHU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4tMSE9PSgiICIrZS5jbGFzc05hbWUrIiAiKS5pbmRleE9mKCIgIit0KyIgIil9LGM9ZnVuY3Rpb24oZSx0KXt1KGUsdCl8fChlLmNsYXNzTmFtZT0iIj09PWUuY2xhc3NOYW1lP3Q6ZS5jbGFzc05hbWUrIiAiK3QpfSxkPWZ1bmN0aW9uKGUsdCl7ZS5jbGFzc05hbWU9bCgoIiAiK2UuY2xhc3NOYW1lKyIgIikucmVwbGFjZSgiICIrdCsiICIsIiAiKSl9LGg9ZnVuY3Rpb24oZSl7cmV0dXJuL0FycmF5Ly50ZXN0KE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKSl9LGY9ZnVuY3Rpb24oZSl7cmV0dXJuL0RhdGUvLnRlc3QoT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKGUpKSYmIWlzTmFOKGUuZ2V0VGltZSgpKX0scD1mdW5jdGlvbihlKXt2YXIgdD1lLmdldERheSgpO3JldHVybiAwPT09dHx8Nj09PXR9LGc9ZnVuY3Rpb24oZSl7cmV0dXJuIGUlND09PTAmJmUlMTAwIT09MHx8ZSU0MDA9PT0wfSxtPWZ1bmN0aW9uKGUsdCl7cmV0dXJuWzMxLGcoZSk/Mjk6MjgsMzEsMzAsMzEsMzAsMzEsMzEsMzAsMzEsMzAsMzFdW3RdfSx2PWZ1bmN0aW9uKGUpe2YoZSkmJmUuc2V0SG91cnMoMCwwLDAsMCl9LHc9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZS5nZXRUaW1lKCk9PT10LmdldFRpbWUoKX0seT1mdW5jdGlvbihlLHQsbil7dmFyIG8scjtmb3IobyBpbiB0KXI9dm9pZCAwIT09ZVtvXSxyJiYib2JqZWN0Ij09dHlwZW9mIHRbb10mJm51bGwhPT10W29dJiZ2b2lkIDA9PT10W29dLm5vZGVOYW1lP2YodFtvXSk/biYmKGVbb109bmV3IERhdGUodFtvXS5nZXRUaW1lKCkpKTpoKHRbb10pP24mJihlW29dPXRbb10uc2xpY2UoMCkpOmVbb109eSh7fSx0W29dLG4pOihufHwhcikmJihlW29dPXRbb10pO3JldHVybiBlfSxiPWZ1bmN0aW9uKGUpe3JldHVybiBlLm1vbnRoPDAmJihlLnllYXItPU1hdGguY2VpbChNYXRoLmFicyhlLm1vbnRoKS8xMiksZS5tb250aCs9MTIpLGUubW9udGg+MTEmJihlLnllYXIrPU1hdGguZmxvb3IoTWF0aC5hYnMoZS5tb250aCkvMTIpLGUubW9udGgtPTEyKSxlfSxDPXtmaWVsZDpudWxsLGJvdW5kOnZvaWQgMCxwb3NpdGlvbjoiYm90dG9tIGxlZnQiLHJlcG9zaXRpb246ITAsZm9ybWF0OiJZWVlZLU1NLUREIixkZWZhdWx0RGF0ZTpudWxsLHNldERlZmF1bHREYXRlOiExLGZpcnN0RGF5OjAsbWluRGF0ZTpudWxsLG1heERhdGU6bnVsbCx5ZWFyUmFuZ2U6MTAsc2hvd1dlZWtOdW1iZXI6ITEsbWluWWVhcjowLG1heFllYXI6OTk5OSxtaW5Nb250aDp2b2lkIDAsbWF4TW9udGg6dm9pZCAwLHN0YXJ0UmFuZ2U6bnVsbCxlbmRSYW5nZTpudWxsLGlzUlRMOiExLHllYXJTdWZmaXg6IiIsc2hvd01vbnRoQWZ0ZXJZZWFyOiExLG51bWJlck9mTW9udGhzOjEsbWFpbkNhbGVuZGFyOiJsZWZ0Iixjb250YWluZXI6dm9pZCAwLGkxOG46e3ByZXZpb3VzTW9udGg6IlByZXZpb3VzIE1vbnRoIixuZXh0TW9udGg6Ik5leHQgTW9udGgiLG1vbnRoczpbIkphbnVhcnkiLCJGZWJydWFyeSIsIk1hcmNoIiwiQXByaWwiLCJNYXkiLCJKdW5lIiwiSnVseSIsIkF1Z3VzdCIsIlNlcHRlbWJlciIsIk9jdG9iZXIiLCJOb3ZlbWJlciIsIkRlY2VtYmVyIl0sd2Vla2RheXM6WyJTdW5kYXkiLCJNb25kYXkiLCJUdWVzZGF5IiwiV2VkbmVzZGF5IiwiVGh1cnNkYXkiLCJGcmlkYXkiLCJTYXR1cmRheSJdLHdlZWtkYXlzU2hvcnQ6WyJTdW4iLCJNb24iLCJUdWUiLCJXZWQiLCJUaHUiLCJGcmkiLCJTYXQiXX0sdGhlbWU6bnVsbCxvblNlbGVjdDpudWxsLG9uT3BlbjpudWxsLG9uQ2xvc2U6bnVsbCxvbkRyYXc6bnVsbH0sUj1mdW5jdGlvbihlLHQsbil7Zm9yKHQrPWUuZmlyc3REYXk7dD49NzspdC09NztyZXR1cm4gbj9lLmkxOG4ud2Vla2RheXNTaG9ydFt0XTplLmkxOG4ud2Vla2RheXNbdF19LF89ZnVuY3Rpb24oZSl7aWYoZS5pc0VtcHR5KXJldHVybic8dGQgY2xhc3M9ImlzLWVtcHR5Ij48L3RkPic7dmFyIHQ9W107cmV0dXJuIGUuaXNEaXNhYmxlZCYmdC5wdXNoKCJpcy1kaXNhYmxlZCIpLGUuaXNUb2RheSYmdC5wdXNoKCJpcy10b2RheSIpLGUuaXNTZWxlY3RlZCYmdC5wdXNoKCJpcy1zZWxlY3RlZCIpLGUuaXNJblJhbmdlJiZ0LnB1c2goImlzLWlucmFuZ2UiKSxlLmlzU3RhcnRSYW5nZSYmdC5wdXNoKCJpcy1zdGFydHJhbmdlIiksZS5pc0VuZFJhbmdlJiZ0LnB1c2goImlzLWVuZHJhbmdlIiksJzx0ZCBkYXRhLWRheT0iJytlLmRheSsnIiBjbGFzcz0iJyt0LmpvaW4oIiAiKSsnIj48YnV0dG9uIGNsYXNzPSJwaWthLWJ1dHRvbiBwaWthLWRheSIgdHlwZT0iYnV0dG9uIiBkYXRhLXBpa2EteWVhcj0iJytlLnllYXIrJyIgZGF0YS1waWthLW1vbnRoPSInK2UubW9udGgrJyIgZGF0YS1waWthLWRheT0iJytlLmRheSsnIj4nK2UuZGF5KyI8L2J1dHRvbj48L3RkPiJ9LFM9ZnVuY3Rpb24oZSx0LG4pe3ZhciBvPW5ldyBEYXRlKG4sMCwxKSxyPU1hdGguY2VpbCgoKG5ldyBEYXRlKG4sdCxlKS1vKS84NjRlNStvLmdldERheSgpKzEpLzcpO3JldHVybic8dGQgY2xhc3M9InBpa2Etd2VlayI+JytyKyI8L3RkPiJ9LEU9ZnVuY3Rpb24oZSx0KXtyZXR1cm4iPHRyPiIrKHQ/ZS5yZXZlcnNlKCk6ZSkuam9pbigiIikrIjwvdHI+In0sVD1mdW5jdGlvbihlKXtyZXR1cm4iPHRib2R5PiIrZS5qb2luKCIiKSsiPC90Ym9keT4ifSxPPWZ1bmN0aW9uKGUpe3ZhciB0LG49W107Zm9yKGUuc2hvd1dlZWtOdW1iZXImJm4ucHVzaCgiPHRoPjwvdGg+IiksdD0wOzc+dDt0Kyspbi5wdXNoKCc8dGggc2NvcGU9ImNvbCI+PGFiYnIgdGl0bGU9IicrUihlLHQpKyciPicrUihlLHQsITApKyI8L2FiYnI+PC90aD4iKTtyZXR1cm4iPHRoZWFkPiIrKGUuaXNSVEw/bi5yZXZlcnNlKCk6bikuam9pbigiIikrIjwvdGhlYWQ+In0sTT1mdW5jdGlvbihlLHQsbixvLHIpe3ZhciBpLHMsYSxsLHUsYz1lLl9vLGQ9bj09PWMubWluWWVhcixmPW49PT1jLm1heFllYXIscD0nPGRpdiBjbGFzcz0icGlrYS10aXRsZSI+JyxnPSEwLG09ITA7Zm9yKGE9W10saT0wOzEyPmk7aSsrKWEucHVzaCgnPG9wdGlvbiB2YWx1ZT0iJysobj09PXI/aS10OjEyK2ktdCkrJyInKyhpPT09bz8iIHNlbGVjdGVkIjoiIikrKGQmJmk8Yy5taW5Nb250aHx8ZiYmaT5jLm1heE1vbnRoPyJkaXNhYmxlZCI6IiIpKyI+IitjLmkxOG4ubW9udGhzW2ldKyI8L29wdGlvbj4iKTtmb3IobD0nPGRpdiBjbGFzcz0icGlrYS1sYWJlbCI+JytjLmkxOG4ubW9udGhzW29dKyc8c2VsZWN0IGNsYXNzPSJwaWthLXNlbGVjdCBwaWthLXNlbGVjdC1tb250aCIgdGFiaW5kZXg9Ii0xIj4nK2Euam9pbigiIikrIjwvc2VsZWN0PjwvZGl2PiIsaChjLnllYXJSYW5nZSk/KGk9Yy55ZWFyUmFuZ2VbMF0scz1jLnllYXJSYW5nZVsxXSsxKTooaT1uLWMueWVhclJhbmdlLHM9MStuK2MueWVhclJhbmdlKSxhPVtdO3M+aSYmaTw9Yy5tYXhZZWFyO2krKylpPj1jLm1pblllYXImJmEucHVzaCgnPG9wdGlvbiB2YWx1ZT0iJytpKyciJysoaT09PW4/IiBzZWxlY3RlZCI6IiIpKyI+IitpKyI8L29wdGlvbj4iKTtyZXR1cm4gdT0nPGRpdiBjbGFzcz0icGlrYS1sYWJlbCI+JytuK2MueWVhclN1ZmZpeCsnPHNlbGVjdCBjbGFzcz0icGlrYS1zZWxlY3QgcGlrYS1zZWxlY3QteWVhciIgdGFiaW5kZXg9Ii0xIj4nK2Euam9pbigiIikrIjwvc2VsZWN0PjwvZGl2PiIscCs9Yy5zaG93TW9udGhBZnRlclllYXI/dStsOmwrdSxkJiYoMD09PW98fGMubWluTW9udGg+PW8pJiYoZz0hMSksZiYmKDExPT09b3x8Yy5tYXhNb250aDw9bykmJihtPSExKSwwPT09dCYmKHArPSc8YnV0dG9uIGNsYXNzPSJwaWthLXByZXYnKyhnPyIiOiIgaXMtZGlzYWJsZWQiKSsnIiB0eXBlPSJidXR0b24iPicrYy5pMThuLnByZXZpb3VzTW9udGgrIjwvYnV0dG9uPiIpLHQ9PT1lLl9vLm51bWJlck9mTW9udGhzLTEmJihwKz0nPGJ1dHRvbiBjbGFzcz0icGlrYS1uZXh0JysobT8iIjoiIGlzLWRpc2FibGVkIikrJyIgdHlwZT0iYnV0dG9uIj4nK2MuaTE4bi5uZXh0TW9udGgrIjwvYnV0dG9uPiIpLHArPSI8L2Rpdj4ifSxrPWZ1bmN0aW9uKGUsdCl7cmV0dXJuJzx0YWJsZSBjZWxscGFkZGluZz0iMCIgY2VsbHNwYWNpbmc9IjAiIGNsYXNzPSJwaWthLXRhYmxlIj4nK08oZSkrVCh0KSsiPC90YWJsZT4ifSxIPWZ1bmN0aW9uKHMpe3ZhciBhPXRoaXMsbD1hLmNvbmZpZyhzKTthLl9vbk1vdXNlRG93bj1mdW5jdGlvbihlKXtpZihhLl92KXtlPWV8fHdpbmRvdy5ldmVudDt2YXIgdD1lLnRhcmdldHx8ZS5zcmNFbGVtZW50O2lmKHQpaWYodSh0LCJpcy1kaXNhYmxlZCIpfHwodSh0LCJwaWthLWJ1dHRvbiIpJiYhdSh0LCJpcy1lbXB0eSIpPyhhLnNldERhdGUobmV3IERhdGUodC5nZXRBdHRyaWJ1dGUoImRhdGEtcGlrYS15ZWFyIiksdC5nZXRBdHRyaWJ1dGUoImRhdGEtcGlrYS1tb250aCIpLHQuZ2V0QXR0cmlidXRlKCJkYXRhLXBpa2EtZGF5IikpKSxsLmJvdW5kJiZyKGZ1bmN0aW9uKCl7YS5oaWRlKCksbC5maWVsZCYmbC5maWVsZC5ibHVyKCl9LDEwMCkpOnUodCwicGlrYS1wcmV2Iik/YS5wcmV2TW9udGgoKTp1KHQsInBpa2EtbmV4dCIpJiZhLm5leHRNb250aCgpKSx1KHQsInBpa2Etc2VsZWN0IikpYS5fYz0hMDtlbHNle2lmKCFlLnByZXZlbnREZWZhdWx0KXJldHVybiBlLnJldHVyblZhbHVlPSExLCExO2UucHJldmVudERlZmF1bHQoKX19fSxhLl9vbkNoYW5nZT1mdW5jdGlvbihlKXtlPWV8fHdpbmRvdy5ldmVudDt2YXIgdD1lLnRhcmdldHx8ZS5zcmNFbGVtZW50O3QmJih1KHQsInBpa2Etc2VsZWN0LW1vbnRoIik/YS5nb3RvTW9udGgodC52YWx1ZSk6dSh0LCJwaWthLXNlbGVjdC15ZWFyIikmJmEuZ290b1llYXIodC52YWx1ZSkpfSxhLl9vbklucHV0Q2hhbmdlPWZ1bmN0aW9uKG4pe3ZhciBvO24uZmlyZWRCeSE9PWEmJih0PyhvPWUobC5maWVsZC52YWx1ZSxsLmZvcm1hdCksbz1vJiZvLmlzVmFsaWQoKT9vLnRvRGF0ZSgpOm51bGwpOm89bmV3IERhdGUoRGF0ZS5wYXJzZShsLmZpZWxkLnZhbHVlKSksZihvKSYmYS5zZXREYXRlKG8pLGEuX3Z8fGEuc2hvdygpKX0sYS5fb25JbnB1dEZvY3VzPWZ1bmN0aW9uKCl7YS5zaG93KCl9LGEuX29uSW5wdXRDbGljaz1mdW5jdGlvbigpe2Euc2hvdygpfSxhLl9vbklucHV0Qmx1cj1mdW5jdGlvbigpe3ZhciBlPW8uYWN0aXZlRWxlbWVudDtkbyBpZih1KGUsInBpa2Etc2luZ2xlIikpcmV0dXJuO3doaWxlKGU9ZS5wYXJlbnROb2RlKTthLl9jfHwoYS5fYj1yKGZ1bmN0aW9uKCl7YS5oaWRlKCl9LDUwKSksYS5fYz0hMX0sYS5fb25DbGljaz1mdW5jdGlvbihlKXtlPWV8fHdpbmRvdy5ldmVudDt2YXIgdD1lLnRhcmdldHx8ZS5zcmNFbGVtZW50LG89dDtpZih0KXshbiYmdSh0LCJwaWthLXNlbGVjdCIpJiYodC5vbmNoYW5nZXx8KHQuc2V0QXR0cmlidXRlKCJvbmNoYW5nZSIsInJldHVybjsiKSxpKHQsImNoYW5nZSIsYS5fb25DaGFuZ2UpKSk7ZG8gaWYodShvLCJwaWthLXNpbmdsZSIpfHxvPT09bC50cmlnZ2VyKXJldHVybjt3aGlsZShvPW8ucGFyZW50Tm9kZSk7YS5fdiYmdCE9PWwudHJpZ2dlciYmbyE9PWwudHJpZ2dlciYmYS5oaWRlKCl9fSxhLmVsPW8uY3JlYXRlRWxlbWVudCgiZGl2IiksYS5lbC5jbGFzc05hbWU9InBpa2Etc2luZ2xlIisobC5pc1JUTD8iIGlzLXJ0bCI6IiIpKyhsLnRoZW1lPyIgIitsLnRoZW1lOiIiKSxpKGEuZWwsIm1vdXNlZG93biIsYS5fb25Nb3VzZURvd24sITApLGkoYS5lbCwidG91Y2hlbmQiLGEuX29uTW91c2VEb3duLCEwKSxpKGEuZWwsImNoYW5nZSIsYS5fb25DaGFuZ2UpLGwuZmllbGQmJihsLmNvbnRhaW5lcj9sLmNvbnRhaW5lci5hcHBlbmRDaGlsZChhLmVsKTpsLmJvdW5kP28uYm9keS5hcHBlbmRDaGlsZChhLmVsKTpsLmZpZWxkLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGEuZWwsbC5maWVsZC5uZXh0U2libGluZyksaShsLmZpZWxkLCJjaGFuZ2UiLGEuX29uSW5wdXRDaGFuZ2UpLGwuZGVmYXVsdERhdGV8fCh0JiZsLmZpZWxkLnZhbHVlP2wuZGVmYXVsdERhdGU9ZShsLmZpZWxkLnZhbHVlLGwuZm9ybWF0KS50b0RhdGUoKTpsLmRlZmF1bHREYXRlPW5ldyBEYXRlKERhdGUucGFyc2UobC5maWVsZC52YWx1ZSkpLGwuc2V0RGVmYXVsdERhdGU9ITApKTt2YXIgYz1sLmRlZmF1bHREYXRlO2YoYyk/bC5zZXREZWZhdWx0RGF0ZT9hLnNldERhdGUoYywhMCk6YS5nb3RvRGF0ZShjKTphLmdvdG9EYXRlKG5ldyBEYXRlKSxsLmJvdW5kPyh0aGlzLmhpZGUoKSxhLmVsLmNsYXNzTmFtZSs9IiBpcy1ib3VuZCIsaShsLnRyaWdnZXIsImNsaWNrIixhLl9vbklucHV0Q2xpY2spLGkobC50cmlnZ2VyLCJmb2N1cyIsYS5fb25JbnB1dEZvY3VzKSxpKGwudHJpZ2dlciwiYmx1ciIsYS5fb25JbnB1dEJsdXIpKTp0aGlzLnNob3coKX07cmV0dXJuIEgucHJvdG90eXBlPXtjb25maWc6ZnVuY3Rpb24oZSl7dGhpcy5fb3x8KHRoaXMuX289eSh7fSxDLCEwKSk7dmFyIHQ9eSh0aGlzLl9vLGUsITApO3QuaXNSVEw9ISF0LmlzUlRMLHQuZmllbGQ9dC5maWVsZCYmdC5maWVsZC5ub2RlTmFtZT90LmZpZWxkOm51bGwsdC50aGVtZT0ic3RyaW5nIj09dHlwZW9mIHQudGhlbWUmJnQudGhlbWU/dC50aGVtZTpudWxsLHQuYm91bmQ9ISEodm9pZCAwIT09dC5ib3VuZD90LmZpZWxkJiZ0LmJvdW5kOnQuZmllbGQpLHQudHJpZ2dlcj10LnRyaWdnZXImJnQudHJpZ2dlci5ub2RlTmFtZT90LnRyaWdnZXI6dC5maWVsZCx0LmRpc2FibGVXZWVrZW5kcz0hIXQuZGlzYWJsZVdlZWtlbmRzLHQuZGlzYWJsZURheUZuPSJmdW5jdGlvbiI9PXR5cGVvZiB0LmRpc2FibGVEYXlGbj90LmRpc2FibGVEYXlGbjpudWxsO3ZhciBuPXBhcnNlSW50KHQubnVtYmVyT2ZNb250aHMsMTApfHwxO2lmKHQubnVtYmVyT2ZNb250aHM9bj40PzQ6bixmKHQubWluRGF0ZSl8fCh0Lm1pbkRhdGU9ITEpLGYodC5tYXhEYXRlKXx8KHQubWF4RGF0ZT0hMSksdC5taW5EYXRlJiZ0Lm1heERhdGUmJnQubWF4RGF0ZTx0Lm1pbkRhdGUmJih0Lm1heERhdGU9dC5taW5EYXRlPSExKSx0Lm1pbkRhdGUmJnRoaXMuc2V0TWluRGF0ZSh0Lm1pbkRhdGUpLHQubWF4RGF0ZSYmdGhpcy5zZXRNYXhEYXRlKHQubWF4RGF0ZSksaCh0LnllYXJSYW5nZSkpe3ZhciBvPShuZXcgRGF0ZSkuZ2V0RnVsbFllYXIoKS0xMDt0LnllYXJSYW5nZVswXT1wYXJzZUludCh0LnllYXJSYW5nZVswXSwxMCl8fG8sdC55ZWFyUmFuZ2VbMV09cGFyc2VJbnQodC55ZWFyUmFuZ2VbMV0sMTApfHxvfWVsc2UgdC55ZWFyUmFuZ2U9TWF0aC5hYnMocGFyc2VJbnQodC55ZWFyUmFuZ2UsMTApKXx8Qy55ZWFyUmFuZ2UsdC55ZWFyUmFuZ2U+MTAwJiYodC55ZWFyUmFuZ2U9MTAwKTtyZXR1cm4gdH0sdG9TdHJpbmc6ZnVuY3Rpb24obil7cmV0dXJuIGYodGhpcy5fZCk/dD9lKHRoaXMuX2QpLmZvcm1hdChufHx0aGlzLl9vLmZvcm1hdCk6dGhpcy5fZC50b0RhdGVTdHJpbmcoKToiIn0sZ2V0TW9tZW50OmZ1bmN0aW9uKCl7cmV0dXJuIHQ/ZSh0aGlzLl9kKTpudWxsfSxzZXRNb21lbnQ6ZnVuY3Rpb24obixvKXt0JiZlLmlzTW9tZW50KG4pJiZ0aGlzLnNldERhdGUobi50b0RhdGUoKSxvKX0sZ2V0RGF0ZTpmdW5jdGlvbigpe3JldHVybiBmKHRoaXMuX2QpP25ldyBEYXRlKHRoaXMuX2QuZ2V0VGltZSgpKTpudWxsfSxzZXREYXRlOmZ1bmN0aW9uKGUsdCl7aWYoIWUpcmV0dXJuIHRoaXMuX2Q9bnVsbCx0aGlzLl9vLmZpZWxkJiYodGhpcy5fby5maWVsZC52YWx1ZT0iIixhKHRoaXMuX28uZmllbGQsImNoYW5nZSIse2ZpcmVkQnk6dGhpc30pKSx0aGlzLmRyYXcoKTtpZigic3RyaW5nIj09dHlwZW9mIGUmJihlPW5ldyBEYXRlKERhdGUucGFyc2UoZSkpKSxmKGUpKXt2YXIgbj10aGlzLl9vLm1pbkRhdGUsbz10aGlzLl9vLm1heERhdGU7ZihuKSYmbj5lP2U9bjpmKG8pJiZlPm8mJihlPW8pLHRoaXMuX2Q9bmV3IERhdGUoZS5nZXRUaW1lKCkpLHYodGhpcy5fZCksdGhpcy5nb3RvRGF0ZSh0aGlzLl9kKSx0aGlzLl9vLmZpZWxkJiYodGhpcy5fby5maWVsZC52YWx1ZT10aGlzLnRvU3RyaW5nKCksYSh0aGlzLl9vLmZpZWxkLCJjaGFuZ2UiLHtmaXJlZEJ5OnRoaXN9KSksdHx8ImZ1bmN0aW9uIiE9dHlwZW9mIHRoaXMuX28ub25TZWxlY3R8fHRoaXMuX28ub25TZWxlY3QuY2FsbCh0aGlzLHRoaXMuZ2V0RGF0ZSgpKX19LGdvdG9EYXRlOmZ1bmN0aW9uKGUpe3ZhciB0PSEwO2lmKGYoZSkpe2lmKHRoaXMuY2FsZW5kYXJzKXt2YXIgbj1uZXcgRGF0ZSh0aGlzLmNhbGVuZGFyc1swXS55ZWFyLHRoaXMuY2FsZW5kYXJzWzBdLm1vbnRoLDEpLG89bmV3IERhdGUodGhpcy5jYWxlbmRhcnNbdGhpcy5jYWxlbmRhcnMubGVuZ3RoLTFdLnllYXIsdGhpcy5jYWxlbmRhcnNbdGhpcy5jYWxlbmRhcnMubGVuZ3RoLTFdLm1vbnRoLDEpLHI9ZS5nZXRUaW1lKCk7by5zZXRNb250aChvLmdldE1vbnRoKCkrMSksby5zZXREYXRlKG8uZ2V0RGF0ZSgpLTEpLHQ9cjxuLmdldFRpbWUoKXx8by5nZXRUaW1lKCk8cn10JiYodGhpcy5jYWxlbmRhcnM9W3ttb250aDplLmdldE1vbnRoKCkseWVhcjplLmdldEZ1bGxZZWFyKCl9XSwicmlnaHQiPT09dGhpcy5fby5tYWluQ2FsZW5kYXImJih0aGlzLmNhbGVuZGFyc1swXS5tb250aCs9MS10aGlzLl9vLm51bWJlck9mTW9udGhzKSksdGhpcy5hZGp1c3RDYWxlbmRhcnMoKX19LGFkanVzdENhbGVuZGFyczpmdW5jdGlvbigpe3RoaXMuY2FsZW5kYXJzWzBdPWIodGhpcy5jYWxlbmRhcnNbMF0pO2Zvcih2YXIgZT0xO2U8dGhpcy5fby5udW1iZXJPZk1vbnRocztlKyspdGhpcy5jYWxlbmRhcnNbZV09Yih7bW9udGg6dGhpcy5jYWxlbmRhcnNbMF0ubW9udGgrZSx5ZWFyOnRoaXMuY2FsZW5kYXJzWzBdLnllYXJ9KTt0aGlzLmRyYXcoKX0sZ290b1RvZGF5OmZ1bmN0aW9uKCl7dGhpcy5nb3RvRGF0ZShuZXcgRGF0ZSl9LGdvdG9Nb250aDpmdW5jdGlvbihlKXtpc05hTihlKXx8KHRoaXMuY2FsZW5kYXJzWzBdLm1vbnRoPXBhcnNlSW50KGUsMTApLHRoaXMuYWRqdXN0Q2FsZW5kYXJzKCkpfSxuZXh0TW9udGg6ZnVuY3Rpb24oKXt0aGlzLmNhbGVuZGFyc1swXS5tb250aCsrLHRoaXMuYWRqdXN0Q2FsZW5kYXJzKCl9LHByZXZNb250aDpmdW5jdGlvbigpe3RoaXMuY2FsZW5kYXJzWzBdLm1vbnRoLS0sdGhpcy5hZGp1c3RDYWxlbmRhcnMoKX0sZ290b1llYXI6ZnVuY3Rpb24oZSl7aXNOYU4oZSl8fCh0aGlzLmNhbGVuZGFyc1swXS55ZWFyPXBhcnNlSW50KGUsMTApLHRoaXMuYWRqdXN0Q2FsZW5kYXJzKCkpfSxzZXRNaW5EYXRlOmZ1bmN0aW9uKGUpe3YoZSksdGhpcy5fby5taW5EYXRlPWUsdGhpcy5fby5taW5ZZWFyPWUuZ2V0RnVsbFllYXIoKSx0aGlzLl9vLm1pbk1vbnRoPWUuZ2V0TW9udGgoKSx0aGlzLmRyYXcoKX0sc2V0TWF4RGF0ZTpmdW5jdGlvbihlKXt2KGUpLHRoaXMuX28ubWF4RGF0ZT1lLHRoaXMuX28ubWF4WWVhcj1lLmdldEZ1bGxZZWFyKCksdGhpcy5fby5tYXhNb250aD1lLmdldE1vbnRoKCksdGhpcy5kcmF3KCl9LHNldFN0YXJ0UmFuZ2U6ZnVuY3Rpb24oZSl7dGhpcy5fby5zdGFydFJhbmdlPWV9LHNldEVuZFJhbmdlOmZ1bmN0aW9uKGUpe3RoaXMuX28uZW5kUmFuZ2U9ZX0sZHJhdzpmdW5jdGlvbihlKXtpZih0aGlzLl92fHxlKXt2YXIgdD10aGlzLl9vLG49dC5taW5ZZWFyLG89dC5tYXhZZWFyLGk9dC5taW5Nb250aCxzPXQubWF4TW9udGgsYT0iIjt0aGlzLl95PD1uJiYodGhpcy5feT1uLCFpc05hTihpKSYmdGhpcy5fbTxpJiYodGhpcy5fbT1pKSksdGhpcy5feT49byYmKHRoaXMuX3k9bywhaXNOYU4ocykmJnRoaXMuX20+cyYmKHRoaXMuX209cykpO2Zvcih2YXIgbD0wO2w8dC5udW1iZXJPZk1vbnRocztsKyspYSs9JzxkaXYgY2xhc3M9InBpa2EtbGVuZGFyIj4nK00odGhpcyxsLHRoaXMuY2FsZW5kYXJzW2xdLnllYXIsdGhpcy5jYWxlbmRhcnNbbF0ubW9udGgsdGhpcy5jYWxlbmRhcnNbMF0ueWVhcikrdGhpcy5yZW5kZXIodGhpcy5jYWxlbmRhcnNbbF0ueWVhcix0aGlzLmNhbGVuZGFyc1tsXS5tb250aCkrIjwvZGl2PiI7aWYodGhpcy5lbC5pbm5lckhUTUw9YSx0LmJvdW5kJiYiaGlkZGVuIiE9PXQuZmllbGQudHlwZSYmcihmdW5jdGlvbigpe3QudHJpZ2dlci5mb2N1cygpfSwxKSwiZnVuY3Rpb24iPT10eXBlb2YgdGhpcy5fby5vbkRyYXcpe3ZhciB1PXRoaXM7cihmdW5jdGlvbigpe3UuX28ub25EcmF3LmNhbGwodSl9LDApfX19LGFkanVzdFBvc2l0aW9uOmZ1bmN0aW9uKCl7dmFyIGUsdCxuLHIsaSxzLGEsbCx1LGM7aWYoIXRoaXMuX28uY29udGFpbmVyKXtpZih0aGlzLmVsLnN0eWxlLnBvc2l0aW9uPSJhYnNvbHV0ZSIsZT10aGlzLl9vLnRyaWdnZXIsdD1lLG49dGhpcy5lbC5vZmZzZXRXaWR0aCxyPXRoaXMuZWwub2Zmc2V0SGVpZ2h0LGk9d2luZG93LmlubmVyV2lkdGh8fG8uZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoLHM9d2luZG93LmlubmVySGVpZ2h0fHxvLmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQsYT13aW5kb3cucGFnZVlPZmZzZXR8fG8uYm9keS5zY3JvbGxUb3B8fG8uZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCwiZnVuY3Rpb24iPT10eXBlb2YgZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QpYz1lLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLGw9Yy5sZWZ0K3dpbmRvdy5wYWdlWE9mZnNldCx1PWMuYm90dG9tK3dpbmRvdy5wYWdlWU9mZnNldDtlbHNlIGZvcihsPXQub2Zmc2V0TGVmdCx1PXQub2Zmc2V0VG9wK3Qub2Zmc2V0SGVpZ2h0O3Q9dC5vZmZzZXRQYXJlbnQ7KWwrPXQub2Zmc2V0TGVmdCx1Kz10Lm9mZnNldFRvcDsodGhpcy5fby5yZXBvc2l0aW9uJiZsK24+aXx8dGhpcy5fby5wb3NpdGlvbi5pbmRleE9mKCJyaWdodCIpPi0xJiZsLW4rZS5vZmZzZXRXaWR0aD4wKSYmKGw9bC1uK2Uub2Zmc2V0V2lkdGgpLCh0aGlzLl9vLnJlcG9zaXRpb24mJnUrcj5zK2F8fHRoaXMuX28ucG9zaXRpb24uaW5kZXhPZigidG9wIik+LTEmJnUtci1lLm9mZnNldEhlaWdodD4wKSYmKHU9dS1yLWUub2Zmc2V0SGVpZ2h0KSx0aGlzLmVsLnN0eWxlLmxlZnQ9bCsicHgiLHRoaXMuZWwuc3R5bGUudG9wPXUrInB4In19LHJlbmRlcjpmdW5jdGlvbihlLHQpe3ZhciBuPXRoaXMuX28sbz1uZXcgRGF0ZSxyPW0oZSx0KSxpPW5ldyBEYXRlKGUsdCwxKS5nZXREYXkoKSxzPVtdLGE9W107dihvKSxuLmZpcnN0RGF5PjAmJihpLT1uLmZpcnN0RGF5LDA+aSYmKGkrPTcpKTtmb3IodmFyIGw9citpLHU9bDt1Pjc7KXUtPTc7bCs9Ny11O2Zvcih2YXIgYz0wLGQ9MDtsPmM7YysrKXt2YXIgaD1uZXcgRGF0ZShlLHQsMSsoYy1pKSksZz1mKHRoaXMuX2QpP3coaCx0aGlzLl9kKTohMSx5PXcoaCxvKSxiPWk+Y3x8Yz49citpLEM9bi5zdGFydFJhbmdlJiZ3KG4uc3RhcnRSYW5nZSxoKSxSPW4uZW5kUmFuZ2UmJncobi5lbmRSYW5nZSxoKSxUPW4uc3RhcnRSYW5nZSYmbi5lbmRSYW5nZSYmbi5zdGFydFJhbmdlPGgmJmg8bi5lbmRSYW5nZSxPPW4ubWluRGF0ZSYmaDxuLm1pbkRhdGV8fG4ubWF4RGF0ZSYmaD5uLm1heERhdGV8fG4uZGlzYWJsZVdlZWtlbmRzJiZwKGgpfHxuLmRpc2FibGVEYXlGbiYmbi5kaXNhYmxlRGF5Rm4oaCksTT17ZGF5OjErKGMtaSksbW9udGg6dCx5ZWFyOmUsaXNTZWxlY3RlZDpnLGlzVG9kYXk6eSxpc0Rpc2FibGVkOk8saXNFbXB0eTpiLGlzU3RhcnRSYW5nZTpDLGlzRW5kUmFuZ2U6Uixpc0luUmFuZ2U6VH07YS5wdXNoKF8oTSkpLDc9PT0rK2QmJihuLnNob3dXZWVrTnVtYmVyJiZhLnVuc2hpZnQoUyhjLWksdCxlKSkscy5wdXNoKEUoYSxuLmlzUlRMKSksYT1bXSxkPTApfXJldHVybiBrKG4scyl9LGlzVmlzaWJsZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl92fSxzaG93OmZ1bmN0aW9uKCl7dGhpcy5fdnx8KGQodGhpcy5lbCwiaXMtaGlkZGVuIiksdGhpcy5fdj0hMCx0aGlzLmRyYXcoKSx0aGlzLl9vLmJvdW5kJiYoaShvLCJjbGljayIsdGhpcy5fb25DbGljayksdGhpcy5hZGp1c3RQb3NpdGlvbigpKSwiZnVuY3Rpb24iPT10eXBlb2YgdGhpcy5fby5vbk9wZW4mJnRoaXMuX28ub25PcGVuLmNhbGwodGhpcykpfSxoaWRlOmZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5fdjtlIT09ITEmJih0aGlzLl9vLmJvdW5kJiZzKG8sImNsaWNrIix0aGlzLl9vbkNsaWNrKSx0aGlzLmVsLnN0eWxlLnBvc2l0aW9uPSJzdGF0aWMiLHRoaXMuZWwuc3R5bGUubGVmdD0iYXV0byIsdGhpcy5lbC5zdHlsZS50b3A9ImF1dG8iLGModGhpcy5lbCwiaXMtaGlkZGVuIiksdGhpcy5fdj0hMSx2b2lkIDAhPT1lJiYiZnVuY3Rpb24iPT10eXBlb2YgdGhpcy5fby5vbkNsb3NlJiZ0aGlzLl9vLm9uQ2xvc2UuY2FsbCh0aGlzKSl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXt0aGlzLmhpZGUoKSxzKHRoaXMuZWwsIm1vdXNlZG93biIsdGhpcy5fb25Nb3VzZURvd24sITApLHModGhpcy5lbCwidG91Y2hlbmQiLHRoaXMuX29uTW91c2VEb3duLCEwKSxzKHRoaXMuZWwsImNoYW5nZSIsdGhpcy5fb25DaGFuZ2UpLHRoaXMuX28uZmllbGQmJihzKHRoaXMuX28uZmllbGQsImNoYW5nZSIsdGhpcy5fb25JbnB1dENoYW5nZSksdGhpcy5fby5ib3VuZCYmKHModGhpcy5fby50cmlnZ2VyLCJjbGljayIsdGhpcy5fb25JbnB1dENsaWNrKSxzKHRoaXMuX28udHJpZ2dlciwiZm9jdXMiLHRoaXMuX29uSW5wdXRGb2N1cykscyh0aGlzLl9vLnRyaWdnZXIsImJsdXIiLHRoaXMuX29uSW5wdXRCbHVyKSkpLHRoaXMuZWwucGFyZW50Tm9kZSYmdGhpcy5lbC5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKHRoaXMuZWwpfX0sSH0pfSx7bW9tZW50OiJtb21lbnQifV0semVyb2NsaXBib2FyZDpbZnVuY3Rpb24odCxuLG8pey8qIQogKiBaZXJvQ2xpcGJvYXJkCiAqIFRoZSBaZXJvQ2xpcGJvYXJkIGxpYnJhcnkgcHJvdmlkZXMgYW4gZWFzeSB3YXkgdG8gY29weSB0ZXh0IHRvIHRoZSBjbGlwYm9hcmQgdXNpbmcgYW4gaW52aXNpYmxlIEFkb2JlIEZsYXNoIG1vdmllIGFuZCBhIEphdmFTY3JpcHQgaW50ZXJmYWNlLgogKiBDb3B5cmlnaHQgKGMpIDIwMDktMjAxNCBKb24gUm9oYW4sIEphbWVzIE0uIEdyZWVuZQogKiBMaWNlbnNlZCBNSVQKICogaHR0cDovL3plcm9jbGlwYm9hcmQub3JnLwogKiB2Mi4yLjAKICovCiFmdW5jdGlvbih0LG8peyJ1c2Ugc3RyaWN0Ijt2YXIgcixpLHMsYT10LGw9YS5kb2N1bWVudCx1PWEubmF2aWdhdG9yLGM9YS5zZXRUaW1lb3V0LGQ9YS5jbGVhclRpbWVvdXQsaD1hLnNldEludGVydmFsLGY9YS5jbGVhckludGVydmFsLHA9YS5nZXRDb21wdXRlZFN0eWxlLGc9YS5lbmNvZGVVUklDb21wb25lbnQsbT1hLkFjdGl2ZVhPYmplY3Qsdj1hLkVycm9yLHc9YS5OdW1iZXIucGFyc2VJbnR8fGEucGFyc2VJbnQseT1hLk51bWJlci5wYXJzZUZsb2F0fHxhLnBhcnNlRmxvYXQsYj1hLk51bWJlci5pc05hTnx8YS5pc05hTixDPWEuRGF0ZS5ub3csUj1hLk9iamVjdC5rZXlzLF89YS5PYmplY3QuZGVmaW5lUHJvcGVydHksUz1hLk9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHksRT1hLkFycmF5LnByb3RvdHlwZS5zbGljZSxUPWZ1bmN0aW9uKCl7dmFyIGU9ZnVuY3Rpb24oZSl7cmV0dXJuIGV9O2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBhLndyYXAmJiJmdW5jdGlvbiI9PXR5cGVvZiBhLnVud3JhcCl0cnl7dmFyIHQ9bC5jcmVhdGVFbGVtZW50KCJkaXYiKSxuPWEudW53cmFwKHQpOzE9PT10Lm5vZGVUeXBlJiZuJiYxPT09bi5ub2RlVHlwZSYmKGU9YS51bndyYXApfWNhdGNoKG8pe31yZXR1cm4gZX0oKSxPPWZ1bmN0aW9uKGUpe3JldHVybiBFLmNhbGwoZSwwKX0sTT1mdW5jdGlvbigpe3ZhciBlLHQsbixyLGkscyxhPU8oYXJndW1lbnRzKSxsPWFbMF18fHt9O2ZvcihlPTEsdD1hLmxlbmd0aDt0PmU7ZSsrKWlmKG51bGwhPShuPWFbZV0pKWZvcihyIGluIG4pUy5jYWxsKG4scikmJihpPWxbcl0scz1uW3JdLGwhPT1zJiZzIT09byYmKGxbcl09cykpO3JldHVybiBsfSxrPWZ1bmN0aW9uKGUpe3ZhciB0LG4sbyxyO2lmKCJvYmplY3QiIT10eXBlb2YgZXx8bnVsbD09ZXx8Im51bWJlciI9PXR5cGVvZiBlLm5vZGVUeXBlKXQ9ZTtlbHNlIGlmKCJudW1iZXIiPT10eXBlb2YgZS5sZW5ndGgpZm9yKHQ9W10sbj0wLG89ZS5sZW5ndGg7bz5uO24rKylTLmNhbGwoZSxuKSYmKHRbbl09ayhlW25dKSk7ZWxzZXt0PXt9O2ZvcihyIGluIGUpUy5jYWxsKGUscikmJih0W3JdPWsoZVtyXSkpfXJldHVybiB0fSxIPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciBuPXt9LG89MCxyPXQubGVuZ3RoO3I+bztvKyspdFtvXWluIGUmJihuW3Rbb11dPWVbdFtvXV0pO3JldHVybiBufSxEPWZ1bmN0aW9uKGUsdCl7dmFyIG49e307Zm9yKHZhciBvIGluIGUpLTE9PT10LmluZGV4T2YobykmJihuW29dPWVbb10pO3JldHVybiBufSx4PWZ1bmN0aW9uKGUpe2lmKGUpZm9yKHZhciB0IGluIGUpUy5jYWxsKGUsdCkmJmRlbGV0ZSBlW3RdO3JldHVybiBlfSxBPWZ1bmN0aW9uKGUsdCl7aWYoZSYmMT09PWUubm9kZVR5cGUmJmUub3duZXJEb2N1bWVudCYmdCYmKDE9PT10Lm5vZGVUeXBlJiZ0Lm93bmVyRG9jdW1lbnQmJnQub3duZXJEb2N1bWVudD09PWUub3duZXJEb2N1bWVudHx8OT09PXQubm9kZVR5cGUmJiF0Lm93bmVyRG9jdW1lbnQmJnQ9PT1lLm93bmVyRG9jdW1lbnQpKWRve2lmKGU9PT10KXJldHVybiEwO2U9ZS5wYXJlbnROb2RlfXdoaWxlKGUpO3JldHVybiExfSxQPWZ1bmN0aW9uKGUpe3ZhciB0O3JldHVybiJzdHJpbmciPT10eXBlb2YgZSYmZSYmKHQ9ZS5zcGxpdCgiIyIpWzBdLnNwbGl0KCI/IilbMF0sdD1lLnNsaWNlKDAsZS5sYXN0SW5kZXhPZigiLyIpKzEpKSx0fSxOPWZ1bmN0aW9uKGUpe3ZhciB0LG47cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlJiZlJiYobj1lLm1hdGNoKC9eKD86fFteOkBdKkB8LitcKUAoPz1odHRwW3NdP3xmaWxlKXwuKz9ccysoPzogYXQgfEApKD86W146XChdKyApKltcKF0/KSgoPzpodHRwW3NdP3xmaWxlKTpcL1wvW1wvXT8uKz9cL1teOlwpXSo/KSg/OjpcZCspKD86OlxkKyk/LyksbiYmblsxXT90PW5bMV06KG49ZS5tYXRjaCgvXClAKCg/Omh0dHBbc10/fGZpbGUpOlwvXC9bXC9dPy4rP1wvW146XCldKj8pKD86OlxkKykoPzo6XGQrKT8vKSxuJiZuWzFdJiYodD1uWzFdKSkpLHR9LEw9ZnVuY3Rpb24oKXt2YXIgZSx0O3RyeXt0aHJvdyBuZXcgdn1jYXRjaChuKXt0PW59cmV0dXJuIHQmJihlPXQuc291cmNlVVJMfHx0LmZpbGVOYW1lfHxOKHQuc3RhY2spKSxlfSxXPWZ1bmN0aW9uKCl7dmFyIGUsdCxuO2lmKGwuY3VycmVudFNjcmlwdCYmKGU9bC5jdXJyZW50U2NyaXB0LnNyYykpcmV0dXJuIGU7aWYodD1sLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJzY3JpcHQiKSwxPT09dC5sZW5ndGgpcmV0dXJuIHRbMF0uc3JjfHxvO2lmKCJyZWFkeVN0YXRlImluIHRbMF0pZm9yKG49dC5sZW5ndGg7bi0tOylpZigiaW50ZXJhY3RpdmUiPT09dFtuXS5yZWFkeVN0YXRlJiYoZT10W25dLnNyYykpcmV0dXJuIGU7cmV0dXJuImxvYWRpbmciPT09bC5yZWFkeVN0YXRlJiYoZT10W3QubGVuZ3RoLTFdLnNyYyk/ZTooZT1MKCkpP2U6b30sST1mdW5jdGlvbigpe3ZhciBlLHQsbixyPWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoInNjcmlwdCIpO2ZvcihlPXIubGVuZ3RoO2UtLTspe2lmKCEobj1yW2VdLnNyYykpe3Q9bnVsbDticmVha31pZihuPVAobiksbnVsbD09dCl0PW47ZWxzZSBpZih0IT09bil7dD1udWxsO2JyZWFrfX1yZXR1cm4gdHx8b30saj1mdW5jdGlvbigpe3ZhciBlPVAoVygpKXx8SSgpfHwiIjtyZXR1cm4gZSsiWmVyb0NsaXBib2FyZC5zd2YifSxCPWZ1bmN0aW9uKCl7cmV0dXJuIG51bGw9PXQub3BlbmVyJiYoISF0LnRvcCYmdCE9dC50b3B8fCEhdC5wYXJlbnQmJnQhPXQucGFyZW50KX0oKSxGPXticmlkZ2U6bnVsbCx2ZXJzaW9uOiIwLjAuMCIscGx1Z2luVHlwZToidW5rbm93biIsZGlzYWJsZWQ6bnVsbCxvdXRkYXRlZDpudWxsLHNhbmRib3hlZDpudWxsLHVuYXZhaWxhYmxlOm51bGwsZGVncmFkZWQ6bnVsbCxkZWFjdGl2YXRlZDpudWxsLG92ZXJkdWU6bnVsbCxyZWFkeTpudWxsfSxWPSIxMS4wLjAiLHo9e30sWT17fSxVPW51bGwsRz0wLCQ9MCxLPXtyZWFkeToiRmxhc2ggY29tbXVuaWNhdGlvbiBpcyBlc3RhYmxpc2hlZCIsZXJyb3I6eyJmbGFzaC1kaXNhYmxlZCI6IkZsYXNoIGlzIGRpc2FibGVkIG9yIG5vdCBpbnN0YWxsZWQuIE1heSBhbHNvIGJlIGF0dGVtcHRpbmcgdG8gcnVuIEZsYXNoIGluIGEgc2FuZGJveGVkIGlmcmFtZSwgd2hpY2ggaXMgaW1wb3NzaWJsZS4iLCJmbGFzaC1vdXRkYXRlZCI6IkZsYXNoIGlzIHRvbyBvdXRkYXRlZCB0byBzdXBwb3J0IFplcm9DbGlwYm9hcmQiLCJmbGFzaC1zYW5kYm94ZWQiOiJBdHRlbXB0aW5nIHRvIHJ1biBGbGFzaCBpbiBhIHNhbmRib3hlZCBpZnJhbWUsIHdoaWNoIGlzIGltcG9zc2libGUiLCJmbGFzaC11bmF2YWlsYWJsZSI6IkZsYXNoIGlzIHVuYWJsZSB0byBjb21tdW5pY2F0ZSBiaWRpcmVjdGlvbmFsbHkgd2l0aCBKYXZhU2NyaXB0IiwiZmxhc2gtZGVncmFkZWQiOiJGbGFzaCBpcyB1bmFibGUgdG8gcHJlc2VydmUgZGF0YSBmaWRlbGl0eSB3aGVuIGNvbW11bmljYXRpbmcgd2l0aCBKYXZhU2NyaXB0IiwiZmxhc2gtZGVhY3RpdmF0ZWQiOiJGbGFzaCBpcyB0b28gb3V0ZGF0ZWQgZm9yIHlvdXIgYnJvd3NlciBhbmQvb3IgaXMgY29uZmlndXJlZCBhcyBjbGljay10by1hY3RpdmF0ZS5cblRoaXMgbWF5IGFsc28gbWVhbiB0aGF0IHRoZSBaZXJvQ2xpcGJvYXJkIFNXRiBvYmplY3QgY291bGQgbm90IGJlIGxvYWRlZCwgc28gcGxlYXNlIGNoZWNrIHlvdXIgYHN3ZlBhdGhgIGNvbmZpZ3VyYXRpb24gYW5kL29yIG5ldHdvcmsgY29ubmVjdGl2aXR5LlxuTWF5IGFsc28gYmUgYXR0ZW1wdGluZyB0byBydW4gRmxhc2ggaW4gYSBzYW5kYm94ZWQgaWZyYW1lLCB3aGljaCBpcyBpbXBvc3NpYmxlLiIsImZsYXNoLW92ZXJkdWUiOiJGbGFzaCBjb21tdW5pY2F0aW9uIHdhcyBlc3RhYmxpc2hlZCBidXQgTk9UIHdpdGhpbiB0aGUgYWNjZXB0YWJsZSB0aW1lIGxpbWl0IiwidmVyc2lvbi1taXNtYXRjaCI6Ilplcm9DbGlwYm9hcmQgSlMgdmVyc2lvbiBudW1iZXIgZG9lcyBub3QgbWF0Y2ggWmVyb0NsaXBib2FyZCBTV0YgdmVyc2lvbiBudW1iZXIiLCJjbGlwYm9hcmQtZXJyb3IiOiJBdCBsZWFzdCBvbmUgZXJyb3Igd2FzIHRocm93biB3aGlsZSBaZXJvQ2xpcGJvYXJkIHdhcyBhdHRlbXB0aW5nIHRvIGluamVjdCB5b3VyIGRhdGEgaW50byB0aGUgY2xpcGJvYXJkIiwiY29uZmlnLW1pc21hdGNoIjoiWmVyb0NsaXBib2FyZCBjb25maWd1cmF0aW9uIGRvZXMgbm90IG1hdGNoIEZsYXNoJ3MgcmVhbGl0eSIsInN3Zi1ub3QtZm91bmQiOiJUaGUgWmVyb0NsaXBib2FyZCBTV0Ygb2JqZWN0IGNvdWxkIG5vdCBiZSBsb2FkZWQsIHNvIHBsZWFzZSBjaGVjayB5b3VyIGBzd2ZQYXRoYCBjb25maWd1cmF0aW9uIGFuZC9vciBuZXR3b3JrIGNvbm5lY3Rpdml0eSJ9fSxYPVsiZmxhc2gtdW5hdmFpbGFibGUiLCJmbGFzaC1kZWdyYWRlZCIsImZsYXNoLW92ZXJkdWUiLCJ2ZXJzaW9uLW1pc21hdGNoIiwiY29uZmlnLW1pc21hdGNoIiwiY2xpcGJvYXJkLWVycm9yIl0scT1bImZsYXNoLWRpc2FibGVkIiwiZmxhc2gtb3V0ZGF0ZWQiLCJmbGFzaC1zYW5kYm94ZWQiLCJmbGFzaC11bmF2YWlsYWJsZSIsImZsYXNoLWRlZ3JhZGVkIiwiZmxhc2gtZGVhY3RpdmF0ZWQiLCJmbGFzaC1vdmVyZHVlIl0sWj1uZXcgUmVnRXhwKCJeZmxhc2gtKCIrcS5tYXAoZnVuY3Rpb24oZSl7cmV0dXJuIGUucmVwbGFjZSgvXmZsYXNoLS8sIiIpfSkuam9pbigifCIpKyIpJCIpLEo9bmV3IFJlZ0V4cCgiXmZsYXNoLSgiK3Euc2xpY2UoMSkubWFwKGZ1bmN0aW9uKGUpe3JldHVybiBlLnJlcGxhY2UoL15mbGFzaC0vLCIiKX0pLmpvaW4oInwiKSsiKSQiKSxRPXtzd2ZQYXRoOmooKSx0cnVzdGVkRG9tYWluczp0LmxvY2F0aW9uLmhvc3Q/W3QubG9jYXRpb24uaG9zdF06W10sY2FjaGVCdXN0OiEwLGZvcmNlRW5oYW5jZWRDbGlwYm9hcmQ6ITEsZmxhc2hMb2FkVGltZW91dDozZTQsYXV0b0FjdGl2YXRlOiEwLGJ1YmJsZUV2ZW50czohMCxjb250YWluZXJJZDoiZ2xvYmFsLXplcm9jbGlwYm9hcmQtaHRtbC1icmlkZ2UiLGNvbnRhaW5lckNsYXNzOiJnbG9iYWwtemVyb2NsaXBib2FyZC1jb250YWluZXIiLHN3Zk9iamVjdElkOiJnbG9iYWwtemVyb2NsaXBib2FyZC1mbGFzaC1icmlkZ2UiLGhvdmVyQ2xhc3M6Inplcm9jbGlwYm9hcmQtaXMtaG92ZXIiLGFjdGl2ZUNsYXNzOiJ6ZXJvY2xpcGJvYXJkLWlzLWFjdGl2ZSIsZm9yY2VIYW5kQ3Vyc29yOiExLHRpdGxlOm51bGwsekluZGV4Ojk5OTk5OTk5OX0sZWU9ZnVuY3Rpb24oZSl7aWYoIm9iamVjdCI9PXR5cGVvZiBlJiZudWxsIT09ZSlmb3IodmFyIHQgaW4gZSlpZihTLmNhbGwoZSx0KSlpZigvXig/OmZvcmNlSGFuZEN1cnNvcnx0aXRsZXx6SW5kZXh8YnViYmxlRXZlbnRzKSQvLnRlc3QodCkpUVt0XT1lW3RdO2Vsc2UgaWYobnVsbD09Ri5icmlkZ2UpaWYoImNvbnRhaW5lcklkIj09PXR8fCJzd2ZPYmplY3RJZCI9PT10KXtpZighZ2UoZVt0XSkpdGhyb3cgbmV3IEVycm9yKCJUaGUgc3BlY2lmaWVkIGAiK3QrImAgdmFsdWUgaXMgbm90IHZhbGlkIGFzIGFuIEhUTUw0IEVsZW1lbnQgSUQiKTtRW3RdPWVbdF19ZWxzZSBRW3RdPWVbdF07e2lmKCJzdHJpbmciIT10eXBlb2YgZXx8IWUpcmV0dXJuIGsoUSk7aWYoUy5jYWxsKFEsZSkpcmV0dXJuIFFbZV19fSx0ZT1mdW5jdGlvbigpe3JldHVybiAkZSgpLHticm93c2VyOkgodSxbInVzZXJBZ2VudCIsInBsYXRmb3JtIiwiYXBwTmFtZSJdKSxmbGFzaDpEKEYsWyJicmlkZ2UiXSksemVyb2NsaXBib2FyZDp7dmVyc2lvbjpYZS52ZXJzaW9uLGNvbmZpZzpYZS5jb25maWcoKX19fSxuZT1mdW5jdGlvbigpe3JldHVybiEhKEYuZGlzYWJsZWR8fEYub3V0ZGF0ZWR8fEYuc2FuZGJveGVkfHxGLnVuYXZhaWxhYmxlfHxGLmRlZ3JhZGVkfHxGLmRlYWN0aXZhdGVkKX0sb2U9ZnVuY3Rpb24oZSx0KXt2YXIgbixpLHMsYT17fTtpZigic3RyaW5nIj09dHlwZW9mIGUmJmUpcz1lLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xzKy8pO2Vsc2UgaWYoIm9iamVjdCI9PXR5cGVvZiBlJiZlJiYidW5kZWZpbmVkIj09dHlwZW9mIHQpZm9yKG4gaW4gZSlTLmNhbGwoZSxuKSYmInN0cmluZyI9PXR5cGVvZiBuJiZuJiYiZnVuY3Rpb24iPT10eXBlb2YgZVtuXSYmWGUub24obixlW25dKTtpZihzJiZzLmxlbmd0aCl7Zm9yKG49MCxpPXMubGVuZ3RoO2k+bjtuKyspZT1zW25dLnJlcGxhY2UoL15vbi8sIiIpLGFbZV09ITAseltlXXx8KHpbZV09W10pLHpbZV0ucHVzaCh0KTtpZihhLnJlYWR5JiZGLnJlYWR5JiZYZS5lbWl0KHt0eXBlOiJyZWFkeSJ9KSxhLmVycm9yKXtmb3Iobj0wLGk9cS5sZW5ndGg7aT5uO24rKylpZihGW3Fbbl0ucmVwbGFjZSgvXmZsYXNoLS8sIiIpXT09PSEwKXtYZS5lbWl0KHt0eXBlOiJlcnJvciIsbmFtZTpxW25dfSk7YnJlYWt9ciE9PW8mJlhlLnZlcnNpb24hPT1yJiZYZS5lbWl0KHt0eXBlOiJlcnJvciIsbmFtZToidmVyc2lvbi1taXNtYXRjaCIsanNWZXJzaW9uOlhlLnZlcnNpb24sc3dmVmVyc2lvbjpyfSl9fXJldHVybiBYZX0scmU9ZnVuY3Rpb24oZSx0KXt2YXIgbixvLHIsaSxzO2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKWk9Uih6KTtlbHNlIGlmKCJzdHJpbmciPT10eXBlb2YgZSYmZSlpPWUuc3BsaXQoL1xzKy8pO2Vsc2UgaWYoIm9iamVjdCI9PXR5cGVvZiBlJiZlJiYidW5kZWZpbmVkIj09dHlwZW9mIHQpZm9yKG4gaW4gZSlTLmNhbGwoZSxuKSYmInN0cmluZyI9PXR5cGVvZiBuJiZuJiYiZnVuY3Rpb24iPT10eXBlb2YgZVtuXSYmWGUub2ZmKG4sZVtuXSk7aWYoaSYmaS5sZW5ndGgpZm9yKG49MCxvPWkubGVuZ3RoO28+bjtuKyspaWYoZT1pW25dLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXm9uLywiIikscz16W2VdLHMmJnMubGVuZ3RoKWlmKHQpZm9yKHI9cy5pbmRleE9mKHQpOy0xIT09cjspcy5zcGxpY2UociwxKSxyPXMuaW5kZXhPZih0LHIpO2Vsc2Ugcy5sZW5ndGg9MDtyZXR1cm4gWGV9LGllPWZ1bmN0aW9uKGUpe3ZhciB0O3JldHVybiB0PSJzdHJpbmciPT10eXBlb2YgZSYmZT9rKHpbZV0pfHxudWxsOmsoeil9LHNlPWZ1bmN0aW9uKGUpe3ZhciB0LG4sbztyZXR1cm4gZT1tZShlKSxlJiYhX2UoZSk/InJlYWR5Ij09PWUudHlwZSYmRi5vdmVyZHVlPT09ITA/WGUuZW1pdCh7dHlwZToiZXJyb3IiLG5hbWU6ImZsYXNoLW92ZXJkdWUifSk6KHQ9TSh7fSxlKSxDZS5jYWxsKHRoaXMsdCksImNvcHkiPT09ZS50eXBlJiYobz1EZShZKSxuPW8uZGF0YSxVPW8uZm9ybWF0TWFwKSxuKTp2b2lkIDB9LGFlPWZ1bmN0aW9uKCl7dmFyIGU9Ri5zYW5kYm94ZWQ7aWYoJGUoKSwiYm9vbGVhbiIhPXR5cGVvZiBGLnJlYWR5JiYoRi5yZWFkeT0hMSksRi5zYW5kYm94ZWQhPT1lJiZGLnNhbmRib3hlZD09PSEwKUYucmVhZHk9ITEsWGUuZW1pdCh7dHlwZToiZXJyb3IiLG5hbWU6ImZsYXNoLXNhbmRib3hlZCJ9KTtlbHNlIGlmKCFYZS5pc0ZsYXNoVW51c2FibGUoKSYmbnVsbD09PUYuYnJpZGdlKXt2YXIgdD1RLmZsYXNoTG9hZFRpbWVvdXQ7Im51bWJlciI9PXR5cGVvZiB0JiZ0Pj0wJiYoRz1jKGZ1bmN0aW9uKCl7ImJvb2xlYW4iIT10eXBlb2YgRi5kZWFjdGl2YXRlZCYmKEYuZGVhY3RpdmF0ZWQ9ITApLEYuZGVhY3RpdmF0ZWQ9PT0hMCYmWGUuZW1pdCh7dHlwZToiZXJyb3IiLG5hbWU6ImZsYXNoLWRlYWN0aXZhdGVkIn0pfSx0KSksRi5vdmVyZHVlPSExLGtlKCl9fSxsZT1mdW5jdGlvbigpe1hlLmNsZWFyRGF0YSgpLFhlLmJsdXIoKSxYZS5lbWl0KCJkZXN0cm95IiksSGUoKSxYZS5vZmYoKX0sdWU9ZnVuY3Rpb24oZSx0KXt2YXIgbjtpZigib2JqZWN0Ij09dHlwZW9mIGUmJmUmJiJ1bmRlZmluZWQiPT10eXBlb2YgdCluPWUsWGUuY2xlYXJEYXRhKCk7ZWxzZXtpZigic3RyaW5nIiE9dHlwZW9mIGV8fCFlKXJldHVybjtuPXt9LG5bZV09dH1mb3IodmFyIG8gaW4gbikic3RyaW5nIj09dHlwZW9mIG8mJm8mJlMuY2FsbChuLG8pJiYic3RyaW5nIj09dHlwZW9mIG5bb10mJm5bb10mJihZW29dPW5bb10pfSxjZT1mdW5jdGlvbihlKXsidW5kZWZpbmVkIj09dHlwZW9mIGU/KHgoWSksVT1udWxsKToic3RyaW5nIj09dHlwZW9mIGUmJlMuY2FsbChZLGUpJiZkZWxldGUgWVtlXX0sZGU9ZnVuY3Rpb24oZSl7cmV0dXJuInVuZGVmaW5lZCI9PXR5cGVvZiBlP2soWSk6InN0cmluZyI9PXR5cGVvZiBlJiZTLmNhbGwoWSxlKT9ZW2VdOnZvaWQgMH0saGU9ZnVuY3Rpb24oZSl7aWYoZSYmMT09PWUubm9kZVR5cGUpe2kmJihqZShpLFEuYWN0aXZlQ2xhc3MpLGkhPT1lJiZqZShpLFEuaG92ZXJDbGFzcykpLGk9ZSxJZShlLFEuaG92ZXJDbGFzcyk7dmFyIHQ9ZS5nZXRBdHRyaWJ1dGUoInRpdGxlIil8fFEudGl0bGU7aWYoInN0cmluZyI9PXR5cGVvZiB0JiZ0KXt2YXIgbj1NZShGLmJyaWRnZSk7biYmbi5zZXRBdHRyaWJ1dGUoInRpdGxlIix0KX12YXIgbz1RLmZvcmNlSGFuZEN1cnNvcj09PSEwfHwicG9pbnRlciI9PT1CZShlLCJjdXJzb3IiKTtVZShvKSxZZSgpfX0sZmU9ZnVuY3Rpb24oKXt2YXIgZT1NZShGLmJyaWRnZSk7ZSYmKGUucmVtb3ZlQXR0cmlidXRlKCJ0aXRsZSIpLGUuc3R5bGUubGVmdD0iMHB4IixlLnN0eWxlLnRvcD0iLTk5OTlweCIsZS5zdHlsZS53aWR0aD0iMXB4IixlLnN0eWxlLmhlaWdodD0iMXB4IiksaSYmKGplKGksUS5ob3ZlckNsYXNzKSxqZShpLFEuYWN0aXZlQ2xhc3MpLGk9bnVsbCl9LHBlPWZ1bmN0aW9uKCl7cmV0dXJuIGl8fG51bGx9LGdlPWZ1bmN0aW9uKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZSYmZSYmL15bQS1aYS16XVtBLVphLXowLTlfOlwtXC5dKiQvLnRlc3QoZSl9LG1lPWZ1bmN0aW9uKGUpe3ZhciB0O2lmKCJzdHJpbmciPT10eXBlb2YgZSYmZT8odD1lLGU9e30pOiJvYmplY3QiPT10eXBlb2YgZSYmZSYmInN0cmluZyI9PXR5cGVvZiBlLnR5cGUmJmUudHlwZSYmKHQ9ZS50eXBlKSx0KXt0PXQudG9Mb3dlckNhc2UoKSwhZS50YXJnZXQmJigvXihjb3B5fGFmdGVyY29weXxfY2xpY2spJC8udGVzdCh0KXx8ImVycm9yIj09PXQmJiJjbGlwYm9hcmQtZXJyb3IiPT09ZS5uYW1lKSYmKGUudGFyZ2V0PXMpLE0oZSx7dHlwZTp0LHRhcmdldDplLnRhcmdldHx8aXx8bnVsbCxyZWxhdGVkVGFyZ2V0OmUucmVsYXRlZFRhcmdldHx8bnVsbCxjdXJyZW50VGFyZ2V0OkYmJkYuYnJpZGdlfHxudWxsLHRpbWVTdGFtcDplLnRpbWVTdGFtcHx8QygpfHxudWxsfSk7dmFyIG49S1tlLnR5cGVdO3JldHVybiJlcnJvciI9PT1lLnR5cGUmJmUubmFtZSYmbiYmKG49bltlLm5hbWVdKSxuJiYoZS5tZXNzYWdlPW4pLCJyZWFkeSI9PT1lLnR5cGUmJk0oZSx7dGFyZ2V0Om51bGwsdmVyc2lvbjpGLnZlcnNpb259KSwiZXJyb3IiPT09ZS50eXBlJiYoWi50ZXN0KGUubmFtZSkmJk0oZSx7dGFyZ2V0Om51bGwsbWluaW11bVZlcnNpb246Vn0pLEoudGVzdChlLm5hbWUpJiZNKGUse3ZlcnNpb246Ri52ZXJzaW9ufSkpLCJjb3B5Ij09PWUudHlwZSYmKGUuY2xpcGJvYXJkRGF0YT17c2V0RGF0YTpYZS5zZXREYXRhLGNsZWFyRGF0YTpYZS5jbGVhckRhdGF9KSwiYWZ0ZXJjb3B5Ij09PWUudHlwZSYmKGU9eGUoZSxVKSksZS50YXJnZXQmJiFlLnJlbGF0ZWRUYXJnZXQmJihlLnJlbGF0ZWRUYXJnZXQ9dmUoZS50YXJnZXQpKSx3ZShlKX19LHZlPWZ1bmN0aW9uKGUpe3ZhciB0PWUmJmUuZ2V0QXR0cmlidXRlJiZlLmdldEF0dHJpYnV0ZSgiZGF0YS1jbGlwYm9hcmQtdGFyZ2V0Iik7cmV0dXJuIHQ/bC5nZXRFbGVtZW50QnlJZCh0KTpudWxsfSx3ZT1mdW5jdGlvbihlKXtpZihlJiYvXl8oPzpjbGlja3xtb3VzZSg/Om92ZXJ8b3V0fGRvd258dXB8bW92ZSkpJC8udGVzdChlLnR5cGUpKXt2YXIgdD1lLnRhcmdldCxuPSJfbW91c2VvdmVyIj09PWUudHlwZSYmZS5yZWxhdGVkVGFyZ2V0P2UucmVsYXRlZFRhcmdldDpvLHI9Il9tb3VzZW91dCI9PT1lLnR5cGUmJmUucmVsYXRlZFRhcmdldD9lLnJlbGF0ZWRUYXJnZXQ6byxpPUZlKHQpLHM9YS5zY3JlZW5MZWZ0fHxhLnNjcmVlblh8fDAsdT1hLnNjcmVlblRvcHx8YS5zY3JlZW5ZfHwwLGM9bC5ib2R5LnNjcm9sbExlZnQrbC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCxkPWwuYm9keS5zY3JvbGxUb3ArbC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wLGg9aS5sZWZ0KygibnVtYmVyIj09dHlwZW9mIGUuX3N0YWdlWD9lLl9zdGFnZVg6MCksZj1pLnRvcCsoIm51bWJlciI9PXR5cGVvZiBlLl9zdGFnZVk/ZS5fc3RhZ2VZOjApLHA9aC1jLGc9Zi1kLG09cytwLHY9dStnLHc9Im51bWJlciI9PXR5cGVvZiBlLm1vdmVtZW50WD9lLm1vdmVtZW50WDowLHk9Im51bWJlciI9PXR5cGVvZiBlLm1vdmVtZW50WT9lLm1vdmVtZW50WTowO2RlbGV0ZSBlLl9zdGFnZVgsZGVsZXRlIGUuX3N0YWdlWSxNKGUse3NyY0VsZW1lbnQ6dCxmcm9tRWxlbWVudDpuLHRvRWxlbWVudDpyLHNjcmVlblg6bSxzY3JlZW5ZOnYscGFnZVg6aCxwYWdlWTpmLGNsaWVudFg6cCxjbGllbnRZOmcseDpwLHk6Zyxtb3ZlbWVudFg6dyxtb3ZlbWVudFk6eSxvZmZzZXRYOjAsb2Zmc2V0WTowLGxheWVyWDowLGxheWVyWTowfSl9cmV0dXJuIGV9LHllPWZ1bmN0aW9uKGUpe3ZhciB0PWUmJiJzdHJpbmciPT10eXBlb2YgZS50eXBlJiZlLnR5cGV8fCIiO3JldHVybiEvXig/Oig/OmJlZm9yZSk/Y29weXxkZXN0cm95KSQvLnRlc3QodCl9LGJlPWZ1bmN0aW9uKGUsdCxuLG8pe28/YyhmdW5jdGlvbigpe2UuYXBwbHkodCxuKX0sMCk6ZS5hcHBseSh0LG4pfSxDZT1mdW5jdGlvbihlKXtpZigib2JqZWN0Ij09dHlwZW9mIGUmJmUmJmUudHlwZSl7dmFyIHQ9eWUoZSksbj16WyIqIl18fFtdLG89eltlLnR5cGVdfHxbXSxyPW4uY29uY2F0KG8pO2lmKHImJnIubGVuZ3RoKXt2YXIgaSxzLGwsdSxjLGQ9dGhpcztmb3IoaT0wLHM9ci5sZW5ndGg7cz5pO2krKylsPXJbaV0sdT1kLCJzdHJpbmciPT10eXBlb2YgbCYmImZ1bmN0aW9uIj09dHlwZW9mIGFbbF0mJihsPWFbbF0pLCJvYmplY3QiPT10eXBlb2YgbCYmbCYmImZ1bmN0aW9uIj09dHlwZW9mIGwuaGFuZGxlRXZlbnQmJih1PWwsbD1sLmhhbmRsZUV2ZW50KSwiZnVuY3Rpb24iPT10eXBlb2YgbCYmKGM9TSh7fSxlKSxiZShsLHUsW2NdLHQpKX1yZXR1cm4gdGhpc319LFJlPWZ1bmN0aW9uKGUpe3ZhciB0PW51bGw7cmV0dXJuKEI9PT0hMXx8ZSYmImVycm9yIj09PWUudHlwZSYmZS5uYW1lJiYtMSE9PVguaW5kZXhPZihlLm5hbWUpKSYmKHQ9ITEpLHR9LF9lPWZ1bmN0aW9uKGUpe3ZhciB0PWUudGFyZ2V0fHxpfHxudWxsLG49InN3ZiI9PT1lLl9zb3VyY2U7c3dpdGNoKGRlbGV0ZSBlLl9zb3VyY2UsZS50eXBlKXtjYXNlImVycm9yIjp2YXIgbz0iZmxhc2gtc2FuZGJveGVkIj09PWUubmFtZXx8UmUoZSk7ImJvb2xlYW4iPT10eXBlb2YgbyYmKEYuc2FuZGJveGVkPW8pLC0xIT09cS5pbmRleE9mKGUubmFtZSk/TShGLHtkaXNhYmxlZDoiZmxhc2gtZGlzYWJsZWQiPT09ZS5uYW1lLG91dGRhdGVkOiJmbGFzaC1vdXRkYXRlZCI9PT1lLm5hbWUsdW5hdmFpbGFibGU6ImZsYXNoLXVuYXZhaWxhYmxlIj09PWUubmFtZSxkZWdyYWRlZDoiZmxhc2gtZGVncmFkZWQiPT09ZS5uYW1lLGRlYWN0aXZhdGVkOiJmbGFzaC1kZWFjdGl2YXRlZCI9PT1lLm5hbWUsb3ZlcmR1ZToiZmxhc2gtb3ZlcmR1ZSI9PT1lLm5hbWUscmVhZHk6ITF9KToidmVyc2lvbi1taXNtYXRjaCI9PT1lLm5hbWUmJihyPWUuc3dmVmVyc2lvbixNKEYse2Rpc2FibGVkOiExLG91dGRhdGVkOiExLHVuYXZhaWxhYmxlOiExLGRlZ3JhZGVkOiExLGRlYWN0aXZhdGVkOiExLG92ZXJkdWU6ITEscmVhZHk6ITF9KSksemUoKTticmVhaztjYXNlInJlYWR5IjpyPWUuc3dmVmVyc2lvbjt2YXIgYT1GLmRlYWN0aXZhdGVkPT09ITA7TShGLHtkaXNhYmxlZDohMSxvdXRkYXRlZDohMSxzYW5kYm94ZWQ6ITEsdW5hdmFpbGFibGU6ITEsZGVncmFkZWQ6ITEsZGVhY3RpdmF0ZWQ6ITEsb3ZlcmR1ZTphLHJlYWR5OiFhfSksemUoKTticmVhaztjYXNlImJlZm9yZWNvcHkiOnM9dDticmVhaztjYXNlImNvcHkiOnZhciBsLHUsYz1lLnJlbGF0ZWRUYXJnZXQ7IVlbInRleHQvaHRtbCJdJiYhWVsidGV4dC9wbGFpbiJdJiZjJiYodT1jLnZhbHVlfHxjLm91dGVySFRNTHx8Yy5pbm5lckhUTUwpJiYobD1jLnZhbHVlfHxjLnRleHRDb250ZW50fHxjLmlubmVyVGV4dCk/KGUuY2xpcGJvYXJkRGF0YS5jbGVhckRhdGEoKSxlLmNsaXBib2FyZERhdGEuc2V0RGF0YSgidGV4dC9wbGFpbiIsbCksdSE9PWwmJmUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCJ0ZXh0L2h0bWwiLHUpKTohWVsidGV4dC9wbGFpbiJdJiZlLnRhcmdldCYmKGw9ZS50YXJnZXQuZ2V0QXR0cmlidXRlKCJkYXRhLWNsaXBib2FyZC10ZXh0IikpJiYoZS5jbGlwYm9hcmREYXRhLmNsZWFyRGF0YSgpLGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCJ0ZXh0L3BsYWluIixsKSk7YnJlYWs7Y2FzZSJhZnRlcmNvcHkiOlNlKGUpLFhlLmNsZWFyRGF0YSgpLHQmJnQhPT1XZSgpJiZ0LmZvY3VzJiZ0LmZvY3VzKCk7YnJlYWs7Y2FzZSJfbW91c2VvdmVyIjpYZS5mb2N1cyh0KSxRLmJ1YmJsZUV2ZW50cz09PSEwJiZuJiYodCYmdCE9PWUucmVsYXRlZFRhcmdldCYmIUEoZS5yZWxhdGVkVGFyZ2V0LHQpJiZFZShNKHt9LGUse3R5cGU6Im1vdXNlZW50ZXIiLGJ1YmJsZXM6ITEsY2FuY2VsYWJsZTohMX0pKSxFZShNKHt9LGUse3R5cGU6Im1vdXNlb3ZlciJ9KSkpO2JyZWFrO2Nhc2UiX21vdXNlb3V0IjpYZS5ibHVyKCksUS5idWJibGVFdmVudHM9PT0hMCYmbiYmKHQmJnQhPT1lLnJlbGF0ZWRUYXJnZXQmJiFBKGUucmVsYXRlZFRhcmdldCx0KSYmRWUoTSh7fSxlLHt0eXBlOiJtb3VzZWxlYXZlIixidWJibGVzOiExLGNhbmNlbGFibGU6ITF9KSksRWUoTSh7fSxlLHt0eXBlOiJtb3VzZW91dCJ9KSkpO2JyZWFrO2Nhc2UiX21vdXNlZG93biI6SWUodCxRLmFjdGl2ZUNsYXNzKSxRLmJ1YmJsZUV2ZW50cz09PSEwJiZuJiZFZShNKHt9LGUse3R5cGU6ZS50eXBlLnNsaWNlKDEpfSkpO2JyZWFrO2Nhc2UiX21vdXNldXAiOmplKHQsUS5hY3RpdmVDbGFzcyksUS5idWJibGVFdmVudHM9PT0hMCYmbiYmRWUoTSh7fSxlLHt0eXBlOmUudHlwZS5zbGljZSgxKX0pKTticmVhaztjYXNlIl9jbGljayI6cz1udWxsLFEuYnViYmxlRXZlbnRzPT09ITAmJm4mJkVlKE0oe30sZSx7dHlwZTplLnR5cGUuc2xpY2UoMSl9KSk7YnJlYWs7Y2FzZSJfbW91c2Vtb3ZlIjpRLmJ1YmJsZUV2ZW50cz09PSEwJiZuJiZFZShNKHt9LGUse3R5cGU6ZS50eXBlLnNsaWNlKDEpfSkpfXJldHVybi9eXyg/OmNsaWNrfG1vdXNlKD86b3ZlcnxvdXR8ZG93bnx1cHxtb3ZlKSkkLy50ZXN0KGUudHlwZSk/ITA6dm9pZCAwfSxTZT1mdW5jdGlvbihlKXtpZihlLmVycm9ycyYmZS5lcnJvcnMubGVuZ3RoPjApe3ZhciB0PWsoZSk7TSh0LHt0eXBlOiJlcnJvciIsbmFtZToiY2xpcGJvYXJkLWVycm9yIn0pLGRlbGV0ZSB0LnN1Y2Nlc3MsYyhmdW5jdGlvbigpe1hlLmVtaXQodCl9LDApfX0sRWU9ZnVuY3Rpb24oZSl7aWYoZSYmInN0cmluZyI9PXR5cGVvZiBlLnR5cGUmJmUpe3ZhciB0LG49ZS50YXJnZXR8fG51bGwsbz1uJiZuLm93bmVyRG9jdW1lbnR8fGwscj17dmlldzpvLmRlZmF1bHRWaWV3fHxhLGNhbkJ1YmJsZTohMCxjYW5jZWxhYmxlOiEwLGRldGFpbDoiY2xpY2siPT09ZS50eXBlPzE6MCxidXR0b246Im51bWJlciI9PXR5cGVvZiBlLndoaWNoP2Uud2hpY2gtMToibnVtYmVyIj09dHlwZW9mIGUuYnV0dG9uP2UuYnV0dG9uOm8uY3JlYXRlRXZlbnQ/MDoxfSxpPU0ocixlKTtuJiZvLmNyZWF0ZUV2ZW50JiZuLmRpc3BhdGNoRXZlbnQmJihpPVtpLnR5cGUsaS5jYW5CdWJibGUsaS5jYW5jZWxhYmxlLGkudmlldyxpLmRldGFpbCxpLnNjcmVlblgsaS5zY3JlZW5ZLGkuY2xpZW50WCxpLmNsaWVudFksaS5jdHJsS2V5LGkuYWx0S2V5LGkuc2hpZnRLZXksaS5tZXRhS2V5LGkuYnV0dG9uLGkucmVsYXRlZFRhcmdldF0sdD1vLmNyZWF0ZUV2ZW50KCJNb3VzZUV2ZW50cyIpLHQuaW5pdE1vdXNlRXZlbnQmJih0LmluaXRNb3VzZUV2ZW50LmFwcGx5KHQsaSksdC5fc291cmNlPSJqcyIsbi5kaXNwYXRjaEV2ZW50KHQpKSl9fSxUZT1mdW5jdGlvbigpe3ZhciBlPVEuZmxhc2hMb2FkVGltZW91dDtpZigibnVtYmVyIj09dHlwZW9mIGUmJmU+PTApe3ZhciB0PU1hdGgubWluKDFlMyxlLzEwKSxuPVEuc3dmT2JqZWN0SWQrIl9mYWxsYmFja0NvbnRlbnQiOyQ9aChmdW5jdGlvbigpe3ZhciBlPWwuZ2V0RWxlbWVudEJ5SWQobik7VmUoZSkmJih6ZSgpLEYuZGVhY3RpdmF0ZWQ9bnVsbCxYZS5lbWl0KHt0eXBlOiJlcnJvciIsbmFtZToic3dmLW5vdC1mb3VuZCJ9KSl9LHQpfX0sT2U9ZnVuY3Rpb24oKXt2YXIgZT1sLmNyZWF0ZUVsZW1lbnQoImRpdiIpO3JldHVybiBlLmlkPVEuY29udGFpbmVySWQsZS5jbGFzc05hbWU9US5jb250YWluZXJDbGFzcyxlLnN0eWxlLnBvc2l0aW9uPSJhYnNvbHV0ZSIsZS5zdHlsZS5sZWZ0PSIwcHgiLGUuc3R5bGUudG9wPSItOTk5OXB4IixlLnN0eWxlLndpZHRoPSIxcHgiLGUuc3R5bGUuaGVpZ2h0PSIxcHgiLGUuc3R5bGUuekluZGV4PSIiK0dlKFEuekluZGV4KSxlfSxNZT1mdW5jdGlvbihlKXtmb3IodmFyIHQ9ZSYmZS5wYXJlbnROb2RlO3QmJiJPQkpFQ1QiPT09dC5ub2RlTmFtZSYmdC5wYXJlbnROb2RlOyl0PXQucGFyZW50Tm9kZTtyZXR1cm4gdHx8bnVsbH0sa2U9ZnVuY3Rpb24oKXt2YXIgZSx0PUYuYnJpZGdlLG49TWUodCk7aWYoIXQpe3ZhciBvPUxlKGEubG9jYXRpb24uaG9zdCxRKSxyPSJuZXZlciI9PT1vPyJub25lIjoiYWxsIixpPVBlKE0oe2pzVmVyc2lvbjpYZS52ZXJzaW9ufSxRKSkscz1RLnN3ZlBhdGgrQWUoUS5zd2ZQYXRoLFEpO249T2UoKTt2YXIgdT1sLmNyZWF0ZUVsZW1lbnQoImRpdiIpO24uYXBwZW5kQ2hpbGQodSksbC5ib2R5LmFwcGVuZENoaWxkKG4pO3ZhciBjPWwuY3JlYXRlRWxlbWVudCgiZGl2IiksZD0iYWN0aXZleCI9PT1GLnBsdWdpblR5cGU7Yy5pbm5lckhUTUw9JzxvYmplY3QgaWQ9IicrUS5zd2ZPYmplY3RJZCsnIiBuYW1lPSInK1Euc3dmT2JqZWN0SWQrJyIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgJysoZD8nY2xhc3NpZD0iY2xzaWQ6ZDI3Y2RiNmUtYWU2ZC0xMWNmLTk2YjgtNDQ0NTUzNTQwMDAwIic6J3R5cGU9ImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIiBkYXRhPSInK3MrJyInKSsiPiIrKGQ/JzxwYXJhbSBuYW1lPSJtb3ZpZSIgdmFsdWU9IicrcysnIi8+JzoiIikrJzxwYXJhbSBuYW1lPSJhbGxvd1NjcmlwdEFjY2VzcyIgdmFsdWU9IicrbysnIi8+PHBhcmFtIG5hbWU9ImFsbG93TmV0d29ya2luZyIgdmFsdWU9IicrcisnIi8+PHBhcmFtIG5hbWU9Im1lbnUiIHZhbHVlPSJmYWxzZSIvPjxwYXJhbSBuYW1lPSJ3bW9kZSIgdmFsdWU9InRyYW5zcGFyZW50Ii8+PHBhcmFtIG5hbWU9ImZsYXNodmFycyIgdmFsdWU9IicraSsnIi8+PGRpdiBpZD0iJytRLnN3Zk9iamVjdElkKydfZmFsbGJhY2tDb250ZW50Ij4mbmJzcDs8L2Rpdj48L29iamVjdD4nLHQ9Yy5maXJzdENoaWxkLGM9bnVsbCxUKHQpLlplcm9DbGlwYm9hcmQ9WGUsbi5yZXBsYWNlQ2hpbGQodCx1KSxUZSgpfXJldHVybiB0fHwodD1sW1Euc3dmT2JqZWN0SWRdLHQmJihlPXQubGVuZ3RoKSYmKHQ9dFtlLTFdKSwhdCYmbiYmKHQ9bi5maXJzdENoaWxkKSksRi5icmlkZ2U9dHx8bnVsbCx0fSxIZT1mdW5jdGlvbigpe3ZhciBlPUYuYnJpZGdlO2lmKGUpe3ZhciB0PU1lKGUpO3QmJigiYWN0aXZleCI9PT1GLnBsdWdpblR5cGUmJiJyZWFkeVN0YXRlImluIGU/KGUuc3R5bGUuZGlzcGxheT0ibm9uZSIsZnVuY3Rpb24gbigpe2lmKDQ9PT1lLnJlYWR5U3RhdGUpe2Zvcih2YXIgbyBpbiBlKSJmdW5jdGlvbiI9PXR5cGVvZiBlW29dJiYoZVtvXT1udWxsKTtlLnBhcmVudE5vZGUmJmUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlKSx0LnBhcmVudE5vZGUmJnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KX1lbHNlIGMobiwxMCl9KCkpOihlLnBhcmVudE5vZGUmJmUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChlKSx0LnBhcmVudE5vZGUmJnQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0KSkpLHplKCksRi5yZWFkeT1udWxsLEYuYnJpZGdlPW51bGwsRi5kZWFjdGl2YXRlZD1udWxsLHI9b319LERlPWZ1bmN0aW9uKGUpe3ZhciB0PXt9LG49e307aWYoIm9iamVjdCI9PXR5cGVvZiBlJiZlKXtmb3IodmFyIG8gaW4gZSlpZihvJiZTLmNhbGwoZSxvKSYmInN0cmluZyI9PXR5cGVvZiBlW29dJiZlW29dKXN3aXRjaChvLnRvTG93ZXJDYXNlKCkpe2Nhc2UidGV4dC9wbGFpbiI6Y2FzZSJ0ZXh0IjpjYXNlImFpcjp0ZXh0IjpjYXNlImZsYXNoOnRleHQiOnQudGV4dD1lW29dLG4udGV4dD1vO2JyZWFrO2Nhc2UidGV4dC9odG1sIjpjYXNlImh0bWwiOmNhc2UiYWlyOmh0bWwiOmNhc2UiZmxhc2g6aHRtbCI6dC5odG1sPWVbb10sbi5odG1sPW87YnJlYWs7Y2FzZSJhcHBsaWNhdGlvbi9ydGYiOmNhc2UidGV4dC9ydGYiOmNhc2UicnRmIjpjYXNlInJpY2h0ZXh0IjpjYXNlImFpcjpydGYiOmNhc2UiZmxhc2g6cnRmIjp0LnJ0Zj1lW29dLG4ucnRmPW99cmV0dXJue2RhdGE6dCxmb3JtYXRNYXA6bn19fSx4ZT1mdW5jdGlvbihlLHQpe2lmKCJvYmplY3QiIT10eXBlb2YgZXx8IWV8fCJvYmplY3QiIT10eXBlb2YgdHx8IXQpcmV0dXJuIGU7dmFyIG49e307Zm9yKHZhciBvIGluIGUpaWYoUy5jYWxsKGUsbykpaWYoImVycm9ycyI9PT1vKXtuW29dPWVbb10/ZVtvXS5zbGljZSgpOltdO2Zvcih2YXIgcj0wLGk9bltvXS5sZW5ndGg7aT5yO3IrKyluW29dW3JdLmZvcm1hdD10W25bb11bcl0uZm9ybWF0XX1lbHNlIGlmKCJzdWNjZXNzIiE9PW8mJiJkYXRhIiE9PW8pbltvXT1lW29dO2Vsc2V7bltvXT17fTt2YXIgcz1lW29dO2Zvcih2YXIgYSBpbiBzKWEmJlMuY2FsbChzLGEpJiZTLmNhbGwodCxhKSYmKG5bb11bdFthXV09c1thXSl9cmV0dXJuIG59LEFlPWZ1bmN0aW9uKGUsdCl7dmFyIG49bnVsbD09dHx8dCYmdC5jYWNoZUJ1c3Q9PT0hMDtyZXR1cm4gbj8oLTE9PT1lLmluZGV4T2YoIj8iKT8iPyI6IiYiKSsibm9DYWNoZT0iK0MoKToiIn0sUGU9ZnVuY3Rpb24oZSl7dmFyIHQsbixvLHIsaT0iIixzPVtdO2lmKGUudHJ1c3RlZERvbWFpbnMmJigic3RyaW5nIj09dHlwZW9mIGUudHJ1c3RlZERvbWFpbnM/cj1bZS50cnVzdGVkRG9tYWluc106Im9iamVjdCI9PXR5cGVvZiBlLnRydXN0ZWREb21haW5zJiYibGVuZ3RoImluIGUudHJ1c3RlZERvbWFpbnMmJihyPWUudHJ1c3RlZERvbWFpbnMpKSxyJiZyLmxlbmd0aClmb3IodD0wLG49ci5sZW5ndGg7bj50O3QrKylpZihTLmNhbGwocix0KSYmclt0XSYmInN0cmluZyI9PXR5cGVvZiByW3RdKXtpZihvPU5lKHJbdF0pLCFvKWNvbnRpbnVlO2lmKCIqIj09PW8pe3MubGVuZ3RoPTAscy5wdXNoKG8pO2JyZWFrfXMucHVzaC5hcHBseShzLFtvLCIvLyIrbyxhLmxvY2F0aW9uLnByb3RvY29sKyIvLyIrb10pfXJldHVybiBzLmxlbmd0aCYmKGkrPSJ0cnVzdGVkT3JpZ2lucz0iK2cocy5qb2luKCIsIikpKSxlLmZvcmNlRW5oYW5jZWRDbGlwYm9hcmQ9PT0hMCYmKGkrPShpPyImIjoiIikrImZvcmNlRW5oYW5jZWRDbGlwYm9hcmQ9dHJ1ZSIpLCJzdHJpbmciPT10eXBlb2YgZS5zd2ZPYmplY3RJZCYmZS5zd2ZPYmplY3RJZCYmKGkrPShpPyImIjoiIikrInN3Zk9iamVjdElkPSIrZyhlLnN3Zk9iamVjdElkKSksInN0cmluZyI9PXR5cGVvZiBlLmpzVmVyc2lvbiYmZS5qc1ZlcnNpb24mJihpKz0oaT8iJiI6IiIpKyJqc1ZlcnNpb249IitnKGUuanNWZXJzaW9uKSksaX0sTmU9ZnVuY3Rpb24oZSl7aWYobnVsbD09ZXx8IiI9PT1lKXJldHVybiBudWxsO2lmKGU9ZS5yZXBsYWNlKC9eXHMrfFxzKyQvZywiIiksIiI9PT1lKXJldHVybiBudWxsO3ZhciB0PWUuaW5kZXhPZigiLy8iKTtlPS0xPT09dD9lOmUuc2xpY2UodCsyKTt2YXIgbj1lLmluZGV4T2YoIi8iKTtyZXR1cm4gZT0tMT09PW4/ZTotMT09PXR8fDA9PT1uP251bGw6ZS5zbGljZSgwLG4pLGUmJiIuc3dmIj09PWUuc2xpY2UoLTQpLnRvTG93ZXJDYXNlKCk/bnVsbDplfHxudWxsfSxMZT1mdW5jdGlvbigpe3ZhciBlPWZ1bmN0aW9uKGUpe3ZhciB0LG4sbyxyPVtdO2lmKCJzdHJpbmciPT10eXBlb2YgZSYmKGU9W2VdKSwib2JqZWN0IiE9dHlwZW9mIGV8fCFlfHwibnVtYmVyIiE9dHlwZW9mIGUubGVuZ3RoKXJldHVybiByO2Zvcih0PTAsbj1lLmxlbmd0aDtuPnQ7dCsrKWlmKFMuY2FsbChlLHQpJiYobz1OZShlW3RdKSkpe2lmKCIqIj09PW8pe3IubGVuZ3RoPTAsci5wdXNoKCIqIik7YnJlYWt9LTE9PT1yLmluZGV4T2YobykmJnIucHVzaChvKX1yZXR1cm4gcn07cmV0dXJuIGZ1bmN0aW9uKHQsbil7dmFyIG89TmUobi5zd2ZQYXRoKTtudWxsPT09byYmKG89dCk7dmFyIHI9ZShuLnRydXN0ZWREb21haW5zKSxpPXIubGVuZ3RoO2lmKGk+MCl7aWYoMT09PWkmJiIqIj09PXJbMF0pcmV0dXJuImFsd2F5cyI7aWYoLTEhPT1yLmluZGV4T2YodCkpcmV0dXJuIDE9PT1pJiZ0PT09bz8ic2FtZURvbWFpbiI6ImFsd2F5cyJ9cmV0dXJuIm5ldmVyIn19KCksV2U9ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIGwuYWN0aXZlRWxlbWVudH1jYXRjaChlKXtyZXR1cm4gbnVsbH19LEllPWZ1bmN0aW9uKGUsdCl7dmFyIG4sbyxyLGk9W107aWYoInN0cmluZyI9PXR5cGVvZiB0JiZ0JiYoaT10LnNwbGl0KC9ccysvKSksZSYmMT09PWUubm9kZVR5cGUmJmkubGVuZ3RoPjApaWYoZS5jbGFzc0xpc3QpZm9yKG49MCxvPWkubGVuZ3RoO28+bjtuKyspZS5jbGFzc0xpc3QuYWRkKGlbbl0pO2Vsc2UgaWYoZS5oYXNPd25Qcm9wZXJ0eSgiY2xhc3NOYW1lIikpe2ZvcihyPSIgIitlLmNsYXNzTmFtZSsiICIsbj0wLG89aS5sZW5ndGg7bz5uO24rKyktMT09PXIuaW5kZXhPZigiICIraVtuXSsiICIpJiYocis9aVtuXSsiICIpO2UuY2xhc3NOYW1lPXIucmVwbGFjZSgvXlxzK3xccyskL2csIiIpfXJldHVybiBlfSxqZT1mdW5jdGlvbihlLHQpe3ZhciBuLG8scixpPVtdO2lmKCJzdHJpbmciPT10eXBlb2YgdCYmdCYmKGk9dC5zcGxpdCgvXHMrLykpLGUmJjE9PT1lLm5vZGVUeXBlJiZpLmxlbmd0aD4wKWlmKGUuY2xhc3NMaXN0JiZlLmNsYXNzTGlzdC5sZW5ndGg+MClmb3Iobj0wLG89aS5sZW5ndGg7bz5uO24rKyllLmNsYXNzTGlzdC5yZW1vdmUoaVtuXSk7ZWxzZSBpZihlLmNsYXNzTmFtZSl7Zm9yKHI9KCIgIitlLmNsYXNzTmFtZSsiICIpLnJlcGxhY2UoL1tcclxuXHRdL2csIiAiKSxuPTAsbz1pLmxlbmd0aDtvPm47bisrKXI9ci5yZXBsYWNlKCIgIitpW25dKyIgIiwiICIpO2UuY2xhc3NOYW1lPXIucmVwbGFjZSgvXlxzK3xccyskL2csIiIpfXJldHVybiBlfSxCZT1mdW5jdGlvbihlLHQpe3ZhciBuPXAoZSxudWxsKS5nZXRQcm9wZXJ0eVZhbHVlKHQpO3JldHVybiJjdXJzb3IiIT09dHx8biYmImF1dG8iIT09bnx8IkEiIT09ZS5ub2RlTmFtZT9uOiJwb2ludGVyIn0sRmU9ZnVuY3Rpb24oZSl7dmFyIHQ9e2xlZnQ6MCx0b3A6MCx3aWR0aDowLGhlaWdodDowfTtpZihlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCl7dmFyIG49ZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxvPWEucGFnZVhPZmZzZXQscj1hLnBhZ2VZT2Zmc2V0LGk9bC5kb2N1bWVudEVsZW1lbnQuY2xpZW50TGVmdHx8MCxzPWwuZG9jdW1lbnRFbGVtZW50LmNsaWVudFRvcHx8MCx1PTAsYz0wO2lmKCJyZWxhdGl2ZSI9PT1CZShsLmJvZHksInBvc2l0aW9uIikpe3ZhciBkPWwuYm9keS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxoPWwuZG9jdW1lbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO3U9ZC5sZWZ0LWgubGVmdHx8MCxjPWQudG9wLWgudG9wfHwwfXQubGVmdD1uLmxlZnQrby1pLXUsdC50b3A9bi50b3Arci1zLWMsdC53aWR0aD0id2lkdGgiaW4gbj9uLndpZHRoOm4ucmlnaHQtbi5sZWZ0LHQuaGVpZ2h0PSJoZWlnaHQiaW4gbj9uLmhlaWdodDpuLmJvdHRvbS1uLnRvcH1yZXR1cm4gdH0sVmU9ZnVuY3Rpb24oZSl7aWYoIWUpcmV0dXJuITE7dmFyIHQ9cChlLG51bGwpLG49eSh0LmhlaWdodCk+MCxvPXkodC53aWR0aCk+MCxyPXkodC50b3ApPj0wLGk9eSh0LmxlZnQpPj0wLHM9biYmbyYmciYmaSxhPXM/bnVsbDpGZShlKSxsPSJub25lIiE9PXQuZGlzcGxheSYmImNvbGxhcHNlIiE9PXQudmlzaWJpbGl0eSYmKHN8fCEhYSYmKG58fGEuaGVpZ2h0PjApJiYob3x8YS53aWR0aD4wKSYmKHJ8fGEudG9wPj0wKSYmKGl8fGEubGVmdD49MCkpO3JldHVybiBsfSx6ZT1mdW5jdGlvbigpe2QoRyksRz0wLGYoJCksJD0wfSxZZT1mdW5jdGlvbigpe3ZhciBlO2lmKGkmJihlPU1lKEYuYnJpZGdlKSkpe3ZhciB0PUZlKGkpO00oZS5zdHlsZSx7d2lkdGg6dC53aWR0aCsicHgiLGhlaWdodDp0LmhlaWdodCsicHgiLHRvcDp0LnRvcCsicHgiLGxlZnQ6dC5sZWZ0KyJweCIsekluZGV4OiIiK0dlKFEuekluZGV4KX0pfX0sVWU9ZnVuY3Rpb24oZSl7Ri5yZWFkeT09PSEwJiYoRi5icmlkZ2UmJiJmdW5jdGlvbiI9PXR5cGVvZiBGLmJyaWRnZS5zZXRIYW5kQ3Vyc29yP0YuYnJpZGdlLnNldEhhbmRDdXJzb3IoZSk6Ri5yZWFkeT0hMSl9LEdlPWZ1bmN0aW9uKGUpe2lmKC9eKD86YXV0b3xpbmhlcml0KSQvLnRlc3QoZSkpcmV0dXJuIGU7dmFyIHQ7cmV0dXJuIm51bWJlciIhPXR5cGVvZiBlfHxiKGUpPyJzdHJpbmciPT10eXBlb2YgZSYmKHQ9R2UodyhlLDEwKSkpOnQ9ZSwibnVtYmVyIj09dHlwZW9mIHQ/dDoiYXV0byJ9LCRlPWZ1bmN0aW9uKGUpe3ZhciBuLG8scixpPUYuc2FuZGJveGVkLHM9bnVsbDtpZihlPWU9PT0hMCxCPT09ITEpcz0hMTtlbHNle3RyeXtvPXQuZnJhbWVFbGVtZW50fHxudWxsfWNhdGNoKGEpe3I9e25hbWU6YS5uYW1lLG1lc3NhZ2U6YS5tZXNzYWdlfX1pZihvJiYxPT09by5ub2RlVHlwZSYmIklGUkFNRSI9PT1vLm5vZGVOYW1lKXRyeXtzPW8uaGFzQXR0cmlidXRlKCJzYW5kYm94Iil9Y2F0Y2goYSl7cz1udWxsfWVsc2V7dHJ5e249ZG9jdW1lbnQuZG9tYWlufHxudWxsfWNhdGNoKGEpe249bnVsbH0obnVsbD09PW58fHImJiJTZWN1cml0eUVycm9yIj09PXIubmFtZSYmLyhefFtcc1woXFtAXSlzYW5kYm94KGVzfGVkfGluZ3xbXHNcLiwhXClcXUBdfCQpLy50ZXN0KHIubWVzc2FnZS50b0xvd2VyQ2FzZSgpKSkmJihzPSEwKX19cmV0dXJuIEYuc2FuZGJveGVkPXMsaT09PXN8fGV8fEtlKG0pLHN9LEtlPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSl7dmFyIHQ9ZS5tYXRjaCgvW1xkXSsvZyk7cmV0dXJuIHQubGVuZ3RoPTMsdC5qb2luKCIuIil9ZnVuY3Rpb24gbihlKXtyZXR1cm4hIWUmJihlPWUudG9Mb3dlckNhc2UoKSkmJigvXihwZXBmbGFzaHBsYXllclwuZGxsfGxpYnBlcGZsYXNocGxheWVyXC5zb3xwZXBwZXJmbGFzaHBsYXllclwucGx1Z2luKSQvLnRlc3QoZSl8fCJjaHJvbWUucGx1Z2luIj09PWUuc2xpY2UoLTEzKSl9ZnVuY3Rpb24gbyhlKXtlJiYoYT0hMCxlLnZlcnNpb24mJihkPXQoZS52ZXJzaW9uKSksIWQmJmUuZGVzY3JpcHRpb24mJihkPXQoZS5kZXNjcmlwdGlvbikpLGUuZmlsZW5hbWUmJihjPW4oZS5maWxlbmFtZSkpKX12YXIgcixpLHMsYT0hMSxsPSExLGM9ITEsZD0iIjtpZih1LnBsdWdpbnMmJnUucGx1Z2lucy5sZW5ndGgpcj11LnBsdWdpbnNbIlNob2Nrd2F2ZSBGbGFzaCJdLG8ociksdS5wbHVnaW5zWyJTaG9ja3dhdmUgRmxhc2ggMi4wIl0mJihhPSEwLGQ9IjIuMC4wLjExIik7ZWxzZSBpZih1Lm1pbWVUeXBlcyYmdS5taW1lVHlwZXMubGVuZ3RoKXM9dS5taW1lVHlwZXNbImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoIl0scj1zJiZzLmVuYWJsZWRQbHVnaW4sbyhyKTtlbHNlIGlmKCJ1bmRlZmluZWQiIT10eXBlb2YgZSl7bD0hMDt0cnl7aT1uZXcgZSgiU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2guNyIpLGE9ITAsZD10KGkuR2V0VmFyaWFibGUoIiR2ZXJzaW9uIikpfWNhdGNoKGgpe3RyeXtpPW5ldyBlKCJTaG9ja3dhdmVGbGFzaC5TaG9ja3dhdmVGbGFzaC42IiksYT0hMCxkPSI2LjAuMjEifWNhdGNoKGYpe3RyeXtpPW5ldyBlKCJTaG9ja3dhdmVGbGFzaC5TaG9ja3dhdmVGbGFzaCIpLGE9ITAsZD10KGkuR2V0VmFyaWFibGUoIiR2ZXJzaW9uIikpfWNhdGNoKHApe2w9ITF9fX19Ri5kaXNhYmxlZD1hIT09ITAsRi5vdXRkYXRlZD1kJiZ5KGQpPHkoViksRi52ZXJzaW9uPWR8fCIwLjAuMCIsRi5wbHVnaW5UeXBlPWM/InBlcHBlciI6bD8iYWN0aXZleCI6YT8ibmV0c2NhcGUiOiJ1bmtub3duIn07S2UobSksJGUoITApO3ZhciBYZT1mdW5jdGlvbigpe3JldHVybiB0aGlzIGluc3RhbmNlb2YgWGU/dm9pZCgiZnVuY3Rpb24iPT10eXBlb2YgWGUuX2NyZWF0ZUNsaWVudCYmWGUuX2NyZWF0ZUNsaWVudC5hcHBseSh0aGlzLE8oYXJndW1lbnRzKSkpOm5ldyBYZX07XyhYZSwidmVyc2lvbiIse3ZhbHVlOiIyLjIuMCIsd3JpdGFibGU6ITEsY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITB9KSxYZS5jb25maWc9ZnVuY3Rpb24oKXtyZXR1cm4gZWUuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5zdGF0ZT1mdW5jdGlvbigpe3JldHVybiB0ZS5hcHBseSh0aGlzLE8oYXJndW1lbnRzKSl9LFhlLmlzRmxhc2hVbnVzYWJsZT1mdW5jdGlvbigpe3JldHVybiBuZS5hcHBseSh0aGlzLE8oYXJndW1lbnRzKSl9LFhlLm9uPWZ1bmN0aW9uKCl7cmV0dXJuIG9lLmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUub2ZmPWZ1bmN0aW9uKCl7cmV0dXJuIHJlLmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUuaGFuZGxlcnM9ZnVuY3Rpb24oKXtyZXR1cm4gaWUuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5lbWl0PWZ1bmN0aW9uKCl7cmV0dXJuIHNlLmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUuY3JlYXRlPWZ1bmN0aW9uKCl7cmV0dXJuIGFlLmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUuZGVzdHJveT1mdW5jdGlvbigpe3JldHVybiBsZS5hcHBseSh0aGlzLE8oYXJndW1lbnRzKSl9LFhlLnNldERhdGE9ZnVuY3Rpb24oKXtyZXR1cm4gdWUuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5jbGVhckRhdGE9ZnVuY3Rpb24oKXtyZXR1cm4gY2UuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5nZXREYXRhPWZ1bmN0aW9uKCl7cmV0dXJuIGRlLmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUuZm9jdXM9WGUuYWN0aXZhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gaGUuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5ibHVyPVhlLmRlYWN0aXZhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gZmUuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5hY3RpdmVFbGVtZW50PWZ1bmN0aW9uKCl7cmV0dXJuIHBlLmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX07dmFyIHFlPTAsWmU9e30sSmU9MCxRZT17fSxldD17fTtNKFEse2F1dG9BY3RpdmF0ZTohMH0pO3ZhciB0dD1mdW5jdGlvbihlKXt2YXIgdD10aGlzO3QuaWQ9IiIrcWUrKyxaZVt0LmlkXT17aW5zdGFuY2U6dCxlbGVtZW50czpbXSxoYW5kbGVyczp7fX0sZSYmdC5jbGlwKGUpLFhlLm9uKCIqIixmdW5jdGlvbihlKXtyZXR1cm4gdC5lbWl0KGUpfSksWGUub24oImRlc3Ryb3kiLGZ1bmN0aW9uKCl7dC5kZXN0cm95KCl9KSxYZS5jcmVhdGUoKX0sbnQ9ZnVuY3Rpb24oZSx0KXt2YXIgbixpLHMsYT17fSxsPVplW3RoaXMuaWRdLHU9bCYmbC5oYW5kbGVycztpZighbCl0aHJvdyBuZXcgRXJyb3IoIkF0dGVtcHRlZCB0byBhZGQgbmV3IGxpc3RlbmVyKHMpIHRvIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlIik7aWYoInN0cmluZyI9PXR5cGVvZiBlJiZlKXM9ZS50b0xvd2VyQ2FzZSgpLnNwbGl0KC9ccysvKTtlbHNlIGlmKCJvYmplY3QiPT10eXBlb2YgZSYmZSYmInVuZGVmaW5lZCI9PXR5cGVvZiB0KWZvcihuIGluIGUpUy5jYWxsKGUsbikmJiJzdHJpbmciPT10eXBlb2YgbiYmbiYmImZ1bmN0aW9uIj09dHlwZW9mIGVbbl0mJnRoaXMub24obixlW25dKTtpZihzJiZzLmxlbmd0aCl7Zm9yKG49MCxpPXMubGVuZ3RoO2k+bjtuKyspZT1zW25dLnJlcGxhY2UoL15vbi8sIiIpLGFbZV09ITAsdVtlXXx8KHVbZV09W10pLHVbZV0ucHVzaCh0KTtpZihhLnJlYWR5JiZGLnJlYWR5JiZ0aGlzLmVtaXQoe3R5cGU6InJlYWR5IixjbGllbnQ6dGhpc30pLGEuZXJyb3Ipe2ZvcihuPTAsaT1xLmxlbmd0aDtpPm47bisrKWlmKEZbcVtuXS5yZXBsYWNlKC9eZmxhc2gtLywiIildKXt0aGlzLmVtaXQoe3R5cGU6ImVycm9yIixuYW1lOnFbbl0sY2xpZW50OnRoaXN9KTticmVha31yIT09byYmWGUudmVyc2lvbiE9PXImJnRoaXMuZW1pdCh7dHlwZToiZXJyb3IiLG5hbWU6InZlcnNpb24tbWlzbWF0Y2giLGpzVmVyc2lvbjpYZS52ZXJzaW9uLHN3ZlZlcnNpb246cn0pfX1yZXR1cm4gdGhpc30sb3Q9ZnVuY3Rpb24oZSx0KXt2YXIgbixvLHIsaSxzLGE9WmVbdGhpcy5pZF0sbD1hJiZhLmhhbmRsZXJzO2lmKCFsKXJldHVybiB0aGlzO2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKWk9UihsKTtlbHNlIGlmKCJzdHJpbmciPT10eXBlb2YgZSYmZSlpPWUuc3BsaXQoL1xzKy8pO2Vsc2UgaWYoIm9iamVjdCI9PXR5cGVvZiBlJiZlJiYidW5kZWZpbmVkIj09dHlwZW9mIHQpZm9yKG4gaW4gZSlTLmNhbGwoZSxuKSYmInN0cmluZyI9PXR5cGVvZiBuJiZuJiYiZnVuY3Rpb24iPT10eXBlb2YgZVtuXSYmdGhpcy5vZmYobixlW25dKTtpZihpJiZpLmxlbmd0aClmb3Iobj0wLG89aS5sZW5ndGg7bz5uO24rKylpZihlPWlbbl0udG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9eb24vLCIiKSxzPWxbZV0scyYmcy5sZW5ndGgpaWYodClmb3Iocj1zLmluZGV4T2YodCk7LTEhPT1yOylzLnNwbGljZShyLDEpLHI9cy5pbmRleE9mKHQscik7ZWxzZSBzLmxlbmd0aD0wO3JldHVybiB0aGlzfSxydD1mdW5jdGlvbihlKXt2YXIgdD1udWxsLG49WmVbdGhpcy5pZF0mJlplW3RoaXMuaWRdLmhhbmRsZXJzO3JldHVybiBuJiYodD0ic3RyaW5nIj09dHlwZW9mIGUmJmU/bltlXT9uW2VdLnNsaWNlKDApOltdOmsobikpLHR9LGl0PWZ1bmN0aW9uKGUpe2lmKGN0LmNhbGwodGhpcyxlKSl7Im9iamVjdCI9PXR5cGVvZiBlJiZlJiYic3RyaW5nIj09dHlwZW9mIGUudHlwZSYmZS50eXBlJiYoZT1NKHt9LGUpKTt2YXIgdD1NKHt9LG1lKGUpLHtjbGllbnQ6dGhpc30pO2R0LmNhbGwodGhpcyx0KX1yZXR1cm4gdGhpc30sc3Q9ZnVuY3Rpb24oZSl7aWYoIVplW3RoaXMuaWRdKXRocm93IG5ldyBFcnJvcigiQXR0ZW1wdGVkIHRvIGNsaXAgZWxlbWVudChzKSB0byBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZSIpO2U9aHQoZSk7Zm9yKHZhciB0PTA7dDxlLmxlbmd0aDt0KyspaWYoUy5jYWxsKGUsdCkmJmVbdF0mJjE9PT1lW3RdLm5vZGVUeXBlKXtlW3RdLnpjQ2xpcHBpbmdJZD8tMT09PVFlW2VbdF0uemNDbGlwcGluZ0lkXS5pbmRleE9mKHRoaXMuaWQpJiZRZVtlW3RdLnpjQ2xpcHBpbmdJZF0ucHVzaCh0aGlzLmlkKTooZVt0XS56Y0NsaXBwaW5nSWQ9InpjQ2xpcHBpbmdJZF8iK0plKyssUWVbZVt0XS56Y0NsaXBwaW5nSWRdPVt0aGlzLmlkXSxRLmF1dG9BY3RpdmF0ZT09PSEwJiZmdChlW3RdKSk7dmFyIG49WmVbdGhpcy5pZF0mJlplW3RoaXMuaWRdLmVsZW1lbnRzOy0xPT09bi5pbmRleE9mKGVbdF0pJiZuLnB1c2goZVt0XSl9cmV0dXJuIHRoaXN9LGF0PWZ1bmN0aW9uKGUpe3ZhciB0PVplW3RoaXMuaWRdO2lmKCF0KXJldHVybiB0aGlzO3ZhciBuLG89dC5lbGVtZW50cztlPSJ1bmRlZmluZWQiPT10eXBlb2YgZT9vLnNsaWNlKDApOmh0KGUpO2Zvcih2YXIgcj1lLmxlbmd0aDtyLS07KWlmKFMuY2FsbChlLHIpJiZlW3JdJiYxPT09ZVtyXS5ub2RlVHlwZSl7Zm9yKG49MDstMSE9PShuPW8uaW5kZXhPZihlW3JdLG4pKTspby5zcGxpY2UobiwxKTt2YXIgaT1RZVtlW3JdLnpjQ2xpcHBpbmdJZF07aWYoaSl7Zm9yKG49MDstMSE9PShuPWkuaW5kZXhPZih0aGlzLmlkLG4pKTspaS5zcGxpY2UobiwxKTswPT09aS5sZW5ndGgmJihRLmF1dG9BY3RpdmF0ZT09PSEwJiZwdChlW3JdKSxkZWxldGUgZVtyXS56Y0NsaXBwaW5nSWQpfX1yZXR1cm4gdGhpc30sbHQ9ZnVuY3Rpb24oKXt2YXIgZT1aZVt0aGlzLmlkXTtyZXR1cm4gZSYmZS5lbGVtZW50cz9lLmVsZW1lbnRzLnNsaWNlKDApOltdfSx1dD1mdW5jdGlvbigpe1plW3RoaXMuaWRdJiYodGhpcy51bmNsaXAoKSx0aGlzLm9mZigpLGRlbGV0ZSBaZVt0aGlzLmlkXSl9LGN0PWZ1bmN0aW9uKGUpe2lmKCFlfHwhZS50eXBlKXJldHVybiExO2lmKGUuY2xpZW50JiZlLmNsaWVudCE9PXRoaXMpcmV0dXJuITE7dmFyIHQ9WmVbdGhpcy5pZF0sbj10JiZ0LmVsZW1lbnRzLG89ISFuJiZuLmxlbmd0aD4wLHI9IWUudGFyZ2V0fHxvJiYtMSE9PW4uaW5kZXhPZihlLnRhcmdldCksaT1lLnJlbGF0ZWRUYXJnZXQmJm8mJi0xIT09bi5pbmRleE9mKGUucmVsYXRlZFRhcmdldCkscz1lLmNsaWVudCYmZS5jbGllbnQ9PT10aGlzO3JldHVybiB0JiYocnx8aXx8cyk/ITA6ITF9LGR0PWZ1bmN0aW9uKGUpe3ZhciB0PVplW3RoaXMuaWRdO2lmKCJvYmplY3QiPT10eXBlb2YgZSYmZSYmZS50eXBlJiZ0KXt2YXIgbj15ZShlKSxvPXQmJnQuaGFuZGxlcnNbIioiXXx8W10scj10JiZ0LmhhbmRsZXJzW2UudHlwZV18fFtdLGk9by5jb25jYXQocik7aWYoaSYmaS5sZW5ndGgpe3ZhciBzLGwsdSxjLGQsaD10aGlzO2ZvcihzPTAsbD1pLmxlbmd0aDtsPnM7cysrKXU9aVtzXSxjPWgsInN0cmluZyI9PXR5cGVvZiB1JiYiZnVuY3Rpb24iPT10eXBlb2YgYVt1XSYmKHU9YVt1XSksIm9iamVjdCI9PXR5cGVvZiB1JiZ1JiYiZnVuY3Rpb24iPT10eXBlb2YgdS5oYW5kbGVFdmVudCYmKGM9dSx1PXUuaGFuZGxlRXZlbnQpLCJmdW5jdGlvbiI9PXR5cGVvZiB1JiYoZD1NKHt9LGUpLGJlKHUsYyxbZF0sbikpfX19LGh0PWZ1bmN0aW9uKGUpe3JldHVybiJzdHJpbmciPT10eXBlb2YgZSYmKGU9W10pLCJudW1iZXIiIT10eXBlb2YgZS5sZW5ndGg/W2VdOmV9LGZ0PWZ1bmN0aW9uKGUpe2lmKGUmJjE9PT1lLm5vZGVUeXBlKXt2YXIgdD1mdW5jdGlvbihlKXsoZXx8KGU9YS5ldmVudCkpJiYoImpzIiE9PWUuX3NvdXJjZSYmKGUuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksZS5wcmV2ZW50RGVmYXVsdCgpKSxkZWxldGUgZS5fc291cmNlKX0sbj1mdW5jdGlvbihuKXsobnx8KG49YS5ldmVudCkpJiYodChuKSxYZS5mb2N1cyhlKSl9O2UuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VvdmVyIixuLCExKSxlLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlb3V0Iix0LCExKSxlLmFkZEV2ZW50TGlzdGVuZXIoIm1vdXNlZW50ZXIiLHQsITEpLGUuYWRkRXZlbnRMaXN0ZW5lcigibW91c2VsZWF2ZSIsdCwhMSksZS5hZGRFdmVudExpc3RlbmVyKCJtb3VzZW1vdmUiLHQsITEpLGV0W2UuemNDbGlwcGluZ0lkXT17bW91c2VvdmVyOm4sbW91c2VvdXQ6dCxtb3VzZWVudGVyOnQsbW91c2VsZWF2ZTp0LG1vdXNlbW92ZTp0fX19LHB0PWZ1bmN0aW9uKGUpe2lmKGUmJjE9PT1lLm5vZGVUeXBlKXt2YXIgdD1ldFtlLnpjQ2xpcHBpbmdJZF07aWYoIm9iamVjdCI9PXR5cGVvZiB0JiZ0KXtmb3IodmFyIG4sbyxyPVsibW92ZSIsImxlYXZlIiwiZW50ZXIiLCJvdXQiLCJvdmVyIl0saT0wLHM9ci5sZW5ndGg7cz5pO2krKyluPSJtb3VzZSIrcltpXSxvPXRbbl0sImZ1bmN0aW9uIj09dHlwZW9mIG8mJmUucmVtb3ZlRXZlbnRMaXN0ZW5lcihuLG8sITEpO2RlbGV0ZSBldFtlLnpjQ2xpcHBpbmdJZF19fX07WGUuX2NyZWF0ZUNsaWVudD1mdW5jdGlvbigpe3R0LmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUucHJvdG90eXBlLm9uPWZ1bmN0aW9uKCl7cmV0dXJuIG50LmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUucHJvdG90eXBlLm9mZj1mdW5jdGlvbigpe3JldHVybiBvdC5hcHBseSh0aGlzLE8oYXJndW1lbnRzKSl9LFhlLnByb3RvdHlwZS5oYW5kbGVycz1mdW5jdGlvbigpe3JldHVybiBydC5hcHBseSh0aGlzLE8oYXJndW1lbnRzKSl9LFhlLnByb3RvdHlwZS5lbWl0PWZ1bmN0aW9uKCl7cmV0dXJuIGl0LmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUucHJvdG90eXBlLmNsaXA9ZnVuY3Rpb24oKXtyZXR1cm4gc3QuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5wcm90b3R5cGUudW5jbGlwPWZ1bmN0aW9uKCl7cmV0dXJuIGF0LmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUucHJvdG90eXBlLmVsZW1lbnRzPWZ1bmN0aW9uKCl7cmV0dXJuIGx0LmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKX0sWGUucHJvdG90eXBlLmRlc3Ryb3k9ZnVuY3Rpb24oKXtyZXR1cm4gdXQuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSxYZS5wcm90b3R5cGUuc2V0VGV4dD1mdW5jdGlvbihlKXtpZighWmVbdGhpcy5pZF0pdGhyb3cgbmV3IEVycm9yKCJBdHRlbXB0ZWQgdG8gc2V0IHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZSIpO3JldHVybiBYZS5zZXREYXRhKCJ0ZXh0L3BsYWluIixlKSx0aGlzfSxYZS5wcm90b3R5cGUuc2V0SHRtbD1mdW5jdGlvbihlKXtpZighWmVbdGhpcy5pZF0pdGhyb3cgbmV3IEVycm9yKCJBdHRlbXB0ZWQgdG8gc2V0IHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZSIpO3JldHVybiBYZS5zZXREYXRhKCJ0ZXh0L2h0bWwiLGUpLHRoaXN9LFhlLnByb3RvdHlwZS5zZXRSaWNoVGV4dD1mdW5jdGlvbihlKXtpZighWmVbdGhpcy5pZF0pdGhyb3cgbmV3IEVycm9yKCJBdHRlbXB0ZWQgdG8gc2V0IHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZSIpO3JldHVybiBYZS5zZXREYXRhKCJhcHBsaWNhdGlvbi9ydGYiLGUpLHRoaXN9LFhlLnByb3RvdHlwZS5zZXREYXRhPWZ1bmN0aW9uKCl7aWYoIVplW3RoaXMuaWRdKXRocm93IG5ldyBFcnJvcigiQXR0ZW1wdGVkIHRvIHNldCBwZW5kaW5nIGNsaXBib2FyZCBkYXRhIGZyb20gYSBkZXN0cm95ZWQgWmVyb0NsaXBib2FyZCBjbGllbnQgaW5zdGFuY2UiKTtyZXR1cm4gWGUuc2V0RGF0YS5hcHBseSh0aGlzLE8oYXJndW1lbnRzKSksdGhpc30sWGUucHJvdG90eXBlLmNsZWFyRGF0YT1mdW5jdGlvbigpe2lmKCFaZVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoIkF0dGVtcHRlZCB0byBjbGVhciBwZW5kaW5nIGNsaXBib2FyZCBkYXRhIGZyb20gYSBkZXN0cm95ZWQgWmVyb0NsaXBib2FyZCBjbGllbnQgaW5zdGFuY2UiKTtyZXR1cm4gWGUuY2xlYXJEYXRhLmFwcGx5KHRoaXMsTyhhcmd1bWVudHMpKSx0aGlzfSxYZS5wcm90b3R5cGUuZ2V0RGF0YT1mdW5jdGlvbigpe2lmKCFaZVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoIkF0dGVtcHRlZCB0byBnZXQgcGVuZGluZyBjbGlwYm9hcmQgZGF0YSBmcm9tIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlIik7cmV0dXJuIFhlLmdldERhdGEuYXBwbHkodGhpcyxPKGFyZ3VtZW50cykpfSwiZnVuY3Rpb24iPT10eXBlb2YgZSYmZS5hbWQ/ZShmdW5jdGlvbigpe3JldHVybiBYZX0pOiJvYmplY3QiPT10eXBlb2YgbiYmbiYmIm9iamVjdCI9PXR5cGVvZiBuLmV4cG9ydHMmJm4uZXhwb3J0cz9uLmV4cG9ydHM9WGU6dC5aZXJvQ2xpcGJvYXJkPVhlfShmdW5jdGlvbigpe3JldHVybiB0aGlzfHx3aW5kb3d9KCkpfSx7fV19LHt9LFsyMyw1OSw2MSw2MCw2Miw4Myw2Myw2NCw2NSw2Niw2Nyw2OCw2OSw3MCw3MSw3Miw3Myw3NCw3NSw3Niw3Nyw3OCw3OSw4MCw4MSw4Miw4NCw4NSw4Niw4NywxMDAsMTAxLDEwMiw5MCw5MSw5Miw5Myw5NCw5NSwzMSwzNSwzMiwzMyw0MCwzNCwzNiwzNywzOCwzOV0pKCJ6ZXJvY2xpcGJvYXJkIil9KTs="></script>
<script src="data:application/x-javascript;base64,Ci8qKgogKiBAbGljZW5zZQogKgogKiBjaHJvbWEuanMgLSBKYXZhU2NyaXB0IGxpYnJhcnkgZm9yIGNvbG9yIGNvbnZlcnNpb25zCiAqIAogKiBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxNSwgR3JlZ29yIEFpc2NoCiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAqIAogKiBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICogbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAqIAogKiAxLiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMKICogICAgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAqIAogKiAyLiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAqICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KICogICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiAqIAogKiAzLiBUaGUgbmFtZSBHcmVnb3IgQWlzY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cwogKiAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICogCiAqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogKiBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAqIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRQogKiBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBHUkVHT1IgQUlTQ0ggT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwKICogSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsCiAqIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsCiAqIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkKICogT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcKICogTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLAogKiBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogKgogKi8KCihmdW5jdGlvbigpIHsKICB2YXIgQ29sb3IsIEssIFBJVEhJUkQsIFRXT1BJLCBYLCBZLCBaLCBiZXppZXIsIGJsZW5kLCBibGVuZF9mLCBicmV3ZXIsIGJ1cm4sIGNocm9tYSwgY2xpcF9yZ2IsIGNteWsycmdiLCBjb2xvcnMsIGNvcywgY3NzMnJnYiwgZGFya2VuLCBkb2RnZSwgZWFjaCwgZmxvb3IsIGhleDJyZ2IsIGhzaTJyZ2IsIGhzbDJyZ2IsIGhzdjJyZ2IsIGxhYjJsY2gsIGxhYjJyZ2IsIGxhYl94eXosIGxjaDJsYWIsIGxjaDJyZ2IsIGxpZ2h0ZW4sIGxpbWl0LCBsb2csIGx1bWluYW5jZSwgbHVtaW5hbmNlX3gsIG11bHRpcGx5LCBub3JtYWwsIG51bTJyZ2IsIG92ZXJsYXksIHBvdywgcmdiMmNteWssIHJnYjJoZXgsIHJnYjJoc2ksIHJnYjJoc2wsIHJnYjJoc3YsIHJnYjJsYWIsIHJnYjJsY2gsIHJnYjJudW0sIHJnYjJ0ZW1wLCByZ2IyeHl6LCByZ2JfeHl6LCByb290LCByb3VuZCwgc2NyZWVuLCBzaW4sIHRlbXAycmdiLCB0eXBlLCB1bnBhY2ssIHh5el9sYWIsIHh5el9yZ2IsCiAgICBzbGljZSA9IFtdLnNsaWNlOwoKICBjaHJvbWEgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiAoZnVuY3Rpb24oZnVuYywgYXJncywgY3RvcikgewogICAgICBjdG9yLnByb3RvdHlwZSA9IGZ1bmMucHJvdG90eXBlOwogICAgICB2YXIgY2hpbGQgPSBuZXcgY3RvciwgcmVzdWx0ID0gZnVuYy5hcHBseShjaGlsZCwgYXJncyk7CiAgICAgIHJldHVybiBPYmplY3QocmVzdWx0KSA9PT0gcmVzdWx0ID8gcmVzdWx0IDogY2hpbGQ7CiAgICB9KShDb2xvciwgYXJndW1lbnRzLCBmdW5jdGlvbigpe30pOwogIH07CgogIGlmICgodHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIgJiYgbW9kdWxlICE9PSBudWxsKSAmJiAobW9kdWxlLmV4cG9ydHMgIT0gbnVsbCkpIHsKICAgIG1vZHVsZS5leHBvcnRzID0gY2hyb21hOwogIH0KCiAgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkgewogICAgZGVmaW5lKFtdLCBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIGNocm9tYTsKICAgIH0pOwogIH0gZWxzZSB7CiAgICByb290ID0gdHlwZW9mIGV4cG9ydHMgIT09ICJ1bmRlZmluZWQiICYmIGV4cG9ydHMgIT09IG51bGwgPyBleHBvcnRzIDogdGhpczsKICAgIHJvb3QuY2hyb21hID0gY2hyb21hOwogIH0KCiAgY2hyb21hLmNvbG9yID0gZnVuY3Rpb24oeCwgeSwgeiwgbSkgewogICAgcmV0dXJuIG5ldyBDb2xvcih4LCB5LCB6LCBtKTsKICB9OwoKICBjaHJvbWEuaHNsID0gZnVuY3Rpb24oaCwgcywgbCwgYSkgewogICAgcmV0dXJuIG5ldyBDb2xvcihoLCBzLCBsLCBhLCAnaHNsJyk7CiAgfTsKCiAgY2hyb21hLmhzdiA9IGZ1bmN0aW9uKGgsIHMsIHYsIGEpIHsKICAgIHJldHVybiBuZXcgQ29sb3IoaCwgcywgdiwgYSwgJ2hzdicpOwogIH07CgogIGNocm9tYS5yZ2IgPSBmdW5jdGlvbihyLCBnLCBiLCBhKSB7CiAgICByZXR1cm4gbmV3IENvbG9yKHIsIGcsIGIsIGEsICdyZ2InKTsKICB9OwoKICBjaHJvbWEuaGV4ID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIG5ldyBDb2xvcih4KTsKICB9OwoKICBjaHJvbWEuY3NzID0gZnVuY3Rpb24oeCkgewogICAgcmV0dXJuIG5ldyBDb2xvcih4KTsKICB9OwoKICBjaHJvbWEubGFiID0gZnVuY3Rpb24obCwgYSwgYikgewogICAgcmV0dXJuIG5ldyBDb2xvcihsLCBhLCBiLCAnbGFiJyk7CiAgfTsKCiAgY2hyb21hLmxjaCA9IGZ1bmN0aW9uKGwsIGMsIGgpIHsKICAgIHJldHVybiBuZXcgQ29sb3IobCwgYywgaCwgJ2xjaCcpOwogIH07CgogIGNocm9tYS5oc2kgPSBmdW5jdGlvbihoLCBzLCBpKSB7CiAgICByZXR1cm4gbmV3IENvbG9yKGgsIHMsIGksICdoc2knKTsKICB9OwoKICBjaHJvbWEuZ2wgPSBmdW5jdGlvbihyLCBnLCBiLCBhKSB7CiAgICByZXR1cm4gbmV3IENvbG9yKHIsIGcsIGIsIGEsICdnbCcpOwogIH07CgogIGNocm9tYS5udW0gPSBmdW5jdGlvbihuKSB7CiAgICByZXR1cm4gbmV3IENvbG9yKG4sICdudW0nKTsKICB9OwoKICBjaHJvbWEuY215ayA9IGZ1bmN0aW9uKCkgewogICAgcmV0dXJuIChmdW5jdGlvbihmdW5jLCBhcmdzLCBjdG9yKSB7CiAgICAgIGN0b3IucHJvdG90eXBlID0gZnVuYy5wcm90b3R5cGU7CiAgICAgIHZhciBjaGlsZCA9IG5ldyBjdG9yLCByZXN1bHQgPSBmdW5jLmFwcGx5KGNoaWxkLCBhcmdzKTsKICAgICAgcmV0dXJuIE9iamVjdChyZXN1bHQpID09PSByZXN1bHQgPyByZXN1bHQgOiBjaGlsZDsKICAgIH0pKENvbG9yLCBzbGljZS5jYWxsKGFyZ3VtZW50cykuY29uY2F0KFsnY215ayddKSwgZnVuY3Rpb24oKXt9KTsKICB9OwoKICBjaHJvbWEucmFuZG9tID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgY29kZSwgZGlnaXRzLCBpLCBvOwogICAgZGlnaXRzID0gJzAxMjM0NTY3ODlhYmNkZWYnOwogICAgY29kZSA9ICcjJzsKICAgIGZvciAoaSA9IG8gPSAwOyBvIDwgNjsgaSA9ICsrbykgewogICAgICBjb2RlICs9IGRpZ2l0cy5jaGFyQXQoZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE2KSk7CiAgICB9CiAgICByZXR1cm4gbmV3IENvbG9yKGNvZGUpOwogIH07CgogIGNocm9tYS5pbnRlcnBvbGF0ZSA9IGZ1bmN0aW9uKGEsIGIsIGYsIG0pIHsKICAgIHZhciByZWYsIHJlZjE7CiAgICBpZiAoKGEgPT0gbnVsbCkgfHwgKGIgPT0gbnVsbCkpIHsKICAgICAgcmV0dXJuICcjMDAwJzsKICAgIH0KICAgIGlmICgocmVmID0gdHlwZShhKSkgPT09ICdzdHJpbmcnIHx8IHJlZiA9PT0gJ251bWJlcicpIHsKICAgICAgYSA9IG5ldyBDb2xvcihhKTsKICAgIH0KICAgIGlmICgocmVmMSA9IHR5cGUoYikpID09PSAnc3RyaW5nJyB8fCByZWYxID09PSAnbnVtYmVyJykgewogICAgICBiID0gbmV3IENvbG9yKGIpOwogICAgfQogICAgcmV0dXJuIGEuaW50ZXJwb2xhdGUoZiwgYiwgbSk7CiAgfTsKCiAgY2hyb21hLm1peCA9IGNocm9tYS5pbnRlcnBvbGF0ZTsKCiAgY2hyb21hLmNvbnRyYXN0ID0gZnVuY3Rpb24oYSwgYikgewogICAgdmFyIGwxLCBsMiwgcmVmLCByZWYxOwogICAgaWYgKChyZWYgPSB0eXBlKGEpKSA9PT0gJ3N0cmluZycgfHwgcmVmID09PSAnbnVtYmVyJykgewogICAgICBhID0gbmV3IENvbG9yKGEpOwogICAgfQogICAgaWYgKChyZWYxID0gdHlwZShiKSkgPT09ICdzdHJpbmcnIHx8IHJlZjEgPT09ICdudW1iZXInKSB7CiAgICAgIGIgPSBuZXcgQ29sb3IoYik7CiAgICB9CiAgICBsMSA9IGEubHVtaW5hbmNlKCk7CiAgICBsMiA9IGIubHVtaW5hbmNlKCk7CiAgICBpZiAobDEgPiBsMikgewogICAgICByZXR1cm4gKGwxICsgMC4wNSkgLyAobDIgKyAwLjA1KTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAobDIgKyAwLjA1KSAvIChsMSArIDAuMDUpOwogICAgfQogIH07CgogIGNocm9tYS5sdW1pbmFuY2UgPSBmdW5jdGlvbihjb2xvcikgewogICAgcmV0dXJuIGNocm9tYShjb2xvcikubHVtaW5hbmNlKCk7CiAgfTsKCiAgY2hyb21hLmtlbHZpbiA9IGZ1bmN0aW9uKGspIHsKICAgIHJldHVybiBjaHJvbWEodGVtcDJyZ2IoayksICdyZ2InKTsKICB9OwoKICBjaHJvbWEudmVyc2lvbiA9ICcwLjguMCc7CgogIGNocm9tYS5fQ29sb3IgPSBDb2xvcjsKCgogIC8qKgogICAgICBjaHJvbWEuanMKICAKICAgICAgQ29weXJpZ2h0IChjKSAyMDExLTIwMTMsIEdyZWdvciBBaXNjaAogICAgICBBbGwgcmlnaHRzIHJlc2VydmVkLgogIAogICAgICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICAgICAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAgCiAgICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzCiAgICAgICAgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgCiAgICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogICAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KICAgICAgICBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICAKICAgICAgKiBUaGUgbmFtZSBHcmVnb3IgQWlzY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cwogICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogIAogICAgICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICAgICAgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogICAgICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUKICAgICAgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgR1JFR09SIEFJU0NIIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsCiAgICAgIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLAogICAgICBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLAogICAgICBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZCiAgICAgIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HCiAgICAgIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwKICAgICAgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICAKICAgICAgQHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2drYS9jaHJvbWEuanMKICAgKi8KCiAgQ29sb3IgPSAoZnVuY3Rpb24oKSB7CiAgICBmdW5jdGlvbiBDb2xvcigpIHsKICAgICAgdmFyIGEsIGFyZywgYXJncywgbGVuLCBtLCBtZSwgbWVfcmdiLCBvLCByZWYsIHJlZjEsIHJlZjIsIHJlZjMsIHJlZjQsIHgsIHksIHo7CiAgICAgIG1lID0gdGhpczsKICAgICAgYXJncyA9IFtdOwogICAgICBmb3IgKG8gPSAwLCBsZW4gPSBhcmd1bWVudHMubGVuZ3RoOyBvIDwgbGVuOyBvKyspIHsKICAgICAgICBhcmcgPSBhcmd1bWVudHNbb107CiAgICAgICAgaWYgKGFyZyAhPSBudWxsKSB7CiAgICAgICAgICBhcmdzLnB1c2goYXJnKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGFyZ3MubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmVmID0gWzI1NSwgMCwgMjU1LCAxLCAncmdiJ10sIHggPSByZWZbMF0sIHkgPSByZWZbMV0sIHogPSByZWZbMl0sIGEgPSByZWZbM10sIG0gPSByZWZbNF07CiAgICAgIH0gZWxzZSBpZiAodHlwZShhcmdzWzBdKSA9PT0gImFycmF5IikgewogICAgICAgIGlmIChhcmdzWzBdLmxlbmd0aCA9PT0gMykgewogICAgICAgICAgcmVmMSA9IGFyZ3NbMF0sIHggPSByZWYxWzBdLCB5ID0gcmVmMVsxXSwgeiA9IHJlZjFbMl07CiAgICAgICAgICBhID0gMTsKICAgICAgICB9IGVsc2UgaWYgKGFyZ3NbMF0ubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICByZWYyID0gYXJnc1swXSwgeCA9IHJlZjJbMF0sIHkgPSByZWYyWzFdLCB6ID0gcmVmMlsyXSwgYSA9IHJlZjJbM107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRocm93ICd1bmtub3duIGlucHV0IGFyZ3VtZW50JzsKICAgICAgICB9CiAgICAgICAgbSA9IChyZWYzID0gYXJnc1sxXSkgIT0gbnVsbCA/IHJlZjMgOiAncmdiJzsKICAgICAgfSBlbHNlIGlmICh0eXBlKGFyZ3NbMF0pID09PSAic3RyaW5nIikgewogICAgICAgIHggPSBhcmdzWzBdOwogICAgICAgIG0gPSAnaGV4JzsKICAgICAgfSBlbHNlIGlmICh0eXBlKGFyZ3NbMF0pID09PSAib2JqZWN0IikgewogICAgICAgIHJlZjQgPSBhcmdzWzBdLl9yZ2IsIHggPSByZWY0WzBdLCB5ID0gcmVmNFsxXSwgeiA9IHJlZjRbMl0sIGEgPSByZWY0WzNdOwogICAgICAgIG0gPSAncmdiJzsKICAgICAgfSBlbHNlIGlmIChhcmdzLmxlbmd0aCA8PSAyICYmIHR5cGUoYXJnc1swXSkgPT09ICJudW1iZXIiKSB7CiAgICAgICAgeCA9IGFyZ3NbMF07CiAgICAgICAgbSA9ICdudW0nOwogICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID49IDMpIHsKICAgICAgICB4ID0gYXJnc1swXTsKICAgICAgICB5ID0gYXJnc1sxXTsKICAgICAgICB6ID0gYXJnc1syXTsKICAgICAgfQogICAgICBpZiAoYXJncy5sZW5ndGggPT09IDMpIHsKICAgICAgICBtID0gJ3JnYic7CiAgICAgICAgYSA9IDE7CiAgICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPT09IDQpIHsKICAgICAgICBpZiAodHlwZShhcmdzWzNdKSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgIG0gPSBhcmdzWzNdOwogICAgICAgICAgYSA9IDE7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlKGFyZ3NbM10pID09PSAibnVtYmVyIikgewogICAgICAgICAgbSA9ICdyZ2InOwogICAgICAgICAgYSA9IGFyZ3NbM107CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09PSA1KSB7CiAgICAgICAgYSA9IGFyZ3NbM107CiAgICAgICAgbSA9IGFyZ3NbNF07CiAgICAgIH0KICAgICAgaWYgKG0gIT09ICdjbXlrJykgewogICAgICAgIGlmIChhID09IG51bGwpIHsKICAgICAgICAgIGEgPSAxOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobSA9PT0gJ3JnYicpIHsKICAgICAgICBtZS5fcmdiID0gW3gsIHksIHosIGFdOwogICAgICB9IGVsc2UgaWYgKG0gPT09ICdnbCcpIHsKICAgICAgICBtZS5fcmdiID0gW3ggKiAyNTUsIHkgKiAyNTUsIHogKiAyNTUsIGFdOwogICAgICB9IGVsc2UgaWYgKG0gPT09ICdoc2wnKSB7CiAgICAgICAgbWUuX3JnYiA9IGhzbDJyZ2IoeCwgeSwgeik7CiAgICAgICAgbWUuX3JnYlszXSA9IGE7CiAgICAgIH0gZWxzZSBpZiAobSA9PT0gJ2hzdicpIHsKICAgICAgICBtZS5fcmdiID0gaHN2MnJnYih4LCB5LCB6KTsKICAgICAgICBtZS5fcmdiWzNdID0gYTsKICAgICAgfSBlbHNlIGlmIChtID09PSAnaGV4JykgewogICAgICAgIG1lLl9yZ2IgPSBoZXgycmdiKHgpOwogICAgICB9IGVsc2UgaWYgKG0gPT09ICdsYWInKSB7CiAgICAgICAgbWUuX3JnYiA9IGxhYjJyZ2IoeCwgeSwgeik7CiAgICAgICAgbWUuX3JnYlszXSA9IGE7CiAgICAgIH0gZWxzZSBpZiAobSA9PT0gJ2xjaCcpIHsKICAgICAgICBtZS5fcmdiID0gbGNoMnJnYih4LCB5LCB6KTsKICAgICAgICBtZS5fcmdiWzNdID0gYTsKICAgICAgfSBlbHNlIGlmIChtID09PSAnaHNpJykgewogICAgICAgIG1lLl9yZ2IgPSBoc2kycmdiKHgsIHksIHopOwogICAgICAgIG1lLl9yZ2JbM10gPSBhOwogICAgICB9IGVsc2UgaWYgKG0gPT09ICdudW0nKSB7CiAgICAgICAgbWUuX3JnYiA9IG51bTJyZ2IoeCk7CiAgICAgIH0gZWxzZSBpZiAobSA9PT0gJ2NteWsnKSB7CiAgICAgICAgbWUuX3JnYiA9IGNteWsycmdiKHgsIHksIHosIGEpOwogICAgICB9CiAgICAgIG1lX3JnYiA9IGNsaXBfcmdiKG1lLl9yZ2IpOwogICAgfQoKICAgIENvbG9yLnByb3RvdHlwZS5yZ2IgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JnYi5zbGljZSgwLCAzKTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLnJnYmEgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMuX3JnYjsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmhleCA9IGZ1bmN0aW9uKG1vZGUpIHsKICAgICAgaWYgKG1vZGUgPT0gbnVsbCkgewogICAgICAgIG1vZGUgPSAncmdiJzsKICAgICAgfQogICAgICByZXR1cm4gcmdiMmhleCh0aGlzLl9yZ2IsIG1vZGUpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUudG9TdHJpbmcgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHRoaXMubmFtZSgpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUuaHNsID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZ2IyaHNsKHRoaXMuX3JnYik7CiAgICB9OwoKICAgIENvbG9yLnByb3RvdHlwZS5oc3YgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHJnYjJoc3YodGhpcy5fcmdiKTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmxhYiA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcmdiMmxhYih0aGlzLl9yZ2IpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUubGNoID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiByZ2IybGNoKHRoaXMuX3JnYik7CiAgICB9OwoKICAgIENvbG9yLnByb3RvdHlwZS5oc2kgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHJnYjJoc2kodGhpcy5fcmdiKTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmdsID0gZnVuY3Rpb24oKSB7CiAgICAgIHJldHVybiBbdGhpcy5fcmdiWzBdIC8gMjU1LCB0aGlzLl9yZ2JbMV0gLyAyNTUsIHRoaXMuX3JnYlsyXSAvIDI1NSwgdGhpcy5fcmdiWzNdXTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLm51bSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcmdiMm51bSh0aGlzLl9yZ2IpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUubHVtaW5hbmNlID0gZnVuY3Rpb24obHVtLCBtb2RlKSB7CiAgICAgIHZhciBjdXJfbHVtLCBlcHMsIG1heF9pdGVyLCB0ZXN0OwogICAgICBpZiAobW9kZSA9PSBudWxsKSB7CiAgICAgICAgbW9kZSA9ICdyZ2InOwogICAgICB9CiAgICAgIGlmICghYXJndW1lbnRzLmxlbmd0aCkgewogICAgICAgIHJldHVybiBsdW1pbmFuY2UodGhpcy5fcmdiKTsKICAgICAgfQogICAgICBpZiAobHVtID09PSAwKSB7CiAgICAgICAgdGhpcy5fcmdiID0gWzAsIDAsIDAsIHRoaXMuX3JnYlszXV07CiAgICAgIH0KICAgICAgaWYgKGx1bSA9PT0gMSkgewogICAgICAgIHRoaXMuX3JnYiA9IFsyNTUsIDI1NSwgMjU1LCB0aGlzLl9yZ2JbM11dOwogICAgICB9CiAgICAgIGN1cl9sdW0gPSBsdW1pbmFuY2UodGhpcy5fcmdiKTsKICAgICAgZXBzID0gMWUtNzsKICAgICAgbWF4X2l0ZXIgPSAyMDsKICAgICAgdGVzdCA9IGZ1bmN0aW9uKGwsIGgpIHsKICAgICAgICB2YXIgbG0sIG07CiAgICAgICAgbSA9IGwuaW50ZXJwb2xhdGUoMC41LCBoLCBtb2RlKTsKICAgICAgICBsbSA9IG0ubHVtaW5hbmNlKCk7CiAgICAgICAgaWYgKE1hdGguYWJzKGx1bSAtIGxtKSA8IGVwcyB8fCAhbWF4X2l0ZXItLSkgewogICAgICAgICAgcmV0dXJuIG07CiAgICAgICAgfQogICAgICAgIGlmIChsbSA+IGx1bSkgewogICAgICAgICAgcmV0dXJuIHRlc3QobCwgbSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0ZXN0KG0sIGgpOwogICAgICB9OwogICAgICB0aGlzLl9yZ2IgPSAoY3VyX2x1bSA+IGx1bSA/IHRlc3QobmV3IENvbG9yKCdibGFjaycpLCB0aGlzKSA6IHRlc3QodGhpcywgbmV3IENvbG9yKCd3aGl0ZScpKSkucmdiYSgpOwogICAgICByZXR1cm4gdGhpczsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLm5hbWUgPSBmdW5jdGlvbigpIHsKICAgICAgdmFyIGgsIGs7CiAgICAgIGggPSB0aGlzLmhleCgpOwogICAgICBmb3IgKGsgaW4gY2hyb21hLmNvbG9ycykgewogICAgICAgIGlmIChoID09PSBjaHJvbWEuY29sb3JzW2tdKSB7CiAgICAgICAgICByZXR1cm4gazsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGg7CiAgICB9OwoKICAgIENvbG9yLnByb3RvdHlwZS5hbHBoYSA9IGZ1bmN0aW9uKGFscGhhKSB7CiAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy5fcmdiWzNdID0gYWxwaGE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX3JnYlszXTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmNzcyA9IGZ1bmN0aW9uKG1vZGUpIHsKICAgICAgdmFyIGhzbCwgbWUsIHJnYiwgcm5kOwogICAgICBpZiAobW9kZSA9PSBudWxsKSB7CiAgICAgICAgbW9kZSA9ICdyZ2InOwogICAgICB9CiAgICAgIG1lID0gdGhpczsKICAgICAgcmdiID0gbWUuX3JnYjsKICAgICAgaWYgKG1vZGUubGVuZ3RoID09PSAzICYmIHJnYlszXSA8IDEpIHsKICAgICAgICBtb2RlICs9ICdhJzsKICAgICAgfQogICAgICBpZiAobW9kZSA9PT0gJ3JnYicpIHsKICAgICAgICByZXR1cm4gbW9kZSArICcoJyArIHJnYi5zbGljZSgwLCAzKS5tYXAocm91bmQpLmpvaW4oJywnKSArICcpJzsKICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAncmdiYScpIHsKICAgICAgICByZXR1cm4gbW9kZSArICcoJyArIHJnYi5zbGljZSgwLCAzKS5tYXAocm91bmQpLmpvaW4oJywnKSArICcsJyArIHJnYlszXSArICcpJzsKICAgICAgfSBlbHNlIGlmIChtb2RlID09PSAnaHNsJyB8fCBtb2RlID09PSAnaHNsYScpIHsKICAgICAgICBoc2wgPSBtZS5oc2woKTsKICAgICAgICBybmQgPSBmdW5jdGlvbihhKSB7CiAgICAgICAgICByZXR1cm4gcm91bmQoYSAqIDEwMCkgLyAxMDA7CiAgICAgICAgfTsKICAgICAgICBoc2xbMF0gPSBybmQoaHNsWzBdIHx8IDApOwogICAgICAgIGhzbFsxXSA9IHJuZChoc2xbMV0gKiAxMDApICsgJyUnOwogICAgICAgIGhzbFsyXSA9IHJuZChoc2xbMl0gKiAxMDApICsgJyUnOwogICAgICAgIGlmIChtb2RlLmxlbmd0aCA9PT0gNCkgewogICAgICAgICAgaHNsWzNdID0gcmdiWzNdOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbW9kZSArICcoJyArIGhzbC5qb2luKCcsJykgKyAnKSc7CiAgICAgIH0KICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmludGVycG9sYXRlID0gZnVuY3Rpb24oZiwgY29sLCBtKSB7CgogICAgICAvKgogICAgICBpbnRlcnBvbGF0ZXMgYmV0d2VlbiBjb2xvcnMKICAgICAgZiA9IDAgLS0+IG1lCiAgICAgIGYgPSAxIC0tPiBjb2wKICAgICAgICovCiAgICAgIHZhciBkaCwgaHVlLCBodWUwLCBodWUxLCBsYnYsIGxidjAsIGxidjEsIG1lLCByZXMsIHNhdCwgc2F0MCwgc2F0MSwgeHl6MCwgeHl6MTsKICAgICAgbWUgPSB0aGlzOwogICAgICBpZiAobSA9PSBudWxsKSB7CiAgICAgICAgbSA9ICdyZ2InOwogICAgICB9CiAgICAgIGlmICh0eXBlKGNvbCkgPT09ICJzdHJpbmciKSB7CiAgICAgICAgY29sID0gbmV3IENvbG9yKGNvbCk7CiAgICAgIH0KICAgICAgaWYgKG0gPT09ICdoc2wnIHx8IG0gPT09ICdoc3YnIHx8IG0gPT09ICdsY2gnIHx8IG0gPT09ICdoc2knKSB7CiAgICAgICAgaWYgKG0gPT09ICdoc2wnKSB7CiAgICAgICAgICB4eXowID0gbWUuaHNsKCk7CiAgICAgICAgICB4eXoxID0gY29sLmhzbCgpOwogICAgICAgIH0gZWxzZSBpZiAobSA9PT0gJ2hzdicpIHsKICAgICAgICAgIHh5ejAgPSBtZS5oc3YoKTsKICAgICAgICAgIHh5ejEgPSBjb2wuaHN2KCk7CiAgICAgICAgfSBlbHNlIGlmIChtID09PSAnaHNpJykgewogICAgICAgICAgeHl6MCA9IG1lLmhzaSgpOwogICAgICAgICAgeHl6MSA9IGNvbC5oc2koKTsKICAgICAgICB9IGVsc2UgaWYgKG0gPT09ICdsY2gnKSB7CiAgICAgICAgICB4eXowID0gbWUubGNoKCk7CiAgICAgICAgICB4eXoxID0gY29sLmxjaCgpOwogICAgICAgIH0KICAgICAgICBpZiAobS5zdWJzdHIoMCwgMSkgPT09ICdoJykgewogICAgICAgICAgaHVlMCA9IHh5ejBbMF0sIHNhdDAgPSB4eXowWzFdLCBsYnYwID0geHl6MFsyXTsKICAgICAgICAgIGh1ZTEgPSB4eXoxWzBdLCBzYXQxID0geHl6MVsxXSwgbGJ2MSA9IHh5ejFbMl07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxidjAgPSB4eXowWzBdLCBzYXQwID0geHl6MFsxXSwgaHVlMCA9IHh5ejBbMl07CiAgICAgICAgICBsYnYxID0geHl6MVswXSwgc2F0MSA9IHh5ejFbMV0sIGh1ZTEgPSB4eXoxWzJdOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzTmFOKGh1ZTApICYmICFpc05hTihodWUxKSkgewogICAgICAgICAgaWYgKGh1ZTEgPiBodWUwICYmIGh1ZTEgLSBodWUwID4gMTgwKSB7CiAgICAgICAgICAgIGRoID0gaHVlMSAtIChodWUwICsgMzYwKTsKICAgICAgICAgIH0gZWxzZSBpZiAoaHVlMSA8IGh1ZTAgJiYgaHVlMCAtIGh1ZTEgPiAxODApIHsKICAgICAgICAgICAgZGggPSBodWUxICsgMzYwIC0gaHVlMDsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGRoID0gaHVlMSAtIGh1ZTA7CiAgICAgICAgICB9CiAgICAgICAgICBodWUgPSBodWUwICsgZiAqIGRoOwogICAgICAgIH0gZWxzZSBpZiAoIWlzTmFOKGh1ZTApKSB7CiAgICAgICAgICBodWUgPSBodWUwOwogICAgICAgICAgaWYgKChsYnYxID09PSAxIHx8IGxidjEgPT09IDApICYmIG0gIT09ICdoc3YnKSB7CiAgICAgICAgICAgIHNhdCA9IHNhdDA7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghaXNOYU4oaHVlMSkpIHsKICAgICAgICAgIGh1ZSA9IGh1ZTE7CiAgICAgICAgICBpZiAoKGxidjAgPT09IDEgfHwgbGJ2MCA9PT0gMCkgJiYgbSAhPT0gJ2hzdicpIHsKICAgICAgICAgICAgc2F0ID0gc2F0MTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgaHVlID0gTnVtYmVyLk5hTjsKICAgICAgICB9CiAgICAgICAgaWYgKHNhdCA9PSBudWxsKSB7CiAgICAgICAgICBzYXQgPSBzYXQwICsgZiAqIChzYXQxIC0gc2F0MCk7CiAgICAgICAgfQogICAgICAgIGxidiA9IGxidjAgKyBmICogKGxidjEgLSBsYnYwKTsKICAgICAgICBpZiAobS5zdWJzdHIoMCwgMSkgPT09ICdoJykgewogICAgICAgICAgcmVzID0gbmV3IENvbG9yKGh1ZSwgc2F0LCBsYnYsIG0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXMgPSBuZXcgQ29sb3IobGJ2LCBzYXQsIGh1ZSwgbSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKG0gPT09ICdyZ2InKSB7CiAgICAgICAgeHl6MCA9IG1lLl9yZ2I7CiAgICAgICAgeHl6MSA9IGNvbC5fcmdiOwogICAgICAgIHJlcyA9IG5ldyBDb2xvcih4eXowWzBdICsgZiAqICh4eXoxWzBdIC0geHl6MFswXSksIHh5ejBbMV0gKyBmICogKHh5ejFbMV0gLSB4eXowWzFdKSwgeHl6MFsyXSArIGYgKiAoeHl6MVsyXSAtIHh5ejBbMl0pLCBtKTsKICAgICAgfSBlbHNlIGlmIChtID09PSAnbnVtJykgewogICAgICAgIGlmICghKGNvbCBpbnN0YW5jZW9mIENvbG9yKSkgewogICAgICAgICAgY29sID0gbmV3IENvbG9yKGNvbCwgbSk7CiAgICAgICAgfQogICAgICAgIHh5ejAgPSBtZS5fcmdiOwogICAgICAgIHh5ejEgPSBjb2wuX3JnYjsKICAgICAgICByZXMgPSBuZXcgQ29sb3IoKCh4eXowWzBdICsgZiAqICh4eXoxWzBdIC0geHl6MFswXSkpIDw8IDE2KSArICgoeHl6MFsxXSArIGYgKiAoeHl6MVsxXSAtIHh5ejBbMV0pKSA8PCA4KSArICgoeHl6MFsyXSArIGYgKiAoeHl6MVsyXSAtIHh5ejBbMl0pKSAmIDB4ZmYpLCBtKTsKICAgICAgfSBlbHNlIGlmIChtID09PSAnbGFiJykgewogICAgICAgIHh5ejAgPSBtZS5sYWIoKTsKICAgICAgICB4eXoxID0gY29sLmxhYigpOwogICAgICAgIHJlcyA9IG5ldyBDb2xvcih4eXowWzBdICsgZiAqICh4eXoxWzBdIC0geHl6MFswXSksIHh5ejBbMV0gKyBmICogKHh5ejFbMV0gLSB4eXowWzFdKSwgeHl6MFsyXSArIGYgKiAoeHl6MVsyXSAtIHh5ejBbMl0pLCBtKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyAiY29sb3IgbW9kZSAiICsgbSArICIgaXMgbm90IHN1cHBvcnRlZCI7CiAgICAgIH0KICAgICAgcmVzLmFscGhhKG1lLmFscGhhKCkgKyBmICogKGNvbC5hbHBoYSgpIC0gbWUuYWxwaGEoKSkpOwogICAgICByZXR1cm4gcmVzOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUubWl4ID0gZnVuY3Rpb24oZiwgY29sLCBtKSB7CiAgICAgIHJldHVybiB0aGlzLmludGVycG9sYXRlKGYsIGNvbCwgbSk7CiAgICB9OwoKICAgIENvbG9yLnByb3RvdHlwZS5wcmVtdWx0aXBseSA9IGZ1bmN0aW9uKCkgewogICAgICB2YXIgYSwgcmdiOwogICAgICByZ2IgPSB0aGlzLnJnYigpOwogICAgICBhID0gdGhpcy5hbHBoYSgpOwogICAgICByZXR1cm4gY2hyb21hKHJnYlswXSAqIGEsIHJnYlsxXSAqIGEsIHJnYlsyXSAqIGEsIGEpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUuZGFya2VuID0gZnVuY3Rpb24oYW1vdW50KSB7CiAgICAgIHZhciBsY2gsIG1lOwogICAgICBpZiAoYW1vdW50ID09IG51bGwpIHsKICAgICAgICBhbW91bnQgPSAyMDsKICAgICAgfQogICAgICBtZSA9IHRoaXM7CiAgICAgIGxjaCA9IG1lLmxjaCgpOwogICAgICBsY2hbMF0gLT0gYW1vdW50OwogICAgICByZXR1cm4gY2hyb21hLmxjaChsY2gpLmFscGhhKG1lLmFscGhhKCkpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUuZGFya2VyID0gZnVuY3Rpb24oYW1vdW50KSB7CiAgICAgIHJldHVybiB0aGlzLmRhcmtlbihhbW91bnQpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUuYnJpZ2h0ZW4gPSBmdW5jdGlvbihhbW91bnQpIHsKICAgICAgaWYgKGFtb3VudCA9PSBudWxsKSB7CiAgICAgICAgYW1vdW50ID0gMjA7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZGFya2VuKC1hbW91bnQpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUuYnJpZ2h0ZXIgPSBmdW5jdGlvbihhbW91bnQpIHsKICAgICAgcmV0dXJuIHRoaXMuYnJpZ2h0ZW4oYW1vdW50KTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLnNhdHVyYXRlID0gZnVuY3Rpb24oYW1vdW50KSB7CiAgICAgIHZhciBsY2gsIG1lOwogICAgICBpZiAoYW1vdW50ID09IG51bGwpIHsKICAgICAgICBhbW91bnQgPSAyMDsKICAgICAgfQogICAgICBtZSA9IHRoaXM7CiAgICAgIGxjaCA9IG1lLmxjaCgpOwogICAgICBsY2hbMV0gKz0gYW1vdW50OwogICAgICByZXR1cm4gY2hyb21hLmxjaChsY2gpLmFscGhhKG1lLmFscGhhKCkpOwogICAgfTsKCiAgICBDb2xvci5wcm90b3R5cGUuZGVzYXR1cmF0ZSA9IGZ1bmN0aW9uKGFtb3VudCkgewogICAgICBpZiAoYW1vdW50ID09IG51bGwpIHsKICAgICAgICBhbW91bnQgPSAyMDsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5zYXR1cmF0ZSgtYW1vdW50KTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmJsZW5kID0gZnVuY3Rpb24oY29sLCBtb2RlKSB7CiAgICAgIHJldHVybiBjaHJvbWEuYmxlbmQodGhpcywgY29sLCBtb2RlKTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmtlbHZpbiA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gcmdiMnRlbXAodGhpcy5fcmdiKTsKICAgIH07CgogICAgQ29sb3IucHJvdG90eXBlLmNteWsgPSBmdW5jdGlvbigpIHsKICAgICAgcmV0dXJuIHJnYjJjbXlrKHRoaXMuX3JnYik7CiAgICB9OwoKICAgIHJldHVybiBDb2xvcjsKCiAgfSkoKTsKCiAgY2xpcF9yZ2IgPSBmdW5jdGlvbihyZ2IpIHsKICAgIHZhciBpOwogICAgZm9yIChpIGluIHJnYikgewogICAgICBpZiAoaSA8IDMpIHsKICAgICAgICBpZiAocmdiW2ldIDwgMCkgewogICAgICAgICAgcmdiW2ldID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKHJnYltpXSA+IDI1NSkgewogICAgICAgICAgcmdiW2ldID0gMjU1OwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChpID09PSAzKSB7CiAgICAgICAgaWYgKHJnYltpXSA8IDApIHsKICAgICAgICAgIHJnYltpXSA9IDA7CiAgICAgICAgfQogICAgICAgIGlmIChyZ2JbaV0gPiAxKSB7CiAgICAgICAgICByZ2JbaV0gPSAxOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHJnYjsKICB9OwoKICByZ2IyY215ayA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGIsIGMsIGYsIGcsIGssIG0sIHIsIHJlZiwgeTsKICAgIHJlZiA9IHVucGFjayhhcmd1bWVudHMpLCByID0gcmVmWzBdLCBnID0gcmVmWzFdLCBiID0gcmVmWzJdOwogICAgciA9IHIgLyAyNTU7CiAgICBnID0gZyAvIDI1NTsKICAgIGIgPSBiIC8gMjU1OwogICAgayA9IDEgLSBNYXRoLm1heChyLCBNYXRoLm1heChnLCBiKSk7CiAgICBmID0gayA8IDEgPyAxIC8gKDEgLSBrKSA6IDA7CiAgICBjID0gKDEgLSByIC0gaykgKiBmOwogICAgbSA9ICgxIC0gZyAtIGspICogZjsKICAgIHkgPSAoMSAtIGIgLSBrKSAqIGY7CiAgICByZXR1cm4gW2MsIG0sIHksIGtdOwogIH07CgogIGNteWsycmdiID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYiwgYywgZywgaywgbSwgciwgcmVmLCB5OwogICAgcmVmID0gdW5wYWNrKGFyZ3VtZW50cyksIGMgPSByZWZbMF0sIG0gPSByZWZbMV0sIHkgPSByZWZbMl0sIGsgPSByZWZbM107CiAgICBpZiAoayA9PT0gMSkgewogICAgICByZXR1cm4gWzAsIDAsIDBdOwogICAgfQogICAgciA9IGMgPj0gMSA/IDAgOiByb3VuZCgyNTUgKiAoMSAtIGMpICogKDEgLSBrKSk7CiAgICBnID0gbSA+PSAxID8gMCA6IHJvdW5kKDI1NSAqICgxIC0gbSkgKiAoMSAtIGspKTsKICAgIGIgPSB5ID49IDEgPyAwIDogcm91bmQoMjU1ICogKDEgLSB5KSAqICgxIC0gaykpOwogICAgcmV0dXJuIFtyLCBnLCBiXTsKICB9OwoKICBjc3MycmdiID0gZnVuY3Rpb24oY3NzKSB7CiAgICB2YXIgYWEsIGFiLCBoc2wsIGksIG0sIG8sIHJnYiwgdzsKICAgIGNzcyA9IGNzcy50b0xvd2VyQ2FzZSgpOwogICAgaWYgKChjaHJvbWEuY29sb3JzICE9IG51bGwpICYmIGNocm9tYS5jb2xvcnNbY3NzXSkgewogICAgICByZXR1cm4gaGV4MnJnYihjaHJvbWEuY29sb3JzW2Nzc10pOwogICAgfQogICAgaWYgKG0gPSBjc3MubWF0Y2goL3JnYlwoXHMqKFwtP1xkKyksXHMqKFwtP1xkKylccyosXHMqKFwtP1xkKylccypcKS8pKSB7CiAgICAgIHJnYiA9IG0uc2xpY2UoMSwgNCk7CiAgICAgIGZvciAoaSA9IG8gPSAwOyBvIDw9IDI7IGkgPSArK28pIHsKICAgICAgICByZ2JbaV0gPSArcmdiW2ldOwogICAgICB9CiAgICAgIHJnYlszXSA9IDE7CiAgICB9IGVsc2UgaWYgKG0gPSBjc3MubWF0Y2goL3JnYmFcKFxzKihcLT9cZCspLFxzKihcLT9cZCspXHMqLFxzKihcLT9cZCspXHMqLFxzKihbMDFdfFswMV0/XC5cZCspXCkvKSkgewogICAgICByZ2IgPSBtLnNsaWNlKDEsIDUpOwogICAgICBmb3IgKGkgPSB3ID0gMDsgdyA8PSAzOyBpID0gKyt3KSB7CiAgICAgICAgcmdiW2ldID0gK3JnYltpXTsKICAgICAgfQogICAgfSBlbHNlIGlmIChtID0gY3NzLm1hdGNoKC9yZ2JcKFxzKihcLT9cZCsoPzpcLlxkKyk/KSUsXHMqKFwtP1xkKyg/OlwuXGQrKT8pJVxzKixccyooXC0/XGQrKD86XC5cZCspPyklXHMqXCkvKSkgewogICAgICByZ2IgPSBtLnNsaWNlKDEsIDQpOwogICAgICBmb3IgKGkgPSBhYSA9IDA7IGFhIDw9IDI7IGkgPSArK2FhKSB7CiAgICAgICAgcmdiW2ldID0gcm91bmQocmdiW2ldICogMi41NSk7CiAgICAgIH0KICAgICAgcmdiWzNdID0gMTsKICAgIH0gZWxzZSBpZiAobSA9IGNzcy5tYXRjaCgvcmdiYVwoXHMqKFwtP1xkKyg/OlwuXGQrKT8pJSxccyooXC0/XGQrKD86XC5cZCspPyklXHMqLFxzKihcLT9cZCsoPzpcLlxkKyk/KSVccyosXHMqKFswMV18WzAxXT9cLlxkKylcKS8pKSB7CiAgICAgIHJnYiA9IG0uc2xpY2UoMSwgNSk7CiAgICAgIGZvciAoaSA9IGFiID0gMDsgYWIgPD0gMjsgaSA9ICsrYWIpIHsKICAgICAgICByZ2JbaV0gPSByb3VuZChyZ2JbaV0gKiAyLjU1KTsKICAgICAgfQogICAgICByZ2JbM10gPSArcmdiWzNdOwogICAgfSBlbHNlIGlmIChtID0gY3NzLm1hdGNoKC9oc2xcKFxzKihcLT9cZCsoPzpcLlxkKyk/KSxccyooXC0/XGQrKD86XC5cZCspPyklXHMqLFxzKihcLT9cZCsoPzpcLlxkKyk/KSVccypcKS8pKSB7CiAgICAgIGhzbCA9IG0uc2xpY2UoMSwgNCk7CiAgICAgIGhzbFsxXSAqPSAwLjAxOwogICAgICBoc2xbMl0gKj0gMC4wMTsKICAgICAgcmdiID0gaHNsMnJnYihoc2wpOwogICAgICByZ2JbM10gPSAxOwogICAgfSBlbHNlIGlmIChtID0gY3NzLm1hdGNoKC9oc2xhXChccyooXC0/XGQrKD86XC5cZCspPyksXHMqKFwtP1xkKyg/OlwuXGQrKT8pJVxzKixccyooXC0/XGQrKD86XC5cZCspPyklXHMqLFxzKihbMDFdfFswMV0/XC5cZCspXCkvKSkgewogICAgICBoc2wgPSBtLnNsaWNlKDEsIDQpOwogICAgICBoc2xbMV0gKj0gMC4wMTsKICAgICAgaHNsWzJdICo9IDAuMDE7CiAgICAgIHJnYiA9IGhzbDJyZ2IoaHNsKTsKICAgICAgcmdiWzNdID0gK21bNF07CiAgICB9CiAgICByZXR1cm4gcmdiOwogIH07CgogIGhleDJyZ2IgPSBmdW5jdGlvbihoZXgpIHsKICAgIHZhciBhLCBiLCBnLCByLCByZ2IsIHU7CiAgICBpZiAoaGV4Lm1hdGNoKC9eIz8oW0EtRmEtZjAtOV17Nn18W0EtRmEtZjAtOV17M30pJC8pKSB7CiAgICAgIGlmIChoZXgubGVuZ3RoID09PSA0IHx8IGhleC5sZW5ndGggPT09IDcpIHsKICAgICAgICBoZXggPSBoZXguc3Vic3RyKDEpOwogICAgICB9CiAgICAgIGlmIChoZXgubGVuZ3RoID09PSAzKSB7CiAgICAgICAgaGV4ID0gaGV4LnNwbGl0KCIiKTsKICAgICAgICBoZXggPSBoZXhbMF0gKyBoZXhbMF0gKyBoZXhbMV0gKyBoZXhbMV0gKyBoZXhbMl0gKyBoZXhbMl07CiAgICAgIH0KICAgICAgdSA9IHBhcnNlSW50KGhleCwgMTYpOwogICAgICByID0gdSA+PiAxNjsKICAgICAgZyA9IHUgPj4gOCAmIDB4RkY7CiAgICAgIGIgPSB1ICYgMHhGRjsKICAgICAgcmV0dXJuIFtyLCBnLCBiLCAxXTsKICAgIH0KICAgIGlmIChoZXgubWF0Y2goL14jPyhbQS1GYS1mMC05XXs4fSkkLykpIHsKICAgICAgaWYgKGhleC5sZW5ndGggPT09IDkpIHsKICAgICAgICBoZXggPSBoZXguc3Vic3RyKDEpOwogICAgICB9CiAgICAgIHUgPSBwYXJzZUludChoZXgsIDE2KTsKICAgICAgciA9IHUgPj4gMjQgJiAweEZGOwogICAgICBnID0gdSA+PiAxNiAmIDB4RkY7CiAgICAgIGIgPSB1ID4+IDggJiAweEZGOwogICAgICBhID0gcm91bmQoKHUgJiAweEZGKSAvIDB4RkYgKiAxMDApIC8gMTAwOwogICAgICByZXR1cm4gW3IsIGcsIGIsIGFdOwogICAgfQogICAgaWYgKHJnYiA9IGNzczJyZ2IoaGV4KSkgewogICAgICByZXR1cm4gcmdiOwogICAgfQogICAgdGhyb3cgInVua25vd24gY29sb3I6ICIgKyBoZXg7CiAgfTsKCiAgaHNpMnJnYiA9IGZ1bmN0aW9uKGgsIHMsIGkpIHsKCiAgICAvKgogICAgYm9ycm93ZWQgZnJvbSBoZXJlOgogICAgaHR0cDovL2h1bW1lci5zdGFuZm9yZC5lZHUvbXVzZWluZm8vZG9jL2V4YW1wbGVzL2h1bWRydW0va2V5c2NhcGUyL2hzaTJyZ2IuY3BwCiAgICAgKi8KICAgIHZhciBiLCBnLCByLCByZWY7CiAgICByZWYgPSB1bnBhY2soYXJndW1lbnRzKSwgaCA9IHJlZlswXSwgcyA9IHJlZlsxXSwgaSA9IHJlZlsyXTsKICAgIGggLz0gMzYwOwogICAgaWYgKGggPCAxIC8gMykgewogICAgICBiID0gKDEgLSBzKSAvIDM7CiAgICAgIHIgPSAoMSArIHMgKiBjb3MoVFdPUEkgKiBoKSAvIGNvcyhQSVRISVJEIC0gVFdPUEkgKiBoKSkgLyAzOwogICAgICBnID0gMSAtIChiICsgcik7CiAgICB9IGVsc2UgaWYgKGggPCAyIC8gMykgewogICAgICBoIC09IDEgLyAzOwogICAgICByID0gKDEgLSBzKSAvIDM7CiAgICAgIGcgPSAoMSArIHMgKiBjb3MoVFdPUEkgKiBoKSAvIGNvcyhQSVRISVJEIC0gVFdPUEkgKiBoKSkgLyAzOwogICAgICBiID0gMSAtIChyICsgZyk7CiAgICB9IGVsc2UgewogICAgICBoIC09IDIgLyAzOwogICAgICBnID0gKDEgLSBzKSAvIDM7CiAgICAgIGIgPSAoMSArIHMgKiBjb3MoVFdPUEkgKiBoKSAvIGNvcyhQSVRISVJEIC0gVFdPUEkgKiBoKSkgLyAzOwogICAgICByID0gMSAtIChnICsgYik7CiAgICB9CiAgICByID0gbGltaXQoaSAqIHIgKiAzKTsKICAgIGcgPSBsaW1pdChpICogZyAqIDMpOwogICAgYiA9IGxpbWl0KGkgKiBiICogMyk7CiAgICByZXR1cm4gW3IgKiAyNTUsIGcgKiAyNTUsIGIgKiAyNTVdOwogIH07CgogIGhzbDJyZ2IgPSBmdW5jdGlvbigpIHsKICAgIHZhciBiLCBjLCBnLCBoLCBpLCBsLCBvLCByLCByZWYsIHJlZjEsIHMsIHQxLCB0MiwgdDM7CiAgICByZWYgPSB1bnBhY2soYXJndW1lbnRzKSwgaCA9IHJlZlswXSwgcyA9IHJlZlsxXSwgbCA9IHJlZlsyXTsKICAgIGlmIChzID09PSAwKSB7CiAgICAgIHIgPSBnID0gYiA9IGwgKiAyNTU7CiAgICB9IGVsc2UgewogICAgICB0MyA9IFswLCAwLCAwXTsKICAgICAgYyA9IFswLCAwLCAwXTsKICAgICAgdDIgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzOwogICAgICB0MSA9IDIgKiBsIC0gdDI7CiAgICAgIGggLz0gMzYwOwogICAgICB0M1swXSA9IGggKyAxIC8gMzsKICAgICAgdDNbMV0gPSBoOwogICAgICB0M1syXSA9IGggLSAxIC8gMzsKICAgICAgZm9yIChpID0gbyA9IDA7IG8gPD0gMjsgaSA9ICsrbykgewogICAgICAgIGlmICh0M1tpXSA8IDApIHsKICAgICAgICAgIHQzW2ldICs9IDE7CiAgICAgICAgfQogICAgICAgIGlmICh0M1tpXSA+IDEpIHsKICAgICAgICAgIHQzW2ldIC09IDE7CiAgICAgICAgfQogICAgICAgIGlmICg2ICogdDNbaV0gPCAxKSB7CiAgICAgICAgICBjW2ldID0gdDEgKyAodDIgLSB0MSkgKiA2ICogdDNbaV07CiAgICAgICAgfSBlbHNlIGlmICgyICogdDNbaV0gPCAxKSB7CiAgICAgICAgICBjW2ldID0gdDI7CiAgICAgICAgfSBlbHNlIGlmICgzICogdDNbaV0gPCAyKSB7CiAgICAgICAgICBjW2ldID0gdDEgKyAodDIgLSB0MSkgKiAoKDIgLyAzKSAtIHQzW2ldKSAqIDY7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNbaV0gPSB0MTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmVmMSA9IFtyb3VuZChjWzBdICogMjU1KSwgcm91bmQoY1sxXSAqIDI1NSksIHJvdW5kKGNbMl0gKiAyNTUpXSwgciA9IHJlZjFbMF0sIGcgPSByZWYxWzFdLCBiID0gcmVmMVsyXTsKICAgIH0KICAgIHJldHVybiBbciwgZywgYl07CiAgfTsKCiAgaHN2MnJnYiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGIsIGYsIGcsIGgsIGksIHAsIHEsIHIsIHJlZiwgcmVmMSwgcmVmMiwgcmVmMywgcmVmNCwgcmVmNSwgcmVmNiwgcywgdCwgdjsKICAgIHJlZiA9IHVucGFjayhhcmd1bWVudHMpLCBoID0gcmVmWzBdLCBzID0gcmVmWzFdLCB2ID0gcmVmWzJdOwogICAgdiAqPSAyNTU7CiAgICBpZiAocyA9PT0gMCkgewogICAgICByID0gZyA9IGIgPSB2OwogICAgfSBlbHNlIHsKICAgICAgaWYgKGggPT09IDM2MCkgewogICAgICAgIGggPSAwOwogICAgICB9CiAgICAgIGlmIChoID4gMzYwKSB7CiAgICAgICAgaCAtPSAzNjA7CiAgICAgIH0KICAgICAgaWYgKGggPCAwKSB7CiAgICAgICAgaCArPSAzNjA7CiAgICAgIH0KICAgICAgaCAvPSA2MDsKICAgICAgaSA9IGZsb29yKGgpOwogICAgICBmID0gaCAtIGk7CiAgICAgIHAgPSB2ICogKDEgLSBzKTsKICAgICAgcSA9IHYgKiAoMSAtIHMgKiBmKTsKICAgICAgdCA9IHYgKiAoMSAtIHMgKiAoMSAtIGYpKTsKICAgICAgc3dpdGNoIChpKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcmVmMSA9IFt2LCB0LCBwXSwgciA9IHJlZjFbMF0sIGcgPSByZWYxWzFdLCBiID0gcmVmMVsyXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMToKICAgICAgICAgIHJlZjIgPSBbcSwgdiwgcF0sIHIgPSByZWYyWzBdLCBnID0gcmVmMlsxXSwgYiA9IHJlZjJbMl07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICByZWYzID0gW3AsIHYsIHRdLCByID0gcmVmM1swXSwgZyA9IHJlZjNbMV0sIGIgPSByZWYzWzJdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcmVmNCA9IFtwLCBxLCB2XSwgciA9IHJlZjRbMF0sIGcgPSByZWY0WzFdLCBiID0gcmVmNFsyXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNDoKICAgICAgICAgIHJlZjUgPSBbdCwgcCwgdl0sIHIgPSByZWY1WzBdLCBnID0gcmVmNVsxXSwgYiA9IHJlZjVbMl07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDU6CiAgICAgICAgICByZWY2ID0gW3YsIHAsIHFdLCByID0gcmVmNlswXSwgZyA9IHJlZjZbMV0sIGIgPSByZWY2WzJdOwogICAgICB9CiAgICB9CiAgICByID0gcm91bmQocik7CiAgICBnID0gcm91bmQoZyk7CiAgICBiID0gcm91bmQoYik7CiAgICByZXR1cm4gW3IsIGcsIGJdOwogIH07CgogIEsgPSAxODsKCiAgWCA9IDAuOTUwNDcwOwoKICBZID0gMTsKCiAgWiA9IDEuMDg4ODMwOwoKICBsYWIybGNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYSwgYiwgYywgaCwgbCwgcmVmOwogICAgcmVmID0gdW5wYWNrKGFyZ3VtZW50cyksIGwgPSByZWZbMF0sIGEgPSByZWZbMV0sIGIgPSByZWZbMl07CiAgICBjID0gTWF0aC5zcXJ0KGEgKiBhICsgYiAqIGIpOwogICAgaCA9IChNYXRoLmF0YW4yKGIsIGEpIC8gTWF0aC5QSSAqIDE4MCArIDM2MCkgJSAzNjA7CiAgICByZXR1cm4gW2wsIGMsIGhdOwogIH07CgogIGxhYjJyZ2IgPSBmdW5jdGlvbihsLCBhLCBiKSB7CgogICAgLyoKICAgIGFkYXB0ZWQgdG8gbWF0Y2ggZDMgaW1wbGVtZW50YXRpb24KICAgICAqLwogICAgdmFyIGcsIHIsIHJlZiwgcmVmMSwgeCwgeSwgejsKICAgIGlmIChsICE9PSB2b2lkIDAgJiYgbC5sZW5ndGggPT09IDMpIHsKICAgICAgcmVmID0gbCwgbCA9IHJlZlswXSwgYSA9IHJlZlsxXSwgYiA9IHJlZlsyXTsKICAgIH0KICAgIGlmIChsICE9PSB2b2lkIDAgJiYgbC5sZW5ndGggPT09IDMpIHsKICAgICAgcmVmMSA9IGwsIGwgPSByZWYxWzBdLCBhID0gcmVmMVsxXSwgYiA9IHJlZjFbMl07CiAgICB9CiAgICB5ID0gKGwgKyAxNikgLyAxMTY7CiAgICB4ID0geSArIGEgLyA1MDA7CiAgICB6ID0geSAtIGIgLyAyMDA7CiAgICB4ID0gbGFiX3h5eih4KSAqIFg7CiAgICB5ID0gbGFiX3h5eih5KSAqIFk7CiAgICB6ID0gbGFiX3h5eih6KSAqIFo7CiAgICByID0geHl6X3JnYigzLjI0MDQ1NDIgKiB4IC0gMS41MzcxMzg1ICogeSAtIDAuNDk4NTMxNCAqIHopOwogICAgZyA9IHh5el9yZ2IoLTAuOTY5MjY2MCAqIHggKyAxLjg3NjAxMDggKiB5ICsgMC4wNDE1NTYwICogeik7CiAgICBiID0geHl6X3JnYigwLjA1NTY0MzQgKiB4IC0gMC4yMDQwMjU5ICogeSArIDEuMDU3MjI1MiAqIHopOwogICAgcmV0dXJuIFtsaW1pdChyLCAwLCAyNTUpLCBsaW1pdChnLCAwLCAyNTUpLCBsaW1pdChiLCAwLCAyNTUpLCAxXTsKICB9OwoKICBsYWJfeHl6ID0gZnVuY3Rpb24oeCkgewogICAgaWYgKHggPiAwLjIwNjg5MzAzNCkgewogICAgICByZXR1cm4geCAqIHggKiB4OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuICh4IC0gNCAvIDI5KSAvIDcuNzg3MDM3OwogICAgfQogIH07CgogIHh5el9yZ2IgPSBmdW5jdGlvbihyKSB7CiAgICByZXR1cm4gcm91bmQoMjU1ICogKHIgPD0gMC4wMDMwNCA/IDEyLjkyICogciA6IDEuMDU1ICogcG93KHIsIDEgLyAyLjQpIC0gMC4wNTUpKTsKICB9OwoKICBsY2gybGFiID0gZnVuY3Rpb24oKSB7CgogICAgLyoKICAgIENvbnZlcnQgZnJvbSBhIHF1YWxpdGF0aXZlIHBhcmFtZXRlciBoIGFuZCBhIHF1YW50aXRhdGl2ZSBwYXJhbWV0ZXIgbCB0byBhIDI0LWJpdCBwaXhlbC4gVGhlc2UgZm9ybXVsYXMgd2VyZSBpbnZlbnRlZCBieSBEYXZpZCBEYWxyeW1wbGUgdG8gb2J0YWluIG1heGltdW0gY29udHJhc3Qgd2l0aG91dCBnb2luZyBvdXQgb2YgZ2FtdXQgaWYgdGhlIHBhcmFtZXRlcnMgYXJlIGluIHRoZSByYW5nZSAwLTEuCiAgICBBIHNhdHVyYXRpb24gbXVsdGlwbGllciB3YXMgYWRkZWQgYnkgR3JlZ29yIEFpc2NoCiAgICAgKi8KICAgIHZhciBjLCBoLCBsLCByZWY7CiAgICByZWYgPSB1bnBhY2soYXJndW1lbnRzKSwgbCA9IHJlZlswXSwgYyA9IHJlZlsxXSwgaCA9IHJlZlsyXTsKICAgIGggPSBoICogTWF0aC5QSSAvIDE4MDsKICAgIHJldHVybiBbbCwgTWF0aC5jb3MoaCkgKiBjLCBNYXRoLnNpbihoKSAqIGNdOwogIH07CgogIGxjaDJyZ2IgPSBmdW5jdGlvbihsLCBjLCBoKSB7CiAgICB2YXIgTCwgYSwgYiwgZywgciwgcmVmLCByZWYxOwogICAgcmVmID0gbGNoMmxhYihsLCBjLCBoKSwgTCA9IHJlZlswXSwgYSA9IHJlZlsxXSwgYiA9IHJlZlsyXTsKICAgIHJlZjEgPSBsYWIycmdiKEwsIGEsIGIpLCByID0gcmVmMVswXSwgZyA9IHJlZjFbMV0sIGIgPSByZWYxWzJdOwogICAgcmV0dXJuIFtsaW1pdChyLCAwLCAyNTUpLCBsaW1pdChnLCAwLCAyNTUpLCBsaW1pdChiLCAwLCAyNTUpXTsKICB9OwoKICBsdW1pbmFuY2UgPSBmdW5jdGlvbihyLCBnLCBiKSB7CiAgICB2YXIgcmVmOwogICAgcmVmID0gdW5wYWNrKGFyZ3VtZW50cyksIHIgPSByZWZbMF0sIGcgPSByZWZbMV0sIGIgPSByZWZbMl07CiAgICByID0gbHVtaW5hbmNlX3gocik7CiAgICBnID0gbHVtaW5hbmNlX3goZyk7CiAgICBiID0gbHVtaW5hbmNlX3goYik7CiAgICByZXR1cm4gMC4yMTI2ICogciArIDAuNzE1MiAqIGcgKyAwLjA3MjIgKiBiOwogIH07CgogIGx1bWluYW5jZV94ID0gZnVuY3Rpb24oeCkgewogICAgeCAvPSAyNTU7CiAgICBpZiAoeCA8PSAwLjAzOTI4KSB7CiAgICAgIHJldHVybiB4IC8gMTIuOTI7CiAgICB9IGVsc2UgewogICAgICByZXR1cm4gTWF0aC5wb3coKHggKyAwLjA1NSkgLyAxLjA1NSwgMi40KTsKICAgIH0KICB9OwoKICBudW0ycmdiID0gZnVuY3Rpb24obnVtKSB7CiAgICB2YXIgYiwgZywgcjsKICAgIGlmICh0eXBlKG51bSkgPT09ICJudW1iZXIiICYmIG51bSA+PSAwICYmIG51bSA8PSAweEZGRkZGRikgewogICAgICByID0gbnVtID4+IDE2OwogICAgICBnID0gKG51bSA+PiA4KSAmIDB4RkY7CiAgICAgIGIgPSBudW0gJiAweEZGOwogICAgICByZXR1cm4gW3IsIGcsIGIsIDFdOwogICAgfQogICAgdGhyb3cgInVua25vd24gbnVtIGNvbG9yOiAiICsgbnVtOwogIH07CgogIHJnYjJoZXggPSBmdW5jdGlvbihjaGFubmVscywgbW9kZSkgewogICAgdmFyIGEsIGIsIGcsIGh4YSwgciwgc3RyLCB1OwogICAgaWYgKG1vZGUgPT0gbnVsbCkgewogICAgICBtb2RlID0gJ3JnYic7CiAgICB9CiAgICByID0gY2hhbm5lbHNbMF0sIGcgPSBjaGFubmVsc1sxXSwgYiA9IGNoYW5uZWxzWzJdLCBhID0gY2hhbm5lbHNbM107CiAgICB1ID0gciA8PCAxNiB8IGcgPDwgOCB8IGI7CiAgICBzdHIgPSAiMDAwMDAwIiArIHUudG9TdHJpbmcoMTYpOwogICAgc3RyID0gc3RyLnN1YnN0cihzdHIubGVuZ3RoIC0gNik7CiAgICBoeGEgPSAnMCcgKyByb3VuZChhICogMjU1KS50b1N0cmluZygxNik7CiAgICBoeGEgPSBoeGEuc3Vic3RyKGh4YS5sZW5ndGggLSAyKTsKICAgIHJldHVybiAiIyIgKyAoZnVuY3Rpb24oKSB7CiAgICAgIHN3aXRjaCAobW9kZS50b0xvd2VyQ2FzZSgpKSB7CiAgICAgICAgY2FzZSAncmdiYSc6CiAgICAgICAgICByZXR1cm4gc3RyICsgaHhhOwogICAgICAgIGNhc2UgJ2FyZ2InOgogICAgICAgICAgcmV0dXJuIGh4YSArIHN0cjsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIHN0cjsKICAgICAgfQogICAgfSkoKTsKICB9OwoKICByZ2IyaHNpID0gZnVuY3Rpb24oKSB7CgogICAgLyoKICAgIGJvcnJvd2VkIGZyb20gaGVyZToKICAgIGh0dHA6Ly9odW1tZXIuc3RhbmZvcmQuZWR1L211c2VpbmZvL2RvYy9leGFtcGxlcy9odW1kcnVtL2tleXNjYXBlMi9yZ2IyaHNpLmNwcAogICAgICovCiAgICB2YXIgVFdPUEksIGIsIGcsIGgsIGksIG1pbiwgciwgcmVmLCBzOwogICAgcmVmID0gdW5wYWNrKGFyZ3VtZW50cyksIHIgPSByZWZbMF0sIGcgPSByZWZbMV0sIGIgPSByZWZbMl07CiAgICBUV09QSSA9IE1hdGguUEkgKiAyOwogICAgciAvPSAyNTU7CiAgICBnIC89IDI1NTsKICAgIGIgLz0gMjU1OwogICAgbWluID0gTWF0aC5taW4ociwgZywgYik7CiAgICBpID0gKHIgKyBnICsgYikgLyAzOwogICAgcyA9IDEgLSBtaW4gLyBpOwogICAgaWYgKHMgPT09IDApIHsKICAgICAgaCA9IDA7CiAgICB9IGVsc2UgewogICAgICBoID0gKChyIC0gZykgKyAociAtIGIpKSAvIDI7CiAgICAgIGggLz0gTWF0aC5zcXJ0KChyIC0gZykgKiAociAtIGcpICsgKHIgLSBiKSAqIChnIC0gYikpOwogICAgICBoID0gTWF0aC5hY29zKGgpOwogICAgICBpZiAoYiA+IGcpIHsKICAgICAgICBoID0gVFdPUEkgLSBoOwogICAgICB9CiAgICAgIGggLz0gVFdPUEk7CiAgICB9CiAgICByZXR1cm4gW2ggKiAzNjAsIHMsIGldOwogIH07CgogIHJnYjJoc2wgPSBmdW5jdGlvbihyLCBnLCBiKSB7CiAgICB2YXIgaCwgbCwgbWF4LCBtaW4sIHJlZiwgczsKICAgIGlmIChyICE9PSB2b2lkIDAgJiYgci5sZW5ndGggPj0gMykgewogICAgICByZWYgPSByLCByID0gcmVmWzBdLCBnID0gcmVmWzFdLCBiID0gcmVmWzJdOwogICAgfQogICAgciAvPSAyNTU7CiAgICBnIC89IDI1NTsKICAgIGIgLz0gMjU1OwogICAgbWluID0gTWF0aC5taW4ociwgZywgYik7CiAgICBtYXggPSBNYXRoLm1heChyLCBnLCBiKTsKICAgIGwgPSAobWF4ICsgbWluKSAvIDI7CiAgICBpZiAobWF4ID09PSBtaW4pIHsKICAgICAgcyA9IDA7CiAgICAgIGggPSBOdW1iZXIuTmFOOwogICAgfSBlbHNlIHsKICAgICAgcyA9IGwgPCAwLjUgPyAobWF4IC0gbWluKSAvIChtYXggKyBtaW4pIDogKG1heCAtIG1pbikgLyAoMiAtIG1heCAtIG1pbik7CiAgICB9CiAgICBpZiAociA9PT0gbWF4KSB7CiAgICAgIGggPSAoZyAtIGIpIC8gKG1heCAtIG1pbik7CiAgICB9IGVsc2UgaWYgKGcgPT09IG1heCkgewogICAgICBoID0gMiArIChiIC0gcikgLyAobWF4IC0gbWluKTsKICAgIH0gZWxzZSBpZiAoYiA9PT0gbWF4KSB7CiAgICAgIGggPSA0ICsgKHIgLSBnKSAvIChtYXggLSBtaW4pOwogICAgfQogICAgaCAqPSA2MDsKICAgIGlmIChoIDwgMCkgewogICAgICBoICs9IDM2MDsKICAgIH0KICAgIHJldHVybiBbaCwgcywgbF07CiAgfTsKCiAgcmdiMmhzdiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGIsIGRlbHRhLCBnLCBoLCBtYXgsIG1pbiwgciwgcmVmLCBzLCB2OwogICAgcmVmID0gdW5wYWNrKGFyZ3VtZW50cyksIHIgPSByZWZbMF0sIGcgPSByZWZbMV0sIGIgPSByZWZbMl07CiAgICBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTsKICAgIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpOwogICAgZGVsdGEgPSBtYXggLSBtaW47CiAgICB2ID0gbWF4IC8gMjU1LjA7CiAgICBpZiAobWF4ID09PSAwKSB7CiAgICAgIGggPSBOdW1iZXIuTmFOOwogICAgICBzID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIHMgPSBkZWx0YSAvIG1heDsKICAgICAgaWYgKHIgPT09IG1heCkgewogICAgICAgIGggPSAoZyAtIGIpIC8gZGVsdGE7CiAgICAgIH0KICAgICAgaWYgKGcgPT09IG1heCkgewogICAgICAgIGggPSAyICsgKGIgLSByKSAvIGRlbHRhOwogICAgICB9CiAgICAgIGlmIChiID09PSBtYXgpIHsKICAgICAgICBoID0gNCArIChyIC0gZykgLyBkZWx0YTsKICAgICAgfQogICAgICBoICo9IDYwOwogICAgICBpZiAoaCA8IDApIHsKICAgICAgICBoICs9IDM2MDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFtoLCBzLCB2XTsKICB9OwoKICByZ2IybGFiID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYiwgZywgciwgcmVmLCByZWYxLCB4LCB5LCB6OwogICAgcmVmID0gdW5wYWNrKGFyZ3VtZW50cyksIHIgPSByZWZbMF0sIGcgPSByZWZbMV0sIGIgPSByZWZbMl07CiAgICByZWYxID0gcmdiMnh5eihyLCBnLCBiKSwgeCA9IHJlZjFbMF0sIHkgPSByZWYxWzFdLCB6ID0gcmVmMVsyXTsKICAgIHJldHVybiBbMTE2ICogeSAtIDE2LCA1MDAgKiAoeCAtIHkpLCAyMDAgKiAoeSAtIHopXTsKICB9OwoKICByZ2JfeHl6ID0gZnVuY3Rpb24ocikgewogICAgaWYgKChyIC89IDI1NSkgPD0gMC4wNDA0NSkgewogICAgICByZXR1cm4gciAvIDEyLjkyOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIE1hdGgucG93KChyICsgMC4wNTUpIC8gMS4wNTUsIDIuNCk7CiAgICB9CiAgfTsKCiAgeHl6X2xhYiA9IGZ1bmN0aW9uKHgpIHsKICAgIGlmICh4ID4gMC4wMDg4NTYpIHsKICAgICAgcmV0dXJuIE1hdGgucG93KHgsIDEgLyAzKTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiA3Ljc4NzAzNyAqIHggKyA0IC8gMjk7CiAgICB9CiAgfTsKCiAgcmdiMnh5eiA9IGZ1bmN0aW9uKCkgewogICAgdmFyIGIsIGcsIHIsIHJlZiwgeCwgeSwgejsKICAgIHJlZiA9IHVucGFjayhhcmd1bWVudHMpLCByID0gcmVmWzBdLCBnID0gcmVmWzFdLCBiID0gcmVmWzJdOwogICAgciA9IHJnYl94eXoocik7CiAgICBnID0gcmdiX3h5eihnKTsKICAgIGIgPSByZ2JfeHl6KGIpOwogICAgeCA9IHh5el9sYWIoKDAuNDEyNDU2NCAqIHIgKyAwLjM1NzU3NjEgKiBnICsgMC4xODA0Mzc1ICogYikgLyBYKTsKICAgIHkgPSB4eXpfbGFiKCgwLjIxMjY3MjkgKiByICsgMC43MTUxNTIyICogZyArIDAuMDcyMTc1MCAqIGIpIC8gWSk7CiAgICB6ID0geHl6X2xhYigoMC4wMTkzMzM5ICogciArIDAuMTE5MTkyMCAqIGcgKyAwLjk1MDMwNDEgKiBiKSAvIFopOwogICAgcmV0dXJuIFt4LCB5LCB6XTsKICB9OwoKICByZ2IybGNoID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYSwgYiwgZywgbCwgciwgcmVmLCByZWYxOwogICAgcmVmID0gdW5wYWNrKGFyZ3VtZW50cyksIHIgPSByZWZbMF0sIGcgPSByZWZbMV0sIGIgPSByZWZbMl07CiAgICByZWYxID0gcmdiMmxhYihyLCBnLCBiKSwgbCA9IHJlZjFbMF0sIGEgPSByZWYxWzFdLCBiID0gcmVmMVsyXTsKICAgIHJldHVybiBsYWIybGNoKGwsIGEsIGIpOwogIH07CgogIHJnYjJudW0gPSBmdW5jdGlvbigpIHsKICAgIHZhciBiLCBnLCByLCByZWY7CiAgICByZWYgPSB1bnBhY2soYXJndW1lbnRzKSwgciA9IHJlZlswXSwgZyA9IHJlZlsxXSwgYiA9IHJlZlsyXTsKICAgIHJldHVybiAociA8PCAxNikgKyAoZyA8PCA4KSArIGI7CiAgfTsKCiAgdGVtcDJyZ2IgPSBmdW5jdGlvbihrZWx2aW4pIHsKICAgIHZhciBiLCBnLCByLCB0ZW1wOwogICAgdGVtcCA9IGtlbHZpbiAvIDEwMDsKICAgIGlmICh0ZW1wIDwgNjYpIHsKICAgICAgciA9IDI1NTsKICAgICAgZyA9IC0xNTUuMjU0ODU1NjI3MDkxNzkgLSAwLjQ0NTk2OTUwNDY5NTc5MTMzICogKGcgPSB0ZW1wIC0gMikgKyAxMDQuNDkyMTYxOTkzOTM4ODggKiBsb2coZyk7CiAgICAgIGIgPSB0ZW1wIDwgMjAgPyAwIDogLTI1NC43NjkzNTE4NDEyMDkwMiArIDAuODI3NDA5NjA2NDAwNzM5NSAqIChiID0gdGVtcCAtIDEwKSArIDExNS42Nzk5NDQwMTA2NjE0NyAqIGxvZyhiKTsKICAgIH0gZWxzZSB7CiAgICAgIHIgPSAzNTEuOTc2OTA1NjY4MDU2OTMgKyAwLjExNDIwNjQ1Mzc4NDE2NSAqIChyID0gdGVtcCAtIDU1KSAtIDQwLjI1MzY2MzA5MzMyMTI3ICogbG9nKHIpOwogICAgICBnID0gMzI1LjQ0OTQxMjU3MTE5NzQgKyAwLjA3OTQzNDU2NTM2NjYyMzQyICogKGcgPSB0ZW1wIC0gNTApIC0gMjguMDg1Mjk2MzUwNzk1NyAqIGxvZyhnKTsKICAgICAgYiA9IDI1NTsKICAgIH0KICAgIHJldHVybiBjbGlwX3JnYihbciwgZywgYl0pOwogIH07CgogIHJnYjJ0ZW1wID0gZnVuY3Rpb24oKSB7CiAgICB2YXIgYiwgZXBzLCBnLCBtYXhUZW1wLCBtaW5UZW1wLCByLCByZWYsIHJnYiwgdGVtcDsKICAgIHJlZiA9IHVucGFjayhhcmd1bWVudHMpLCByID0gcmVmWzBdLCBnID0gcmVmWzFdLCBiID0gcmVmWzJdOwogICAgbWluVGVtcCA9IDEwMDA7CiAgICBtYXhUZW1wID0gNDAwMDA7CiAgICBlcHMgPSAwLjQ7CiAgICB3aGlsZSAobWF4VGVtcCAtIG1pblRlbXAgPiBlcHMpIHsKICAgICAgdGVtcCA9IChtYXhUZW1wICsgbWluVGVtcCkgKiAwLjU7CiAgICAgIHJnYiA9IHRlbXAycmdiKHRlbXApOwogICAgICBpZiAoKHJnYlsyXSAvIHJnYlswXSkgPj0gKGIgLyByKSkgewogICAgICAgIG1heFRlbXAgPSB0ZW1wOwogICAgICB9IGVsc2UgewogICAgICAgIG1pblRlbXAgPSB0ZW1wOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcm91bmQodGVtcCk7CiAgfTsKCgogIC8qCiAgICAgIGNocm9tYS5qcwogIAogICAgICBDb3B5cmlnaHQgKGMpIDIwMTEtMjAxMywgR3JlZ29yIEFpc2NoCiAgICAgIEFsbCByaWdodHMgcmVzZXJ2ZWQuCiAgCiAgICAgIFJlZGlzdHJpYnV0aW9uIGFuZCB1c2UgaW4gc291cmNlIGFuZCBiaW5hcnkgZm9ybXMsIHdpdGggb3Igd2l0aG91dAogICAgICBtb2RpZmljYXRpb24sIGFyZSBwZXJtaXR0ZWQgcHJvdmlkZWQgdGhhdCB0aGUgZm9sbG93aW5nIGNvbmRpdGlvbnMgYXJlIG1ldDoKICAKICAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsIHRoaXMKICAgICAgICBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KICAKICAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiAgICAgICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgogICAgICAgIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgogIAogICAgICAqIFRoZSBuYW1lIEdyZWdvciBBaXNjaCBtYXkgbm90IGJlIHVzZWQgdG8gZW5kb3JzZSBvciBwcm9tb3RlIHByb2R1Y3RzCiAgICAgICAgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dCBzcGVjaWZpYyBwcmlvciB3cml0dGVuIHBlcm1pc3Npb24uCiAgCiAgICAgIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIgogICAgICBBTkQgQU5ZIEVYUFJFU1MgT1IgSU1QTElFRCBXQVJSQU5USUVTLCBJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgVEhFCiAgICAgIElNUExJRUQgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFkgQU5EIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFIEFSRQogICAgICBESVNDTEFJTUVELiBJTiBOTyBFVkVOVCBTSEFMTCBHUkVHT1IgQUlTQ0ggT1IgQ09OVFJJQlVUT1JTIEJFIExJQUJMRSBGT1IgQU5ZIERJUkVDVCwKICAgICAgSU5ESVJFQ1QsIElOQ0lERU5UQUwsIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsCiAgICAgIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQgT0YgU1VCU1RJVFVURSBHT09EUyBPUiBTRVJWSUNFUzsgTE9TUyBPRiBVU0UsCiAgICAgIERBVEEsIE9SIFBST0ZJVFM7IE9SIEJVU0lORVNTIElOVEVSUlVQVElPTikgSE9XRVZFUiBDQVVTRUQgQU5EIE9OIEFOWSBUSEVPUlkKICAgICAgT0YgTElBQklMSVRZLCBXSEVUSEVSIElOIENPTlRSQUNULCBTVFJJQ1QgTElBQklMSVRZLCBPUiBUT1JUIChJTkNMVURJTkcKICAgICAgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTIFNPRlRXQVJFLAogICAgICBFVkVOIElGIEFEVklTRUQgT0YgVEhFIFBPU1NJQklMSVRZIE9GIFNVQ0ggREFNQUdFLgogIAogICAgICBAc291cmNlOiBodHRwczovL2dpdGh1Yi5jb20vZ2thL2Nocm9tYS5qcwogICAqLwoKICBjaHJvbWEuc2NhbGUgPSBmdW5jdGlvbihjb2xvcnMsIHBvc2l0aW9ucykgewogICAgdmFyIF9jb2xvckNhY2hlLCBfY29sb3JzLCBfY29ycmVjdExpZ2h0bmVzcywgX2RvbWFpbiwgX2ZpeGVkLCBfbWF4LCBfbWluLCBfbW9kZSwgX25hY29sLCBfbnVtQ2xhc3NlcywgX291dCwgX3BvcywgX3NwcmVhZCwgY2xhc3NpZnlWYWx1ZSwgZiwgZ2V0Q2xhc3MsIGdldENvbG9yLCByZXNldENhY2hlLCBzZXRDb2xvcnMsIHNldERvbWFpbiwgdG1hcDsKICAgIF9tb2RlID0gJ3JnYic7CiAgICBfbmFjb2wgPSBjaHJvbWEoJyNjY2MnKTsKICAgIF9zcHJlYWQgPSAwOwogICAgX2ZpeGVkID0gZmFsc2U7CiAgICBfZG9tYWluID0gWzAsIDFdOwogICAgX2NvbG9ycyA9IFtdOwogICAgX291dCA9IGZhbHNlOwogICAgX3BvcyA9IFtdOwogICAgX21pbiA9IDA7CiAgICBfbWF4ID0gMTsKICAgIF9jb3JyZWN0TGlnaHRuZXNzID0gZmFsc2U7CiAgICBfbnVtQ2xhc3NlcyA9IDA7CiAgICBfY29sb3JDYWNoZSA9IHt9OwogICAgc2V0Q29sb3JzID0gZnVuY3Rpb24oY29sb3JzLCBwb3NpdGlvbnMpIHsKICAgICAgdmFyIGMsIGNvbCwgbywgcmVmLCByZWYxLCByZWYyLCB3OwogICAgICBpZiAoY29sb3JzID09IG51bGwpIHsKICAgICAgICBjb2xvcnMgPSBbJyNkZGQnLCAnIzIyMiddOwogICAgICB9CiAgICAgIGlmICgoY29sb3JzICE9IG51bGwpICYmIHR5cGUoY29sb3JzKSA9PT0gJ3N0cmluZycgJiYgKCgocmVmID0gY2hyb21hLmJyZXdlcikgIT0gbnVsbCA/IHJlZltjb2xvcnNdIDogdm9pZCAwKSAhPSBudWxsKSkgewogICAgICAgIGNvbG9ycyA9IGNocm9tYS5icmV3ZXJbY29sb3JzXTsKICAgICAgfQogICAgICBpZiAodHlwZShjb2xvcnMpID09PSAnYXJyYXknKSB7CiAgICAgICAgY29sb3JzID0gY29sb3JzLnNsaWNlKDApOwogICAgICAgIGZvciAoYyA9IG8gPSAwLCByZWYxID0gY29sb3JzLmxlbmd0aCAtIDE7IDAgPD0gcmVmMSA/IG8gPD0gcmVmMSA6IG8gPj0gcmVmMTsgYyA9IDAgPD0gcmVmMSA/ICsrbyA6IC0tbykgewogICAgICAgICAgY29sID0gY29sb3JzW2NdOwogICAgICAgICAgaWYgKHR5cGUoY29sKSA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgY29sb3JzW2NdID0gY2hyb21hKGNvbCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChwb3NpdGlvbnMgIT0gbnVsbCkgewogICAgICAgICAgX3BvcyA9IHBvc2l0aW9uczsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3BvcyA9IFtdOwogICAgICAgICAgZm9yIChjID0gdyA9IDAsIHJlZjIgPSBjb2xvcnMubGVuZ3RoIC0gMTsgMCA8PSByZWYyID8gdyA8PSByZWYyIDogdyA+PSByZWYyOyBjID0gMCA8PSByZWYyID8gKyt3IDogLS13KSB7CiAgICAgICAgICAgIF9wb3MucHVzaChjIC8gKGNvbG9ycy5sZW5ndGggLSAxKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJlc2V0Q2FjaGUoKTsKICAgICAgcmV0dXJuIF9jb2xvcnMgPSBjb2xvcnM7CiAgICB9OwogICAgc2V0RG9tYWluID0gZnVuY3Rpb24oZG9tYWluKSB7CiAgICAgIGlmIChkb21haW4gPT0gbnVsbCkgewogICAgICAgIGRvbWFpbiA9IFtdOwogICAgICB9CgogICAgICAvKgogICAgICAgKiB1c2UgdGhpcyBpZiB5b3Ugd2FudCB0byBkaXNwbGF5IGEgbGltaXRlZCBudW1iZXIgb2YgZGF0YSBjbGFzc2VzCiAgICAgICAqIHBvc3NpYmxlIG1ldGhvZHMgYXJlICJlcXVhbGludGVydmFsIiwgInF1YW50aWxlcyIsICJjdXN0b20iCiAgICAgICAqLwogICAgICBfZG9tYWluID0gZG9tYWluOwogICAgICBfbWluID0gZG9tYWluWzBdOwogICAgICBfbWF4ID0gZG9tYWluW2RvbWFpbi5sZW5ndGggLSAxXTsKICAgICAgcmVzZXRDYWNoZSgpOwogICAgICBpZiAoZG9tYWluLmxlbmd0aCA9PT0gMikgewogICAgICAgIHJldHVybiBfbnVtQ2xhc3NlcyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIF9udW1DbGFzc2VzID0gZG9tYWluLmxlbmd0aCAtIDE7CiAgICAgIH0KICAgIH07CiAgICBnZXRDbGFzcyA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHZhciBpLCBuOwogICAgICBpZiAoX2RvbWFpbiAhPSBudWxsKSB7CiAgICAgICAgbiA9IF9kb21haW4ubGVuZ3RoIC0gMTsKICAgICAgICBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IG4gJiYgdmFsdWUgPj0gX2RvbWFpbltpXSkgewogICAgICAgICAgaSsrOwogICAgICAgIH0KICAgICAgICByZXR1cm4gaSAtIDE7CiAgICAgIH0KICAgICAgcmV0dXJuIDA7CiAgICB9OwogICAgdG1hcCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgcmV0dXJuIHQ7CiAgICB9OwogICAgY2xhc3NpZnlWYWx1ZSA9IGZ1bmN0aW9uKHZhbHVlKSB7CiAgICAgIHZhciBpLCBtYXhjLCBtaW5jLCBuLCB2YWw7CiAgICAgIHZhbCA9IHZhbHVlOwogICAgICBpZiAoX2RvbWFpbi5sZW5ndGggPiAyKSB7CiAgICAgICAgbiA9IF9kb21haW4ubGVuZ3RoIC0gMTsKICAgICAgICBpID0gZ2V0Q2xhc3ModmFsdWUpOwogICAgICAgIG1pbmMgPSBfZG9tYWluWzBdICsgKF9kb21haW5bMV0gLSBfZG9tYWluWzBdKSAqICgwICsgX3NwcmVhZCAqIDAuNSk7CiAgICAgICAgbWF4YyA9IF9kb21haW5bbiAtIDFdICsgKF9kb21haW5bbl0gLSBfZG9tYWluW24gLSAxXSkgKiAoMSAtIF9zcHJlYWQgKiAwLjUpOwogICAgICAgIHZhbCA9IF9taW4gKyAoKF9kb21haW5baV0gKyAoX2RvbWFpbltpICsgMV0gLSBfZG9tYWluW2ldKSAqIDAuNSAtIG1pbmMpIC8gKG1heGMgLSBtaW5jKSkgKiAoX21heCAtIF9taW4pOwogICAgICB9CiAgICAgIHJldHVybiB2YWw7CiAgICB9OwogICAgZ2V0Q29sb3IgPSBmdW5jdGlvbih2YWwsIGJ5cGFzc01hcCkgewogICAgICB2YXIgYywgY29sLCBmMCwgaSwgaywgbywgcCwgcmVmLCB0OwogICAgICBpZiAoYnlwYXNzTWFwID09IG51bGwpIHsKICAgICAgICBieXBhc3NNYXAgPSBmYWxzZTsKICAgICAgfQogICAgICBpZiAoaXNOYU4odmFsKSkgewogICAgICAgIHJldHVybiBfbmFjb2w7CiAgICAgIH0KICAgICAgaWYgKCFieXBhc3NNYXApIHsKICAgICAgICBpZiAoX2RvbWFpbi5sZW5ndGggPiAyKSB7CiAgICAgICAgICBjID0gZ2V0Q2xhc3ModmFsKTsKICAgICAgICAgIHQgPSBjIC8gKF9udW1DbGFzc2VzIC0gMSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHQgPSBmMCA9IF9taW4gIT09IF9tYXggPyAodmFsIC0gX21pbikgLyAoX21heCAtIF9taW4pIDogMDsKICAgICAgICAgIHQgPSBmMCA9ICh2YWwgLSBfbWluKSAvIChfbWF4IC0gX21pbik7CiAgICAgICAgICB0ID0gTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgdCkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0ID0gdmFsOwogICAgICB9CiAgICAgIGlmICghYnlwYXNzTWFwKSB7CiAgICAgICAgdCA9IHRtYXAodCk7CiAgICAgIH0KICAgICAgayA9IE1hdGguZmxvb3IodCAqIDEwMDAwKTsKICAgICAgaWYgKF9jb2xvckNhY2hlW2tdKSB7CiAgICAgICAgY29sID0gX2NvbG9yQ2FjaGVba107CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaWYgKHR5cGUoX2NvbG9ycykgPT09ICdhcnJheScpIHsKICAgICAgICAgIGZvciAoaSA9IG8gPSAwLCByZWYgPSBfcG9zLmxlbmd0aCAtIDE7IDAgPD0gcmVmID8gbyA8PSByZWYgOiBvID49IHJlZjsgaSA9IDAgPD0gcmVmID8gKytvIDogLS1vKSB7CiAgICAgICAgICAgIHAgPSBfcG9zW2ldOwogICAgICAgICAgICBpZiAodCA8PSBwKSB7CiAgICAgICAgICAgICAgY29sID0gX2NvbG9yc1tpXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodCA+PSBwICYmIGkgPT09IF9wb3MubGVuZ3RoIC0gMSkgewogICAgICAgICAgICAgIGNvbCA9IF9jb2xvcnNbaV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHQgPiBwICYmIHQgPCBfcG9zW2kgKyAxXSkgewogICAgICAgICAgICAgIHQgPSAodCAtIHApIC8gKF9wb3NbaSArIDFdIC0gcCk7CiAgICAgICAgICAgICAgY29sID0gY2hyb21hLmludGVycG9sYXRlKF9jb2xvcnNbaV0sIF9jb2xvcnNbaSArIDFdLCB0LCBfbW9kZSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKHR5cGUoX2NvbG9ycykgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgIGNvbCA9IF9jb2xvcnModCk7CiAgICAgICAgfQogICAgICAgIF9jb2xvckNhY2hlW2tdID0gY29sOwogICAgICB9CiAgICAgIHJldHVybiBjb2w7CiAgICB9OwogICAgcmVzZXRDYWNoZSA9IGZ1bmN0aW9uKCkgewogICAgICByZXR1cm4gX2NvbG9yQ2FjaGUgPSB7fTsKICAgIH07CiAgICBzZXRDb2xvcnMoY29sb3JzLCBwb3NpdGlvbnMpOwogICAgZiA9IGZ1bmN0aW9uKHYpIHsKICAgICAgdmFyIGM7CiAgICAgIGMgPSBnZXRDb2xvcih2KTsKICAgICAgaWYgKF9vdXQgJiYgY1tfb3V0XSkgewogICAgICAgIHJldHVybiBjW19vdXRdKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcmV0dXJuIGM7CiAgICAgIH0KICAgIH07CiAgICBmLmRvbWFpbiA9IGZ1bmN0aW9uKGRvbWFpbiwgY2xhc3NlcywgbW9kZSwga2V5KSB7CiAgICAgIHZhciBkOwogICAgICBpZiAobW9kZSA9PSBudWxsKSB7CiAgICAgICAgbW9kZSA9ICdlJzsKICAgICAgfQogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gX2RvbWFpbjsKICAgICAgfQogICAgICBpZiAoY2xhc3NlcyAhPSBudWxsKSB7CiAgICAgICAgZCA9IGNocm9tYS5hbmFseXplKGRvbWFpbiwga2V5KTsKICAgICAgICBpZiAoY2xhc3NlcyA9PT0gMCkgewogICAgICAgICAgZG9tYWluID0gW2QubWluLCBkLm1heF07CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRvbWFpbiA9IGNocm9tYS5saW1pdHMoZCwgbW9kZSwgY2xhc3Nlcyk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHNldERvbWFpbihkb21haW4pOwogICAgICByZXR1cm4gZjsKICAgIH07CiAgICBmLm1vZGUgPSBmdW5jdGlvbihfbSkgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gX21vZGU7CiAgICAgIH0KICAgICAgX21vZGUgPSBfbTsKICAgICAgcmVzZXRDYWNoZSgpOwogICAgICByZXR1cm4gZjsKICAgIH07CiAgICBmLnJhbmdlID0gZnVuY3Rpb24oY29sb3JzLCBfcG9zKSB7CiAgICAgIHNldENvbG9ycyhjb2xvcnMsIF9wb3MpOwogICAgICByZXR1cm4gZjsKICAgIH07CiAgICBmLm91dCA9IGZ1bmN0aW9uKF9vKSB7CiAgICAgIF9vdXQgPSBfbzsKICAgICAgcmV0dXJuIGY7CiAgICB9OwogICAgZi5zcHJlYWQgPSBmdW5jdGlvbih2YWwpIHsKICAgICAgaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIF9zcHJlYWQ7CiAgICAgIH0KICAgICAgX3NwcmVhZCA9IHZhbDsKICAgICAgcmV0dXJuIGY7CiAgICB9OwogICAgZi5jb3JyZWN0TGlnaHRuZXNzID0gZnVuY3Rpb24odikgewogICAgICBpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsKICAgICAgICByZXR1cm4gX2NvcnJlY3RMaWdodG5lc3M7CiAgICAgIH0KICAgICAgX2NvcnJlY3RMaWdodG5lc3MgPSB2OwogICAgICByZXNldENhY2hlKCk7CiAgICAgIGlmIChfY29ycmVjdExpZ2h0bmVzcykgewogICAgICAgIHRtYXAgPSBmdW5jdGlvbih0KSB7CiAgICAgICAgICB2YXIgTDAsIEwxLCBMX2FjdHVhbCwgTF9kaWZmLCBMX2lkZWFsLCBtYXhfaXRlciwgcG9sLCB0MCwgdDE7CiAgICAgICAgICBMMCA9IGdldENvbG9yKDAsIHRydWUpLmxhYigpWzBdOwogICAgICAgICAgTDEgPSBnZXRDb2xvcigxLCB0cnVlKS5sYWIoKVswXTsKICAgICAgICAgIHBvbCA9IEwwID4gTDE7CiAgICAgICAgICBMX2FjdHVhbCA9IGdldENvbG9yKHQsIHRydWUpLmxhYigpWzBdOwogICAgICAgICAgTF9pZGVhbCA9IEwwICsgKEwxIC0gTDApICogdDsKICAgICAgICAgIExfZGlmZiA9IExfYWN0dWFsIC0gTF9pZGVhbDsKICAgICAgICAgIHQwID0gMDsKICAgICAgICAgIHQxID0gMTsKICAgICAgICAgIG1heF9pdGVyID0gMjA7CiAgICAgICAgICB3aGlsZSAoTWF0aC5hYnMoTF9kaWZmKSA+IDFlLTIgJiYgbWF4X2l0ZXItLSA+IDApIHsKICAgICAgICAgICAgKGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgIGlmIChwb2wpIHsKICAgICAgICAgICAgICAgIExfZGlmZiAqPSAtMTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKExfZGlmZiA8IDApIHsKICAgICAgICAgICAgICAgIHQwID0gdDsKICAgICAgICAgICAgICAgIHQgKz0gKHQxIC0gdCkgKiAwLjU7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHQxID0gdDsKICAgICAgICAgICAgICAgIHQgKz0gKHQwIC0gdCkgKiAwLjU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIExfYWN0dWFsID0gZ2V0Q29sb3IodCwgdHJ1ZSkubGFiKClbMF07CiAgICAgICAgICAgICAgcmV0dXJuIExfZGlmZiA9IExfYWN0dWFsIC0gTF9pZGVhbDsKICAgICAgICAgICAgfSkoKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdG1hcCA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICAgIHJldHVybiB0OwogICAgICAgIH07CiAgICAgIH0KICAgICAgcmV0dXJuIGY7CiAgICB9OwogICAgZi5jb2xvcnMgPSBmdW5jdGlvbihvdXQpIHsKICAgICAgdmFyIGksIGxlbiwgbywgcmVmLCBzYW1wbGVzLCB3OwogICAgICBpZiAob3V0ID09IG51bGwpIHsKICAgICAgICBvdXQgPSAnaGV4JzsKICAgICAgfQogICAgICBjb2xvcnMgPSBbXTsKICAgICAgc2FtcGxlcyA9IFtdOwogICAgICBpZiAoX2RvbWFpbi5sZW5ndGggPiAyKSB7CiAgICAgICAgZm9yIChpID0gbyA9IDEsIHJlZiA9IF9kb21haW4ubGVuZ3RoOyAxIDw9IHJlZiA/IG8gPCByZWYgOiBvID4gcmVmOyBpID0gMSA8PSByZWYgPyArK28gOiAtLW8pIHsKICAgICAgICAgIHNhbXBsZXMucHVzaCgoX2RvbWFpbltpIC0gMV0gKyBfZG9tYWluW2ldKSAqIDAuNSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHNhbXBsZXMgPSBfZG9tYWluOwogICAgICB9CiAgICAgIGZvciAodyA9IDAsIGxlbiA9IHNhbXBsZXMubGVuZ3RoOyB3IDwgbGVuOyB3KyspIHsKICAgICAgICBpID0gc2FtcGxlc1t3XTsKICAgICAgICBjb2xvcnMucHVzaChmKGkpW291dF0oKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGNvbG9yczsKICAgIH07CiAgICByZXR1cm4gZjsKICB9OwoKICBpZiAoY2hyb21hLnNjYWxlcyA9PSBudWxsKSB7CiAgICBjaHJvbWEuc2NhbGVzID0ge307CiAgfQoKICBjaHJvbWEuc2NhbGVzLmNvb2wgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBjaHJvbWEuc2NhbGUoW2Nocm9tYS5oc2woMTgwLCAxLCAuOSksIGNocm9tYS5oc2woMjUwLCAuNywgLjQpXSk7CiAgfTsKCiAgY2hyb21hLnNjYWxlcy5ob3QgPSBmdW5jdGlvbigpIHsKICAgIHJldHVybiBjaHJvbWEuc2NhbGUoWycjMDAwJywgJyNmMDAnLCAnI2ZmMCcsICcjZmZmJ10sIFswLCAuMjUsIC43NSwgMV0pLm1vZGUoJ3JnYicpOwogIH07CgoKICAvKgogICAgICBjaHJvbWEuanMKICAKICAgICAgQ29weXJpZ2h0IChjKSAyMDExLTIwMTMsIEdyZWdvciBBaXNjaAogICAgICBBbGwgcmlnaHRzIHJlc2VydmVkLgogIAogICAgICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICAgICAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAgCiAgICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzCiAgICAgICAgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgCiAgICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogICAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KICAgICAgICBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICAKICAgICAgKiBUaGUgbmFtZSBHcmVnb3IgQWlzY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cwogICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogIAogICAgICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICAgICAgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogICAgICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUKICAgICAgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgR1JFR09SIEFJU0NIIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsCiAgICAgIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLAogICAgICBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLAogICAgICBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZCiAgICAgIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HCiAgICAgIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwKICAgICAgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICAKICAgICAgQHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2drYS9jaHJvbWEuanMKICAgKi8KCiAgY2hyb21hLmFuYWx5emUgPSBmdW5jdGlvbihkYXRhLCBrZXksIGZpbHRlcikgewogICAgdmFyIGFkZCwgaywgbGVuLCBvLCByLCB2YWwsIHZpc2l0OwogICAgciA9IHsKICAgICAgbWluOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICBtYXg6IE51bWJlci5NQVhfVkFMVUUgKiAtMSwKICAgICAgc3VtOiAwLAogICAgICB2YWx1ZXM6IFtdLAogICAgICBjb3VudDogMAogICAgfTsKICAgIGlmIChmaWx0ZXIgPT0gbnVsbCkgewogICAgICBmaWx0ZXIgPSBmdW5jdGlvbigpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfTsKICAgIH0KICAgIGFkZCA9IGZ1bmN0aW9uKHZhbCkgewogICAgICBpZiAoKHZhbCAhPSBudWxsKSAmJiAhaXNOYU4odmFsKSkgewogICAgICAgIHIudmFsdWVzLnB1c2godmFsKTsKICAgICAgICByLnN1bSArPSB2YWw7CiAgICAgICAgaWYgKHZhbCA8IHIubWluKSB7CiAgICAgICAgICByLm1pbiA9IHZhbDsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbCA+IHIubWF4KSB7CiAgICAgICAgICByLm1heCA9IHZhbDsKICAgICAgICB9CiAgICAgICAgci5jb3VudCArPSAxOwogICAgICB9CiAgICB9OwogICAgdmlzaXQgPSBmdW5jdGlvbih2YWwsIGspIHsKICAgICAgaWYgKGZpbHRlcih2YWwsIGspKSB7CiAgICAgICAgaWYgKChrZXkgIT0gbnVsbCkgJiYgdHlwZShrZXkpID09PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgICByZXR1cm4gYWRkKGtleSh2YWwpKTsKICAgICAgICB9IGVsc2UgaWYgKChrZXkgIT0gbnVsbCkgJiYgdHlwZShrZXkpID09PSAnc3RyaW5nJyB8fCB0eXBlKGtleSkgPT09ICdudW1iZXInKSB7CiAgICAgICAgICByZXR1cm4gYWRkKHZhbFtrZXldKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIGFkZCh2YWwpOwogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGlmICh0eXBlKGRhdGEpID09PSAnYXJyYXknKSB7CiAgICAgIGZvciAobyA9IDAsIGxlbiA9IGRhdGEubGVuZ3RoOyBvIDwgbGVuOyBvKyspIHsKICAgICAgICB2YWwgPSBkYXRhW29dOwogICAgICAgIHZpc2l0KHZhbCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoayBpbiBkYXRhKSB7CiAgICAgICAgdmFsID0gZGF0YVtrXTsKICAgICAgICB2aXNpdCh2YWwsIGspOwogICAgICB9CiAgICB9CiAgICByLmRvbWFpbiA9IFtyLm1pbiwgci5tYXhdOwogICAgci5saW1pdHMgPSBmdW5jdGlvbihtb2RlLCBudW0pIHsKICAgICAgcmV0dXJuIGNocm9tYS5saW1pdHMociwgbW9kZSwgbnVtKTsKICAgIH07CiAgICByZXR1cm4gcjsKICB9OwoKICBjaHJvbWEubGltaXRzID0gZnVuY3Rpb24oZGF0YSwgbW9kZSwgbnVtKSB7CiAgICB2YXIgYWEsIGFiLCBhYywgYWQsIGFlLCBhZiwgYWcsIGFoLCBhaSwgYWosIGFrLCBhbCwgYW0sIGFzc2lnbm1lbnRzLCBiZXN0LCBjZW50cm9pZHMsIGNsdXN0ZXIsIGNsdXN0ZXJTaXplcywgZGlzdCwgaSwgaiwga0NsdXN0ZXJzLCBsaW1pdHMsIG1heCwgbWF4X2xvZywgbWluLCBtaW5fbG9nLCBtaW5kaXN0LCBuLCBuYl9pdGVycywgbmV3Q2VudHJvaWRzLCBvLCBwLCBwYiwgcHIsIHJlZiwgcmVmMSwgcmVmMTAsIHJlZjExLCByZWYxMiwgcmVmMTMsIHJlZjE0LCByZWYyLCByZWYzLCByZWY0LCByZWY1LCByZWY2LCByZWY3LCByZWY4LCByZWY5LCByZXBlYXQsIHN1bSwgdG1wS01lYW5zQnJlYWtzLCB2YWx1ZSwgdmFsdWVzLCB3OwogICAgaWYgKG1vZGUgPT0gbnVsbCkgewogICAgICBtb2RlID0gJ2VxdWFsJzsKICAgIH0KICAgIGlmIChudW0gPT0gbnVsbCkgewogICAgICBudW0gPSA3OwogICAgfQogICAgaWYgKHR5cGUoZGF0YSkgPT09ICdhcnJheScpIHsKICAgICAgZGF0YSA9IGNocm9tYS5hbmFseXplKGRhdGEpOwogICAgfQogICAgbWluID0gZGF0YS5taW47CiAgICBtYXggPSBkYXRhLm1heDsKICAgIHN1bSA9IGRhdGEuc3VtOwogICAgdmFsdWVzID0gZGF0YS52YWx1ZXMuc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgIHJldHVybiBhIC0gYjsKICAgIH0pOwogICAgbGltaXRzID0gW107CiAgICBpZiAobW9kZS5zdWJzdHIoMCwgMSkgPT09ICdjJykgewogICAgICBsaW1pdHMucHVzaChtaW4pOwogICAgICBsaW1pdHMucHVzaChtYXgpOwogICAgfQogICAgaWYgKG1vZGUuc3Vic3RyKDAsIDEpID09PSAnZScpIHsKICAgICAgbGltaXRzLnB1c2gobWluKTsKICAgICAgZm9yIChpID0gbyA9IDEsIHJlZiA9IG51bSAtIDE7IDEgPD0gcmVmID8gbyA8PSByZWYgOiBvID49IHJlZjsgaSA9IDEgPD0gcmVmID8gKytvIDogLS1vKSB7CiAgICAgICAgbGltaXRzLnB1c2gobWluICsgKGkgLyBudW0pICogKG1heCAtIG1pbikpOwogICAgICB9CiAgICAgIGxpbWl0cy5wdXNoKG1heCk7CiAgICB9IGVsc2UgaWYgKG1vZGUuc3Vic3RyKDAsIDEpID09PSAnbCcpIHsKICAgICAgaWYgKG1pbiA8PSAwKSB7CiAgICAgICAgdGhyb3cgJ0xvZ2FyaXRobWljIHNjYWxlcyBhcmUgb25seSBwb3NzaWJsZSBmb3IgdmFsdWVzID4gMCc7CiAgICAgIH0KICAgICAgbWluX2xvZyA9IE1hdGguTE9HMTBFICogbG9nKG1pbik7CiAgICAgIG1heF9sb2cgPSBNYXRoLkxPRzEwRSAqIGxvZyhtYXgpOwogICAgICBsaW1pdHMucHVzaChtaW4pOwogICAgICBmb3IgKGkgPSB3ID0gMSwgcmVmMSA9IG51bSAtIDE7IDEgPD0gcmVmMSA/IHcgPD0gcmVmMSA6IHcgPj0gcmVmMTsgaSA9IDEgPD0gcmVmMSA/ICsrdyA6IC0tdykgewogICAgICAgIGxpbWl0cy5wdXNoKHBvdygxMCwgbWluX2xvZyArIChpIC8gbnVtKSAqIChtYXhfbG9nIC0gbWluX2xvZykpKTsKICAgICAgfQogICAgICBsaW1pdHMucHVzaChtYXgpOwogICAgfSBlbHNlIGlmIChtb2RlLnN1YnN0cigwLCAxKSA9PT0gJ3EnKSB7CiAgICAgIGxpbWl0cy5wdXNoKG1pbik7CiAgICAgIGZvciAoaSA9IGFhID0gMSwgcmVmMiA9IG51bSAtIDE7IDEgPD0gcmVmMiA/IGFhIDw9IHJlZjIgOiBhYSA+PSByZWYyOyBpID0gMSA8PSByZWYyID8gKythYSA6IC0tYWEpIHsKICAgICAgICBwID0gdmFsdWVzLmxlbmd0aCAqIGkgLyBudW07CiAgICAgICAgcGIgPSBmbG9vcihwKTsKICAgICAgICBpZiAocGIgPT09IHApIHsKICAgICAgICAgIGxpbWl0cy5wdXNoKHZhbHVlc1twYl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwciA9IHAgLSBwYjsKICAgICAgICAgIGxpbWl0cy5wdXNoKHZhbHVlc1twYl0gKiBwciArIHZhbHVlc1twYiArIDFdICogKDEgLSBwcikpOwogICAgICAgIH0KICAgICAgfQogICAgICBsaW1pdHMucHVzaChtYXgpOwogICAgfSBlbHNlIGlmIChtb2RlLnN1YnN0cigwLCAxKSA9PT0gJ2snKSB7CgogICAgICAvKgogICAgICBpbXBsZW1lbnRhdGlvbiBiYXNlZCBvbgogICAgICBodHRwOi8vY29kZS5nb29nbGUuY29tL3AvZmlndWUvc291cmNlL2Jyb3dzZS90cnVuay9maWd1ZS5qcyMzMzYKICAgICAgc2ltcGxpZmllZCBmb3IgMS1kIGlucHV0IHZhbHVlcwogICAgICAgKi8KICAgICAgbiA9IHZhbHVlcy5sZW5ndGg7CiAgICAgIGFzc2lnbm1lbnRzID0gbmV3IEFycmF5KG4pOwogICAgICBjbHVzdGVyU2l6ZXMgPSBuZXcgQXJyYXkobnVtKTsKICAgICAgcmVwZWF0ID0gdHJ1ZTsKICAgICAgbmJfaXRlcnMgPSAwOwogICAgICBjZW50cm9pZHMgPSBudWxsOwogICAgICBjZW50cm9pZHMgPSBbXTsKICAgICAgY2VudHJvaWRzLnB1c2gobWluKTsKICAgICAgZm9yIChpID0gYWIgPSAxLCByZWYzID0gbnVtIC0gMTsgMSA8PSByZWYzID8gYWIgPD0gcmVmMyA6IGFiID49IHJlZjM7IGkgPSAxIDw9IHJlZjMgPyArK2FiIDogLS1hYikgewogICAgICAgIGNlbnRyb2lkcy5wdXNoKG1pbiArIChpIC8gbnVtKSAqIChtYXggLSBtaW4pKTsKICAgICAgfQogICAgICBjZW50cm9pZHMucHVzaChtYXgpOwogICAgICB3aGlsZSAocmVwZWF0KSB7CiAgICAgICAgZm9yIChqID0gYWMgPSAwLCByZWY0ID0gbnVtIC0gMTsgMCA8PSByZWY0ID8gYWMgPD0gcmVmNCA6IGFjID49IHJlZjQ7IGogPSAwIDw9IHJlZjQgPyArK2FjIDogLS1hYykgewogICAgICAgICAgY2x1c3RlclNpemVzW2pdID0gMDsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gYWQgPSAwLCByZWY1ID0gbiAtIDE7IDAgPD0gcmVmNSA/IGFkIDw9IHJlZjUgOiBhZCA+PSByZWY1OyBpID0gMCA8PSByZWY1ID8gKythZCA6IC0tYWQpIHsKICAgICAgICAgIHZhbHVlID0gdmFsdWVzW2ldOwogICAgICAgICAgbWluZGlzdCA9IE51bWJlci5NQVhfVkFMVUU7CiAgICAgICAgICBmb3IgKGogPSBhZSA9IDAsIHJlZjYgPSBudW0gLSAxOyAwIDw9IHJlZjYgPyBhZSA8PSByZWY2IDogYWUgPj0gcmVmNjsgaiA9IDAgPD0gcmVmNiA/ICsrYWUgOiAtLWFlKSB7CiAgICAgICAgICAgIGRpc3QgPSBhYnMoY2VudHJvaWRzW2pdIC0gdmFsdWUpOwogICAgICAgICAgICBpZiAoZGlzdCA8IG1pbmRpc3QpIHsKICAgICAgICAgICAgICBtaW5kaXN0ID0gZGlzdDsKICAgICAgICAgICAgICBiZXN0ID0gajsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY2x1c3RlclNpemVzW2Jlc3RdKys7CiAgICAgICAgICBhc3NpZ25tZW50c1tpXSA9IGJlc3Q7CiAgICAgICAgfQogICAgICAgIG5ld0NlbnRyb2lkcyA9IG5ldyBBcnJheShudW0pOwogICAgICAgIGZvciAoaiA9IGFmID0gMCwgcmVmNyA9IG51bSAtIDE7IDAgPD0gcmVmNyA/IGFmIDw9IHJlZjcgOiBhZiA+PSByZWY3OyBqID0gMCA8PSByZWY3ID8gKythZiA6IC0tYWYpIHsKICAgICAgICAgIG5ld0NlbnRyb2lkc1tqXSA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IGFnID0gMCwgcmVmOCA9IG4gLSAxOyAwIDw9IHJlZjggPyBhZyA8PSByZWY4IDogYWcgPj0gcmVmODsgaSA9IDAgPD0gcmVmOCA/ICsrYWcgOiAtLWFnKSB7CiAgICAgICAgICBjbHVzdGVyID0gYXNzaWdubWVudHNbaV07CiAgICAgICAgICBpZiAobmV3Q2VudHJvaWRzW2NsdXN0ZXJdID09PSBudWxsKSB7CiAgICAgICAgICAgIG5ld0NlbnRyb2lkc1tjbHVzdGVyXSA9IHZhbHVlc1tpXTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld0NlbnRyb2lkc1tjbHVzdGVyXSArPSB2YWx1ZXNbaV07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoaiA9IGFoID0gMCwgcmVmOSA9IG51bSAtIDE7IDAgPD0gcmVmOSA/IGFoIDw9IHJlZjkgOiBhaCA+PSByZWY5OyBqID0gMCA8PSByZWY5ID8gKythaCA6IC0tYWgpIHsKICAgICAgICAgIG5ld0NlbnRyb2lkc1tqXSAqPSAxIC8gY2x1c3RlclNpemVzW2pdOwogICAgICAgIH0KICAgICAgICByZXBlYXQgPSBmYWxzZTsKICAgICAgICBmb3IgKGogPSBhaSA9IDAsIHJlZjEwID0gbnVtIC0gMTsgMCA8PSByZWYxMCA/IGFpIDw9IHJlZjEwIDogYWkgPj0gcmVmMTA7IGogPSAwIDw9IHJlZjEwID8gKythaSA6IC0tYWkpIHsKICAgICAgICAgIGlmIChuZXdDZW50cm9pZHNbal0gIT09IGNlbnRyb2lkc1tpXSkgewogICAgICAgICAgICByZXBlYXQgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY2VudHJvaWRzID0gbmV3Q2VudHJvaWRzOwogICAgICAgIG5iX2l0ZXJzKys7CiAgICAgICAgaWYgKG5iX2l0ZXJzID4gMjAwKSB7CiAgICAgICAgICByZXBlYXQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0KICAgICAga0NsdXN0ZXJzID0ge307CiAgICAgIGZvciAoaiA9IGFqID0gMCwgcmVmMTEgPSBudW0gLSAxOyAwIDw9IHJlZjExID8gYWogPD0gcmVmMTEgOiBhaiA+PSByZWYxMTsgaiA9IDAgPD0gcmVmMTEgPyArK2FqIDogLS1haikgewogICAgICAgIGtDbHVzdGVyc1tqXSA9IFtdOwogICAgICB9CiAgICAgIGZvciAoaSA9IGFrID0gMCwgcmVmMTIgPSBuIC0gMTsgMCA8PSByZWYxMiA/IGFrIDw9IHJlZjEyIDogYWsgPj0gcmVmMTI7IGkgPSAwIDw9IHJlZjEyID8gKythayA6IC0tYWspIHsKICAgICAgICBjbHVzdGVyID0gYXNzaWdubWVudHNbaV07CiAgICAgICAga0NsdXN0ZXJzW2NsdXN0ZXJdLnB1c2godmFsdWVzW2ldKTsKICAgICAgfQogICAgICB0bXBLTWVhbnNCcmVha3MgPSBbXTsKICAgICAgZm9yIChqID0gYWwgPSAwLCByZWYxMyA9IG51bSAtIDE7IDAgPD0gcmVmMTMgPyBhbCA8PSByZWYxMyA6IGFsID49IHJlZjEzOyBqID0gMCA8PSByZWYxMyA/ICsrYWwgOiAtLWFsKSB7CiAgICAgICAgdG1wS01lYW5zQnJlYWtzLnB1c2goa0NsdXN0ZXJzW2pdWzBdKTsKICAgICAgICB0bXBLTWVhbnNCcmVha3MucHVzaChrQ2x1c3RlcnNbal1ba0NsdXN0ZXJzW2pdLmxlbmd0aCAtIDFdKTsKICAgICAgfQogICAgICB0bXBLTWVhbnNCcmVha3MgPSB0bXBLTWVhbnNCcmVha3Muc29ydChmdW5jdGlvbihhLCBiKSB7CiAgICAgICAgcmV0dXJuIGEgLSBiOwogICAgICB9KTsKICAgICAgbGltaXRzLnB1c2godG1wS01lYW5zQnJlYWtzWzBdKTsKICAgICAgZm9yIChpID0gYW0gPSAxLCByZWYxNCA9IHRtcEtNZWFuc0JyZWFrcy5sZW5ndGggLSAxOyBhbSA8PSByZWYxNDsgaSA9IGFtICs9IDIpIHsKICAgICAgICBpZiAoIWlzTmFOKHRtcEtNZWFuc0JyZWFrc1tpXSkpIHsKICAgICAgICAgIGxpbWl0cy5wdXNoKHRtcEtNZWFuc0JyZWFrc1tpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gbGltaXRzOwogIH07CgoKICAvKioKICAJQ29sb3JCcmV3ZXIgY29sb3JzIGZvciBjaHJvbWEuanMKICAKICAJQ29weXJpZ2h0IChjKSAyMDAyIEN5bnRoaWEgQnJld2VyLCBNYXJrIEhhcnJvd2VyLCBhbmQgVGhlIAogIAlQZW5uc3lsdmFuaWEgU3RhdGUgVW5pdmVyc2l0eS4KICAKICAJTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlICJMaWNlbnNlIik7IAogIAl5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiAgCVlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdAkKICAJaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiAgCiAgCVVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmUgZGlzdHJpYnV0ZWQKICAJdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SCiAgCUNPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlCiAgCXNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiAgCiAgICAgIEBwcmVzZXJ2ZQogICAqLwoKICBjaHJvbWEuYnJld2VyID0gYnJld2VyID0gewogICAgT3JSZDogWycjZmZmN2VjJywgJyNmZWU4YzgnLCAnI2ZkZDQ5ZScsICcjZmRiYjg0JywgJyNmYzhkNTknLCAnI2VmNjU0OCcsICcjZDczMDFmJywgJyNiMzAwMDAnLCAnIzdmMDAwMCddLAogICAgUHVCdTogWycjZmZmN2ZiJywgJyNlY2U3ZjInLCAnI2QwZDFlNicsICcjYTZiZGRiJywgJyM3NGE5Y2YnLCAnIzM2OTBjMCcsICcjMDU3MGIwJywgJyMwNDVhOGQnLCAnIzAyMzg1OCddLAogICAgQnVQdTogWycjZjdmY2ZkJywgJyNlMGVjZjQnLCAnI2JmZDNlNicsICcjOWViY2RhJywgJyM4Yzk2YzYnLCAnIzhjNmJiMScsICcjODg0MTlkJywgJyM4MTBmN2MnLCAnIzRkMDA0YiddLAogICAgT3JhbmdlczogWycjZmZmNWViJywgJyNmZWU2Y2UnLCAnI2ZkZDBhMicsICcjZmRhZTZiJywgJyNmZDhkM2MnLCAnI2YxNjkxMycsICcjZDk0ODAxJywgJyNhNjM2MDMnLCAnIzdmMjcwNCddLAogICAgQnVHbjogWycjZjdmY2ZkJywgJyNlNWY1ZjknLCAnI2NjZWNlNicsICcjOTlkOGM5JywgJyM2NmMyYTQnLCAnIzQxYWU3NicsICcjMjM4YjQ1JywgJyMwMDZkMmMnLCAnIzAwNDQxYiddLAogICAgWWxPckJyOiBbJyNmZmZmZTUnLCAnI2ZmZjdiYycsICcjZmVlMzkxJywgJyNmZWM0NGYnLCAnI2ZlOTkyOScsICcjZWM3MDE0JywgJyNjYzRjMDInLCAnIzk5MzQwNCcsICcjNjYyNTA2J10sCiAgICBZbEduOiBbJyNmZmZmZTUnLCAnI2Y3ZmNiOScsICcjZDlmMGEzJywgJyNhZGRkOGUnLCAnIzc4YzY3OScsICcjNDFhYjVkJywgJyMyMzg0NDMnLCAnIzAwNjgzNycsICcjMDA0NTI5J10sCiAgICBSZWRzOiBbJyNmZmY1ZjAnLCAnI2ZlZTBkMicsICcjZmNiYmExJywgJyNmYzkyNzInLCAnI2ZiNmE0YScsICcjZWYzYjJjJywgJyNjYjE4MWQnLCAnI2E1MGYxNScsICcjNjcwMDBkJ10sCiAgICBSZFB1OiBbJyNmZmY3ZjMnLCAnI2ZkZTBkZCcsICcjZmNjNWMwJywgJyNmYTlmYjUnLCAnI2Y3NjhhMScsICcjZGQzNDk3JywgJyNhZTAxN2UnLCAnIzdhMDE3NycsICcjNDkwMDZhJ10sCiAgICBHcmVlbnM6IFsnI2Y3ZmNmNScsICcjZTVmNWUwJywgJyNjN2U5YzAnLCAnI2ExZDk5YicsICcjNzRjNDc2JywgJyM0MWFiNWQnLCAnIzIzOGI0NScsICcjMDA2ZDJjJywgJyMwMDQ0MWInXSwKICAgIFlsR25CdTogWycjZmZmZmQ5JywgJyNlZGY4YjEnLCAnI2M3ZTliNCcsICcjN2ZjZGJiJywgJyM0MWI2YzQnLCAnIzFkOTFjMCcsICcjMjI1ZWE4JywgJyMyNTM0OTQnLCAnIzA4MWQ1OCddLAogICAgUHVycGxlczogWycjZmNmYmZkJywgJyNlZmVkZjUnLCAnI2RhZGFlYicsICcjYmNiZGRjJywgJyM5ZTlhYzgnLCAnIzgwN2RiYScsICcjNmE1MWEzJywgJyM1NDI3OGYnLCAnIzNmMDA3ZCddLAogICAgR25CdTogWycjZjdmY2YwJywgJyNlMGYzZGInLCAnI2NjZWJjNScsICcjYThkZGI1JywgJyM3YmNjYzQnLCAnIzRlYjNkMycsICcjMmI4Y2JlJywgJyMwODY4YWMnLCAnIzA4NDA4MSddLAogICAgR3JleXM6IFsnI2ZmZmZmZicsICcjZjBmMGYwJywgJyNkOWQ5ZDknLCAnI2JkYmRiZCcsICcjOTY5Njk2JywgJyM3MzczNzMnLCAnIzUyNTI1MicsICcjMjUyNTI1JywgJyMwMDAwMDAnXSwKICAgIFlsT3JSZDogWycjZmZmZmNjJywgJyNmZmVkYTAnLCAnI2ZlZDk3NicsICcjZmViMjRjJywgJyNmZDhkM2MnLCAnI2ZjNGUyYScsICcjZTMxYTFjJywgJyNiZDAwMjYnLCAnIzgwMDAyNiddLAogICAgUHVSZDogWycjZjdmNGY5JywgJyNlN2UxZWYnLCAnI2Q0YjlkYScsICcjYzk5NGM3JywgJyNkZjY1YjAnLCAnI2U3Mjk4YScsICcjY2UxMjU2JywgJyM5ODAwNDMnLCAnIzY3MDAxZiddLAogICAgQmx1ZXM6IFsnI2Y3ZmJmZicsICcjZGVlYmY3JywgJyNjNmRiZWYnLCAnIzllY2FlMScsICcjNmJhZWQ2JywgJyM0MjkyYzYnLCAnIzIxNzFiNScsICcjMDg1MTljJywgJyMwODMwNmInXSwKICAgIFB1QnVHbjogWycjZmZmN2ZiJywgJyNlY2UyZjAnLCAnI2QwZDFlNicsICcjYTZiZGRiJywgJyM2N2E5Y2YnLCAnIzM2OTBjMCcsICcjMDI4MThhJywgJyMwMTZjNTknLCAnIzAxNDYzNiddLAogICAgU3BlY3RyYWw6IFsnIzllMDE0MicsICcjZDUzZTRmJywgJyNmNDZkNDMnLCAnI2ZkYWU2MScsICcjZmVlMDhiJywgJyNmZmZmYmYnLCAnI2U2ZjU5OCcsICcjYWJkZGE0JywgJyM2NmMyYTUnLCAnIzMyODhiZCcsICcjNWU0ZmEyJ10sCiAgICBSZFlsR246IFsnI2E1MDAyNicsICcjZDczMDI3JywgJyNmNDZkNDMnLCAnI2ZkYWU2MScsICcjZmVlMDhiJywgJyNmZmZmYmYnLCAnI2Q5ZWY4YicsICcjYTZkOTZhJywgJyM2NmJkNjMnLCAnIzFhOTg1MCcsICcjMDA2ODM3J10sCiAgICBSZEJ1OiBbJyM2NzAwMWYnLCAnI2IyMTgyYicsICcjZDY2MDRkJywgJyNmNGE1ODInLCAnI2ZkZGJjNycsICcjZjdmN2Y3JywgJyNkMWU1ZjAnLCAnIzkyYzVkZScsICcjNDM5M2MzJywgJyMyMTY2YWMnLCAnIzA1MzA2MSddLAogICAgUGlZRzogWycjOGUwMTUyJywgJyNjNTFiN2QnLCAnI2RlNzdhZScsICcjZjFiNmRhJywgJyNmZGUwZWYnLCAnI2Y3ZjdmNycsICcjZTZmNWQwJywgJyNiOGUxODYnLCAnIzdmYmM0MScsICcjNGQ5MjIxJywgJyMyNzY0MTknXSwKICAgIFBSR246IFsnIzQwMDA0YicsICcjNzYyYTgzJywgJyM5OTcwYWInLCAnI2MyYTVjZicsICcjZTdkNGU4JywgJyNmN2Y3ZjcnLCAnI2Q5ZjBkMycsICcjYTZkYmEwJywgJyM1YWFlNjEnLCAnIzFiNzgzNycsICcjMDA0NDFiJ10sCiAgICBSZFlsQnU6IFsnI2E1MDAyNicsICcjZDczMDI3JywgJyNmNDZkNDMnLCAnI2ZkYWU2MScsICcjZmVlMDkwJywgJyNmZmZmYmYnLCAnI2UwZjNmOCcsICcjYWJkOWU5JywgJyM3NGFkZDEnLCAnIzQ1NzViNCcsICcjMzEzNjk1J10sCiAgICBCckJHOiBbJyM1NDMwMDUnLCAnIzhjNTEwYScsICcjYmY4MTJkJywgJyNkZmMyN2QnLCAnI2Y2ZThjMycsICcjZjVmNWY1JywgJyNjN2VhZTUnLCAnIzgwY2RjMScsICcjMzU5NzhmJywgJyMwMTY2NWUnLCAnIzAwM2MzMCddLAogICAgUmRHeTogWycjNjcwMDFmJywgJyNiMjE4MmInLCAnI2Q2NjA0ZCcsICcjZjRhNTgyJywgJyNmZGRiYzcnLCAnI2ZmZmZmZicsICcjZTBlMGUwJywgJyNiYWJhYmEnLCAnIzg3ODc4NycsICcjNGQ0ZDRkJywgJyMxYTFhMWEnXSwKICAgIFB1T3I6IFsnIzdmM2IwOCcsICcjYjM1ODA2JywgJyNlMDgyMTQnLCAnI2ZkYjg2MycsICcjZmVlMGI2JywgJyNmN2Y3ZjcnLCAnI2Q4ZGFlYicsICcjYjJhYmQyJywgJyM4MDczYWMnLCAnIzU0Mjc4OCcsICcjMmQwMDRiJ10sCiAgICBTZXQyOiBbJyM2NmMyYTUnLCAnI2ZjOGQ2MicsICcjOGRhMGNiJywgJyNlNzhhYzMnLCAnI2E2ZDg1NCcsICcjZmZkOTJmJywgJyNlNWM0OTQnLCAnI2IzYjNiMyddLAogICAgQWNjZW50OiBbJyM3ZmM5N2YnLCAnI2JlYWVkNCcsICcjZmRjMDg2JywgJyNmZmZmOTknLCAnIzM4NmNiMCcsICcjZjAwMjdmJywgJyNiZjViMTcnLCAnIzY2NjY2NiddLAogICAgU2V0MTogWycjZTQxYTFjJywgJyMzNzdlYjgnLCAnIzRkYWY0YScsICcjOTg0ZWEzJywgJyNmZjdmMDAnLCAnI2ZmZmYzMycsICcjYTY1NjI4JywgJyNmNzgxYmYnLCAnIzk5OTk5OSddLAogICAgU2V0MzogWycjOGRkM2M3JywgJyNmZmZmYjMnLCAnI2JlYmFkYScsICcjZmI4MDcyJywgJyM4MGIxZDMnLCAnI2ZkYjQ2MicsICcjYjNkZTY5JywgJyNmY2NkZTUnLCAnI2Q5ZDlkOScsICcjYmM4MGJkJywgJyNjY2ViYzUnLCAnI2ZmZWQ2ZiddLAogICAgRGFyazI6IFsnIzFiOWU3NycsICcjZDk1ZjAyJywgJyM3NTcwYjMnLCAnI2U3Mjk4YScsICcjNjZhNjFlJywgJyNlNmFiMDInLCAnI2E2NzYxZCcsICcjNjY2NjY2J10sCiAgICBQYWlyZWQ6IFsnI2E2Y2VlMycsICcjMWY3OGI0JywgJyNiMmRmOGEnLCAnIzMzYTAyYycsICcjZmI5YTk5JywgJyNlMzFhMWMnLCAnI2ZkYmY2ZicsICcjZmY3ZjAwJywgJyNjYWIyZDYnLCAnIzZhM2Q5YScsICcjZmZmZjk5JywgJyNiMTU5MjgnXSwKICAgIFBhc3RlbDI6IFsnI2IzZTJjZCcsICcjZmRjZGFjJywgJyNjYmQ1ZTgnLCAnI2Y0Y2FlNCcsICcjZTZmNWM5JywgJyNmZmYyYWUnLCAnI2YxZTJjYycsICcjY2NjY2NjJ10sCiAgICBQYXN0ZWwxOiBbJyNmYmI0YWUnLCAnI2IzY2RlMycsICcjY2NlYmM1JywgJyNkZWNiZTQnLCAnI2ZlZDlhNicsICcjZmZmZmNjJywgJyNlNWQ4YmQnLCAnI2ZkZGFlYycsICcjZjJmMmYyJ10KICB9OwoKCiAgLyoqCiAgCVgxMSBjb2xvciBuYW1lcwogIAogIAlodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLWNvbG9yLyNzdmctY29sb3IKICAgKi8KCiAgY2hyb21hLmNvbG9ycyA9IGNvbG9ycyA9IHsKICAgIGluZGlnbzogIiM0YjAwODIiLAogICAgZ29sZDogIiNmZmQ3MDAiLAogICAgaG90cGluazogIiNmZjY5YjQiLAogICAgZmlyZWJyaWNrOiAiI2IyMjIyMiIsCiAgICBpbmRpYW5yZWQ6ICIjY2Q1YzVjIiwKICAgIHllbGxvdzogIiNmZmZmMDAiLAogICAgbWlzdHlyb3NlOiAiI2ZmZTRlMSIsCiAgICBkYXJrb2xpdmVncmVlbjogIiM1NTZiMmYiLAogICAgb2xpdmU6ICIjODA4MDAwIiwKICAgIGRhcmtzZWFncmVlbjogIiM4ZmJjOGYiLAogICAgcGluazogIiNmZmMwY2IiLAogICAgdG9tYXRvOiAiI2ZmNjM0NyIsCiAgICBsaWdodGNvcmFsOiAiI2YwODA4MCIsCiAgICBvcmFuZ2VyZWQ6ICIjZmY0NTAwIiwKICAgIG5hdmFqb3doaXRlOiAiI2ZmZGVhZCIsCiAgICBsaW1lOiAiIzAwZmYwMCIsCiAgICBwYWxlZ3JlZW46ICIjOThmYjk4IiwKICAgIGRhcmtzbGF0ZWdyZXk6ICIjMmY0ZjRmIiwKICAgIGdyZWVueWVsbG93OiAiI2FkZmYyZiIsCiAgICBidXJseXdvb2Q6ICIjZGViODg3IiwKICAgIHNlYXNoZWxsOiAiI2ZmZjVlZSIsCiAgICBtZWRpdW1zcHJpbmdncmVlbjogIiMwMGZhOWEiLAogICAgZnVjaHNpYTogIiNmZjAwZmYiLAogICAgcGFwYXlhd2hpcDogIiNmZmVmZDUiLAogICAgYmxhbmNoZWRhbG1vbmQ6ICIjZmZlYmNkIiwKICAgIGNoYXJ0cmV1c2U6ICIjN2ZmZjAwIiwKICAgIGRpbWdyYXk6ICIjNjk2OTY5IiwKICAgIGJsYWNrOiAiIzAwMDAwMCIsCiAgICBwZWFjaHB1ZmY6ICIjZmZkYWI5IiwKICAgIHNwcmluZ2dyZWVuOiAiIzAwZmY3ZiIsCiAgICBhcXVhbWFyaW5lOiAiIzdmZmZkNCIsCiAgICB3aGl0ZTogIiNmZmZmZmYiLAogICAgb3JhbmdlOiAiI2ZmYTUwMCIsCiAgICBsaWdodHNhbG1vbjogIiNmZmEwN2EiLAogICAgZGFya3NsYXRlZ3JheTogIiMyZjRmNGYiLAogICAgYnJvd246ICIjYTUyYTJhIiwKICAgIGl2b3J5OiAiI2ZmZmZmMCIsCiAgICBkb2RnZXJibHVlOiAiIzFlOTBmZiIsCiAgICBwZXJ1OiAiI2NkODUzZiIsCiAgICBsYXduZ3JlZW46ICIjN2NmYzAwIiwKICAgIGNob2NvbGF0ZTogIiNkMjY5MWUiLAogICAgY3JpbXNvbjogIiNkYzE0M2MiLAogICAgZm9yZXN0Z3JlZW46ICIjMjI4YjIyIiwKICAgIGRhcmtncmV5OiAiI2E5YTlhOSIsCiAgICBsaWdodHNlYWdyZWVuOiAiIzIwYjJhYSIsCiAgICBjeWFuOiAiIzAwZmZmZiIsCiAgICBtaW50Y3JlYW06ICIjZjVmZmZhIiwKICAgIHNpbHZlcjogIiNjMGMwYzAiLAogICAgYW50aXF1ZXdoaXRlOiAiI2ZhZWJkNyIsCiAgICBtZWRpdW1vcmNoaWQ6ICIjYmE1NWQzIiwKICAgIHNreWJsdWU6ICIjODdjZWViIiwKICAgIGdyYXk6ICIjODA4MDgwIiwKICAgIGRhcmt0dXJxdW9pc2U6ICIjMDBjZWQxIiwKICAgIGdvbGRlbnJvZDogIiNkYWE1MjAiLAogICAgZGFya2dyZWVuOiAiIzAwNjQwMCIsCiAgICBmbG9yYWx3aGl0ZTogIiNmZmZhZjAiLAogICAgZGFya3Zpb2xldDogIiM5NDAwZDMiLAogICAgZGFya2dyYXk6ICIjYTlhOWE5IiwKICAgIG1vY2Nhc2luOiAiI2ZmZTRiNSIsCiAgICBzYWRkbGVicm93bjogIiM4YjQ1MTMiLAogICAgZ3JleTogIiM4MDgwODAiLAogICAgZGFya3NsYXRlYmx1ZTogIiM0ODNkOGIiLAogICAgbGlnaHRza3libHVlOiAiIzg3Y2VmYSIsCiAgICBsaWdodHBpbms6ICIjZmZiNmMxIiwKICAgIG1lZGl1bXZpb2xldHJlZDogIiNjNzE1ODUiLAogICAgc2xhdGVncmV5OiAiIzcwODA5MCIsCiAgICByZWQ6ICIjZmYwMDAwIiwKICAgIGRlZXBwaW5rOiAiI2ZmMTQ5MyIsCiAgICBsaW1lZ3JlZW46ICIjMzJjZDMyIiwKICAgIGRhcmttYWdlbnRhOiAiIzhiMDA4YiIsCiAgICBwYWxlZ29sZGVucm9kOiAiI2VlZThhYSIsCiAgICBwbHVtOiAiI2RkYTBkZCIsCiAgICB0dXJxdW9pc2U6ICIjNDBlMGQwIiwKICAgIGxpZ2h0Z3JleTogIiNkM2QzZDMiLAogICAgbGlnaHRnb2xkZW5yb2R5ZWxsb3c6ICIjZmFmYWQyIiwKICAgIGRhcmtnb2xkZW5yb2Q6ICIjYjg4NjBiIiwKICAgIGxhdmVuZGVyOiAiI2U2ZTZmYSIsCiAgICBtYXJvb246ICIjODAwMDAwIiwKICAgIHllbGxvd2dyZWVuOiAiIzlhY2QzMiIsCiAgICBzYW5keWJyb3duOiAiI2Y0YTQ2MCIsCiAgICB0aGlzdGxlOiAiI2Q4YmZkOCIsCiAgICB2aW9sZXQ6ICIjZWU4MmVlIiwKICAgIG5hdnk6ICIjMDAwMDgwIiwKICAgIG1hZ2VudGE6ICIjZmYwMGZmIiwKICAgIGRpbWdyZXk6ICIjNjk2OTY5IiwKICAgIHRhbjogIiNkMmI0OGMiLAogICAgcm9zeWJyb3duOiAiI2JjOGY4ZiIsCiAgICBvbGl2ZWRyYWI6ICIjNmI4ZTIzIiwKICAgIGJsdWU6ICIjMDAwMGZmIiwKICAgIGxpZ2h0Ymx1ZTogIiNhZGQ4ZTYiLAogICAgZ2hvc3R3aGl0ZTogIiNmOGY4ZmYiLAogICAgaG9uZXlkZXc6ICIjZjBmZmYwIiwKICAgIGNvcm5mbG93ZXJibHVlOiAiIzY0OTVlZCIsCiAgICBzbGF0ZWJsdWU6ICIjNmE1YWNkIiwKICAgIGxpbmVuOiAiI2ZhZjBlNiIsCiAgICBkYXJrYmx1ZTogIiMwMDAwOGIiLAogICAgcG93ZGVyYmx1ZTogIiNiMGUwZTYiLAogICAgc2VhZ3JlZW46ICIjMmU4YjU3IiwKICAgIGRhcmtraGFraTogIiNiZGI3NmIiLAogICAgc25vdzogIiNmZmZhZmEiLAogICAgc2llbm5hOiAiI2EwNTIyZCIsCiAgICBtZWRpdW1ibHVlOiAiIzAwMDBjZCIsCiAgICByb3lhbGJsdWU6ICIjNDE2OWUxIiwKICAgIGxpZ2h0Y3lhbjogIiNlMGZmZmYiLAogICAgZ3JlZW46ICIjMDA4MDAwIiwKICAgIG1lZGl1bXB1cnBsZTogIiM5MzcwZGIiLAogICAgbWlkbmlnaHRibHVlOiAiIzE5MTk3MCIsCiAgICBjb3Juc2lsazogIiNmZmY4ZGMiLAogICAgcGFsZXR1cnF1b2lzZTogIiNhZmVlZWUiLAogICAgYmlzcXVlOiAiI2ZmZTRjNCIsCiAgICBzbGF0ZWdyYXk6ICIjNzA4MDkwIiwKICAgIGRhcmtjeWFuOiAiIzAwOGI4YiIsCiAgICBraGFraTogIiNmMGU2OGMiLAogICAgd2hlYXQ6ICIjZjVkZWIzIiwKICAgIHRlYWw6ICIjMDA4MDgwIiwKICAgIGRhcmtvcmNoaWQ6ICIjOTkzMmNjIiwKICAgIGRlZXBza3libHVlOiAiIzAwYmZmZiIsCiAgICBzYWxtb246ICIjZmE4MDcyIiwKICAgIGRhcmtyZWQ6ICIjOGIwMDAwIiwKICAgIHN0ZWVsYmx1ZTogIiM0NjgyYjQiLAogICAgcGFsZXZpb2xldHJlZDogIiNkYjcwOTMiLAogICAgbGlnaHRzbGF0ZWdyYXk6ICIjNzc4ODk5IiwKICAgIGFsaWNlYmx1ZTogIiNmMGY4ZmYiLAogICAgbGlnaHRzbGF0ZWdyZXk6ICIjNzc4ODk5IiwKICAgIGxpZ2h0Z3JlZW46ICIjOTBlZTkwIiwKICAgIG9yY2hpZDogIiNkYTcwZDYiLAogICAgZ2FpbnNib3JvOiAiI2RjZGNkYyIsCiAgICBtZWRpdW1zZWFncmVlbjogIiMzY2IzNzEiLAogICAgbGlnaHRncmF5OiAiI2QzZDNkMyIsCiAgICBtZWRpdW10dXJxdW9pc2U6ICIjNDhkMWNjIiwKICAgIGxlbW9uY2hpZmZvbjogIiNmZmZhY2QiLAogICAgY2FkZXRibHVlOiAiIzVmOWVhMCIsCiAgICBsaWdodHllbGxvdzogIiNmZmZmZTAiLAogICAgbGF2ZW5kZXJibHVzaDogIiNmZmYwZjUiLAogICAgY29yYWw6ICIjZmY3ZjUwIiwKICAgIHB1cnBsZTogIiM4MDAwODAiLAogICAgYXF1YTogIiMwMGZmZmYiLAogICAgd2hpdGVzbW9rZTogIiNmNWY1ZjUiLAogICAgbWVkaXVtc2xhdGVibHVlOiAiIzdiNjhlZSIsCiAgICBkYXJrb3JhbmdlOiAiI2ZmOGMwMCIsCiAgICBtZWRpdW1hcXVhbWFyaW5lOiAiIzY2Y2RhYSIsCiAgICBkYXJrc2FsbW9uOiAiI2U5OTY3YSIsCiAgICBiZWlnZTogIiNmNWY1ZGMiLAogICAgYmx1ZXZpb2xldDogIiM4YTJiZTIiLAogICAgYXp1cmU6ICIjZjBmZmZmIiwKICAgIGxpZ2h0c3RlZWxibHVlOiAiI2IwYzRkZSIsCiAgICBvbGRsYWNlOiAiI2ZkZjVlNiIsCiAgICByZWJlY2NhcHVycGxlOiAiIzY2MzM5OSIKICB9OwoKCiAgLyoKICAgICAgY2hyb21hLmpzCiAgCiAgICAgIENvcHlyaWdodCAoYykgMjAxMS0yMDEzLCBHcmVnb3IgQWlzY2gKICAgICAgQWxsIHJpZ2h0cyByZXNlcnZlZC4KICAKICAgICAgUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0CiAgICAgIG1vZGlmaWNhdGlvbiwgYXJlIHBlcm1pdHRlZCBwcm92aWRlZCB0aGF0IHRoZSBmb2xsb3dpbmcgY29uZGl0aW9ucyBhcmUgbWV0OgogIAogICAgICAqIFJlZGlzdHJpYnV0aW9ucyBvZiBzb3VyY2UgY29kZSBtdXN0IHJldGFpbiB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwgdGhpcwogICAgICAgIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyLgogIAogICAgICAqIFJlZGlzdHJpYnV0aW9ucyBpbiBiaW5hcnkgZm9ybSBtdXN0IHJlcHJvZHVjZSB0aGUgYWJvdmUgY29weXJpZ2h0IG5vdGljZSwKICAgICAgICB0aGlzIGxpc3Qgb2YgY29uZGl0aW9ucyBhbmQgdGhlIGZvbGxvd2luZyBkaXNjbGFpbWVyIGluIHRoZSBkb2N1bWVudGF0aW9uCiAgICAgICAgYW5kL29yIG90aGVyIG1hdGVyaWFscyBwcm92aWRlZCB3aXRoIHRoZSBkaXN0cmlidXRpb24uCiAgCiAgICAgICogVGhlIG5hbWUgR3JlZ29yIEFpc2NoIG1heSBub3QgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMKICAgICAgICBkZXJpdmVkIGZyb20gdGhpcyBzb2Z0d2FyZSB3aXRob3V0IHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KICAKICAgICAgVEhJUyBTT0ZUV0FSRSBJUyBQUk9WSURFRCBCWSBUSEUgQ09QWVJJR0hUIEhPTERFUlMgQU5EIENPTlRSSUJVVE9SUyAiQVMgSVMiCiAgICAgIEFORCBBTlkgRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUKICAgICAgSU1QTElFRCBXQVJSQU5USUVTIE9GIE1FUkNIQU5UQUJJTElUWSBBTkQgRklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQVJFCiAgICAgIERJU0NMQUlNRUQuIElOIE5PIEVWRU5UIFNIQUxMIEdSRUdPUiBBSVNDSCBPUiBDT05UUklCVVRPUlMgQkUgTElBQkxFIEZPUiBBTlkgRElSRUNULAogICAgICBJTkRJUkVDVCwgSU5DSURFTlRBTCwgU1BFQ0lBTCwgRVhFTVBMQVJZLCBPUiBDT05TRVFVRU5USUFMIERBTUFHRVMgKElOQ0xVRElORywKICAgICAgQlVUIE5PVCBMSU1JVEVEIFRPLCBQUk9DVVJFTUVOVCBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwKICAgICAgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKSBIT1dFVkVSIENBVVNFRCBBTkQgT04gQU5ZIFRIRU9SWQogICAgICBPRiBMSUFCSUxJVFksIFdIRVRIRVIgSU4gQ09OVFJBQ1QsIFNUUklDVCBMSUFCSUxJVFksIE9SIFRPUlQgKElOQ0xVRElORwogICAgICBORUdMSUdFTkNFIE9SIE9USEVSV0lTRSkgQVJJU0lORyBJTiBBTlkgV0FZIE9VVCBPRiBUSEUgVVNFIE9GIFRISVMgU09GVFdBUkUsCiAgICAgIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCiAgCiAgICAgIEBzb3VyY2U6IGh0dHBzOi8vZ2l0aHViLmNvbS9na2EvY2hyb21hLmpzCiAgICovCgogIHR5cGUgPSAoZnVuY3Rpb24oKSB7CgogICAgLyoKICAgIGZvciBicm93c2VyLXNhZmUgdHlwZSBjaGVja2luZysKICAgIHBvcnRlZCBmcm9tIGpRdWVyeSdzICQudHlwZQogICAgICovCiAgICB2YXIgY2xhc3NUb1R5cGUsIGxlbiwgbmFtZSwgbywgcmVmOwogICAgY2xhc3NUb1R5cGUgPSB7fTsKICAgIHJlZiA9ICJCb29sZWFuIE51bWJlciBTdHJpbmcgRnVuY3Rpb24gQXJyYXkgRGF0ZSBSZWdFeHAgVW5kZWZpbmVkIE51bGwiLnNwbGl0KCIgIik7CiAgICBmb3IgKG8gPSAwLCBsZW4gPSByZWYubGVuZ3RoOyBvIDwgbGVuOyBvKyspIHsKICAgICAgbmFtZSA9IHJlZltvXTsKICAgICAgY2xhc3NUb1R5cGVbIltvYmplY3QgIiArIG5hbWUgKyAiXSJdID0gbmFtZS50b0xvd2VyQ2FzZSgpOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKG9iaikgewogICAgICB2YXIgc3RyVHlwZTsKICAgICAgc3RyVHlwZSA9IE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopOwogICAgICByZXR1cm4gY2xhc3NUb1R5cGVbc3RyVHlwZV0gfHwgIm9iamVjdCI7CiAgICB9OwogIH0pKCk7CgogIGxpbWl0ID0gZnVuY3Rpb24oeCwgbWluLCBtYXgpIHsKICAgIGlmIChtaW4gPT0gbnVsbCkgewogICAgICBtaW4gPSAwOwogICAgfQogICAgaWYgKG1heCA9PSBudWxsKSB7CiAgICAgIG1heCA9IDE7CiAgICB9CiAgICBpZiAoeCA8IG1pbikgewogICAgICB4ID0gbWluOwogICAgfQogICAgaWYgKHggPiBtYXgpIHsKICAgICAgeCA9IG1heDsKICAgIH0KICAgIHJldHVybiB4OwogIH07CgogIHVucGFjayA9IGZ1bmN0aW9uKGFyZ3MpIHsKICAgIGlmIChhcmdzLmxlbmd0aCA+PSAzKSB7CiAgICAgIHJldHVybiBhcmdzOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGFyZ3NbMF07CiAgICB9CiAgfTsKCiAgVFdPUEkgPSBNYXRoLlBJICogMjsKCiAgUElUSElSRCA9IE1hdGguUEkgLyAzOwoKICByb3VuZCA9IE1hdGgucm91bmQsIGNvcyA9IE1hdGguY29zLCBmbG9vciA9IE1hdGguZmxvb3IsIHBvdyA9IE1hdGgucG93LCBsb2cgPSBNYXRoLmxvZywgc2luID0gTWF0aC5zaW47CgoKICAvKgogIGludGVycG9sYXRlcyBiZXR3ZWVuIGEgc2V0IG9mIGNvbG9ycyB1emluZyBhIGJlemllciBzcGxpbmUKICAgKi8KCiAgYmV6aWVyID0gZnVuY3Rpb24oY29sb3JzKSB7CiAgICB2YXIgSSwgSTAsIEkxLCBjLCBsYWIwLCBsYWIxLCBsYWIyLCBsYWIzLCByZWYsIHJlZjEsIHJlZjI7CiAgICBjb2xvcnMgPSAoZnVuY3Rpb24oKSB7CiAgICAgIHZhciBsZW4sIG8sIHJlc3VsdHM7CiAgICAgIHJlc3VsdHMgPSBbXTsKICAgICAgZm9yIChvID0gMCwgbGVuID0gY29sb3JzLmxlbmd0aDsgbyA8IGxlbjsgbysrKSB7CiAgICAgICAgYyA9IGNvbG9yc1tvXTsKICAgICAgICByZXN1bHRzLnB1c2goY2hyb21hKGMpKTsKICAgICAgfQogICAgICByZXR1cm4gcmVzdWx0czsKICAgIH0pKCk7CiAgICBpZiAoY29sb3JzLmxlbmd0aCA9PT0gMikgewogICAgICByZWYgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGxlbiwgbywgcmVzdWx0czsKICAgICAgICByZXN1bHRzID0gW107CiAgICAgICAgZm9yIChvID0gMCwgbGVuID0gY29sb3JzLmxlbmd0aDsgbyA8IGxlbjsgbysrKSB7CiAgICAgICAgICBjID0gY29sb3JzW29dOwogICAgICAgICAgcmVzdWx0cy5wdXNoKGMubGFiKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgfSkoKSwgbGFiMCA9IHJlZlswXSwgbGFiMSA9IHJlZlsxXTsKICAgICAgSSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICB2YXIgaSwgbGFiOwogICAgICAgIGxhYiA9IChmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBvLCByZXN1bHRzOwogICAgICAgICAgcmVzdWx0cyA9IFtdOwogICAgICAgICAgZm9yIChpID0gbyA9IDA7IG8gPD0gMjsgaSA9ICsrbykgewogICAgICAgICAgICByZXN1bHRzLnB1c2gobGFiMFtpXSArIHQgKiAobGFiMVtpXSAtIGxhYjBbaV0pKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiByZXN1bHRzOwogICAgICAgIH0pKCk7CiAgICAgICAgcmV0dXJuIGNocm9tYS5sYWIuYXBwbHkoY2hyb21hLCBsYWIpOwogICAgICB9OwogICAgfSBlbHNlIGlmIChjb2xvcnMubGVuZ3RoID09PSAzKSB7CiAgICAgIHJlZjEgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgdmFyIGxlbiwgbywgcmVzdWx0czsKICAgICAgICByZXN1bHRzID0gW107CiAgICAgICAgZm9yIChvID0gMCwgbGVuID0gY29sb3JzLmxlbmd0aDsgbyA8IGxlbjsgbysrKSB7CiAgICAgICAgICBjID0gY29sb3JzW29dOwogICAgICAgICAgcmVzdWx0cy5wdXNoKGMubGFiKCkpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgfSkoKSwgbGFiMCA9IHJlZjFbMF0sIGxhYjEgPSByZWYxWzFdLCBsYWIyID0gcmVmMVsyXTsKICAgICAgSSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICB2YXIgaSwgbGFiOwogICAgICAgIGxhYiA9IChmdW5jdGlvbigpIHsKICAgICAgICAgIHZhciBvLCByZXN1bHRzOwogICAgICAgICAgcmVzdWx0cyA9IFtdOwogICAgICAgICAgZm9yIChpID0gbyA9IDA7IG8gPD0gMjsgaSA9ICsrbykgewogICAgICAgICAgICByZXN1bHRzLnB1c2goKDEgLSB0KSAqICgxIC0gdCkgKiBsYWIwW2ldICsgMiAqICgxIC0gdCkgKiB0ICogbGFiMVtpXSArIHQgKiB0ICogbGFiMltpXSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gcmVzdWx0czsKICAgICAgICB9KSgpOwogICAgICAgIHJldHVybiBjaHJvbWEubGFiLmFwcGx5KGNocm9tYSwgbGFiKTsKICAgICAgfTsKICAgIH0gZWxzZSBpZiAoY29sb3JzLmxlbmd0aCA9PT0gNCkgewogICAgICByZWYyID0gKGZ1bmN0aW9uKCkgewogICAgICAgIHZhciBsZW4sIG8sIHJlc3VsdHM7CiAgICAgICAgcmVzdWx0cyA9IFtdOwogICAgICAgIGZvciAobyA9IDAsIGxlbiA9IGNvbG9ycy5sZW5ndGg7IG8gPCBsZW47IG8rKykgewogICAgICAgICAgYyA9IGNvbG9yc1tvXTsKICAgICAgICAgIHJlc3VsdHMucHVzaChjLmxhYigpKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgIH0pKCksIGxhYjAgPSByZWYyWzBdLCBsYWIxID0gcmVmMlsxXSwgbGFiMiA9IHJlZjJbMl0sIGxhYjMgPSByZWYyWzNdOwogICAgICBJID0gZnVuY3Rpb24odCkgewogICAgICAgIHZhciBpLCBsYWI7CiAgICAgICAgbGFiID0gKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIG8sIHJlc3VsdHM7CiAgICAgICAgICByZXN1bHRzID0gW107CiAgICAgICAgICBmb3IgKGkgPSBvID0gMDsgbyA8PSAyOyBpID0gKytvKSB7CiAgICAgICAgICAgIHJlc3VsdHMucHVzaCgoMSAtIHQpICogKDEgLSB0KSAqICgxIC0gdCkgKiBsYWIwW2ldICsgMyAqICgxIC0gdCkgKiAoMSAtIHQpICogdCAqIGxhYjFbaV0gKyAzICogKDEgLSB0KSAqIHQgKiB0ICogbGFiMltpXSArIHQgKiB0ICogdCAqIGxhYjNbaV0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIHJlc3VsdHM7CiAgICAgICAgfSkoKTsKICAgICAgICByZXR1cm4gY2hyb21hLmxhYi5hcHBseShjaHJvbWEsIGxhYik7CiAgICAgIH07CiAgICB9IGVsc2UgaWYgKGNvbG9ycy5sZW5ndGggPT09IDUpIHsKICAgICAgSTAgPSBiZXppZXIoY29sb3JzLnNsaWNlKDAsIDMpKTsKICAgICAgSTEgPSBiZXppZXIoY29sb3JzLnNsaWNlKDIsIDUpKTsKICAgICAgSSA9IGZ1bmN0aW9uKHQpIHsKICAgICAgICBpZiAodCA8IDAuNSkgewogICAgICAgICAgcmV0dXJuIEkwKHQgKiAyKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIEkxKCh0IC0gMC41KSAqIDIpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KICAgIHJldHVybiBJOwogIH07CgogIGNocm9tYS5pbnRlcnBvbGF0ZS5iZXppZXIgPSBiZXppZXI7CgoKICAvKgogIGludGVycG9sYXRlcyBiZXR3ZWVuIGEgc2V0IG9mIGNvbG9ycyB1emluZyBhIGJlemllciBzcGxpbmUKICAKICBibGVuZCBtb2RlIGZvcm11bGFzIHRha2VuIGZyb206CiAgaHR0cDovL3d3dy52ZW50dXJlLXdhcmUuY29tL2tldmluL2NvZGluZy9sZXRzLWxlYXJuLW1hdGgtcGhvdG9zaG9wLWJsZW5kLW1vZGVzLwogICAqLwoKICBibGVuZCA9IGZ1bmN0aW9uKGJvdHRvbSwgdG9wLCBtb2RlKSB7CiAgICBpZiAoIWJsZW5kW21vZGVdKSB7CiAgICAgIHRocm93ICd1bmtub3duIGJsZW5kIG1vZGUgJyArIG1vZGU7CiAgICB9CiAgICByZXR1cm4gYmxlbmRbbW9kZV0oYm90dG9tLCB0b3ApOwogIH07CgogIGJsZW5kX2YgPSBmdW5jdGlvbihmKSB7CiAgICByZXR1cm4gZnVuY3Rpb24oYm90dG9tLCB0b3ApIHsKICAgICAgdmFyIGMwLCBjMTsKICAgICAgYzAgPSBjaHJvbWEodG9wKS5yZ2IoKTsKICAgICAgYzEgPSBjaHJvbWEoYm90dG9tKS5yZ2IoKTsKICAgICAgcmV0dXJuIGNocm9tYShmKGMwLCBjMSksICdyZ2InKTsKICAgIH07CiAgfTsKCiAgZWFjaCA9IGZ1bmN0aW9uKGYpIHsKICAgIHJldHVybiBmdW5jdGlvbihjMCwgYzEpIHsKICAgICAgdmFyIGksIG8sIG91dDsKICAgICAgb3V0ID0gW107CiAgICAgIGZvciAoaSA9IG8gPSAwOyBvIDw9IDM7IGkgPSArK28pIHsKICAgICAgICBvdXRbaV0gPSBmKGMwW2ldLCBjMVtpXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG91dDsKICAgIH07CiAgfTsKCiAgbm9ybWFsID0gZnVuY3Rpb24oYSwgYikgewogICAgcmV0dXJuIGE7CiAgfTsKCiAgbXVsdGlwbHkgPSBmdW5jdGlvbihhLCBiKSB7CiAgICByZXR1cm4gYSAqIGIgLyAyNTU7CiAgfTsKCiAgZGFya2VuID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKGEgPiBiKSB7CiAgICAgIHJldHVybiBiOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgfTsKCiAgbGlnaHRlbiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIGlmIChhID4gYikgewogICAgICByZXR1cm4gYTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiBiOwogICAgfQogIH07CgogIHNjcmVlbiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiAyNTUgKiAoMSAtICgxIC0gYSAvIDI1NSkgKiAoMSAtIGIgLyAyNTUpKTsKICB9OwoKICBvdmVybGF5ID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKGIgPCAxMjgpIHsKICAgICAgcmV0dXJuIDIgKiBhICogYiAvIDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHJldHVybiAyNTUgKiAoMSAtIDIgKiAoMSAtIGEgLyAyNTUpICogKDEgLSBiIC8gMjU1KSk7CiAgICB9CiAgfTsKCiAgYnVybiA9IGZ1bmN0aW9uKGEsIGIpIHsKICAgIHJldHVybiAyNTUgKiAoMSAtICgxIC0gYiAvIDI1NSkgLyAoYSAvIDI1NSkpOwogIH07CgogIGRvZGdlID0gZnVuY3Rpb24oYSwgYikgewogICAgaWYgKGEgPT09IDI1NSkgewogICAgICByZXR1cm4gMjU1OwogICAgfQogICAgYSA9IDI1NSAqIChiIC8gMjU1KSAvICgxIC0gYSAvIDI1NSk7CiAgICBpZiAoYSA+IDI1NSkgewogICAgICByZXR1cm4gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgfTsKCiAgYmxlbmQubm9ybWFsID0gYmxlbmRfZihlYWNoKG5vcm1hbCkpOwoKICBibGVuZC5tdWx0aXBseSA9IGJsZW5kX2YoZWFjaChtdWx0aXBseSkpOwoKICBibGVuZC5zY3JlZW4gPSBibGVuZF9mKGVhY2goc2NyZWVuKSk7CgogIGJsZW5kLm92ZXJsYXkgPSBibGVuZF9mKGVhY2gob3ZlcmxheSkpOwoKICBibGVuZC5kYXJrZW4gPSBibGVuZF9mKGVhY2goZGFya2VuKSk7CgogIGJsZW5kLmxpZ2h0ZW4gPSBibGVuZF9mKGVhY2gobGlnaHRlbikpOwoKICBibGVuZC5kb2RnZSA9IGJsZW5kX2YoZWFjaChkb2RnZSkpOwoKICBibGVuZC5idXJuID0gYmxlbmRfZihlYWNoKGJ1cm4pKTsKCiAgY2hyb21hLmJsZW5kID0gYmxlbmQ7CgoKICAvKgogICAgICBjaHJvbWEuanMKICAKICAgICAgQ29weXJpZ2h0IChjKSAyMDExLTIwMTMsIEdyZWdvciBBaXNjaAogICAgICBBbGwgcmlnaHRzIHJlc2VydmVkLgogIAogICAgICBSZWRpc3RyaWJ1dGlvbiBhbmQgdXNlIGluIHNvdXJjZSBhbmQgYmluYXJ5IGZvcm1zLCB3aXRoIG9yIHdpdGhvdXQKICAgICAgbW9kaWZpY2F0aW9uLCBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CiAgCiAgICAgICogUmVkaXN0cmlidXRpb25zIG9mIHNvdXJjZSBjb2RlIG11c3QgcmV0YWluIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLCB0aGlzCiAgICAgICAgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIuCiAgCiAgICAgICogUmVkaXN0cmlidXRpb25zIGluIGJpbmFyeSBmb3JtIG11c3QgcmVwcm9kdWNlIHRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlLAogICAgICAgIHRoaXMgbGlzdCBvZiBjb25kaXRpb25zIGFuZCB0aGUgZm9sbG93aW5nIGRpc2NsYWltZXIgaW4gdGhlIGRvY3VtZW50YXRpb24KICAgICAgICBhbmQvb3Igb3RoZXIgbWF0ZXJpYWxzIHByb3ZpZGVkIHdpdGggdGhlIGRpc3RyaWJ1dGlvbi4KICAKICAgICAgKiBUaGUgbmFtZSBHcmVnb3IgQWlzY2ggbWF5IG5vdCBiZSB1c2VkIHRvIGVuZG9yc2Ugb3IgcHJvbW90ZSBwcm9kdWN0cwogICAgICAgIGRlcml2ZWQgZnJvbSB0aGlzIHNvZnR3YXJlIHdpdGhvdXQgc3BlY2lmaWMgcHJpb3Igd3JpdHRlbiBwZXJtaXNzaW9uLgogIAogICAgICBUSElTIFNPRlRXQVJFIElTIFBST1ZJREVEIEJZIFRIRSBDT1BZUklHSFQgSE9MREVSUyBBTkQgQ09OVFJJQlVUT1JTICJBUyBJUyIKICAgICAgQU5EIEFOWSBFWFBSRVNTIE9SIElNUExJRUQgV0FSUkFOVElFUywgSU5DTFVESU5HLCBCVVQgTk9UIExJTUlURUQgVE8sIFRIRQogICAgICBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUKICAgICAgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQgU0hBTEwgR1JFR09SIEFJU0NIIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsCiAgICAgIElORElSRUNULCBJTkNJREVOVEFMLCBTUEVDSUFMLCBFWEVNUExBUlksIE9SIENPTlNFUVVFTlRJQUwgREFNQUdFUyAoSU5DTFVESU5HLAogICAgICBCVVQgTk9UIExJTUlURUQgVE8sIFBST0NVUkVNRU5UIE9GIFNVQlNUSVRVVEUgR09PRFMgT1IgU0VSVklDRVM7IExPU1MgT0YgVVNFLAogICAgICBEQVRBLCBPUiBQUk9GSVRTOyBPUiBCVVNJTkVTUyBJTlRFUlJVUFRJT04pIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZCiAgICAgIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwgT1IgVE9SVCAoSU5DTFVESU5HCiAgICAgIE5FR0xJR0VOQ0UgT1IgT1RIRVJXSVNFKSBBUklTSU5HIElOIEFOWSBXQVkgT1VUIE9GIFRIRSBVU0UgT0YgVEhJUyBTT0ZUV0FSRSwKICAgICAgRVZFTiBJRiBBRFZJU0VEIE9GIFRIRSBQT1NTSUJJTElUWSBPRiBTVUNIIERBTUFHRS4KICAKICAgICAgQHNvdXJjZTogaHR0cHM6Ly9naXRodWIuY29tL2drYS9jaHJvbWEuanMKICAgKi8KCiAgY2hyb21hLmN1YmVoZWxpeCA9IGZ1bmN0aW9uKHN0YXJ0LCByb3RhdGlvbnMsIGh1ZSwgZ2FtbWEsIGxpZ2h0bmVzcykgewogICAgdmFyIGRoLCBkbDsKICAgIGlmIChzdGFydCA9PSBudWxsKSB7CiAgICAgIHN0YXJ0ID0gMzAwOwogICAgfQogICAgaWYgKHJvdGF0aW9ucyA9PSBudWxsKSB7CiAgICAgIHJvdGF0aW9ucyA9IC0xLjU7CiAgICB9CiAgICBpZiAoaHVlID09IG51bGwpIHsKICAgICAgaHVlID0gMTsKICAgIH0KICAgIGlmIChnYW1tYSA9PSBudWxsKSB7CiAgICAgIGdhbW1hID0gMTsKICAgIH0KICAgIGlmIChsaWdodG5lc3MgPT0gbnVsbCkgewogICAgICBsaWdodG5lc3MgPSBbMCwgMV07CiAgICB9CiAgICBkbCA9IGxpZ2h0bmVzc1sxXSAtIGxpZ2h0bmVzc1swXTsKICAgIGlmICh0eXBlKGh1ZSkgPT09ICdhcnJheScpIHsKICAgICAgZGggPSBodWVbMV0gLSBodWVbMF07CiAgICAgIGlmIChkaCA9PT0gMCkgewogICAgICAgIGh1ZSA9IGh1ZVsxXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZGggPSAwOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uKGZyYWN0KSB7CiAgICAgIHZhciBhLCBhbXAsIGIsIGNvc19hLCBnLCBoLCBsLCByLCBzaW5fYTsKICAgICAgYSA9IFRXT1BJICogKChzdGFydCArIDEyMCkgLyAzNjAgKyByb3RhdGlvbnMgKiBmcmFjdCk7CiAgICAgIGwgPSBwb3cobGlnaHRuZXNzWzBdICsgZGwgKiBmcmFjdCwgZ2FtbWEpOwogICAgICBoID0gZGggIT09IDAgPyBodWVbMF0gKyBmcmFjdCAqIGRoIDogaHVlOwogICAgICBhbXAgPSBoICogbCAqICgxIC0gbCkgLyAyOwogICAgICBjb3NfYSA9IGNvcyhhKTsKICAgICAgc2luX2EgPSBzaW4oYSk7CiAgICAgIHIgPSBsICsgYW1wICogKC0wLjE0ODYxICogY29zX2EgKyAxLjc4Mjc3ICogc2luX2EpOwogICAgICBnID0gbCArIGFtcCAqICgtMC4yOTIyNyAqIGNvc19hIC0gMC45MDY0OSAqIHNpbl9hKTsKICAgICAgYiA9IGwgKyBhbXAgKiAoKzEuOTcyOTQgKiBjb3NfYSk7CiAgICAgIHJldHVybiBjaHJvbWEoY2xpcF9yZ2IoW3IgKiAyNTUsIGcgKiAyNTUsIGIgKiAyNTVdKSk7CiAgICB9OwogIH07Cgp9KS5jYWxsKHRoaXMpOwo="></script>
<script src="data:application/x-javascript;base64,LyohCiAqIGpRdWVyeSBKYXZhU2NyaXB0IExpYnJhcnkgdjIuMS4yCiAqIGh0dHA6Ly9qcXVlcnkuY29tLwogKgogKiBJbmNsdWRlcyBTaXp6bGUuanMKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IDIwMDUsIDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiAyMDE0LTEyLTE3VDE0OjAxWgogKi8KCihmdW5jdGlvbiggZ2xvYmFsLCBmYWN0b3J5ICkgewoKCWlmICggdHlwZW9mIG1vZHVsZSA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZS5leHBvcnRzID09PSAib2JqZWN0IiApIHsKCQkvLyBGb3IgQ29tbW9uSlMgYW5kIENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHdoZXJlIGEgcHJvcGVyIGB3aW5kb3dgCgkJLy8gaXMgcHJlc2VudCwgZXhlY3V0ZSB0aGUgZmFjdG9yeSBhbmQgZ2V0IGpRdWVyeS4KCQkvLyBGb3IgZW52aXJvbm1lbnRzIHRoYXQgZG8gbm90IGhhdmUgYSBgd2luZG93YCB3aXRoIGEgYGRvY3VtZW50YAoJCS8vIChzdWNoIGFzIE5vZGUuanMpLCBleHBvc2UgYSBmYWN0b3J5IGFzIG1vZHVsZS5leHBvcnRzLgoJCS8vIFRoaXMgYWNjZW50dWF0ZXMgdGhlIG5lZWQgZm9yIHRoZSBjcmVhdGlvbiBvZiBhIHJlYWwgYHdpbmRvd2AuCgkJLy8gZS5nLiB2YXIgalF1ZXJ5ID0gcmVxdWlyZSgianF1ZXJ5Iikod2luZG93KTsKCQkvLyBTZWUgdGlja2V0ICMxNDU0OSBmb3IgbW9yZSBpbmZvLgoJCW1vZHVsZS5leHBvcnRzID0gZ2xvYmFsLmRvY3VtZW50ID8KCQkJZmFjdG9yeSggZ2xvYmFsLCB0cnVlICkgOgoJCQlmdW5jdGlvbiggdyApIHsKCQkJCWlmICggIXcuZG9jdW1lbnQgKSB7CgkJCQkJdGhyb3cgbmV3IEVycm9yKCAialF1ZXJ5IHJlcXVpcmVzIGEgd2luZG93IHdpdGggYSBkb2N1bWVudCIgKTsKCQkJCX0KCQkJCXJldHVybiBmYWN0b3J5KCB3ICk7CgkJCX07Cgl9IGVsc2UgewoJCWZhY3RvcnkoIGdsb2JhbCApOwoJfQoKLy8gUGFzcyB0aGlzIGlmIHdpbmRvdyBpcyBub3QgZGVmaW5lZCB5ZXQKfSh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHRoaXMsIGZ1bmN0aW9uKCB3aW5kb3csIG5vR2xvYmFsICkgewoKLy8gU3VwcG9ydDogRmlyZWZveCAxOCsKLy8gQ2FuJ3QgYmUgaW4gc3RyaWN0IG1vZGUsIHNldmVyYWwgbGlicyBpbmNsdWRpbmcgQVNQLk5FVCB0cmFjZQovLyB0aGUgc3RhY2sgdmlhIGFyZ3VtZW50cy5jYWxsZXIuY2FsbGVlIGFuZCBGaXJlZm94IGRpZXMgaWYKLy8geW91IHRyeSB0byB0cmFjZSB0aHJvdWdoICJ1c2Ugc3RyaWN0IiBjYWxsIGNoYWlucy4gKCMxMzMzNSkKLy8KCnZhciBhcnIgPSBbXTsKCnZhciBzbGljZSA9IGFyci5zbGljZTsKCnZhciBjb25jYXQgPSBhcnIuY29uY2F0OwoKdmFyIHB1c2ggPSBhcnIucHVzaDsKCnZhciBpbmRleE9mID0gYXJyLmluZGV4T2Y7Cgp2YXIgY2xhc3MydHlwZSA9IHt9OwoKdmFyIHRvU3RyaW5nID0gY2xhc3MydHlwZS50b1N0cmluZzsKCnZhciBoYXNPd24gPSBjbGFzczJ0eXBlLmhhc093blByb3BlcnR5OwoKdmFyIHN1cHBvcnQgPSB7fTsKCgoKdmFyCgkvLyBVc2UgdGhlIGNvcnJlY3QgZG9jdW1lbnQgYWNjb3JkaW5nbHkgd2l0aCB3aW5kb3cgYXJndW1lbnQgKHNhbmRib3gpCglkb2N1bWVudCA9IHdpbmRvdy5kb2N1bWVudCwKCgl2ZXJzaW9uID0gIjIuMS4yIiwKCgkvLyBEZWZpbmUgYSBsb2NhbCBjb3B5IG9mIGpRdWVyeQoJalF1ZXJ5ID0gZnVuY3Rpb24oIHNlbGVjdG9yLCBjb250ZXh0ICkgewoJCS8vIFRoZSBqUXVlcnkgb2JqZWN0IGlzIGFjdHVhbGx5IGp1c3QgdGhlIGluaXQgY29uc3RydWN0b3IgJ2VuaGFuY2VkJwoJCS8vIE5lZWQgaW5pdCBpZiBqUXVlcnkgaXMgY2FsbGVkIChqdXN0IGFsbG93IGVycm9yIHRvIGJlIHRocm93biBpZiBub3QgaW5jbHVkZWQpCgkJcmV0dXJuIG5ldyBqUXVlcnkuZm4uaW5pdCggc2VsZWN0b3IsIGNvbnRleHQgKTsKCX0sCgoJLy8gU3VwcG9ydDogQW5kcm9pZDw0LjEKCS8vIE1ha2Ugc3VyZSB3ZSB0cmltIEJPTSBhbmQgTkJTUAoJcnRyaW0gPSAvXltcc1x1RkVGRlx4QTBdK3xbXHNcdUZFRkZceEEwXSskL2csCgoJLy8gTWF0Y2hlcyBkYXNoZWQgc3RyaW5nIGZvciBjYW1lbGl6aW5nCglybXNQcmVmaXggPSAvXi1tcy0vLAoJcmRhc2hBbHBoYSA9IC8tKFtcZGEtel0pL2dpLAoKCS8vIFVzZWQgYnkgalF1ZXJ5LmNhbWVsQ2FzZSBhcyBjYWxsYmFjayB0byByZXBsYWNlKCkKCWZjYW1lbENhc2UgPSBmdW5jdGlvbiggYWxsLCBsZXR0ZXIgKSB7CgkJcmV0dXJuIGxldHRlci50b1VwcGVyQ2FzZSgpOwoJfTsKCmpRdWVyeS5mbiA9IGpRdWVyeS5wcm90b3R5cGUgPSB7CgkvLyBUaGUgY3VycmVudCB2ZXJzaW9uIG9mIGpRdWVyeSBiZWluZyB1c2VkCglqcXVlcnk6IHZlcnNpb24sCgoJY29uc3RydWN0b3I6IGpRdWVyeSwKCgkvLyBTdGFydCB3aXRoIGFuIGVtcHR5IHNlbGVjdG9yCglzZWxlY3RvcjogIiIsCgoJLy8gVGhlIGRlZmF1bHQgbGVuZ3RoIG9mIGEgalF1ZXJ5IG9iamVjdCBpcyAwCglsZW5ndGg6IDAsCgoJdG9BcnJheTogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gR2V0IHRoZSBOdGggZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldCBPUgoJLy8gR2V0IHRoZSB3aG9sZSBtYXRjaGVkIGVsZW1lbnQgc2V0IGFzIGEgY2xlYW4gYXJyYXkKCWdldDogZnVuY3Rpb24oIG51bSApIHsKCQlyZXR1cm4gbnVtICE9IG51bGwgPwoKCQkJLy8gUmV0dXJuIGp1c3QgdGhlIG9uZSBlbGVtZW50IGZyb20gdGhlIHNldAoJCQkoIG51bSA8IDAgPyB0aGlzWyBudW0gKyB0aGlzLmxlbmd0aCBdIDogdGhpc1sgbnVtIF0gKSA6CgoJCQkvLyBSZXR1cm4gYWxsIHRoZSBlbGVtZW50cyBpbiBhIGNsZWFuIGFycmF5CgkJCXNsaWNlLmNhbGwoIHRoaXMgKTsKCX0sCgoJLy8gVGFrZSBhbiBhcnJheSBvZiBlbGVtZW50cyBhbmQgcHVzaCBpdCBvbnRvIHRoZSBzdGFjawoJLy8gKHJldHVybmluZyB0aGUgbmV3IG1hdGNoZWQgZWxlbWVudCBzZXQpCglwdXNoU3RhY2s6IGZ1bmN0aW9uKCBlbGVtcyApIHsKCgkJLy8gQnVpbGQgYSBuZXcgalF1ZXJ5IG1hdGNoZWQgZWxlbWVudCBzZXQKCQl2YXIgcmV0ID0galF1ZXJ5Lm1lcmdlKCB0aGlzLmNvbnN0cnVjdG9yKCksIGVsZW1zICk7CgoJCS8vIEFkZCB0aGUgb2xkIG9iamVjdCBvbnRvIHRoZSBzdGFjayAoYXMgYSByZWZlcmVuY2UpCgkJcmV0LnByZXZPYmplY3QgPSB0aGlzOwoJCXJldC5jb250ZXh0ID0gdGhpcy5jb250ZXh0OwoKCQkvLyBSZXR1cm4gdGhlIG5ld2x5LWZvcm1lZCBlbGVtZW50IHNldAoJCXJldHVybiByZXQ7Cgl9LAoKCS8vIEV4ZWN1dGUgYSBjYWxsYmFjayBmb3IgZXZlcnkgZWxlbWVudCBpbiB0aGUgbWF0Y2hlZCBzZXQuCgkvLyAoWW91IGNhbiBzZWVkIHRoZSBhcmd1bWVudHMgd2l0aCBhbiBhcnJheSBvZiBhcmdzLCBidXQgdGhpcyBpcwoJLy8gb25seSB1c2VkIGludGVybmFsbHkuKQoJZWFjaDogZnVuY3Rpb24oIGNhbGxiYWNrLCBhcmdzICkgewoJCXJldHVybiBqUXVlcnkuZWFjaCggdGhpcywgY2FsbGJhY2ssIGFyZ3MgKTsKCX0sCgoJbWFwOiBmdW5jdGlvbiggY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHRoaXMucHVzaFN0YWNrKCBqUXVlcnkubWFwKHRoaXMsIGZ1bmN0aW9uKCBlbGVtLCBpICkgewoJCQlyZXR1cm4gY2FsbGJhY2suY2FsbCggZWxlbSwgaSwgZWxlbSApOwoJCX0pKTsKCX0sCgoJc2xpY2U6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggc2xpY2UuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApICk7Cgl9LAoKCWZpcnN0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lcSggMCApOwoJfSwKCglsYXN0OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5lcSggLTEgKTsKCX0sCgoJZXE6IGZ1bmN0aW9uKCBpICkgewoJCXZhciBsZW4gPSB0aGlzLmxlbmd0aCwKCQkJaiA9ICtpICsgKCBpIDwgMCA/IGxlbiA6IDAgKTsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGogPj0gMCAmJiBqIDwgbGVuID8gWyB0aGlzW2pdIF0gOiBbXSApOwoJfSwKCgllbmQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnByZXZPYmplY3QgfHwgdGhpcy5jb25zdHJ1Y3RvcihudWxsKTsKCX0sCgoJLy8gRm9yIGludGVybmFsIHVzZSBvbmx5LgoJLy8gQmVoYXZlcyBsaWtlIGFuIEFycmF5J3MgbWV0aG9kLCBub3QgbGlrZSBhIGpRdWVyeSBtZXRob2QuCglwdXNoOiBwdXNoLAoJc29ydDogYXJyLnNvcnQsCglzcGxpY2U6IGFyci5zcGxpY2UKfTsKCmpRdWVyeS5leHRlbmQgPSBqUXVlcnkuZm4uZXh0ZW5kID0gZnVuY3Rpb24oKSB7Cgl2YXIgb3B0aW9ucywgbmFtZSwgc3JjLCBjb3B5LCBjb3B5SXNBcnJheSwgY2xvbmUsCgkJdGFyZ2V0ID0gYXJndW1lbnRzWzBdIHx8IHt9LAoJCWkgPSAxLAoJCWxlbmd0aCA9IGFyZ3VtZW50cy5sZW5ndGgsCgkJZGVlcCA9IGZhbHNlOwoKCS8vIEhhbmRsZSBhIGRlZXAgY29weSBzaXR1YXRpb24KCWlmICggdHlwZW9mIHRhcmdldCA9PT0gImJvb2xlYW4iICkgewoJCWRlZXAgPSB0YXJnZXQ7CgoJCS8vIFNraXAgdGhlIGJvb2xlYW4gYW5kIHRoZSB0YXJnZXQKCQl0YXJnZXQgPSBhcmd1bWVudHNbIGkgXSB8fCB7fTsKCQlpKys7Cgl9CgoJLy8gSGFuZGxlIGNhc2Ugd2hlbiB0YXJnZXQgaXMgYSBzdHJpbmcgb3Igc29tZXRoaW5nIChwb3NzaWJsZSBpbiBkZWVwIGNvcHkpCglpZiAoIHR5cGVvZiB0YXJnZXQgIT09ICJvYmplY3QiICYmICFqUXVlcnkuaXNGdW5jdGlvbih0YXJnZXQpICkgewoJCXRhcmdldCA9IHt9OwoJfQoKCS8vIEV4dGVuZCBqUXVlcnkgaXRzZWxmIGlmIG9ubHkgb25lIGFyZ3VtZW50IGlzIHBhc3NlZAoJaWYgKCBpID09PSBsZW5ndGggKSB7CgkJdGFyZ2V0ID0gdGhpczsKCQlpLS07Cgl9CgoJZm9yICggOyBpIDwgbGVuZ3RoOyBpKysgKSB7CgkJLy8gT25seSBkZWFsIHdpdGggbm9uLW51bGwvdW5kZWZpbmVkIHZhbHVlcwoJCWlmICggKG9wdGlvbnMgPSBhcmd1bWVudHNbIGkgXSkgIT0gbnVsbCApIHsKCQkJLy8gRXh0ZW5kIHRoZSBiYXNlIG9iamVjdAoJCQlmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJCQlzcmMgPSB0YXJnZXRbIG5hbWUgXTsKCQkJCWNvcHkgPSBvcHRpb25zWyBuYW1lIF07CgoJCQkJLy8gUHJldmVudCBuZXZlci1lbmRpbmcgbG9vcAoJCQkJaWYgKCB0YXJnZXQgPT09IGNvcHkgKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJLy8gUmVjdXJzZSBpZiB3ZSdyZSBtZXJnaW5nIHBsYWluIG9iamVjdHMgb3IgYXJyYXlzCgkJCQlpZiAoIGRlZXAgJiYgY29weSAmJiAoIGpRdWVyeS5pc1BsYWluT2JqZWN0KGNvcHkpIHx8IChjb3B5SXNBcnJheSA9IGpRdWVyeS5pc0FycmF5KGNvcHkpKSApICkgewoJCQkJCWlmICggY29weUlzQXJyYXkgKSB7CgkJCQkJCWNvcHlJc0FycmF5ID0gZmFsc2U7CgkJCQkJCWNsb25lID0gc3JjICYmIGpRdWVyeS5pc0FycmF5KHNyYykgPyBzcmMgOiBbXTsKCgkJCQkJfSBlbHNlIHsKCQkJCQkJY2xvbmUgPSBzcmMgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3Qoc3JjKSA/IHNyYyA6IHt9OwoJCQkJCX0KCgkJCQkJLy8gTmV2ZXIgbW92ZSBvcmlnaW5hbCBvYmplY3RzLCBjbG9uZSB0aGVtCgkJCQkJdGFyZ2V0WyBuYW1lIF0gPSBqUXVlcnkuZXh0ZW5kKCBkZWVwLCBjbG9uZSwgY29weSApOwoKCQkJCS8vIERvbid0IGJyaW5nIGluIHVuZGVmaW5lZCB2YWx1ZXMKCQkJCX0gZWxzZSBpZiAoIGNvcHkgIT09IHVuZGVmaW5lZCApIHsKCQkJCQl0YXJnZXRbIG5hbWUgXSA9IGNvcHk7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gUmV0dXJuIHRoZSBtb2RpZmllZCBvYmplY3QKCXJldHVybiB0YXJnZXQ7Cn07CgpqUXVlcnkuZXh0ZW5kKHsKCS8vIFVuaXF1ZSBmb3IgZWFjaCBjb3B5IG9mIGpRdWVyeSBvbiB0aGUgcGFnZQoJZXhwYW5kbzogImpRdWVyeSIgKyAoIHZlcnNpb24gKyBNYXRoLnJhbmRvbSgpICkucmVwbGFjZSggL1xEL2csICIiICksCgoJLy8gQXNzdW1lIGpRdWVyeSBpcyByZWFkeSB3aXRob3V0IHRoZSByZWFkeSBtb2R1bGUKCWlzUmVhZHk6IHRydWUsCgoJZXJyb3I6IGZ1bmN0aW9uKCBtc2cgKSB7CgkJdGhyb3cgbmV3IEVycm9yKCBtc2cgKTsKCX0sCgoJbm9vcDogZnVuY3Rpb24oKSB7fSwKCglpc0Z1bmN0aW9uOiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBqUXVlcnkudHlwZShvYmopID09PSAiZnVuY3Rpb24iOwoJfSwKCglpc0FycmF5OiBBcnJheS5pc0FycmF5LAoKCWlzV2luZG93OiBmdW5jdGlvbiggb2JqICkgewoJCXJldHVybiBvYmogIT0gbnVsbCAmJiBvYmogPT09IG9iai53aW5kb3c7Cgl9LAoKCWlzTnVtZXJpYzogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBwYXJzZUZsb2F0IE5hTnMgbnVtZXJpYy1jYXN0IGZhbHNlIHBvc2l0aXZlcyAobnVsbHx0cnVlfGZhbHNlfCIiKQoJCS8vIC4uLmJ1dCBtaXNpbnRlcnByZXRzIGxlYWRpbmctbnVtYmVyIHN0cmluZ3MsIHBhcnRpY3VsYXJseSBoZXggbGl0ZXJhbHMgKCIweC4uLiIpCgkJLy8gc3VidHJhY3Rpb24gZm9yY2VzIGluZmluaXRpZXMgdG8gTmFOCgkJLy8gYWRkaW5nIDEgY29ycmVjdHMgbG9zcyBvZiBwcmVjaXNpb24gZnJvbSBwYXJzZUZsb2F0ICgjMTUxMDApCgkJcmV0dXJuICFqUXVlcnkuaXNBcnJheSggb2JqICkgJiYgKG9iaiAtIHBhcnNlRmxvYXQoIG9iaiApICsgMSkgPj0gMDsKCX0sCgoJaXNQbGFpbk9iamVjdDogZnVuY3Rpb24oIG9iaiApIHsKCQkvLyBOb3QgcGxhaW4gb2JqZWN0czoKCQkvLyAtIEFueSBvYmplY3Qgb3IgdmFsdWUgd2hvc2UgaW50ZXJuYWwgW1tDbGFzc11dIHByb3BlcnR5IGlzIG5vdCAiW29iamVjdCBPYmplY3RdIgoJCS8vIC0gRE9NIG5vZGVzCgkJLy8gLSB3aW5kb3cKCQlpZiAoIGpRdWVyeS50eXBlKCBvYmogKSAhPT0gIm9iamVjdCIgfHwgb2JqLm5vZGVUeXBlIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmICggb2JqLmNvbnN0cnVjdG9yICYmCgkJCQkhaGFzT3duLmNhbGwoIG9iai5jb25zdHJ1Y3Rvci5wcm90b3R5cGUsICJpc1Byb3RvdHlwZU9mIiApICkgewoJCQlyZXR1cm4gZmFsc2U7CgkJfQoKCQkvLyBJZiB0aGUgZnVuY3Rpb24gaGFzbid0IHJldHVybmVkIGFscmVhZHksIHdlJ3JlIGNvbmZpZGVudCB0aGF0CgkJLy8gfG9ianwgaXMgYSBwbGFpbiBvYmplY3QsIGNyZWF0ZWQgYnkge30gb3IgY29uc3RydWN0ZWQgd2l0aCBuZXcgT2JqZWN0CgkJcmV0dXJuIHRydWU7Cgl9LAoKCWlzRW1wdHlPYmplY3Q6IGZ1bmN0aW9uKCBvYmogKSB7CgkJdmFyIG5hbWU7CgkJZm9yICggbmFtZSBpbiBvYmogKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgkJcmV0dXJuIHRydWU7Cgl9LAoKCXR5cGU6IGZ1bmN0aW9uKCBvYmogKSB7CgkJaWYgKCBvYmogPT0gbnVsbCApIHsKCQkJcmV0dXJuIG9iaiArICIiOwoJCX0KCQkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMCwgaU9TPDYgKGZ1bmN0aW9uaXNoIFJlZ0V4cCkKCQlyZXR1cm4gdHlwZW9mIG9iaiA9PT0gIm9iamVjdCIgfHwgdHlwZW9mIG9iaiA9PT0gImZ1bmN0aW9uIiA/CgkJCWNsYXNzMnR5cGVbIHRvU3RyaW5nLmNhbGwob2JqKSBdIHx8ICJvYmplY3QiIDoKCQkJdHlwZW9mIG9iajsKCX0sCgoJLy8gRXZhbHVhdGVzIGEgc2NyaXB0IGluIGEgZ2xvYmFsIGNvbnRleHQKCWdsb2JhbEV2YWw6IGZ1bmN0aW9uKCBjb2RlICkgewoJCXZhciBzY3JpcHQsCgkJCWluZGlyZWN0ID0gZXZhbDsKCgkJY29kZSA9IGpRdWVyeS50cmltKCBjb2RlICk7CgoJCWlmICggY29kZSApIHsKCQkJLy8gSWYgdGhlIGNvZGUgaW5jbHVkZXMgYSB2YWxpZCwgcHJvbG9ndWUgcG9zaXRpb24KCQkJLy8gc3RyaWN0IG1vZGUgcHJhZ21hLCBleGVjdXRlIGNvZGUgYnkgaW5qZWN0aW5nIGEKCQkJLy8gc2NyaXB0IHRhZyBpbnRvIHRoZSBkb2N1bWVudC4KCQkJaWYgKCBjb2RlLmluZGV4T2YoInVzZSBzdHJpY3QiKSA9PT0gMSApIHsKCQkJCXNjcmlwdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInNjcmlwdCIpOwoJCQkJc2NyaXB0LnRleHQgPSBjb2RlOwoJCQkJZG9jdW1lbnQuaGVhZC5hcHBlbmRDaGlsZCggc2NyaXB0ICkucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggc2NyaXB0ICk7CgkJCX0gZWxzZSB7CgkJCS8vIE90aGVyd2lzZSwgYXZvaWQgdGhlIERPTSBub2RlIGNyZWF0aW9uLCBpbnNlcnRpb24KCQkJLy8gYW5kIHJlbW92YWwgYnkgdXNpbmcgYW4gaW5kaXJlY3QgZ2xvYmFsIGV2YWwKCQkJCWluZGlyZWN0KCBjb2RlICk7CgkJCX0KCQl9Cgl9LAoKCS8vIENvbnZlcnQgZGFzaGVkIHRvIGNhbWVsQ2FzZTsgdXNlZCBieSB0aGUgY3NzIGFuZCBkYXRhIG1vZHVsZXMKCS8vIFN1cHBvcnQ6IElFOS0xMSsKCS8vIE1pY3Jvc29mdCBmb3Jnb3QgdG8gaHVtcCB0aGVpciB2ZW5kb3IgcHJlZml4ICgjOTU3MikKCWNhbWVsQ2FzZTogZnVuY3Rpb24oIHN0cmluZyApIHsKCQlyZXR1cm4gc3RyaW5nLnJlcGxhY2UoIHJtc1ByZWZpeCwgIm1zLSIgKS5yZXBsYWNlKCByZGFzaEFscGhhLCBmY2FtZWxDYXNlICk7Cgl9LAoKCW5vZGVOYW1lOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlyZXR1cm4gZWxlbS5ub2RlTmFtZSAmJiBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUudG9Mb3dlckNhc2UoKTsKCX0sCgoJLy8gYXJncyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJZWFjaDogZnVuY3Rpb24oIG9iaiwgY2FsbGJhY2ssIGFyZ3MgKSB7CgkJdmFyIHZhbHVlLAoJCQlpID0gMCwKCQkJbGVuZ3RoID0gb2JqLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBvYmogKTsKCgkJaWYgKCBhcmdzICkgewoJCQlpZiAoIGlzQXJyYXkgKSB7CgkJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmFwcGx5KCBvYmpbIGkgXSwgYXJncyApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJZm9yICggaSBpbiBvYmogKSB7CgkJCQkJdmFsdWUgPSBjYWxsYmFjay5hcHBseSggb2JqWyBpIF0sIGFyZ3MgKTsKCgkJCQkJaWYgKCB2YWx1ZSA9PT0gZmFsc2UgKSB7CgkJCQkJCWJyZWFrOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkvLyBBIHNwZWNpYWwsIGZhc3QsIGNhc2UgZm9yIHRoZSBtb3N0IGNvbW1vbiB1c2Ugb2YgZWFjaAoJCX0gZWxzZSB7CgkJCWlmICggaXNBcnJheSApIHsKCQkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJCXZhbHVlID0gY2FsbGJhY2suY2FsbCggb2JqWyBpIF0sIGksIG9ialsgaSBdICk7CgoJCQkJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpIGluIG9iaiApIHsKCQkJCQl2YWx1ZSA9IGNhbGxiYWNrLmNhbGwoIG9ialsgaSBdLCBpLCBvYmpbIGkgXSApOwoKCQkJCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIHsKCQkJCQkJYnJlYWs7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gb2JqOwoJfSwKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQuMQoJdHJpbTogZnVuY3Rpb24oIHRleHQgKSB7CgkJcmV0dXJuIHRleHQgPT0gbnVsbCA/CgkJCSIiIDoKCQkJKCB0ZXh0ICsgIiIgKS5yZXBsYWNlKCBydHJpbSwgIiIgKTsKCX0sCgoJLy8gcmVzdWx0cyBpcyBmb3IgaW50ZXJuYWwgdXNhZ2Ugb25seQoJbWFrZUFycmF5OiBmdW5jdGlvbiggYXJyLCByZXN1bHRzICkgewoJCXZhciByZXQgPSByZXN1bHRzIHx8IFtdOwoKCQlpZiAoIGFyciAhPSBudWxsICkgewoJCQlpZiAoIGlzQXJyYXlsaWtlKCBPYmplY3QoYXJyKSApICkgewoJCQkJalF1ZXJ5Lm1lcmdlKCByZXQsCgkJCQkJdHlwZW9mIGFyciA9PT0gInN0cmluZyIgPwoJCQkJCVsgYXJyIF0gOiBhcnIKCQkJCSk7CgkJCX0gZWxzZSB7CgkJCQlwdXNoLmNhbGwoIHJldCwgYXJyICk7CgkJCX0KCQl9CgoJCXJldHVybiByZXQ7Cgl9LAoKCWluQXJyYXk6IGZ1bmN0aW9uKCBlbGVtLCBhcnIsIGkgKSB7CgkJcmV0dXJuIGFyciA9PSBudWxsID8gLTEgOiBpbmRleE9mLmNhbGwoIGFyciwgZWxlbSwgaSApOwoJfSwKCgltZXJnZTogZnVuY3Rpb24oIGZpcnN0LCBzZWNvbmQgKSB7CgkJdmFyIGxlbiA9ICtzZWNvbmQubGVuZ3RoLAoJCQlqID0gMCwKCQkJaSA9IGZpcnN0Lmxlbmd0aDsKCgkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCWZpcnN0WyBpKysgXSA9IHNlY29uZFsgaiBdOwoJCX0KCgkJZmlyc3QubGVuZ3RoID0gaTsKCgkJcmV0dXJuIGZpcnN0OwoJfSwKCglncmVwOiBmdW5jdGlvbiggZWxlbXMsIGNhbGxiYWNrLCBpbnZlcnQgKSB7CgkJdmFyIGNhbGxiYWNrSW52ZXJzZSwKCQkJbWF0Y2hlcyA9IFtdLAoJCQlpID0gMCwKCQkJbGVuZ3RoID0gZWxlbXMubGVuZ3RoLAoJCQljYWxsYmFja0V4cGVjdCA9ICFpbnZlcnQ7CgoJCS8vIEdvIHRocm91Z2ggdGhlIGFycmF5LCBvbmx5IHNhdmluZyB0aGUgaXRlbXMKCQkvLyB0aGF0IHBhc3MgdGhlIHZhbGlkYXRvciBmdW5jdGlvbgoJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQljYWxsYmFja0ludmVyc2UgPSAhY2FsbGJhY2soIGVsZW1zWyBpIF0sIGkgKTsKCQkJaWYgKCBjYWxsYmFja0ludmVyc2UgIT09IGNhbGxiYWNrRXhwZWN0ICkgewoJCQkJbWF0Y2hlcy5wdXNoKCBlbGVtc1sgaSBdICk7CgkJCX0KCQl9CgoJCXJldHVybiBtYXRjaGVzOwoJfSwKCgkvLyBhcmcgaXMgZm9yIGludGVybmFsIHVzYWdlIG9ubHkKCW1hcDogZnVuY3Rpb24oIGVsZW1zLCBjYWxsYmFjaywgYXJnICkgewoJCXZhciB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbmd0aCA9IGVsZW1zLmxlbmd0aCwKCQkJaXNBcnJheSA9IGlzQXJyYXlsaWtlKCBlbGVtcyApLAoJCQlyZXQgPSBbXTsKCgkJLy8gR28gdGhyb3VnaCB0aGUgYXJyYXksIHRyYW5zbGF0aW5nIGVhY2ggb2YgdGhlIGl0ZW1zIHRvIHRoZWlyIG5ldyB2YWx1ZXMKCQlpZiAoIGlzQXJyYXkgKSB7CgkJCWZvciAoIDsgaSA8IGxlbmd0aDsgaSsrICkgewoJCQkJdmFsdWUgPSBjYWxsYmFjayggZWxlbXNbIGkgXSwgaSwgYXJnICk7CgoJCQkJaWYgKCB2YWx1ZSAhPSBudWxsICkgewoJCQkJCXJldC5wdXNoKCB2YWx1ZSApOwoJCQkJfQoJCQl9CgoJCS8vIEdvIHRocm91Z2ggZXZlcnkga2V5IG9uIHRoZSBvYmplY3QsCgkJfSBlbHNlIHsKCQkJZm9yICggaSBpbiBlbGVtcyApIHsKCQkJCXZhbHVlID0gY2FsbGJhY2soIGVsZW1zWyBpIF0sIGksIGFyZyApOwoKCQkJCWlmICggdmFsdWUgIT0gbnVsbCApIHsKCQkJCQlyZXQucHVzaCggdmFsdWUgKTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gRmxhdHRlbiBhbnkgbmVzdGVkIGFycmF5cwoJCXJldHVybiBjb25jYXQuYXBwbHkoIFtdLCByZXQgKTsKCX0sCgoJLy8gQSBnbG9iYWwgR1VJRCBjb3VudGVyIGZvciBvYmplY3RzCglndWlkOiAxLAoKCS8vIEJpbmQgYSBmdW5jdGlvbiB0byBhIGNvbnRleHQsIG9wdGlvbmFsbHkgcGFydGlhbGx5IGFwcGx5aW5nIGFueQoJLy8gYXJndW1lbnRzLgoJcHJveHk6IGZ1bmN0aW9uKCBmbiwgY29udGV4dCApIHsKCQl2YXIgdG1wLCBhcmdzLCBwcm94eTsKCgkJaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gInN0cmluZyIgKSB7CgkJCXRtcCA9IGZuWyBjb250ZXh0IF07CgkJCWNvbnRleHQgPSBmbjsKCQkJZm4gPSB0bXA7CgkJfQoKCQkvLyBRdWljayBjaGVjayB0byBkZXRlcm1pbmUgaWYgdGFyZ2V0IGlzIGNhbGxhYmxlLCBpbiB0aGUgc3BlYwoJCS8vIHRoaXMgdGhyb3dzIGEgVHlwZUVycm9yLCBidXQgd2Ugd2lsbCBqdXN0IHJldHVybiB1bmRlZmluZWQuCgkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIGZuICkgKSB7CgkJCXJldHVybiB1bmRlZmluZWQ7CgkJfQoKCQkvLyBTaW11bGF0ZWQgYmluZAoJCWFyZ3MgPSBzbGljZS5jYWxsKCBhcmd1bWVudHMsIDIgKTsKCQlwcm94eSA9IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gZm4uYXBwbHkoIGNvbnRleHQgfHwgdGhpcywgYXJncy5jb25jYXQoIHNsaWNlLmNhbGwoIGFyZ3VtZW50cyApICkgKTsKCQl9OwoKCQkvLyBTZXQgdGhlIGd1aWQgb2YgdW5pcXVlIGhhbmRsZXIgdG8gdGhlIHNhbWUgb2Ygb3JpZ2luYWwgaGFuZGxlciwgc28gaXQgY2FuIGJlIHJlbW92ZWQKCQlwcm94eS5ndWlkID0gZm4uZ3VpZCA9IGZuLmd1aWQgfHwgalF1ZXJ5Lmd1aWQrKzsKCgkJcmV0dXJuIHByb3h5OwoJfSwKCglub3c6IERhdGUubm93LAoKCS8vIGpRdWVyeS5zdXBwb3J0IGlzIG5vdCB1c2VkIGluIENvcmUgYnV0IG90aGVyIHByb2plY3RzIGF0dGFjaCB0aGVpcgoJLy8gcHJvcGVydGllcyB0byBpdCBzbyBpdCBuZWVkcyB0byBleGlzdC4KCXN1cHBvcnQ6IHN1cHBvcnQKfSk7CgovLyBQb3B1bGF0ZSB0aGUgY2xhc3MydHlwZSBtYXAKalF1ZXJ5LmVhY2goIkJvb2xlYW4gTnVtYmVyIFN0cmluZyBGdW5jdGlvbiBBcnJheSBEYXRlIFJlZ0V4cCBPYmplY3QgRXJyb3IiLnNwbGl0KCIgIiksIGZ1bmN0aW9uKGksIG5hbWUpIHsKCWNsYXNzMnR5cGVbICJbb2JqZWN0ICIgKyBuYW1lICsgIl0iIF0gPSBuYW1lLnRvTG93ZXJDYXNlKCk7Cn0pOwoKZnVuY3Rpb24gaXNBcnJheWxpa2UoIG9iaiApIHsKCXZhciBsZW5ndGggPSBvYmoubGVuZ3RoLAoJCXR5cGUgPSBqUXVlcnkudHlwZSggb2JqICk7CgoJaWYgKCB0eXBlID09PSAiZnVuY3Rpb24iIHx8IGpRdWVyeS5pc1dpbmRvdyggb2JqICkgKSB7CgkJcmV0dXJuIGZhbHNlOwoJfQoKCWlmICggb2JqLm5vZGVUeXBlID09PSAxICYmIGxlbmd0aCApIHsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglyZXR1cm4gdHlwZSA9PT0gImFycmF5IiB8fCBsZW5ndGggPT09IDAgfHwKCQl0eXBlb2YgbGVuZ3RoID09PSAibnVtYmVyIiAmJiBsZW5ndGggPiAwICYmICggbGVuZ3RoIC0gMSApIGluIG9iajsKfQp2YXIgU2l6emxlID0KLyohCiAqIFNpenpsZSBDU1MgU2VsZWN0b3IgRW5naW5lIHYyLjIuMC1wcmUKICogaHR0cDovL3NpenpsZWpzLmNvbS8KICoKICogQ29weXJpZ2h0IDIwMDgsIDIwMTQgalF1ZXJ5IEZvdW5kYXRpb24sIEluYy4gYW5kIG90aGVyIGNvbnRyaWJ1dG9ycwogKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UKICogaHR0cDovL2pxdWVyeS5vcmcvbGljZW5zZQogKgogKiBEYXRlOiAyMDE0LTEyLTE2CiAqLwooZnVuY3Rpb24oIHdpbmRvdyApIHsKCnZhciBpLAoJc3VwcG9ydCwKCUV4cHIsCglnZXRUZXh0LAoJaXNYTUwsCgl0b2tlbml6ZSwKCWNvbXBpbGUsCglzZWxlY3QsCglvdXRlcm1vc3RDb250ZXh0LAoJc29ydElucHV0LAoJaGFzRHVwbGljYXRlLAoKCS8vIExvY2FsIGRvY3VtZW50IHZhcnMKCXNldERvY3VtZW50LAoJZG9jdW1lbnQsCglkb2NFbGVtLAoJZG9jdW1lbnRJc0hUTUwsCglyYnVnZ3lRU0EsCglyYnVnZ3lNYXRjaGVzLAoJbWF0Y2hlcywKCWNvbnRhaW5zLAoKCS8vIEluc3RhbmNlLXNwZWNpZmljIGRhdGEKCWV4cGFuZG8gPSAic2l6emxlIiArIDEgKiBuZXcgRGF0ZSgpLAoJcHJlZmVycmVkRG9jID0gd2luZG93LmRvY3VtZW50LAoJZGlycnVucyA9IDAsCglkb25lID0gMCwKCWNsYXNzQ2FjaGUgPSBjcmVhdGVDYWNoZSgpLAoJdG9rZW5DYWNoZSA9IGNyZWF0ZUNhY2hlKCksCgljb21waWxlckNhY2hlID0gY3JlYXRlQ2FjaGUoKSwKCXNvcnRPcmRlciA9IGZ1bmN0aW9uKCBhLCBiICkgewoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQl9CgkJcmV0dXJuIDA7Cgl9LAoKCS8vIEdlbmVyYWwtcHVycG9zZSBjb25zdGFudHMKCU1BWF9ORUdBVElWRSA9IDEgPDwgMzEsCgoJLy8gSW5zdGFuY2UgbWV0aG9kcwoJaGFzT3duID0gKHt9KS5oYXNPd25Qcm9wZXJ0eSwKCWFyciA9IFtdLAoJcG9wID0gYXJyLnBvcCwKCXB1c2hfbmF0aXZlID0gYXJyLnB1c2gsCglwdXNoID0gYXJyLnB1c2gsCglzbGljZSA9IGFyci5zbGljZSwKCS8vIFVzZSBhIHN0cmlwcGVkLWRvd24gaW5kZXhPZiBhcyBpdCdzIGZhc3RlciB0aGFuIG5hdGl2ZQoJLy8gaHR0cDovL2pzcGVyZi5jb20vdGhvci1pbmRleG9mLXZzLWZvci81CglpbmRleE9mID0gZnVuY3Rpb24oIGxpc3QsIGVsZW0gKSB7CgkJdmFyIGkgPSAwLAoJCQlsZW4gPSBsaXN0Lmxlbmd0aDsKCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJaWYgKCBsaXN0W2ldID09PSBlbGVtICkgewoJCQkJcmV0dXJuIGk7CgkJCX0KCQl9CgkJcmV0dXJuIC0xOwoJfSwKCglib29sZWFucyA9ICJjaGVja2VkfHNlbGVjdGVkfGFzeW5jfGF1dG9mb2N1c3xhdXRvcGxheXxjb250cm9sc3xkZWZlcnxkaXNhYmxlZHxoaWRkZW58aXNtYXB8bG9vcHxtdWx0aXBsZXxvcGVufHJlYWRvbmx5fHJlcXVpcmVkfHNjb3BlZCIsCgoJLy8gUmVndWxhciBleHByZXNzaW9ucwoKCS8vIFdoaXRlc3BhY2UgY2hhcmFjdGVycyBodHRwOi8vd3d3LnczLm9yZy9UUi9jc3MzLXNlbGVjdG9ycy8jd2hpdGVzcGFjZQoJd2hpdGVzcGFjZSA9ICJbXFx4MjBcXHRcXHJcXG5cXGZdIiwKCS8vIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc3ludGF4LyNjaGFyYWN0ZXJzCgljaGFyYWN0ZXJFbmNvZGluZyA9ICIoPzpcXFxcLnxbXFx3LV18W15cXHgwMC1cXHhhMF0pKyIsCgoJLy8gTG9vc2VseSBtb2RlbGVkIG9uIENTUyBpZGVudGlmaWVyIGNoYXJhY3RlcnMKCS8vIEFuIHVucXVvdGVkIHZhbHVlIHNob3VsZCBiZSBhIENTUyBpZGVudGlmaWVyIGh0dHA6Ly93d3cudzMub3JnL1RSL2NzczMtc2VsZWN0b3JzLyNhdHRyaWJ1dGUtc2VsZWN0b3JzCgkvLyBQcm9wZXIgc3ludGF4OiBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjdmFsdWUtZGVmLWlkZW50aWZpZXIKCWlkZW50aWZpZXIgPSBjaGFyYWN0ZXJFbmNvZGluZy5yZXBsYWNlKCAidyIsICJ3IyIgKSwKCgkvLyBBdHRyaWJ1dGUgc2VsZWN0b3JzOiBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2F0dHJpYnV0ZS1zZWxlY3RvcnMKCWF0dHJpYnV0ZXMgPSAiXFxbIiArIHdoaXRlc3BhY2UgKyAiKigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OiIgKyB3aGl0ZXNwYWNlICsKCQkvLyBPcGVyYXRvciAoY2FwdHVyZSAyKQoJCSIqKFsqXiR8IX5dPz0pIiArIHdoaXRlc3BhY2UgKwoJCS8vICJBdHRyaWJ1dGUgdmFsdWVzIG11c3QgYmUgQ1NTIGlkZW50aWZpZXJzIFtjYXB0dXJlIDVdIG9yIHN0cmluZ3MgW2NhcHR1cmUgMyBvciBjYXB0dXJlIDRdIgoJCSIqKD86JygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCJ8KCIgKyBpZGVudGlmaWVyICsgIikpfCkiICsgd2hpdGVzcGFjZSArCgkJIipcXF0iLAoKCXBzZXVkb3MgPSAiOigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSg/OlxcKCgiICsKCQkvLyBUbyByZWR1Y2UgdGhlIG51bWJlciBvZiBzZWxlY3RvcnMgbmVlZGluZyB0b2tlbml6ZSBpbiB0aGUgcHJlRmlsdGVyLCBwcmVmZXIgYXJndW1lbnRzOgoJCS8vIDEuIHF1b3RlZCAoY2FwdHVyZSAzOyBjYXB0dXJlIDQgb3IgY2FwdHVyZSA1KQoJCSIoJygoPzpcXFxcLnxbXlxcXFwnXSkqKSd8XCIoKD86XFxcXC58W15cXFxcXCJdKSopXCIpfCIgKwoJCS8vIDIuIHNpbXBsZSAoY2FwdHVyZSA2KQoJCSIoKD86XFxcXC58W15cXFxcKClbXFxdXXwiICsgYXR0cmlidXRlcyArICIpKil8IiArCgkJLy8gMy4gYW55dGhpbmcgZWxzZSAoY2FwdHVyZSAyKQoJCSIuKiIgKwoJCSIpXFwpfCkiLAoKCS8vIExlYWRpbmcgYW5kIG5vbi1lc2NhcGVkIHRyYWlsaW5nIHdoaXRlc3BhY2UsIGNhcHR1cmluZyBzb21lIG5vbi13aGl0ZXNwYWNlIGNoYXJhY3RlcnMgcHJlY2VkaW5nIHRoZSBsYXR0ZXIKCXJ3aGl0ZXNwYWNlID0gbmV3IFJlZ0V4cCggd2hpdGVzcGFjZSArICIrIiwgImciICksCglydHJpbSA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiK3woKD86XnxbXlxcXFxdKSg/OlxcXFwuKSopIiArIHdoaXRlc3BhY2UgKyAiKyQiLCAiZyIgKSwKCglyY29tbWEgPSBuZXcgUmVnRXhwKCAiXiIgKyB3aGl0ZXNwYWNlICsgIiosIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCXJjb21iaW5hdG9ycyA9IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKihbPit+XXwiICsgd2hpdGVzcGFjZSArICIpIiArIHdoaXRlc3BhY2UgKyAiKiIgKSwKCglyYXR0cmlidXRlUXVvdGVzID0gbmV3IFJlZ0V4cCggIj0iICsgd2hpdGVzcGFjZSArICIqKFteXFxdJ1wiXSo/KSIgKyB3aGl0ZXNwYWNlICsgIipcXF0iLCAiZyIgKSwKCglycHNldWRvID0gbmV3IFJlZ0V4cCggcHNldWRvcyApLAoJcmlkZW50aWZpZXIgPSBuZXcgUmVnRXhwKCAiXiIgKyBpZGVudGlmaWVyICsgIiQiICksCgoJbWF0Y2hFeHByID0gewoJCSJJRCI6IG5ldyBSZWdFeHAoICJeIygiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKSwKCQkiQ0xBU1MiOiBuZXcgUmVnRXhwKCAiXlxcLigiICsgY2hhcmFjdGVyRW5jb2RpbmcgKyAiKSIgKSwKCQkiVEFHIjogbmV3IFJlZ0V4cCggIl4oIiArIGNoYXJhY3RlckVuY29kaW5nLnJlcGxhY2UoICJ3IiwgIncqIiApICsgIikiICksCgkJIkFUVFIiOiBuZXcgUmVnRXhwKCAiXiIgKyBhdHRyaWJ1dGVzICksCgkJIlBTRVVETyI6IG5ldyBSZWdFeHAoICJeIiArIHBzZXVkb3MgKSwKCQkiQ0hJTEQiOiBuZXcgUmVnRXhwKCAiXjoob25seXxmaXJzdHxsYXN0fG50aHxudGgtbGFzdCktKGNoaWxkfG9mLXR5cGUpKD86XFwoIiArIHdoaXRlc3BhY2UgKwoJCQkiKihldmVufG9kZHwoKFsrLV18KShcXGQqKW58KSIgKyB3aGl0ZXNwYWNlICsgIiooPzooWystXXwpIiArIHdoaXRlc3BhY2UgKwoJCQkiKihcXGQrKXwpKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSIsICJpIiApLAoJCSJib29sIjogbmV3IFJlZ0V4cCggIl4oPzoiICsgYm9vbGVhbnMgKyAiKSQiLCAiaSIgKSwKCQkvLyBGb3IgdXNlIGluIGxpYnJhcmllcyBpbXBsZW1lbnRpbmcgLmlzKCkKCQkvLyBXZSB1c2UgdGhpcyBmb3IgUE9TIG1hdGNoaW5nIGluIGBzZWxlY3RgCgkJIm5lZWRzQ29udGV4dCI6IG5ldyBSZWdFeHAoICJeIiArIHdoaXRlc3BhY2UgKyAiKls+K35dfDooZXZlbnxvZGR8ZXF8Z3R8bHR8bnRofGZpcnN0fGxhc3QpKD86XFwoIiArCgkJCXdoaXRlc3BhY2UgKyAiKigoPzotXFxkKT9cXGQqKSIgKyB3aGl0ZXNwYWNlICsgIipcXCl8KSg/PVteLV18JCkiLCAiaSIgKQoJfSwKCglyaW5wdXRzID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaSwKCXJoZWFkZXIgPSAvXmhcZCQvaSwKCglybmF0aXZlID0gL15bXntdK1x7XHMqXFtuYXRpdmUgXHcvLAoKCS8vIEVhc2lseS1wYXJzZWFibGUvcmV0cmlldmFibGUgSUQgb3IgVEFHIG9yIENMQVNTIHNlbGVjdG9ycwoJcnF1aWNrRXhwciA9IC9eKD86IyhbXHctXSspfChcdyspfFwuKFtcdy1dKykpJC8sCgoJcnNpYmxpbmcgPSAvWyt+XS8sCglyZXNjYXBlID0gLyd8XFwvZywKCgkvLyBDU1MgZXNjYXBlcyBodHRwOi8vd3d3LnczLm9yZy9UUi9DU1MyMS9zeW5kYXRhLmh0bWwjZXNjYXBlZC1jaGFyYWN0ZXJzCglydW5lc2NhcGUgPSBuZXcgUmVnRXhwKCAiXFxcXChbXFxkYS1mXXsxLDZ9IiArIHdoaXRlc3BhY2UgKyAiP3woIiArIHdoaXRlc3BhY2UgKyAiKXwuKSIsICJpZyIgKSwKCWZ1bmVzY2FwZSA9IGZ1bmN0aW9uKCBfLCBlc2NhcGVkLCBlc2NhcGVkV2hpdGVzcGFjZSApIHsKCQl2YXIgaGlnaCA9ICIweCIgKyBlc2NhcGVkIC0gMHgxMDAwMDsKCQkvLyBOYU4gbWVhbnMgbm9uLWNvZGVwb2ludAoJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8MjQKCQkvLyBXb3JrYXJvdW5kIGVycm9uZW91cyBudW1lcmljIGludGVycHJldGF0aW9uIG9mICsiMHgiCgkJcmV0dXJuIGhpZ2ggIT09IGhpZ2ggfHwgZXNjYXBlZFdoaXRlc3BhY2UgPwoJCQllc2NhcGVkIDoKCQkJaGlnaCA8IDAgPwoJCQkJLy8gQk1QIGNvZGVwb2ludAoJCQkJU3RyaW5nLmZyb21DaGFyQ29kZSggaGlnaCArIDB4MTAwMDAgKSA6CgkJCQkvLyBTdXBwbGVtZW50YWwgUGxhbmUgY29kZXBvaW50IChzdXJyb2dhdGUgcGFpcikKCQkJCVN0cmluZy5mcm9tQ2hhckNvZGUoIGhpZ2ggPj4gMTAgfCAweEQ4MDAsIGhpZ2ggJiAweDNGRiB8IDB4REMwMCApOwoJfSwKCgkvLyBVc2VkIGZvciBpZnJhbWVzCgkvLyBTZWUgc2V0RG9jdW1lbnQoKQoJLy8gUmVtb3ZpbmcgdGhlIGZ1bmN0aW9uIHdyYXBwZXIgY2F1c2VzIGEgIlBlcm1pc3Npb24gRGVuaWVkIgoJLy8gZXJyb3IgaW4gSUUKCXVubG9hZEhhbmRsZXIgPSBmdW5jdGlvbigpIHsKCQlzZXREb2N1bWVudCgpOwoJfTsKCi8vIE9wdGltaXplIGZvciBwdXNoLmFwcGx5KCBfLCBOb2RlTGlzdCApCnRyeSB7CglwdXNoLmFwcGx5KAoJCShhcnIgPSBzbGljZS5jYWxsKCBwcmVmZXJyZWREb2MuY2hpbGROb2RlcyApKSwKCQlwcmVmZXJyZWREb2MuY2hpbGROb2RlcwoJKTsKCS8vIFN1cHBvcnQ6IEFuZHJvaWQ8NC4wCgkvLyBEZXRlY3Qgc2lsZW50bHkgZmFpbGluZyBwdXNoLmFwcGx5CglhcnJbIHByZWZlcnJlZERvYy5jaGlsZE5vZGVzLmxlbmd0aCBdLm5vZGVUeXBlOwp9IGNhdGNoICggZSApIHsKCXB1c2ggPSB7IGFwcGx5OiBhcnIubGVuZ3RoID8KCgkJLy8gTGV2ZXJhZ2Ugc2xpY2UgaWYgcG9zc2libGUKCQlmdW5jdGlvbiggdGFyZ2V0LCBlbHMgKSB7CgkJCXB1c2hfbmF0aXZlLmFwcGx5KCB0YXJnZXQsIHNsaWNlLmNhbGwoZWxzKSApOwoJCX0gOgoKCQkvLyBTdXBwb3J0OiBJRTw5CgkJLy8gT3RoZXJ3aXNlIGFwcGVuZCBkaXJlY3RseQoJCWZ1bmN0aW9uKCB0YXJnZXQsIGVscyApIHsKCQkJdmFyIGogPSB0YXJnZXQubGVuZ3RoLAoJCQkJaSA9IDA7CgkJCS8vIENhbid0IHRydXN0IE5vZGVMaXN0Lmxlbmd0aAoJCQl3aGlsZSAoICh0YXJnZXRbaisrXSA9IGVsc1tpKytdKSApIHt9CgkJCXRhcmdldC5sZW5ndGggPSBqIC0gMTsKCQl9Cgl9Owp9CgpmdW5jdGlvbiBTaXp6bGUoIHNlbGVjdG9yLCBjb250ZXh0LCByZXN1bHRzLCBzZWVkICkgewoJdmFyIG1hdGNoLCBlbGVtLCBtLCBub2RlVHlwZSwKCQkvLyBRU0EgdmFycwoJCWksIGdyb3Vwcywgb2xkLCBuaWQsIG5ld0NvbnRleHQsIG5ld1NlbGVjdG9yOwoKCWlmICggKCBjb250ZXh0ID8gY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgOiBwcmVmZXJyZWREb2MgKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsKCX0KCgljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCXJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOwoJbm9kZVR5cGUgPSBjb250ZXh0Lm5vZGVUeXBlOwoKCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiB8fCAhc2VsZWN0b3IgfHwKCQlub2RlVHlwZSAhPT0gMSAmJiBub2RlVHlwZSAhPT0gOSAmJiBub2RlVHlwZSAhPT0gMTEgKSB7CgoJCXJldHVybiByZXN1bHRzOwoJfQoKCWlmICggIXNlZWQgJiYgZG9jdW1lbnRJc0hUTUwgKSB7CgoJCS8vIFRyeSB0byBzaG9ydGN1dCBmaW5kIG9wZXJhdGlvbnMgd2hlbiBwb3NzaWJsZSAoZS5nLiwgbm90IHVuZGVyIERvY3VtZW50RnJhZ21lbnQpCgkJaWYgKCBub2RlVHlwZSAhPT0gMTEgJiYgKG1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApKSApIHsKCQkJLy8gU3BlZWQtdXA6IFNpenpsZSgiI0lEIikKCQkJaWYgKCAobSA9IG1hdGNoWzFdKSApIHsKCQkJCWlmICggbm9kZVR5cGUgPT09IDkgKSB7CgkJCQkJZWxlbSA9IGNvbnRleHQuZ2V0RWxlbWVudEJ5SWQoIG0gKTsKCQkJCQkvLyBDaGVjayBwYXJlbnROb2RlIHRvIGNhdGNoIHdoZW4gQmxhY2tiZXJyeSA0LjYgcmV0dXJucwoJCQkJCS8vIG5vZGVzIHRoYXQgYXJlIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgKGpRdWVyeSAjNjk2MykKCQkJCQlpZiAoIGVsZW0gJiYgZWxlbS5wYXJlbnROb2RlICkgewoJCQkJCQkvLyBIYW5kbGUgdGhlIGNhc2Ugd2hlcmUgSUUsIE9wZXJhLCBhbmQgV2Via2l0IHJldHVybiBpdGVtcwoJCQkJCQkvLyBieSBuYW1lIGluc3RlYWQgb2YgSUQKCQkJCQkJaWYgKCBlbGVtLmlkID09PSBtICkgewoJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQkJfQoJCQkJCX0gZWxzZSB7CgkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCX0KCQkJCX0gZWxzZSB7CgkJCQkJLy8gQ29udGV4dCBpcyBub3QgYSBkb2N1bWVudAoJCQkJCWlmICggY29udGV4dC5vd25lckRvY3VtZW50ICYmIChlbGVtID0gY29udGV4dC5vd25lckRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCBtICkpICYmCgkJCQkJCWNvbnRhaW5zKCBjb250ZXh0LCBlbGVtICkgJiYgZWxlbS5pZCA9PT0gbSApIHsKCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCXJldHVybiByZXN1bHRzOwoJCQkJCX0KCQkJCX0KCgkJCS8vIFNwZWVkLXVwOiBTaXp6bGUoIlRBRyIpCgkJCX0gZWxzZSBpZiAoIG1hdGNoWzJdICkgewoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggc2VsZWN0b3IgKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgoJCQkvLyBTcGVlZC11cDogU2l6emxlKCIuQ0xBU1MiKQoJCQl9IGVsc2UgaWYgKCAobSA9IG1hdGNoWzNdKSAmJiBzdXBwb3J0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKSB7CgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBjb250ZXh0LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoIG0gKSApOwoJCQkJcmV0dXJuIHJlc3VsdHM7CgkJCX0KCQl9CgoJCS8vIFFTQSBwYXRoCgkJaWYgKCBzdXBwb3J0LnFzYSAmJiAoIXJidWdneVFTQSB8fCAhcmJ1Z2d5UVNBLnRlc3QoIHNlbGVjdG9yICkpICkgewoJCQluaWQgPSBvbGQgPSBleHBhbmRvOwoJCQluZXdDb250ZXh0ID0gY29udGV4dDsKCQkJbmV3U2VsZWN0b3IgPSBub2RlVHlwZSAhPT0gMSAmJiBzZWxlY3RvcjsKCgkJCS8vIHFTQSB3b3JrcyBzdHJhbmdlbHkgb24gRWxlbWVudC1yb290ZWQgcXVlcmllcwoJCQkvLyBXZSBjYW4gd29yayBhcm91bmQgdGhpcyBieSBzcGVjaWZ5aW5nIGFuIGV4dHJhIElEIG9uIHRoZSByb290CgkJCS8vIGFuZCB3b3JraW5nIHVwIGZyb20gdGhlcmUgKFRoYW5rcyB0byBBbmRyZXcgRHVwb250IGZvciB0aGUgdGVjaG5pcXVlKQoJCQkvLyBJRSA4IGRvZXNuJ3Qgd29yayBvbiBvYmplY3QgZWxlbWVudHMKCQkJaWYgKCBub2RlVHlwZSA9PT0gMSAmJiBjb250ZXh0Lm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgIT09ICJvYmplY3QiICkgewoJCQkJZ3JvdXBzID0gdG9rZW5pemUoIHNlbGVjdG9yICk7CgoJCQkJaWYgKCAob2xkID0gY29udGV4dC5nZXRBdHRyaWJ1dGUoImlkIikpICkgewoJCQkJCW5pZCA9IG9sZC5yZXBsYWNlKCByZXNjYXBlLCAiXFwkJiIgKTsKCQkJCX0gZWxzZSB7CgkJCQkJY29udGV4dC5zZXRBdHRyaWJ1dGUoICJpZCIsIG5pZCApOwoJCQkJfQoJCQkJbmlkID0gIltpZD0nIiArIG5pZCArICInXSAiOwoKCQkJCWkgPSBncm91cHMubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJZ3JvdXBzW2ldID0gbmlkICsgdG9TZWxlY3RvciggZ3JvdXBzW2ldICk7CgkJCQl9CgkJCQluZXdDb250ZXh0ID0gcnNpYmxpbmcudGVzdCggc2VsZWN0b3IgKSAmJiB0ZXN0Q29udGV4dCggY29udGV4dC5wYXJlbnROb2RlICkgfHwgY29udGV4dDsKCQkJCW5ld1NlbGVjdG9yID0gZ3JvdXBzLmpvaW4oIiwiKTsKCQkJfQoKCQkJaWYgKCBuZXdTZWxlY3RvciApIHsKCQkJCXRyeSB7CgkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywKCQkJCQkJbmV3Q29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCBuZXdTZWxlY3RvciApCgkJCQkJKTsKCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCX0gY2F0Y2gocXNhRXJyb3IpIHsKCQkJCX0gZmluYWxseSB7CgkJCQkJaWYgKCAhb2xkICkgewoJCQkJCQljb250ZXh0LnJlbW92ZUF0dHJpYnV0ZSgiaWQiKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9CgoJLy8gQWxsIG90aGVycwoJcmV0dXJuIHNlbGVjdCggc2VsZWN0b3IucmVwbGFjZSggcnRyaW0sICIkMSIgKSwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApOwp9CgovKioKICogQ3JlYXRlIGtleS12YWx1ZSBjYWNoZXMgb2YgbGltaXRlZCBzaXplCiAqIEByZXR1cm5zIHtGdW5jdGlvbihzdHJpbmcsIE9iamVjdCl9IFJldHVybnMgdGhlIE9iamVjdCBkYXRhIGFmdGVyIHN0b3JpbmcgaXQgb24gaXRzZWxmIHdpdGgKICoJcHJvcGVydHkgbmFtZSB0aGUgKHNwYWNlLXN1ZmZpeGVkKSBzdHJpbmcgYW5kIChpZiB0aGUgY2FjaGUgaXMgbGFyZ2VyIHRoYW4gRXhwci5jYWNoZUxlbmd0aCkKICoJZGVsZXRpbmcgdGhlIG9sZGVzdCBlbnRyeQogKi8KZnVuY3Rpb24gY3JlYXRlQ2FjaGUoKSB7Cgl2YXIga2V5cyA9IFtdOwoKCWZ1bmN0aW9uIGNhY2hlKCBrZXksIHZhbHVlICkgewoJCS8vIFVzZSAoa2V5ICsgIiAiKSB0byBhdm9pZCBjb2xsaXNpb24gd2l0aCBuYXRpdmUgcHJvdG90eXBlIHByb3BlcnRpZXMgKHNlZSBJc3N1ZSAjMTU3KQoJCWlmICgga2V5cy5wdXNoKCBrZXkgKyAiICIgKSA+IEV4cHIuY2FjaGVMZW5ndGggKSB7CgkJCS8vIE9ubHkga2VlcCB0aGUgbW9zdCByZWNlbnQgZW50cmllcwoJCQlkZWxldGUgY2FjaGVbIGtleXMuc2hpZnQoKSBdOwoJCX0KCQlyZXR1cm4gKGNhY2hlWyBrZXkgKyAiICIgXSA9IHZhbHVlKTsKCX0KCXJldHVybiBjYWNoZTsKfQoKLyoqCiAqIE1hcmsgYSBmdW5jdGlvbiBmb3Igc3BlY2lhbCB1c2UgYnkgU2l6emxlCiAqIEBwYXJhbSB7RnVuY3Rpb259IGZuIFRoZSBmdW5jdGlvbiB0byBtYXJrCiAqLwpmdW5jdGlvbiBtYXJrRnVuY3Rpb24oIGZuICkgewoJZm5bIGV4cGFuZG8gXSA9IHRydWU7CglyZXR1cm4gZm47Cn0KCi8qKgogKiBTdXBwb3J0IHRlc3RpbmcgdXNpbmcgYW4gZWxlbWVudAogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbiBQYXNzZWQgdGhlIGNyZWF0ZWQgZGl2IGFuZCBleHBlY3RzIGEgYm9vbGVhbiByZXN1bHQKICovCmZ1bmN0aW9uIGFzc2VydCggZm4gKSB7Cgl2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CgoJdHJ5IHsKCQlyZXR1cm4gISFmbiggZGl2ICk7Cgl9IGNhdGNoIChlKSB7CgkJcmV0dXJuIGZhbHNlOwoJfSBmaW5hbGx5IHsKCQkvLyBSZW1vdmUgZnJvbSBpdHMgcGFyZW50IGJ5IGRlZmF1bHQKCQlpZiAoIGRpdi5wYXJlbnROb2RlICkgewoJCQlkaXYucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZGl2ICk7CgkJfQoJCS8vIHJlbGVhc2UgbWVtb3J5IGluIElFCgkJZGl2ID0gbnVsbDsKCX0KfQoKLyoqCiAqIEFkZHMgdGhlIHNhbWUgaGFuZGxlciBmb3IgYWxsIG9mIHRoZSBzcGVjaWZpZWQgYXR0cnMKICogQHBhcmFtIHtTdHJpbmd9IGF0dHJzIFBpcGUtc2VwYXJhdGVkIGxpc3Qgb2YgYXR0cmlidXRlcwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBoYW5kbGVyIFRoZSBtZXRob2QgdGhhdCB3aWxsIGJlIGFwcGxpZWQKICovCmZ1bmN0aW9uIGFkZEhhbmRsZSggYXR0cnMsIGhhbmRsZXIgKSB7Cgl2YXIgYXJyID0gYXR0cnMuc3BsaXQoInwiKSwKCQlpID0gYXR0cnMubGVuZ3RoOwoKCXdoaWxlICggaS0tICkgewoJCUV4cHIuYXR0ckhhbmRsZVsgYXJyW2ldIF0gPSBoYW5kbGVyOwoJfQp9CgovKioKICogQ2hlY2tzIGRvY3VtZW50IG9yZGVyIG9mIHR3byBzaWJsaW5ncwogKiBAcGFyYW0ge0VsZW1lbnR9IGEKICogQHBhcmFtIHtFbGVtZW50fSBiCiAqIEByZXR1cm5zIHtOdW1iZXJ9IFJldHVybnMgbGVzcyB0aGFuIDAgaWYgYSBwcmVjZWRlcyBiLCBncmVhdGVyIHRoYW4gMCBpZiBhIGZvbGxvd3MgYgogKi8KZnVuY3Rpb24gc2libGluZ0NoZWNrKCBhLCBiICkgewoJdmFyIGN1ciA9IGIgJiYgYSwKCQlkaWZmID0gY3VyICYmIGEubm9kZVR5cGUgPT09IDEgJiYgYi5ub2RlVHlwZSA9PT0gMSAmJgoJCQkoIH5iLnNvdXJjZUluZGV4IHx8IE1BWF9ORUdBVElWRSApIC0KCQkJKCB+YS5zb3VyY2VJbmRleCB8fCBNQVhfTkVHQVRJVkUgKTsKCgkvLyBVc2UgSUUgc291cmNlSW5kZXggaWYgYXZhaWxhYmxlIG9uIGJvdGggbm9kZXMKCWlmICggZGlmZiApIHsKCQlyZXR1cm4gZGlmZjsKCX0KCgkvLyBDaGVjayBpZiBiIGZvbGxvd3MgYQoJaWYgKCBjdXIgKSB7CgkJd2hpbGUgKCAoY3VyID0gY3VyLm5leHRTaWJsaW5nKSApIHsKCQkJaWYgKCBjdXIgPT09IGIgKSB7CgkJCQlyZXR1cm4gLTE7CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIGEgPyAxIDogLTE7Cn0KCi8qKgogKiBSZXR1cm5zIGEgZnVuY3Rpb24gdG8gdXNlIGluIHBzZXVkb3MgZm9yIGlucHV0IHR5cGVzCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVJbnB1dFBzZXVkbyggdHlwZSApIHsKCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQlyZXR1cm4gbmFtZSA9PT0gImlucHV0IiAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBidXR0b25zCiAqIEBwYXJhbSB7U3RyaW5nfSB0eXBlCiAqLwpmdW5jdGlvbiBjcmVhdGVCdXR0b25Qc2V1ZG8oIHR5cGUgKSB7CglyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJdmFyIG5hbWUgPSBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCk7CgkJcmV0dXJuIChuYW1lID09PSAiaW5wdXQiIHx8IG5hbWUgPT09ICJidXR0b24iKSAmJiBlbGVtLnR5cGUgPT09IHR5cGU7Cgl9Owp9CgovKioKICogUmV0dXJucyBhIGZ1bmN0aW9uIHRvIHVzZSBpbiBwc2V1ZG9zIGZvciBwb3NpdGlvbmFscwogKiBAcGFyYW0ge0Z1bmN0aW9ufSBmbgogKi8KZnVuY3Rpb24gY3JlYXRlUG9zaXRpb25hbFBzZXVkbyggZm4gKSB7CglyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBhcmd1bWVudCApIHsKCQlhcmd1bWVudCA9ICthcmd1bWVudDsKCQlyZXR1cm4gbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQl2YXIgaiwKCQkJCW1hdGNoSW5kZXhlcyA9IGZuKCBbXSwgc2VlZC5sZW5ndGgsIGFyZ3VtZW50ICksCgkJCQlpID0gbWF0Y2hJbmRleGVzLmxlbmd0aDsKCgkJCS8vIE1hdGNoIGVsZW1lbnRzIGZvdW5kIGF0IHRoZSBzcGVjaWZpZWQgaW5kZXhlcwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWlmICggc2VlZFsgKGogPSBtYXRjaEluZGV4ZXNbaV0pIF0gKSB7CgkJCQkJc2VlZFtqXSA9ICEobWF0Y2hlc1tqXSA9IHNlZWRbal0pOwoJCQkJfQoJCQl9CgkJfSk7Cgl9KTsKfQoKLyoqCiAqIENoZWNrcyBhIG5vZGUgZm9yIHZhbGlkaXR5IGFzIGEgU2l6emxlIGNvbnRleHQKICogQHBhcmFtIHtFbGVtZW50fE9iamVjdD19IGNvbnRleHQKICogQHJldHVybnMge0VsZW1lbnR8T2JqZWN0fEJvb2xlYW59IFRoZSBpbnB1dCBub2RlIGlmIGFjY2VwdGFibGUsIG90aGVyd2lzZSBhIGZhbHN5IHZhbHVlCiAqLwpmdW5jdGlvbiB0ZXN0Q29udGV4dCggY29udGV4dCApIHsKCXJldHVybiBjb250ZXh0ICYmIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lICE9PSAidW5kZWZpbmVkIiAmJiBjb250ZXh0Owp9CgovLyBFeHBvc2Ugc3VwcG9ydCB2YXJzIGZvciBjb252ZW5pZW5jZQpzdXBwb3J0ID0gU2l6emxlLnN1cHBvcnQgPSB7fTsKCi8qKgogKiBEZXRlY3RzIFhNTCBub2RlcwogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBlbGVtIEFuIGVsZW1lbnQgb3IgYSBkb2N1bWVudAogKiBAcmV0dXJucyB7Qm9vbGVhbn0gVHJ1ZSBpZmYgZWxlbSBpcyBhIG5vbi1IVE1MIFhNTCBub2RlCiAqLwppc1hNTCA9IFNpenpsZS5pc1hNTCA9IGZ1bmN0aW9uKCBlbGVtICkgewoJLy8gZG9jdW1lbnRFbGVtZW50IGlzIHZlcmlmaWVkIGZvciBjYXNlcyB3aGVyZSBpdCBkb2Vzbid0IHlldCBleGlzdAoJLy8gKHN1Y2ggYXMgbG9hZGluZyBpZnJhbWVzIGluIElFIC0gIzQ4MzMpCgl2YXIgZG9jdW1lbnRFbGVtZW50ID0gZWxlbSAmJiAoZWxlbS5vd25lckRvY3VtZW50IHx8IGVsZW0pLmRvY3VtZW50RWxlbWVudDsKCXJldHVybiBkb2N1bWVudEVsZW1lbnQgPyBkb2N1bWVudEVsZW1lbnQubm9kZU5hbWUgIT09ICJIVE1MIiA6IGZhbHNlOwp9OwoKLyoqCiAqIFNldHMgZG9jdW1lbnQtcmVsYXRlZCB2YXJpYWJsZXMgb25jZSBiYXNlZCBvbiB0aGUgY3VycmVudCBkb2N1bWVudAogKiBAcGFyYW0ge0VsZW1lbnR8T2JqZWN0fSBbZG9jXSBBbiBlbGVtZW50IG9yIGRvY3VtZW50IG9iamVjdCB0byB1c2UgdG8gc2V0IHRoZSBkb2N1bWVudAogKiBAcmV0dXJucyB7T2JqZWN0fSBSZXR1cm5zIHRoZSBjdXJyZW50IGRvY3VtZW50CiAqLwpzZXREb2N1bWVudCA9IFNpenpsZS5zZXREb2N1bWVudCA9IGZ1bmN0aW9uKCBub2RlICkgewoJdmFyIGhhc0NvbXBhcmUsIHBhcmVudCwKCQlkb2MgPSBub2RlID8gbm9kZS5vd25lckRvY3VtZW50IHx8IG5vZGUgOiBwcmVmZXJyZWREb2M7CgoJLy8gSWYgbm8gZG9jdW1lbnQgYW5kIGRvY3VtZW50RWxlbWVudCBpcyBhdmFpbGFibGUsIHJldHVybgoJaWYgKCBkb2MgPT09IGRvY3VtZW50IHx8IGRvYy5ub2RlVHlwZSAhPT0gOSB8fCAhZG9jLmRvY3VtZW50RWxlbWVudCApIHsKCQlyZXR1cm4gZG9jdW1lbnQ7Cgl9CgoJLy8gU2V0IG91ciBkb2N1bWVudAoJZG9jdW1lbnQgPSBkb2M7Cglkb2NFbGVtID0gZG9jLmRvY3VtZW50RWxlbWVudDsKCXBhcmVudCA9IGRvYy5kZWZhdWx0VmlldzsKCgkvLyBTdXBwb3J0OiBJRT44CgkvLyBJZiBpZnJhbWUgZG9jdW1lbnQgaXMgYXNzaWduZWQgdG8gImRvY3VtZW50IiB2YXJpYWJsZSBhbmQgaWYgaWZyYW1lIGhhcyBiZWVuIHJlbG9hZGVkLAoJLy8gSUUgd2lsbCB0aHJvdyAicGVybWlzc2lvbiBkZW5pZWQiIGVycm9yIHdoZW4gYWNjZXNzaW5nICJkb2N1bWVudCIgdmFyaWFibGUsIHNlZSBqUXVlcnkgIzEzOTM2CgkvLyBJRTYtOCBkbyBub3Qgc3VwcG9ydCB0aGUgZGVmYXVsdFZpZXcgcHJvcGVydHkgc28gcGFyZW50IHdpbGwgYmUgdW5kZWZpbmVkCglpZiAoIHBhcmVudCAmJiBwYXJlbnQgIT09IHBhcmVudC50b3AgKSB7CgkJLy8gSUUxMSBkb2VzIG5vdCBoYXZlIGF0dGFjaEV2ZW50LCBzbyBhbGwgbXVzdCBzdWZmZXIKCQlpZiAoIHBhcmVudC5hZGRFdmVudExpc3RlbmVyICkgewoJCQlwYXJlbnQuYWRkRXZlbnRMaXN0ZW5lciggInVubG9hZCIsIHVubG9hZEhhbmRsZXIsIGZhbHNlICk7CgkJfSBlbHNlIGlmICggcGFyZW50LmF0dGFjaEV2ZW50ICkgewoJCQlwYXJlbnQuYXR0YWNoRXZlbnQoICJvbnVubG9hZCIsIHVubG9hZEhhbmRsZXIgKTsKCQl9Cgl9CgoJLyogU3VwcG9ydCB0ZXN0cwoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoJZG9jdW1lbnRJc0hUTUwgPSAhaXNYTUwoIGRvYyApOwoKCS8qIEF0dHJpYnV0ZXMKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBTdXBwb3J0OiBJRTw4CgkvLyBWZXJpZnkgdGhhdCBnZXRBdHRyaWJ1dGUgcmVhbGx5IHJldHVybnMgYXR0cmlidXRlcyBhbmQgbm90IHByb3BlcnRpZXMKCS8vIChleGNlcHRpbmcgSUU4IGJvb2xlYW5zKQoJc3VwcG9ydC5hdHRyaWJ1dGVzID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmNsYXNzTmFtZSA9ICJpIjsKCQlyZXR1cm4gIWRpdi5nZXRBdHRyaWJ1dGUoImNsYXNzTmFtZSIpOwoJfSk7CgoJLyogZ2V0RWxlbWVudChzKUJ5KgoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoKCS8vIENoZWNrIGlmIGdldEVsZW1lbnRzQnlUYWdOYW1lKCIqIikgcmV0dXJucyBvbmx5IGVsZW1lbnRzCglzdXBwb3J0LmdldEVsZW1lbnRzQnlUYWdOYW1lID0gYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CgkJZGl2LmFwcGVuZENoaWxkKCBkb2MuY3JlYXRlQ29tbWVudCgiIikgKTsKCQlyZXR1cm4gIWRpdi5nZXRFbGVtZW50c0J5VGFnTmFtZSgiKiIpLmxlbmd0aDsKCX0pOwoKCS8vIFN1cHBvcnQ6IElFPDkKCXN1cHBvcnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSA9IHJuYXRpdmUudGVzdCggZG9jLmdldEVsZW1lbnRzQnlDbGFzc05hbWUgKTsKCgkvLyBTdXBwb3J0OiBJRTwxMAoJLy8gQ2hlY2sgaWYgZ2V0RWxlbWVudEJ5SWQgcmV0dXJucyBlbGVtZW50cyBieSBuYW1lCgkvLyBUaGUgYnJva2VuIGdldEVsZW1lbnRCeUlkIG1ldGhvZHMgZG9uJ3QgcGljayB1cCBwcm9ncmFtYXRpY2FsbHktc2V0IG5hbWVzLAoJLy8gc28gdXNlIGEgcm91bmRhYm91dCBnZXRFbGVtZW50c0J5TmFtZSB0ZXN0CglzdXBwb3J0LmdldEJ5SWQgPSBhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBkaXYgKS5pZCA9IGV4cGFuZG87CgkJcmV0dXJuICFkb2MuZ2V0RWxlbWVudHNCeU5hbWUgfHwgIWRvYy5nZXRFbGVtZW50c0J5TmFtZSggZXhwYW5kbyApLmxlbmd0aDsKCX0pOwoKCS8vIElEIGZpbmQgYW5kIGZpbHRlcgoJaWYgKCBzdXBwb3J0LmdldEJ5SWQgKSB7CgkJRXhwci5maW5kWyJJRCJdID0gZnVuY3Rpb24oIGlkLCBjb250ZXh0ICkgewoJCQlpZiAoIHR5cGVvZiBjb250ZXh0LmdldEVsZW1lbnRCeUlkICE9PSAidW5kZWZpbmVkIiAmJiBkb2N1bWVudElzSFRNTCApIHsKCQkJCXZhciBtID0gY29udGV4dC5nZXRFbGVtZW50QnlJZCggaWQgKTsKCQkJCS8vIENoZWNrIHBhcmVudE5vZGUgdG8gY2F0Y2ggd2hlbiBCbGFja2JlcnJ5IDQuNiByZXR1cm5zCgkJCQkvLyBub2RlcyB0aGF0IGFyZSBubyBsb25nZXIgaW4gdGhlIGRvY3VtZW50ICM2OTYzCgkJCQlyZXR1cm4gbSAmJiBtLnBhcmVudE5vZGUgPyBbIG0gXSA6IFtdOwoJCQl9CgkJfTsKCQlFeHByLmZpbHRlclsiSUQiXSA9IGZ1bmN0aW9uKCBpZCApIHsKCQkJdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSgiaWQiKSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9IGVsc2UgewoJCS8vIFN1cHBvcnQ6IElFNi83CgkJLy8gZ2V0RWxlbWVudEJ5SWQgaXMgbm90IHJlbGlhYmxlIGFzIGEgZmluZCBzaG9ydGN1dAoJCWRlbGV0ZSBFeHByLmZpbmRbIklEIl07CgoJCUV4cHIuZmlsdGVyWyJJRCJdID0gIGZ1bmN0aW9uKCBpZCApIHsKCQkJdmFyIGF0dHJJZCA9IGlkLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBub2RlID0gdHlwZW9mIGVsZW0uZ2V0QXR0cmlidXRlTm9kZSAhPT0gInVuZGVmaW5lZCIgJiYgZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKCJpZCIpOwoJCQkJcmV0dXJuIG5vZGUgJiYgbm9kZS52YWx1ZSA9PT0gYXR0cklkOwoJCQl9OwoJCX07Cgl9CgoJLy8gVGFnCglFeHByLmZpbmRbIlRBRyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5VGFnTmFtZSA/CgkJZnVuY3Rpb24oIHRhZywgY29udGV4dCApIHsKCQkJaWYgKCB0eXBlb2YgY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSAhPT0gInVuZGVmaW5lZCIgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBEb2N1bWVudEZyYWdtZW50IG5vZGVzIGRvbid0IGhhdmUgZ0VCVE4KCQkJfSBlbHNlIGlmICggc3VwcG9ydC5xc2EgKSB7CgkJCQlyZXR1cm4gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgKTsKCQkJfQoJCX0gOgoKCQlmdW5jdGlvbiggdGFnLCBjb250ZXh0ICkgewoJCQl2YXIgZWxlbSwKCQkJCXRtcCA9IFtdLAoJCQkJaSA9IDAsCgkJCQkvLyBCeSBoYXBweSBjb2luY2lkZW5jZSwgYSAoYnJva2VuKSBnRUJUTiBhcHBlYXJzIG9uIERvY3VtZW50RnJhZ21lbnQgbm9kZXMgdG9vCgkJCQlyZXN1bHRzID0gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnICk7CgoJCQkvLyBGaWx0ZXIgb3V0IHBvc3NpYmxlIGNvbW1lbnRzCgkJCWlmICggdGFnID09PSAiKiIgKSB7CgkJCQl3aGlsZSAoIChlbGVtID0gcmVzdWx0c1tpKytdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQkJCXRtcC5wdXNoKCBlbGVtICk7CgkJCQkJfQoJCQkJfQoKCQkJCXJldHVybiB0bXA7CgkJCX0KCQkJcmV0dXJuIHJlc3VsdHM7CgkJfTsKCgkvLyBDbGFzcwoJRXhwci5maW5kWyJDTEFTUyJdID0gc3VwcG9ydC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lICYmIGZ1bmN0aW9uKCBjbGFzc05hbWUsIGNvbnRleHQgKSB7CgkJaWYgKCBkb2N1bWVudElzSFRNTCApIHsKCQkJcmV0dXJuIGNvbnRleHQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSggY2xhc3NOYW1lICk7CgkJfQoJfTsKCgkvKiBRU0EvbWF0Y2hlc1NlbGVjdG9yCgktLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tICovCgoJLy8gUVNBIGFuZCBtYXRjaGVzU2VsZWN0b3Igc3VwcG9ydAoKCS8vIG1hdGNoZXNTZWxlY3Rvcig6YWN0aXZlKSByZXBvcnRzIGZhbHNlIHdoZW4gdHJ1ZSAoSUU5L09wZXJhIDExLjUpCglyYnVnZ3lNYXRjaGVzID0gW107CgoJLy8gcVNhKDpmb2N1cykgcmVwb3J0cyBmYWxzZSB3aGVuIHRydWUgKENocm9tZSAyMSkKCS8vIFdlIGFsbG93IHRoaXMgYmVjYXVzZSBvZiBhIGJ1ZyBpbiBJRTgvOSB0aGF0IHRocm93cyBhbiBlcnJvcgoJLy8gd2hlbmV2ZXIgYGRvY3VtZW50LmFjdGl2ZUVsZW1lbnRgIGlzIGFjY2Vzc2VkIG9uIGFuIGlmcmFtZQoJLy8gU28sIHdlIGFsbG93IDpmb2N1cyB0byBwYXNzIHRocm91Z2ggUVNBIGFsbCB0aGUgdGltZSB0byBhdm9pZCB0aGUgSUUgZXJyb3IKCS8vIFNlZSBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMzM3OAoJcmJ1Z2d5UVNBID0gW107CgoJaWYgKCAoc3VwcG9ydC5xc2EgPSBybmF0aXZlLnRlc3QoIGRvYy5xdWVyeVNlbGVjdG9yQWxsICkpICkgewoJCS8vIEJ1aWxkIFFTQSByZWdleAoJCS8vIFJlZ2V4IHN0cmF0ZWd5IGFkb3B0ZWQgZnJvbSBEaWVnbyBQZXJpbmkKCQlhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkJLy8gU2VsZWN0IGlzIHNldCB0byBlbXB0eSBzdHJpbmcgb24gcHVycG9zZQoJCQkvLyBUaGlzIGlzIHRvIHRlc3QgSUUncyB0cmVhdG1lbnQgb2Ygbm90IGV4cGxpY2l0bHkKCQkJLy8gc2V0dGluZyBhIGJvb2xlYW4gY29udGVudCBhdHRyaWJ1dGUsCgkJCS8vIHNpbmNlIGl0cyBwcmVzZW5jZSBzaG91bGQgYmUgZW5vdWdoCgkJCS8vIGh0dHA6Ly9idWdzLmpxdWVyeS5jb20vdGlja2V0LzEyMzU5CgkJCWRvY0VsZW0uYXBwZW5kQ2hpbGQoIGRpdiApLmlubmVySFRNTCA9ICI8YSBpZD0nIiArIGV4cGFuZG8gKyAiJz48L2E+IiArCgkJCQkiPHNlbGVjdCBpZD0nIiArIGV4cGFuZG8gKyAiLVxmXScgbXNhbGxvd2NhcHR1cmU9Jyc+IiArCgkJCQkiPG9wdGlvbiBzZWxlY3RlZD0nJz48L29wdGlvbj48L3NlbGVjdD4iOwoKCQkJLy8gU3VwcG9ydDogSUU4LCBPcGVyYSAxMS0xMi4xNgoJCQkvLyBOb3RoaW5nIHNob3VsZCBiZSBzZWxlY3RlZCB3aGVuIGVtcHR5IHN0cmluZ3MgZm9sbG93IF49IG9yICQ9IG9yICo9CgkJCS8vIFRoZSB0ZXN0IGF0dHJpYnV0ZSBtdXN0IGJlIHVua25vd24gaW4gT3BlcmEgYnV0ICJzYWZlIiBmb3IgV2luUlQKCQkJLy8gaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2llL2hoNDY1Mzg4LmFzcHgjYXR0cmlidXRlX3NlY3Rpb24KCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW21zYWxsb3djYXB0dXJlXj0nJ10iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIlsqXiRdPSIgKyB3aGl0ZXNwYWNlICsgIiooPzonJ3xcIlwiKSIgKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUU4CgkJCS8vIEJvb2xlYW4gYXR0cmlidXRlcyBhbmQgInZhbHVlIiBhcmUgbm90IHRyZWF0ZWQgY29ycmVjdGx5CgkJCWlmICggIWRpdi5xdWVyeVNlbGVjdG9yQWxsKCJbc2VsZWN0ZWRdIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICJcXFsiICsgd2hpdGVzcGFjZSArICIqKD86dmFsdWV8IiArIGJvb2xlYW5zICsgIikiICk7CgkJCX0KCgkJCS8vIFN1cHBvcnQ6IENocm9tZTwyOSwgQW5kcm9pZDw0LjIrLCBTYWZhcmk8Ny4wKywgaU9TPDcuMCssIFBoYW50b21KUzwxLjkuNysKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoICJbaWR+PSIgKyBleHBhbmRvICsgIi1dIiApLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCJ+PSIpOwoJCQl9CgoJCQkvLyBXZWJraXQvT3BlcmEgLSA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIHNlbGVjdGVkIG9wdGlvbiBlbGVtZW50cwoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi8yMDExL1JFQy1jc3MzLXNlbGVjdG9ycy0yMDExMDkyOS8jY2hlY2tlZAoJCQkvLyBJRTggdGhyb3dzIGVycm9yIGhlcmUgYW5kIHdpbGwgbm90IHNlZSBsYXRlciB0ZXN0cwoJCQlpZiAoICFkaXYucXVlcnlTZWxlY3RvckFsbCgiOmNoZWNrZWQiKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCgiOmNoZWNrZWQiKTsKCQkJfQoKCQkJLy8gU3VwcG9ydDogU2FmYXJpIDgrLCBpT1MgOCsKCQkJLy8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTEzNjg1MQoJCQkvLyBJbi1wYWdlIGBzZWxlY3RvciNpZCBzaWJpbmctY29tYmluYXRvciBzZWxlY3RvcmAgZmFpbHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoICJhIyIgKyBleHBhbmRvICsgIisqIiApLmxlbmd0aCApIHsKCQkJCXJidWdneVFTQS5wdXNoKCIuIy4rWyt+XSIpOwoJCQl9CgkJfSk7CgoJCWFzc2VydChmdW5jdGlvbiggZGl2ICkgewoJCQkvLyBTdXBwb3J0OiBXaW5kb3dzIDggTmF0aXZlIEFwcHMKCQkJLy8gVGhlIHR5cGUgYW5kIG5hbWUgYXR0cmlidXRlcyBhcmUgcmVzdHJpY3RlZCBkdXJpbmcgLmlubmVySFRNTCBhc3NpZ25tZW50CgkJCXZhciBpbnB1dCA9IGRvYy5jcmVhdGVFbGVtZW50KCJpbnB1dCIpOwoJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoICJ0eXBlIiwgImhpZGRlbiIgKTsKCQkJZGl2LmFwcGVuZENoaWxkKCBpbnB1dCApLnNldEF0dHJpYnV0ZSggIm5hbWUiLCAiRCIgKTsKCgkJCS8vIFN1cHBvcnQ6IElFOAoJCQkvLyBFbmZvcmNlIGNhc2Utc2Vuc2l0aXZpdHkgb2YgbmFtZSBhdHRyaWJ1dGUKCQkJaWYgKCBkaXYucXVlcnlTZWxlY3RvckFsbCgiW25hbWU9ZF0iKS5sZW5ndGggKSB7CgkJCQlyYnVnZ3lRU0EucHVzaCggIm5hbWUiICsgd2hpdGVzcGFjZSArICIqWypeJHwhfl0/PSIgKTsKCQkJfQoKCQkJLy8gRkYgMy41IC0gOmVuYWJsZWQvOmRpc2FibGVkIGFuZCBoaWRkZW4gZWxlbWVudHMgKGhpZGRlbiBlbGVtZW50cyBhcmUgc3RpbGwgZW5hYmxlZCkKCQkJLy8gSUU4IHRocm93cyBlcnJvciBoZXJlIGFuZCB3aWxsIG5vdCBzZWUgbGF0ZXIgdGVzdHMKCQkJaWYgKCAhZGl2LnF1ZXJ5U2VsZWN0b3JBbGwoIjplbmFibGVkIikubGVuZ3RoICkgewoJCQkJcmJ1Z2d5UVNBLnB1c2goICI6ZW5hYmxlZCIsICI6ZGlzYWJsZWQiICk7CgkJCX0KCgkJCS8vIE9wZXJhIDEwLTExIGRvZXMgbm90IHRocm93IG9uIHBvc3QtY29tbWEgaW52YWxpZCBwc2V1ZG9zCgkJCWRpdi5xdWVyeVNlbGVjdG9yQWxsKCIqLDp4Iik7CgkJCXJidWdneVFTQS5wdXNoKCIsLio6Iik7CgkJfSk7Cgl9CgoJaWYgKCAoc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgPSBybmF0aXZlLnRlc3QoIChtYXRjaGVzID0gZG9jRWxlbS5tYXRjaGVzIHx8CgkJZG9jRWxlbS53ZWJraXRNYXRjaGVzU2VsZWN0b3IgfHwKCQlkb2NFbGVtLm1vek1hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ub01hdGNoZXNTZWxlY3RvciB8fAoJCWRvY0VsZW0ubXNNYXRjaGVzU2VsZWN0b3IpICkpICkgewoKCQlhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCQkJLy8gQ2hlY2sgdG8gc2VlIGlmIGl0J3MgcG9zc2libGUgdG8gZG8gbWF0Y2hlc1NlbGVjdG9yCgkJCS8vIG9uIGEgZGlzY29ubmVjdGVkIG5vZGUgKElFIDkpCgkJCXN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggPSBtYXRjaGVzLmNhbGwoIGRpdiwgImRpdiIgKTsKCgkJCS8vIFRoaXMgc2hvdWxkIGZhaWwgd2l0aCBhbiBleGNlcHRpb24KCQkJLy8gR2Vja28gZG9lcyBub3QgZXJyb3IsIHJldHVybnMgZmFsc2UgaW5zdGVhZAoJCQltYXRjaGVzLmNhbGwoIGRpdiwgIltzIT0nJ106eCIgKTsKCQkJcmJ1Z2d5TWF0Y2hlcy5wdXNoKCAiIT0iLCBwc2V1ZG9zICk7CgkJfSk7Cgl9CgoJcmJ1Z2d5UVNBID0gcmJ1Z2d5UVNBLmxlbmd0aCAmJiBuZXcgUmVnRXhwKCByYnVnZ3lRU0Euam9pbigifCIpICk7CglyYnVnZ3lNYXRjaGVzID0gcmJ1Z2d5TWF0Y2hlcy5sZW5ndGggJiYgbmV3IFJlZ0V4cCggcmJ1Z2d5TWF0Y2hlcy5qb2luKCJ8IikgKTsKCgkvKiBDb250YWlucwoJLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqLwoJaGFzQ29tcGFyZSA9IHJuYXRpdmUudGVzdCggZG9jRWxlbS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiApOwoKCS8vIEVsZW1lbnQgY29udGFpbnMgYW5vdGhlcgoJLy8gUHVycG9zZWZ1bGx5IGRvZXMgbm90IGltcGxlbWVudCBpbmNsdXNpdmUgZGVzY2VuZGVudAoJLy8gQXMgaW4sIGFuIGVsZW1lbnQgZG9lcyBub3QgY29udGFpbiBpdHNlbGYKCWNvbnRhaW5zID0gaGFzQ29tcGFyZSB8fCBybmF0aXZlLnRlc3QoIGRvY0VsZW0uY29udGFpbnMgKSA/CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCXZhciBhZG93biA9IGEubm9kZVR5cGUgPT09IDkgPyBhLmRvY3VtZW50RWxlbWVudCA6IGEsCgkJCQlidXAgPSBiICYmIGIucGFyZW50Tm9kZTsKCQkJcmV0dXJuIGEgPT09IGJ1cCB8fCAhISggYnVwICYmIGJ1cC5ub2RlVHlwZSA9PT0gMSAmJiAoCgkJCQlhZG93bi5jb250YWlucyA/CgkJCQkJYWRvd24uY29udGFpbnMoIGJ1cCApIDoKCQkJCQlhLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uICYmIGEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGJ1cCApICYgMTYKCQkJKSk7CgkJfSA6CgkJZnVuY3Rpb24oIGEsIGIgKSB7CgkJCWlmICggYiApIHsKCQkJCXdoaWxlICggKGIgPSBiLnBhcmVudE5vZGUpICkgewoJCQkJCWlmICggYiA9PT0gYSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJCXJldHVybiBmYWxzZTsKCQl9OwoKCS8qIFNvcnRpbmcKCS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gKi8KCgkvLyBEb2N1bWVudCBvcmRlciBzb3J0aW5nCglzb3J0T3JkZXIgPSBoYXNDb21wYXJlID8KCWZ1bmN0aW9uKCBhLCBiICkgewoKCQkvLyBGbGFnIGZvciBkdXBsaWNhdGUgcmVtb3ZhbAoJCWlmICggYSA9PT0gYiApIHsKCQkJaGFzRHVwbGljYXRlID0gdHJ1ZTsKCQkJcmV0dXJuIDA7CgkJfQoKCQkvLyBTb3J0IG9uIG1ldGhvZCBleGlzdGVuY2UgaWYgb25seSBvbmUgaW5wdXQgaGFzIGNvbXBhcmVEb2N1bWVudFBvc2l0aW9uCgkJdmFyIGNvbXBhcmUgPSAhYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiAtICFiLmNvbXBhcmVEb2N1bWVudFBvc2l0aW9uOwoJCWlmICggY29tcGFyZSApIHsKCQkJcmV0dXJuIGNvbXBhcmU7CgkJfQoKCQkvLyBDYWxjdWxhdGUgcG9zaXRpb24gaWYgYm90aCBpbnB1dHMgYmVsb25nIHRvIHRoZSBzYW1lIGRvY3VtZW50CgkJY29tcGFyZSA9ICggYS5vd25lckRvY3VtZW50IHx8IGEgKSA9PT0gKCBiLm93bmVyRG9jdW1lbnQgfHwgYiApID8KCQkJYS5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYiApIDoKCgkJCS8vIE90aGVyd2lzZSB3ZSBrbm93IHRoZXkgYXJlIGRpc2Nvbm5lY3RlZAoJCQkxOwoKCQkvLyBEaXNjb25uZWN0ZWQgbm9kZXMKCQlpZiAoIGNvbXBhcmUgJiAxIHx8CgkJCSghc3VwcG9ydC5zb3J0RGV0YWNoZWQgJiYgYi5jb21wYXJlRG9jdW1lbnRQb3NpdGlvbiggYSApID09PSBjb21wYXJlKSApIHsKCgkJCS8vIENob29zZSB0aGUgZmlyc3QgZWxlbWVudCB0aGF0IGlzIHJlbGF0ZWQgdG8gb3VyIHByZWZlcnJlZCBkb2N1bWVudAoJCQlpZiAoIGEgPT09IGRvYyB8fCBhLm93bmVyRG9jdW1lbnQgPT09IHByZWZlcnJlZERvYyAmJiBjb250YWlucyhwcmVmZXJyZWREb2MsIGEpICkgewoJCQkJcmV0dXJuIC0xOwoJCQl9CgkJCWlmICggYiA9PT0gZG9jIHx8IGIub3duZXJEb2N1bWVudCA9PT0gcHJlZmVycmVkRG9jICYmIGNvbnRhaW5zKHByZWZlcnJlZERvYywgYikgKSB7CgkJCQlyZXR1cm4gMTsKCQkJfQoKCQkJLy8gTWFpbnRhaW4gb3JpZ2luYWwgb3JkZXIKCQkJcmV0dXJuIHNvcnRJbnB1dCA/CgkJCQkoIGluZGV4T2YoIHNvcnRJbnB1dCwgYSApIC0gaW5kZXhPZiggc29ydElucHV0LCBiICkgKSA6CgkJCQkwOwoJCX0KCgkJcmV0dXJuIGNvbXBhcmUgJiA0ID8gLTEgOiAxOwoJfSA6CglmdW5jdGlvbiggYSwgYiApIHsKCQkvLyBFeGl0IGVhcmx5IGlmIHRoZSBub2RlcyBhcmUgaWRlbnRpY2FsCgkJaWYgKCBhID09PSBiICkgewoJCQloYXNEdXBsaWNhdGUgPSB0cnVlOwoJCQlyZXR1cm4gMDsKCQl9CgoJCXZhciBjdXIsCgkJCWkgPSAwLAoJCQlhdXAgPSBhLnBhcmVudE5vZGUsCgkJCWJ1cCA9IGIucGFyZW50Tm9kZSwKCQkJYXAgPSBbIGEgXSwKCQkJYnAgPSBbIGIgXTsKCgkJLy8gUGFyZW50bGVzcyBub2RlcyBhcmUgZWl0aGVyIGRvY3VtZW50cyBvciBkaXNjb25uZWN0ZWQKCQlpZiAoICFhdXAgfHwgIWJ1cCApIHsKCQkJcmV0dXJuIGEgPT09IGRvYyA/IC0xIDoKCQkJCWIgPT09IGRvYyA/IDEgOgoJCQkJYXVwID8gLTEgOgoJCQkJYnVwID8gMSA6CgkJCQlzb3J0SW5wdXQgPwoJCQkJKCBpbmRleE9mKCBzb3J0SW5wdXQsIGEgKSAtIGluZGV4T2YoIHNvcnRJbnB1dCwgYiApICkgOgoJCQkJMDsKCgkJLy8gSWYgdGhlIG5vZGVzIGFyZSBzaWJsaW5ncywgd2UgY2FuIGRvIGEgcXVpY2sgY2hlY2sKCQl9IGVsc2UgaWYgKCBhdXAgPT09IGJ1cCApIHsKCQkJcmV0dXJuIHNpYmxpbmdDaGVjayggYSwgYiApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlIHdlIG5lZWQgZnVsbCBsaXN0cyBvZiB0aGVpciBhbmNlc3RvcnMgZm9yIGNvbXBhcmlzb24KCQljdXIgPSBhOwoJCXdoaWxlICggKGN1ciA9IGN1ci5wYXJlbnROb2RlKSApIHsKCQkJYXAudW5zaGlmdCggY3VyICk7CgkJfQoJCWN1ciA9IGI7CgkJd2hpbGUgKCAoY3VyID0gY3VyLnBhcmVudE5vZGUpICkgewoJCQlicC51bnNoaWZ0KCBjdXIgKTsKCQl9CgoJCS8vIFdhbGsgZG93biB0aGUgdHJlZSBsb29raW5nIGZvciBhIGRpc2NyZXBhbmN5CgkJd2hpbGUgKCBhcFtpXSA9PT0gYnBbaV0gKSB7CgkJCWkrKzsKCQl9CgoJCXJldHVybiBpID8KCQkJLy8gRG8gYSBzaWJsaW5nIGNoZWNrIGlmIHRoZSBub2RlcyBoYXZlIGEgY29tbW9uIGFuY2VzdG9yCgkJCXNpYmxpbmdDaGVjayggYXBbaV0sIGJwW2ldICkgOgoKCQkJLy8gT3RoZXJ3aXNlIG5vZGVzIGluIG91ciBkb2N1bWVudCBzb3J0IGZpcnN0CgkJCWFwW2ldID09PSBwcmVmZXJyZWREb2MgPyAtMSA6CgkJCWJwW2ldID09PSBwcmVmZXJyZWREb2MgPyAxIDoKCQkJMDsKCX07CgoJcmV0dXJuIGRvYzsKfTsKClNpenpsZS5tYXRjaGVzID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1lbnRzICkgewoJcmV0dXJuIFNpenpsZSggZXhwciwgbnVsbCwgbnVsbCwgZWxlbWVudHMgKTsKfTsKClNpenpsZS5tYXRjaGVzU2VsZWN0b3IgPSBmdW5jdGlvbiggZWxlbSwgZXhwciApIHsKCS8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAoJaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgewoJCXNldERvY3VtZW50KCBlbGVtICk7Cgl9CgoJLy8gTWFrZSBzdXJlIHRoYXQgYXR0cmlidXRlIHNlbGVjdG9ycyBhcmUgcXVvdGVkCglleHByID0gZXhwci5yZXBsYWNlKCByYXR0cmlidXRlUXVvdGVzLCAiPSckMSddIiApOwoKCWlmICggc3VwcG9ydC5tYXRjaGVzU2VsZWN0b3IgJiYgZG9jdW1lbnRJc0hUTUwgJiYKCQkoICFyYnVnZ3lNYXRjaGVzIHx8ICFyYnVnZ3lNYXRjaGVzLnRlc3QoIGV4cHIgKSApICYmCgkJKCAhcmJ1Z2d5UVNBICAgICB8fCAhcmJ1Z2d5UVNBLnRlc3QoIGV4cHIgKSApICkgewoKCQl0cnkgewoJCQl2YXIgcmV0ID0gbWF0Y2hlcy5jYWxsKCBlbGVtLCBleHByICk7CgoJCQkvLyBJRSA5J3MgbWF0Y2hlc1NlbGVjdG9yIHJldHVybnMgZmFsc2Ugb24gZGlzY29ubmVjdGVkIG5vZGVzCgkJCWlmICggcmV0IHx8IHN1cHBvcnQuZGlzY29ubmVjdGVkTWF0Y2ggfHwKCQkJCQkvLyBBcyB3ZWxsLCBkaXNjb25uZWN0ZWQgbm9kZXMgYXJlIHNhaWQgdG8gYmUgaW4gYSBkb2N1bWVudAoJCQkJCS8vIGZyYWdtZW50IGluIElFIDkKCQkJCQllbGVtLmRvY3VtZW50ICYmIGVsZW0uZG9jdW1lbnQubm9kZVR5cGUgIT09IDExICkgewoJCQkJcmV0dXJuIHJldDsKCQkJfQoJCX0gY2F0Y2ggKGUpIHt9Cgl9CgoJcmV0dXJuIFNpenpsZSggZXhwciwgZG9jdW1lbnQsIG51bGwsIFsgZWxlbSBdICkubGVuZ3RoID4gMDsKfTsKClNpenpsZS5jb250YWlucyA9IGZ1bmN0aW9uKCBjb250ZXh0LCBlbGVtICkgewoJLy8gU2V0IGRvY3VtZW50IHZhcnMgaWYgbmVlZGVkCglpZiAoICggY29udGV4dC5vd25lckRvY3VtZW50IHx8IGNvbnRleHQgKSAhPT0gZG9jdW1lbnQgKSB7CgkJc2V0RG9jdW1lbnQoIGNvbnRleHQgKTsKCX0KCXJldHVybiBjb250YWlucyggY29udGV4dCwgZWxlbSApOwp9OwoKU2l6emxlLmF0dHIgPSBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCS8vIFNldCBkb2N1bWVudCB2YXJzIGlmIG5lZWRlZAoJaWYgKCAoIGVsZW0ub3duZXJEb2N1bWVudCB8fCBlbGVtICkgIT09IGRvY3VtZW50ICkgewoJCXNldERvY3VtZW50KCBlbGVtICk7Cgl9CgoJdmFyIGZuID0gRXhwci5hdHRySGFuZGxlWyBuYW1lLnRvTG93ZXJDYXNlKCkgXSwKCQkvLyBEb24ndCBnZXQgZm9vbGVkIGJ5IE9iamVjdC5wcm90b3R5cGUgcHJvcGVydGllcyAoalF1ZXJ5ICMxMzgwNykKCQl2YWwgPSBmbiAmJiBoYXNPd24uY2FsbCggRXhwci5hdHRySGFuZGxlLCBuYW1lLnRvTG93ZXJDYXNlKCkgKSA/CgkJCWZuKCBlbGVtLCBuYW1lLCAhZG9jdW1lbnRJc0hUTUwgKSA6CgkJCXVuZGVmaW5lZDsKCglyZXR1cm4gdmFsICE9PSB1bmRlZmluZWQgPwoJCXZhbCA6CgkJc3VwcG9ydC5hdHRyaWJ1dGVzIHx8ICFkb2N1bWVudElzSFRNTCA/CgkJCWVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICkgOgoJCQkodmFsID0gZWxlbS5nZXRBdHRyaWJ1dGVOb2RlKG5hbWUpKSAmJiB2YWwuc3BlY2lmaWVkID8KCQkJCXZhbC52YWx1ZSA6CgkJCQludWxsOwp9OwoKU2l6emxlLmVycm9yID0gZnVuY3Rpb24oIG1zZyApIHsKCXRocm93IG5ldyBFcnJvciggIlN5bnRheCBlcnJvciwgdW5yZWNvZ25pemVkIGV4cHJlc3Npb246ICIgKyBtc2cgKTsKfTsKCi8qKgogKiBEb2N1bWVudCBzb3J0aW5nIGFuZCByZW1vdmluZyBkdXBsaWNhdGVzCiAqIEBwYXJhbSB7QXJyYXlMaWtlfSByZXN1bHRzCiAqLwpTaXp6bGUudW5pcXVlU29ydCA9IGZ1bmN0aW9uKCByZXN1bHRzICkgewoJdmFyIGVsZW0sCgkJZHVwbGljYXRlcyA9IFtdLAoJCWogPSAwLAoJCWkgPSAwOwoKCS8vIFVubGVzcyB3ZSAqa25vdyogd2UgY2FuIGRldGVjdCBkdXBsaWNhdGVzLCBhc3N1bWUgdGhlaXIgcHJlc2VuY2UKCWhhc0R1cGxpY2F0ZSA9ICFzdXBwb3J0LmRldGVjdER1cGxpY2F0ZXM7Cglzb3J0SW5wdXQgPSAhc3VwcG9ydC5zb3J0U3RhYmxlICYmIHJlc3VsdHMuc2xpY2UoIDAgKTsKCXJlc3VsdHMuc29ydCggc29ydE9yZGVyICk7CgoJaWYgKCBoYXNEdXBsaWNhdGUgKSB7CgkJd2hpbGUgKCAoZWxlbSA9IHJlc3VsdHNbaSsrXSkgKSB7CgkJCWlmICggZWxlbSA9PT0gcmVzdWx0c1sgaSBdICkgewoJCQkJaiA9IGR1cGxpY2F0ZXMucHVzaCggaSApOwoJCQl9CgkJfQoJCXdoaWxlICggai0tICkgewoJCQlyZXN1bHRzLnNwbGljZSggZHVwbGljYXRlc1sgaiBdLCAxICk7CgkJfQoJfQoKCS8vIENsZWFyIGlucHV0IGFmdGVyIHNvcnRpbmcgdG8gcmVsZWFzZSBvYmplY3RzCgkvLyBTZWUgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9zaXp6bGUvcHVsbC8yMjUKCXNvcnRJbnB1dCA9IG51bGw7CgoJcmV0dXJuIHJlc3VsdHM7Cn07CgovKioKICogVXRpbGl0eSBmdW5jdGlvbiBmb3IgcmV0cmlldmluZyB0aGUgdGV4dCB2YWx1ZSBvZiBhbiBhcnJheSBvZiBET00gbm9kZXMKICogQHBhcmFtIHtBcnJheXxFbGVtZW50fSBlbGVtCiAqLwpnZXRUZXh0ID0gU2l6emxlLmdldFRleHQgPSBmdW5jdGlvbiggZWxlbSApIHsKCXZhciBub2RlLAoJCXJldCA9ICIiLAoJCWkgPSAwLAoJCW5vZGVUeXBlID0gZWxlbS5ub2RlVHlwZTsKCglpZiAoICFub2RlVHlwZSApIHsKCQkvLyBJZiBubyBub2RlVHlwZSwgdGhpcyBpcyBleHBlY3RlZCB0byBiZSBhbiBhcnJheQoJCXdoaWxlICggKG5vZGUgPSBlbGVtW2krK10pICkgewoJCQkvLyBEbyBub3QgdHJhdmVyc2UgY29tbWVudCBub2RlcwoJCQlyZXQgKz0gZ2V0VGV4dCggbm9kZSApOwoJCX0KCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAxIHx8IG5vZGVUeXBlID09PSA5IHx8IG5vZGVUeXBlID09PSAxMSApIHsKCQkvLyBVc2UgdGV4dENvbnRlbnQgZm9yIGVsZW1lbnRzCgkJLy8gaW5uZXJUZXh0IHVzYWdlIHJlbW92ZWQgZm9yIGNvbnNpc3RlbmN5IG9mIG5ldyBsaW5lcyAoalF1ZXJ5ICMxMTE1MykKCQlpZiAoIHR5cGVvZiBlbGVtLnRleHRDb250ZW50ID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGVsZW0udGV4dENvbnRlbnQ7CgkJfSBlbHNlIHsKCQkJLy8gVHJhdmVyc2UgaXRzIGNoaWxkcmVuCgkJCWZvciAoIGVsZW0gPSBlbGVtLmZpcnN0Q2hpbGQ7IGVsZW07IGVsZW0gPSBlbGVtLm5leHRTaWJsaW5nICkgewoJCQkJcmV0ICs9IGdldFRleHQoIGVsZW0gKTsKCQkJfQoJCX0KCX0gZWxzZSBpZiAoIG5vZGVUeXBlID09PSAzIHx8IG5vZGVUeXBlID09PSA0ICkgewoJCXJldHVybiBlbGVtLm5vZGVWYWx1ZTsKCX0KCS8vIERvIG5vdCBpbmNsdWRlIGNvbW1lbnQgb3IgcHJvY2Vzc2luZyBpbnN0cnVjdGlvbiBub2RlcwoKCXJldHVybiByZXQ7Cn07CgpFeHByID0gU2l6emxlLnNlbGVjdG9ycyA9IHsKCgkvLyBDYW4gYmUgYWRqdXN0ZWQgYnkgdGhlIHVzZXIKCWNhY2hlTGVuZ3RoOiA1MCwKCgljcmVhdGVQc2V1ZG86IG1hcmtGdW5jdGlvbiwKCgltYXRjaDogbWF0Y2hFeHByLAoKCWF0dHJIYW5kbGU6IHt9LAoKCWZpbmQ6IHt9LAoKCXJlbGF0aXZlOiB7CgkJIj4iOiB7IGRpcjogInBhcmVudE5vZGUiLCBmaXJzdDogdHJ1ZSB9LAoJCSIgIjogeyBkaXI6ICJwYXJlbnROb2RlIiB9LAoJCSIrIjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciLCBmaXJzdDogdHJ1ZSB9LAoJCSJ+IjogeyBkaXI6ICJwcmV2aW91c1NpYmxpbmciIH0KCX0sCgoJcHJlRmlsdGVyOiB7CgkJIkFUVFIiOiBmdW5jdGlvbiggbWF0Y2ggKSB7CgkJCW1hdGNoWzFdID0gbWF0Y2hbMV0ucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCgkJCS8vIE1vdmUgdGhlIGdpdmVuIHZhbHVlIHRvIG1hdGNoWzNdIHdoZXRoZXIgcXVvdGVkIG9yIHVucXVvdGVkCgkJCW1hdGNoWzNdID0gKCBtYXRjaFszXSB8fCBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIiApLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICk7CgoJCQlpZiAoIG1hdGNoWzJdID09PSAifj0iICkgewoJCQkJbWF0Y2hbM10gPSAiICIgKyBtYXRjaFszXSArICIgIjsKCQkJfQoKCQkJcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCA0ICk7CgkJfSwKCgkJIkNISUxEIjogZnVuY3Rpb24oIG1hdGNoICkgewoJCQkvKiBtYXRjaGVzIGZyb20gbWF0Y2hFeHByWyJDSElMRCJdCgkJCQkxIHR5cGUgKG9ubHl8bnRofC4uLikKCQkJCTIgd2hhdCAoY2hpbGR8b2YtdHlwZSkKCQkJCTMgYXJndW1lbnQgKGV2ZW58b2RkfFxkKnxcZCpuKFsrLV1cZCspP3wuLi4pCgkJCQk0IHhuLWNvbXBvbmVudCBvZiB4bit5IGFyZ3VtZW50IChbKy1dP1xkKm58KQoJCQkJNSBzaWduIG9mIHhuLWNvbXBvbmVudAoJCQkJNiB4IG9mIHhuLWNvbXBvbmVudAoJCQkJNyBzaWduIG9mIHktY29tcG9uZW50CgkJCQk4IHkgb2YgeS1jb21wb25lbnQKCQkJKi8KCQkJbWF0Y2hbMV0gPSBtYXRjaFsxXS50b0xvd2VyQ2FzZSgpOwoKCQkJaWYgKCBtYXRjaFsxXS5zbGljZSggMCwgMyApID09PSAibnRoIiApIHsKCQkJCS8vIG50aC0qIHJlcXVpcmVzIGFyZ3VtZW50CgkJCQlpZiAoICFtYXRjaFszXSApIHsKCQkJCQlTaXp6bGUuZXJyb3IoIG1hdGNoWzBdICk7CgkJCQl9CgoJCQkJLy8gbnVtZXJpYyB4IGFuZCB5IHBhcmFtZXRlcnMgZm9yIEV4cHIuZmlsdGVyLkNISUxECgkJCQkvLyByZW1lbWJlciB0aGF0IGZhbHNlL3RydWUgY2FzdCByZXNwZWN0aXZlbHkgdG8gMC8xCgkJCQltYXRjaFs0XSA9ICsoIG1hdGNoWzRdID8gbWF0Y2hbNV0gKyAobWF0Y2hbNl0gfHwgMSkgOiAyICogKCBtYXRjaFszXSA9PT0gImV2ZW4iIHx8IG1hdGNoWzNdID09PSAib2RkIiApICk7CgkJCQltYXRjaFs1XSA9ICsoICggbWF0Y2hbN10gKyBtYXRjaFs4XSApIHx8IG1hdGNoWzNdID09PSAib2RkIiApOwoKCQkJLy8gb3RoZXIgdHlwZXMgcHJvaGliaXQgYXJndW1lbnRzCgkJCX0gZWxzZSBpZiAoIG1hdGNoWzNdICkgewoJCQkJU2l6emxlLmVycm9yKCBtYXRjaFswXSApOwoJCQl9CgoJCQlyZXR1cm4gbWF0Y2g7CgkJfSwKCgkJIlBTRVVETyI6IGZ1bmN0aW9uKCBtYXRjaCApIHsKCQkJdmFyIGV4Y2VzcywKCQkJCXVucXVvdGVkID0gIW1hdGNoWzZdICYmIG1hdGNoWzJdOwoKCQkJaWYgKCBtYXRjaEV4cHJbIkNISUxEIl0udGVzdCggbWF0Y2hbMF0gKSApIHsKCQkJCXJldHVybiBudWxsOwoJCQl9CgoJCQkvLyBBY2NlcHQgcXVvdGVkIGFyZ3VtZW50cyBhcy1pcwoJCQlpZiAoIG1hdGNoWzNdICkgewoJCQkJbWF0Y2hbMl0gPSBtYXRjaFs0XSB8fCBtYXRjaFs1XSB8fCAiIjsKCgkJCS8vIFN0cmlwIGV4Y2VzcyBjaGFyYWN0ZXJzIGZyb20gdW5xdW90ZWQgYXJndW1lbnRzCgkJCX0gZWxzZSBpZiAoIHVucXVvdGVkICYmIHJwc2V1ZG8udGVzdCggdW5xdW90ZWQgKSAmJgoJCQkJLy8gR2V0IGV4Y2VzcyBmcm9tIHRva2VuaXplIChyZWN1cnNpdmVseSkKCQkJCShleGNlc3MgPSB0b2tlbml6ZSggdW5xdW90ZWQsIHRydWUgKSkgJiYKCQkJCS8vIGFkdmFuY2UgdG8gdGhlIG5leHQgY2xvc2luZyBwYXJlbnRoZXNpcwoJCQkJKGV4Y2VzcyA9IHVucXVvdGVkLmluZGV4T2YoICIpIiwgdW5xdW90ZWQubGVuZ3RoIC0gZXhjZXNzICkgLSB1bnF1b3RlZC5sZW5ndGgpICkgewoKCQkJCS8vIGV4Y2VzcyBpcyBhIG5lZ2F0aXZlIGluZGV4CgkJCQltYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwLCBleGNlc3MgKTsKCQkJCW1hdGNoWzJdID0gdW5xdW90ZWQuc2xpY2UoIDAsIGV4Y2VzcyApOwoJCQl9CgoJCQkvLyBSZXR1cm4gb25seSBjYXB0dXJlcyBuZWVkZWQgYnkgdGhlIHBzZXVkbyBmaWx0ZXIgbWV0aG9kICh0eXBlIGFuZCBhcmd1bWVudCkKCQkJcmV0dXJuIG1hdGNoLnNsaWNlKCAwLCAzICk7CgkJfQoJfSwKCglmaWx0ZXI6IHsKCgkJIlRBRyI6IGZ1bmN0aW9uKCBub2RlTmFtZVNlbGVjdG9yICkgewoJCQl2YXIgbm9kZU5hbWUgPSBub2RlTmFtZVNlbGVjdG9yLnJlcGxhY2UoIHJ1bmVzY2FwZSwgZnVuZXNjYXBlICkudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5vZGVOYW1lU2VsZWN0b3IgPT09ICIqIiA/CgkJCQlmdW5jdGlvbigpIHsgcmV0dXJuIHRydWU7IH0gOgoJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBub2RlTmFtZTsKCQkJCX07CgkJfSwKCgkJIkNMQVNTIjogZnVuY3Rpb24oIGNsYXNzTmFtZSApIHsKCQkJdmFyIHBhdHRlcm4gPSBjbGFzc0NhY2hlWyBjbGFzc05hbWUgKyAiICIgXTsKCgkJCXJldHVybiBwYXR0ZXJuIHx8CgkJCQkocGF0dGVybiA9IG5ldyBSZWdFeHAoICIoXnwiICsgd2hpdGVzcGFjZSArICIpIiArIGNsYXNzTmFtZSArICIoIiArIHdoaXRlc3BhY2UgKyAifCQpIiApKSAmJgoJCQkJY2xhc3NDYWNoZSggY2xhc3NOYW1lLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJCQlyZXR1cm4gcGF0dGVybi50ZXN0KCB0eXBlb2YgZWxlbS5jbGFzc05hbWUgPT09ICJzdHJpbmciICYmIGVsZW0uY2xhc3NOYW1lIHx8IHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSAhPT0gInVuZGVmaW5lZCIgJiYgZWxlbS5nZXRBdHRyaWJ1dGUoImNsYXNzIikgfHwgIiIgKTsKCQkJCX0pOwoJCX0sCgoJCSJBVFRSIjogZnVuY3Rpb24oIG5hbWUsIG9wZXJhdG9yLCBjaGVjayApIHsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJdmFyIHJlc3VsdCA9IFNpenpsZS5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkJaWYgKCByZXN1bHQgPT0gbnVsbCApIHsKCQkJCQlyZXR1cm4gb3BlcmF0b3IgPT09ICIhPSI7CgkJCQl9CgkJCQlpZiAoICFvcGVyYXRvciApIHsKCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCX0KCgkJCQlyZXN1bHQgKz0gIiI7CgoJCQkJcmV0dXJuIG9wZXJhdG9yID09PSAiPSIgPyByZXN1bHQgPT09IGNoZWNrIDoKCQkJCQlvcGVyYXRvciA9PT0gIiE9IiA/IHJlc3VsdCAhPT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAiXj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPT09IDAgOgoJCQkJCW9wZXJhdG9yID09PSAiKj0iID8gY2hlY2sgJiYgcmVzdWx0LmluZGV4T2YoIGNoZWNrICkgPiAtMSA6CgkJCQkJb3BlcmF0b3IgPT09ICIkPSIgPyBjaGVjayAmJiByZXN1bHQuc2xpY2UoIC1jaGVjay5sZW5ndGggKSA9PT0gY2hlY2sgOgoJCQkJCW9wZXJhdG9yID09PSAifj0iID8gKCAiICIgKyByZXN1bHQucmVwbGFjZSggcndoaXRlc3BhY2UsICIgIiApICsgIiAiICkuaW5kZXhPZiggY2hlY2sgKSA+IC0xIDoKCQkJCQlvcGVyYXRvciA9PT0gInw9IiA/IHJlc3VsdCA9PT0gY2hlY2sgfHwgcmVzdWx0LnNsaWNlKCAwLCBjaGVjay5sZW5ndGggKyAxICkgPT09IGNoZWNrICsgIi0iIDoKCQkJCQlmYWxzZTsKCQkJfTsKCQl9LAoKCQkiQ0hJTEQiOiBmdW5jdGlvbiggdHlwZSwgd2hhdCwgYXJndW1lbnQsIGZpcnN0LCBsYXN0ICkgewoJCQl2YXIgc2ltcGxlID0gdHlwZS5zbGljZSggMCwgMyApICE9PSAibnRoIiwKCQkJCWZvcndhcmQgPSB0eXBlLnNsaWNlKCAtNCApICE9PSAibGFzdCIsCgkJCQlvZlR5cGUgPSB3aGF0ID09PSAib2YtdHlwZSI7CgoJCQlyZXR1cm4gZmlyc3QgPT09IDEgJiYgbGFzdCA9PT0gMCA/CgoJCQkJLy8gU2hvcnRjdXQgZm9yIDpudGgtKihuKQoJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJcmV0dXJuICEhZWxlbS5wYXJlbnROb2RlOwoJCQkJfSA6CgoJCQkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJCQl2YXIgY2FjaGUsIG91dGVyQ2FjaGUsIG5vZGUsIGRpZmYsIG5vZGVJbmRleCwgc3RhcnQsCgkJCQkJCWRpciA9IHNpbXBsZSAhPT0gZm9yd2FyZCA/ICJuZXh0U2libGluZyIgOiAicHJldmlvdXNTaWJsaW5nIiwKCQkJCQkJcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlLAoJCQkJCQluYW1lID0gb2ZUeXBlICYmIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSwKCQkJCQkJdXNlQ2FjaGUgPSAheG1sICYmICFvZlR5cGU7CgoJCQkJCWlmICggcGFyZW50ICkgewoKCQkJCQkJLy8gOihmaXJzdHxsYXN0fG9ubHkpLShjaGlsZHxvZi10eXBlKQoJCQkJCQlpZiAoIHNpbXBsZSApIHsKCQkJCQkJCXdoaWxlICggZGlyICkgewoJCQkJCQkJCW5vZGUgPSBlbGVtOwoJCQkJCQkJCXdoaWxlICggKG5vZGUgPSBub2RlWyBkaXIgXSkgKSB7CgkJCQkJCQkJCWlmICggb2ZUeXBlID8gbm9kZS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBuYW1lIDogbm9kZS5ub2RlVHlwZSA9PT0gMSApIHsKCQkJCQkJCQkJCXJldHVybiBmYWxzZTsKCQkJCQkJCQkJfQoJCQkJCQkJCX0KCQkJCQkJCQkvLyBSZXZlcnNlIGRpcmVjdGlvbiBmb3IgOm9ubHktKiAoaWYgd2UgaGF2ZW4ndCB5ZXQgZG9uZSBzbykKCQkJCQkJCQlzdGFydCA9IGRpciA9IHR5cGUgPT09ICJvbmx5IiAmJiAhc3RhcnQgJiYgIm5leHRTaWJsaW5nIjsKCQkJCQkJCX0KCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgoJCQkJCQlzdGFydCA9IFsgZm9yd2FyZCA/IHBhcmVudC5maXJzdENoaWxkIDogcGFyZW50Lmxhc3RDaGlsZCBdOwoKCQkJCQkJLy8gbm9uLXhtbCA6bnRoLWNoaWxkKC4uLikgc3RvcmVzIGNhY2hlIGRhdGEgb24gYHBhcmVudGAKCQkJCQkJaWYgKCBmb3J3YXJkICYmIHVzZUNhY2hlICkgewoJCQkJCQkJLy8gU2VlayBgZWxlbWAgZnJvbSBhIHByZXZpb3VzbHktY2FjaGVkIGluZGV4CgkJCQkJCQlvdXRlckNhY2hlID0gcGFyZW50WyBleHBhbmRvIF0gfHwgKHBhcmVudFsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQkJY2FjaGUgPSBvdXRlckNhY2hlWyB0eXBlIF0gfHwgW107CgkJCQkJCQlub2RlSW5kZXggPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsxXTsKCQkJCQkJCWRpZmYgPSBjYWNoZVswXSA9PT0gZGlycnVucyAmJiBjYWNoZVsyXTsKCQkJCQkJCW5vZGUgPSBub2RlSW5kZXggJiYgcGFyZW50LmNoaWxkTm9kZXNbIG5vZGVJbmRleCBdOwoKCQkJCQkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8CgoJCQkJCQkJCS8vIEZhbGxiYWNrIHRvIHNlZWtpbmcgYGVsZW1gIGZyb20gdGhlIHN0YXJ0CgkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCS8vIFdoZW4gZm91bmQsIGNhY2hlIGluZGV4ZXMgb24gYHBhcmVudGAgYW5kIGJyZWFrCgkJCQkJCQkJaWYgKCBub2RlLm5vZGVUeXBlID09PSAxICYmICsrZGlmZiAmJiBub2RlID09PSBlbGVtICkgewoJCQkJCQkJCQlvdXRlckNhY2hlWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIG5vZGVJbmRleCwgZGlmZiBdOwoJCQkJCQkJCQlicmVhazsKCQkJCQkJCQl9CgkJCQkJCQl9CgoJCQkJCQkvLyBVc2UgcHJldmlvdXNseS1jYWNoZWQgZWxlbWVudCBpbmRleCBpZiBhdmFpbGFibGUKCQkJCQkJfSBlbHNlIGlmICggdXNlQ2FjaGUgJiYgKGNhY2hlID0gKGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pKVsgdHlwZSBdKSAmJiBjYWNoZVswXSA9PT0gZGlycnVucyApIHsKCQkJCQkJCWRpZmYgPSBjYWNoZVsxXTsKCgkJCQkJCS8vIHhtbCA6bnRoLWNoaWxkKC4uLikgb3IgOm50aC1sYXN0LWNoaWxkKC4uLikgb3IgOm50aCgtbGFzdCk/LW9mLXR5cGUoLi4uKQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gVXNlIHRoZSBzYW1lIGxvb3AgYXMgYWJvdmUgdG8gc2VlayBgZWxlbWAgZnJvbSB0aGUgc3RhcnQKCQkJCQkJCXdoaWxlICggKG5vZGUgPSArK25vZGVJbmRleCAmJiBub2RlICYmIG5vZGVbIGRpciBdIHx8CgkJCQkJCQkJKGRpZmYgPSBub2RlSW5kZXggPSAwKSB8fCBzdGFydC5wb3AoKSkgKSB7CgoJCQkJCQkJCWlmICggKCBvZlR5cGUgPyBub2RlLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgPT09IG5hbWUgOiBub2RlLm5vZGVUeXBlID09PSAxICkgJiYgKytkaWZmICkgewoJCQkJCQkJCQkvLyBDYWNoZSB0aGUgaW5kZXggb2YgZWFjaCBlbmNvdW50ZXJlZCBlbGVtZW50CgkJCQkJCQkJCWlmICggdXNlQ2FjaGUgKSB7CgkJCQkJCQkJCQkobm9kZVsgZXhwYW5kbyBdIHx8IChub2RlWyBleHBhbmRvIF0gPSB7fSkpWyB0eXBlIF0gPSBbIGRpcnJ1bnMsIGRpZmYgXTsKCQkJCQkJCQkJfQoKCQkJCQkJCQkJaWYgKCBub2RlID09PSBlbGVtICkgewoJCQkJCQkJCQkJYnJlYWs7CgkJCQkJCQkJCX0KCQkJCQkJCQl9CgkJCQkJCQl9CgkJCQkJCX0KCgkJCQkJCS8vIEluY29ycG9yYXRlIHRoZSBvZmZzZXQsIHRoZW4gY2hlY2sgYWdhaW5zdCBjeWNsZSBzaXplCgkJCQkJCWRpZmYgLT0gbGFzdDsKCQkJCQkJcmV0dXJuIGRpZmYgPT09IGZpcnN0IHx8ICggZGlmZiAlIGZpcnN0ID09PSAwICYmIGRpZmYgLyBmaXJzdCA+PSAwICk7CgkJCQkJfQoJCQkJfTsKCQl9LAoKCQkiUFNFVURPIjogZnVuY3Rpb24oIHBzZXVkbywgYXJndW1lbnQgKSB7CgkJCS8vIHBzZXVkby1jbGFzcyBuYW1lcyBhcmUgY2FzZS1pbnNlbnNpdGl2ZQoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI3BzZXVkby1jbGFzc2VzCgkJCS8vIFByaW9yaXRpemUgYnkgY2FzZSBzZW5zaXRpdml0eSBpbiBjYXNlIGN1c3RvbSBwc2V1ZG9zIGFyZSBhZGRlZCB3aXRoIHVwcGVyY2FzZSBsZXR0ZXJzCgkJCS8vIFJlbWVtYmVyIHRoYXQgc2V0RmlsdGVycyBpbmhlcml0cyBmcm9tIHBzZXVkb3MKCQkJdmFyIGFyZ3MsCgkJCQlmbiA9IEV4cHIucHNldWRvc1sgcHNldWRvIF0gfHwgRXhwci5zZXRGaWx0ZXJzWyBwc2V1ZG8udG9Mb3dlckNhc2UoKSBdIHx8CgkJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgcHNldWRvOiAiICsgcHNldWRvICk7CgoJCQkvLyBUaGUgdXNlciBtYXkgdXNlIGNyZWF0ZVBzZXVkbyB0byBpbmRpY2F0ZSB0aGF0CgkJCS8vIGFyZ3VtZW50cyBhcmUgbmVlZGVkIHRvIGNyZWF0ZSB0aGUgZmlsdGVyIGZ1bmN0aW9uCgkJCS8vIGp1c3QgYXMgU2l6emxlIGRvZXMKCQkJaWYgKCBmblsgZXhwYW5kbyBdICkgewoJCQkJcmV0dXJuIGZuKCBhcmd1bWVudCApOwoJCQl9CgoJCQkvLyBCdXQgbWFpbnRhaW4gc3VwcG9ydCBmb3Igb2xkIHNpZ25hdHVyZXMKCQkJaWYgKCBmbi5sZW5ndGggPiAxICkgewoJCQkJYXJncyA9IFsgcHNldWRvLCBwc2V1ZG8sICIiLCBhcmd1bWVudCBdOwoJCQkJcmV0dXJuIEV4cHIuc2V0RmlsdGVycy5oYXNPd25Qcm9wZXJ0eSggcHNldWRvLnRvTG93ZXJDYXNlKCkgKSA/CgkJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzICkgewoJCQkJCQl2YXIgaWR4LAoJCQkJCQkJbWF0Y2hlZCA9IGZuKCBzZWVkLCBhcmd1bWVudCApLAoJCQkJCQkJaSA9IG1hdGNoZWQubGVuZ3RoOwoJCQkJCQl3aGlsZSAoIGktLSApIHsKCQkJCQkJCWlkeCA9IGluZGV4T2YoIHNlZWQsIG1hdGNoZWRbaV0gKTsKCQkJCQkJCXNlZWRbIGlkeCBdID0gISggbWF0Y2hlc1sgaWR4IF0gPSBtYXRjaGVkW2ldICk7CgkJCQkJCX0KCQkJCQl9KSA6CgkJCQkJZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQkJCXJldHVybiBmbiggZWxlbSwgMCwgYXJncyApOwoJCQkJCX07CgkJCX0KCgkJCXJldHVybiBmbjsKCQl9Cgl9LAoKCXBzZXVkb3M6IHsKCQkvLyBQb3RlbnRpYWxseSBjb21wbGV4IHBzZXVkb3MKCQkibm90IjogbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQkJLy8gVHJpbSB0aGUgc2VsZWN0b3IgcGFzc2VkIHRvIGNvbXBpbGUKCQkJLy8gdG8gYXZvaWQgdHJlYXRpbmcgbGVhZGluZyBhbmQgdHJhaWxpbmcKCQkJLy8gc3BhY2VzIGFzIGNvbWJpbmF0b3JzCgkJCXZhciBpbnB1dCA9IFtdLAoJCQkJcmVzdWx0cyA9IFtdLAoJCQkJbWF0Y2hlciA9IGNvbXBpbGUoIHNlbGVjdG9yLnJlcGxhY2UoIHJ0cmltLCAiJDEiICkgKTsKCgkJCXJldHVybiBtYXRjaGVyWyBleHBhbmRvIF0gPwoJCQkJbWFya0Z1bmN0aW9uKGZ1bmN0aW9uKCBzZWVkLCBtYXRjaGVzLCBjb250ZXh0LCB4bWwgKSB7CgkJCQkJdmFyIGVsZW0sCgkJCQkJCXVubWF0Y2hlZCA9IG1hdGNoZXIoIHNlZWQsIG51bGwsIHhtbCwgW10gKSwKCQkJCQkJaSA9IHNlZWQubGVuZ3RoOwoKCQkJCQkvLyBNYXRjaCBlbGVtZW50cyB1bm1hdGNoZWQgYnkgYG1hdGNoZXJgCgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSB1bm1hdGNoZWRbaV0pICkgewoJCQkJCQkJc2VlZFtpXSA9ICEobWF0Y2hlc1tpXSA9IGVsZW0pOwoJCQkJCQl9CgkJCQkJfQoJCQkJfSkgOgoJCQkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJCQlpbnB1dFswXSA9IGVsZW07CgkJCQkJbWF0Y2hlciggaW5wdXQsIG51bGwsIHhtbCwgcmVzdWx0cyApOwoJCQkJCS8vIERvbid0IGtlZXAgdGhlIGVsZW1lbnQgKGlzc3VlICMyOTkpCgkJCQkJaW5wdXRbMF0gPSBudWxsOwoJCQkJCXJldHVybiAhcmVzdWx0cy5wb3AoKTsKCQkJCX07CgkJfSksCgoJCSJoYXMiOiBtYXJrRnVuY3Rpb24oZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCQlyZXR1cm4gZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQlyZXR1cm4gU2l6emxlKCBzZWxlY3RvciwgZWxlbSApLmxlbmd0aCA+IDA7CgkJCX07CgkJfSksCgoJCSJjb250YWlucyI6IG1hcmtGdW5jdGlvbihmdW5jdGlvbiggdGV4dCApIHsKCQkJdGV4dCA9IHRleHQucmVwbGFjZSggcnVuZXNjYXBlLCBmdW5lc2NhcGUgKTsKCQkJcmV0dXJuIGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuICggZWxlbS50ZXh0Q29udGVudCB8fCBlbGVtLmlubmVyVGV4dCB8fCBnZXRUZXh0KCBlbGVtICkgKS5pbmRleE9mKCB0ZXh0ICkgPiAtMTsKCQkJfTsKCQl9KSwKCgkJLy8gIldoZXRoZXIgYW4gZWxlbWVudCBpcyByZXByZXNlbnRlZCBieSBhIDpsYW5nKCkgc2VsZWN0b3IKCQkvLyBpcyBiYXNlZCBzb2xlbHkgb24gdGhlIGVsZW1lbnQncyBsYW5ndWFnZSB2YWx1ZQoJCS8vIGJlaW5nIGVxdWFsIHRvIHRoZSBpZGVudGlmaWVyIEMsCgkJLy8gb3IgYmVnaW5uaW5nIHdpdGggdGhlIGlkZW50aWZpZXIgQyBpbW1lZGlhdGVseSBmb2xsb3dlZCBieSAiLSIuCgkJLy8gVGhlIG1hdGNoaW5nIG9mIEMgYWdhaW5zdCB0aGUgZWxlbWVudCdzIGxhbmd1YWdlIHZhbHVlIGlzIHBlcmZvcm1lZCBjYXNlLWluc2Vuc2l0aXZlbHkuCgkJLy8gVGhlIGlkZW50aWZpZXIgQyBkb2VzIG5vdCBoYXZlIHRvIGJlIGEgdmFsaWQgbGFuZ3VhZ2UgbmFtZS4iCgkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvc2VsZWN0b3JzLyNsYW5nLXBzZXVkbwoJCSJsYW5nIjogbWFya0Z1bmN0aW9uKCBmdW5jdGlvbiggbGFuZyApIHsKCQkJLy8gbGFuZyB2YWx1ZSBtdXN0IGJlIGEgdmFsaWQgaWRlbnRpZmllcgoJCQlpZiAoICFyaWRlbnRpZmllci50ZXN0KGxhbmcgfHwgIiIpICkgewoJCQkJU2l6emxlLmVycm9yKCAidW5zdXBwb3J0ZWQgbGFuZzogIiArIGxhbmcgKTsKCQkJfQoJCQlsYW5nID0gbGFuZy5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLnRvTG93ZXJDYXNlKCk7CgkJCXJldHVybiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciBlbGVtTGFuZzsKCQkJCWRvIHsKCQkJCQlpZiAoIChlbGVtTGFuZyA9IGRvY3VtZW50SXNIVE1MID8KCQkJCQkJZWxlbS5sYW5nIDoKCQkJCQkJZWxlbS5nZXRBdHRyaWJ1dGUoInhtbDpsYW5nIikgfHwgZWxlbS5nZXRBdHRyaWJ1dGUoImxhbmciKSkgKSB7CgoJCQkJCQllbGVtTGFuZyA9IGVsZW1MYW5nLnRvTG93ZXJDYXNlKCk7CgkJCQkJCXJldHVybiBlbGVtTGFuZyA9PT0gbGFuZyB8fCBlbGVtTGFuZy5pbmRleE9mKCBsYW5nICsgIi0iICkgPT09IDA7CgkJCQkJfQoJCQkJfSB3aGlsZSAoIChlbGVtID0gZWxlbS5wYXJlbnROb2RlKSAmJiBlbGVtLm5vZGVUeXBlID09PSAxICk7CgkJCQlyZXR1cm4gZmFsc2U7CgkJCX07CgkJfSksCgoJCS8vIE1pc2NlbGxhbmVvdXMKCQkidGFyZ2V0IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uICYmIHdpbmRvdy5sb2NhdGlvbi5oYXNoOwoJCQlyZXR1cm4gaGFzaCAmJiBoYXNoLnNsaWNlKCAxICkgPT09IGVsZW0uaWQ7CgkJfSwKCgkJInJvb3QiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0gPT09IGRvY0VsZW07CgkJfSwKCgkJImZvY3VzIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBkb2N1bWVudC5hY3RpdmVFbGVtZW50ICYmICghZG9jdW1lbnQuaGFzRm9jdXMgfHwgZG9jdW1lbnQuaGFzRm9jdXMoKSkgJiYgISEoZWxlbS50eXBlIHx8IGVsZW0uaHJlZiB8fCB+ZWxlbS50YWJJbmRleCk7CgkJfSwKCgkJLy8gQm9vbGVhbiBwcm9wZXJ0aWVzCgkJImVuYWJsZWQiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZGlzYWJsZWQgPT09IGZhbHNlOwoJCX0sCgoJCSJkaXNhYmxlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5kaXNhYmxlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkiY2hlY2tlZCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBJbiBDU1MzLCA6Y2hlY2tlZCBzaG91bGQgcmV0dXJuIGJvdGggY2hlY2tlZCBhbmQgc2VsZWN0ZWQgZWxlbWVudHMKCQkJLy8gaHR0cDovL3d3dy53My5vcmcvVFIvMjAxMS9SRUMtY3NzMy1zZWxlY3RvcnMtMjAxMTA5MjkvI2NoZWNrZWQKCQkJdmFyIG5vZGVOYW1lID0gZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlyZXR1cm4gKG5vZGVOYW1lID09PSAiaW5wdXQiICYmICEhZWxlbS5jaGVja2VkKSB8fCAobm9kZU5hbWUgPT09ICJvcHRpb24iICYmICEhZWxlbS5zZWxlY3RlZCk7CgkJfSwKCgkJInNlbGVjdGVkIjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCS8vIEFjY2Vzc2luZyB0aGlzIHByb3BlcnR5IG1ha2VzIHNlbGVjdGVkLWJ5LWRlZmF1bHQKCQkJLy8gb3B0aW9ucyBpbiBTYWZhcmkgd29yayBwcm9wZXJseQoJCQlpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCWVsZW0ucGFyZW50Tm9kZS5zZWxlY3RlZEluZGV4OwoJCQl9CgoJCQlyZXR1cm4gZWxlbS5zZWxlY3RlZCA9PT0gdHJ1ZTsKCQl9LAoKCQkvLyBDb250ZW50cwoJCSJlbXB0eSI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkvLyBodHRwOi8vd3d3LnczLm9yZy9UUi9zZWxlY3RvcnMvI2VtcHR5LXBzZXVkbwoJCQkvLyA6ZW1wdHkgaXMgbmVnYXRlZCBieSBlbGVtZW50ICgxKSBvciBjb250ZW50IG5vZGVzICh0ZXh0OiAzOyBjZGF0YTogNDsgZW50aXR5IHJlZjogNSksCgkJCS8vICAgYnV0IG5vdCBieSBvdGhlcnMgKGNvbW1lbnQ6IDg7IHByb2Nlc3NpbmcgaW5zdHJ1Y3Rpb246IDc7IGV0Yy4pCgkJCS8vIG5vZGVUeXBlIDwgNiB3b3JrcyBiZWNhdXNlIGF0dHJpYnV0ZXMgKDIpIGRvIG5vdCBhcHBlYXIgYXMgY2hpbGRyZW4KCQkJZm9yICggZWxlbSA9IGVsZW0uZmlyc3RDaGlsZDsgZWxlbTsgZWxlbSA9IGVsZW0ubmV4dFNpYmxpbmcgKSB7CgkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPCA2ICkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gdHJ1ZTsKCQl9LAoKCQkicGFyZW50IjogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiAhRXhwci5wc2V1ZG9zWyJlbXB0eSJdKCBlbGVtICk7CgkJfSwKCgkJLy8gRWxlbWVudC9pbnB1dCB0eXBlcwoJCSJoZWFkZXIiOiBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIHJoZWFkZXIudGVzdCggZWxlbS5ub2RlTmFtZSApOwoJCX0sCgoJCSJpbnB1dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gcmlucHV0cy50ZXN0KCBlbGVtLm5vZGVOYW1lICk7CgkJfSwKCgkJImJ1dHRvbiI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgbmFtZSA9IGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKTsKCQkJcmV0dXJuIG5hbWUgPT09ICJpbnB1dCIgJiYgZWxlbS50eXBlID09PSAiYnV0dG9uIiB8fCBuYW1lID09PSAiYnV0dG9uIjsKCQl9LAoKCQkidGV4dCI6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgYXR0cjsKCQkJcmV0dXJuIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gImlucHV0IiAmJgoJCQkJZWxlbS50eXBlID09PSAidGV4dCIgJiYKCgkJCQkvLyBTdXBwb3J0OiBJRTw4CgkJCQkvLyBOZXcgSFRNTDUgYXR0cmlidXRlIHZhbHVlcyAoZS5nLiwgInNlYXJjaCIpIGFwcGVhciB3aXRoIGVsZW0udHlwZSA9PT0gInRleHQiCgkJCQkoIChhdHRyID0gZWxlbS5nZXRBdHRyaWJ1dGUoInR5cGUiKSkgPT0gbnVsbCB8fCBhdHRyLnRvTG93ZXJDYXNlKCkgPT09ICJ0ZXh0IiApOwoJCX0sCgoJCS8vIFBvc2l0aW9uLWluLWNvbGxlY3Rpb24KCQkiZmlyc3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4gWyAwIF07CgkJfSksCgoJCSJsYXN0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXJldHVybiBbIGxlbmd0aCAtIDEgXTsKCQl9KSwKCgkJImVxIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQlyZXR1cm4gWyBhcmd1bWVudCA8IDAgPyBhcmd1bWVudCArIGxlbmd0aCA6IGFyZ3VtZW50IF07CgkJfSksCgoJCSJldmVuIjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGggKSB7CgkJCXZhciBpID0gMDsKCQkJZm9yICggOyBpIDwgbGVuZ3RoOyBpICs9IDIgKSB7CgkJCQltYXRjaEluZGV4ZXMucHVzaCggaSApOwoJCQl9CgkJCXJldHVybiBtYXRjaEluZGV4ZXM7CgkJfSksCgoJCSJvZGQiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCApIHsKCQkJdmFyIGkgPSAxOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkgKz0gMiApIHsKCQkJCW1hdGNoSW5kZXhlcy5wdXNoKCBpICk7CgkJCX0KCQkJcmV0dXJuIG1hdGNoSW5kZXhlczsKCQl9KSwKCgkJImx0IjogY3JlYXRlUG9zaXRpb25hbFBzZXVkbyhmdW5jdGlvbiggbWF0Y2hJbmRleGVzLCBsZW5ndGgsIGFyZ3VtZW50ICkgewoJCQl2YXIgaSA9IGFyZ3VtZW50IDwgMCA/IGFyZ3VtZW50ICsgbGVuZ3RoIDogYXJndW1lbnQ7CgkJCWZvciAoIDsgLS1pID49IDA7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pLAoKCQkiZ3QiOiBjcmVhdGVQb3NpdGlvbmFsUHNldWRvKGZ1bmN0aW9uKCBtYXRjaEluZGV4ZXMsIGxlbmd0aCwgYXJndW1lbnQgKSB7CgkJCXZhciBpID0gYXJndW1lbnQgPCAwID8gYXJndW1lbnQgKyBsZW5ndGggOiBhcmd1bWVudDsKCQkJZm9yICggOyArK2kgPCBsZW5ndGg7ICkgewoJCQkJbWF0Y2hJbmRleGVzLnB1c2goIGkgKTsKCQkJfQoJCQlyZXR1cm4gbWF0Y2hJbmRleGVzOwoJCX0pCgl9Cn07CgpFeHByLnBzZXVkb3NbIm50aCJdID0gRXhwci5wc2V1ZG9zWyJlcSJdOwoKLy8gQWRkIGJ1dHRvbi9pbnB1dCB0eXBlIHBzZXVkb3MKZm9yICggaSBpbiB7IHJhZGlvOiB0cnVlLCBjaGVja2JveDogdHJ1ZSwgZmlsZTogdHJ1ZSwgcGFzc3dvcmQ6IHRydWUsIGltYWdlOiB0cnVlIH0gKSB7CglFeHByLnBzZXVkb3NbIGkgXSA9IGNyZWF0ZUlucHV0UHNldWRvKCBpICk7Cn0KZm9yICggaSBpbiB7IHN1Ym1pdDogdHJ1ZSwgcmVzZXQ6IHRydWUgfSApIHsKCUV4cHIucHNldWRvc1sgaSBdID0gY3JlYXRlQnV0dG9uUHNldWRvKCBpICk7Cn0KCi8vIEVhc3kgQVBJIGZvciBjcmVhdGluZyBuZXcgc2V0RmlsdGVycwpmdW5jdGlvbiBzZXRGaWx0ZXJzKCkge30Kc2V0RmlsdGVycy5wcm90b3R5cGUgPSBFeHByLmZpbHRlcnMgPSBFeHByLnBzZXVkb3M7CkV4cHIuc2V0RmlsdGVycyA9IG5ldyBzZXRGaWx0ZXJzKCk7Cgp0b2tlbml6ZSA9IFNpenpsZS50b2tlbml6ZSA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgcGFyc2VPbmx5ICkgewoJdmFyIG1hdGNoZWQsIG1hdGNoLCB0b2tlbnMsIHR5cGUsCgkJc29GYXIsIGdyb3VwcywgcHJlRmlsdGVycywKCQljYWNoZWQgPSB0b2tlbkNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggY2FjaGVkICkgewoJCXJldHVybiBwYXJzZU9ubHkgPyAwIDogY2FjaGVkLnNsaWNlKCAwICk7Cgl9CgoJc29GYXIgPSBzZWxlY3RvcjsKCWdyb3VwcyA9IFtdOwoJcHJlRmlsdGVycyA9IEV4cHIucHJlRmlsdGVyOwoKCXdoaWxlICggc29GYXIgKSB7CgoJCS8vIENvbW1hIGFuZCBmaXJzdCBydW4KCQlpZiAoICFtYXRjaGVkIHx8IChtYXRjaCA9IHJjb21tYS5leGVjKCBzb0ZhciApKSApIHsKCQkJaWYgKCBtYXRjaCApIHsKCQkJCS8vIERvbid0IGNvbnN1bWUgdHJhaWxpbmcgY29tbWFzIGFzIHZhbGlkCgkJCQlzb0ZhciA9IHNvRmFyLnNsaWNlKCBtYXRjaFswXS5sZW5ndGggKSB8fCBzb0ZhcjsKCQkJfQoJCQlncm91cHMucHVzaCggKHRva2VucyA9IFtdKSApOwoJCX0KCgkJbWF0Y2hlZCA9IGZhbHNlOwoKCQkvLyBDb21iaW5hdG9ycwoJCWlmICggKG1hdGNoID0gcmNvbWJpbmF0b3JzLmV4ZWMoIHNvRmFyICkpICkgewoJCQltYXRjaGVkID0gbWF0Y2guc2hpZnQoKTsKCQkJdG9rZW5zLnB1c2goewoJCQkJdmFsdWU6IG1hdGNoZWQsCgkJCQkvLyBDYXN0IGRlc2NlbmRhbnQgY29tYmluYXRvcnMgdG8gc3BhY2UKCQkJCXR5cGU6IG1hdGNoWzBdLnJlcGxhY2UoIHJ0cmltLCAiICIgKQoJCQl9KTsKCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQl9CgoJCS8vIEZpbHRlcnMKCQlmb3IgKCB0eXBlIGluIEV4cHIuZmlsdGVyICkgewoJCQlpZiAoIChtYXRjaCA9IG1hdGNoRXhwclsgdHlwZSBdLmV4ZWMoIHNvRmFyICkpICYmICghcHJlRmlsdGVyc1sgdHlwZSBdIHx8CgkJCQkobWF0Y2ggPSBwcmVGaWx0ZXJzWyB0eXBlIF0oIG1hdGNoICkpKSApIHsKCQkJCW1hdGNoZWQgPSBtYXRjaC5zaGlmdCgpOwoJCQkJdG9rZW5zLnB1c2goewoJCQkJCXZhbHVlOiBtYXRjaGVkLAoJCQkJCXR5cGU6IHR5cGUsCgkJCQkJbWF0Y2hlczogbWF0Y2gKCQkJCX0pOwoJCQkJc29GYXIgPSBzb0Zhci5zbGljZSggbWF0Y2hlZC5sZW5ndGggKTsKCQkJfQoJCX0KCgkJaWYgKCAhbWF0Y2hlZCApIHsKCQkJYnJlYWs7CgkJfQoJfQoKCS8vIFJldHVybiB0aGUgbGVuZ3RoIG9mIHRoZSBpbnZhbGlkIGV4Y2VzcwoJLy8gaWYgd2UncmUganVzdCBwYXJzaW5nCgkvLyBPdGhlcndpc2UsIHRocm93IGFuIGVycm9yIG9yIHJldHVybiB0b2tlbnMKCXJldHVybiBwYXJzZU9ubHkgPwoJCXNvRmFyLmxlbmd0aCA6CgkJc29GYXIgPwoJCQlTaXp6bGUuZXJyb3IoIHNlbGVjdG9yICkgOgoJCQkvLyBDYWNoZSB0aGUgdG9rZW5zCgkJCXRva2VuQ2FjaGUoIHNlbGVjdG9yLCBncm91cHMgKS5zbGljZSggMCApOwp9OwoKZnVuY3Rpb24gdG9TZWxlY3RvciggdG9rZW5zICkgewoJdmFyIGkgPSAwLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJc2VsZWN0b3IgPSAiIjsKCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCXNlbGVjdG9yICs9IHRva2Vuc1tpXS52YWx1ZTsKCX0KCXJldHVybiBzZWxlY3RvcjsKfQoKZnVuY3Rpb24gYWRkQ29tYmluYXRvciggbWF0Y2hlciwgY29tYmluYXRvciwgYmFzZSApIHsKCXZhciBkaXIgPSBjb21iaW5hdG9yLmRpciwKCQljaGVja05vbkVsZW1lbnRzID0gYmFzZSAmJiBkaXIgPT09ICJwYXJlbnROb2RlIiwKCQlkb25lTmFtZSA9IGRvbmUrKzsKCglyZXR1cm4gY29tYmluYXRvci5maXJzdCA/CgkJLy8gQ2hlY2sgYWdhaW5zdCBjbG9zZXN0IGFuY2VzdG9yL3ByZWNlZGluZyBlbGVtZW50CgkJZnVuY3Rpb24oIGVsZW0sIGNvbnRleHQsIHhtbCApIHsKCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBjaGVja05vbkVsZW1lbnRzICkgewoJCQkJCXJldHVybiBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKTsKCQkJCX0KCQkJfQoJCX0gOgoKCQkvLyBDaGVjayBhZ2FpbnN0IGFsbCBhbmNlc3Rvci9wcmVjZWRpbmcgZWxlbWVudHMKCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgb2xkQ2FjaGUsIG91dGVyQ2FjaGUsCgkJCQluZXdDYWNoZSA9IFsgZGlycnVucywgZG9uZU5hbWUgXTsKCgkJCS8vIFdlIGNhbid0IHNldCBhcmJpdHJhcnkgZGF0YSBvbiBYTUwgbm9kZXMsIHNvIHRoZXkgZG9uJ3QgYmVuZWZpdCBmcm9tIGRpciBjYWNoaW5nCgkJCWlmICggeG1sICkgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJaWYgKCBtYXRjaGVyKCBlbGVtLCBjb250ZXh0LCB4bWwgKSApIHsKCQkJCQkJCXJldHVybiB0cnVlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9IGVsc2UgewoJCQkJd2hpbGUgKCAoZWxlbSA9IGVsZW1bIGRpciBdKSApIHsKCQkJCQlpZiAoIGVsZW0ubm9kZVR5cGUgPT09IDEgfHwgY2hlY2tOb25FbGVtZW50cyApIHsKCQkJCQkJb3V0ZXJDYWNoZSA9IGVsZW1bIGV4cGFuZG8gXSB8fCAoZWxlbVsgZXhwYW5kbyBdID0ge30pOwoJCQkJCQlpZiAoIChvbGRDYWNoZSA9IG91dGVyQ2FjaGVbIGRpciBdKSAmJgoJCQkJCQkJb2xkQ2FjaGVbIDAgXSA9PT0gZGlycnVucyAmJiBvbGRDYWNoZVsgMSBdID09PSBkb25lTmFtZSApIHsKCgkJCQkJCQkvLyBBc3NpZ24gdG8gbmV3Q2FjaGUgc28gcmVzdWx0cyBiYWNrLXByb3BhZ2F0ZSB0byBwcmV2aW91cyBlbGVtZW50cwoJCQkJCQkJcmV0dXJuIChuZXdDYWNoZVsgMiBdID0gb2xkQ2FjaGVbIDIgXSk7CgkJCQkJCX0gZWxzZSB7CgkJCQkJCQkvLyBSZXVzZSBuZXdjYWNoZSBzbyByZXN1bHRzIGJhY2stcHJvcGFnYXRlIHRvIHByZXZpb3VzIGVsZW1lbnRzCgkJCQkJCQlvdXRlckNhY2hlWyBkaXIgXSA9IG5ld0NhY2hlOwoKCQkJCQkJCS8vIEEgbWF0Y2ggbWVhbnMgd2UncmUgZG9uZTsgYSBmYWlsIG1lYW5zIHdlIGhhdmUgdG8ga2VlcCBjaGVja2luZwoJCQkJCQkJaWYgKCAobmV3Q2FjaGVbIDIgXSA9IG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApKSApIHsKCQkJCQkJCQlyZXR1cm4gdHJ1ZTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCQkJCX0KCQkJfQoJCX07Cn0KCmZ1bmN0aW9uIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApIHsKCXJldHVybiBtYXRjaGVycy5sZW5ndGggPiAxID8KCQlmdW5jdGlvbiggZWxlbSwgY29udGV4dCwgeG1sICkgewoJCQl2YXIgaSA9IG1hdGNoZXJzLmxlbmd0aDsKCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQlpZiAoICFtYXRjaGVyc1tpXSggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQkJcmV0dXJuIGZhbHNlOwoJCQkJfQoJCQl9CgkJCXJldHVybiB0cnVlOwoJCX0gOgoJCW1hdGNoZXJzWzBdOwp9CgpmdW5jdGlvbiBtdWx0aXBsZUNvbnRleHRzKCBzZWxlY3RvciwgY29udGV4dHMsIHJlc3VsdHMgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gY29udGV4dHMubGVuZ3RoOwoJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJU2l6emxlKCBzZWxlY3RvciwgY29udGV4dHNbaV0sIHJlc3VsdHMgKTsKCX0KCXJldHVybiByZXN1bHRzOwp9CgpmdW5jdGlvbiBjb25kZW5zZSggdW5tYXRjaGVkLCBtYXAsIGZpbHRlciwgY29udGV4dCwgeG1sICkgewoJdmFyIGVsZW0sCgkJbmV3VW5tYXRjaGVkID0gW10sCgkJaSA9IDAsCgkJbGVuID0gdW5tYXRjaGVkLmxlbmd0aCwKCQltYXBwZWQgPSBtYXAgIT0gbnVsbDsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChlbGVtID0gdW5tYXRjaGVkW2ldKSApIHsKCQkJaWYgKCAhZmlsdGVyIHx8IGZpbHRlciggZWxlbSwgY29udGV4dCwgeG1sICkgKSB7CgkJCQluZXdVbm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJaWYgKCBtYXBwZWQgKSB7CgkJCQkJbWFwLnB1c2goIGkgKTsKCQkJCX0KCQkJfQoJCX0KCX0KCglyZXR1cm4gbmV3VW5tYXRjaGVkOwp9CgpmdW5jdGlvbiBzZXRNYXRjaGVyKCBwcmVGaWx0ZXIsIHNlbGVjdG9yLCBtYXRjaGVyLCBwb3N0RmlsdGVyLCBwb3N0RmluZGVyLCBwb3N0U2VsZWN0b3IgKSB7CglpZiAoIHBvc3RGaWx0ZXIgJiYgIXBvc3RGaWx0ZXJbIGV4cGFuZG8gXSApIHsKCQlwb3N0RmlsdGVyID0gc2V0TWF0Y2hlciggcG9zdEZpbHRlciApOwoJfQoJaWYgKCBwb3N0RmluZGVyICYmICFwb3N0RmluZGVyWyBleHBhbmRvIF0gKSB7CgkJcG9zdEZpbmRlciA9IHNldE1hdGNoZXIoIHBvc3RGaW5kZXIsIHBvc3RTZWxlY3RvciApOwoJfQoJcmV0dXJuIG1hcmtGdW5jdGlvbihmdW5jdGlvbiggc2VlZCwgcmVzdWx0cywgY29udGV4dCwgeG1sICkgewoJCXZhciB0ZW1wLCBpLCBlbGVtLAoJCQlwcmVNYXAgPSBbXSwKCQkJcG9zdE1hcCA9IFtdLAoJCQlwcmVleGlzdGluZyA9IHJlc3VsdHMubGVuZ3RoLAoKCQkJLy8gR2V0IGluaXRpYWwgZWxlbWVudHMgZnJvbSBzZWVkIG9yIGNvbnRleHQKCQkJZWxlbXMgPSBzZWVkIHx8IG11bHRpcGxlQ29udGV4dHMoIHNlbGVjdG9yIHx8ICIqIiwgY29udGV4dC5ub2RlVHlwZSA/IFsgY29udGV4dCBdIDogY29udGV4dCwgW10gKSwKCgkJCS8vIFByZWZpbHRlciB0byBnZXQgbWF0Y2hlciBpbnB1dCwgcHJlc2VydmluZyBhIG1hcCBmb3Igc2VlZC1yZXN1bHRzIHN5bmNocm9uaXphdGlvbgoJCQltYXRjaGVySW4gPSBwcmVGaWx0ZXIgJiYgKCBzZWVkIHx8ICFzZWxlY3RvciApID8KCQkJCWNvbmRlbnNlKCBlbGVtcywgcHJlTWFwLCBwcmVGaWx0ZXIsIGNvbnRleHQsIHhtbCApIDoKCQkJCWVsZW1zLAoKCQkJbWF0Y2hlck91dCA9IG1hdGNoZXIgPwoJCQkJLy8gSWYgd2UgaGF2ZSBhIHBvc3RGaW5kZXIsIG9yIGZpbHRlcmVkIHNlZWQsIG9yIG5vbi1zZWVkIHBvc3RGaWx0ZXIgb3IgcHJlZXhpc3RpbmcgcmVzdWx0cywKCQkJCXBvc3RGaW5kZXIgfHwgKCBzZWVkID8gcHJlRmlsdGVyIDogcHJlZXhpc3RpbmcgfHwgcG9zdEZpbHRlciApID8KCgkJCQkJLy8gLi4uaW50ZXJtZWRpYXRlIHByb2Nlc3NpbmcgaXMgbmVjZXNzYXJ5CgkJCQkJW10gOgoKCQkJCQkvLyAuLi5vdGhlcndpc2UgdXNlIHJlc3VsdHMgZGlyZWN0bHkKCQkJCQlyZXN1bHRzIDoKCQkJCW1hdGNoZXJJbjsKCgkJLy8gRmluZCBwcmltYXJ5IG1hdGNoZXMKCQlpZiAoIG1hdGNoZXIgKSB7CgkJCW1hdGNoZXIoIG1hdGNoZXJJbiwgbWF0Y2hlck91dCwgY29udGV4dCwgeG1sICk7CgkJfQoKCQkvLyBBcHBseSBwb3N0RmlsdGVyCgkJaWYgKCBwb3N0RmlsdGVyICkgewoJCQl0ZW1wID0gY29uZGVuc2UoIG1hdGNoZXJPdXQsIHBvc3RNYXAgKTsKCQkJcG9zdEZpbHRlciggdGVtcCwgW10sIGNvbnRleHQsIHhtbCApOwoKCQkJLy8gVW4tbWF0Y2ggZmFpbGluZyBlbGVtZW50cyBieSBtb3ZpbmcgdGhlbSBiYWNrIHRvIG1hdGNoZXJJbgoJCQlpID0gdGVtcC5sZW5ndGg7CgkJCXdoaWxlICggaS0tICkgewoJCQkJaWYgKCAoZWxlbSA9IHRlbXBbaV0pICkgewoJCQkJCW1hdGNoZXJPdXRbIHBvc3RNYXBbaV0gXSA9ICEobWF0Y2hlckluWyBwb3N0TWFwW2ldIF0gPSBlbGVtKTsKCQkJCX0KCQkJfQoJCX0KCgkJaWYgKCBzZWVkICkgewoJCQlpZiAoIHBvc3RGaW5kZXIgfHwgcHJlRmlsdGVyICkgewoJCQkJaWYgKCBwb3N0RmluZGVyICkgewoJCQkJCS8vIEdldCB0aGUgZmluYWwgbWF0Y2hlck91dCBieSBjb25kZW5zaW5nIHRoaXMgaW50ZXJtZWRpYXRlIGludG8gcG9zdEZpbmRlciBjb250ZXh0cwoJCQkJCXRlbXAgPSBbXTsKCQkJCQlpID0gbWF0Y2hlck91dC5sZW5ndGg7CgkJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJCWlmICggKGVsZW0gPSBtYXRjaGVyT3V0W2ldKSApIHsKCQkJCQkJCS8vIFJlc3RvcmUgbWF0Y2hlckluIHNpbmNlIGVsZW0gaXMgbm90IHlldCBhIGZpbmFsIG1hdGNoCgkJCQkJCQl0ZW1wLnB1c2goIChtYXRjaGVySW5baV0gPSBlbGVtKSApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCXBvc3RGaW5kZXIoIG51bGwsIChtYXRjaGVyT3V0ID0gW10pLCB0ZW1wLCB4bWwgKTsKCQkJCX0KCgkJCQkvLyBNb3ZlIG1hdGNoZWQgZWxlbWVudHMgZnJvbSBzZWVkIHRvIHJlc3VsdHMgdG8ga2VlcCB0aGVtIHN5bmNocm9uaXplZAoJCQkJaSA9IG1hdGNoZXJPdXQubGVuZ3RoOwoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJaWYgKCAoZWxlbSA9IG1hdGNoZXJPdXRbaV0pICYmCgkJCQkJCSh0ZW1wID0gcG9zdEZpbmRlciA/IGluZGV4T2YoIHNlZWQsIGVsZW0gKSA6IHByZU1hcFtpXSkgPiAtMSApIHsKCgkJCQkJCXNlZWRbdGVtcF0gPSAhKHJlc3VsdHNbdGVtcF0gPSBlbGVtKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJLy8gQWRkIGVsZW1lbnRzIHRvIHJlc3VsdHMsIHRocm91Z2ggcG9zdEZpbmRlciBpZiBkZWZpbmVkCgkJfSBlbHNlIHsKCQkJbWF0Y2hlck91dCA9IGNvbmRlbnNlKAoJCQkJbWF0Y2hlck91dCA9PT0gcmVzdWx0cyA/CgkJCQkJbWF0Y2hlck91dC5zcGxpY2UoIHByZWV4aXN0aW5nLCBtYXRjaGVyT3V0Lmxlbmd0aCApIDoKCQkJCQltYXRjaGVyT3V0CgkJCSk7CgkJCWlmICggcG9zdEZpbmRlciApIHsKCQkJCXBvc3RGaW5kZXIoIG51bGwsIHJlc3VsdHMsIG1hdGNoZXJPdXQsIHhtbCApOwoJCQl9IGVsc2UgewoJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgbWF0Y2hlck91dCApOwoJCQl9CgkJfQoJfSk7Cn0KCmZ1bmN0aW9uIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMgKSB7Cgl2YXIgY2hlY2tDb250ZXh0LCBtYXRjaGVyLCBqLAoJCWxlbiA9IHRva2Vucy5sZW5ndGgsCgkJbGVhZGluZ1JlbGF0aXZlID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zWzBdLnR5cGUgXSwKCQlpbXBsaWNpdFJlbGF0aXZlID0gbGVhZGluZ1JlbGF0aXZlIHx8IEV4cHIucmVsYXRpdmVbIiAiXSwKCQlpID0gbGVhZGluZ1JlbGF0aXZlID8gMSA6IDAsCgoJCS8vIFRoZSBmb3VuZGF0aW9uYWwgbWF0Y2hlciBlbnN1cmVzIHRoYXQgZWxlbWVudHMgYXJlIHJlYWNoYWJsZSBmcm9tIHRvcC1sZXZlbCBjb250ZXh0KHMpCgkJbWF0Y2hDb250ZXh0ID0gYWRkQ29tYmluYXRvciggZnVuY3Rpb24oIGVsZW0gKSB7CgkJCXJldHVybiBlbGVtID09PSBjaGVja0NvbnRleHQ7CgkJfSwgaW1wbGljaXRSZWxhdGl2ZSwgdHJ1ZSApLAoJCW1hdGNoQW55Q29udGV4dCA9IGFkZENvbWJpbmF0b3IoIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gaW5kZXhPZiggY2hlY2tDb250ZXh0LCBlbGVtICkgPiAtMTsKCQl9LCBpbXBsaWNpdFJlbGF0aXZlLCB0cnVlICksCgkJbWF0Y2hlcnMgPSBbIGZ1bmN0aW9uKCBlbGVtLCBjb250ZXh0LCB4bWwgKSB7CgkJCXZhciByZXQgPSAoICFsZWFkaW5nUmVsYXRpdmUgJiYgKCB4bWwgfHwgY29udGV4dCAhPT0gb3V0ZXJtb3N0Q29udGV4dCApICkgfHwgKAoJCQkJKGNoZWNrQ29udGV4dCA9IGNvbnRleHQpLm5vZGVUeXBlID8KCQkJCQltYXRjaENvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApIDoKCQkJCQltYXRjaEFueUNvbnRleHQoIGVsZW0sIGNvbnRleHQsIHhtbCApICk7CgkJCS8vIEF2b2lkIGhhbmdpbmcgb250byBlbGVtZW50IChpc3N1ZSAjMjk5KQoJCQljaGVja0NvbnRleHQgPSBudWxsOwoJCQlyZXR1cm4gcmV0OwoJCX0gXTsKCglmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQlpZiAoIChtYXRjaGVyID0gRXhwci5yZWxhdGl2ZVsgdG9rZW5zW2ldLnR5cGUgXSkgKSB7CgkJCW1hdGNoZXJzID0gWyBhZGRDb21iaW5hdG9yKGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApLCBtYXRjaGVyKSBdOwoJCX0gZWxzZSB7CgkJCW1hdGNoZXIgPSBFeHByLmZpbHRlclsgdG9rZW5zW2ldLnR5cGUgXS5hcHBseSggbnVsbCwgdG9rZW5zW2ldLm1hdGNoZXMgKTsKCgkJCS8vIFJldHVybiBzcGVjaWFsIHVwb24gc2VlaW5nIGEgcG9zaXRpb25hbCBtYXRjaGVyCgkJCWlmICggbWF0Y2hlclsgZXhwYW5kbyBdICkgewoJCQkJLy8gRmluZCB0aGUgbmV4dCByZWxhdGl2ZSBvcGVyYXRvciAoaWYgYW55KSBmb3IgcHJvcGVyIGhhbmRsaW5nCgkJCQlqID0gKytpOwoJCQkJZm9yICggOyBqIDwgbGVuOyBqKysgKSB7CgkJCQkJaWYgKCBFeHByLnJlbGF0aXZlWyB0b2tlbnNbal0udHlwZSBdICkgewoJCQkJCQlicmVhazsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gc2V0TWF0Y2hlcigKCQkJCQlpID4gMSAmJiBlbGVtZW50TWF0Y2hlciggbWF0Y2hlcnMgKSwKCQkJCQlpID4gMSAmJiB0b1NlbGVjdG9yKAoJCQkJCQkvLyBJZiB0aGUgcHJlY2VkaW5nIHRva2VuIHdhcyBhIGRlc2NlbmRhbnQgY29tYmluYXRvciwgaW5zZXJ0IGFuIGltcGxpY2l0IGFueS1lbGVtZW50IGAqYAoJCQkJCQl0b2tlbnMuc2xpY2UoIDAsIGkgLSAxICkuY29uY2F0KHsgdmFsdWU6IHRva2Vuc1sgaSAtIDIgXS50eXBlID09PSAiICIgPyAiKiIgOiAiIiB9KQoJCQkJCSkucmVwbGFjZSggcnRyaW0sICIkMSIgKSwKCQkJCQltYXRjaGVyLAoJCQkJCWkgPCBqICYmIG1hdGNoZXJGcm9tVG9rZW5zKCB0b2tlbnMuc2xpY2UoIGksIGogKSApLAoJCQkJCWogPCBsZW4gJiYgbWF0Y2hlckZyb21Ub2tlbnMoICh0b2tlbnMgPSB0b2tlbnMuc2xpY2UoIGogKSkgKSwKCQkJCQlqIDwgbGVuICYmIHRvU2VsZWN0b3IoIHRva2VucyApCgkJCQkpOwoJCQl9CgkJCW1hdGNoZXJzLnB1c2goIG1hdGNoZXIgKTsKCQl9Cgl9CgoJcmV0dXJuIGVsZW1lbnRNYXRjaGVyKCBtYXRjaGVycyApOwp9CgpmdW5jdGlvbiBtYXRjaGVyRnJvbUdyb3VwTWF0Y2hlcnMoIGVsZW1lbnRNYXRjaGVycywgc2V0TWF0Y2hlcnMgKSB7Cgl2YXIgYnlTZXQgPSBzZXRNYXRjaGVycy5sZW5ndGggPiAwLAoJCWJ5RWxlbWVudCA9IGVsZW1lbnRNYXRjaGVycy5sZW5ndGggPiAwLAoJCXN1cGVyTWF0Y2hlciA9IGZ1bmN0aW9uKCBzZWVkLCBjb250ZXh0LCB4bWwsIHJlc3VsdHMsIG91dGVybW9zdCApIHsKCQkJdmFyIGVsZW0sIGosIG1hdGNoZXIsCgkJCQltYXRjaGVkQ291bnQgPSAwLAoJCQkJaSA9ICIwIiwKCQkJCXVubWF0Y2hlZCA9IHNlZWQgJiYgW10sCgkJCQlzZXRNYXRjaGVkID0gW10sCgkJCQljb250ZXh0QmFja3VwID0gb3V0ZXJtb3N0Q29udGV4dCwKCQkJCS8vIFdlIG11c3QgYWx3YXlzIGhhdmUgZWl0aGVyIHNlZWQgZWxlbWVudHMgb3Igb3V0ZXJtb3N0IGNvbnRleHQKCQkJCWVsZW1zID0gc2VlZCB8fCBieUVsZW1lbnQgJiYgRXhwci5maW5kWyJUQUciXSggIioiLCBvdXRlcm1vc3QgKSwKCQkJCS8vIFVzZSBpbnRlZ2VyIGRpcnJ1bnMgaWZmIHRoaXMgaXMgdGhlIG91dGVybW9zdCBtYXRjaGVyCgkJCQlkaXJydW5zVW5pcXVlID0gKGRpcnJ1bnMgKz0gY29udGV4dEJhY2t1cCA9PSBudWxsID8gMSA6IE1hdGgucmFuZG9tKCkgfHwgMC4xKSwKCQkJCWxlbiA9IGVsZW1zLmxlbmd0aDsKCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJb3V0ZXJtb3N0Q29udGV4dCA9IGNvbnRleHQgIT09IGRvY3VtZW50ICYmIGNvbnRleHQ7CgkJCX0KCgkJCS8vIEFkZCBlbGVtZW50cyBwYXNzaW5nIGVsZW1lbnRNYXRjaGVycyBkaXJlY3RseSB0byByZXN1bHRzCgkJCS8vIEtlZXAgYGlgIGEgc3RyaW5nIGlmIHRoZXJlIGFyZSBubyBlbGVtZW50cyBzbyBgbWF0Y2hlZENvdW50YCB3aWxsIGJlICIwMCIgYmVsb3cKCQkJLy8gU3VwcG9ydDogSUU8OSwgU2FmYXJpCgkJCS8vIFRvbGVyYXRlIE5vZGVMaXN0IHByb3BlcnRpZXMgKElFOiAibGVuZ3RoIjsgU2FmYXJpOiA8bnVtYmVyPikgbWF0Y2hpbmcgZWxlbWVudHMgYnkgaWQKCQkJZm9yICggOyBpICE9PSBsZW4gJiYgKGVsZW0gPSBlbGVtc1tpXSkgIT0gbnVsbDsgaSsrICkgewoJCQkJaWYgKCBieUVsZW1lbnQgJiYgZWxlbSApIHsKCQkJCQlqID0gMDsKCQkJCQl3aGlsZSAoIChtYXRjaGVyID0gZWxlbWVudE1hdGNoZXJzW2orK10pICkgewoJCQkJCQlpZiAoIG1hdGNoZXIoIGVsZW0sIGNvbnRleHQsIHhtbCApICkgewoJCQkJCQkJcmVzdWx0cy5wdXNoKCBlbGVtICk7CgkJCQkJCQlicmVhazsKCQkJCQkJfQoJCQkJCX0KCQkJCQlpZiAoIG91dGVybW9zdCApIHsKCQkJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQkJfQoJCQkJfQoKCQkJCS8vIFRyYWNrIHVubWF0Y2hlZCBlbGVtZW50cyBmb3Igc2V0IGZpbHRlcnMKCQkJCWlmICggYnlTZXQgKSB7CgkJCQkJLy8gVGhleSB3aWxsIGhhdmUgZ29uZSB0aHJvdWdoIGFsbCBwb3NzaWJsZSBtYXRjaGVycwoJCQkJCWlmICggKGVsZW0gPSAhbWF0Y2hlciAmJiBlbGVtKSApIHsKCQkJCQkJbWF0Y2hlZENvdW50LS07CgkJCQkJfQoKCQkJCQkvLyBMZW5ndGhlbiB0aGUgYXJyYXkgZm9yIGV2ZXJ5IGVsZW1lbnQsIG1hdGNoZWQgb3Igbm90CgkJCQkJaWYgKCBzZWVkICkgewoJCQkJCQl1bm1hdGNoZWQucHVzaCggZWxlbSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gQXBwbHkgc2V0IGZpbHRlcnMgdG8gdW5tYXRjaGVkIGVsZW1lbnRzCgkJCW1hdGNoZWRDb3VudCArPSBpOwoJCQlpZiAoIGJ5U2V0ICYmIGkgIT09IG1hdGNoZWRDb3VudCApIHsKCQkJCWogPSAwOwoJCQkJd2hpbGUgKCAobWF0Y2hlciA9IHNldE1hdGNoZXJzW2orK10pICkgewoJCQkJCW1hdGNoZXIoIHVubWF0Y2hlZCwgc2V0TWF0Y2hlZCwgY29udGV4dCwgeG1sICk7CgkJCQl9CgoJCQkJaWYgKCBzZWVkICkgewoJCQkJCS8vIFJlaW50ZWdyYXRlIGVsZW1lbnQgbWF0Y2hlcyB0byBlbGltaW5hdGUgdGhlIG5lZWQgZm9yIHNvcnRpbmcKCQkJCQlpZiAoIG1hdGNoZWRDb3VudCA+IDAgKSB7CgkJCQkJCXdoaWxlICggaS0tICkgewoJCQkJCQkJaWYgKCAhKHVubWF0Y2hlZFtpXSB8fCBzZXRNYXRjaGVkW2ldKSApIHsKCQkJCQkJCQlzZXRNYXRjaGVkW2ldID0gcG9wLmNhbGwoIHJlc3VsdHMgKTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0KCgkJCQkJLy8gRGlzY2FyZCBpbmRleCBwbGFjZWhvbGRlciB2YWx1ZXMgdG8gZ2V0IG9ubHkgYWN0dWFsIG1hdGNoZXMKCQkJCQlzZXRNYXRjaGVkID0gY29uZGVuc2UoIHNldE1hdGNoZWQgKTsKCQkJCX0KCgkJCQkvLyBBZGQgbWF0Y2hlcyB0byByZXN1bHRzCgkJCQlwdXNoLmFwcGx5KCByZXN1bHRzLCBzZXRNYXRjaGVkICk7CgoJCQkJLy8gU2VlZGxlc3Mgc2V0IG1hdGNoZXMgc3VjY2VlZGluZyBtdWx0aXBsZSBzdWNjZXNzZnVsIG1hdGNoZXJzIHN0aXB1bGF0ZSBzb3J0aW5nCgkJCQlpZiAoIG91dGVybW9zdCAmJiAhc2VlZCAmJiBzZXRNYXRjaGVkLmxlbmd0aCA+IDAgJiYKCQkJCQkoIG1hdGNoZWRDb3VudCArIHNldE1hdGNoZXJzLmxlbmd0aCApID4gMSApIHsKCgkJCQkJU2l6emxlLnVuaXF1ZVNvcnQoIHJlc3VsdHMgKTsKCQkJCX0KCQkJfQoKCQkJLy8gT3ZlcnJpZGUgbWFuaXB1bGF0aW9uIG9mIGdsb2JhbHMgYnkgbmVzdGVkIG1hdGNoZXJzCgkJCWlmICggb3V0ZXJtb3N0ICkgewoJCQkJZGlycnVucyA9IGRpcnJ1bnNVbmlxdWU7CgkJCQlvdXRlcm1vc3RDb250ZXh0ID0gY29udGV4dEJhY2t1cDsKCQkJfQoKCQkJcmV0dXJuIHVubWF0Y2hlZDsKCQl9OwoKCXJldHVybiBieVNldCA/CgkJbWFya0Z1bmN0aW9uKCBzdXBlck1hdGNoZXIgKSA6CgkJc3VwZXJNYXRjaGVyOwp9Cgpjb21waWxlID0gU2l6emxlLmNvbXBpbGUgPSBmdW5jdGlvbiggc2VsZWN0b3IsIG1hdGNoIC8qIEludGVybmFsIFVzZSBPbmx5ICovICkgewoJdmFyIGksCgkJc2V0TWF0Y2hlcnMgPSBbXSwKCQllbGVtZW50TWF0Y2hlcnMgPSBbXSwKCQljYWNoZWQgPSBjb21waWxlckNhY2hlWyBzZWxlY3RvciArICIgIiBdOwoKCWlmICggIWNhY2hlZCApIHsKCQkvLyBHZW5lcmF0ZSBhIGZ1bmN0aW9uIG9mIHJlY3Vyc2l2ZSBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgdXNlZCB0byBjaGVjayBlYWNoIGVsZW1lbnQKCQlpZiAoICFtYXRjaCApIHsKCQkJbWF0Y2ggPSB0b2tlbml6ZSggc2VsZWN0b3IgKTsKCQl9CgkJaSA9IG1hdGNoLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJY2FjaGVkID0gbWF0Y2hlckZyb21Ub2tlbnMoIG1hdGNoW2ldICk7CgkJCWlmICggY2FjaGVkWyBleHBhbmRvIF0gKSB7CgkJCQlzZXRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfSBlbHNlIHsKCQkJCWVsZW1lbnRNYXRjaGVycy5wdXNoKCBjYWNoZWQgKTsKCQkJfQoJCX0KCgkJLy8gQ2FjaGUgdGhlIGNvbXBpbGVkIGZ1bmN0aW9uCgkJY2FjaGVkID0gY29tcGlsZXJDYWNoZSggc2VsZWN0b3IsIG1hdGNoZXJGcm9tR3JvdXBNYXRjaGVycyggZWxlbWVudE1hdGNoZXJzLCBzZXRNYXRjaGVycyApICk7CgoJCS8vIFNhdmUgc2VsZWN0b3IgYW5kIHRva2VuaXphdGlvbgoJCWNhY2hlZC5zZWxlY3RvciA9IHNlbGVjdG9yOwoJfQoJcmV0dXJuIGNhY2hlZDsKfTsKCi8qKgogKiBBIGxvdy1sZXZlbCBzZWxlY3Rpb24gZnVuY3Rpb24gdGhhdCB3b3JrcyB3aXRoIFNpenpsZSdzIGNvbXBpbGVkCiAqICBzZWxlY3RvciBmdW5jdGlvbnMKICogQHBhcmFtIHtTdHJpbmd8RnVuY3Rpb259IHNlbGVjdG9yIEEgc2VsZWN0b3Igb3IgYSBwcmUtY29tcGlsZWQKICogIHNlbGVjdG9yIGZ1bmN0aW9uIGJ1aWx0IHdpdGggU2l6emxlLmNvbXBpbGUKICogQHBhcmFtIHtFbGVtZW50fSBjb250ZXh0CiAqIEBwYXJhbSB7QXJyYXl9IFtyZXN1bHRzXQogKiBAcGFyYW0ge0FycmF5fSBbc2VlZF0gQSBzZXQgb2YgZWxlbWVudHMgdG8gbWF0Y2ggYWdhaW5zdAogKi8Kc2VsZWN0ID0gU2l6emxlLnNlbGVjdCA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCwgcmVzdWx0cywgc2VlZCApIHsKCXZhciBpLCB0b2tlbnMsIHRva2VuLCB0eXBlLCBmaW5kLAoJCWNvbXBpbGVkID0gdHlwZW9mIHNlbGVjdG9yID09PSAiZnVuY3Rpb24iICYmIHNlbGVjdG9yLAoJCW1hdGNoID0gIXNlZWQgJiYgdG9rZW5pemUoIChzZWxlY3RvciA9IGNvbXBpbGVkLnNlbGVjdG9yIHx8IHNlbGVjdG9yKSApOwoKCXJlc3VsdHMgPSByZXN1bHRzIHx8IFtdOwoKCS8vIFRyeSB0byBtaW5pbWl6ZSBvcGVyYXRpb25zIGlmIHRoZXJlIGlzIG5vIHNlZWQgYW5kIG9ubHkgb25lIGdyb3VwCglpZiAoIG1hdGNoLmxlbmd0aCA9PT0gMSApIHsKCgkJLy8gVGFrZSBhIHNob3J0Y3V0IGFuZCBzZXQgdGhlIGNvbnRleHQgaWYgdGhlIHJvb3Qgc2VsZWN0b3IgaXMgYW4gSUQKCQl0b2tlbnMgPSBtYXRjaFswXSA9IG1hdGNoWzBdLnNsaWNlKCAwICk7CgkJaWYgKCB0b2tlbnMubGVuZ3RoID4gMiAmJiAodG9rZW4gPSB0b2tlbnNbMF0pLnR5cGUgPT09ICJJRCIgJiYKCQkJCXN1cHBvcnQuZ2V0QnlJZCAmJiBjb250ZXh0Lm5vZGVUeXBlID09PSA5ICYmIGRvY3VtZW50SXNIVE1MICYmCgkJCQlFeHByLnJlbGF0aXZlWyB0b2tlbnNbMV0udHlwZSBdICkgewoKCQkJY29udGV4dCA9ICggRXhwci5maW5kWyJJRCJdKCB0b2tlbi5tYXRjaGVzWzBdLnJlcGxhY2UocnVuZXNjYXBlLCBmdW5lc2NhcGUpLCBjb250ZXh0ICkgfHwgW10gKVswXTsKCQkJaWYgKCAhY29udGV4dCApIHsKCQkJCXJldHVybiByZXN1bHRzOwoKCQkJLy8gUHJlY29tcGlsZWQgbWF0Y2hlcnMgd2lsbCBzdGlsbCB2ZXJpZnkgYW5jZXN0cnksIHNvIHN0ZXAgdXAgYSBsZXZlbAoJCQl9IGVsc2UgaWYgKCBjb21waWxlZCApIHsKCQkJCWNvbnRleHQgPSBjb250ZXh0LnBhcmVudE5vZGU7CgkJCX0KCgkJCXNlbGVjdG9yID0gc2VsZWN0b3Iuc2xpY2UoIHRva2Vucy5zaGlmdCgpLnZhbHVlLmxlbmd0aCApOwoJCX0KCgkJLy8gRmV0Y2ggYSBzZWVkIHNldCBmb3IgcmlnaHQtdG8tbGVmdCBtYXRjaGluZwoJCWkgPSBtYXRjaEV4cHJbIm5lZWRzQ29udGV4dCJdLnRlc3QoIHNlbGVjdG9yICkgPyAwIDogdG9rZW5zLmxlbmd0aDsKCQl3aGlsZSAoIGktLSApIHsKCQkJdG9rZW4gPSB0b2tlbnNbaV07CgoJCQkvLyBBYm9ydCBpZiB3ZSBoaXQgYSBjb21iaW5hdG9yCgkJCWlmICggRXhwci5yZWxhdGl2ZVsgKHR5cGUgPSB0b2tlbi50eXBlKSBdICkgewoJCQkJYnJlYWs7CgkJCX0KCQkJaWYgKCAoZmluZCA9IEV4cHIuZmluZFsgdHlwZSBdKSApIHsKCQkJCS8vIFNlYXJjaCwgZXhwYW5kaW5nIGNvbnRleHQgZm9yIGxlYWRpbmcgc2libGluZyBjb21iaW5hdG9ycwoJCQkJaWYgKCAoc2VlZCA9IGZpbmQoCgkJCQkJdG9rZW4ubWF0Y2hlc1swXS5yZXBsYWNlKCBydW5lc2NhcGUsIGZ1bmVzY2FwZSApLAoJCQkJCXJzaWJsaW5nLnRlc3QoIHRva2Vuc1swXS50eXBlICkgJiYgdGVzdENvbnRleHQoIGNvbnRleHQucGFyZW50Tm9kZSApIHx8IGNvbnRleHQKCQkJCSkpICkgewoKCQkJCQkvLyBJZiBzZWVkIGlzIGVtcHR5IG9yIG5vIHRva2VucyByZW1haW4sIHdlIGNhbiByZXR1cm4gZWFybHkKCQkJCQl0b2tlbnMuc3BsaWNlKCBpLCAxICk7CgkJCQkJc2VsZWN0b3IgPSBzZWVkLmxlbmd0aCAmJiB0b1NlbGVjdG9yKCB0b2tlbnMgKTsKCQkJCQlpZiAoICFzZWxlY3RvciApIHsKCQkJCQkJcHVzaC5hcHBseSggcmVzdWx0cywgc2VlZCApOwoJCQkJCQlyZXR1cm4gcmVzdWx0czsKCQkJCQl9CgoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoJfQoKCS8vIENvbXBpbGUgYW5kIGV4ZWN1dGUgYSBmaWx0ZXJpbmcgZnVuY3Rpb24gaWYgb25lIGlzIG5vdCBwcm92aWRlZAoJLy8gUHJvdmlkZSBgbWF0Y2hgIHRvIGF2b2lkIHJldG9rZW5pemF0aW9uIGlmIHdlIG1vZGlmaWVkIHRoZSBzZWxlY3RvciBhYm92ZQoJKCBjb21waWxlZCB8fCBjb21waWxlKCBzZWxlY3RvciwgbWF0Y2ggKSApKAoJCXNlZWQsCgkJY29udGV4dCwKCQkhZG9jdW1lbnRJc0hUTUwsCgkJcmVzdWx0cywKCQlyc2libGluZy50ZXN0KCBzZWxlY3RvciApICYmIHRlc3RDb250ZXh0KCBjb250ZXh0LnBhcmVudE5vZGUgKSB8fCBjb250ZXh0CgkpOwoJcmV0dXJuIHJlc3VsdHM7Cn07CgovLyBPbmUtdGltZSBhc3NpZ25tZW50cwoKLy8gU29ydCBzdGFiaWxpdHkKc3VwcG9ydC5zb3J0U3RhYmxlID0gZXhwYW5kby5zcGxpdCgiIikuc29ydCggc29ydE9yZGVyICkuam9pbigiIikgPT09IGV4cGFuZG87CgovLyBTdXBwb3J0OiBDaHJvbWUgMTQtMzUrCi8vIEFsd2F5cyBhc3N1bWUgZHVwbGljYXRlcyBpZiB0aGV5IGFyZW4ndCBwYXNzZWQgdG8gdGhlIGNvbXBhcmlzb24gZnVuY3Rpb24Kc3VwcG9ydC5kZXRlY3REdXBsaWNhdGVzID0gISFoYXNEdXBsaWNhdGU7CgovLyBJbml0aWFsaXplIGFnYWluc3QgdGhlIGRlZmF1bHQgZG9jdW1lbnQKc2V0RG9jdW1lbnQoKTsKCi8vIFN1cHBvcnQ6IFdlYmtpdDw1MzcuMzIgLSBTYWZhcmkgNi4wLjMvQ2hyb21lIDI1IChmaXhlZCBpbiBDaHJvbWUgMjcpCi8vIERldGFjaGVkIG5vZGVzIGNvbmZvdW5kaW5nbHkgZm9sbG93ICplYWNoIG90aGVyKgpzdXBwb3J0LnNvcnREZXRhY2hlZCA9IGFzc2VydChmdW5jdGlvbiggZGl2MSApIHsKCS8vIFNob3VsZCByZXR1cm4gMSwgYnV0IHJldHVybnMgNCAoZm9sbG93aW5nKQoJcmV0dXJuIGRpdjEuY29tcGFyZURvY3VtZW50UG9zaXRpb24oIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpICkgJiAxOwp9KTsKCi8vIFN1cHBvcnQ6IElFPDgKLy8gUHJldmVudCBhdHRyaWJ1dGUvcHJvcGVydHkgImludGVycG9sYXRpb24iCi8vIGh0dHA6Ly9tc2RuLm1pY3Jvc29mdC5jb20vZW4tdXMvbGlicmFyeS9tczUzNjQyOSUyOFZTLjg1JTI5LmFzcHgKaWYgKCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CglkaXYuaW5uZXJIVE1MID0gIjxhIGhyZWY9JyMnPjwvYT4iOwoJcmV0dXJuIGRpdi5maXJzdENoaWxkLmdldEF0dHJpYnV0ZSgiaHJlZiIpID09PSAiIyIgOwp9KSApIHsKCWFkZEhhbmRsZSggInR5cGV8aHJlZnxoZWlnaHR8d2lkdGgiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCXJldHVybiBlbGVtLmdldEF0dHJpYnV0ZSggbmFtZSwgbmFtZS50b0xvd2VyQ2FzZSgpID09PSAidHlwZSIgPyAxIDogMiApOwoJCX0KCX0pOwp9CgovLyBTdXBwb3J0OiBJRTw5Ci8vIFVzZSBkZWZhdWx0VmFsdWUgaW4gcGxhY2Ugb2YgZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpCmlmICggIXN1cHBvcnQuYXR0cmlidXRlcyB8fCAhYXNzZXJ0KGZ1bmN0aW9uKCBkaXYgKSB7CglkaXYuaW5uZXJIVE1MID0gIjxpbnB1dC8+IjsKCWRpdi5maXJzdENoaWxkLnNldEF0dHJpYnV0ZSggInZhbHVlIiwgIiIgKTsKCXJldHVybiBkaXYuZmlyc3RDaGlsZC5nZXRBdHRyaWJ1dGUoICJ2YWx1ZSIgKSA9PT0gIiI7Cn0pICkgewoJYWRkSGFuZGxlKCAidmFsdWUiLCBmdW5jdGlvbiggZWxlbSwgbmFtZSwgaXNYTUwgKSB7CgkJaWYgKCAhaXNYTUwgJiYgZWxlbS5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSAiaW5wdXQiICkgewoJCQlyZXR1cm4gZWxlbS5kZWZhdWx0VmFsdWU7CgkJfQoJfSk7Cn0KCi8vIFN1cHBvcnQ6IElFPDkKLy8gVXNlIGdldEF0dHJpYnV0ZU5vZGUgdG8gZmV0Y2ggYm9vbGVhbnMgd2hlbiBnZXRBdHRyaWJ1dGUgbGllcwppZiAoICFhc3NlcnQoZnVuY3Rpb24oIGRpdiApIHsKCXJldHVybiBkaXYuZ2V0QXR0cmlidXRlKCJkaXNhYmxlZCIpID09IG51bGw7Cn0pICkgewoJYWRkSGFuZGxlKCBib29sZWFucywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGlzWE1MICkgewoJCXZhciB2YWw7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCXJldHVybiBlbGVtWyBuYW1lIF0gPT09IHRydWUgPyBuYW1lLnRvTG93ZXJDYXNlKCkgOgoJCQkJCSh2YWwgPSBlbGVtLmdldEF0dHJpYnV0ZU5vZGUoIG5hbWUgKSkgJiYgdmFsLnNwZWNpZmllZCA/CgkJCQkJdmFsLnZhbHVlIDoKCQkJCW51bGw7CgkJfQoJfSk7Cn0KCnJldHVybiBTaXp6bGU7Cgp9KSggd2luZG93ICk7CgoKCmpRdWVyeS5maW5kID0gU2l6emxlOwpqUXVlcnkuZXhwciA9IFNpenpsZS5zZWxlY3RvcnM7CmpRdWVyeS5leHByWyI6Il0gPSBqUXVlcnkuZXhwci5wc2V1ZG9zOwpqUXVlcnkudW5pcXVlID0gU2l6emxlLnVuaXF1ZVNvcnQ7CmpRdWVyeS50ZXh0ID0gU2l6emxlLmdldFRleHQ7CmpRdWVyeS5pc1hNTERvYyA9IFNpenpsZS5pc1hNTDsKalF1ZXJ5LmNvbnRhaW5zID0gU2l6emxlLmNvbnRhaW5zOwoKCgp2YXIgcm5lZWRzQ29udGV4dCA9IGpRdWVyeS5leHByLm1hdGNoLm5lZWRzQ29udGV4dDsKCnZhciByc2luZ2xlVGFnID0gKC9ePChcdyspXHMqXC8/Pig/OjxcL1wxPnwpJC8pOwoKCgp2YXIgcmlzU2ltcGxlID0gL14uW146I1xbXC4sXSokLzsKCi8vIEltcGxlbWVudCB0aGUgaWRlbnRpY2FsIGZ1bmN0aW9uYWxpdHkgZm9yIGZpbHRlciBhbmQgbm90CmZ1bmN0aW9uIHdpbm5vdyggZWxlbWVudHMsIHF1YWxpZmllciwgbm90ICkgewoJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcXVhbGlmaWVyICkgKSB7CgkJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0sIGkgKSB7CgkJCS8qIGpzaGludCAtVzAxOCAqLwoJCQlyZXR1cm4gISFxdWFsaWZpZXIuY2FsbCggZWxlbSwgaSwgZWxlbSApICE9PSBub3Q7CgkJfSk7CgoJfQoKCWlmICggcXVhbGlmaWVyLm5vZGVUeXBlICkgewoJCXJldHVybiBqUXVlcnkuZ3JlcCggZWxlbWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gKCBlbGVtID09PSBxdWFsaWZpZXIgKSAhPT0gbm90OwoJCX0pOwoKCX0KCglpZiAoIHR5cGVvZiBxdWFsaWZpZXIgPT09ICJzdHJpbmciICkgewoJCWlmICggcmlzU2ltcGxlLnRlc3QoIHF1YWxpZmllciApICkgewoJCQlyZXR1cm4galF1ZXJ5LmZpbHRlciggcXVhbGlmaWVyLCBlbGVtZW50cywgbm90ICk7CgkJfQoKCQlxdWFsaWZpZXIgPSBqUXVlcnkuZmlsdGVyKCBxdWFsaWZpZXIsIGVsZW1lbnRzICk7Cgl9CgoJcmV0dXJuIGpRdWVyeS5ncmVwKCBlbGVtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuICggaW5kZXhPZi5jYWxsKCBxdWFsaWZpZXIsIGVsZW0gKSA+PSAwICkgIT09IG5vdDsKCX0pOwp9CgpqUXVlcnkuZmlsdGVyID0gZnVuY3Rpb24oIGV4cHIsIGVsZW1zLCBub3QgKSB7Cgl2YXIgZWxlbSA9IGVsZW1zWyAwIF07CgoJaWYgKCBub3QgKSB7CgkJZXhwciA9ICI6bm90KCIgKyBleHByICsgIikiOwoJfQoKCXJldHVybiBlbGVtcy5sZW5ndGggPT09IDEgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSA/CgkJalF1ZXJ5LmZpbmQubWF0Y2hlc1NlbGVjdG9yKCBlbGVtLCBleHByICkgPyBbIGVsZW0gXSA6IFtdIDoKCQlqUXVlcnkuZmluZC5tYXRjaGVzKCBleHByLCBqUXVlcnkuZ3JlcCggZWxlbXMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlyZXR1cm4gZWxlbS5ub2RlVHlwZSA9PT0gMTsKCQl9KSk7Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWZpbmQ6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgaSwKCQkJbGVuID0gdGhpcy5sZW5ndGgsCgkJCXJldCA9IFtdLAoJCQlzZWxmID0gdGhpczsKCgkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgIT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIGpRdWVyeSggc2VsZWN0b3IgKS5maWx0ZXIoZnVuY3Rpb24oKSB7CgkJCQlmb3IgKCBpID0gMDsgaSA8IGxlbjsgaSsrICkgewoJCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCBzZWxmWyBpIF0sIHRoaXMgKSApIHsKCQkJCQkJcmV0dXJuIHRydWU7CgkJCQkJfQoJCQkJfQoJCQl9KSApOwoJCX0KCgkJZm9yICggaSA9IDA7IGkgPCBsZW47IGkrKyApIHsKCQkJalF1ZXJ5LmZpbmQoIHNlbGVjdG9yLCBzZWxmWyBpIF0sIHJldCApOwoJCX0KCgkJLy8gTmVlZGVkIGJlY2F1c2UgJCggc2VsZWN0b3IsIGNvbnRleHQgKSBiZWNvbWVzICQoIGNvbnRleHQgKS5maW5kKCBzZWxlY3RvciApCgkJcmV0ID0gdGhpcy5wdXNoU3RhY2soIGxlbiA+IDEgPyBqUXVlcnkudW5pcXVlKCByZXQgKSA6IHJldCApOwoJCXJldC5zZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IgPyB0aGlzLnNlbGVjdG9yICsgIiAiICsgc2VsZWN0b3IgOiBzZWxlY3RvcjsKCQlyZXR1cm4gcmV0OwoJfSwKCWZpbHRlcjogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggd2lubm93KHRoaXMsIHNlbGVjdG9yIHx8IFtdLCBmYWxzZSkgKTsKCX0sCglub3Q6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIHdpbm5vdyh0aGlzLCBzZWxlY3RvciB8fCBbXSwgdHJ1ZSkgKTsKCX0sCglpczogZnVuY3Rpb24oIHNlbGVjdG9yICkgewoJCXJldHVybiAhIXdpbm5vdygKCQkJdGhpcywKCgkJCS8vIElmIHRoaXMgaXMgYSBwb3NpdGlvbmFsL3JlbGF0aXZlIHNlbGVjdG9yLCBjaGVjayBtZW1iZXJzaGlwIGluIHRoZSByZXR1cm5lZCBzZXQKCQkJLy8gc28gJCgicDpmaXJzdCIpLmlzKCJwOmxhc3QiKSB3b24ndCByZXR1cm4gdHJ1ZSBmb3IgYSBkb2Mgd2l0aCB0d28gInAiLgoJCQl0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICYmIHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3IgKSA/CgkJCQlqUXVlcnkoIHNlbGVjdG9yICkgOgoJCQkJc2VsZWN0b3IgfHwgW10sCgkJCWZhbHNlCgkJKS5sZW5ndGg7Cgl9Cn0pOwoKCi8vIEluaXRpYWxpemUgYSBqUXVlcnkgb2JqZWN0CgoKLy8gQSBjZW50cmFsIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBqUXVlcnkoZG9jdW1lbnQpCnZhciByb290alF1ZXJ5LAoKCS8vIEEgc2ltcGxlIHdheSB0byBjaGVjayBmb3IgSFRNTCBzdHJpbmdzCgkvLyBQcmlvcml0aXplICNpZCBvdmVyIDx0YWc+IHRvIGF2b2lkIFhTUyB2aWEgbG9jYXRpb24uaGFzaCAoIzk1MjEpCgkvLyBTdHJpY3QgSFRNTCByZWNvZ25pdGlvbiAoIzExMjkwOiBtdXN0IHN0YXJ0IHdpdGggPCkKCXJxdWlja0V4cHIgPSAvXig/OlxzKig8W1x3XFddKz4pW14+XSp8IyhbXHctXSopKSQvLAoKCWluaXQgPSBqUXVlcnkuZm4uaW5pdCA9IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQl2YXIgbWF0Y2gsIGVsZW07CgoJCS8vIEhBTkRMRTogJCgiIiksICQobnVsbCksICQodW5kZWZpbmVkKSwgJChmYWxzZSkKCQlpZiAoICFzZWxlY3RvciApIHsKCQkJcmV0dXJuIHRoaXM7CgkJfQoKCQkvLyBIYW5kbGUgSFRNTCBzdHJpbmdzCgkJaWYgKCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJzdHJpbmciICkgewoJCQlpZiAoIHNlbGVjdG9yWzBdID09PSAiPCIgJiYgc2VsZWN0b3JbIHNlbGVjdG9yLmxlbmd0aCAtIDEgXSA9PT0gIj4iICYmIHNlbGVjdG9yLmxlbmd0aCA+PSAzICkgewoJCQkJLy8gQXNzdW1lIHRoYXQgc3RyaW5ncyB0aGF0IHN0YXJ0IGFuZCBlbmQgd2l0aCA8PiBhcmUgSFRNTCBhbmQgc2tpcCB0aGUgcmVnZXggY2hlY2sKCQkJCW1hdGNoID0gWyBudWxsLCBzZWxlY3RvciwgbnVsbCBdOwoKCQkJfSBlbHNlIHsKCQkJCW1hdGNoID0gcnF1aWNrRXhwci5leGVjKCBzZWxlY3RvciApOwoJCQl9CgoJCQkvLyBNYXRjaCBodG1sIG9yIG1ha2Ugc3VyZSBubyBjb250ZXh0IGlzIHNwZWNpZmllZCBmb3IgI2lkCgkJCWlmICggbWF0Y2ggJiYgKG1hdGNoWzFdIHx8ICFjb250ZXh0KSApIHsKCgkJCQkvLyBIQU5ETEU6ICQoaHRtbCkgLT4gJChhcnJheSkKCQkJCWlmICggbWF0Y2hbMV0gKSB7CgkJCQkJY29udGV4dCA9IGNvbnRleHQgaW5zdGFuY2VvZiBqUXVlcnkgPyBjb250ZXh0WzBdIDogY29udGV4dDsKCgkJCQkJLy8gT3B0aW9uIHRvIHJ1biBzY3JpcHRzIGlzIHRydWUgZm9yIGJhY2stY29tcGF0CgkJCQkJLy8gSW50ZW50aW9uYWxseSBsZXQgdGhlIGVycm9yIGJlIHRocm93biBpZiBwYXJzZUhUTUwgaXMgbm90IHByZXNlbnQKCQkJCQlqUXVlcnkubWVyZ2UoIHRoaXMsIGpRdWVyeS5wYXJzZUhUTUwoCgkJCQkJCW1hdGNoWzFdLAoJCQkJCQljb250ZXh0ICYmIGNvbnRleHQubm9kZVR5cGUgPyBjb250ZXh0Lm93bmVyRG9jdW1lbnQgfHwgY29udGV4dCA6IGRvY3VtZW50LAoJCQkJCQl0cnVlCgkJCQkJKSApOwoKCQkJCQkvLyBIQU5ETEU6ICQoaHRtbCwgcHJvcHMpCgkJCQkJaWYgKCByc2luZ2xlVGFnLnRlc3QoIG1hdGNoWzFdICkgJiYgalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGNvbnRleHQgKSApIHsKCQkJCQkJZm9yICggbWF0Y2ggaW4gY29udGV4dCApIHsKCQkJCQkJCS8vIFByb3BlcnRpZXMgb2YgY29udGV4dCBhcmUgY2FsbGVkIGFzIG1ldGhvZHMgaWYgcG9zc2libGUKCQkJCQkJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHRoaXNbIG1hdGNoIF0gKSApIHsKCQkJCQkJCQl0aGlzWyBtYXRjaCBdKCBjb250ZXh0WyBtYXRjaCBdICk7CgoJCQkJCQkJLy8gLi4uYW5kIG90aGVyd2lzZSBzZXQgYXMgYXR0cmlidXRlcwoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQl0aGlzLmF0dHIoIG1hdGNoLCBjb250ZXh0WyBtYXRjaCBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgoJCQkJCXJldHVybiB0aGlzOwoKCQkJCS8vIEhBTkRMRTogJCgjaWQpCgkJCQl9IGVsc2UgewoJCQkJCWVsZW0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCggbWF0Y2hbMl0gKTsKCgkJCQkJLy8gU3VwcG9ydDogQmxhY2tiZXJyeSA0LjYKCQkJCQkvLyBnRUJJRCByZXR1cm5zIG5vZGVzIG5vIGxvbmdlciBpbiB0aGUgZG9jdW1lbnQgKCM2OTYzKQoJCQkJCWlmICggZWxlbSAmJiBlbGVtLnBhcmVudE5vZGUgKSB7CgkJCQkJCS8vIEluamVjdCB0aGUgZWxlbWVudCBkaXJlY3RseSBpbnRvIHRoZSBqUXVlcnkgb2JqZWN0CgkJCQkJCXRoaXMubGVuZ3RoID0gMTsKCQkJCQkJdGhpc1swXSA9IGVsZW07CgkJCQkJfQoKCQkJCQl0aGlzLmNvbnRleHQgPSBkb2N1bWVudDsKCQkJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3I7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgoJCQkvLyBIQU5ETEU6ICQoZXhwciwgJCguLi4pKQoJCQl9IGVsc2UgaWYgKCAhY29udGV4dCB8fCBjb250ZXh0LmpxdWVyeSApIHsKCQkJCXJldHVybiAoIGNvbnRleHQgfHwgcm9vdGpRdWVyeSApLmZpbmQoIHNlbGVjdG9yICk7CgoJCQkvLyBIQU5ETEU6ICQoZXhwciwgY29udGV4dCkKCQkJLy8gKHdoaWNoIGlzIGp1c3QgZXF1aXZhbGVudCB0bzogJChjb250ZXh0KS5maW5kKGV4cHIpCgkJCX0gZWxzZSB7CgkJCQlyZXR1cm4gdGhpcy5jb25zdHJ1Y3RvciggY29udGV4dCApLmZpbmQoIHNlbGVjdG9yICk7CgkJCX0KCgkJLy8gSEFORExFOiAkKERPTUVsZW1lbnQpCgkJfSBlbHNlIGlmICggc2VsZWN0b3Iubm9kZVR5cGUgKSB7CgkJCXRoaXMuY29udGV4dCA9IHRoaXNbMF0gPSBzZWxlY3RvcjsKCQkJdGhpcy5sZW5ndGggPSAxOwoJCQlyZXR1cm4gdGhpczsKCgkJLy8gSEFORExFOiAkKGZ1bmN0aW9uKQoJCS8vIFNob3J0Y3V0IGZvciBkb2N1bWVudCByZWFkeQoJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBzZWxlY3RvciApICkgewoJCQlyZXR1cm4gdHlwZW9mIHJvb3RqUXVlcnkucmVhZHkgIT09ICJ1bmRlZmluZWQiID8KCQkJCXJvb3RqUXVlcnkucmVhZHkoIHNlbGVjdG9yICkgOgoJCQkJLy8gRXhlY3V0ZSBpbW1lZGlhdGVseSBpZiByZWFkeSBpcyBub3QgcHJlc2VudAoJCQkJc2VsZWN0b3IoIGpRdWVyeSApOwoJCX0KCgkJaWYgKCBzZWxlY3Rvci5zZWxlY3RvciAhPT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLnNlbGVjdG9yID0gc2VsZWN0b3Iuc2VsZWN0b3I7CgkJCXRoaXMuY29udGV4dCA9IHNlbGVjdG9yLmNvbnRleHQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5Lm1ha2VBcnJheSggc2VsZWN0b3IsIHRoaXMgKTsKCX07CgovLyBHaXZlIHRoZSBpbml0IGZ1bmN0aW9uIHRoZSBqUXVlcnkgcHJvdG90eXBlIGZvciBsYXRlciBpbnN0YW50aWF0aW9uCmluaXQucHJvdG90eXBlID0galF1ZXJ5LmZuOwoKLy8gSW5pdGlhbGl6ZSBjZW50cmFsIHJlZmVyZW5jZQpyb290alF1ZXJ5ID0galF1ZXJ5KCBkb2N1bWVudCApOwoKCnZhciBycGFyZW50c3ByZXYgPSAvXig/OnBhcmVudHN8cHJldig/OlVudGlsfEFsbCkpLywKCS8vIE1ldGhvZHMgZ3VhcmFudGVlZCB0byBwcm9kdWNlIGEgdW5pcXVlIHNldCB3aGVuIHN0YXJ0aW5nIGZyb20gYSB1bmlxdWUgc2V0CglndWFyYW50ZWVkVW5pcXVlID0gewoJCWNoaWxkcmVuOiB0cnVlLAoJCWNvbnRlbnRzOiB0cnVlLAoJCW5leHQ6IHRydWUsCgkJcHJldjogdHJ1ZQoJfTsKCmpRdWVyeS5leHRlbmQoewoJZGlyOiBmdW5jdGlvbiggZWxlbSwgZGlyLCB1bnRpbCApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdLAoJCQl0cnVuY2F0ZSA9IHVudGlsICE9PSB1bmRlZmluZWQ7CgoJCXdoaWxlICggKGVsZW0gPSBlbGVtWyBkaXIgXSkgJiYgZWxlbS5ub2RlVHlwZSAhPT0gOSApIHsKCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJaWYgKCB0cnVuY2F0ZSAmJiBqUXVlcnkoIGVsZW0gKS5pcyggdW50aWwgKSApIHsKCQkJCQlicmVhazsKCQkJCX0KCQkJCW1hdGNoZWQucHVzaCggZWxlbSApOwoJCQl9CgkJfQoJCXJldHVybiBtYXRjaGVkOwoJfSwKCglzaWJsaW5nOiBmdW5jdGlvbiggbiwgZWxlbSApIHsKCQl2YXIgbWF0Y2hlZCA9IFtdOwoKCQlmb3IgKCA7IG47IG4gPSBuLm5leHRTaWJsaW5nICkgewoJCQlpZiAoIG4ubm9kZVR5cGUgPT09IDEgJiYgbiAhPT0gZWxlbSApIHsKCQkJCW1hdGNoZWQucHVzaCggbiApOwoJCQl9CgkJfQoKCQlyZXR1cm4gbWF0Y2hlZDsKCX0KfSk7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWhhczogZnVuY3Rpb24oIHRhcmdldCApIHsKCQl2YXIgdGFyZ2V0cyA9IGpRdWVyeSggdGFyZ2V0LCB0aGlzICksCgkJCWwgPSB0YXJnZXRzLmxlbmd0aDsKCgkJcmV0dXJuIHRoaXMuZmlsdGVyKGZ1bmN0aW9uKCkgewoJCQl2YXIgaSA9IDA7CgkJCWZvciAoIDsgaSA8IGw7IGkrKyApIHsKCQkJCWlmICggalF1ZXJ5LmNvbnRhaW5zKCB0aGlzLCB0YXJnZXRzW2ldICkgKSB7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgkJCX0KCQl9KTsKCX0sCgoJY2xvc2VzdDogZnVuY3Rpb24oIHNlbGVjdG9ycywgY29udGV4dCApIHsKCQl2YXIgY3VyLAoJCQlpID0gMCwKCQkJbCA9IHRoaXMubGVuZ3RoLAoJCQltYXRjaGVkID0gW10sCgkJCXBvcyA9IHJuZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3JzICkgfHwgdHlwZW9mIHNlbGVjdG9ycyAhPT0gInN0cmluZyIgPwoJCQkJalF1ZXJ5KCBzZWxlY3RvcnMsIGNvbnRleHQgfHwgdGhpcy5jb250ZXh0ICkgOgoJCQkJMDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQlmb3IgKCBjdXIgPSB0aGlzW2ldOyBjdXIgJiYgY3VyICE9PSBjb250ZXh0OyBjdXIgPSBjdXIucGFyZW50Tm9kZSApIHsKCQkJCS8vIEFsd2F5cyBza2lwIGRvY3VtZW50IGZyYWdtZW50cwoJCQkJaWYgKCBjdXIubm9kZVR5cGUgPCAxMSAmJiAocG9zID8KCQkJCQlwb3MuaW5kZXgoY3VyKSA+IC0xIDoKCgkJCQkJLy8gRG9uJ3QgcGFzcyBub24tZWxlbWVudHMgdG8gU2l6emxlCgkJCQkJY3VyLm5vZGVUeXBlID09PSAxICYmCgkJCQkJCWpRdWVyeS5maW5kLm1hdGNoZXNTZWxlY3RvcihjdXIsIHNlbGVjdG9ycykpICkgewoKCQkJCQltYXRjaGVkLnB1c2goIGN1ciApOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soIG1hdGNoZWQubGVuZ3RoID4gMSA/IGpRdWVyeS51bmlxdWUoIG1hdGNoZWQgKSA6IG1hdGNoZWQgKTsKCX0sCgoJLy8gRGV0ZXJtaW5lIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IHdpdGhpbiB0aGUgc2V0CglpbmRleDogZnVuY3Rpb24oIGVsZW0gKSB7CgoJCS8vIE5vIGFyZ3VtZW50LCByZXR1cm4gaW5kZXggaW4gcGFyZW50CgkJaWYgKCAhZWxlbSApIHsKCQkJcmV0dXJuICggdGhpc1sgMCBdICYmIHRoaXNbIDAgXS5wYXJlbnROb2RlICkgPyB0aGlzLmZpcnN0KCkucHJldkFsbCgpLmxlbmd0aCA6IC0xOwoJCX0KCgkJLy8gSW5kZXggaW4gc2VsZWN0b3IKCQlpZiAoIHR5cGVvZiBlbGVtID09PSAic3RyaW5nIiApIHsKCQkJcmV0dXJuIGluZGV4T2YuY2FsbCggalF1ZXJ5KCBlbGVtICksIHRoaXNbIDAgXSApOwoJCX0KCgkJLy8gTG9jYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgZGVzaXJlZCBlbGVtZW50CgkJcmV0dXJuIGluZGV4T2YuY2FsbCggdGhpcywKCgkJCS8vIElmIGl0IHJlY2VpdmVzIGEgalF1ZXJ5IG9iamVjdCwgdGhlIGZpcnN0IGVsZW1lbnQgaXMgdXNlZAoJCQllbGVtLmpxdWVyeSA/IGVsZW1bIDAgXSA6IGVsZW0KCQkpOwoJfSwKCglhZGQ6IGZ1bmN0aW9uKCBzZWxlY3RvciwgY29udGV4dCApIHsKCQlyZXR1cm4gdGhpcy5wdXNoU3RhY2soCgkJCWpRdWVyeS51bmlxdWUoCgkJCQlqUXVlcnkubWVyZ2UoIHRoaXMuZ2V0KCksIGpRdWVyeSggc2VsZWN0b3IsIGNvbnRleHQgKSApCgkJCSkKCQkpOwoJfSwKCglhZGRCYWNrOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMuYWRkKCBzZWxlY3RvciA9PSBudWxsID8KCQkJdGhpcy5wcmV2T2JqZWN0IDogdGhpcy5wcmV2T2JqZWN0LmZpbHRlcihzZWxlY3RvcikKCQkpOwoJfQp9KTsKCmZ1bmN0aW9uIHNpYmxpbmcoIGN1ciwgZGlyICkgewoJd2hpbGUgKCAoY3VyID0gY3VyW2Rpcl0pICYmIGN1ci5ub2RlVHlwZSAhPT0gMSApIHt9CglyZXR1cm4gY3VyOwp9CgpqUXVlcnkuZWFjaCh7CglwYXJlbnQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXZhciBwYXJlbnQgPSBlbGVtLnBhcmVudE5vZGU7CgkJcmV0dXJuIHBhcmVudCAmJiBwYXJlbnQubm9kZVR5cGUgIT09IDExID8gcGFyZW50IDogbnVsbDsKCX0sCglwYXJlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LmRpciggZWxlbSwgInBhcmVudE5vZGUiICk7Cgl9LAoJcGFyZW50c1VudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwYXJlbnROb2RlIiwgdW50aWwgKTsKCX0sCgluZXh0OiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gc2libGluZyggZWxlbSwgIm5leHRTaWJsaW5nIiApOwoJfSwKCXByZXY6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBzaWJsaW5nKCBlbGVtLCAicHJldmlvdXNTaWJsaW5nIiApOwoJfSwKCW5leHRBbGw6IGZ1bmN0aW9uKCBlbGVtICkgewoJCXJldHVybiBqUXVlcnkuZGlyKCBlbGVtLCAibmV4dFNpYmxpbmciICk7Cgl9LAoJcHJldkFsbDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciICk7Cgl9LAoJbmV4dFVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJuZXh0U2libGluZyIsIHVudGlsICk7Cgl9LAoJcHJldlVudGlsOiBmdW5jdGlvbiggZWxlbSwgaSwgdW50aWwgKSB7CgkJcmV0dXJuIGpRdWVyeS5kaXIoIGVsZW0sICJwcmV2aW91c1NpYmxpbmciLCB1bnRpbCApOwoJfSwKCXNpYmxpbmdzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LnNpYmxpbmcoICggZWxlbS5wYXJlbnROb2RlIHx8IHt9ICkuZmlyc3RDaGlsZCwgZWxlbSApOwoJfSwKCWNoaWxkcmVuOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4galF1ZXJ5LnNpYmxpbmcoIGVsZW0uZmlyc3RDaGlsZCApOwoJfSwKCWNvbnRlbnRzOiBmdW5jdGlvbiggZWxlbSApIHsKCQlyZXR1cm4gZWxlbS5jb250ZW50RG9jdW1lbnQgfHwgalF1ZXJ5Lm1lcmdlKCBbXSwgZWxlbS5jaGlsZE5vZGVzICk7Cgl9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBmbiApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHVudGlsLCBzZWxlY3RvciApIHsKCQl2YXIgbWF0Y2hlZCA9IGpRdWVyeS5tYXAoIHRoaXMsIGZuLCB1bnRpbCApOwoKCQlpZiAoIG5hbWUuc2xpY2UoIC01ICkgIT09ICJVbnRpbCIgKSB7CgkJCXNlbGVjdG9yID0gdW50aWw7CgkJfQoKCQlpZiAoIHNlbGVjdG9yICYmIHR5cGVvZiBzZWxlY3RvciA9PT0gInN0cmluZyIgKSB7CgkJCW1hdGNoZWQgPSBqUXVlcnkuZmlsdGVyKCBzZWxlY3RvciwgbWF0Y2hlZCApOwoJCX0KCgkJaWYgKCB0aGlzLmxlbmd0aCA+IDEgKSB7CgkJCS8vIFJlbW92ZSBkdXBsaWNhdGVzCgkJCWlmICggIWd1YXJhbnRlZWRVbmlxdWVbIG5hbWUgXSApIHsKCQkJCWpRdWVyeS51bmlxdWUoIG1hdGNoZWQgKTsKCQkJfQoKCQkJLy8gUmV2ZXJzZSBvcmRlciBmb3IgcGFyZW50cyogYW5kIHByZXYtZGVyaXZhdGl2ZXMKCQkJaWYgKCBycGFyZW50c3ByZXYudGVzdCggbmFtZSApICkgewoJCQkJbWF0Y2hlZC5yZXZlcnNlKCk7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggbWF0Y2hlZCApOwoJfTsKfSk7CnZhciBybm90d2hpdGUgPSAoL1xTKy9nKTsKCgoKLy8gU3RyaW5nIHRvIE9iamVjdCBvcHRpb25zIGZvcm1hdCBjYWNoZQp2YXIgb3B0aW9uc0NhY2hlID0ge307CgovLyBDb252ZXJ0IFN0cmluZy1mb3JtYXR0ZWQgb3B0aW9ucyBpbnRvIE9iamVjdC1mb3JtYXR0ZWQgb25lcyBhbmQgc3RvcmUgaW4gY2FjaGUKZnVuY3Rpb24gY3JlYXRlT3B0aW9ucyggb3B0aW9ucyApIHsKCXZhciBvYmplY3QgPSBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSA9IHt9OwoJalF1ZXJ5LmVhY2goIG9wdGlvbnMubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdLCBmdW5jdGlvbiggXywgZmxhZyApIHsKCQlvYmplY3RbIGZsYWcgXSA9IHRydWU7Cgl9KTsKCXJldHVybiBvYmplY3Q7Cn0KCi8qCiAqIENyZWF0ZSBhIGNhbGxiYWNrIGxpc3QgdXNpbmcgdGhlIGZvbGxvd2luZyBwYXJhbWV0ZXJzOgogKgogKglvcHRpb25zOiBhbiBvcHRpb25hbCBsaXN0IG9mIHNwYWNlLXNlcGFyYXRlZCBvcHRpb25zIHRoYXQgd2lsbCBjaGFuZ2UgaG93CiAqCQkJdGhlIGNhbGxiYWNrIGxpc3QgYmVoYXZlcyBvciBhIG1vcmUgdHJhZGl0aW9uYWwgb3B0aW9uIG9iamVjdAogKgogKiBCeSBkZWZhdWx0IGEgY2FsbGJhY2sgbGlzdCB3aWxsIGFjdCBsaWtlIGFuIGV2ZW50IGNhbGxiYWNrIGxpc3QgYW5kIGNhbiBiZQogKiAiZmlyZWQiIG11bHRpcGxlIHRpbWVzLgogKgogKiBQb3NzaWJsZSBvcHRpb25zOgogKgogKglvbmNlOgkJCXdpbGwgZW5zdXJlIHRoZSBjYWxsYmFjayBsaXN0IGNhbiBvbmx5IGJlIGZpcmVkIG9uY2UgKGxpa2UgYSBEZWZlcnJlZCkKICoKICoJbWVtb3J5OgkJCXdpbGwga2VlcCB0cmFjayBvZiBwcmV2aW91cyB2YWx1ZXMgYW5kIHdpbGwgY2FsbCBhbnkgY2FsbGJhY2sgYWRkZWQKICoJCQkJCWFmdGVyIHRoZSBsaXN0IGhhcyBiZWVuIGZpcmVkIHJpZ2h0IGF3YXkgd2l0aCB0aGUgbGF0ZXN0ICJtZW1vcml6ZWQiCiAqCQkJCQl2YWx1ZXMgKGxpa2UgYSBEZWZlcnJlZCkKICoKICoJdW5pcXVlOgkJCXdpbGwgZW5zdXJlIGEgY2FsbGJhY2sgY2FuIG9ubHkgYmUgYWRkZWQgb25jZSAobm8gZHVwbGljYXRlIGluIHRoZSBsaXN0KQogKgogKglzdG9wT25GYWxzZToJaW50ZXJydXB0IGNhbGxpbmdzIHdoZW4gYSBjYWxsYmFjayByZXR1cm5zIGZhbHNlCiAqCiAqLwpqUXVlcnkuQ2FsbGJhY2tzID0gZnVuY3Rpb24oIG9wdGlvbnMgKSB7CgoJLy8gQ29udmVydCBvcHRpb25zIGZyb20gU3RyaW5nLWZvcm1hdHRlZCB0byBPYmplY3QtZm9ybWF0dGVkIGlmIG5lZWRlZAoJLy8gKHdlIGNoZWNrIGluIGNhY2hlIGZpcnN0KQoJb3B0aW9ucyA9IHR5cGVvZiBvcHRpb25zID09PSAic3RyaW5nIiA/CgkJKCBvcHRpb25zQ2FjaGVbIG9wdGlvbnMgXSB8fCBjcmVhdGVPcHRpb25zKCBvcHRpb25zICkgKSA6CgkJalF1ZXJ5LmV4dGVuZCgge30sIG9wdGlvbnMgKTsKCgl2YXIgLy8gTGFzdCBmaXJlIHZhbHVlIChmb3Igbm9uLWZvcmdldHRhYmxlIGxpc3RzKQoJCW1lbW9yeSwKCQkvLyBGbGFnIHRvIGtub3cgaWYgbGlzdCB3YXMgYWxyZWFkeSBmaXJlZAoJCWZpcmVkLAoJCS8vIEZsYWcgdG8ga25vdyBpZiBsaXN0IGlzIGN1cnJlbnRseSBmaXJpbmcKCQlmaXJpbmcsCgkJLy8gRmlyc3QgY2FsbGJhY2sgdG8gZmlyZSAodXNlZCBpbnRlcm5hbGx5IGJ5IGFkZCBhbmQgZmlyZVdpdGgpCgkJZmlyaW5nU3RhcnQsCgkJLy8gRW5kIG9mIHRoZSBsb29wIHdoZW4gZmlyaW5nCgkJZmlyaW5nTGVuZ3RoLAoJCS8vIEluZGV4IG9mIGN1cnJlbnRseSBmaXJpbmcgY2FsbGJhY2sgKG1vZGlmaWVkIGJ5IHJlbW92ZSBpZiBuZWVkZWQpCgkJZmlyaW5nSW5kZXgsCgkJLy8gQWN0dWFsIGNhbGxiYWNrIGxpc3QKCQlsaXN0ID0gW10sCgkJLy8gU3RhY2sgb2YgZmlyZSBjYWxscyBmb3IgcmVwZWF0YWJsZSBsaXN0cwoJCXN0YWNrID0gIW9wdGlvbnMub25jZSAmJiBbXSwKCQkvLyBGaXJlIGNhbGxiYWNrcwoJCWZpcmUgPSBmdW5jdGlvbiggZGF0YSApIHsKCQkJbWVtb3J5ID0gb3B0aW9ucy5tZW1vcnkgJiYgZGF0YTsKCQkJZmlyZWQgPSB0cnVlOwoJCQlmaXJpbmdJbmRleCA9IGZpcmluZ1N0YXJ0IHx8IDA7CgkJCWZpcmluZ1N0YXJ0ID0gMDsKCQkJZmlyaW5nTGVuZ3RoID0gbGlzdC5sZW5ndGg7CgkJCWZpcmluZyA9IHRydWU7CgkJCWZvciAoIDsgbGlzdCAmJiBmaXJpbmdJbmRleCA8IGZpcmluZ0xlbmd0aDsgZmlyaW5nSW5kZXgrKyApIHsKCQkJCWlmICggbGlzdFsgZmlyaW5nSW5kZXggXS5hcHBseSggZGF0YVsgMCBdLCBkYXRhWyAxIF0gKSA9PT0gZmFsc2UgJiYgb3B0aW9ucy5zdG9wT25GYWxzZSApIHsKCQkJCQltZW1vcnkgPSBmYWxzZTsgLy8gVG8gcHJldmVudCBmdXJ0aGVyIGNhbGxzIHVzaW5nIGFkZAoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJCWZpcmluZyA9IGZhbHNlOwoJCQlpZiAoIGxpc3QgKSB7CgkJCQlpZiAoIHN0YWNrICkgewoJCQkJCWlmICggc3RhY2subGVuZ3RoICkgewoJCQkJCQlmaXJlKCBzdGFjay5zaGlmdCgpICk7CgkJCQkJfQoJCQkJfSBlbHNlIGlmICggbWVtb3J5ICkgewoJCQkJCWxpc3QgPSBbXTsKCQkJCX0gZWxzZSB7CgkJCQkJc2VsZi5kaXNhYmxlKCk7CgkJCQl9CgkJCX0KCQl9LAoJCS8vIEFjdHVhbCBDYWxsYmFja3Mgb2JqZWN0CgkJc2VsZiA9IHsKCQkJLy8gQWRkIGEgY2FsbGJhY2sgb3IgYSBjb2xsZWN0aW9uIG9mIGNhbGxiYWNrcyB0byB0aGUgbGlzdAoJCQlhZGQ6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBsaXN0ICkgewoJCQkJCS8vIEZpcnN0LCB3ZSBzYXZlIHRoZSBjdXJyZW50IGxlbmd0aAoJCQkJCXZhciBzdGFydCA9IGxpc3QubGVuZ3RoOwoJCQkJCShmdW5jdGlvbiBhZGQoIGFyZ3MgKSB7CgkJCQkJCWpRdWVyeS5lYWNoKCBhcmdzLCBmdW5jdGlvbiggXywgYXJnICkgewoJCQkJCQkJdmFyIHR5cGUgPSBqUXVlcnkudHlwZSggYXJnICk7CgkJCQkJCQlpZiAoIHR5cGUgPT09ICJmdW5jdGlvbiIgKSB7CgkJCQkJCQkJaWYgKCAhb3B0aW9ucy51bmlxdWUgfHwgIXNlbGYuaGFzKCBhcmcgKSApIHsKCQkJCQkJCQkJbGlzdC5wdXNoKCBhcmcgKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgaWYgKCBhcmcgJiYgYXJnLmxlbmd0aCAmJiB0eXBlICE9PSAic3RyaW5nIiApIHsKCQkJCQkJCQkvLyBJbnNwZWN0IHJlY3Vyc2l2ZWx5CgkJCQkJCQkJYWRkKCBhcmcgKTsKCQkJCQkJCX0KCQkJCQkJfSk7CgkJCQkJfSkoIGFyZ3VtZW50cyApOwoJCQkJCS8vIERvIHdlIG5lZWQgdG8gYWRkIHRoZSBjYWxsYmFja3MgdG8gdGhlCgkJCQkJLy8gY3VycmVudCBmaXJpbmcgYmF0Y2g/CgkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCWZpcmluZ0xlbmd0aCA9IGxpc3QubGVuZ3RoOwoJCQkJCS8vIFdpdGggbWVtb3J5LCBpZiB3ZSdyZSBub3QgZmlyaW5nIHRoZW4KCQkJCQkvLyB3ZSBzaG91bGQgY2FsbCByaWdodCBhd2F5CgkJCQkJfSBlbHNlIGlmICggbWVtb3J5ICkgewoJCQkJCQlmaXJpbmdTdGFydCA9IHN0YXJ0OwoJCQkJCQlmaXJlKCBtZW1vcnkgKTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gUmVtb3ZlIGEgY2FsbGJhY2sgZnJvbSB0aGUgbGlzdAoJCQlyZW1vdmU6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBsaXN0ICkgewoJCQkJCWpRdWVyeS5lYWNoKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBfLCBhcmcgKSB7CgkJCQkJCXZhciBpbmRleDsKCQkJCQkJd2hpbGUgKCAoIGluZGV4ID0galF1ZXJ5LmluQXJyYXkoIGFyZywgbGlzdCwgaW5kZXggKSApID4gLTEgKSB7CgkJCQkJCQlsaXN0LnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCQkJCS8vIEhhbmRsZSBmaXJpbmcgaW5kZXhlcwoJCQkJCQkJaWYgKCBmaXJpbmcgKSB7CgkJCQkJCQkJaWYgKCBpbmRleCA8PSBmaXJpbmdMZW5ndGggKSB7CgkJCQkJCQkJCWZpcmluZ0xlbmd0aC0tOwoJCQkJCQkJCX0KCQkJCQkJCQlpZiAoIGluZGV4IDw9IGZpcmluZ0luZGV4ICkgewoJCQkJCQkJCQlmaXJpbmdJbmRleC0tOwoJCQkJCQkJCX0KCQkJCQkJCX0KCQkJCQkJfQoJCQkJCX0pOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIENoZWNrIGlmIGEgZ2l2ZW4gY2FsbGJhY2sgaXMgaW4gdGhlIGxpc3QuCgkJCS8vIElmIG5vIGFyZ3VtZW50IGlzIGdpdmVuLCByZXR1cm4gd2hldGhlciBvciBub3QgbGlzdCBoYXMgY2FsbGJhY2tzIGF0dGFjaGVkLgoJCQloYXM6IGZ1bmN0aW9uKCBmbiApIHsKCQkJCXJldHVybiBmbiA/IGpRdWVyeS5pbkFycmF5KCBmbiwgbGlzdCApID4gLTEgOiAhISggbGlzdCAmJiBsaXN0Lmxlbmd0aCApOwoJCQl9LAoJCQkvLyBSZW1vdmUgYWxsIGNhbGxiYWNrcyBmcm9tIHRoZSBsaXN0CgkJCWVtcHR5OiBmdW5jdGlvbigpIHsKCQkJCWxpc3QgPSBbXTsKCQkJCWZpcmluZ0xlbmd0aCA9IDA7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSGF2ZSB0aGUgbGlzdCBkbyBub3RoaW5nIGFueW1vcmUKCQkJZGlzYWJsZTogZnVuY3Rpb24oKSB7CgkJCQlsaXN0ID0gc3RhY2sgPSBtZW1vcnkgPSB1bmRlZmluZWQ7CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gSXMgaXQgZGlzYWJsZWQ/CgkJCWRpc2FibGVkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhbGlzdDsKCQkJfSwKCQkJLy8gTG9jayB0aGUgbGlzdCBpbiBpdHMgY3VycmVudCBzdGF0ZQoJCQlsb2NrOiBmdW5jdGlvbigpIHsKCQkJCXN0YWNrID0gdW5kZWZpbmVkOwoJCQkJaWYgKCAhbWVtb3J5ICkgewoJCQkJCXNlbGYuZGlzYWJsZSgpOwoJCQkJfQoJCQkJcmV0dXJuIHRoaXM7CgkJCX0sCgkJCS8vIElzIGl0IGxvY2tlZD8KCQkJbG9ja2VkOiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAhc3RhY2s7CgkJCX0sCgkJCS8vIENhbGwgYWxsIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBjb250ZXh0IGFuZCBhcmd1bWVudHMKCQkJZmlyZVdpdGg6IGZ1bmN0aW9uKCBjb250ZXh0LCBhcmdzICkgewoJCQkJaWYgKCBsaXN0ICYmICggIWZpcmVkIHx8IHN0YWNrICkgKSB7CgkJCQkJYXJncyA9IGFyZ3MgfHwgW107CgkJCQkJYXJncyA9IFsgY29udGV4dCwgYXJncy5zbGljZSA/IGFyZ3Muc2xpY2UoKSA6IGFyZ3MgXTsKCQkJCQlpZiAoIGZpcmluZyApIHsKCQkJCQkJc3RhY2sucHVzaCggYXJncyApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCWZpcmUoIGFyZ3MgKTsKCQkJCQl9CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfSwKCQkJLy8gQ2FsbCBhbGwgdGhlIGNhbGxiYWNrcyB3aXRoIHRoZSBnaXZlbiBhcmd1bWVudHMKCQkJZmlyZTogZnVuY3Rpb24oKSB7CgkJCQlzZWxmLmZpcmVXaXRoKCB0aGlzLCBhcmd1bWVudHMgKTsKCQkJCXJldHVybiB0aGlzOwoJCQl9LAoJCQkvLyBUbyBrbm93IGlmIHRoZSBjYWxsYmFja3MgaGF2ZSBhbHJlYWR5IGJlZW4gY2FsbGVkIGF0IGxlYXN0IG9uY2UKCQkJZmlyZWQ6IGZ1bmN0aW9uKCkgewoJCQkJcmV0dXJuICEhZmlyZWQ7CgkJCX0KCQl9OwoKCXJldHVybiBzZWxmOwp9OwoKCmpRdWVyeS5leHRlbmQoewoKCURlZmVycmVkOiBmdW5jdGlvbiggZnVuYyApIHsKCQl2YXIgdHVwbGVzID0gWwoJCQkJLy8gYWN0aW9uLCBhZGQgbGlzdGVuZXIsIGxpc3RlbmVyIGxpc3QsIGZpbmFsIHN0YXRlCgkJCQlbICJyZXNvbHZlIiwgImRvbmUiLCBqUXVlcnkuQ2FsbGJhY2tzKCJvbmNlIG1lbW9yeSIpLCAicmVzb2x2ZWQiIF0sCgkJCQlbICJyZWplY3QiLCAiZmFpbCIsIGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksICJyZWplY3RlZCIgXSwKCQkJCVsgIm5vdGlmeSIsICJwcm9ncmVzcyIsIGpRdWVyeS5DYWxsYmFja3MoIm1lbW9yeSIpIF0KCQkJXSwKCQkJc3RhdGUgPSAicGVuZGluZyIsCgkJCXByb21pc2UgPSB7CgkJCQlzdGF0ZTogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlOwoJCQkJfSwKCQkJCWFsd2F5czogZnVuY3Rpb24oKSB7CgkJCQkJZGVmZXJyZWQuZG9uZSggYXJndW1lbnRzICkuZmFpbCggYXJndW1lbnRzICk7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9LAoJCQkJdGhlbjogZnVuY3Rpb24oIC8qIGZuRG9uZSwgZm5GYWlsLCBmblByb2dyZXNzICovICkgewoJCQkJCXZhciBmbnMgPSBhcmd1bWVudHM7CgkJCQkJcmV0dXJuIGpRdWVyeS5EZWZlcnJlZChmdW5jdGlvbiggbmV3RGVmZXIgKSB7CgkJCQkJCWpRdWVyeS5lYWNoKCB0dXBsZXMsIGZ1bmN0aW9uKCBpLCB0dXBsZSApIHsKCQkJCQkJCXZhciBmbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCBmbnNbIGkgXSApICYmIGZuc1sgaSBdOwoJCQkJCQkJLy8gZGVmZXJyZWRbIGRvbmUgfCBmYWlsIHwgcHJvZ3Jlc3MgXSBmb3IgZm9yd2FyZGluZyBhY3Rpb25zIHRvIG5ld0RlZmVyCgkJCQkJCQlkZWZlcnJlZFsgdHVwbGVbMV0gXShmdW5jdGlvbigpIHsKCQkJCQkJCQl2YXIgcmV0dXJuZWQgPSBmbiAmJiBmbi5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQkJCQkJaWYgKCByZXR1cm5lZCAmJiBqUXVlcnkuaXNGdW5jdGlvbiggcmV0dXJuZWQucHJvbWlzZSApICkgewoJCQkJCQkJCQlyZXR1cm5lZC5wcm9taXNlKCkKCQkJCQkJCQkJCS5kb25lKCBuZXdEZWZlci5yZXNvbHZlICkKCQkJCQkJCQkJCS5mYWlsKCBuZXdEZWZlci5yZWplY3QgKQoJCQkJCQkJCQkJLnByb2dyZXNzKCBuZXdEZWZlci5ub3RpZnkgKTsKCQkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCQluZXdEZWZlclsgdHVwbGVbIDAgXSArICJXaXRoIiBdKCB0aGlzID09PSBwcm9taXNlID8gbmV3RGVmZXIucHJvbWlzZSgpIDogdGhpcywgZm4gPyBbIHJldHVybmVkIF0gOiBhcmd1bWVudHMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9KTsKCQkJCQkJfSk7CgkJCQkJCWZucyA9IG51bGw7CgkJCQkJfSkucHJvbWlzZSgpOwoJCQkJfSwKCQkJCS8vIEdldCBhIHByb21pc2UgZm9yIHRoaXMgZGVmZXJyZWQKCQkJCS8vIElmIG9iaiBpcyBwcm92aWRlZCwgdGhlIHByb21pc2UgYXNwZWN0IGlzIGFkZGVkIHRvIHRoZSBvYmplY3QKCQkJCXByb21pc2U6IGZ1bmN0aW9uKCBvYmogKSB7CgkJCQkJcmV0dXJuIG9iaiAhPSBudWxsID8galF1ZXJ5LmV4dGVuZCggb2JqLCBwcm9taXNlICkgOiBwcm9taXNlOwoJCQkJfQoJCQl9LAoJCQlkZWZlcnJlZCA9IHt9OwoKCQkvLyBLZWVwIHBpcGUgZm9yIGJhY2stY29tcGF0CgkJcHJvbWlzZS5waXBlID0gcHJvbWlzZS50aGVuOwoKCQkvLyBBZGQgbGlzdC1zcGVjaWZpYyBtZXRob2RzCgkJalF1ZXJ5LmVhY2goIHR1cGxlcywgZnVuY3Rpb24oIGksIHR1cGxlICkgewoJCQl2YXIgbGlzdCA9IHR1cGxlWyAyIF0sCgkJCQlzdGF0ZVN0cmluZyA9IHR1cGxlWyAzIF07CgoJCQkvLyBwcm9taXNlWyBkb25lIHwgZmFpbCB8IHByb2dyZXNzIF0gPSBsaXN0LmFkZAoJCQlwcm9taXNlWyB0dXBsZVsxXSBdID0gbGlzdC5hZGQ7CgoJCQkvLyBIYW5kbGUgc3RhdGUKCQkJaWYgKCBzdGF0ZVN0cmluZyApIHsKCQkJCWxpc3QuYWRkKGZ1bmN0aW9uKCkgewoJCQkJCS8vIHN0YXRlID0gWyByZXNvbHZlZCB8IHJlamVjdGVkIF0KCQkJCQlzdGF0ZSA9IHN0YXRlU3RyaW5nOwoKCQkJCS8vIFsgcmVqZWN0X2xpc3QgfCByZXNvbHZlX2xpc3QgXS5kaXNhYmxlOyBwcm9ncmVzc19saXN0LmxvY2sKCQkJCX0sIHR1cGxlc1sgaSBeIDEgXVsgMiBdLmRpc2FibGUsIHR1cGxlc1sgMiBdWyAyIF0ubG9jayApOwoJCQl9CgoJCQkvLyBkZWZlcnJlZFsgcmVzb2x2ZSB8IHJlamVjdCB8IG5vdGlmeSBdCgkJCWRlZmVycmVkWyB0dXBsZVswXSBdID0gZnVuY3Rpb24oKSB7CgkJCQlkZWZlcnJlZFsgdHVwbGVbMF0gKyAiV2l0aCIgXSggdGhpcyA9PT0gZGVmZXJyZWQgPyBwcm9taXNlIDogdGhpcywgYXJndW1lbnRzICk7CgkJCQlyZXR1cm4gdGhpczsKCQkJfTsKCQkJZGVmZXJyZWRbIHR1cGxlWzBdICsgIldpdGgiIF0gPSBsaXN0LmZpcmVXaXRoOwoJCX0pOwoKCQkvLyBNYWtlIHRoZSBkZWZlcnJlZCBhIHByb21pc2UKCQlwcm9taXNlLnByb21pc2UoIGRlZmVycmVkICk7CgoJCS8vIENhbGwgZ2l2ZW4gZnVuYyBpZiBhbnkKCQlpZiAoIGZ1bmMgKSB7CgkJCWZ1bmMuY2FsbCggZGVmZXJyZWQsIGRlZmVycmVkICk7CgkJfQoKCQkvLyBBbGwgZG9uZSEKCQlyZXR1cm4gZGVmZXJyZWQ7Cgl9LAoKCS8vIERlZmVycmVkIGhlbHBlcgoJd2hlbjogZnVuY3Rpb24oIHN1Ym9yZGluYXRlIC8qICwgLi4uLCBzdWJvcmRpbmF0ZU4gKi8gKSB7CgkJdmFyIGkgPSAwLAoJCQlyZXNvbHZlVmFsdWVzID0gc2xpY2UuY2FsbCggYXJndW1lbnRzICksCgkJCWxlbmd0aCA9IHJlc29sdmVWYWx1ZXMubGVuZ3RoLAoKCQkJLy8gdGhlIGNvdW50IG9mIHVuY29tcGxldGVkIHN1Ym9yZGluYXRlcwoJCQlyZW1haW5pbmcgPSBsZW5ndGggIT09IDEgfHwgKCBzdWJvcmRpbmF0ZSAmJiBqUXVlcnkuaXNGdW5jdGlvbiggc3Vib3JkaW5hdGUucHJvbWlzZSApICkgPyBsZW5ndGggOiAwLAoKCQkJLy8gdGhlIG1hc3RlciBEZWZlcnJlZC4gSWYgcmVzb2x2ZVZhbHVlcyBjb25zaXN0IG9mIG9ubHkgYSBzaW5nbGUgRGVmZXJyZWQsIGp1c3QgdXNlIHRoYXQuCgkJCWRlZmVycmVkID0gcmVtYWluaW5nID09PSAxID8gc3Vib3JkaW5hdGUgOiBqUXVlcnkuRGVmZXJyZWQoKSwKCgkJCS8vIFVwZGF0ZSBmdW5jdGlvbiBmb3IgYm90aCByZXNvbHZlIGFuZCBwcm9ncmVzcyB2YWx1ZXMKCQkJdXBkYXRlRnVuYyA9IGZ1bmN0aW9uKCBpLCBjb250ZXh0cywgdmFsdWVzICkgewoJCQkJcmV0dXJuIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJCQljb250ZXh0c1sgaSBdID0gdGhpczsKCQkJCQl2YWx1ZXNbIGkgXSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxID8gc2xpY2UuY2FsbCggYXJndW1lbnRzICkgOiB2YWx1ZTsKCQkJCQlpZiAoIHZhbHVlcyA9PT0gcHJvZ3Jlc3NWYWx1ZXMgKSB7CgkJCQkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGNvbnRleHRzLCB2YWx1ZXMgKTsKCQkJCQl9IGVsc2UgaWYgKCAhKCAtLXJlbWFpbmluZyApICkgewoJCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggY29udGV4dHMsIHZhbHVlcyApOwoJCQkJCX0KCQkJCX07CgkJCX0sCgoJCQlwcm9ncmVzc1ZhbHVlcywgcHJvZ3Jlc3NDb250ZXh0cywgcmVzb2x2ZUNvbnRleHRzOwoKCQkvLyBBZGQgbGlzdGVuZXJzIHRvIERlZmVycmVkIHN1Ym9yZGluYXRlczsgdHJlYXQgb3RoZXJzIGFzIHJlc29sdmVkCgkJaWYgKCBsZW5ndGggPiAxICkgewoJCQlwcm9ncmVzc1ZhbHVlcyA9IG5ldyBBcnJheSggbGVuZ3RoICk7CgkJCXByb2dyZXNzQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlyZXNvbHZlQ29udGV4dHMgPSBuZXcgQXJyYXkoIGxlbmd0aCApOwoJCQlmb3IgKCA7IGkgPCBsZW5ndGg7IGkrKyApIHsKCQkJCWlmICggcmVzb2x2ZVZhbHVlc1sgaSBdICYmIGpRdWVyeS5pc0Z1bmN0aW9uKCByZXNvbHZlVmFsdWVzWyBpIF0ucHJvbWlzZSApICkgewoJCQkJCXJlc29sdmVWYWx1ZXNbIGkgXS5wcm9taXNlKCkKCQkJCQkJLmRvbmUoIHVwZGF0ZUZ1bmMoIGksIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApICkKCQkJCQkJLmZhaWwoIGRlZmVycmVkLnJlamVjdCApCgkJCQkJCS5wcm9ncmVzcyggdXBkYXRlRnVuYyggaSwgcHJvZ3Jlc3NDb250ZXh0cywgcHJvZ3Jlc3NWYWx1ZXMgKSApOwoJCQkJfSBlbHNlIHsKCQkJCQktLXJlbWFpbmluZzsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gSWYgd2UncmUgbm90IHdhaXRpbmcgb24gYW55dGhpbmcsIHJlc29sdmUgdGhlIG1hc3RlcgoJCWlmICggIXJlbWFpbmluZyApIHsKCQkJZGVmZXJyZWQucmVzb2x2ZVdpdGgoIHJlc29sdmVDb250ZXh0cywgcmVzb2x2ZVZhbHVlcyApOwoJCX0KCgkJcmV0dXJuIGRlZmVycmVkLnByb21pc2UoKTsKCX0KfSk7CgoKLy8gVGhlIGRlZmVycmVkIHVzZWQgb24gRE9NIHJlYWR5CnZhciByZWFkeUxpc3Q7CgpqUXVlcnkuZm4ucmVhZHkgPSBmdW5jdGlvbiggZm4gKSB7CgkvLyBBZGQgdGhlIGNhbGxiYWNrCglqUXVlcnkucmVhZHkucHJvbWlzZSgpLmRvbmUoIGZuICk7CgoJcmV0dXJuIHRoaXM7Cn07CgpqUXVlcnkuZXh0ZW5kKHsKCS8vIElzIHRoZSBET00gcmVhZHkgdG8gYmUgdXNlZD8gU2V0IHRvIHRydWUgb25jZSBpdCBvY2N1cnMuCglpc1JlYWR5OiBmYWxzZSwKCgkvLyBBIGNvdW50ZXIgdG8gdHJhY2sgaG93IG1hbnkgaXRlbXMgdG8gd2FpdCBmb3IgYmVmb3JlCgkvLyB0aGUgcmVhZHkgZXZlbnQgZmlyZXMuIFNlZSAjNjc4MQoJcmVhZHlXYWl0OiAxLAoKCS8vIEhvbGQgKG9yIHJlbGVhc2UpIHRoZSByZWFkeSBldmVudAoJaG9sZFJlYWR5OiBmdW5jdGlvbiggaG9sZCApIHsKCQlpZiAoIGhvbGQgKSB7CgkJCWpRdWVyeS5yZWFkeVdhaXQrKzsKCQl9IGVsc2UgewoJCQlqUXVlcnkucmVhZHkoIHRydWUgKTsKCQl9Cgl9LAoKCS8vIEhhbmRsZSB3aGVuIHRoZSBET00gaXMgcmVhZHkKCXJlYWR5OiBmdW5jdGlvbiggd2FpdCApIHsKCgkJLy8gQWJvcnQgaWYgdGhlcmUgYXJlIHBlbmRpbmcgaG9sZHMgb3Igd2UncmUgYWxyZWFkeSByZWFkeQoJCWlmICggd2FpdCA9PT0gdHJ1ZSA/IC0talF1ZXJ5LnJlYWR5V2FpdCA6IGpRdWVyeS5pc1JlYWR5ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBSZW1lbWJlciB0aGF0IHRoZSBET00gaXMgcmVhZHkKCQlqUXVlcnkuaXNSZWFkeSA9IHRydWU7CgoJCS8vIElmIGEgbm9ybWFsIERPTSBSZWFkeSBldmVudCBmaXJlZCwgZGVjcmVtZW50LCBhbmQgd2FpdCBpZiBuZWVkIGJlCgkJaWYgKCB3YWl0ICE9PSB0cnVlICYmIC0talF1ZXJ5LnJlYWR5V2FpdCA+IDAgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIElmIHRoZXJlIGFyZSBmdW5jdGlvbnMgYm91bmQsIHRvIGV4ZWN1dGUKCQlyZWFkeUxpc3QucmVzb2x2ZVdpdGgoIGRvY3VtZW50LCBbIGpRdWVyeSBdICk7CgoJCS8vIFRyaWdnZXIgYW55IGJvdW5kIHJlYWR5IGV2ZW50cwoJCWlmICggalF1ZXJ5LmZuLnRyaWdnZXJIYW5kbGVyICkgewoJCQlqUXVlcnkoIGRvY3VtZW50ICkudHJpZ2dlckhhbmRsZXIoICJyZWFkeSIgKTsKCQkJalF1ZXJ5KCBkb2N1bWVudCApLm9mZiggInJlYWR5IiApOwoJCX0KCX0KfSk7CgovKioKICogVGhlIHJlYWR5IGV2ZW50IGhhbmRsZXIgYW5kIHNlbGYgY2xlYW51cCBtZXRob2QKICovCmZ1bmN0aW9uIGNvbXBsZXRlZCgpIHsKCWRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJalF1ZXJ5LnJlYWR5KCk7Cn0KCmpRdWVyeS5yZWFkeS5wcm9taXNlID0gZnVuY3Rpb24oIG9iaiApIHsKCWlmICggIXJlYWR5TGlzdCApIHsKCgkJcmVhZHlMaXN0ID0galF1ZXJ5LkRlZmVycmVkKCk7CgoJCS8vIENhdGNoIGNhc2VzIHdoZXJlICQoZG9jdW1lbnQpLnJlYWR5KCkgaXMgY2FsbGVkIGFmdGVyIHRoZSBicm93c2VyIGV2ZW50IGhhcyBhbHJlYWR5IG9jY3VycmVkLgoJCS8vIFdlIG9uY2UgdHJpZWQgdG8gdXNlIHJlYWR5U3RhdGUgImludGVyYWN0aXZlIiBoZXJlLCBidXQgaXQgY2F1c2VkIGlzc3VlcyBsaWtlIHRoZSBvbmUKCQkvLyBkaXNjb3ZlcmVkIGJ5IENocmlzUyBoZXJlOiBodHRwOi8vYnVncy5qcXVlcnkuY29tL3RpY2tldC8xMjI4MiNjb21tZW50OjE1CgkJaWYgKCBkb2N1bWVudC5yZWFkeVN0YXRlID09PSAiY29tcGxldGUiICkgewoJCQkvLyBIYW5kbGUgaXQgYXN5bmNocm9ub3VzbHkgdG8gYWxsb3cgc2NyaXB0cyB0aGUgb3Bwb3J0dW5pdHkgdG8gZGVsYXkgcmVhZHkKCQkJc2V0VGltZW91dCggalF1ZXJ5LnJlYWR5ICk7CgoJCX0gZWxzZSB7CgoJCQkvLyBVc2UgdGhlIGhhbmR5IGV2ZW50IGNhbGxiYWNrCgkJCWRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoICJET01Db250ZW50TG9hZGVkIiwgY29tcGxldGVkLCBmYWxzZSApOwoKCQkJLy8gQSBmYWxsYmFjayB0byB3aW5kb3cub25sb2FkLCB0aGF0IHdpbGwgYWx3YXlzIHdvcmsKCQkJd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICJsb2FkIiwgY29tcGxldGVkLCBmYWxzZSApOwoJCX0KCX0KCXJldHVybiByZWFkeUxpc3QucHJvbWlzZSggb2JqICk7Cn07CgovLyBLaWNrIG9mZiB0aGUgRE9NIHJlYWR5IGNoZWNrIGV2ZW4gaWYgdGhlIHVzZXIgZG9lcyBub3QKalF1ZXJ5LnJlYWR5LnByb21pc2UoKTsKCgoKCi8vIE11bHRpZnVuY3Rpb25hbCBtZXRob2QgdG8gZ2V0IGFuZCBzZXQgdmFsdWVzIG9mIGEgY29sbGVjdGlvbgovLyBUaGUgdmFsdWUvcyBjYW4gb3B0aW9uYWxseSBiZSBleGVjdXRlZCBpZiBpdCdzIGEgZnVuY3Rpb24KdmFyIGFjY2VzcyA9IGpRdWVyeS5hY2Nlc3MgPSBmdW5jdGlvbiggZWxlbXMsIGZuLCBrZXksIHZhbHVlLCBjaGFpbmFibGUsIGVtcHR5R2V0LCByYXcgKSB7Cgl2YXIgaSA9IDAsCgkJbGVuID0gZWxlbXMubGVuZ3RoLAoJCWJ1bGsgPSBrZXkgPT0gbnVsbDsKCgkvLyBTZXRzIG1hbnkgdmFsdWVzCglpZiAoIGpRdWVyeS50eXBlKCBrZXkgKSA9PT0gIm9iamVjdCIgKSB7CgkJY2hhaW5hYmxlID0gdHJ1ZTsKCQlmb3IgKCBpIGluIGtleSApIHsKCQkJalF1ZXJ5LmFjY2VzcyggZWxlbXMsIGZuLCBpLCBrZXlbaV0sIHRydWUsIGVtcHR5R2V0LCByYXcgKTsKCQl9CgoJLy8gU2V0cyBvbmUgdmFsdWUKCX0gZWxzZSBpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJY2hhaW5hYmxlID0gdHJ1ZTsKCgkJaWYgKCAhalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJhdyA9IHRydWU7CgkJfQoKCQlpZiAoIGJ1bGsgKSB7CgkJCS8vIEJ1bGsgb3BlcmF0aW9ucyBydW4gYWdhaW5zdCB0aGUgZW50aXJlIHNldAoJCQlpZiAoIHJhdyApIHsKCQkJCWZuLmNhbGwoIGVsZW1zLCB2YWx1ZSApOwoJCQkJZm4gPSBudWxsOwoKCQkJLy8gLi4uZXhjZXB0IHdoZW4gZXhlY3V0aW5nIGZ1bmN0aW9uIHZhbHVlcwoJCQl9IGVsc2UgewoJCQkJYnVsayA9IGZuOwoJCQkJZm4gPSBmdW5jdGlvbiggZWxlbSwga2V5LCB2YWx1ZSApIHsKCQkJCQlyZXR1cm4gYnVsay5jYWxsKCBqUXVlcnkoIGVsZW0gKSwgdmFsdWUgKTsKCQkJCX07CgkJCX0KCQl9CgoJCWlmICggZm4gKSB7CgkJCWZvciAoIDsgaSA8IGxlbjsgaSsrICkgewoJCQkJZm4oIGVsZW1zW2ldLCBrZXksIHJhdyA/IHZhbHVlIDogdmFsdWUuY2FsbCggZWxlbXNbaV0sIGksIGZuKCBlbGVtc1tpXSwga2V5ICkgKSApOwoJCQl9CgkJfQoJfQoKCXJldHVybiBjaGFpbmFibGUgPwoJCWVsZW1zIDoKCgkJLy8gR2V0cwoJCWJ1bGsgPwoJCQlmbi5jYWxsKCBlbGVtcyApIDoKCQkJbGVuID8gZm4oIGVsZW1zWzBdLCBrZXkgKSA6IGVtcHR5R2V0Owp9OwoKCi8qKgogKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gb2JqZWN0IGNhbiBoYXZlIGRhdGEKICovCmpRdWVyeS5hY2NlcHREYXRhID0gZnVuY3Rpb24oIG93bmVyICkgewoJLy8gQWNjZXB0cyBvbmx5OgoJLy8gIC0gTm9kZQoJLy8gICAgLSBOb2RlLkVMRU1FTlRfTk9ERQoJLy8gICAgLSBOb2RlLkRPQ1VNRU5UX05PREUKCS8vICAtIE9iamVjdAoJLy8gICAgLSBBbnkKCS8qIGpzaGludCAtVzAxOCAqLwoJcmV0dXJuIG93bmVyLm5vZGVUeXBlID09PSAxIHx8IG93bmVyLm5vZGVUeXBlID09PSA5IHx8ICEoICtvd25lci5ub2RlVHlwZSApOwp9OwoKCmZ1bmN0aW9uIERhdGEoKSB7CgkvLyBTdXBwb3J0OiBBbmRyb2lkPDQsCgkvLyBPbGQgV2ViS2l0IGRvZXMgbm90IGhhdmUgT2JqZWN0LnByZXZlbnRFeHRlbnNpb25zL2ZyZWV6ZSBtZXRob2QsCgkvLyByZXR1cm4gbmV3IGVtcHR5IG9iamVjdCBpbnN0ZWFkIHdpdGggbm8gW1tzZXRdXSBhY2Nlc3NvcgoJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLmNhY2hlID0ge30sIDAsIHsKCQlnZXQ6IGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4ge307CgkJfQoJfSk7CgoJdGhpcy5leHBhbmRvID0galF1ZXJ5LmV4cGFuZG8gKyBEYXRhLnVpZCsrOwp9CgpEYXRhLnVpZCA9IDE7CkRhdGEuYWNjZXB0cyA9IGpRdWVyeS5hY2NlcHREYXRhOwoKRGF0YS5wcm90b3R5cGUgPSB7CglrZXk6IGZ1bmN0aW9uKCBvd25lciApIHsKCQkvLyBXZSBjYW4gYWNjZXB0IGRhdGEgZm9yIG5vbi1lbGVtZW50IG5vZGVzIGluIG1vZGVybiBicm93c2VycywKCQkvLyBidXQgd2Ugc2hvdWxkIG5vdCwgc2VlICM4MzM1LgoJCS8vIEFsd2F5cyByZXR1cm4gdGhlIGtleSBmb3IgYSBmcm96ZW4gb2JqZWN0LgoJCWlmICggIURhdGEuYWNjZXB0cyggb3duZXIgKSApIHsKCQkJcmV0dXJuIDA7CgkJfQoKCQl2YXIgZGVzY3JpcHRvciA9IHt9LAoJCQkvLyBDaGVjayBpZiB0aGUgb3duZXIgb2JqZWN0IGFscmVhZHkgaGFzIGEgY2FjaGUga2V5CgkJCXVubG9jayA9IG93bmVyWyB0aGlzLmV4cGFuZG8gXTsKCgkJLy8gSWYgbm90LCBjcmVhdGUgb25lCgkJaWYgKCAhdW5sb2NrICkgewoJCQl1bmxvY2sgPSBEYXRhLnVpZCsrOwoKCQkJLy8gU2VjdXJlIGl0IGluIGEgbm9uLWVudW1lcmFibGUsIG5vbi13cml0YWJsZSBwcm9wZXJ0eQoJCQl0cnkgewoJCQkJZGVzY3JpcHRvclsgdGhpcy5leHBhbmRvIF0gPSB7IHZhbHVlOiB1bmxvY2sgfTsKCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCBvd25lciwgZGVzY3JpcHRvciApOwoKCQkJLy8gU3VwcG9ydDogQW5kcm9pZDw0CgkJCS8vIEZhbGxiYWNrIHRvIGEgbGVzcyBzZWN1cmUgZGVmaW5pdGlvbgoJCQl9IGNhdGNoICggZSApIHsKCQkJCWRlc2NyaXB0b3JbIHRoaXMuZXhwYW5kbyBdID0gdW5sb2NrOwoJCQkJalF1ZXJ5LmV4dGVuZCggb3duZXIsIGRlc2NyaXB0b3IgKTsKCQkJfQoJCX0KCgkJLy8gRW5zdXJlIHRoZSBjYWNoZSBvYmplY3QKCQlpZiAoICF0aGlzLmNhY2hlWyB1bmxvY2sgXSApIHsKCQkJdGhpcy5jYWNoZVsgdW5sb2NrIF0gPSB7fTsKCQl9CgoJCXJldHVybiB1bmxvY2s7Cgl9LAoJc2V0OiBmdW5jdGlvbiggb3duZXIsIGRhdGEsIHZhbHVlICkgewoJCXZhciBwcm9wLAoJCQkvLyBUaGVyZSBtYXkgYmUgYW4gdW5sb2NrIGFzc2lnbmVkIHRvIHRoaXMgbm9kZSwKCQkJLy8gaWYgdGhlcmUgaXMgbm8gZW50cnkgZm9yIHRoaXMgIm93bmVyIiwgY3JlYXRlIG9uZSBpbmxpbmUKCQkJLy8gYW5kIHNldCB0aGUgdW5sb2NrIGFzIHRob3VnaCBhbiBvd25lciBlbnRyeSBoYWQgYWx3YXlzIGV4aXN0ZWQKCQkJdW5sb2NrID0gdGhpcy5rZXkoIG93bmVyICksCgkJCWNhY2hlID0gdGhpcy5jYWNoZVsgdW5sb2NrIF07CgoJCS8vIEhhbmRsZTogWyBvd25lciwga2V5LCB2YWx1ZSBdIGFyZ3MKCQlpZiAoIHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiApIHsKCQkJY2FjaGVbIGRhdGEgXSA9IHZhbHVlOwoKCQkvLyBIYW5kbGU6IFsgb3duZXIsIHsgcHJvcGVydGllcyB9IF0gYXJncwoJCX0gZWxzZSB7CgkJCS8vIEZyZXNoIGFzc2lnbm1lbnRzIGJ5IG9iamVjdCBhcmUgc2hhbGxvdyBjb3BpZWQKCQkJaWYgKCBqUXVlcnkuaXNFbXB0eU9iamVjdCggY2FjaGUgKSApIHsKCQkJCWpRdWVyeS5leHRlbmQoIHRoaXMuY2FjaGVbIHVubG9jayBdLCBkYXRhICk7CgkJCS8vIE90aGVyd2lzZSwgY29weSB0aGUgcHJvcGVydGllcyBvbmUtYnktb25lIHRvIHRoZSBjYWNoZSBvYmplY3QKCQkJfSBlbHNlIHsKCQkJCWZvciAoIHByb3AgaW4gZGF0YSApIHsKCQkJCQljYWNoZVsgcHJvcCBdID0gZGF0YVsgcHJvcCBdOwoJCQkJfQoJCQl9CgkJfQoJCXJldHVybiBjYWNoZTsKCX0sCglnZXQ6IGZ1bmN0aW9uKCBvd25lciwga2V5ICkgewoJCS8vIEVpdGhlciBhIHZhbGlkIGNhY2hlIGlzIGZvdW5kLCBvciB3aWxsIGJlIGNyZWF0ZWQuCgkJLy8gTmV3IGNhY2hlcyB3aWxsIGJlIGNyZWF0ZWQgYW5kIHRoZSB1bmxvY2sgcmV0dXJuZWQsCgkJLy8gYWxsb3dpbmcgZGlyZWN0IGFjY2VzcyB0byB0aGUgbmV3bHkgY3JlYXRlZAoJCS8vIGVtcHR5IGRhdGEgb2JqZWN0LiBBIHZhbGlkIG93bmVyIG9iamVjdCBtdXN0IGJlIHByb3ZpZGVkLgoJCXZhciBjYWNoZSA9IHRoaXMuY2FjaGVbIHRoaXMua2V5KCBvd25lciApIF07CgoJCXJldHVybiBrZXkgPT09IHVuZGVmaW5lZCA/CgkJCWNhY2hlIDogY2FjaGVbIGtleSBdOwoJfSwKCWFjY2VzczogZnVuY3Rpb24oIG93bmVyLCBrZXksIHZhbHVlICkgewoJCXZhciBzdG9yZWQ7CgkJLy8gSW4gY2FzZXMgd2hlcmUgZWl0aGVyOgoJCS8vCgkJLy8gICAxLiBObyBrZXkgd2FzIHNwZWNpZmllZAoJCS8vICAgMi4gQSBzdHJpbmcga2V5IHdhcyBzcGVjaWZpZWQsIGJ1dCBubyB2YWx1ZSBwcm92aWRlZAoJCS8vCgkJLy8gVGFrZSB0aGUgInJlYWQiIHBhdGggYW5kIGFsbG93IHRoZSBnZXQgbWV0aG9kIHRvIGRldGVybWluZQoJCS8vIHdoaWNoIHZhbHVlIHRvIHJldHVybiwgcmVzcGVjdGl2ZWx5IGVpdGhlcjoKCQkvLwoJCS8vICAgMS4gVGhlIGVudGlyZSBjYWNoZSBvYmplY3QKCQkvLyAgIDIuIFRoZSBkYXRhIHN0b3JlZCBhdCB0aGUga2V5CgkJLy8KCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkIHx8CgkJCQkoKGtleSAmJiB0eXBlb2Yga2V5ID09PSAic3RyaW5nIikgJiYgdmFsdWUgPT09IHVuZGVmaW5lZCkgKSB7CgoJCQlzdG9yZWQgPSB0aGlzLmdldCggb3duZXIsIGtleSApOwoKCQkJcmV0dXJuIHN0b3JlZCAhPT0gdW5kZWZpbmVkID8KCQkJCXN0b3JlZCA6IHRoaXMuZ2V0KCBvd25lciwgalF1ZXJ5LmNhbWVsQ2FzZShrZXkpICk7CgkJfQoKCQkvLyBbKl1XaGVuIHRoZSBrZXkgaXMgbm90IGEgc3RyaW5nLCBvciBib3RoIGEga2V5IGFuZCB2YWx1ZQoJCS8vIGFyZSBzcGVjaWZpZWQsIHNldCBvciBleHRlbmQgKGV4aXN0aW5nIG9iamVjdHMpIHdpdGggZWl0aGVyOgoJCS8vCgkJLy8gICAxLiBBbiBvYmplY3Qgb2YgcHJvcGVydGllcwoJCS8vICAgMi4gQSBrZXkgYW5kIHZhbHVlCgkJLy8KCQl0aGlzLnNldCggb3duZXIsIGtleSwgdmFsdWUgKTsKCgkJLy8gU2luY2UgdGhlICJzZXQiIHBhdGggY2FuIGhhdmUgdHdvIHBvc3NpYmxlIGVudHJ5IHBvaW50cwoJCS8vIHJldHVybiB0aGUgZXhwZWN0ZWQgZGF0YSBiYXNlZCBvbiB3aGljaCBwYXRoIHdhcyB0YWtlblsqXQoJCXJldHVybiB2YWx1ZSAhPT0gdW5kZWZpbmVkID8gdmFsdWUgOiBrZXk7Cgl9LAoJcmVtb3ZlOiBmdW5jdGlvbiggb3duZXIsIGtleSApIHsKCQl2YXIgaSwgbmFtZSwgY2FtZWwsCgkJCXVubG9jayA9IHRoaXMua2V5KCBvd25lciApLAoJCQljYWNoZSA9IHRoaXMuY2FjaGVbIHVubG9jayBdOwoKCQlpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgewoJCQl0aGlzLmNhY2hlWyB1bmxvY2sgXSA9IHt9OwoKCQl9IGVsc2UgewoJCQkvLyBTdXBwb3J0IGFycmF5IG9yIHNwYWNlIHNlcGFyYXRlZCBzdHJpbmcgb2Yga2V5cwoJCQlpZiAoIGpRdWVyeS5pc0FycmF5KCBrZXkgKSApIHsKCQkJCS8vIElmICJuYW1lIiBpcyBhbiBhcnJheSBvZiBrZXlzLi4uCgkJCQkvLyBXaGVuIGRhdGEgaXMgaW5pdGlhbGx5IGNyZWF0ZWQsIHZpYSAoImtleSIsICJ2YWwiKSBzaWduYXR1cmUsCgkJCQkvLyBrZXlzIHdpbGwgYmUgY29udmVydGVkIHRvIGNhbWVsQ2FzZS4KCQkJCS8vIFNpbmNlIHRoZXJlIGlzIG5vIHdheSB0byB0ZWxsIF9ob3dfIGEga2V5IHdhcyBhZGRlZCwgcmVtb3ZlCgkJCQkvLyBib3RoIHBsYWluIGtleSBhbmQgY2FtZWxDYXNlIGtleS4gIzEyNzg2CgkJCQkvLyBUaGlzIHdpbGwgb25seSBwZW5hbGl6ZSB0aGUgYXJyYXkgYXJndW1lbnQgcGF0aC4KCQkJCW5hbWUgPSBrZXkuY29uY2F0KCBrZXkubWFwKCBqUXVlcnkuY2FtZWxDYXNlICkgKTsKCQkJfSBlbHNlIHsKCQkJCWNhbWVsID0galF1ZXJ5LmNhbWVsQ2FzZSgga2V5ICk7CgkJCQkvLyBUcnkgdGhlIHN0cmluZyBhcyBhIGtleSBiZWZvcmUgYW55IG1hbmlwdWxhdGlvbgoJCQkJaWYgKCBrZXkgaW4gY2FjaGUgKSB7CgkJCQkJbmFtZSA9IFsga2V5LCBjYW1lbCBdOwoJCQkJfSBlbHNlIHsKCQkJCQkvLyBJZiBhIGtleSB3aXRoIHRoZSBzcGFjZXMgZXhpc3RzLCB1c2UgaXQuCgkJCQkJLy8gT3RoZXJ3aXNlLCBjcmVhdGUgYW4gYXJyYXkgYnkgbWF0Y2hpbmcgbm9uLXdoaXRlc3BhY2UKCQkJCQluYW1lID0gY2FtZWw7CgkJCQkJbmFtZSA9IG5hbWUgaW4gY2FjaGUgPwoJCQkJCQlbIG5hbWUgXSA6ICggbmFtZS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW10gKTsKCQkJCX0KCQkJfQoKCQkJaSA9IG5hbWUubGVuZ3RoOwoJCQl3aGlsZSAoIGktLSApIHsKCQkJCWRlbGV0ZSBjYWNoZVsgbmFtZVsgaSBdIF07CgkJCX0KCQl9Cgl9LAoJaGFzRGF0YTogZnVuY3Rpb24oIG93bmVyICkgewoJCXJldHVybiAhalF1ZXJ5LmlzRW1wdHlPYmplY3QoCgkJCXRoaXMuY2FjaGVbIG93bmVyWyB0aGlzLmV4cGFuZG8gXSBdIHx8IHt9CgkJKTsKCX0sCglkaXNjYXJkOiBmdW5jdGlvbiggb3duZXIgKSB7CgkJaWYgKCBvd25lclsgdGhpcy5leHBhbmRvIF0gKSB7CgkJCWRlbGV0ZSB0aGlzLmNhY2hlWyBvd25lclsgdGhpcy5leHBhbmRvIF0gXTsKCQl9Cgl9Cn07CnZhciBkYXRhX3ByaXYgPSBuZXcgRGF0YSgpOwoKdmFyIGRhdGFfdXNlciA9IG5ldyBEYXRhKCk7CgoKCi8vCUltcGxlbWVudGF0aW9uIFN1bW1hcnkKLy8KLy8JMS4gRW5mb3JjZSBBUEkgc3VyZmFjZSBhbmQgc2VtYW50aWMgY29tcGF0aWJpbGl0eSB3aXRoIDEuOS54IGJyYW5jaAovLwkyLiBJbXByb3ZlIHRoZSBtb2R1bGUncyBtYWludGFpbmFiaWxpdHkgYnkgcmVkdWNpbmcgdGhlIHN0b3JhZ2UKLy8JCXBhdGhzIHRvIGEgc2luZ2xlIG1lY2hhbmlzbS4KLy8JMy4gVXNlIHRoZSBzYW1lIHNpbmdsZSBtZWNoYW5pc20gdG8gc3VwcG9ydCAicHJpdmF0ZSIgYW5kICJ1c2VyIiBkYXRhLgovLwk0LiBfTmV2ZXJfIGV4cG9zZSAicHJpdmF0ZSIgZGF0YSB0byB1c2VyIGNvZGUgKFRPRE86IERyb3AgX2RhdGEsIF9yZW1vdmVEYXRhKQovLwk1LiBBdm9pZCBleHBvc2luZyBpbXBsZW1lbnRhdGlvbiBkZXRhaWxzIG9uIHVzZXIgb2JqZWN0cyAoZWcuIGV4cGFuZG8gcHJvcGVydGllcykKLy8JNi4gUHJvdmlkZSBhIGNsZWFyIHBhdGggZm9yIGltcGxlbWVudGF0aW9uIHVwZ3JhZGUgdG8gV2Vha01hcCBpbiAyMDE0Cgp2YXIgcmJyYWNlID0gL14oPzpce1tcd1xXXSpcfXxcW1tcd1xXXSpcXSkkLywKCXJtdWx0aURhc2ggPSAvKFtBLVpdKS9nOwoKZnVuY3Rpb24gZGF0YUF0dHIoIGVsZW0sIGtleSwgZGF0YSApIHsKCXZhciBuYW1lOwoKCS8vIElmIG5vdGhpbmcgd2FzIGZvdW5kIGludGVybmFsbHksIHRyeSB0byBmZXRjaCBhbnkKCS8vIGRhdGEgZnJvbSB0aGUgSFRNTDUgZGF0YS0qIGF0dHJpYnV0ZQoJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgJiYgZWxlbS5ub2RlVHlwZSA9PT0gMSApIHsKCQluYW1lID0gImRhdGEtIiArIGtleS5yZXBsYWNlKCBybXVsdGlEYXNoLCAiLSQxIiApLnRvTG93ZXJDYXNlKCk7CgkJZGF0YSA9IGVsZW0uZ2V0QXR0cmlidXRlKCBuYW1lICk7CgoJCWlmICggdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICkgewoJCQl0cnkgewoJCQkJZGF0YSA9IGRhdGEgPT09ICJ0cnVlIiA/IHRydWUgOgoJCQkJCWRhdGEgPT09ICJmYWxzZSIgPyBmYWxzZSA6CgkJCQkJZGF0YSA9PT0gIm51bGwiID8gbnVsbCA6CgkJCQkJLy8gT25seSBjb252ZXJ0IHRvIGEgbnVtYmVyIGlmIGl0IGRvZXNuJ3QgY2hhbmdlIHRoZSBzdHJpbmcKCQkJCQkrZGF0YSArICIiID09PSBkYXRhID8gK2RhdGEgOgoJCQkJCXJicmFjZS50ZXN0KCBkYXRhICkgPyBqUXVlcnkucGFyc2VKU09OKCBkYXRhICkgOgoJCQkJCWRhdGE7CgkJCX0gY2F0Y2goIGUgKSB7fQoKCQkJLy8gTWFrZSBzdXJlIHdlIHNldCB0aGUgZGF0YSBzbyBpdCBpc24ndCBjaGFuZ2VkIGxhdGVyCgkJCWRhdGFfdXNlci5zZXQoIGVsZW0sIGtleSwgZGF0YSApOwoJCX0gZWxzZSB7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoJfQoJcmV0dXJuIGRhdGE7Cn0KCmpRdWVyeS5leHRlbmQoewoJaGFzRGF0YTogZnVuY3Rpb24oIGVsZW0gKSB7CgkJcmV0dXJuIGRhdGFfdXNlci5oYXNEYXRhKCBlbGVtICkgfHwgZGF0YV9wcml2Lmhhc0RhdGEoIGVsZW0gKTsKCX0sCgoJZGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGRhdGEgKSB7CgkJcmV0dXJuIGRhdGFfdXNlci5hY2Nlc3MoIGVsZW0sIG5hbWUsIGRhdGEgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGVsZW0sIG5hbWUgKSB7CgkJZGF0YV91c2VyLnJlbW92ZSggZWxlbSwgbmFtZSApOwoJfSwKCgkvLyBUT0RPOiBOb3cgdGhhdCBhbGwgY2FsbHMgdG8gX2RhdGEgYW5kIF9yZW1vdmVEYXRhIGhhdmUgYmVlbiByZXBsYWNlZAoJLy8gd2l0aCBkaXJlY3QgY2FsbHMgdG8gZGF0YV9wcml2IG1ldGhvZHMsIHRoZXNlIGNhbiBiZSBkZXByZWNhdGVkLgoJX2RhdGE6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBkYXRhICkgewoJCXJldHVybiBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCBuYW1lLCBkYXRhICk7Cgl9LAoKCV9yZW1vdmVEYXRhOiBmdW5jdGlvbiggZWxlbSwgbmFtZSApIHsKCQlkYXRhX3ByaXYucmVtb3ZlKCBlbGVtLCBuYW1lICk7Cgl9Cn0pOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglkYXRhOiBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHsKCQl2YXIgaSwgbmFtZSwgZGF0YSwKCQkJZWxlbSA9IHRoaXNbIDAgXSwKCQkJYXR0cnMgPSBlbGVtICYmIGVsZW0uYXR0cmlidXRlczsKCgkJLy8gR2V0cyBhbGwgdmFsdWVzCgkJaWYgKCBrZXkgPT09IHVuZGVmaW5lZCApIHsKCQkJaWYgKCB0aGlzLmxlbmd0aCApIHsKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtICk7CgoJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICYmICFkYXRhX3ByaXYuZ2V0KCBlbGVtLCAiaGFzRGF0YUF0dHJzIiApICkgewoJCQkJCWkgPSBhdHRycy5sZW5ndGg7CgkJCQkJd2hpbGUgKCBpLS0gKSB7CgoJCQkJCQkvLyBTdXBwb3J0OiBJRTExKwoJCQkJCQkvLyBUaGUgYXR0cnMgZWxlbWVudHMgY2FuIGJlIG51bGwgKCMxNDg5NCkKCQkJCQkJaWYgKCBhdHRyc1sgaSBdICkgewoJCQkJCQkJbmFtZSA9IGF0dHJzWyBpIF0ubmFtZTsKCQkJCQkJCWlmICggbmFtZS5pbmRleE9mKCAiZGF0YS0iICkgPT09IDAgKSB7CgkJCQkJCQkJbmFtZSA9IGpRdWVyeS5jYW1lbENhc2UoIG5hbWUuc2xpY2UoNSkgKTsKCQkJCQkJCQlkYXRhQXR0ciggZWxlbSwgbmFtZSwgZGF0YVsgbmFtZSBdICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJZGF0YV9wcml2LnNldCggZWxlbSwgImhhc0RhdGFBdHRycyIsIHRydWUgKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIGRhdGE7CgkJfQoKCQkvLyBTZXRzIG11bHRpcGxlIHZhbHVlcwoJCWlmICggdHlwZW9mIGtleSA9PT0gIm9iamVjdCIgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCQlkYXRhX3VzZXIuc2V0KCB0aGlzLCBrZXkgKTsKCQkJfSk7CgkJfQoKCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBkYXRhLAoJCQkJY2FtZWxLZXkgPSBqUXVlcnkuY2FtZWxDYXNlKCBrZXkgKTsKCgkJCS8vIFRoZSBjYWxsaW5nIGpRdWVyeSBvYmplY3QgKGVsZW1lbnQgbWF0Y2hlcykgaXMgbm90IGVtcHR5CgkJCS8vIChhbmQgdGhlcmVmb3JlIGhhcyBhbiBlbGVtZW50IGFwcGVhcnMgYXQgdGhpc1sgMCBdKSBhbmQgdGhlCgkJCS8vIGB2YWx1ZWAgcGFyYW1ldGVyIHdhcyBub3QgdW5kZWZpbmVkLiBBbiBlbXB0eSBqUXVlcnkgb2JqZWN0CgkJCS8vIHdpbGwgcmVzdWx0IGluIGB1bmRlZmluZWRgIGZvciBlbGVtID0gdGhpc1sgMCBdIHdoaWNoIHdpbGwKCQkJLy8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIGFuIGF0dGVtcHQgdG8gcmVhZCBhIGRhdGEgY2FjaGUgaXMgbWFkZS4KCQkJaWYgKCBlbGVtICYmIHZhbHVlID09PSB1bmRlZmluZWQgKSB7CgkJCQkvLyBBdHRlbXB0IHRvIGdldCBkYXRhIGZyb20gdGhlIGNhY2hlCgkJCQkvLyB3aXRoIHRoZSBrZXkgYXMtaXMKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtLCBrZXkgKTsKCQkJCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiBkYXRhOwoJCQkJfQoKCQkJCS8vIEF0dGVtcHQgdG8gZ2V0IGRhdGEgZnJvbSB0aGUgY2FjaGUKCQkJCS8vIHdpdGggdGhlIGtleSBjYW1lbGl6ZWQKCQkJCWRhdGEgPSBkYXRhX3VzZXIuZ2V0KCBlbGVtLCBjYW1lbEtleSApOwoJCQkJaWYgKCBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJcmV0dXJuIGRhdGE7CgkJCQl9CgoJCQkJLy8gQXR0ZW1wdCB0byAiZGlzY292ZXIiIHRoZSBkYXRhIGluCgkJCQkvLyBIVE1MNSBjdXN0b20gZGF0YS0qIGF0dHJzCgkJCQlkYXRhID0gZGF0YUF0dHIoIGVsZW0sIGNhbWVsS2V5LCB1bmRlZmluZWQgKTsKCQkJCWlmICggZGF0YSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiBkYXRhOwoJCQkJfQoKCQkJCS8vIFdlIHRyaWVkIHJlYWxseSBoYXJkLCBidXQgdGhlIGRhdGEgZG9lc24ndCBleGlzdC4KCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU2V0IHRoZSBkYXRhLi4uCgkJCXRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJCS8vIEZpcnN0LCBhdHRlbXB0IHRvIHN0b3JlIGEgY29weSBvciByZWZlcmVuY2Ugb2YgYW55CgkJCQkvLyBkYXRhIHRoYXQgbWlnaHQndmUgYmVlbiBzdG9yZSB3aXRoIGEgY2FtZWxDYXNlZCBrZXkuCgkJCQl2YXIgZGF0YSA9IGRhdGFfdXNlci5nZXQoIHRoaXMsIGNhbWVsS2V5ICk7CgoJCQkJLy8gRm9yIEhUTUw1IGRhdGEtKiBhdHRyaWJ1dGUgaW50ZXJvcCwgd2UgaGF2ZSB0bwoJCQkJLy8gc3RvcmUgcHJvcGVydHkgbmFtZXMgd2l0aCBkYXNoZXMgaW4gYSBjYW1lbENhc2UgZm9ybS4KCQkJCS8vIFRoaXMgbWlnaHQgbm90IGFwcGx5IHRvIGFsbCBwcm9wZXJ0aWVzLi4uKgoJCQkJZGF0YV91c2VyLnNldCggdGhpcywgY2FtZWxLZXksIHZhbHVlICk7CgoJCQkJLy8gKi4uLiBJbiB0aGUgY2FzZSBvZiBwcm9wZXJ0aWVzIHRoYXQgbWlnaHQgX2FjdHVhbGx5XwoJCQkJLy8gaGF2ZSBkYXNoZXMsIHdlIG5lZWQgdG8gYWxzbyBzdG9yZSBhIGNvcHkgb2YgdGhhdAoJCQkJLy8gdW5jaGFuZ2VkIHByb3BlcnR5LgoJCQkJaWYgKCBrZXkuaW5kZXhPZigiLSIpICE9PSAtMSAmJiBkYXRhICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJZGF0YV91c2VyLnNldCggdGhpcywga2V5LCB2YWx1ZSApOwoJCQkJfQoJCQl9KTsKCQl9LCBudWxsLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEsIG51bGwsIHRydWUgKTsKCX0sCgoJcmVtb3ZlRGF0YTogZnVuY3Rpb24oIGtleSApIHsKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlkYXRhX3VzZXIucmVtb3ZlKCB0aGlzLCBrZXkgKTsKCQl9KTsKCX0KfSk7CgoKalF1ZXJ5LmV4dGVuZCh7CglxdWV1ZTogZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGRhdGEgKSB7CgkJdmFyIHF1ZXVlOwoKCQlpZiAoIGVsZW0gKSB7CgkJCXR5cGUgPSAoIHR5cGUgfHwgImZ4IiApICsgInF1ZXVlIjsKCQkJcXVldWUgPSBkYXRhX3ByaXYuZ2V0KCBlbGVtLCB0eXBlICk7CgoJCQkvLyBTcGVlZCB1cCBkZXF1ZXVlIGJ5IGdldHRpbmcgb3V0IHF1aWNrbHkgaWYgdGhpcyBpcyBqdXN0IGEgbG9va3VwCgkJCWlmICggZGF0YSApIHsKCQkJCWlmICggIXF1ZXVlIHx8IGpRdWVyeS5pc0FycmF5KCBkYXRhICkgKSB7CgkJCQkJcXVldWUgPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCB0eXBlLCBqUXVlcnkubWFrZUFycmF5KGRhdGEpICk7CgkJCQl9IGVsc2UgewoJCQkJCXF1ZXVlLnB1c2goIGRhdGEgKTsKCQkJCX0KCQkJfQoJCQlyZXR1cm4gcXVldWUgfHwgW107CgkJfQoJfSwKCglkZXF1ZXVlOiBmdW5jdGlvbiggZWxlbSwgdHlwZSApIHsKCQl0eXBlID0gdHlwZSB8fCAiZngiOwoKCQl2YXIgcXVldWUgPSBqUXVlcnkucXVldWUoIGVsZW0sIHR5cGUgKSwKCQkJc3RhcnRMZW5ndGggPSBxdWV1ZS5sZW5ndGgsCgkJCWZuID0gcXVldWUuc2hpZnQoKSwKCQkJaG9va3MgPSBqUXVlcnkuX3F1ZXVlSG9va3MoIGVsZW0sIHR5cGUgKSwKCQkJbmV4dCA9IGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5LmRlcXVldWUoIGVsZW0sIHR5cGUgKTsKCQkJfTsKCgkJLy8gSWYgdGhlIGZ4IHF1ZXVlIGlzIGRlcXVldWVkLCBhbHdheXMgcmVtb3ZlIHRoZSBwcm9ncmVzcyBzZW50aW5lbAoJCWlmICggZm4gPT09ICJpbnByb2dyZXNzIiApIHsKCQkJZm4gPSBxdWV1ZS5zaGlmdCgpOwoJCQlzdGFydExlbmd0aC0tOwoJCX0KCgkJaWYgKCBmbiApIHsKCgkJCS8vIEFkZCBhIHByb2dyZXNzIHNlbnRpbmVsIHRvIHByZXZlbnQgdGhlIGZ4IHF1ZXVlIGZyb20gYmVpbmcKCQkJLy8gYXV0b21hdGljYWxseSBkZXF1ZXVlZAoJCQlpZiAoIHR5cGUgPT09ICJmeCIgKSB7CgkJCQlxdWV1ZS51bnNoaWZ0KCAiaW5wcm9ncmVzcyIgKTsKCQkJfQoKCQkJLy8gQ2xlYXIgdXAgdGhlIGxhc3QgcXVldWUgc3RvcCBmdW5jdGlvbgoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJZm4uY2FsbCggZWxlbSwgbmV4dCwgaG9va3MgKTsKCQl9CgoJCWlmICggIXN0YXJ0TGVuZ3RoICYmIGhvb2tzICkgewoJCQlob29rcy5lbXB0eS5maXJlKCk7CgkJfQoJfSwKCgkvLyBOb3QgcHVibGljIC0gZ2VuZXJhdGUgYSBxdWV1ZUhvb2tzIG9iamVjdCwgb3IgcmV0dXJuIHRoZSBjdXJyZW50IG9uZQoJX3F1ZXVlSG9va3M6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlICkgewoJCXZhciBrZXkgPSB0eXBlICsgInF1ZXVlSG9va3MiOwoJCXJldHVybiBkYXRhX3ByaXYuZ2V0KCBlbGVtLCBrZXkgKSB8fCBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCBrZXksIHsKCQkJZW1wdHk6IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IikuYWRkKGZ1bmN0aW9uKCkgewoJCQkJZGF0YV9wcml2LnJlbW92ZSggZWxlbSwgWyB0eXBlICsgInF1ZXVlIiwga2V5IF0gKTsKCQkJfSkKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCXF1ZXVlOiBmdW5jdGlvbiggdHlwZSwgZGF0YSApIHsKCQl2YXIgc2V0dGVyID0gMjsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCWRhdGEgPSB0eXBlOwoJCQl0eXBlID0gImZ4IjsKCQkJc2V0dGVyLS07CgkJfQoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPCBzZXR0ZXIgKSB7CgkJCXJldHVybiBqUXVlcnkucXVldWUoIHRoaXNbMF0sIHR5cGUgKTsKCQl9CgoJCXJldHVybiBkYXRhID09PSB1bmRlZmluZWQgPwoJCQl0aGlzIDoKCQkJdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQkJdmFyIHF1ZXVlID0galF1ZXJ5LnF1ZXVlKCB0aGlzLCB0eXBlLCBkYXRhICk7CgoJCQkJLy8gRW5zdXJlIGEgaG9va3MgZm9yIHRoaXMgcXVldWUKCQkJCWpRdWVyeS5fcXVldWVIb29rcyggdGhpcywgdHlwZSApOwoKCQkJCWlmICggdHlwZSA9PT0gImZ4IiAmJiBxdWV1ZVswXSAhPT0gImlucHJvZ3Jlc3MiICkgewoJCQkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJCQl9CgkJCX0pOwoJfSwKCWRlcXVldWU6IGZ1bmN0aW9uKCB0eXBlICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCB0eXBlICk7CgkJfSk7Cgl9LAoJY2xlYXJRdWV1ZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJcmV0dXJuIHRoaXMucXVldWUoIHR5cGUgfHwgImZ4IiwgW10gKTsKCX0sCgkvLyBHZXQgYSBwcm9taXNlIHJlc29sdmVkIHdoZW4gcXVldWVzIG9mIGEgY2VydGFpbiB0eXBlCgkvLyBhcmUgZW1wdGllZCAoZnggaXMgdGhlIHR5cGUgYnkgZGVmYXVsdCkKCXByb21pc2U6IGZ1bmN0aW9uKCB0eXBlLCBvYmogKSB7CgkJdmFyIHRtcCwKCQkJY291bnQgPSAxLAoJCQlkZWZlciA9IGpRdWVyeS5EZWZlcnJlZCgpLAoJCQllbGVtZW50cyA9IHRoaXMsCgkJCWkgPSB0aGlzLmxlbmd0aCwKCQkJcmVzb2x2ZSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAhKCAtLWNvdW50ICkgKSB7CgkJCQkJZGVmZXIucmVzb2x2ZVdpdGgoIGVsZW1lbnRzLCBbIGVsZW1lbnRzIF0gKTsKCQkJCX0KCQkJfTsKCgkJaWYgKCB0eXBlb2YgdHlwZSAhPT0gInN0cmluZyIgKSB7CgkJCW9iaiA9IHR5cGU7CgkJCXR5cGUgPSB1bmRlZmluZWQ7CgkJfQoJCXR5cGUgPSB0eXBlIHx8ICJmeCI7CgoJCXdoaWxlICggaS0tICkgewoJCQl0bXAgPSBkYXRhX3ByaXYuZ2V0KCBlbGVtZW50c1sgaSBdLCB0eXBlICsgInF1ZXVlSG9va3MiICk7CgkJCWlmICggdG1wICYmIHRtcC5lbXB0eSApIHsKCQkJCWNvdW50Kys7CgkJCQl0bXAuZW1wdHkuYWRkKCByZXNvbHZlICk7CgkJCX0KCQl9CgkJcmVzb2x2ZSgpOwoJCXJldHVybiBkZWZlci5wcm9taXNlKCBvYmogKTsKCX0KfSk7CnZhciBwbnVtID0gKC9bKy1dPyg/OlxkKlwufClcZCsoPzpbZUVdWystXT9cZCt8KS8pLnNvdXJjZTsKCnZhciBjc3NFeHBhbmQgPSBbICJUb3AiLCAiUmlnaHQiLCAiQm90dG9tIiwgIkxlZnQiIF07Cgp2YXIgaXNIaWRkZW4gPSBmdW5jdGlvbiggZWxlbSwgZWwgKSB7CgkJLy8gaXNIaWRkZW4gbWlnaHQgYmUgY2FsbGVkIGZyb20galF1ZXJ5I2ZpbHRlciBmdW5jdGlvbjsKCQkvLyBpbiB0aGF0IGNhc2UsIGVsZW1lbnQgd2lsbCBiZSBzZWNvbmQgYXJndW1lbnQKCQllbGVtID0gZWwgfHwgZWxlbTsKCQlyZXR1cm4galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICkgPT09ICJub25lIiB8fCAhalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKCX07Cgp2YXIgcmNoZWNrYWJsZVR5cGUgPSAoL14oPzpjaGVja2JveHxyYWRpbykkL2kpOwoKCgooZnVuY3Rpb24oKSB7Cgl2YXIgZnJhZ21lbnQgPSBkb2N1bWVudC5jcmVhdGVEb2N1bWVudEZyYWdtZW50KCksCgkJZGl2ID0gZnJhZ21lbnQuYXBwZW5kQ2hpbGQoIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICkgKSwKCQlpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpbnB1dCIgKTsKCgkvLyBTdXBwb3J0OiBTYWZhcmk8PTUuMQoJLy8gQ2hlY2sgc3RhdGUgbG9zdCBpZiB0aGUgbmFtZSBpcyBzZXQgKCMxMTIxNykKCS8vIFN1cHBvcnQ6IFdpbmRvd3MgV2ViIEFwcHMgKFdXQSkKCS8vIGBuYW1lYCBhbmQgYHR5cGVgIG11c3QgdXNlIC5zZXRBdHRyaWJ1dGUgZm9yIFdXQSAoIzE0OTAxKQoJaW5wdXQuc2V0QXR0cmlidXRlKCAidHlwZSIsICJyYWRpbyIgKTsKCWlucHV0LnNldEF0dHJpYnV0ZSggImNoZWNrZWQiLCAiY2hlY2tlZCIgKTsKCWlucHV0LnNldEF0dHJpYnV0ZSggIm5hbWUiLCAidCIgKTsKCglkaXYuYXBwZW5kQ2hpbGQoIGlucHV0ICk7CgoJLy8gU3VwcG9ydDogU2FmYXJpPD01LjEsIEFuZHJvaWQ8NC4yCgkvLyBPbGRlciBXZWJLaXQgZG9lc24ndCBjbG9uZSBjaGVja2VkIHN0YXRlIGNvcnJlY3RseSBpbiBmcmFnbWVudHMKCXN1cHBvcnQuY2hlY2tDbG9uZSA9IGRpdi5jbG9uZU5vZGUoIHRydWUgKS5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuY2hlY2tlZDsKCgkvLyBTdXBwb3J0OiBJRTw9MTErCgkvLyBNYWtlIHN1cmUgdGV4dGFyZWEgKGFuZCBjaGVja2JveCkgZGVmYXVsdFZhbHVlIGlzIHByb3Blcmx5IGNsb25lZAoJZGl2LmlubmVySFRNTCA9ICI8dGV4dGFyZWE+eDwvdGV4dGFyZWE+IjsKCXN1cHBvcnQubm9DbG9uZUNoZWNrZWQgPSAhIWRpdi5jbG9uZU5vZGUoIHRydWUgKS5sYXN0Q2hpbGQuZGVmYXVsdFZhbHVlOwp9KSgpOwp2YXIgc3RydW5kZWZpbmVkID0gdHlwZW9mIHVuZGVmaW5lZDsKCgoKc3VwcG9ydC5mb2N1c2luQnViYmxlcyA9ICJvbmZvY3VzaW4iIGluIHdpbmRvdzsKCgp2YXIKCXJrZXlFdmVudCA9IC9ea2V5LywKCXJtb3VzZUV2ZW50ID0gL14oPzptb3VzZXxwb2ludGVyfGNvbnRleHRtZW51KXxjbGljay8sCglyZm9jdXNNb3JwaCA9IC9eKD86Zm9jdXNpbmZvY3VzfGZvY3Vzb3V0Ymx1cikkLywKCXJ0eXBlbmFtZXNwYWNlID0gL14oW14uXSopKD86XC4oLispfCkkLzsKCmZ1bmN0aW9uIHJldHVyblRydWUoKSB7CglyZXR1cm4gdHJ1ZTsKfQoKZnVuY3Rpb24gcmV0dXJuRmFsc2UoKSB7CglyZXR1cm4gZmFsc2U7Cn0KCmZ1bmN0aW9uIHNhZmVBY3RpdmVFbGVtZW50KCkgewoJdHJ5IHsKCQlyZXR1cm4gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsKCX0gY2F0Y2ggKCBlcnIgKSB7IH0KfQoKLyoKICogSGVscGVyIGZ1bmN0aW9ucyBmb3IgbWFuYWdpbmcgZXZlbnRzIC0tIG5vdCBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLgogKiBQcm9wcyB0byBEZWFuIEVkd2FyZHMnIGFkZEV2ZW50IGxpYnJhcnkgZm9yIG1hbnkgb2YgdGhlIGlkZWFzLgogKi8KalF1ZXJ5LmV2ZW50ID0gewoKCWdsb2JhbDoge30sCgoJYWRkOiBmdW5jdGlvbiggZWxlbSwgdHlwZXMsIGhhbmRsZXIsIGRhdGEsIHNlbGVjdG9yICkgewoKCQl2YXIgaGFuZGxlT2JqSW4sIGV2ZW50SGFuZGxlLCB0bXAsCgkJCWV2ZW50cywgdCwgaGFuZGxlT2JqLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwgbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0gZGF0YV9wcml2LmdldCggZWxlbSApOwoKCQkvLyBEb24ndCBhdHRhY2ggZXZlbnRzIHRvIG5vRGF0YSBvciB0ZXh0L2NvbW1lbnQgbm9kZXMgKGJ1dCBhbGxvdyBwbGFpbiBvYmplY3RzKQoJCWlmICggIWVsZW1EYXRhICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYW4gb2JqZWN0IG9mIGN1c3RvbSBkYXRhIGluIGxpZXUgb2YgdGhlIGhhbmRsZXIKCQlpZiAoIGhhbmRsZXIuaGFuZGxlciApIHsKCQkJaGFuZGxlT2JqSW4gPSBoYW5kbGVyOwoJCQloYW5kbGVyID0gaGFuZGxlT2JqSW4uaGFuZGxlcjsKCQkJc2VsZWN0b3IgPSBoYW5kbGVPYmpJbi5zZWxlY3RvcjsKCQl9CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBoYW5kbGVyIGhhcyBhIHVuaXF1ZSBJRCwgdXNlZCB0byBmaW5kL3JlbW92ZSBpdCBsYXRlcgoJCWlmICggIWhhbmRsZXIuZ3VpZCApIHsKCQkJaGFuZGxlci5ndWlkID0galF1ZXJ5Lmd1aWQrKzsKCQl9CgoJCS8vIEluaXQgdGhlIGVsZW1lbnQncyBldmVudCBzdHJ1Y3R1cmUgYW5kIG1haW4gaGFuZGxlciwgaWYgdGhpcyBpcyB0aGUgZmlyc3QKCQlpZiAoICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsKCQkJZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzID0ge307CgkJfQoJCWlmICggIShldmVudEhhbmRsZSA9IGVsZW1EYXRhLmhhbmRsZSkgKSB7CgkJCWV2ZW50SGFuZGxlID0gZWxlbURhdGEuaGFuZGxlID0gZnVuY3Rpb24oIGUgKSB7CgkJCQkvLyBEaXNjYXJkIHRoZSBzZWNvbmQgZXZlbnQgb2YgYSBqUXVlcnkuZXZlbnQudHJpZ2dlcigpIGFuZAoJCQkJLy8gd2hlbiBhbiBldmVudCBpcyBjYWxsZWQgYWZ0ZXIgYSBwYWdlIGhhcyB1bmxvYWRlZAoJCQkJcmV0dXJuIHR5cGVvZiBqUXVlcnkgIT09IHN0cnVuZGVmaW5lZCAmJiBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICE9PSBlLnR5cGUgPwoJCQkJCWpRdWVyeS5ldmVudC5kaXNwYXRjaC5hcHBseSggZWxlbSwgYXJndW1lbnRzICkgOiB1bmRlZmluZWQ7CgkJCX07CgkJfQoKCQkvLyBIYW5kbGUgbXVsdGlwbGUgZXZlbnRzIHNlcGFyYXRlZCBieSBhIHNwYWNlCgkJdHlwZXMgPSAoIHR5cGVzIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFsgIiIgXTsKCQl0ID0gdHlwZXMubGVuZ3RoOwoJCXdoaWxlICggdC0tICkgewoJCQl0bXAgPSBydHlwZW5hbWVzcGFjZS5leGVjKCB0eXBlc1t0XSApIHx8IFtdOwoJCQl0eXBlID0gb3JpZ1R5cGUgPSB0bXBbMV07CgkJCW5hbWVzcGFjZXMgPSAoIHRtcFsyXSB8fCAiIiApLnNwbGl0KCAiLiIgKS5zb3J0KCk7CgoJCQkvLyBUaGVyZSAqbXVzdCogYmUgYSB0eXBlLCBubyBhdHRhY2hpbmcgbmFtZXNwYWNlLW9ubHkgaGFuZGxlcnMKCQkJaWYgKCAhdHlwZSApIHsKCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBJZiBldmVudCBjaGFuZ2VzIGl0cyB0eXBlLCB1c2UgdGhlIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMgZm9yIHRoZSBjaGFuZ2VkIHR5cGUKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsWyB0eXBlIF0gfHwge307CgoJCQkvLyBJZiBzZWxlY3RvciBkZWZpbmVkLCBkZXRlcm1pbmUgc3BlY2lhbCBldmVudCBhcGkgdHlwZSwgb3RoZXJ3aXNlIGdpdmVuIHR5cGUKCQkJdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOwoKCQkJLy8gVXBkYXRlIHNwZWNpYWwgYmFzZWQgb24gbmV3bHkgcmVzZXQgdHlwZQoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCgkJCS8vIGhhbmRsZU9iaiBpcyBwYXNzZWQgdG8gYWxsIGV2ZW50IGhhbmRsZXJzCgkJCWhhbmRsZU9iaiA9IGpRdWVyeS5leHRlbmQoewoJCQkJdHlwZTogdHlwZSwKCQkJCW9yaWdUeXBlOiBvcmlnVHlwZSwKCQkJCWRhdGE6IGRhdGEsCgkJCQloYW5kbGVyOiBoYW5kbGVyLAoJCQkJZ3VpZDogaGFuZGxlci5ndWlkLAoJCQkJc2VsZWN0b3I6IHNlbGVjdG9yLAoJCQkJbmVlZHNDb250ZXh0OiBzZWxlY3RvciAmJiBqUXVlcnkuZXhwci5tYXRjaC5uZWVkc0NvbnRleHQudGVzdCggc2VsZWN0b3IgKSwKCQkJCW5hbWVzcGFjZTogbmFtZXNwYWNlcy5qb2luKCIuIikKCQkJfSwgaGFuZGxlT2JqSW4gKTsKCgkJCS8vIEluaXQgdGhlIGV2ZW50IGhhbmRsZXIgcXVldWUgaWYgd2UncmUgdGhlIGZpcnN0CgkJCWlmICggIShoYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdKSApIHsKCQkJCWhhbmRsZXJzID0gZXZlbnRzWyB0eXBlIF0gPSBbXTsKCQkJCWhhbmRsZXJzLmRlbGVnYXRlQ291bnQgPSAwOwoKCQkJCS8vIE9ubHkgdXNlIGFkZEV2ZW50TGlzdGVuZXIgaWYgdGhlIHNwZWNpYWwgZXZlbnRzIGhhbmRsZXIgcmV0dXJucyBmYWxzZQoJCQkJaWYgKCAhc3BlY2lhbC5zZXR1cCB8fCBzcGVjaWFsLnNldHVwLmNhbGwoIGVsZW0sIGRhdGEsIG5hbWVzcGFjZXMsIGV2ZW50SGFuZGxlICkgPT09IGZhbHNlICkgewoJCQkJCWlmICggZWxlbS5hZGRFdmVudExpc3RlbmVyICkgewoJCQkJCQllbGVtLmFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGV2ZW50SGFuZGxlLCBmYWxzZSApOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJaWYgKCBzcGVjaWFsLmFkZCApIHsKCQkJCXNwZWNpYWwuYWRkLmNhbGwoIGVsZW0sIGhhbmRsZU9iaiApOwoKCQkJCWlmICggIWhhbmRsZU9iai5oYW5kbGVyLmd1aWQgKSB7CgkJCQkJaGFuZGxlT2JqLmhhbmRsZXIuZ3VpZCA9IGhhbmRsZXIuZ3VpZDsKCQkJCX0KCQkJfQoKCQkJLy8gQWRkIHRvIHRoZSBlbGVtZW50J3MgaGFuZGxlciBsaXN0LCBkZWxlZ2F0ZXMgaW4gZnJvbnQKCQkJaWYgKCBzZWxlY3RvciApIHsKCQkJCWhhbmRsZXJzLnNwbGljZSggaGFuZGxlcnMuZGVsZWdhdGVDb3VudCsrLCAwLCBoYW5kbGVPYmogKTsKCQkJfSBlbHNlIHsKCQkJCWhhbmRsZXJzLnB1c2goIGhhbmRsZU9iaiApOwoJCQl9CgoJCQkvLyBLZWVwIHRyYWNrIG9mIHdoaWNoIGV2ZW50cyBoYXZlIGV2ZXIgYmVlbiB1c2VkLCBmb3IgZXZlbnQgb3B0aW1pemF0aW9uCgkJCWpRdWVyeS5ldmVudC5nbG9iYWxbIHR5cGUgXSA9IHRydWU7CgkJfQoKCX0sCgoJLy8gRGV0YWNoIGFuIGV2ZW50IG9yIHNldCBvZiBldmVudHMgZnJvbSBhbiBlbGVtZW50CglyZW1vdmU6IGZ1bmN0aW9uKCBlbGVtLCB0eXBlcywgaGFuZGxlciwgc2VsZWN0b3IsIG1hcHBlZFR5cGVzICkgewoKCQl2YXIgaiwgb3JpZ0NvdW50LCB0bXAsCgkJCWV2ZW50cywgdCwgaGFuZGxlT2JqLAoJCQlzcGVjaWFsLCBoYW5kbGVycywgdHlwZSwgbmFtZXNwYWNlcywgb3JpZ1R5cGUsCgkJCWVsZW1EYXRhID0gZGF0YV9wcml2Lmhhc0RhdGEoIGVsZW0gKSAmJiBkYXRhX3ByaXYuZ2V0KCBlbGVtICk7CgoJCWlmICggIWVsZW1EYXRhIHx8ICEoZXZlbnRzID0gZWxlbURhdGEuZXZlbnRzKSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gT25jZSBmb3IgZWFjaCB0eXBlLm5hbWVzcGFjZSBpbiB0eXBlczsgdHlwZSBtYXkgYmUgb21pdHRlZAoJCXR5cGVzID0gKCB0eXBlcyB8fCAiIiApLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbICIiIF07CgkJdCA9IHR5cGVzLmxlbmd0aDsKCQl3aGlsZSAoIHQtLSApIHsKCQkJdG1wID0gcnR5cGVuYW1lc3BhY2UuZXhlYyggdHlwZXNbdF0gKSB8fCBbXTsKCQkJdHlwZSA9IG9yaWdUeXBlID0gdG1wWzFdOwoJCQluYW1lc3BhY2VzID0gKCB0bXBbMl0gfHwgIiIgKS5zcGxpdCggIi4iICkuc29ydCgpOwoKCQkJLy8gVW5iaW5kIGFsbCBldmVudHMgKG9uIHRoaXMgbmFtZXNwYWNlLCBpZiBwcm92aWRlZCkgZm9yIHRoZSBlbGVtZW50CgkJCWlmICggIXR5cGUgKSB7CgkJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICsgdHlwZXNbIHQgXSwgaGFuZGxlciwgc2VsZWN0b3IsIHRydWUgKTsKCQkJCX0KCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQkJdHlwZSA9ICggc2VsZWN0b3IgPyBzcGVjaWFsLmRlbGVnYXRlVHlwZSA6IHNwZWNpYWwuYmluZFR5cGUgKSB8fCB0eXBlOwoJCQloYW5kbGVycyA9IGV2ZW50c1sgdHlwZSBdIHx8IFtdOwoJCQl0bXAgPSB0bXBbMl0gJiYgbmV3IFJlZ0V4cCggIihefFxcLikiICsgbmFtZXNwYWNlcy5qb2luKCJcXC4oPzouKlxcLnwpIikgKyAiKFxcLnwkKSIgKTsKCgkJCS8vIFJlbW92ZSBtYXRjaGluZyBldmVudHMKCQkJb3JpZ0NvdW50ID0gaiA9IGhhbmRsZXJzLmxlbmd0aDsKCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQloYW5kbGVPYmogPSBoYW5kbGVyc1sgaiBdOwoKCQkJCWlmICggKCBtYXBwZWRUeXBlcyB8fCBvcmlnVHlwZSA9PT0gaGFuZGxlT2JqLm9yaWdUeXBlICkgJiYKCQkJCQkoICFoYW5kbGVyIHx8IGhhbmRsZXIuZ3VpZCA9PT0gaGFuZGxlT2JqLmd1aWQgKSAmJgoJCQkJCSggIXRtcCB8fCB0bXAudGVzdCggaGFuZGxlT2JqLm5hbWVzcGFjZSApICkgJiYKCQkJCQkoICFzZWxlY3RvciB8fCBzZWxlY3RvciA9PT0gaGFuZGxlT2JqLnNlbGVjdG9yIHx8IHNlbGVjdG9yID09PSAiKioiICYmIGhhbmRsZU9iai5zZWxlY3RvciApICkgewoJCQkJCWhhbmRsZXJzLnNwbGljZSggaiwgMSApOwoKCQkJCQlpZiAoIGhhbmRsZU9iai5zZWxlY3RvciApIHsKCQkJCQkJaGFuZGxlcnMuZGVsZWdhdGVDb3VudC0tOwoJCQkJCX0KCQkJCQlpZiAoIHNwZWNpYWwucmVtb3ZlICkgewoJCQkJCQlzcGVjaWFsLnJlbW92ZS5jYWxsKCBlbGVtLCBoYW5kbGVPYmogKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCS8vIFJlbW92ZSBnZW5lcmljIGV2ZW50IGhhbmRsZXIgaWYgd2UgcmVtb3ZlZCBzb21ldGhpbmcgYW5kIG5vIG1vcmUgaGFuZGxlcnMgZXhpc3QKCQkJLy8gKGF2b2lkcyBwb3RlbnRpYWwgZm9yIGVuZGxlc3MgcmVjdXJzaW9uIGR1cmluZyByZW1vdmFsIG9mIHNwZWNpYWwgZXZlbnQgaGFuZGxlcnMpCgkJCWlmICggb3JpZ0NvdW50ICYmICFoYW5kbGVycy5sZW5ndGggKSB7CgkJCQlpZiAoICFzcGVjaWFsLnRlYXJkb3duIHx8IHNwZWNpYWwudGVhcmRvd24uY2FsbCggZWxlbSwgbmFtZXNwYWNlcywgZWxlbURhdGEuaGFuZGxlICkgPT09IGZhbHNlICkgewoJCQkJCWpRdWVyeS5yZW1vdmVFdmVudCggZWxlbSwgdHlwZSwgZWxlbURhdGEuaGFuZGxlICk7CgkJCQl9CgoJCQkJZGVsZXRlIGV2ZW50c1sgdHlwZSBdOwoJCQl9CgkJfQoKCQkvLyBSZW1vdmUgdGhlIGV4cGFuZG8gaWYgaXQncyBubyBsb25nZXIgdXNlZAoJCWlmICggalF1ZXJ5LmlzRW1wdHlPYmplY3QoIGV2ZW50cyApICkgewoJCQlkZWxldGUgZWxlbURhdGEuaGFuZGxlOwoJCQlkYXRhX3ByaXYucmVtb3ZlKCBlbGVtLCAiZXZlbnRzIiApOwoJCX0KCX0sCgoJdHJpZ2dlcjogZnVuY3Rpb24oIGV2ZW50LCBkYXRhLCBlbGVtLCBvbmx5SGFuZGxlcnMgKSB7CgoJCXZhciBpLCBjdXIsIHRtcCwgYnViYmxlVHlwZSwgb250eXBlLCBoYW5kbGUsIHNwZWNpYWwsCgkJCWV2ZW50UGF0aCA9IFsgZWxlbSB8fCBkb2N1bWVudCBdLAoJCQl0eXBlID0gaGFzT3duLmNhbGwoIGV2ZW50LCAidHlwZSIgKSA/IGV2ZW50LnR5cGUgOiBldmVudCwKCQkJbmFtZXNwYWNlcyA9IGhhc093bi5jYWxsKCBldmVudCwgIm5hbWVzcGFjZSIgKSA/IGV2ZW50Lm5hbWVzcGFjZS5zcGxpdCgiLiIpIDogW107CgoJCWN1ciA9IHRtcCA9IGVsZW0gPSBlbGVtIHx8IGRvY3VtZW50OwoKCQkvLyBEb24ndCBkbyBldmVudHMgb24gdGV4dCBhbmQgY29tbWVudCBub2RlcwoJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMyB8fCBlbGVtLm5vZGVUeXBlID09PSA4ICkgewoJCQlyZXR1cm47CgkJfQoKCQkvLyBmb2N1cy9ibHVyIG1vcnBocyB0byBmb2N1c2luL291dDsgZW5zdXJlIHdlJ3JlIG5vdCBmaXJpbmcgdGhlbSByaWdodCBub3cKCQlpZiAoIHJmb2N1c01vcnBoLnRlc3QoIHR5cGUgKyBqUXVlcnkuZXZlbnQudHJpZ2dlcmVkICkgKSB7CgkJCXJldHVybjsKCQl9CgoJCWlmICggdHlwZS5pbmRleE9mKCIuIikgPj0gMCApIHsKCQkJLy8gTmFtZXNwYWNlZCB0cmlnZ2VyOyBjcmVhdGUgYSByZWdleHAgdG8gbWF0Y2ggZXZlbnQgdHlwZSBpbiBoYW5kbGUoKQoJCQluYW1lc3BhY2VzID0gdHlwZS5zcGxpdCgiLiIpOwoJCQl0eXBlID0gbmFtZXNwYWNlcy5zaGlmdCgpOwoJCQluYW1lc3BhY2VzLnNvcnQoKTsKCQl9CgkJb250eXBlID0gdHlwZS5pbmRleE9mKCI6IikgPCAwICYmICJvbiIgKyB0eXBlOwoKCQkvLyBDYWxsZXIgY2FuIHBhc3MgaW4gYSBqUXVlcnkuRXZlbnQgb2JqZWN0LCBPYmplY3QsIG9yIGp1c3QgYW4gZXZlbnQgdHlwZSBzdHJpbmcKCQlldmVudCA9IGV2ZW50WyBqUXVlcnkuZXhwYW5kbyBdID8KCQkJZXZlbnQgOgoJCQluZXcgalF1ZXJ5LkV2ZW50KCB0eXBlLCB0eXBlb2YgZXZlbnQgPT09ICJvYmplY3QiICYmIGV2ZW50ICk7CgoJCS8vIFRyaWdnZXIgYml0bWFzazogJiAxIGZvciBuYXRpdmUgaGFuZGxlcnM7ICYgMiBmb3IgalF1ZXJ5IChhbHdheXMgdHJ1ZSkKCQlldmVudC5pc1RyaWdnZXIgPSBvbmx5SGFuZGxlcnMgPyAyIDogMzsKCQlldmVudC5uYW1lc3BhY2UgPSBuYW1lc3BhY2VzLmpvaW4oIi4iKTsKCQlldmVudC5uYW1lc3BhY2VfcmUgPSBldmVudC5uYW1lc3BhY2UgPwoJCQluZXcgUmVnRXhwKCAiKF58XFwuKSIgKyBuYW1lc3BhY2VzLmpvaW4oIlxcLig/Oi4qXFwufCkiKSArICIoXFwufCQpIiApIDoKCQkJbnVsbDsKCgkJLy8gQ2xlYW4gdXAgdGhlIGV2ZW50IGluIGNhc2UgaXQgaXMgYmVpbmcgcmV1c2VkCgkJZXZlbnQucmVzdWx0ID0gdW5kZWZpbmVkOwoJCWlmICggIWV2ZW50LnRhcmdldCApIHsKCQkJZXZlbnQudGFyZ2V0ID0gZWxlbTsKCQl9CgoJCS8vIENsb25lIGFueSBpbmNvbWluZyBkYXRhIGFuZCBwcmVwZW5kIHRoZSBldmVudCwgY3JlYXRpbmcgdGhlIGhhbmRsZXIgYXJnIGxpc3QKCQlkYXRhID0gZGF0YSA9PSBudWxsID8KCQkJWyBldmVudCBdIDoKCQkJalF1ZXJ5Lm1ha2VBcnJheSggZGF0YSwgWyBldmVudCBdICk7CgoJCS8vIEFsbG93IHNwZWNpYWwgZXZlbnRzIHRvIGRyYXcgb3V0c2lkZSB0aGUgbGluZXMKCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIHR5cGUgXSB8fCB7fTsKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgc3BlY2lhbC50cmlnZ2VyICYmIHNwZWNpYWwudHJpZ2dlci5hcHBseSggZWxlbSwgZGF0YSApID09PSBmYWxzZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRGV0ZXJtaW5lIGV2ZW50IHByb3BhZ2F0aW9uIHBhdGggaW4gYWR2YW5jZSwgcGVyIFczQyBldmVudHMgc3BlYyAoIzk5NTEpCgkJLy8gQnViYmxlIHVwIHRvIGRvY3VtZW50LCB0aGVuIHRvIHdpbmRvdzsgd2F0Y2ggZm9yIGEgZ2xvYmFsIG93bmVyRG9jdW1lbnQgdmFyICgjOTcyNCkKCQlpZiAoICFvbmx5SGFuZGxlcnMgJiYgIXNwZWNpYWwubm9CdWJibGUgJiYgIWpRdWVyeS5pc1dpbmRvdyggZWxlbSApICkgewoKCQkJYnViYmxlVHlwZSA9IHNwZWNpYWwuZGVsZWdhdGVUeXBlIHx8IHR5cGU7CgkJCWlmICggIXJmb2N1c01vcnBoLnRlc3QoIGJ1YmJsZVR5cGUgKyB0eXBlICkgKSB7CgkJCQljdXIgPSBjdXIucGFyZW50Tm9kZTsKCQkJfQoJCQlmb3IgKCA7IGN1cjsgY3VyID0gY3VyLnBhcmVudE5vZGUgKSB7CgkJCQlldmVudFBhdGgucHVzaCggY3VyICk7CgkJCQl0bXAgPSBjdXI7CgkJCX0KCgkJCS8vIE9ubHkgYWRkIHdpbmRvdyBpZiB3ZSBnb3QgdG8gZG9jdW1lbnQgKGUuZy4sIG5vdCBwbGFpbiBvYmogb3IgZGV0YWNoZWQgRE9NKQoJCQlpZiAoIHRtcCA9PT0gKGVsZW0ub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudCkgKSB7CgkJCQlldmVudFBhdGgucHVzaCggdG1wLmRlZmF1bHRWaWV3IHx8IHRtcC5wYXJlbnRXaW5kb3cgfHwgd2luZG93ICk7CgkJCX0KCQl9CgoJCS8vIEZpcmUgaGFuZGxlcnMgb24gdGhlIGV2ZW50IHBhdGgKCQlpID0gMDsKCQl3aGlsZSAoIChjdXIgPSBldmVudFBhdGhbaSsrXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgoJCQlldmVudC50eXBlID0gaSA+IDEgPwoJCQkJYnViYmxlVHlwZSA6CgkJCQlzcGVjaWFsLmJpbmRUeXBlIHx8IHR5cGU7CgoJCQkvLyBqUXVlcnkgaGFuZGxlcgoJCQloYW5kbGUgPSAoIGRhdGFfcHJpdi5nZXQoIGN1ciwgImV2ZW50cyIgKSB8fCB7fSApWyBldmVudC50eXBlIF0gJiYgZGF0YV9wcml2LmdldCggY3VyLCAiaGFuZGxlIiApOwoJCQlpZiAoIGhhbmRsZSApIHsKCQkJCWhhbmRsZS5hcHBseSggY3VyLCBkYXRhICk7CgkJCX0KCgkJCS8vIE5hdGl2ZSBoYW5kbGVyCgkJCWhhbmRsZSA9IG9udHlwZSAmJiBjdXJbIG9udHlwZSBdOwoJCQlpZiAoIGhhbmRsZSAmJiBoYW5kbGUuYXBwbHkgJiYgalF1ZXJ5LmFjY2VwdERhdGEoIGN1ciApICkgewoJCQkJZXZlbnQucmVzdWx0ID0gaGFuZGxlLmFwcGx5KCBjdXIsIGRhdGEgKTsKCQkJCWlmICggZXZlbnQucmVzdWx0ID09PSBmYWxzZSApIHsKCQkJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJCQkJfQoJCQl9CgkJfQoJCWV2ZW50LnR5cGUgPSB0eXBlOwoKCQkvLyBJZiBub2JvZHkgcHJldmVudGVkIHRoZSBkZWZhdWx0IGFjdGlvbiwgZG8gaXQgbm93CgkJaWYgKCAhb25seUhhbmRsZXJzICYmICFldmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSApIHsKCgkJCWlmICggKCFzcGVjaWFsLl9kZWZhdWx0IHx8IHNwZWNpYWwuX2RlZmF1bHQuYXBwbHkoIGV2ZW50UGF0aC5wb3AoKSwgZGF0YSApID09PSBmYWxzZSkgJiYKCQkJCWpRdWVyeS5hY2NlcHREYXRhKCBlbGVtICkgKSB7CgoJCQkJLy8gQ2FsbCBhIG5hdGl2ZSBET00gbWV0aG9kIG9uIHRoZSB0YXJnZXQgd2l0aCB0aGUgc2FtZSBuYW1lIG5hbWUgYXMgdGhlIGV2ZW50LgoJCQkJLy8gRG9uJ3QgZG8gZGVmYXVsdCBhY3Rpb25zIG9uIHdpbmRvdywgdGhhdCdzIHdoZXJlIGdsb2JhbCB2YXJpYWJsZXMgYmUgKCM2MTcwKQoJCQkJaWYgKCBvbnR5cGUgJiYgalF1ZXJ5LmlzRnVuY3Rpb24oIGVsZW1bIHR5cGUgXSApICYmICFqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSApIHsKCgkJCQkJLy8gRG9uJ3QgcmUtdHJpZ2dlciBhbiBvbkZPTyBldmVudCB3aGVuIHdlIGNhbGwgaXRzIEZPTygpIG1ldGhvZAoJCQkJCXRtcCA9IGVsZW1bIG9udHlwZSBdOwoKCQkJCQlpZiAoIHRtcCApIHsKCQkJCQkJZWxlbVsgb250eXBlIF0gPSBudWxsOwoJCQkJCX0KCgkJCQkJLy8gUHJldmVudCByZS10cmlnZ2VyaW5nIG9mIHRoZSBzYW1lIGV2ZW50LCBzaW5jZSB3ZSBhbHJlYWR5IGJ1YmJsZWQgaXQgYWJvdmUKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdHlwZTsKCQkJCQllbGVtWyB0eXBlIF0oKTsKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcmVkID0gdW5kZWZpbmVkOwoKCQkJCQlpZiAoIHRtcCApIHsKCQkJCQkJZWxlbVsgb250eXBlIF0gPSB0bXA7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gZXZlbnQucmVzdWx0OwoJfSwKCglkaXNwYXRjaDogZnVuY3Rpb24oIGV2ZW50ICkgewoKCQkvLyBNYWtlIGEgd3JpdGFibGUgalF1ZXJ5LkV2ZW50IGZyb20gdGhlIG5hdGl2ZSBldmVudCBvYmplY3QKCQlldmVudCA9IGpRdWVyeS5ldmVudC5maXgoIGV2ZW50ICk7CgoJCXZhciBpLCBqLCByZXQsIG1hdGNoZWQsIGhhbmRsZU9iaiwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWFyZ3MgPSBzbGljZS5jYWxsKCBhcmd1bWVudHMgKSwKCQkJaGFuZGxlcnMgPSAoIGRhdGFfcHJpdi5nZXQoIHRoaXMsICJldmVudHMiICkgfHwge30gKVsgZXZlbnQudHlwZSBdIHx8IFtdLAoJCQlzcGVjaWFsID0galF1ZXJ5LmV2ZW50LnNwZWNpYWxbIGV2ZW50LnR5cGUgXSB8fCB7fTsKCgkJLy8gVXNlIHRoZSBmaXgtZWQgalF1ZXJ5LkV2ZW50IHJhdGhlciB0aGFuIHRoZSAocmVhZC1vbmx5KSBuYXRpdmUgZXZlbnQKCQlhcmdzWzBdID0gZXZlbnQ7CgkJZXZlbnQuZGVsZWdhdGVUYXJnZXQgPSB0aGlzOwoKCQkvLyBDYWxsIHRoZSBwcmVEaXNwYXRjaCBob29rIGZvciB0aGUgbWFwcGVkIHR5cGUsIGFuZCBsZXQgaXQgYmFpbCBpZiBkZXNpcmVkCgkJaWYgKCBzcGVjaWFsLnByZURpc3BhdGNoICYmIHNwZWNpYWwucHJlRGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKSA9PT0gZmFsc2UgKSB7CgkJCXJldHVybjsKCQl9CgoJCS8vIERldGVybWluZSBoYW5kbGVycwoJCWhhbmRsZXJRdWV1ZSA9IGpRdWVyeS5ldmVudC5oYW5kbGVycy5jYWxsKCB0aGlzLCBldmVudCwgaGFuZGxlcnMgKTsKCgkJLy8gUnVuIGRlbGVnYXRlcyBmaXJzdDsgdGhleSBtYXkgd2FudCB0byBzdG9wIHByb3BhZ2F0aW9uIGJlbmVhdGggdXMKCQlpID0gMDsKCQl3aGlsZSAoIChtYXRjaGVkID0gaGFuZGxlclF1ZXVlWyBpKysgXSkgJiYgIWV2ZW50LmlzUHJvcGFnYXRpb25TdG9wcGVkKCkgKSB7CgkJCWV2ZW50LmN1cnJlbnRUYXJnZXQgPSBtYXRjaGVkLmVsZW07CgoJCQlqID0gMDsKCQkJd2hpbGUgKCAoaGFuZGxlT2JqID0gbWF0Y2hlZC5oYW5kbGVyc1sgaisrIF0pICYmICFldmVudC5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCgpICkgewoKCQkJCS8vIFRyaWdnZXJlZCBldmVudCBtdXN0IGVpdGhlciAxKSBoYXZlIG5vIG5hbWVzcGFjZSwgb3IgMikgaGF2ZSBuYW1lc3BhY2UocykKCQkJCS8vIGEgc3Vic2V0IG9yIGVxdWFsIHRvIHRob3NlIGluIHRoZSBib3VuZCBldmVudCAoYm90aCBjYW4gaGF2ZSBubyBuYW1lc3BhY2UpLgoJCQkJaWYgKCAhZXZlbnQubmFtZXNwYWNlX3JlIHx8IGV2ZW50Lm5hbWVzcGFjZV9yZS50ZXN0KCBoYW5kbGVPYmoubmFtZXNwYWNlICkgKSB7CgoJCQkJCWV2ZW50LmhhbmRsZU9iaiA9IGhhbmRsZU9iajsKCQkJCQlldmVudC5kYXRhID0gaGFuZGxlT2JqLmRhdGE7CgoJCQkJCXJldCA9ICggKGpRdWVyeS5ldmVudC5zcGVjaWFsWyBoYW5kbGVPYmoub3JpZ1R5cGUgXSB8fCB7fSkuaGFuZGxlIHx8IGhhbmRsZU9iai5oYW5kbGVyICkKCQkJCQkJCS5hcHBseSggbWF0Y2hlZC5lbGVtLCBhcmdzICk7CgoJCQkJCWlmICggcmV0ICE9PSB1bmRlZmluZWQgKSB7CgkJCQkJCWlmICggKGV2ZW50LnJlc3VsdCA9IHJldCkgPT09IGZhbHNlICkgewoJCQkJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCQkJCQkJCWV2ZW50LnN0b3BQcm9wYWdhdGlvbigpOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsIHRoZSBwb3N0RGlzcGF0Y2ggaG9vayBmb3IgdGhlIG1hcHBlZCB0eXBlCgkJaWYgKCBzcGVjaWFsLnBvc3REaXNwYXRjaCApIHsKCQkJc3BlY2lhbC5wb3N0RGlzcGF0Y2guY2FsbCggdGhpcywgZXZlbnQgKTsKCQl9CgoJCXJldHVybiBldmVudC5yZXN1bHQ7Cgl9LAoKCWhhbmRsZXJzOiBmdW5jdGlvbiggZXZlbnQsIGhhbmRsZXJzICkgewoJCXZhciBpLCBtYXRjaGVzLCBzZWwsIGhhbmRsZU9iaiwKCQkJaGFuZGxlclF1ZXVlID0gW10sCgkJCWRlbGVnYXRlQ291bnQgPSBoYW5kbGVycy5kZWxlZ2F0ZUNvdW50LAoJCQljdXIgPSBldmVudC50YXJnZXQ7CgoJCS8vIEZpbmQgZGVsZWdhdGUgaGFuZGxlcnMKCQkvLyBCbGFjay1ob2xlIFNWRyA8dXNlPiBpbnN0YW5jZSB0cmVlcyAoIzEzMTgwKQoJCS8vIEF2b2lkIG5vbi1sZWZ0LWNsaWNrIGJ1YmJsaW5nIGluIEZpcmVmb3ggKCMzODYxKQoJCWlmICggZGVsZWdhdGVDb3VudCAmJiBjdXIubm9kZVR5cGUgJiYgKCFldmVudC5idXR0b24gfHwgZXZlbnQudHlwZSAhPT0gImNsaWNrIikgKSB7CgoJCQlmb3IgKCA7IGN1ciAhPT0gdGhpczsgY3VyID0gY3VyLnBhcmVudE5vZGUgfHwgdGhpcyApIHsKCgkJCQkvLyBEb24ndCBwcm9jZXNzIGNsaWNrcyBvbiBkaXNhYmxlZCBlbGVtZW50cyAoIzY5MTEsICM4MTY1LCAjMTEzODIsICMxMTc2NCkKCQkJCWlmICggY3VyLmRpc2FibGVkICE9PSB0cnVlIHx8IGV2ZW50LnR5cGUgIT09ICJjbGljayIgKSB7CgkJCQkJbWF0Y2hlcyA9IFtdOwoJCQkJCWZvciAoIGkgPSAwOyBpIDwgZGVsZWdhdGVDb3VudDsgaSsrICkgewoJCQkJCQloYW5kbGVPYmogPSBoYW5kbGVyc1sgaSBdOwoKCQkJCQkJLy8gRG9uJ3QgY29uZmxpY3Qgd2l0aCBPYmplY3QucHJvdG90eXBlIHByb3BlcnRpZXMgKCMxMzIwMykKCQkJCQkJc2VsID0gaGFuZGxlT2JqLnNlbGVjdG9yICsgIiAiOwoKCQkJCQkJaWYgKCBtYXRjaGVzWyBzZWwgXSA9PT0gdW5kZWZpbmVkICkgewoJCQkJCQkJbWF0Y2hlc1sgc2VsIF0gPSBoYW5kbGVPYmoubmVlZHNDb250ZXh0ID8KCQkJCQkJCQlqUXVlcnkoIHNlbCwgdGhpcyApLmluZGV4KCBjdXIgKSA+PSAwIDoKCQkJCQkJCQlqUXVlcnkuZmluZCggc2VsLCB0aGlzLCBudWxsLCBbIGN1ciBdICkubGVuZ3RoOwoJCQkJCQl9CgkJCQkJCWlmICggbWF0Y2hlc1sgc2VsIF0gKSB7CgkJCQkJCQltYXRjaGVzLnB1c2goIGhhbmRsZU9iaiApOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWlmICggbWF0Y2hlcy5sZW5ndGggKSB7CgkJCQkJCWhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogY3VyLCBoYW5kbGVyczogbWF0Y2hlcyB9KTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEFkZCB0aGUgcmVtYWluaW5nIChkaXJlY3RseS1ib3VuZCkgaGFuZGxlcnMKCQlpZiAoIGRlbGVnYXRlQ291bnQgPCBoYW5kbGVycy5sZW5ndGggKSB7CgkJCWhhbmRsZXJRdWV1ZS5wdXNoKHsgZWxlbTogdGhpcywgaGFuZGxlcnM6IGhhbmRsZXJzLnNsaWNlKCBkZWxlZ2F0ZUNvdW50ICkgfSk7CgkJfQoKCQlyZXR1cm4gaGFuZGxlclF1ZXVlOwoJfSwKCgkvLyBJbmNsdWRlcyBzb21lIGV2ZW50IHByb3BzIHNoYXJlZCBieSBLZXlFdmVudCBhbmQgTW91c2VFdmVudAoJcHJvcHM6ICJhbHRLZXkgYnViYmxlcyBjYW5jZWxhYmxlIGN0cmxLZXkgY3VycmVudFRhcmdldCBldmVudFBoYXNlIG1ldGFLZXkgcmVsYXRlZFRhcmdldCBzaGlmdEtleSB0YXJnZXQgdGltZVN0YW1wIHZpZXcgd2hpY2giLnNwbGl0KCIgIiksCgoJZml4SG9va3M6IHt9LAoKCWtleUhvb2tzOiB7CgkJcHJvcHM6ICJjaGFyIGNoYXJDb2RlIGtleSBrZXlDb2RlIi5zcGxpdCgiICIpLAoJCWZpbHRlcjogZnVuY3Rpb24oIGV2ZW50LCBvcmlnaW5hbCApIHsKCgkJCS8vIEFkZCB3aGljaCBmb3Iga2V5IGV2ZW50cwoJCQlpZiAoIGV2ZW50LndoaWNoID09IG51bGwgKSB7CgkJCQlldmVudC53aGljaCA9IG9yaWdpbmFsLmNoYXJDb2RlICE9IG51bGwgPyBvcmlnaW5hbC5jaGFyQ29kZSA6IG9yaWdpbmFsLmtleUNvZGU7CgkJCX0KCgkJCXJldHVybiBldmVudDsKCQl9Cgl9LAoKCW1vdXNlSG9va3M6IHsKCQlwcm9wczogImJ1dHRvbiBidXR0b25zIGNsaWVudFggY2xpZW50WSBvZmZzZXRYIG9mZnNldFkgcGFnZVggcGFnZVkgc2NyZWVuWCBzY3JlZW5ZIHRvRWxlbWVudCIuc3BsaXQoIiAiKSwKCQlmaWx0ZXI6IGZ1bmN0aW9uKCBldmVudCwgb3JpZ2luYWwgKSB7CgkJCXZhciBldmVudERvYywgZG9jLCBib2R5LAoJCQkJYnV0dG9uID0gb3JpZ2luYWwuYnV0dG9uOwoKCQkJLy8gQ2FsY3VsYXRlIHBhZ2VYL1kgaWYgbWlzc2luZyBhbmQgY2xpZW50WC9ZIGF2YWlsYWJsZQoJCQlpZiAoIGV2ZW50LnBhZ2VYID09IG51bGwgJiYgb3JpZ2luYWwuY2xpZW50WCAhPSBudWxsICkgewoJCQkJZXZlbnREb2MgPSBldmVudC50YXJnZXQub3duZXJEb2N1bWVudCB8fCBkb2N1bWVudDsKCQkJCWRvYyA9IGV2ZW50RG9jLmRvY3VtZW50RWxlbWVudDsKCQkJCWJvZHkgPSBldmVudERvYy5ib2R5OwoKCQkJCWV2ZW50LnBhZ2VYID0gb3JpZ2luYWwuY2xpZW50WCArICggZG9jICYmIGRvYy5zY3JvbGxMZWZ0IHx8IGJvZHkgJiYgYm9keS5zY3JvbGxMZWZ0IHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRMZWZ0IHx8IGJvZHkgJiYgYm9keS5jbGllbnRMZWZ0IHx8IDAgKTsKCQkJCWV2ZW50LnBhZ2VZID0gb3JpZ2luYWwuY2xpZW50WSArICggZG9jICYmIGRvYy5zY3JvbGxUb3AgIHx8IGJvZHkgJiYgYm9keS5zY3JvbGxUb3AgIHx8IDAgKSAtICggZG9jICYmIGRvYy5jbGllbnRUb3AgIHx8IGJvZHkgJiYgYm9keS5jbGllbnRUb3AgIHx8IDAgKTsKCQkJfQoKCQkJLy8gQWRkIHdoaWNoIGZvciBjbGljazogMSA9PT0gbGVmdDsgMiA9PT0gbWlkZGxlOyAzID09PSByaWdodAoJCQkvLyBOb3RlOiBidXR0b24gaXMgbm90IG5vcm1hbGl6ZWQsIHNvIGRvbid0IHVzZSBpdAoJCQlpZiAoICFldmVudC53aGljaCAmJiBidXR0b24gIT09IHVuZGVmaW5lZCApIHsKCQkJCWV2ZW50LndoaWNoID0gKCBidXR0b24gJiAxID8gMSA6ICggYnV0dG9uICYgMiA/IDMgOiAoIGJ1dHRvbiAmIDQgPyAyIDogMCApICkgKTsKCQkJfQoKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCX0sCgoJZml4OiBmdW5jdGlvbiggZXZlbnQgKSB7CgkJaWYgKCBldmVudFsgalF1ZXJ5LmV4cGFuZG8gXSApIHsKCQkJcmV0dXJuIGV2ZW50OwoJCX0KCgkJLy8gQ3JlYXRlIGEgd3JpdGFibGUgY29weSBvZiB0aGUgZXZlbnQgb2JqZWN0IGFuZCBub3JtYWxpemUgc29tZSBwcm9wZXJ0aWVzCgkJdmFyIGksIHByb3AsIGNvcHksCgkJCXR5cGUgPSBldmVudC50eXBlLAoJCQlvcmlnaW5hbEV2ZW50ID0gZXZlbnQsCgkJCWZpeEhvb2sgPSB0aGlzLmZpeEhvb2tzWyB0eXBlIF07CgoJCWlmICggIWZpeEhvb2sgKSB7CgkJCXRoaXMuZml4SG9va3NbIHR5cGUgXSA9IGZpeEhvb2sgPQoJCQkJcm1vdXNlRXZlbnQudGVzdCggdHlwZSApID8gdGhpcy5tb3VzZUhvb2tzIDoKCQkJCXJrZXlFdmVudC50ZXN0KCB0eXBlICkgPyB0aGlzLmtleUhvb2tzIDoKCQkJCXt9OwoJCX0KCQljb3B5ID0gZml4SG9vay5wcm9wcyA/IHRoaXMucHJvcHMuY29uY2F0KCBmaXhIb29rLnByb3BzICkgOiB0aGlzLnByb3BzOwoKCQlldmVudCA9IG5ldyBqUXVlcnkuRXZlbnQoIG9yaWdpbmFsRXZlbnQgKTsKCgkJaSA9IGNvcHkubGVuZ3RoOwoJCXdoaWxlICggaS0tICkgewoJCQlwcm9wID0gY29weVsgaSBdOwoJCQlldmVudFsgcHJvcCBdID0gb3JpZ2luYWxFdmVudFsgcHJvcCBdOwoJCX0KCgkJLy8gU3VwcG9ydDogQ29yZG92YSAyLjUgKFdlYktpdCkgKCMxMzI1NSkKCQkvLyBBbGwgZXZlbnRzIHNob3VsZCBoYXZlIGEgdGFyZ2V0OyBDb3Jkb3ZhIGRldmljZXJlYWR5IGRvZXNuJ3QKCQlpZiAoICFldmVudC50YXJnZXQgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGRvY3VtZW50OwoJCX0KCgkJLy8gU3VwcG9ydDogU2FmYXJpIDYuMCssIENocm9tZTwyOAoJCS8vIFRhcmdldCBzaG91bGQgbm90IGJlIGEgdGV4dCBub2RlICgjNTA0LCAjMTMxNDMpCgkJaWYgKCBldmVudC50YXJnZXQubm9kZVR5cGUgPT09IDMgKSB7CgkJCWV2ZW50LnRhcmdldCA9IGV2ZW50LnRhcmdldC5wYXJlbnROb2RlOwoJCX0KCgkJcmV0dXJuIGZpeEhvb2suZmlsdGVyID8gZml4SG9vay5maWx0ZXIoIGV2ZW50LCBvcmlnaW5hbEV2ZW50ICkgOiBldmVudDsKCX0sCgoJc3BlY2lhbDogewoJCWxvYWQ6IHsKCQkJLy8gUHJldmVudCB0cmlnZ2VyZWQgaW1hZ2UubG9hZCBldmVudHMgZnJvbSBidWJibGluZyB0byB3aW5kb3cubG9hZAoJCQlub0J1YmJsZTogdHJ1ZQoJCX0sCgkJZm9jdXM6IHsKCQkJLy8gRmlyZSBuYXRpdmUgZXZlbnQgaWYgcG9zc2libGUgc28gYmx1ci9mb2N1cyBzZXF1ZW5jZSBpcyBjb3JyZWN0CgkJCXRyaWdnZXI6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCB0aGlzICE9PSBzYWZlQWN0aXZlRWxlbWVudCgpICYmIHRoaXMuZm9jdXMgKSB7CgkJCQkJdGhpcy5mb2N1cygpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNpbiIKCQl9LAoJCWJsdXI6IHsKCQkJdHJpZ2dlcjogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIHRoaXMgPT09IHNhZmVBY3RpdmVFbGVtZW50KCkgJiYgdGhpcy5ibHVyICkgewoJCQkJCXRoaXMuYmx1cigpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCQkJZGVsZWdhdGVUeXBlOiAiZm9jdXNvdXQiCgkJfSwKCQljbGljazogewoJCQkvLyBGb3IgY2hlY2tib3gsIGZpcmUgbmF0aXZlIGV2ZW50IHNvIGNoZWNrZWQgc3RhdGUgd2lsbCBiZSByaWdodAoJCQl0cmlnZ2VyOiBmdW5jdGlvbigpIHsKCQkJCWlmICggdGhpcy50eXBlID09PSAiY2hlY2tib3giICYmIHRoaXMuY2xpY2sgJiYgalF1ZXJ5Lm5vZGVOYW1lKCB0aGlzLCAiaW5wdXQiICkgKSB7CgkJCQkJdGhpcy5jbGljaygpOwoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfSwKCgkJCS8vIEZvciBjcm9zcy1icm93c2VyIGNvbnNpc3RlbmN5LCBkb24ndCBmaXJlIG5hdGl2ZSAuY2xpY2soKSBvbiBsaW5rcwoJCQlfZGVmYXVsdDogZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJcmV0dXJuIGpRdWVyeS5ub2RlTmFtZSggZXZlbnQudGFyZ2V0LCAiYSIgKTsKCQkJfQoJCX0sCgoJCWJlZm9yZXVubG9hZDogewoJCQlwb3N0RGlzcGF0Y2g6IGZ1bmN0aW9uKCBldmVudCApIHsKCgkJCQkvLyBTdXBwb3J0OiBGaXJlZm94IDIwKwoJCQkJLy8gRmlyZWZveCBkb2Vzbid0IGFsZXJ0IGlmIHRoZSByZXR1cm5WYWx1ZSBmaWVsZCBpcyBub3Qgc2V0LgoJCQkJaWYgKCBldmVudC5yZXN1bHQgIT09IHVuZGVmaW5lZCAmJiBldmVudC5vcmlnaW5hbEV2ZW50ICkgewoJCQkJCWV2ZW50Lm9yaWdpbmFsRXZlbnQucmV0dXJuVmFsdWUgPSBldmVudC5yZXN1bHQ7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCXNpbXVsYXRlOiBmdW5jdGlvbiggdHlwZSwgZWxlbSwgZXZlbnQsIGJ1YmJsZSApIHsKCQkvLyBQaWdneWJhY2sgb24gYSBkb25vciBldmVudCB0byBzaW11bGF0ZSBhIGRpZmZlcmVudCBvbmUuCgkJLy8gRmFrZSBvcmlnaW5hbEV2ZW50IHRvIGF2b2lkIGRvbm9yJ3Mgc3RvcFByb3BhZ2F0aW9uLCBidXQgaWYgdGhlCgkJLy8gc2ltdWxhdGVkIGV2ZW50IHByZXZlbnRzIGRlZmF1bHQgdGhlbiB3ZSBkbyB0aGUgc2FtZSBvbiB0aGUgZG9ub3IuCgkJdmFyIGUgPSBqUXVlcnkuZXh0ZW5kKAoJCQluZXcgalF1ZXJ5LkV2ZW50KCksCgkJCWV2ZW50LAoJCQl7CgkJCQl0eXBlOiB0eXBlLAoJCQkJaXNTaW11bGF0ZWQ6IHRydWUsCgkJCQlvcmlnaW5hbEV2ZW50OiB7fQoJCQl9CgkJKTsKCQlpZiAoIGJ1YmJsZSApIHsKCQkJalF1ZXJ5LmV2ZW50LnRyaWdnZXIoIGUsIG51bGwsIGVsZW0gKTsKCQl9IGVsc2UgewoJCQlqUXVlcnkuZXZlbnQuZGlzcGF0Y2guY2FsbCggZWxlbSwgZSApOwoJCX0KCQlpZiAoIGUuaXNEZWZhdWx0UHJldmVudGVkKCkgKSB7CgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgkJfQoJfQp9OwoKalF1ZXJ5LnJlbW92ZUV2ZW50ID0gZnVuY3Rpb24oIGVsZW0sIHR5cGUsIGhhbmRsZSApIHsKCWlmICggZWxlbS5yZW1vdmVFdmVudExpc3RlbmVyICkgewoJCWVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lciggdHlwZSwgaGFuZGxlLCBmYWxzZSApOwoJfQp9OwoKalF1ZXJ5LkV2ZW50ID0gZnVuY3Rpb24oIHNyYywgcHJvcHMgKSB7CgkvLyBBbGxvdyBpbnN0YW50aWF0aW9uIHdpdGhvdXQgdGhlICduZXcnIGtleXdvcmQKCWlmICggISh0aGlzIGluc3RhbmNlb2YgalF1ZXJ5LkV2ZW50KSApIHsKCQlyZXR1cm4gbmV3IGpRdWVyeS5FdmVudCggc3JjLCBwcm9wcyApOwoJfQoKCS8vIEV2ZW50IG9iamVjdAoJaWYgKCBzcmMgJiYgc3JjLnR5cGUgKSB7CgkJdGhpcy5vcmlnaW5hbEV2ZW50ID0gc3JjOwoJCXRoaXMudHlwZSA9IHNyYy50eXBlOwoKCQkvLyBFdmVudHMgYnViYmxpbmcgdXAgdGhlIGRvY3VtZW50IG1heSBoYXZlIGJlZW4gbWFya2VkIGFzIHByZXZlbnRlZAoJCS8vIGJ5IGEgaGFuZGxlciBsb3dlciBkb3duIHRoZSB0cmVlOyByZWZsZWN0IHRoZSBjb3JyZWN0IHZhbHVlLgoJCXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gc3JjLmRlZmF1bHRQcmV2ZW50ZWQgfHwKCQkJCXNyYy5kZWZhdWx0UHJldmVudGVkID09PSB1bmRlZmluZWQgJiYKCQkJCS8vIFN1cHBvcnQ6IEFuZHJvaWQ8NC4wCgkJCQlzcmMucmV0dXJuVmFsdWUgPT09IGZhbHNlID8KCQkJcmV0dXJuVHJ1ZSA6CgkJCXJldHVybkZhbHNlOwoKCS8vIEV2ZW50IHR5cGUKCX0gZWxzZSB7CgkJdGhpcy50eXBlID0gc3JjOwoJfQoKCS8vIFB1dCBleHBsaWNpdGx5IHByb3ZpZGVkIHByb3BlcnRpZXMgb250byB0aGUgZXZlbnQgb2JqZWN0CglpZiAoIHByb3BzICkgewoJCWpRdWVyeS5leHRlbmQoIHRoaXMsIHByb3BzICk7Cgl9CgoJLy8gQ3JlYXRlIGEgdGltZXN0YW1wIGlmIGluY29taW5nIGV2ZW50IGRvZXNuJ3QgaGF2ZSBvbmUKCXRoaXMudGltZVN0YW1wID0gc3JjICYmIHNyYy50aW1lU3RhbXAgfHwgalF1ZXJ5Lm5vdygpOwoKCS8vIE1hcmsgaXQgYXMgZml4ZWQKCXRoaXNbIGpRdWVyeS5leHBhbmRvIF0gPSB0cnVlOwp9OwoKLy8galF1ZXJ5LkV2ZW50IGlzIGJhc2VkIG9uIERPTTMgRXZlbnRzIGFzIHNwZWNpZmllZCBieSB0aGUgRUNNQVNjcmlwdCBMYW5ndWFnZSBCaW5kaW5nCi8vIGh0dHA6Ly93d3cudzMub3JnL1RSLzIwMDMvV0QtRE9NLUxldmVsLTMtRXZlbnRzLTIwMDMwMzMxL2VjbWEtc2NyaXB0LWJpbmRpbmcuaHRtbApqUXVlcnkuRXZlbnQucHJvdG90eXBlID0gewoJaXNEZWZhdWx0UHJldmVudGVkOiByZXR1cm5GYWxzZSwKCWlzUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKCWlzSW1tZWRpYXRlUHJvcGFnYXRpb25TdG9wcGVkOiByZXR1cm5GYWxzZSwKCglwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24oKSB7CgkJdmFyIGUgPSB0aGlzLm9yaWdpbmFsRXZlbnQ7CgoJCXRoaXMuaXNEZWZhdWx0UHJldmVudGVkID0gcmV0dXJuVHJ1ZTsKCgkJaWYgKCBlICYmIGUucHJldmVudERlZmF1bHQgKSB7CgkJCWUucHJldmVudERlZmF1bHQoKTsKCQl9Cgl9LAoJc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc1Byb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCWlmICggZSAmJiBlLnN0b3BQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wUHJvcGFnYXRpb24oKTsKCQl9Cgl9LAoJc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uOiBmdW5jdGlvbigpIHsKCQl2YXIgZSA9IHRoaXMub3JpZ2luYWxFdmVudDsKCgkJdGhpcy5pc0ltbWVkaWF0ZVByb3BhZ2F0aW9uU3RvcHBlZCA9IHJldHVyblRydWU7CgoJCWlmICggZSAmJiBlLnN0b3BJbW1lZGlhdGVQcm9wYWdhdGlvbiApIHsKCQkJZS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKTsKCQl9CgoJCXRoaXMuc3RvcFByb3BhZ2F0aW9uKCk7Cgl9Cn07CgovLyBDcmVhdGUgbW91c2VlbnRlci9sZWF2ZSBldmVudHMgdXNpbmcgbW91c2VvdmVyL291dCBhbmQgZXZlbnQtdGltZSBjaGVja3MKLy8gU3VwcG9ydDogQ2hyb21lIDE1KwpqUXVlcnkuZWFjaCh7Cgltb3VzZWVudGVyOiAibW91c2VvdmVyIiwKCW1vdXNlbGVhdmU6ICJtb3VzZW91dCIsCglwb2ludGVyZW50ZXI6ICJwb2ludGVyb3ZlciIsCglwb2ludGVybGVhdmU6ICJwb2ludGVyb3V0Igp9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoJalF1ZXJ5LmV2ZW50LnNwZWNpYWxbIG9yaWcgXSA9IHsKCQlkZWxlZ2F0ZVR5cGU6IGZpeCwKCQliaW5kVHlwZTogZml4LAoKCQloYW5kbGU6IGZ1bmN0aW9uKCBldmVudCApIHsKCQkJdmFyIHJldCwKCQkJCXRhcmdldCA9IHRoaXMsCgkJCQlyZWxhdGVkID0gZXZlbnQucmVsYXRlZFRhcmdldCwKCQkJCWhhbmRsZU9iaiA9IGV2ZW50LmhhbmRsZU9iajsKCgkJCS8vIEZvciBtb3VzZW50ZXIvbGVhdmUgY2FsbCB0aGUgaGFuZGxlciBpZiByZWxhdGVkIGlzIG91dHNpZGUgdGhlIHRhcmdldC4KCQkJLy8gTkI6IE5vIHJlbGF0ZWRUYXJnZXQgaWYgdGhlIG1vdXNlIGxlZnQvZW50ZXJlZCB0aGUgYnJvd3NlciB3aW5kb3cKCQkJaWYgKCAhcmVsYXRlZCB8fCAocmVsYXRlZCAhPT0gdGFyZ2V0ICYmICFqUXVlcnkuY29udGFpbnMoIHRhcmdldCwgcmVsYXRlZCApKSApIHsKCQkJCWV2ZW50LnR5cGUgPSBoYW5kbGVPYmoub3JpZ1R5cGU7CgkJCQlyZXQgPSBoYW5kbGVPYmouaGFuZGxlci5hcHBseSggdGhpcywgYXJndW1lbnRzICk7CgkJCQlldmVudC50eXBlID0gZml4OwoJCQl9CgkJCXJldHVybiByZXQ7CgkJfQoJfTsKfSk7CgovLyBTdXBwb3J0OiBGaXJlZm94LCBDaHJvbWUsIFNhZmFyaQovLyBDcmVhdGUgImJ1YmJsaW5nIiBmb2N1cyBhbmQgYmx1ciBldmVudHMKaWYgKCAhc3VwcG9ydC5mb2N1c2luQnViYmxlcyApIHsKCWpRdWVyeS5lYWNoKHsgZm9jdXM6ICJmb2N1c2luIiwgYmx1cjogImZvY3Vzb3V0IiB9LCBmdW5jdGlvbiggb3JpZywgZml4ICkgewoKCQkvLyBBdHRhY2ggYSBzaW5nbGUgY2FwdHVyaW5nIGhhbmRsZXIgb24gdGhlIGRvY3VtZW50IHdoaWxlIHNvbWVvbmUgd2FudHMgZm9jdXNpbi9mb2N1c291dAoJCXZhciBoYW5kbGVyID0gZnVuY3Rpb24oIGV2ZW50ICkgewoJCQkJalF1ZXJ5LmV2ZW50LnNpbXVsYXRlKCBmaXgsIGV2ZW50LnRhcmdldCwgalF1ZXJ5LmV2ZW50LmZpeCggZXZlbnQgKSwgdHJ1ZSApOwoJCQl9OwoKCQlqUXVlcnkuZXZlbnQuc3BlY2lhbFsgZml4IF0gPSB7CgkJCXNldHVwOiBmdW5jdGlvbigpIHsKCQkJCXZhciBkb2MgPSB0aGlzLm93bmVyRG9jdW1lbnQgfHwgdGhpcywKCQkJCQlhdHRhY2hlcyA9IGRhdGFfcHJpdi5hY2Nlc3MoIGRvYywgZml4ICk7CgoJCQkJaWYgKCAhYXR0YWNoZXMgKSB7CgkJCQkJZG9jLmFkZEV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCX0KCQkJCWRhdGFfcHJpdi5hY2Nlc3MoIGRvYywgZml4LCAoIGF0dGFjaGVzIHx8IDAgKSArIDEgKTsKCQkJfSwKCQkJdGVhcmRvd246IGZ1bmN0aW9uKCkgewoJCQkJdmFyIGRvYyA9IHRoaXMub3duZXJEb2N1bWVudCB8fCB0aGlzLAoJCQkJCWF0dGFjaGVzID0gZGF0YV9wcml2LmFjY2VzcyggZG9jLCBmaXggKSAtIDE7CgoJCQkJaWYgKCAhYXR0YWNoZXMgKSB7CgkJCQkJZG9jLnJlbW92ZUV2ZW50TGlzdGVuZXIoIG9yaWcsIGhhbmRsZXIsIHRydWUgKTsKCQkJCQlkYXRhX3ByaXYucmVtb3ZlKCBkb2MsIGZpeCApOwoKCQkJCX0gZWxzZSB7CgkJCQkJZGF0YV9wcml2LmFjY2VzcyggZG9jLCBmaXgsIGF0dGFjaGVzICk7CgkJCQl9CgkJCX0KCQl9OwoJfSk7Cn0KCmpRdWVyeS5mbi5leHRlbmQoewoKCW9uOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBkYXRhLCBmbiwgLypJTlRFUk5BTCovIG9uZSApIHsKCQl2YXIgb3JpZ0ZuLCB0eXBlOwoKCQkvLyBUeXBlcyBjYW4gYmUgYSBtYXAgb2YgdHlwZXMvaGFuZGxlcnMKCQlpZiAoIHR5cGVvZiB0eXBlcyA9PT0gIm9iamVjdCIgKSB7CgkJCS8vICggdHlwZXMtT2JqZWN0LCBzZWxlY3RvciwgZGF0YSApCgkJCWlmICggdHlwZW9mIHNlbGVjdG9yICE9PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMtT2JqZWN0LCBkYXRhICkKCQkJCWRhdGEgPSBkYXRhIHx8IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub24oIHR5cGUsIHNlbGVjdG9yLCBkYXRhLCB0eXBlc1sgdHlwZSBdLCBvbmUgKTsKCQkJfQoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggZGF0YSA9PSBudWxsICYmIGZuID09IG51bGwgKSB7CgkJCS8vICggdHlwZXMsIGZuICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJZGF0YSA9IHNlbGVjdG9yID0gdW5kZWZpbmVkOwoJCX0gZWxzZSBpZiAoIGZuID09IG51bGwgKSB7CgkJCWlmICggdHlwZW9mIHNlbGVjdG9yID09PSAic3RyaW5nIiApIHsKCQkJCS8vICggdHlwZXMsIHNlbGVjdG9yLCBmbiApCgkJCQlmbiA9IGRhdGE7CgkJCQlkYXRhID0gdW5kZWZpbmVkOwoJCQl9IGVsc2UgewoJCQkJLy8gKCB0eXBlcywgZGF0YSwgZm4gKQoJCQkJZm4gPSBkYXRhOwoJCQkJZGF0YSA9IHNlbGVjdG9yOwoJCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJCX0KCQl9CgkJaWYgKCBmbiA9PT0gZmFsc2UgKSB7CgkJCWZuID0gcmV0dXJuRmFsc2U7CgkJfSBlbHNlIGlmICggIWZuICkgewoJCQlyZXR1cm4gdGhpczsKCQl9CgoJCWlmICggb25lID09PSAxICkgewoJCQlvcmlnRm4gPSBmbjsKCQkJZm4gPSBmdW5jdGlvbiggZXZlbnQgKSB7CgkJCQkvLyBDYW4gdXNlIGFuIGVtcHR5IHNldCwgc2luY2UgZXZlbnQgY29udGFpbnMgdGhlIGluZm8KCQkJCWpRdWVyeSgpLm9mZiggZXZlbnQgKTsKCQkJCXJldHVybiBvcmlnRm4uYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCQl9OwoJCQkvLyBVc2Ugc2FtZSBndWlkIHNvIGNhbGxlciBjYW4gcmVtb3ZlIHVzaW5nIG9yaWdGbgoJCQlmbi5ndWlkID0gb3JpZ0ZuLmd1aWQgfHwgKCBvcmlnRm4uZ3VpZCA9IGpRdWVyeS5ndWlkKysgKTsKCQl9CgkJcmV0dXJuIHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC5hZGQoIHRoaXMsIHR5cGVzLCBmbiwgZGF0YSwgc2VsZWN0b3IgKTsKCQl9KTsKCX0sCglvbmU6IGZ1bmN0aW9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuLCAxICk7Cgl9LAoJb2ZmOiBmdW5jdGlvbiggdHlwZXMsIHNlbGVjdG9yLCBmbiApIHsKCQl2YXIgaGFuZGxlT2JqLCB0eXBlOwoJCWlmICggdHlwZXMgJiYgdHlwZXMucHJldmVudERlZmF1bHQgJiYgdHlwZXMuaGFuZGxlT2JqICkgewoJCQkvLyAoIGV2ZW50ICkgIGRpc3BhdGNoZWQgalF1ZXJ5LkV2ZW50CgkJCWhhbmRsZU9iaiA9IHR5cGVzLmhhbmRsZU9iajsKCQkJalF1ZXJ5KCB0eXBlcy5kZWxlZ2F0ZVRhcmdldCApLm9mZigKCQkJCWhhbmRsZU9iai5uYW1lc3BhY2UgPyBoYW5kbGVPYmoub3JpZ1R5cGUgKyAiLiIgKyBoYW5kbGVPYmoubmFtZXNwYWNlIDogaGFuZGxlT2JqLm9yaWdUeXBlLAoJCQkJaGFuZGxlT2JqLnNlbGVjdG9yLAoJCQkJaGFuZGxlT2JqLmhhbmRsZXIKCQkJKTsKCQkJcmV0dXJuIHRoaXM7CgkJfQoJCWlmICggdHlwZW9mIHR5cGVzID09PSAib2JqZWN0IiApIHsKCQkJLy8gKCB0eXBlcy1vYmplY3QgWywgc2VsZWN0b3JdICkKCQkJZm9yICggdHlwZSBpbiB0eXBlcyApIHsKCQkJCXRoaXMub2ZmKCB0eXBlLCBzZWxlY3RvciwgdHlwZXNbIHR5cGUgXSApOwoJCQl9CgkJCXJldHVybiB0aGlzOwoJCX0KCQlpZiAoIHNlbGVjdG9yID09PSBmYWxzZSB8fCB0eXBlb2Ygc2VsZWN0b3IgPT09ICJmdW5jdGlvbiIgKSB7CgkJCS8vICggdHlwZXMgWywgZm5dICkKCQkJZm4gPSBzZWxlY3RvcjsKCQkJc2VsZWN0b3IgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggZm4gPT09IGZhbHNlICkgewoJCQlmbiA9IHJldHVybkZhbHNlOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCB0aGlzLCB0eXBlcywgZm4sIHNlbGVjdG9yICk7CgkJfSk7Cgl9LAoKCXRyaWdnZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWpRdWVyeS5ldmVudC50cmlnZ2VyKCB0eXBlLCBkYXRhLCB0aGlzICk7CgkJfSk7Cgl9LAoJdHJpZ2dlckhhbmRsZXI6IGZ1bmN0aW9uKCB0eXBlLCBkYXRhICkgewoJCXZhciBlbGVtID0gdGhpc1swXTsKCQlpZiAoIGVsZW0gKSB7CgkJCXJldHVybiBqUXVlcnkuZXZlbnQudHJpZ2dlciggdHlwZSwgZGF0YSwgZWxlbSwgdHJ1ZSApOwoJCX0KCX0KfSk7CgoKdmFyCglyeGh0bWxUYWcgPSAvPCg/IWFyZWF8YnJ8Y29sfGVtYmVkfGhyfGltZ3xpbnB1dHxsaW5rfG1ldGF8cGFyYW0pKChbXHc6XSspW14+XSopXC8+L2dpLAoJcnRhZ05hbWUgPSAvPChbXHc6XSspLywKCXJodG1sID0gLzx8JiM/XHcrOy8sCglybm9Jbm5lcmh0bWwgPSAvPCg/OnNjcmlwdHxzdHlsZXxsaW5rKS9pLAoJLy8gY2hlY2tlZD0iY2hlY2tlZCIgb3IgY2hlY2tlZAoJcmNoZWNrZWQgPSAvY2hlY2tlZFxzKig/OltePV18PVxzKi5jaGVja2VkLikvaSwKCXJzY3JpcHRUeXBlID0gL14kfFwvKD86amF2YXxlY21hKXNjcmlwdC9pLAoJcnNjcmlwdFR5cGVNYXNrZWQgPSAvXnRydWVcLyguKikvLAoJcmNsZWFuU2NyaXB0ID0gL15ccyo8ISg/OlxbQ0RBVEFcW3wtLSl8KD86XF1cXXwtLSk+XHMqJC9nLAoKCS8vIFdlIGhhdmUgdG8gY2xvc2UgdGhlc2UgdGFncyB0byBzdXBwb3J0IFhIVE1MICgjMTMyMDApCgl3cmFwTWFwID0gewoKCQkvLyBTdXBwb3J0OiBJRTkKCQlvcHRpb246IFsgMSwgIjxzZWxlY3QgbXVsdGlwbGU9J211bHRpcGxlJz4iLCAiPC9zZWxlY3Q+IiBdLAoKCQl0aGVhZDogWyAxLCAiPHRhYmxlPiIsICI8L3RhYmxlPiIgXSwKCQljb2w6IFsgMiwgIjx0YWJsZT48Y29sZ3JvdXA+IiwgIjwvY29sZ3JvdXA+PC90YWJsZT4iIF0sCgkJdHI6IFsgMiwgIjx0YWJsZT48dGJvZHk+IiwgIjwvdGJvZHk+PC90YWJsZT4iIF0sCgkJdGQ6IFsgMywgIjx0YWJsZT48dGJvZHk+PHRyPiIsICI8L3RyPjwvdGJvZHk+PC90YWJsZT4iIF0sCgoJCV9kZWZhdWx0OiBbIDAsICIiLCAiIiBdCgl9OwoKLy8gU3VwcG9ydDogSUU5CndyYXBNYXAub3B0Z3JvdXAgPSB3cmFwTWFwLm9wdGlvbjsKCndyYXBNYXAudGJvZHkgPSB3cmFwTWFwLnRmb290ID0gd3JhcE1hcC5jb2xncm91cCA9IHdyYXBNYXAuY2FwdGlvbiA9IHdyYXBNYXAudGhlYWQ7CndyYXBNYXAudGggPSB3cmFwTWFwLnRkOwoKLy8gU3VwcG9ydDogMS54IGNvbXBhdGliaWxpdHkKLy8gTWFuaXB1bGF0aW5nIHRhYmxlcyByZXF1aXJlcyBhIHRib2R5CmZ1bmN0aW9uIG1hbmlwdWxhdGlvblRhcmdldCggZWxlbSwgY29udGVudCApIHsKCXJldHVybiBqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJ0YWJsZSIgKSAmJgoJCWpRdWVyeS5ub2RlTmFtZSggY29udGVudC5ub2RlVHlwZSAhPT0gMTEgPyBjb250ZW50IDogY29udGVudC5maXJzdENoaWxkLCAidHIiICkgPwoKCQllbGVtLmdldEVsZW1lbnRzQnlUYWdOYW1lKCJ0Ym9keSIpWzBdIHx8CgkJCWVsZW0uYXBwZW5kQ2hpbGQoIGVsZW0ub3duZXJEb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0Ym9keSIpICkgOgoJCWVsZW07Cn0KCi8vIFJlcGxhY2UvcmVzdG9yZSB0aGUgdHlwZSBhdHRyaWJ1dGUgb2Ygc2NyaXB0IGVsZW1lbnRzIGZvciBzYWZlIERPTSBtYW5pcHVsYXRpb24KZnVuY3Rpb24gZGlzYWJsZVNjcmlwdCggZWxlbSApIHsKCWVsZW0udHlwZSA9IChlbGVtLmdldEF0dHJpYnV0ZSgidHlwZSIpICE9PSBudWxsKSArICIvIiArIGVsZW0udHlwZTsKCXJldHVybiBlbGVtOwp9CmZ1bmN0aW9uIHJlc3RvcmVTY3JpcHQoIGVsZW0gKSB7Cgl2YXIgbWF0Y2ggPSByc2NyaXB0VHlwZU1hc2tlZC5leGVjKCBlbGVtLnR5cGUgKTsKCglpZiAoIG1hdGNoICkgewoJCWVsZW0udHlwZSA9IG1hdGNoWyAxIF07Cgl9IGVsc2UgewoJCWVsZW0ucmVtb3ZlQXR0cmlidXRlKCJ0eXBlIik7Cgl9CgoJcmV0dXJuIGVsZW07Cn0KCi8vIE1hcmsgc2NyaXB0cyBhcyBoYXZpbmcgYWxyZWFkeSBiZWVuIGV2YWx1YXRlZApmdW5jdGlvbiBzZXRHbG9iYWxFdmFsKCBlbGVtcywgcmVmRWxlbWVudHMgKSB7Cgl2YXIgaSA9IDAsCgkJbCA9IGVsZW1zLmxlbmd0aDsKCglmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJZGF0YV9wcml2LnNldCgKCQkJZWxlbXNbIGkgXSwgImdsb2JhbEV2YWwiLCAhcmVmRWxlbWVudHMgfHwgZGF0YV9wcml2LmdldCggcmVmRWxlbWVudHNbIGkgXSwgImdsb2JhbEV2YWwiICkKCQkpOwoJfQp9CgpmdW5jdGlvbiBjbG9uZUNvcHlFdmVudCggc3JjLCBkZXN0ICkgewoJdmFyIGksIGwsIHR5cGUsIHBkYXRhT2xkLCBwZGF0YUN1ciwgdWRhdGFPbGQsIHVkYXRhQ3VyLCBldmVudHM7CgoJaWYgKCBkZXN0Lm5vZGVUeXBlICE9PSAxICkgewoJCXJldHVybjsKCX0KCgkvLyAxLiBDb3B5IHByaXZhdGUgZGF0YTogZXZlbnRzLCBoYW5kbGVycywgZXRjLgoJaWYgKCBkYXRhX3ByaXYuaGFzRGF0YSggc3JjICkgKSB7CgkJcGRhdGFPbGQgPSBkYXRhX3ByaXYuYWNjZXNzKCBzcmMgKTsKCQlwZGF0YUN1ciA9IGRhdGFfcHJpdi5zZXQoIGRlc3QsIHBkYXRhT2xkICk7CgkJZXZlbnRzID0gcGRhdGFPbGQuZXZlbnRzOwoKCQlpZiAoIGV2ZW50cyApIHsKCQkJZGVsZXRlIHBkYXRhQ3VyLmhhbmRsZTsKCQkJcGRhdGFDdXIuZXZlbnRzID0ge307CgoJCQlmb3IgKCB0eXBlIGluIGV2ZW50cyApIHsKCQkJCWZvciAoIGkgPSAwLCBsID0gZXZlbnRzWyB0eXBlIF0ubGVuZ3RoOyBpIDwgbDsgaSsrICkgewoJCQkJCWpRdWVyeS5ldmVudC5hZGQoIGRlc3QsIHR5cGUsIGV2ZW50c1sgdHlwZSBdWyBpIF0gKTsKCQkJCX0KCQkJfQoJCX0KCX0KCgkvLyAyLiBDb3B5IHVzZXIgZGF0YQoJaWYgKCBkYXRhX3VzZXIuaGFzRGF0YSggc3JjICkgKSB7CgkJdWRhdGFPbGQgPSBkYXRhX3VzZXIuYWNjZXNzKCBzcmMgKTsKCQl1ZGF0YUN1ciA9IGpRdWVyeS5leHRlbmQoIHt9LCB1ZGF0YU9sZCApOwoKCQlkYXRhX3VzZXIuc2V0KCBkZXN0LCB1ZGF0YUN1ciApOwoJfQp9CgpmdW5jdGlvbiBnZXRBbGwoIGNvbnRleHQsIHRhZyApIHsKCXZhciByZXQgPSBjb250ZXh0LmdldEVsZW1lbnRzQnlUYWdOYW1lID8gY29udGV4dC5nZXRFbGVtZW50c0J5VGFnTmFtZSggdGFnIHx8ICIqIiApIDoKCQkJY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsID8gY29udGV4dC5xdWVyeVNlbGVjdG9yQWxsKCB0YWcgfHwgIioiICkgOgoJCQlbXTsKCglyZXR1cm4gdGFnID09PSB1bmRlZmluZWQgfHwgdGFnICYmIGpRdWVyeS5ub2RlTmFtZSggY29udGV4dCwgdGFnICkgPwoJCWpRdWVyeS5tZXJnZSggWyBjb250ZXh0IF0sIHJldCApIDoKCQlyZXQ7Cn0KCi8vIEZpeCBJRSBidWdzLCBzZWUgc3VwcG9ydCB0ZXN0cwpmdW5jdGlvbiBmaXhJbnB1dCggc3JjLCBkZXN0ICkgewoJdmFyIG5vZGVOYW1lID0gZGVzdC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpOwoKCS8vIEZhaWxzIHRvIHBlcnNpc3QgdGhlIGNoZWNrZWQgc3RhdGUgb2YgYSBjbG9uZWQgY2hlY2tib3ggb3IgcmFkaW8gYnV0dG9uLgoJaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiAmJiByY2hlY2thYmxlVHlwZS50ZXN0KCBzcmMudHlwZSApICkgewoJCWRlc3QuY2hlY2tlZCA9IHNyYy5jaGVja2VkOwoKCS8vIEZhaWxzIHRvIHJldHVybiB0aGUgc2VsZWN0ZWQgb3B0aW9uIHRvIHRoZSBkZWZhdWx0IHNlbGVjdGVkIHN0YXRlIHdoZW4gY2xvbmluZyBvcHRpb25zCgl9IGVsc2UgaWYgKCBub2RlTmFtZSA9PT0gImlucHV0IiB8fCBub2RlTmFtZSA9PT0gInRleHRhcmVhIiApIHsKCQlkZXN0LmRlZmF1bHRWYWx1ZSA9IHNyYy5kZWZhdWx0VmFsdWU7Cgl9Cn0KCmpRdWVyeS5leHRlbmQoewoJY2xvbmU6IGZ1bmN0aW9uKCBlbGVtLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQl2YXIgaSwgbCwgc3JjRWxlbWVudHMsIGRlc3RFbGVtZW50cywKCQkJY2xvbmUgPSBlbGVtLmNsb25lTm9kZSggdHJ1ZSApLAoJCQlpblBhZ2UgPSBqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApOwoKCQkvLyBGaXggSUUgY2xvbmluZyBpc3N1ZXMKCQlpZiAoICFzdXBwb3J0Lm5vQ2xvbmVDaGVja2VkICYmICggZWxlbS5ub2RlVHlwZSA9PT0gMSB8fCBlbGVtLm5vZGVUeXBlID09PSAxMSApICYmCgkJCQkhalF1ZXJ5LmlzWE1MRG9jKCBlbGVtICkgKSB7CgoJCQkvLyBXZSBlc2NoZXcgU2l6emxlIGhlcmUgZm9yIHBlcmZvcm1hbmNlIHJlYXNvbnM6IGh0dHA6Ly9qc3BlcmYuY29tL2dldGFsbC12cy1zaXp6bGUvMgoJCQlkZXN0RWxlbWVudHMgPSBnZXRBbGwoIGNsb25lICk7CgkJCXNyY0VsZW1lbnRzID0gZ2V0QWxsKCBlbGVtICk7CgoJCQlmb3IgKCBpID0gMCwgbCA9IHNyY0VsZW1lbnRzLmxlbmd0aDsgaSA8IGw7IGkrKyApIHsKCQkJCWZpeElucHV0KCBzcmNFbGVtZW50c1sgaSBdLCBkZXN0RWxlbWVudHNbIGkgXSApOwoJCQl9CgkJfQoKCQkvLyBDb3B5IHRoZSBldmVudHMgZnJvbSB0aGUgb3JpZ2luYWwgdG8gdGhlIGNsb25lCgkJaWYgKCBkYXRhQW5kRXZlbnRzICkgewoJCQlpZiAoIGRlZXBEYXRhQW5kRXZlbnRzICkgewoJCQkJc3JjRWxlbWVudHMgPSBzcmNFbGVtZW50cyB8fCBnZXRBbGwoIGVsZW0gKTsKCQkJCWRlc3RFbGVtZW50cyA9IGRlc3RFbGVtZW50cyB8fCBnZXRBbGwoIGNsb25lICk7CgoJCQkJZm9yICggaSA9IDAsIGwgPSBzcmNFbGVtZW50cy5sZW5ndGg7IGkgPCBsOyBpKysgKSB7CgkJCQkJY2xvbmVDb3B5RXZlbnQoIHNyY0VsZW1lbnRzWyBpIF0sIGRlc3RFbGVtZW50c1sgaSBdICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQljbG9uZUNvcHlFdmVudCggZWxlbSwgY2xvbmUgKTsKCQkJfQoJCX0KCgkJLy8gUHJlc2VydmUgc2NyaXB0IGV2YWx1YXRpb24gaGlzdG9yeQoJCWRlc3RFbGVtZW50cyA9IGdldEFsbCggY2xvbmUsICJzY3JpcHQiICk7CgkJaWYgKCBkZXN0RWxlbWVudHMubGVuZ3RoID4gMCApIHsKCQkJc2V0R2xvYmFsRXZhbCggZGVzdEVsZW1lbnRzLCAhaW5QYWdlICYmIGdldEFsbCggZWxlbSwgInNjcmlwdCIgKSApOwoJCX0KCgkJLy8gUmV0dXJuIHRoZSBjbG9uZWQgc2V0CgkJcmV0dXJuIGNsb25lOwoJfSwKCglidWlsZEZyYWdtZW50OiBmdW5jdGlvbiggZWxlbXMsIGNvbnRleHQsIHNjcmlwdHMsIHNlbGVjdGlvbiApIHsKCQl2YXIgZWxlbSwgdG1wLCB0YWcsIHdyYXAsIGNvbnRhaW5zLCBqLAoJCQlmcmFnbWVudCA9IGNvbnRleHQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpLAoJCQlub2RlcyA9IFtdLAoJCQlpID0gMCwKCQkJbCA9IGVsZW1zLmxlbmd0aDsKCgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQllbGVtID0gZWxlbXNbIGkgXTsKCgkJCWlmICggZWxlbSB8fCBlbGVtID09PSAwICkgewoKCQkJCS8vIEFkZCBub2RlcyBkaXJlY3RseQoJCQkJaWYgKCBqUXVlcnkudHlwZSggZWxlbSApID09PSAib2JqZWN0IiApIHsKCQkJCQkvLyBTdXBwb3J0OiBRdFdlYktpdCwgUGhhbnRvbUpTCgkJCQkJLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAoJCQkJCWpRdWVyeS5tZXJnZSggbm9kZXMsIGVsZW0ubm9kZVR5cGUgPyBbIGVsZW0gXSA6IGVsZW0gKTsKCgkJCQkvLyBDb252ZXJ0IG5vbi1odG1sIGludG8gYSB0ZXh0IG5vZGUKCQkJCX0gZWxzZSBpZiAoICFyaHRtbC50ZXN0KCBlbGVtICkgKSB7CgkJCQkJbm9kZXMucHVzaCggY29udGV4dC5jcmVhdGVUZXh0Tm9kZSggZWxlbSApICk7CgoJCQkJLy8gQ29udmVydCBodG1sIGludG8gRE9NIG5vZGVzCgkJCQl9IGVsc2UgewoJCQkJCXRtcCA9IHRtcCB8fCBmcmFnbWVudC5hcHBlbmRDaGlsZCggY29udGV4dC5jcmVhdGVFbGVtZW50KCJkaXYiKSApOwoKCQkJCQkvLyBEZXNlcmlhbGl6ZSBhIHN0YW5kYXJkIHJlcHJlc2VudGF0aW9uCgkJCQkJdGFnID0gKCBydGFnTmFtZS5leGVjKCBlbGVtICkgfHwgWyAiIiwgIiIgXSApWyAxIF0udG9Mb3dlckNhc2UoKTsKCQkJCQl3cmFwID0gd3JhcE1hcFsgdGFnIF0gfHwgd3JhcE1hcC5fZGVmYXVsdDsKCQkJCQl0bXAuaW5uZXJIVE1MID0gd3JhcFsgMSBdICsgZWxlbS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICkgKyB3cmFwWyAyIF07CgoJCQkJCS8vIERlc2NlbmQgdGhyb3VnaCB3cmFwcGVycyB0byB0aGUgcmlnaHQgY29udGVudAoJCQkJCWogPSB3cmFwWyAwIF07CgkJCQkJd2hpbGUgKCBqLS0gKSB7CgkJCQkJCXRtcCA9IHRtcC5sYXN0Q2hpbGQ7CgkJCQkJfQoKCQkJCQkvLyBTdXBwb3J0OiBRdFdlYktpdCwgUGhhbnRvbUpTCgkJCQkJLy8gcHVzaC5hcHBseShfLCBhcnJheWxpa2UpIHRocm93cyBvbiBhbmNpZW50IFdlYktpdAoJCQkJCWpRdWVyeS5tZXJnZSggbm9kZXMsIHRtcC5jaGlsZE5vZGVzICk7CgoJCQkJCS8vIFJlbWVtYmVyIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyCgkJCQkJdG1wID0gZnJhZ21lbnQuZmlyc3RDaGlsZDsKCgkJCQkJLy8gRW5zdXJlIHRoZSBjcmVhdGVkIG5vZGVzIGFyZSBvcnBoYW5lZCAoIzEyMzkyKQoJCQkJCXRtcC50ZXh0Q29udGVudCA9ICIiOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBSZW1vdmUgd3JhcHBlciBmcm9tIGZyYWdtZW50CgkJZnJhZ21lbnQudGV4dENvbnRlbnQgPSAiIjsKCgkJaSA9IDA7CgkJd2hpbGUgKCAoZWxlbSA9IG5vZGVzWyBpKysgXSkgKSB7CgoJCQkvLyAjNDA4NyAtIElmIG9yaWdpbiBhbmQgZGVzdGluYXRpb24gZWxlbWVudHMgYXJlIHRoZSBzYW1lLCBhbmQgdGhpcyBpcwoJCQkvLyB0aGF0IGVsZW1lbnQsIGRvIG5vdCBkbyBhbnl0aGluZwoJCQlpZiAoIHNlbGVjdGlvbiAmJiBqUXVlcnkuaW5BcnJheSggZWxlbSwgc2VsZWN0aW9uICkgIT09IC0xICkgewoJCQkJY29udGludWU7CgkJCX0KCgkJCWNvbnRhaW5zID0galF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKTsKCgkJCS8vIEFwcGVuZCB0byBmcmFnbWVudAoJCQl0bXAgPSBnZXRBbGwoIGZyYWdtZW50LmFwcGVuZENoaWxkKCBlbGVtICksICJzY3JpcHQiICk7CgoJCQkvLyBQcmVzZXJ2ZSBzY3JpcHQgZXZhbHVhdGlvbiBoaXN0b3J5CgkJCWlmICggY29udGFpbnMgKSB7CgkJCQlzZXRHbG9iYWxFdmFsKCB0bXAgKTsKCQkJfQoKCQkJLy8gQ2FwdHVyZSBleGVjdXRhYmxlcwoJCQlpZiAoIHNjcmlwdHMgKSB7CgkJCQlqID0gMDsKCQkJCXdoaWxlICggKGVsZW0gPSB0bXBbIGorKyBdKSApIHsKCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIGVsZW0udHlwZSB8fCAiIiApICkgewoJCQkJCQlzY3JpcHRzLnB1c2goIGVsZW0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCQl9CgoJCXJldHVybiBmcmFnbWVudDsKCX0sCgoJY2xlYW5EYXRhOiBmdW5jdGlvbiggZWxlbXMgKSB7CgkJdmFyIGRhdGEsIGVsZW0sIHR5cGUsIGtleSwKCQkJc3BlY2lhbCA9IGpRdWVyeS5ldmVudC5zcGVjaWFsLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zWyBpIF0pICE9PSB1bmRlZmluZWQ7IGkrKyApIHsKCQkJaWYgKCBqUXVlcnkuYWNjZXB0RGF0YSggZWxlbSApICkgewoJCQkJa2V5ID0gZWxlbVsgZGF0YV9wcml2LmV4cGFuZG8gXTsKCgkJCQlpZiAoIGtleSAmJiAoZGF0YSA9IGRhdGFfcHJpdi5jYWNoZVsga2V5IF0pICkgewoJCQkJCWlmICggZGF0YS5ldmVudHMgKSB7CgkJCQkJCWZvciAoIHR5cGUgaW4gZGF0YS5ldmVudHMgKSB7CgkJCQkJCQlpZiAoIHNwZWNpYWxbIHR5cGUgXSApIHsKCQkJCQkJCQlqUXVlcnkuZXZlbnQucmVtb3ZlKCBlbGVtLCB0eXBlICk7CgoJCQkJCQkJLy8gVGhpcyBpcyBhIHNob3J0Y3V0IHRvIGF2b2lkIGpRdWVyeS5ldmVudC5yZW1vdmUncyBvdmVyaGVhZAoJCQkJCQkJfSBlbHNlIHsKCQkJCQkJCQlqUXVlcnkucmVtb3ZlRXZlbnQoIGVsZW0sIHR5cGUsIGRhdGEuaGFuZGxlICk7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQkJaWYgKCBkYXRhX3ByaXYuY2FjaGVbIGtleSBdICkgewoJCQkJCQkvLyBEaXNjYXJkIGFueSByZW1haW5pbmcgYHByaXZhdGVgIGRhdGEKCQkJCQkJZGVsZXRlIGRhdGFfcHJpdi5jYWNoZVsga2V5IF07CgkJCQkJfQoJCQkJfQoJCQl9CgkJCS8vIERpc2NhcmQgYW55IHJlbWFpbmluZyBgdXNlcmAgZGF0YQoJCQlkZWxldGUgZGF0YV91c2VyLmNhY2hlWyBlbGVtWyBkYXRhX3VzZXIuZXhwYW5kbyBdIF07CgkJfQoJfQp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJdGV4dDogZnVuY3Rpb24oIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQkJcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnRleHQoIHRoaXMgKSA6CgkJCQl0aGlzLmVtcHR5KCkuZWFjaChmdW5jdGlvbigpIHsKCQkJCQlpZiAoIHRoaXMubm9kZVR5cGUgPT09IDEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gMTEgfHwgdGhpcy5ub2RlVHlwZSA9PT0gOSApIHsKCQkJCQkJdGhpcy50ZXh0Q29udGVudCA9IHZhbHVlOwoJCQkJCX0KCQkJCX0pOwoJCX0sIG51bGwsIHZhbHVlLCBhcmd1bWVudHMubGVuZ3RoICk7Cgl9LAoKCWFwcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJdGFyZ2V0LmFwcGVuZENoaWxkKCBlbGVtICk7CgkJCX0KCQl9KTsKCX0sCgoJcHJlcGVuZDogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5ub2RlVHlwZSA9PT0gMSB8fCB0aGlzLm5vZGVUeXBlID09PSAxMSB8fCB0aGlzLm5vZGVUeXBlID09PSA5ICkgewoJCQkJdmFyIHRhcmdldCA9IG1hbmlwdWxhdGlvblRhcmdldCggdGhpcywgZWxlbSApOwoJCQkJdGFyZ2V0Lmluc2VydEJlZm9yZSggZWxlbSwgdGFyZ2V0LmZpcnN0Q2hpbGQgKTsKCQkJfQoJCX0pOwoJfSwKCgliZWZvcmU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLmRvbU1hbmlwKCBhcmd1bWVudHMsIGZ1bmN0aW9uKCBlbGVtICkgewoJCQlpZiAoIHRoaXMucGFyZW50Tm9kZSApIHsKCQkJCXRoaXMucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoIGVsZW0sIHRoaXMgKTsKCQkJfQoJCX0pOwoJfSwKCglhZnRlcjogZnVuY3Rpb24oKSB7CgkJcmV0dXJuIHRoaXMuZG9tTWFuaXAoIGFyZ3VtZW50cywgZnVuY3Rpb24oIGVsZW0gKSB7CgkJCWlmICggdGhpcy5wYXJlbnROb2RlICkgewoJCQkJdGhpcy5wYXJlbnROb2RlLmluc2VydEJlZm9yZSggZWxlbSwgdGhpcy5uZXh0U2libGluZyApOwoJCQl9CgkJfSk7Cgl9LAoKCXJlbW92ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCBrZWVwRGF0YSAvKiBJbnRlcm5hbCBVc2UgT25seSAqLyApIHsKCQl2YXIgZWxlbSwKCQkJZWxlbXMgPSBzZWxlY3RvciA/IGpRdWVyeS5maWx0ZXIoIHNlbGVjdG9yLCB0aGlzICkgOiB0aGlzLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IGVsZW1zW2ldKSAhPSBudWxsOyBpKysgKSB7CgkJCWlmICggIWtlZXBEYXRhICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0gKSApOwoJCQl9CgoJCQlpZiAoIGVsZW0ucGFyZW50Tm9kZSApIHsKCQkJCWlmICgga2VlcERhdGEgJiYgalF1ZXJ5LmNvbnRhaW5zKCBlbGVtLm93bmVyRG9jdW1lbnQsIGVsZW0gKSApIHsKCQkJCQlzZXRHbG9iYWxFdmFsKCBnZXRBbGwoIGVsZW0sICJzY3JpcHQiICkgKTsKCQkJCX0KCQkJCWVsZW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCggZWxlbSApOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJZW1wdHk6IGZ1bmN0aW9uKCkgewoJCXZhciBlbGVtLAoJCQlpID0gMDsKCgkJZm9yICggOyAoZWxlbSA9IHRoaXNbaV0pICE9IG51bGw7IGkrKyApIHsKCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoKCQkJCS8vIFByZXZlbnQgbWVtb3J5IGxlYWtzCgkJCQlqUXVlcnkuY2xlYW5EYXRhKCBnZXRBbGwoIGVsZW0sIGZhbHNlICkgKTsKCgkJCQkvLyBSZW1vdmUgYW55IHJlbWFpbmluZyBub2RlcwoJCQkJZWxlbS50ZXh0Q29udGVudCA9ICIiOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJY2xvbmU6IGZ1bmN0aW9uKCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApIHsKCQlkYXRhQW5kRXZlbnRzID0gZGF0YUFuZEV2ZW50cyA9PSBudWxsID8gZmFsc2UgOiBkYXRhQW5kRXZlbnRzOwoJCWRlZXBEYXRhQW5kRXZlbnRzID0gZGVlcERhdGFBbmRFdmVudHMgPT0gbnVsbCA/IGRhdGFBbmRFdmVudHMgOiBkZWVwRGF0YUFuZEV2ZW50czsKCgkJcmV0dXJuIHRoaXMubWFwKGZ1bmN0aW9uKCkgewoJCQlyZXR1cm4galF1ZXJ5LmNsb25lKCB0aGlzLCBkYXRhQW5kRXZlbnRzLCBkZWVwRGF0YUFuZEV2ZW50cyApOwoJCX0pOwoJfSwKCglodG1sOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIHZhbHVlICkgewoJCQl2YXIgZWxlbSA9IHRoaXNbIDAgXSB8fCB7fSwKCQkJCWkgPSAwLAoJCQkJbCA9IHRoaXMubGVuZ3RoOwoKCQkJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCQlyZXR1cm4gZWxlbS5pbm5lckhUTUw7CgkJCX0KCgkJCS8vIFNlZSBpZiB3ZSBjYW4gdGFrZSBhIHNob3J0Y3V0IGFuZCBqdXN0IHVzZSBpbm5lckhUTUwKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciICYmICFybm9Jbm5lcmh0bWwudGVzdCggdmFsdWUgKSAmJgoJCQkJIXdyYXBNYXBbICggcnRhZ05hbWUuZXhlYyggdmFsdWUgKSB8fCBbICIiLCAiIiBdIClbIDEgXS50b0xvd2VyQ2FzZSgpIF0gKSB7CgoJCQkJdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKCByeGh0bWxUYWcsICI8JDE+PC8kMj4iICk7CgoJCQkJdHJ5IHsKCQkJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQkJCWVsZW0gPSB0aGlzWyBpIF0gfHwge307CgoJCQkJCQkvLyBSZW1vdmUgZWxlbWVudCBub2RlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3MKCQkJCQkJaWYgKCBlbGVtLm5vZGVUeXBlID09PSAxICkgewoJCQkJCQkJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCBlbGVtLCBmYWxzZSApICk7CgkJCQkJCQllbGVtLmlubmVySFRNTCA9IHZhbHVlOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQllbGVtID0gMDsKCgkJCQkvLyBJZiB1c2luZyBpbm5lckhUTUwgdGhyb3dzIGFuIGV4Y2VwdGlvbiwgdXNlIHRoZSBmYWxsYmFjayBtZXRob2QKCQkJCX0gY2F0Y2goIGUgKSB7fQoJCQl9CgoJCQlpZiAoIGVsZW0gKSB7CgkJCQl0aGlzLmVtcHR5KCkuYXBwZW5kKCB2YWx1ZSApOwoJCQl9CgkJfSwgbnVsbCwgdmFsdWUsIGFyZ3VtZW50cy5sZW5ndGggKTsKCX0sCgoJcmVwbGFjZVdpdGg6IGZ1bmN0aW9uKCkgewoJCXZhciBhcmcgPSBhcmd1bWVudHNbIDAgXTsKCgkJLy8gTWFrZSB0aGUgY2hhbmdlcywgcmVwbGFjaW5nIGVhY2ggY29udGV4dCBlbGVtZW50IHdpdGggdGhlIG5ldyBjb250ZW50CgkJdGhpcy5kb21NYW5pcCggYXJndW1lbnRzLCBmdW5jdGlvbiggZWxlbSApIHsKCQkJYXJnID0gdGhpcy5wYXJlbnROb2RlOwoKCQkJalF1ZXJ5LmNsZWFuRGF0YSggZ2V0QWxsKCB0aGlzICkgKTsKCgkJCWlmICggYXJnICkgewoJCQkJYXJnLnJlcGxhY2VDaGlsZCggZWxlbSwgdGhpcyApOwoJCQl9CgkJfSk7CgoJCS8vIEZvcmNlIHJlbW92YWwgaWYgdGhlcmUgd2FzIG5vIG5ldyBjb250ZW50IChlLmcuLCBmcm9tIGVtcHR5IGFyZ3VtZW50cykKCQlyZXR1cm4gYXJnICYmIChhcmcubGVuZ3RoIHx8IGFyZy5ub2RlVHlwZSkgPyB0aGlzIDogdGhpcy5yZW1vdmUoKTsKCX0sCgoJZGV0YWNoOiBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJcmV0dXJuIHRoaXMucmVtb3ZlKCBzZWxlY3RvciwgdHJ1ZSApOwoJfSwKCglkb21NYW5pcDogZnVuY3Rpb24oIGFyZ3MsIGNhbGxiYWNrICkgewoKCQkvLyBGbGF0dGVuIGFueSBuZXN0ZWQgYXJyYXlzCgkJYXJncyA9IGNvbmNhdC5hcHBseSggW10sIGFyZ3MgKTsKCgkJdmFyIGZyYWdtZW50LCBmaXJzdCwgc2NyaXB0cywgaGFzU2NyaXB0cywgbm9kZSwgZG9jLAoJCQlpID0gMCwKCQkJbCA9IHRoaXMubGVuZ3RoLAoJCQlzZXQgPSB0aGlzLAoJCQlpTm9DbG9uZSA9IGwgLSAxLAoJCQl2YWx1ZSA9IGFyZ3NbIDAgXSwKCQkJaXNGdW5jdGlvbiA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApOwoKCQkvLyBXZSBjYW4ndCBjbG9uZU5vZGUgZnJhZ21lbnRzIHRoYXQgY29udGFpbiBjaGVja2VkLCBpbiBXZWJLaXQKCQlpZiAoIGlzRnVuY3Rpb24gfHwKCQkJCSggbCA+IDEgJiYgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJgoJCQkJCSFzdXBwb3J0LmNoZWNrQ2xvbmUgJiYgcmNoZWNrZWQudGVzdCggdmFsdWUgKSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpbmRleCApIHsKCQkJCXZhciBzZWxmID0gc2V0LmVxKCBpbmRleCApOwoJCQkJaWYgKCBpc0Z1bmN0aW9uICkgewoJCQkJCWFyZ3NbIDAgXSA9IHZhbHVlLmNhbGwoIHRoaXMsIGluZGV4LCBzZWxmLmh0bWwoKSApOwoJCQkJfQoJCQkJc2VsZi5kb21NYW5pcCggYXJncywgY2FsbGJhY2sgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIGwgKSB7CgkJCWZyYWdtZW50ID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIGFyZ3MsIHRoaXNbIDAgXS5vd25lckRvY3VtZW50LCBmYWxzZSwgdGhpcyApOwoJCQlmaXJzdCA9IGZyYWdtZW50LmZpcnN0Q2hpbGQ7CgoJCQlpZiAoIGZyYWdtZW50LmNoaWxkTm9kZXMubGVuZ3RoID09PSAxICkgewoJCQkJZnJhZ21lbnQgPSBmaXJzdDsKCQkJfQoKCQkJaWYgKCBmaXJzdCApIHsKCQkJCXNjcmlwdHMgPSBqUXVlcnkubWFwKCBnZXRBbGwoIGZyYWdtZW50LCAic2NyaXB0IiApLCBkaXNhYmxlU2NyaXB0ICk7CgkJCQloYXNTY3JpcHRzID0gc2NyaXB0cy5sZW5ndGg7CgoJCQkJLy8gVXNlIHRoZSBvcmlnaW5hbCBmcmFnbWVudCBmb3IgdGhlIGxhc3QgaXRlbSBpbnN0ZWFkIG9mIHRoZSBmaXJzdCBiZWNhdXNlIGl0IGNhbiBlbmQgdXAKCQkJCS8vIGJlaW5nIGVtcHRpZWQgaW5jb3JyZWN0bHkgaW4gY2VydGFpbiBzaXR1YXRpb25zICgjODA3MCkuCgkJCQlmb3IgKCA7IGkgPCBsOyBpKysgKSB7CgkJCQkJbm9kZSA9IGZyYWdtZW50OwoKCQkJCQlpZiAoIGkgIT09IGlOb0Nsb25lICkgewoJCQkJCQlub2RlID0galF1ZXJ5LmNsb25lKCBub2RlLCB0cnVlLCB0cnVlICk7CgoJCQkJCQkvLyBLZWVwIHJlZmVyZW5jZXMgdG8gY2xvbmVkIHNjcmlwdHMgZm9yIGxhdGVyIHJlc3RvcmF0aW9uCgkJCQkJCWlmICggaGFzU2NyaXB0cyApIHsKCQkJCQkJCS8vIFN1cHBvcnQ6IFF0V2ViS2l0CgkJCQkJCQkvLyBqUXVlcnkubWVyZ2UgYmVjYXVzZSBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzCgkJCQkJCQlqUXVlcnkubWVyZ2UoIHNjcmlwdHMsIGdldEFsbCggbm9kZSwgInNjcmlwdCIgKSApOwoJCQkJCQl9CgkJCQkJfQoKCQkJCQljYWxsYmFjay5jYWxsKCB0aGlzWyBpIF0sIG5vZGUsIGkgKTsKCQkJCX0KCgkJCQlpZiAoIGhhc1NjcmlwdHMgKSB7CgkJCQkJZG9jID0gc2NyaXB0c1sgc2NyaXB0cy5sZW5ndGggLSAxIF0ub3duZXJEb2N1bWVudDsKCgkJCQkJLy8gUmVlbmFibGUgc2NyaXB0cwoJCQkJCWpRdWVyeS5tYXAoIHNjcmlwdHMsIHJlc3RvcmVTY3JpcHQgKTsKCgkJCQkJLy8gRXZhbHVhdGUgZXhlY3V0YWJsZSBzY3JpcHRzIG9uIGZpcnN0IGRvY3VtZW50IGluc2VydGlvbgoJCQkJCWZvciAoIGkgPSAwOyBpIDwgaGFzU2NyaXB0czsgaSsrICkgewoJCQkJCQlub2RlID0gc2NyaXB0c1sgaSBdOwoJCQkJCQlpZiAoIHJzY3JpcHRUeXBlLnRlc3QoIG5vZGUudHlwZSB8fCAiIiApICYmCgkJCQkJCQkhZGF0YV9wcml2LmFjY2Vzcyggbm9kZSwgImdsb2JhbEV2YWwiICkgJiYgalF1ZXJ5LmNvbnRhaW5zKCBkb2MsIG5vZGUgKSApIHsKCgkJCQkJCQlpZiAoIG5vZGUuc3JjICkgewoJCQkJCQkJCS8vIE9wdGlvbmFsIEFKQVggZGVwZW5kZW5jeSwgYnV0IHdvbid0IHJ1biBzY3JpcHRzIGlmIG5vdCBwcmVzZW50CgkJCQkJCQkJaWYgKCBqUXVlcnkuX2V2YWxVcmwgKSB7CgkJCQkJCQkJCWpRdWVyeS5fZXZhbFVybCggbm9kZS5zcmMgKTsKCQkJCQkJCQl9CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWpRdWVyeS5nbG9iYWxFdmFsKCBub2RlLnRleHRDb250ZW50LnJlcGxhY2UoIHJjbGVhblNjcmlwdCwgIiIgKSApOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0KfSk7CgpqUXVlcnkuZWFjaCh7CglhcHBlbmRUbzogImFwcGVuZCIsCglwcmVwZW5kVG86ICJwcmVwZW5kIiwKCWluc2VydEJlZm9yZTogImJlZm9yZSIsCglpbnNlcnRBZnRlcjogImFmdGVyIiwKCXJlcGxhY2VBbGw6ICJyZXBsYWNlV2l0aCIKfSwgZnVuY3Rpb24oIG5hbWUsIG9yaWdpbmFsICkgewoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc2VsZWN0b3IgKSB7CgkJdmFyIGVsZW1zLAoJCQlyZXQgPSBbXSwKCQkJaW5zZXJ0ID0galF1ZXJ5KCBzZWxlY3RvciApLAoJCQlsYXN0ID0gaW5zZXJ0Lmxlbmd0aCAtIDEsCgkJCWkgPSAwOwoKCQlmb3IgKCA7IGkgPD0gbGFzdDsgaSsrICkgewoJCQllbGVtcyA9IGkgPT09IGxhc3QgPyB0aGlzIDogdGhpcy5jbG9uZSggdHJ1ZSApOwoJCQlqUXVlcnkoIGluc2VydFsgaSBdIClbIG9yaWdpbmFsIF0oIGVsZW1zICk7CgoJCQkvLyBTdXBwb3J0OiBRdFdlYktpdAoJCQkvLyAuZ2V0KCkgYmVjYXVzZSBwdXNoLmFwcGx5KF8sIGFycmF5bGlrZSkgdGhyb3dzCgkJCXB1c2guYXBwbHkoIHJldCwgZWxlbXMuZ2V0KCkgKTsKCQl9CgoJCXJldHVybiB0aGlzLnB1c2hTdGFjayggcmV0ICk7Cgl9Owp9KTsKCgp2YXIgaWZyYW1lLAoJZWxlbWRpc3BsYXkgPSB7fTsKCi8qKgogKiBSZXRyaWV2ZSB0aGUgYWN0dWFsIGRpc3BsYXkgb2YgYSBlbGVtZW50CiAqIEBwYXJhbSB7U3RyaW5nfSBuYW1lIG5vZGVOYW1lIG9mIHRoZSBlbGVtZW50CiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MgRG9jdW1lbnQgb2JqZWN0CiAqLwovLyBDYWxsZWQgb25seSBmcm9tIHdpdGhpbiBkZWZhdWx0RGlzcGxheQpmdW5jdGlvbiBhY3R1YWxEaXNwbGF5KCBuYW1lLCBkb2MgKSB7Cgl2YXIgc3R5bGUsCgkJZWxlbSA9IGpRdWVyeSggZG9jLmNyZWF0ZUVsZW1lbnQoIG5hbWUgKSApLmFwcGVuZFRvKCBkb2MuYm9keSApLAoKCQkvLyBnZXREZWZhdWx0Q29tcHV0ZWRTdHlsZSBtaWdodCBiZSByZWxpYWJseSB1c2VkIG9ubHkgb24gYXR0YWNoZWQgZWxlbWVudAoJCWRpc3BsYXkgPSB3aW5kb3cuZ2V0RGVmYXVsdENvbXB1dGVkU3R5bGUgJiYgKCBzdHlsZSA9IHdpbmRvdy5nZXREZWZhdWx0Q29tcHV0ZWRTdHlsZSggZWxlbVsgMCBdICkgKSA/CgoJCQkvLyBVc2Ugb2YgdGhpcyBtZXRob2QgaXMgYSB0ZW1wb3JhcnkgZml4IChtb3JlIGxpa2Ugb3B0aW1pemF0aW9uKSB1bnRpbCBzb21ldGhpbmcgYmV0dGVyIGNvbWVzIGFsb25nLAoJCQkvLyBzaW5jZSBpdCB3YXMgcmVtb3ZlZCBmcm9tIHNwZWNpZmljYXRpb24gYW5kIHN1cHBvcnRlZCBvbmx5IGluIEZGCgkJCXN0eWxlLmRpc3BsYXkgOiBqUXVlcnkuY3NzKCBlbGVtWyAwIF0sICJkaXNwbGF5IiApOwoKCS8vIFdlIGRvbid0IGhhdmUgYW55IGRhdGEgc3RvcmVkIG9uIHRoZSBlbGVtZW50LAoJLy8gc28gdXNlICJkZXRhY2giIG1ldGhvZCBhcyBmYXN0IHdheSB0byBnZXQgcmlkIG9mIHRoZSBlbGVtZW50CgllbGVtLmRldGFjaCgpOwoKCXJldHVybiBkaXNwbGF5Owp9CgovKioKICogVHJ5IHRvIGRldGVybWluZSB0aGUgZGVmYXVsdCBkaXNwbGF5IHZhbHVlIG9mIGFuIGVsZW1lbnQKICogQHBhcmFtIHtTdHJpbmd9IG5vZGVOYW1lCiAqLwpmdW5jdGlvbiBkZWZhdWx0RGlzcGxheSggbm9kZU5hbWUgKSB7Cgl2YXIgZG9jID0gZG9jdW1lbnQsCgkJZGlzcGxheSA9IGVsZW1kaXNwbGF5WyBub2RlTmFtZSBdOwoKCWlmICggIWRpc3BsYXkgKSB7CgkJZGlzcGxheSA9IGFjdHVhbERpc3BsYXkoIG5vZGVOYW1lLCBkb2MgKTsKCgkJLy8gSWYgdGhlIHNpbXBsZSB3YXkgZmFpbHMsIHJlYWQgZnJvbSBpbnNpZGUgYW4gaWZyYW1lCgkJaWYgKCBkaXNwbGF5ID09PSAibm9uZSIgfHwgIWRpc3BsYXkgKSB7CgoJCQkvLyBVc2UgdGhlIGFscmVhZHktY3JlYXRlZCBpZnJhbWUgaWYgcG9zc2libGUKCQkJaWZyYW1lID0gKGlmcmFtZSB8fCBqUXVlcnkoICI8aWZyYW1lIGZyYW1lYm9yZGVyPScwJyB3aWR0aD0nMCcgaGVpZ2h0PScwJy8+IiApKS5hcHBlbmRUbyggZG9jLmRvY3VtZW50RWxlbWVudCApOwoKCQkJLy8gQWx3YXlzIHdyaXRlIGEgbmV3IEhUTUwgc2tlbGV0b24gc28gV2Via2l0IGFuZCBGaXJlZm94IGRvbid0IGNob2tlIG9uIHJldXNlCgkJCWRvYyA9IGlmcmFtZVsgMCBdLmNvbnRlbnREb2N1bWVudDsKCgkJCS8vIFN1cHBvcnQ6IElFCgkJCWRvYy53cml0ZSgpOwoJCQlkb2MuY2xvc2UoKTsKCgkJCWRpc3BsYXkgPSBhY3R1YWxEaXNwbGF5KCBub2RlTmFtZSwgZG9jICk7CgkJCWlmcmFtZS5kZXRhY2goKTsKCQl9CgoJCS8vIFN0b3JlIHRoZSBjb3JyZWN0IGRlZmF1bHQgZGlzcGxheQoJCWVsZW1kaXNwbGF5WyBub2RlTmFtZSBdID0gZGlzcGxheTsKCX0KCglyZXR1cm4gZGlzcGxheTsKfQp2YXIgcm1hcmdpbiA9ICgvXm1hcmdpbi8pOwoKdmFyIHJudW1ub25weCA9IG5ldyBSZWdFeHAoICJeKCIgKyBwbnVtICsgIikoPyFweClbYS16JV0rJCIsICJpIiApOwoKdmFyIGdldFN0eWxlcyA9IGZ1bmN0aW9uKCBlbGVtICkgewoJCS8vIFN1cHBvcnQ6IElFPD0xMSssIEZpcmVmb3g8PTMwKyAoIzE1MDk4LCAjMTQxNTApCgkJLy8gSUUgdGhyb3dzIG9uIGVsZW1lbnRzIGNyZWF0ZWQgaW4gcG9wdXBzCgkJLy8gRkYgbWVhbndoaWxlIHRocm93cyBvbiBmcmFtZSBlbGVtZW50cyB0aHJvdWdoICJkZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlIgoJCWlmICggZWxlbS5vd25lckRvY3VtZW50LmRlZmF1bHRWaWV3Lm9wZW5lciApIHsKCQkJcmV0dXJuIGVsZW0ub3duZXJEb2N1bWVudC5kZWZhdWx0Vmlldy5nZXRDb21wdXRlZFN0eWxlKCBlbGVtLCBudWxsICk7CgkJfQoKCQlyZXR1cm4gd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGVsZW0sIG51bGwgKTsKCX07CgoKCmZ1bmN0aW9uIGN1ckNTUyggZWxlbSwgbmFtZSwgY29tcHV0ZWQgKSB7Cgl2YXIgd2lkdGgsIG1pbldpZHRoLCBtYXhXaWR0aCwgcmV0LAoJCXN0eWxlID0gZWxlbS5zdHlsZTsKCgljb21wdXRlZCA9IGNvbXB1dGVkIHx8IGdldFN0eWxlcyggZWxlbSApOwoKCS8vIFN1cHBvcnQ6IElFOQoJLy8gZ2V0UHJvcGVydHlWYWx1ZSBpcyBvbmx5IG5lZWRlZCBmb3IgLmNzcygnZmlsdGVyJykgKCMxMjUzNykKCWlmICggY29tcHV0ZWQgKSB7CgkJcmV0ID0gY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZSggbmFtZSApIHx8IGNvbXB1dGVkWyBuYW1lIF07Cgl9CgoJaWYgKCBjb21wdXRlZCApIHsKCgkJaWYgKCByZXQgPT09ICIiICYmICFqUXVlcnkuY29udGFpbnMoIGVsZW0ub3duZXJEb2N1bWVudCwgZWxlbSApICkgewoJCQlyZXQgPSBqUXVlcnkuc3R5bGUoIGVsZW0sIG5hbWUgKTsKCQl9CgoJCS8vIFN1cHBvcnQ6IGlPUyA8IDYKCQkvLyBBIHRyaWJ1dGUgdG8gdGhlICJhd2Vzb21lIGhhY2sgYnkgRGVhbiBFZHdhcmRzIgoJCS8vIGlPUyA8IDYgKGF0IGxlYXN0KSByZXR1cm5zIHBlcmNlbnRhZ2UgZm9yIGEgbGFyZ2VyIHNldCBvZiB2YWx1ZXMsIGJ1dCB3aWR0aCBzZWVtcyB0byBiZSByZWxpYWJseSBwaXhlbHMKCQkvLyB0aGlzIGlzIGFnYWluc3QgdGhlIENTU09NIGRyYWZ0IHNwZWM6IGh0dHA6Ly9kZXYudzMub3JnL2Nzc3dnL2Nzc29tLyNyZXNvbHZlZC12YWx1ZXMKCQlpZiAoIHJudW1ub25weC50ZXN0KCByZXQgKSAmJiBybWFyZ2luLnRlc3QoIG5hbWUgKSApIHsKCgkJCS8vIFJlbWVtYmVyIHRoZSBvcmlnaW5hbCB2YWx1ZXMKCQkJd2lkdGggPSBzdHlsZS53aWR0aDsKCQkJbWluV2lkdGggPSBzdHlsZS5taW5XaWR0aDsKCQkJbWF4V2lkdGggPSBzdHlsZS5tYXhXaWR0aDsKCgkJCS8vIFB1dCBpbiB0aGUgbmV3IHZhbHVlcyB0byBnZXQgYSBjb21wdXRlZCB2YWx1ZSBvdXQKCQkJc3R5bGUubWluV2lkdGggPSBzdHlsZS5tYXhXaWR0aCA9IHN0eWxlLndpZHRoID0gcmV0OwoJCQlyZXQgPSBjb21wdXRlZC53aWR0aDsKCgkJCS8vIFJldmVydCB0aGUgY2hhbmdlZCB2YWx1ZXMKCQkJc3R5bGUud2lkdGggPSB3aWR0aDsKCQkJc3R5bGUubWluV2lkdGggPSBtaW5XaWR0aDsKCQkJc3R5bGUubWF4V2lkdGggPSBtYXhXaWR0aDsKCQl9Cgl9CgoJcmV0dXJuIHJldCAhPT0gdW5kZWZpbmVkID8KCQkvLyBTdXBwb3J0OiBJRQoJCS8vIElFIHJldHVybnMgekluZGV4IHZhbHVlIGFzIGFuIGludGVnZXIuCgkJcmV0ICsgIiIgOgoJCXJldDsKfQoKCmZ1bmN0aW9uIGFkZEdldEhvb2tJZiggY29uZGl0aW9uRm4sIGhvb2tGbiApIHsKCS8vIERlZmluZSB0aGUgaG9vaywgd2UnbGwgY2hlY2sgb24gdGhlIGZpcnN0IHJ1biBpZiBpdCdzIHJlYWxseSBuZWVkZWQuCglyZXR1cm4gewoJCWdldDogZnVuY3Rpb24oKSB7CgkJCWlmICggY29uZGl0aW9uRm4oKSApIHsKCQkJCS8vIEhvb2sgbm90IG5lZWRlZCAob3IgaXQncyBub3QgcG9zc2libGUgdG8gdXNlIGl0IGR1ZQoJCQkJLy8gdG8gbWlzc2luZyBkZXBlbmRlbmN5KSwgcmVtb3ZlIGl0LgoJCQkJZGVsZXRlIHRoaXMuZ2V0OwoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBIb29rIG5lZWRlZDsgcmVkZWZpbmUgaXQgc28gdGhhdCB0aGUgc3VwcG9ydCB0ZXN0IGlzIG5vdCBleGVjdXRlZCBhZ2Fpbi4KCQkJcmV0dXJuICh0aGlzLmdldCA9IGhvb2tGbikuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJCX0KCX07Cn0KCgooZnVuY3Rpb24oKSB7Cgl2YXIgcGl4ZWxQb3NpdGlvblZhbCwgYm94U2l6aW5nUmVsaWFibGVWYWwsCgkJZG9jRWxlbSA9IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwKCQljb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAiZGl2IiApLAoJCWRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJkaXYiICk7CgoJaWYgKCAhZGl2LnN0eWxlICkgewoJCXJldHVybjsKCX0KCgkvLyBTdXBwb3J0OiBJRTktMTErCgkvLyBTdHlsZSBvZiBjbG9uZWQgZWxlbWVudCBhZmZlY3RzIHNvdXJjZSBlbGVtZW50IGNsb25lZCAoIzg5MDgpCglkaXYuc3R5bGUuYmFja2dyb3VuZENsaXAgPSAiY29udGVudC1ib3giOwoJZGl2LmNsb25lTm9kZSggdHJ1ZSApLnN0eWxlLmJhY2tncm91bmRDbGlwID0gIiI7CglzdXBwb3J0LmNsZWFyQ2xvbmVTdHlsZSA9IGRpdi5zdHlsZS5iYWNrZ3JvdW5kQ2xpcCA9PT0gImNvbnRlbnQtYm94IjsKCgljb250YWluZXIuc3R5bGUuY3NzVGV4dCA9ICJib3JkZXI6MDt3aWR0aDowO2hlaWdodDowO3RvcDowO2xlZnQ6LTk5OTlweDttYXJnaW4tdG9wOjFweDsiICsKCQkicG9zaXRpb246YWJzb2x1dGUiOwoJY29udGFpbmVyLmFwcGVuZENoaWxkKCBkaXYgKTsKCgkvLyBFeGVjdXRpbmcgYm90aCBwaXhlbFBvc2l0aW9uICYgYm94U2l6aW5nUmVsaWFibGUgdGVzdHMgcmVxdWlyZSBvbmx5IG9uZSBsYXlvdXQKCS8vIHNvIHRoZXkncmUgZXhlY3V0ZWQgYXQgdGhlIHNhbWUgdGltZSB0byBzYXZlIHRoZSBzZWNvbmQgY29tcHV0YXRpb24uCglmdW5jdGlvbiBjb21wdXRlUGl4ZWxQb3NpdGlvbkFuZEJveFNpemluZ1JlbGlhYmxlKCkgewoJCWRpdi5zdHlsZS5jc3NUZXh0ID0KCQkJLy8gU3VwcG9ydDogRmlyZWZveDwyOSwgQW5kcm9pZCAyLjMKCQkJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCgkJCSItd2Via2l0LWJveC1zaXppbmc6Ym9yZGVyLWJveDstbW96LWJveC1zaXppbmc6Ym9yZGVyLWJveDsiICsKCQkJImJveC1zaXppbmc6Ym9yZGVyLWJveDtkaXNwbGF5OmJsb2NrO21hcmdpbi10b3A6MSU7dG9wOjElOyIgKwoJCQkiYm9yZGVyOjFweDtwYWRkaW5nOjFweDt3aWR0aDo0cHg7cG9zaXRpb246YWJzb2x1dGUiOwoJCWRpdi5pbm5lckhUTUwgPSAiIjsKCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBjb250YWluZXIgKTsKCgkJdmFyIGRpdlN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUoIGRpdiwgbnVsbCApOwoJCXBpeGVsUG9zaXRpb25WYWwgPSBkaXZTdHlsZS50b3AgIT09ICIxJSI7CgkJYm94U2l6aW5nUmVsaWFibGVWYWwgPSBkaXZTdHlsZS53aWR0aCA9PT0gIjRweCI7CgoJCWRvY0VsZW0ucmVtb3ZlQ2hpbGQoIGNvbnRhaW5lciApOwoJfQoKCS8vIFN1cHBvcnQ6IG5vZGUuanMganNkb20KCS8vIERvbid0IGFzc3VtZSB0aGF0IGdldENvbXB1dGVkU3R5bGUgaXMgYSBwcm9wZXJ0eSBvZiB0aGUgZ2xvYmFsIG9iamVjdAoJaWYgKCB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSApIHsKCQlqUXVlcnkuZXh0ZW5kKCBzdXBwb3J0LCB7CgkJCXBpeGVsUG9zaXRpb246IGZ1bmN0aW9uKCkgewoKCQkJCS8vIFRoaXMgdGVzdCBpcyBleGVjdXRlZCBvbmx5IG9uY2UgYnV0IHdlIHN0aWxsIGRvIG1lbW9pemluZwoJCQkJLy8gc2luY2Ugd2UgY2FuIHVzZSB0aGUgYm94U2l6aW5nUmVsaWFibGUgcHJlLWNvbXB1dGluZy4KCQkJCS8vIE5vIG5lZWQgdG8gY2hlY2sgaWYgdGhlIHRlc3Qgd2FzIGFscmVhZHkgcGVyZm9ybWVkLCB0aG91Z2guCgkJCQljb21wdXRlUGl4ZWxQb3NpdGlvbkFuZEJveFNpemluZ1JlbGlhYmxlKCk7CgkJCQlyZXR1cm4gcGl4ZWxQb3NpdGlvblZhbDsKCQkJfSwKCQkJYm94U2l6aW5nUmVsaWFibGU6IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCBib3hTaXppbmdSZWxpYWJsZVZhbCA9PSBudWxsICkgewoJCQkJCWNvbXB1dGVQaXhlbFBvc2l0aW9uQW5kQm94U2l6aW5nUmVsaWFibGUoKTsKCQkJCX0KCQkJCXJldHVybiBib3hTaXppbmdSZWxpYWJsZVZhbDsKCQkJfSwKCQkJcmVsaWFibGVNYXJnaW5SaWdodDogZnVuY3Rpb24oKSB7CgoJCQkJLy8gU3VwcG9ydDogQW5kcm9pZCAyLjMKCQkJCS8vIENoZWNrIGlmIGRpdiB3aXRoIGV4cGxpY2l0IHdpZHRoIGFuZCBubyBtYXJnaW4tcmlnaHQgaW5jb3JyZWN0bHkKCQkJCS8vIGdldHMgY29tcHV0ZWQgbWFyZ2luLXJpZ2h0IGJhc2VkIG9uIHdpZHRoIG9mIGNvbnRhaW5lci4gKCMzMzMzKQoJCQkJLy8gV2ViS2l0IEJ1ZyAxMzM0MyAtIGdldENvbXB1dGVkU3R5bGUgcmV0dXJucyB3cm9uZyB2YWx1ZSBmb3IgbWFyZ2luLXJpZ2h0CgkJCQkvLyBUaGlzIHN1cHBvcnQgZnVuY3Rpb24gaXMgb25seSBleGVjdXRlZCBvbmNlIHNvIG5vIG1lbW9pemluZyBpcyBuZWVkZWQuCgkJCQl2YXIgcmV0LAoJCQkJCW1hcmdpbkRpdiA9IGRpdi5hcHBlbmRDaGlsZCggZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImRpdiIgKSApOwoKCQkJCS8vIFJlc2V0IENTUzogYm94LXNpemluZzsgZGlzcGxheTsgbWFyZ2luOyBib3JkZXI7IHBhZGRpbmcKCQkJCW1hcmdpbkRpdi5zdHlsZS5jc3NUZXh0ID0gZGl2LnN0eWxlLmNzc1RleHQgPQoJCQkJCS8vIFN1cHBvcnQ6IEZpcmVmb3g8MjksIEFuZHJvaWQgMi4zCgkJCQkJLy8gVmVuZG9yLXByZWZpeCBib3gtc2l6aW5nCgkJCQkJIi13ZWJraXQtYm94LXNpemluZzpjb250ZW50LWJveDstbW96LWJveC1zaXppbmc6Y29udGVudC1ib3g7IiArCgkJCQkJImJveC1zaXppbmc6Y29udGVudC1ib3g7ZGlzcGxheTpibG9jazttYXJnaW46MDtib3JkZXI6MDtwYWRkaW5nOjAiOwoJCQkJbWFyZ2luRGl2LnN0eWxlLm1hcmdpblJpZ2h0ID0gbWFyZ2luRGl2LnN0eWxlLndpZHRoID0gIjAiOwoJCQkJZGl2LnN0eWxlLndpZHRoID0gIjFweCI7CgkJCQlkb2NFbGVtLmFwcGVuZENoaWxkKCBjb250YWluZXIgKTsKCgkJCQlyZXQgPSAhcGFyc2VGbG9hdCggd2luZG93LmdldENvbXB1dGVkU3R5bGUoIG1hcmdpbkRpdiwgbnVsbCApLm1hcmdpblJpZ2h0ICk7CgoJCQkJZG9jRWxlbS5yZW1vdmVDaGlsZCggY29udGFpbmVyICk7CgkJCQlkaXYucmVtb3ZlQ2hpbGQoIG1hcmdpbkRpdiApOwoKCQkJCXJldHVybiByZXQ7CgkJCX0KCQl9KTsKCX0KfSkoKTsKCgovLyBBIG1ldGhvZCBmb3IgcXVpY2tseSBzd2FwcGluZyBpbi9vdXQgQ1NTIHByb3BlcnRpZXMgdG8gZ2V0IGNvcnJlY3QgY2FsY3VsYXRpb25zLgpqUXVlcnkuc3dhcCA9IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBjYWxsYmFjaywgYXJncyApIHsKCXZhciByZXQsIG5hbWUsCgkJb2xkID0ge307CgoJLy8gUmVtZW1iZXIgdGhlIG9sZCB2YWx1ZXMsIGFuZCBpbnNlcnQgdGhlIG5ldyBvbmVzCglmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJb2xkWyBuYW1lIF0gPSBlbGVtLnN0eWxlWyBuYW1lIF07CgkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb3B0aW9uc1sgbmFtZSBdOwoJfQoKCXJldCA9IGNhbGxiYWNrLmFwcGx5KCBlbGVtLCBhcmdzIHx8IFtdICk7CgoJLy8gUmV2ZXJ0IHRoZSBvbGQgdmFsdWVzCglmb3IgKCBuYW1lIGluIG9wdGlvbnMgKSB7CgkJZWxlbS5zdHlsZVsgbmFtZSBdID0gb2xkWyBuYW1lIF07Cgl9CgoJcmV0dXJuIHJldDsKfTsKCgp2YXIKCS8vIFN3YXBwYWJsZSBpZiBkaXNwbGF5IGlzIG5vbmUgb3Igc3RhcnRzIHdpdGggdGFibGUgZXhjZXB0ICJ0YWJsZSIsICJ0YWJsZS1jZWxsIiwgb3IgInRhYmxlLWNhcHRpb24iCgkvLyBTZWUgaGVyZSBmb3IgZGlzcGxheSB2YWx1ZXM6IGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvQ1NTL2Rpc3BsYXkKCXJkaXNwbGF5c3dhcCA9IC9eKG5vbmV8dGFibGUoPyEtY1tlYV0pLispLywKCXJudW1zcGxpdCA9IG5ldyBSZWdFeHAoICJeKCIgKyBwbnVtICsgIikoLiopJCIsICJpIiApLAoJcnJlbE51bSA9IG5ldyBSZWdFeHAoICJeKFsrLV0pPSgiICsgcG51bSArICIpIiwgImkiICksCgoJY3NzU2hvdyA9IHsgcG9zaXRpb246ICJhYnNvbHV0ZSIsIHZpc2liaWxpdHk6ICJoaWRkZW4iLCBkaXNwbGF5OiAiYmxvY2siIH0sCgljc3NOb3JtYWxUcmFuc2Zvcm0gPSB7CgkJbGV0dGVyU3BhY2luZzogIjAiLAoJCWZvbnRXZWlnaHQ6ICI0MDAiCgl9LAoKCWNzc1ByZWZpeGVzID0gWyAiV2Via2l0IiwgIk8iLCAiTW96IiwgIm1zIiBdOwoKLy8gUmV0dXJuIGEgY3NzIHByb3BlcnR5IG1hcHBlZCB0byBhIHBvdGVudGlhbGx5IHZlbmRvciBwcmVmaXhlZCBwcm9wZXJ0eQpmdW5jdGlvbiB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG5hbWUgKSB7CgoJLy8gU2hvcnRjdXQgZm9yIG5hbWVzIHRoYXQgYXJlIG5vdCB2ZW5kb3IgcHJlZml4ZWQKCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQlyZXR1cm4gbmFtZTsKCX0KCgkvLyBDaGVjayBmb3IgdmVuZG9yIHByZWZpeGVkIG5hbWVzCgl2YXIgY2FwTmFtZSA9IG5hbWVbMF0udG9VcHBlckNhc2UoKSArIG5hbWUuc2xpY2UoMSksCgkJb3JpZ05hbWUgPSBuYW1lLAoJCWkgPSBjc3NQcmVmaXhlcy5sZW5ndGg7CgoJd2hpbGUgKCBpLS0gKSB7CgkJbmFtZSA9IGNzc1ByZWZpeGVzWyBpIF0gKyBjYXBOYW1lOwoJCWlmICggbmFtZSBpbiBzdHlsZSApIHsKCQkJcmV0dXJuIG5hbWU7CgkJfQoJfQoKCXJldHVybiBvcmlnTmFtZTsKfQoKZnVuY3Rpb24gc2V0UG9zaXRpdmVOdW1iZXIoIGVsZW0sIHZhbHVlLCBzdWJ0cmFjdCApIHsKCXZhciBtYXRjaGVzID0gcm51bXNwbGl0LmV4ZWMoIHZhbHVlICk7CglyZXR1cm4gbWF0Y2hlcyA/CgkJLy8gR3VhcmQgYWdhaW5zdCB1bmRlZmluZWQgInN1YnRyYWN0IiwgZS5nLiwgd2hlbiB1c2VkIGFzIGluIGNzc0hvb2tzCgkJTWF0aC5tYXgoIDAsIG1hdGNoZXNbIDEgXSAtICggc3VidHJhY3QgfHwgMCApICkgKyAoIG1hdGNoZXNbIDIgXSB8fCAicHgiICkgOgoJCXZhbHVlOwp9CgpmdW5jdGlvbiBhdWdtZW50V2lkdGhPckhlaWdodCggZWxlbSwgbmFtZSwgZXh0cmEsIGlzQm9yZGVyQm94LCBzdHlsZXMgKSB7Cgl2YXIgaSA9IGV4dHJhID09PSAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSA/CgkJLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHRoZSByaWdodCBtZWFzdXJlbWVudCwgYXZvaWQgYXVnbWVudGF0aW9uCgkJNCA6CgkJLy8gT3RoZXJ3aXNlIGluaXRpYWxpemUgZm9yIGhvcml6b250YWwgb3IgdmVydGljYWwgcHJvcGVydGllcwoJCW5hbWUgPT09ICJ3aWR0aCIgPyAxIDogMCwKCgkJdmFsID0gMDsKCglmb3IgKCA7IGkgPCA0OyBpICs9IDIgKSB7CgkJLy8gQm90aCBib3ggbW9kZWxzIGV4Y2x1ZGUgbWFyZ2luLCBzbyBhZGQgaXQgaWYgd2Ugd2FudCBpdAoJCWlmICggZXh0cmEgPT09ICJtYXJnaW4iICkgewoJCQl2YWwgKz0galF1ZXJ5LmNzcyggZWxlbSwgZXh0cmEgKyBjc3NFeHBhbmRbIGkgXSwgdHJ1ZSwgc3R5bGVzICk7CgkJfQoKCQlpZiAoIGlzQm9yZGVyQm94ICkgewoJCQkvLyBib3JkZXItYm94IGluY2x1ZGVzIHBhZGRpbmcsIHNvIHJlbW92ZSBpdCBpZiB3ZSB3YW50IGNvbnRlbnQKCQkJaWYgKCBleHRyYSA9PT0gImNvbnRlbnQiICkgewoJCQkJdmFsIC09IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoKCQkJLy8gQXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgYm9yZGVyIG5vciBtYXJnaW4sIHNvIHJlbW92ZSBib3JkZXIKCQkJaWYgKCBleHRyYSAhPT0gIm1hcmdpbiIgKSB7CgkJCQl2YWwgLT0galF1ZXJ5LmNzcyggZWxlbSwgImJvcmRlciIgKyBjc3NFeHBhbmRbIGkgXSArICJXaWR0aCIsIHRydWUsIHN0eWxlcyApOwoJCQl9CgkJfSBlbHNlIHsKCQkJLy8gQXQgdGhpcyBwb2ludCwgZXh0cmEgaXNuJ3QgY29udGVudCwgc28gYWRkIHBhZGRpbmcKCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJwYWRkaW5nIiArIGNzc0V4cGFuZFsgaSBdLCB0cnVlLCBzdHlsZXMgKTsKCgkJCS8vIEF0IHRoaXMgcG9pbnQsIGV4dHJhIGlzbid0IGNvbnRlbnQgbm9yIHBhZGRpbmcsIHNvIGFkZCBib3JkZXIKCQkJaWYgKCBleHRyYSAhPT0gInBhZGRpbmciICkgewoJCQkJdmFsICs9IGpRdWVyeS5jc3MoIGVsZW0sICJib3JkZXIiICsgY3NzRXhwYW5kWyBpIF0gKyAiV2lkdGgiLCB0cnVlLCBzdHlsZXMgKTsKCQkJfQoJCX0KCX0KCglyZXR1cm4gdmFsOwp9CgpmdW5jdGlvbiBnZXRXaWR0aE9ySGVpZ2h0KCBlbGVtLCBuYW1lLCBleHRyYSApIHsKCgkvLyBTdGFydCB3aXRoIG9mZnNldCBwcm9wZXJ0eSwgd2hpY2ggaXMgZXF1aXZhbGVudCB0byB0aGUgYm9yZGVyLWJveCB2YWx1ZQoJdmFyIHZhbHVlSXNCb3JkZXJCb3ggPSB0cnVlLAoJCXZhbCA9IG5hbWUgPT09ICJ3aWR0aCIgPyBlbGVtLm9mZnNldFdpZHRoIDogZWxlbS5vZmZzZXRIZWlnaHQsCgkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICksCgkJaXNCb3JkZXJCb3ggPSBqUXVlcnkuY3NzKCBlbGVtLCAiYm94U2l6aW5nIiwgZmFsc2UsIHN0eWxlcyApID09PSAiYm9yZGVyLWJveCI7CgoJLy8gU29tZSBub24taHRtbCBlbGVtZW50cyByZXR1cm4gdW5kZWZpbmVkIGZvciBvZmZzZXRXaWR0aCwgc28gY2hlY2sgZm9yIG51bGwvdW5kZWZpbmVkCgkvLyBzdmcgLSBodHRwczovL2J1Z3ppbGxhLm1vemlsbGEub3JnL3Nob3dfYnVnLmNnaT9pZD02NDkyODUKCS8vIE1hdGhNTCAtIGh0dHBzOi8vYnVnemlsbGEubW96aWxsYS5vcmcvc2hvd19idWcuY2dpP2lkPTQ5MTY2OAoJaWYgKCB2YWwgPD0gMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkvLyBGYWxsIGJhY2sgdG8gY29tcHV0ZWQgdGhlbiB1bmNvbXB1dGVkIGNzcyBpZiBuZWNlc3NhcnkKCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCWlmICggdmFsIDwgMCB8fCB2YWwgPT0gbnVsbCApIHsKCQkJdmFsID0gZWxlbS5zdHlsZVsgbmFtZSBdOwoJCX0KCgkJLy8gQ29tcHV0ZWQgdW5pdCBpcyBub3QgcGl4ZWxzLiBTdG9wIGhlcmUgYW5kIHJldHVybi4KCQlpZiAoIHJudW1ub25weC50ZXN0KHZhbCkgKSB7CgkJCXJldHVybiB2YWw7CgkJfQoKCQkvLyBDaGVjayBmb3Igc3R5bGUgaW4gY2FzZSBhIGJyb3dzZXIgd2hpY2ggcmV0dXJucyB1bnJlbGlhYmxlIHZhbHVlcwoJCS8vIGZvciBnZXRDb21wdXRlZFN0eWxlIHNpbGVudGx5IGZhbGxzIGJhY2sgdG8gdGhlIHJlbGlhYmxlIGVsZW0uc3R5bGUKCQl2YWx1ZUlzQm9yZGVyQm94ID0gaXNCb3JkZXJCb3ggJiYKCQkJKCBzdXBwb3J0LmJveFNpemluZ1JlbGlhYmxlKCkgfHwgdmFsID09PSBlbGVtLnN0eWxlWyBuYW1lIF0gKTsKCgkJLy8gTm9ybWFsaXplICIiLCBhdXRvLCBhbmQgcHJlcGFyZSBmb3IgZXh0cmEKCQl2YWwgPSBwYXJzZUZsb2F0KCB2YWwgKSB8fCAwOwoJfQoKCS8vIFVzZSB0aGUgYWN0aXZlIGJveC1zaXppbmcgbW9kZWwgdG8gYWRkL3N1YnRyYWN0IGlycmVsZXZhbnQgc3R5bGVzCglyZXR1cm4gKCB2YWwgKwoJCWF1Z21lbnRXaWR0aE9ySGVpZ2h0KAoJCQllbGVtLAoJCQluYW1lLAoJCQlleHRyYSB8fCAoIGlzQm9yZGVyQm94ID8gImJvcmRlciIgOiAiY29udGVudCIgKSwKCQkJdmFsdWVJc0JvcmRlckJveCwKCQkJc3R5bGVzCgkJKQoJKSArICJweCI7Cn0KCmZ1bmN0aW9uIHNob3dIaWRlKCBlbGVtZW50cywgc2hvdyApIHsKCXZhciBkaXNwbGF5LCBlbGVtLCBoaWRkZW4sCgkJdmFsdWVzID0gW10sCgkJaW5kZXggPSAwLAoJCWxlbmd0aCA9IGVsZW1lbnRzLmxlbmd0aDsKCglmb3IgKCA7IGluZGV4IDwgbGVuZ3RoOyBpbmRleCsrICkgewoJCWVsZW0gPSBlbGVtZW50c1sgaW5kZXggXTsKCQlpZiAoICFlbGVtLnN0eWxlICkgewoJCQljb250aW51ZTsKCQl9CgoJCXZhbHVlc1sgaW5kZXggXSA9IGRhdGFfcHJpdi5nZXQoIGVsZW0sICJvbGRkaXNwbGF5IiApOwoJCWRpc3BsYXkgPSBlbGVtLnN0eWxlLmRpc3BsYXk7CgkJaWYgKCBzaG93ICkgewoJCQkvLyBSZXNldCB0aGUgaW5saW5lIGRpc3BsYXkgb2YgdGhpcyBlbGVtZW50IHRvIGxlYXJuIGlmIGl0IGlzCgkJCS8vIGJlaW5nIGhpZGRlbiBieSBjYXNjYWRlZCBydWxlcyBvciBub3QKCQkJaWYgKCAhdmFsdWVzWyBpbmRleCBdICYmIGRpc3BsYXkgPT09ICJub25lIiApIHsKCQkJCWVsZW0uc3R5bGUuZGlzcGxheSA9ICIiOwoJCQl9CgoJCQkvLyBTZXQgZWxlbWVudHMgd2hpY2ggaGF2ZSBiZWVuIG92ZXJyaWRkZW4gd2l0aCBkaXNwbGF5OiBub25lCgkJCS8vIGluIGEgc3R5bGVzaGVldCB0byB3aGF0ZXZlciB0aGUgZGVmYXVsdCBicm93c2VyIHN0eWxlIGlzCgkJCS8vIGZvciBzdWNoIGFuIGVsZW1lbnQKCQkJaWYgKCBlbGVtLnN0eWxlLmRpc3BsYXkgPT09ICIiICYmIGlzSGlkZGVuKCBlbGVtICkgKSB7CgkJCQl2YWx1ZXNbIGluZGV4IF0gPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCAib2xkZGlzcGxheSIsIGRlZmF1bHREaXNwbGF5KGVsZW0ubm9kZU5hbWUpICk7CgkJCX0KCQl9IGVsc2UgewoJCQloaWRkZW4gPSBpc0hpZGRlbiggZWxlbSApOwoKCQkJaWYgKCBkaXNwbGF5ICE9PSAibm9uZSIgfHwgIWhpZGRlbiApIHsKCQkJCWRhdGFfcHJpdi5zZXQoIGVsZW0sICJvbGRkaXNwbGF5IiwgaGlkZGVuID8gZGlzcGxheSA6IGpRdWVyeS5jc3MoIGVsZW0sICJkaXNwbGF5IiApICk7CgkJCX0KCQl9Cgl9CgoJLy8gU2V0IHRoZSBkaXNwbGF5IG9mIG1vc3Qgb2YgdGhlIGVsZW1lbnRzIGluIGEgc2Vjb25kIGxvb3AKCS8vIHRvIGF2b2lkIHRoZSBjb25zdGFudCByZWZsb3cKCWZvciAoIGluZGV4ID0gMDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJZWxlbSA9IGVsZW1lbnRzWyBpbmRleCBdOwoJCWlmICggIWVsZW0uc3R5bGUgKSB7CgkJCWNvbnRpbnVlOwoJCX0KCQlpZiAoICFzaG93IHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIm5vbmUiIHx8IGVsZW0uc3R5bGUuZGlzcGxheSA9PT0gIiIgKSB7CgkJCWVsZW0uc3R5bGUuZGlzcGxheSA9IHNob3cgPyB2YWx1ZXNbIGluZGV4IF0gfHwgIiIgOiAibm9uZSI7CgkJfQoJfQoKCXJldHVybiBlbGVtZW50czsKfQoKalF1ZXJ5LmV4dGVuZCh7CgoJLy8gQWRkIGluIHN0eWxlIHByb3BlcnR5IGhvb2tzIGZvciBvdmVycmlkaW5nIHRoZSBkZWZhdWx0CgkvLyBiZWhhdmlvciBvZiBnZXR0aW5nIGFuZCBzZXR0aW5nIGEgc3R5bGUgcHJvcGVydHkKCWNzc0hvb2tzOiB7CgkJb3BhY2l0eTogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJCS8vIFdlIHNob3VsZCBhbHdheXMgZ2V0IGEgbnVtYmVyIGJhY2sgZnJvbSBvcGFjaXR5CgkJCQkJdmFyIHJldCA9IGN1ckNTUyggZWxlbSwgIm9wYWNpdHkiICk7CgkJCQkJcmV0dXJuIHJldCA9PT0gIiIgPyAiMSIgOiByZXQ7CgkJCQl9CgkJCX0KCQl9Cgl9LAoKCS8vIERvbid0IGF1dG9tYXRpY2FsbHkgYWRkICJweCIgdG8gdGhlc2UgcG9zc2libHktdW5pdGxlc3MgcHJvcGVydGllcwoJY3NzTnVtYmVyOiB7CgkJImNvbHVtbkNvdW50IjogdHJ1ZSwKCQkiZmlsbE9wYWNpdHkiOiB0cnVlLAoJCSJmbGV4R3JvdyI6IHRydWUsCgkJImZsZXhTaHJpbmsiOiB0cnVlLAoJCSJmb250V2VpZ2h0IjogdHJ1ZSwKCQkibGluZUhlaWdodCI6IHRydWUsCgkJIm9wYWNpdHkiOiB0cnVlLAoJCSJvcmRlciI6IHRydWUsCgkJIm9ycGhhbnMiOiB0cnVlLAoJCSJ3aWRvd3MiOiB0cnVlLAoJCSJ6SW5kZXgiOiB0cnVlLAoJCSJ6b29tIjogdHJ1ZQoJfSwKCgkvLyBBZGQgaW4gcHJvcGVydGllcyB3aG9zZSBuYW1lcyB5b3Ugd2lzaCB0byBmaXggYmVmb3JlCgkvLyBzZXR0aW5nIG9yIGdldHRpbmcgdGhlIHZhbHVlCgljc3NQcm9wczogewoJCSJmbG9hdCI6ICJjc3NGbG9hdCIKCX0sCgoJLy8gR2V0IGFuZCBzZXQgdGhlIHN0eWxlIHByb3BlcnR5IG9uIGEgRE9NIE5vZGUKCXN0eWxlOiBmdW5jdGlvbiggZWxlbSwgbmFtZSwgdmFsdWUsIGV4dHJhICkgewoKCQkvLyBEb24ndCBzZXQgc3R5bGVzIG9uIHRleHQgYW5kIGNvbW1lbnQgbm9kZXMKCQlpZiAoICFlbGVtIHx8IGVsZW0ubm9kZVR5cGUgPT09IDMgfHwgZWxlbS5ub2RlVHlwZSA9PT0gOCB8fCAhZWxlbS5zdHlsZSApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gTWFrZSBzdXJlIHRoYXQgd2UncmUgd29ya2luZyB3aXRoIHRoZSByaWdodCBuYW1lCgkJdmFyIHJldCwgdHlwZSwgaG9va3MsCgkJCW9yaWdOYW1lID0galF1ZXJ5LmNhbWVsQ2FzZSggbmFtZSApLAoJCQlzdHlsZSA9IGVsZW0uc3R5bGU7CgoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggc3R5bGUsIG9yaWdOYW1lICkgKTsKCgkJLy8gR2V0cyBob29rIGZvciB0aGUgcHJlZml4ZWQgdmVyc2lvbiwgdGhlbiB1bnByZWZpeGVkIHZlcnNpb24KCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdIHx8IGpRdWVyeS5jc3NIb29rc1sgb3JpZ05hbWUgXTsKCgkJLy8gQ2hlY2sgaWYgd2UncmUgc2V0dGluZyBhIHZhbHVlCgkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoJCQl0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQkJLy8gQ29udmVydCAiKz0iIG9yICItPSIgdG8gcmVsYXRpdmUgbnVtYmVycyAoIzczNDUpCgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgJiYgKHJldCA9IHJyZWxOdW0uZXhlYyggdmFsdWUgKSkgKSB7CgkJCQl2YWx1ZSA9ICggcmV0WzFdICsgMSApICogcmV0WzJdICsgcGFyc2VGbG9hdCggalF1ZXJ5LmNzcyggZWxlbSwgbmFtZSApICk7CgkJCQkvLyBGaXhlcyBidWcgIzkyMzcKCQkJCXR5cGUgPSAibnVtYmVyIjsKCQkJfQoKCQkJLy8gTWFrZSBzdXJlIHRoYXQgbnVsbCBhbmQgTmFOIHZhbHVlcyBhcmVuJ3Qgc2V0ICgjNzExNikKCQkJaWYgKCB2YWx1ZSA9PSBudWxsIHx8IHZhbHVlICE9PSB2YWx1ZSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gSWYgYSBudW1iZXIsIGFkZCAncHgnIHRvIHRoZSAoZXhjZXB0IGZvciBjZXJ0YWluIENTUyBwcm9wZXJ0aWVzKQoJCQlpZiAoIHR5cGUgPT09ICJudW1iZXIiICYmICFqUXVlcnkuY3NzTnVtYmVyWyBvcmlnTmFtZSBdICkgewoJCQkJdmFsdWUgKz0gInB4IjsKCQkJfQoKCQkJLy8gU3VwcG9ydDogSUU5LTExKwoJCQkvLyBiYWNrZ3JvdW5kLSogcHJvcHMgYWZmZWN0IG9yaWdpbmFsIGNsb25lJ3MgdmFsdWVzCgkJCWlmICggIXN1cHBvcnQuY2xlYXJDbG9uZVN0eWxlICYmIHZhbHVlID09PSAiIiAmJiBuYW1lLmluZGV4T2YoICJiYWNrZ3JvdW5kIiApID09PSAwICkgewoJCQkJc3R5bGVbIG5hbWUgXSA9ICJpbmhlcml0IjsKCQkJfQoKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCwgdXNlIHRoYXQgdmFsdWUsIG90aGVyd2lzZSBqdXN0IHNldCB0aGUgc3BlY2lmaWVkIHZhbHVlCgkJCWlmICggIWhvb2tzIHx8ICEoInNldCIgaW4gaG9va3MpIHx8ICh2YWx1ZSA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlzdHlsZVsgbmFtZSBdID0gdmFsdWU7CgkJCX0KCgkJfSBlbHNlIHsKCQkJLy8gSWYgYSBob29rIHdhcyBwcm92aWRlZCBnZXQgdGhlIG5vbi1jb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgZmFsc2UsIGV4dHJhICkpICE9PSB1bmRlZmluZWQgKSB7CgkJCQlyZXR1cm4gcmV0OwoJCQl9CgoJCQkvLyBPdGhlcndpc2UganVzdCBnZXQgdGhlIHZhbHVlIGZyb20gdGhlIHN0eWxlIG9iamVjdAoJCQlyZXR1cm4gc3R5bGVbIG5hbWUgXTsKCQl9Cgl9LAoKCWNzczogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIGV4dHJhLCBzdHlsZXMgKSB7CgkJdmFyIHZhbCwgbnVtLCBob29rcywKCQkJb3JpZ05hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBuYW1lICk7CgoJCS8vIE1ha2Ugc3VyZSB0aGF0IHdlJ3JlIHdvcmtpbmcgd2l0aCB0aGUgcmlnaHQgbmFtZQoJCW5hbWUgPSBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gfHwgKCBqUXVlcnkuY3NzUHJvcHNbIG9yaWdOYW1lIF0gPSB2ZW5kb3JQcm9wTmFtZSggZWxlbS5zdHlsZSwgb3JpZ05hbWUgKSApOwoKCQkvLyBUcnkgcHJlZml4ZWQgbmFtZSBmb2xsb3dlZCBieSB0aGUgdW5wcmVmaXhlZCBuYW1lCgkJaG9va3MgPSBqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSB8fCBqUXVlcnkuY3NzSG9va3NbIG9yaWdOYW1lIF07CgoJCS8vIElmIGEgaG9vayB3YXMgcHJvdmlkZWQgZ2V0IHRoZSBjb21wdXRlZCB2YWx1ZSBmcm9tIHRoZXJlCgkJaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyApIHsKCQkJdmFsID0gaG9va3MuZ2V0KCBlbGVtLCB0cnVlLCBleHRyYSApOwoJCX0KCgkJLy8gT3RoZXJ3aXNlLCBpZiBhIHdheSB0byBnZXQgdGhlIGNvbXB1dGVkIHZhbHVlIGV4aXN0cywgdXNlIHRoYXQKCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQl2YWwgPSBjdXJDU1MoIGVsZW0sIG5hbWUsIHN0eWxlcyApOwoJCX0KCgkJLy8gQ29udmVydCAibm9ybWFsIiB0byBjb21wdXRlZCB2YWx1ZQoJCWlmICggdmFsID09PSAibm9ybWFsIiAmJiBuYW1lIGluIGNzc05vcm1hbFRyYW5zZm9ybSApIHsKCQkJdmFsID0gY3NzTm9ybWFsVHJhbnNmb3JtWyBuYW1lIF07CgkJfQoKCQkvLyBNYWtlIG51bWVyaWMgaWYgZm9yY2VkIG9yIGEgcXVhbGlmaWVyIHdhcyBwcm92aWRlZCBhbmQgdmFsIGxvb2tzIG51bWVyaWMKCQlpZiAoIGV4dHJhID09PSAiIiB8fCBleHRyYSApIHsKCQkJbnVtID0gcGFyc2VGbG9hdCggdmFsICk7CgkJCXJldHVybiBleHRyYSA9PT0gdHJ1ZSB8fCBqUXVlcnkuaXNOdW1lcmljKCBudW0gKSA/IG51bSB8fCAwIDogdmFsOwoJCX0KCQlyZXR1cm4gdmFsOwoJfQp9KTsKCmpRdWVyeS5lYWNoKFsgImhlaWdodCIsICJ3aWR0aCIgXSwgZnVuY3Rpb24oIGksIG5hbWUgKSB7CglqUXVlcnkuY3NzSG9va3NbIG5hbWUgXSA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCwgZXh0cmEgKSB7CgkJCWlmICggY29tcHV0ZWQgKSB7CgoJCQkJLy8gQ2VydGFpbiBlbGVtZW50cyBjYW4gaGF2ZSBkaW1lbnNpb24gaW5mbyBpZiB3ZSBpbnZpc2libHkgc2hvdyB0aGVtCgkJCQkvLyBidXQgaXQgbXVzdCBoYXZlIGEgY3VycmVudCBkaXNwbGF5IHN0eWxlIHRoYXQgd291bGQgYmVuZWZpdAoJCQkJcmV0dXJuIHJkaXNwbGF5c3dhcC50ZXN0KCBqUXVlcnkuY3NzKCBlbGVtLCAiZGlzcGxheSIgKSApICYmIGVsZW0ub2Zmc2V0V2lkdGggPT09IDAgPwoJCQkJCWpRdWVyeS5zd2FwKCBlbGVtLCBjc3NTaG93LCBmdW5jdGlvbigpIHsKCQkJCQkJcmV0dXJuIGdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICk7CgkJCQkJfSkgOgoJCQkJCWdldFdpZHRoT3JIZWlnaHQoIGVsZW0sIG5hbWUsIGV4dHJhICk7CgkJCX0KCQl9LAoKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSwgZXh0cmEgKSB7CgkJCXZhciBzdHlsZXMgPSBleHRyYSAmJiBnZXRTdHlsZXMoIGVsZW0gKTsKCQkJcmV0dXJuIHNldFBvc2l0aXZlTnVtYmVyKCBlbGVtLCB2YWx1ZSwgZXh0cmEgPwoJCQkJYXVnbWVudFdpZHRoT3JIZWlnaHQoCgkJCQkJZWxlbSwKCQkJCQluYW1lLAoJCQkJCWV4dHJhLAoJCQkJCWpRdWVyeS5jc3MoIGVsZW0sICJib3hTaXppbmciLCBmYWxzZSwgc3R5bGVzICkgPT09ICJib3JkZXItYm94IiwKCQkJCQlzdHlsZXMKCQkJCSkgOiAwCgkJCSk7CgkJfQoJfTsKfSk7CgovLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwpqUXVlcnkuY3NzSG9va3MubWFyZ2luUmlnaHQgPSBhZGRHZXRIb29rSWYoIHN1cHBvcnQucmVsaWFibGVNYXJnaW5SaWdodCwKCWZ1bmN0aW9uKCBlbGVtLCBjb21wdXRlZCApIHsKCQlpZiAoIGNvbXB1dGVkICkgewoJCQlyZXR1cm4galF1ZXJ5LnN3YXAoIGVsZW0sIHsgImRpc3BsYXkiOiAiaW5saW5lLWJsb2NrIiB9LAoJCQkJY3VyQ1NTLCBbIGVsZW0sICJtYXJnaW5SaWdodCIgXSApOwoJCX0KCX0KKTsKCi8vIFRoZXNlIGhvb2tzIGFyZSB1c2VkIGJ5IGFuaW1hdGUgdG8gZXhwYW5kIHByb3BlcnRpZXMKalF1ZXJ5LmVhY2goewoJbWFyZ2luOiAiIiwKCXBhZGRpbmc6ICIiLAoJYm9yZGVyOiAiV2lkdGgiCn0sIGZ1bmN0aW9uKCBwcmVmaXgsIHN1ZmZpeCApIHsKCWpRdWVyeS5jc3NIb29rc1sgcHJlZml4ICsgc3VmZml4IF0gPSB7CgkJZXhwYW5kOiBmdW5jdGlvbiggdmFsdWUgKSB7CgkJCXZhciBpID0gMCwKCQkJCWV4cGFuZGVkID0ge30sCgoJCQkJLy8gQXNzdW1lcyBhIHNpbmdsZSBudW1iZXIgaWYgbm90IGEgc3RyaW5nCgkJCQlwYXJ0cyA9IHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIgPyB2YWx1ZS5zcGxpdCgiICIpIDogWyB2YWx1ZSBdOwoKCQkJZm9yICggOyBpIDwgNDsgaSsrICkgewoJCQkJZXhwYW5kZWRbIHByZWZpeCArIGNzc0V4cGFuZFsgaSBdICsgc3VmZml4IF0gPQoJCQkJCXBhcnRzWyBpIF0gfHwgcGFydHNbIGkgLSAyIF0gfHwgcGFydHNbIDAgXTsKCQkJfQoKCQkJcmV0dXJuIGV4cGFuZGVkOwoJCX0KCX07CgoJaWYgKCAhcm1hcmdpbi50ZXN0KCBwcmVmaXggKSApIHsKCQlqUXVlcnkuY3NzSG9va3NbIHByZWZpeCArIHN1ZmZpeCBdLnNldCA9IHNldFBvc2l0aXZlTnVtYmVyOwoJfQp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJY3NzOiBmdW5jdGlvbiggbmFtZSwgdmFsdWUgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCQl2YXIgc3R5bGVzLCBsZW4sCgkJCQltYXAgPSB7fSwKCQkJCWkgPSAwOwoKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggbmFtZSApICkgewoJCQkJc3R5bGVzID0gZ2V0U3R5bGVzKCBlbGVtICk7CgkJCQlsZW4gPSBuYW1lLmxlbmd0aDsKCgkJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCQltYXBbIG5hbWVbIGkgXSBdID0galF1ZXJ5LmNzcyggZWxlbSwgbmFtZVsgaSBdLCBmYWxzZSwgc3R5bGVzICk7CgkJCQl9CgoJCQkJcmV0dXJuIG1hcDsKCQkJfQoKCQkJcmV0dXJuIHZhbHVlICE9PSB1bmRlZmluZWQgPwoJCQkJalF1ZXJ5LnN0eWxlKCBlbGVtLCBuYW1lLCB2YWx1ZSApIDoKCQkJCWpRdWVyeS5jc3MoIGVsZW0sIG5hbWUgKTsKCQl9LCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCglzaG93OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMsIHRydWUgKTsKCX0sCgloaWRlOiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gc2hvd0hpZGUoIHRoaXMgKTsKCX0sCgl0b2dnbGU6IGZ1bmN0aW9uKCBzdGF0ZSApIHsKCQlpZiAoIHR5cGVvZiBzdGF0ZSA9PT0gImJvb2xlYW4iICkgewoJCQlyZXR1cm4gc3RhdGUgPyB0aGlzLnNob3coKSA6IHRoaXMuaGlkZSgpOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJaWYgKCBpc0hpZGRlbiggdGhpcyApICkgewoJCQkJalF1ZXJ5KCB0aGlzICkuc2hvdygpOwoJCQl9IGVsc2UgewoJCQkJalF1ZXJ5KCB0aGlzICkuaGlkZSgpOwoJCQl9CgkJfSk7Cgl9Cn0pOwoKCmZ1bmN0aW9uIFR3ZWVuKCBlbGVtLCBvcHRpb25zLCBwcm9wLCBlbmQsIGVhc2luZyApIHsKCXJldHVybiBuZXcgVHdlZW4ucHJvdG90eXBlLmluaXQoIGVsZW0sIG9wdGlvbnMsIHByb3AsIGVuZCwgZWFzaW5nICk7Cn0KalF1ZXJ5LlR3ZWVuID0gVHdlZW47CgpUd2Vlbi5wcm90b3R5cGUgPSB7Cgljb25zdHJ1Y3RvcjogVHdlZW4sCglpbml0OiBmdW5jdGlvbiggZWxlbSwgb3B0aW9ucywgcHJvcCwgZW5kLCBlYXNpbmcsIHVuaXQgKSB7CgkJdGhpcy5lbGVtID0gZWxlbTsKCQl0aGlzLnByb3AgPSBwcm9wOwoJCXRoaXMuZWFzaW5nID0gZWFzaW5nIHx8ICJzd2luZyI7CgkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCQl0aGlzLnN0YXJ0ID0gdGhpcy5ub3cgPSB0aGlzLmN1cigpOwoJCXRoaXMuZW5kID0gZW5kOwoJCXRoaXMudW5pdCA9IHVuaXQgfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKTsKCX0sCgljdXI6IGZ1bmN0aW9uKCkgewoJCXZhciBob29rcyA9IFR3ZWVuLnByb3BIb29rc1sgdGhpcy5wcm9wIF07CgoJCXJldHVybiBob29rcyAmJiBob29rcy5nZXQgPwoJCQlob29rcy5nZXQoIHRoaXMgKSA6CgkJCVR3ZWVuLnByb3BIb29rcy5fZGVmYXVsdC5nZXQoIHRoaXMgKTsKCX0sCglydW46IGZ1bmN0aW9uKCBwZXJjZW50ICkgewoJCXZhciBlYXNlZCwKCQkJaG9va3MgPSBUd2Vlbi5wcm9wSG9va3NbIHRoaXMucHJvcCBdOwoKCQlpZiAoIHRoaXMub3B0aW9ucy5kdXJhdGlvbiApIHsKCQkJdGhpcy5wb3MgPSBlYXNlZCA9IGpRdWVyeS5lYXNpbmdbIHRoaXMuZWFzaW5nIF0oCgkJCQlwZXJjZW50LCB0aGlzLm9wdGlvbnMuZHVyYXRpb24gKiBwZXJjZW50LCAwLCAxLCB0aGlzLm9wdGlvbnMuZHVyYXRpb24KCQkJKTsKCQl9IGVsc2UgewoJCQl0aGlzLnBvcyA9IGVhc2VkID0gcGVyY2VudDsKCQl9CgkJdGhpcy5ub3cgPSAoIHRoaXMuZW5kIC0gdGhpcy5zdGFydCApICogZWFzZWQgKyB0aGlzLnN0YXJ0OwoKCQlpZiAoIHRoaXMub3B0aW9ucy5zdGVwICkgewoJCQl0aGlzLm9wdGlvbnMuc3RlcC5jYWxsKCB0aGlzLmVsZW0sIHRoaXMubm93LCB0aGlzICk7CgkJfQoKCQlpZiAoIGhvb2tzICYmIGhvb2tzLnNldCApIHsKCQkJaG9va3Muc2V0KCB0aGlzICk7CgkJfSBlbHNlIHsKCQkJVHdlZW4ucHJvcEhvb2tzLl9kZWZhdWx0LnNldCggdGhpcyApOwoJCX0KCQlyZXR1cm4gdGhpczsKCX0KfTsKClR3ZWVuLnByb3RvdHlwZS5pbml0LnByb3RvdHlwZSA9IFR3ZWVuLnByb3RvdHlwZTsKClR3ZWVuLnByb3BIb29rcyA9IHsKCV9kZWZhdWx0OiB7CgkJZ2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCXZhciByZXN1bHQ7CgoJCQlpZiAoIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXSAhPSBudWxsICYmCgkJCQkoIXR3ZWVuLmVsZW0uc3R5bGUgfHwgdHdlZW4uZWxlbS5zdHlsZVsgdHdlZW4ucHJvcCBdID09IG51bGwpICkgewoJCQkJcmV0dXJuIHR3ZWVuLmVsZW1bIHR3ZWVuLnByb3AgXTsKCQkJfQoKCQkJLy8gUGFzc2luZyBhbiBlbXB0eSBzdHJpbmcgYXMgYSAzcmQgcGFyYW1ldGVyIHRvIC5jc3Mgd2lsbCBhdXRvbWF0aWNhbGx5CgkJCS8vIGF0dGVtcHQgYSBwYXJzZUZsb2F0IGFuZCBmYWxsYmFjayB0byBhIHN0cmluZyBpZiB0aGUgcGFyc2UgZmFpbHMuCgkJCS8vIFNpbXBsZSB2YWx1ZXMgc3VjaCBhcyAiMTBweCIgYXJlIHBhcnNlZCB0byBGbG9hdDsKCQkJLy8gY29tcGxleCB2YWx1ZXMgc3VjaCBhcyAicm90YXRlKDFyYWQpIiBhcmUgcmV0dXJuZWQgYXMtaXMuCgkJCXJlc3VsdCA9IGpRdWVyeS5jc3MoIHR3ZWVuLmVsZW0sIHR3ZWVuLnByb3AsICIiICk7CgkJCS8vIEVtcHR5IHN0cmluZ3MsIG51bGwsIHVuZGVmaW5lZCBhbmQgImF1dG8iIGFyZSBjb252ZXJ0ZWQgdG8gMC4KCQkJcmV0dXJuICFyZXN1bHQgfHwgcmVzdWx0ID09PSAiYXV0byIgPyAwIDogcmVzdWx0OwoJCX0sCgkJc2V0OiBmdW5jdGlvbiggdHdlZW4gKSB7CgkJCS8vIFVzZSBzdGVwIGhvb2sgZm9yIGJhY2sgY29tcGF0LgoJCQkvLyBVc2UgY3NzSG9vayBpZiBpdHMgdGhlcmUuCgkJCS8vIFVzZSAuc3R5bGUgaWYgYXZhaWxhYmxlIGFuZCB1c2UgcGxhaW4gcHJvcGVydGllcyB3aGVyZSBhdmFpbGFibGUuCgkJCWlmICggalF1ZXJ5LmZ4LnN0ZXBbIHR3ZWVuLnByb3AgXSApIHsKCQkJCWpRdWVyeS5meC5zdGVwWyB0d2Vlbi5wcm9wIF0oIHR3ZWVuICk7CgkJCX0gZWxzZSBpZiAoIHR3ZWVuLmVsZW0uc3R5bGUgJiYgKCB0d2Vlbi5lbGVtLnN0eWxlWyBqUXVlcnkuY3NzUHJvcHNbIHR3ZWVuLnByb3AgXSBdICE9IG51bGwgfHwgalF1ZXJ5LmNzc0hvb2tzWyB0d2Vlbi5wcm9wIF0gKSApIHsKCQkJCWpRdWVyeS5zdHlsZSggdHdlZW4uZWxlbSwgdHdlZW4ucHJvcCwgdHdlZW4ubm93ICsgdHdlZW4udW5pdCApOwoJCQl9IGVsc2UgewoJCQkJdHdlZW4uZWxlbVsgdHdlZW4ucHJvcCBdID0gdHdlZW4ubm93OwoJCQl9CgkJfQoJfQp9OwoKLy8gU3VwcG9ydDogSUU5Ci8vIFBhbmljIGJhc2VkIGFwcHJvYWNoIHRvIHNldHRpbmcgdGhpbmdzIG9uIGRpc2Nvbm5lY3RlZCBub2RlcwpUd2Vlbi5wcm9wSG9va3Muc2Nyb2xsVG9wID0gVHdlZW4ucHJvcEhvb2tzLnNjcm9sbExlZnQgPSB7CglzZXQ6IGZ1bmN0aW9uKCB0d2VlbiApIHsKCQlpZiAoIHR3ZWVuLmVsZW0ubm9kZVR5cGUgJiYgdHdlZW4uZWxlbS5wYXJlbnROb2RlICkgewoJCQl0d2Vlbi5lbGVtWyB0d2Vlbi5wcm9wIF0gPSB0d2Vlbi5ub3c7CgkJfQoJfQp9OwoKalF1ZXJ5LmVhc2luZyA9IHsKCWxpbmVhcjogZnVuY3Rpb24oIHAgKSB7CgkJcmV0dXJuIHA7Cgl9LAoJc3dpbmc6IGZ1bmN0aW9uKCBwICkgewoJCXJldHVybiAwLjUgLSBNYXRoLmNvcyggcCAqIE1hdGguUEkgKSAvIDI7Cgl9Cn07CgpqUXVlcnkuZnggPSBUd2Vlbi5wcm90b3R5cGUuaW5pdDsKCi8vIEJhY2sgQ29tcGF0IDwxLjggZXh0ZW5zaW9uIHBvaW50CmpRdWVyeS5meC5zdGVwID0ge307CgoKCgp2YXIKCWZ4Tm93LCB0aW1lcklkLAoJcmZ4dHlwZXMgPSAvXig/OnRvZ2dsZXxzaG93fGhpZGUpJC8sCglyZnhudW0gPSBuZXcgUmVnRXhwKCAiXig/OihbKy1dKT18KSgiICsgcG51bSArICIpKFthLXolXSopJCIsICJpIiApLAoJcnJ1biA9IC9xdWV1ZUhvb2tzJC8sCglhbmltYXRpb25QcmVmaWx0ZXJzID0gWyBkZWZhdWx0UHJlZmlsdGVyIF0sCgl0d2VlbmVycyA9IHsKCQkiKiI6IFsgZnVuY3Rpb24oIHByb3AsIHZhbHVlICkgewoJCQl2YXIgdHdlZW4gPSB0aGlzLmNyZWF0ZVR3ZWVuKCBwcm9wLCB2YWx1ZSApLAoJCQkJdGFyZ2V0ID0gdHdlZW4uY3VyKCksCgkJCQlwYXJ0cyA9IHJmeG51bS5leGVjKCB2YWx1ZSApLAoJCQkJdW5pdCA9IHBhcnRzICYmIHBhcnRzWyAzIF0gfHwgKCBqUXVlcnkuY3NzTnVtYmVyWyBwcm9wIF0gPyAiIiA6ICJweCIgKSwKCgkJCQkvLyBTdGFydGluZyB2YWx1ZSBjb21wdXRhdGlvbiBpcyByZXF1aXJlZCBmb3IgcG90ZW50aWFsIHVuaXQgbWlzbWF0Y2hlcwoJCQkJc3RhcnQgPSAoIGpRdWVyeS5jc3NOdW1iZXJbIHByb3AgXSB8fCB1bml0ICE9PSAicHgiICYmICt0YXJnZXQgKSAmJgoJCQkJCXJmeG51bS5leGVjKCBqUXVlcnkuY3NzKCB0d2Vlbi5lbGVtLCBwcm9wICkgKSwKCQkJCXNjYWxlID0gMSwKCQkJCW1heEl0ZXJhdGlvbnMgPSAyMDsKCgkJCWlmICggc3RhcnQgJiYgc3RhcnRbIDMgXSAhPT0gdW5pdCApIHsKCQkJCS8vIFRydXN0IHVuaXRzIHJlcG9ydGVkIGJ5IGpRdWVyeS5jc3MKCQkJCXVuaXQgPSB1bml0IHx8IHN0YXJ0WyAzIF07CgoJCQkJLy8gTWFrZSBzdXJlIHdlIHVwZGF0ZSB0aGUgdHdlZW4gcHJvcGVydGllcyBsYXRlciBvbgoJCQkJcGFydHMgPSBwYXJ0cyB8fCBbXTsKCgkJCQkvLyBJdGVyYXRpdmVseSBhcHByb3hpbWF0ZSBmcm9tIGEgbm9uemVybyBzdGFydGluZyBwb2ludAoJCQkJc3RhcnQgPSArdGFyZ2V0IHx8IDE7CgoJCQkJZG8gewoJCQkJCS8vIElmIHByZXZpb3VzIGl0ZXJhdGlvbiB6ZXJvZWQgb3V0LCBkb3VibGUgdW50aWwgd2UgZ2V0ICpzb21ldGhpbmcqLgoJCQkJCS8vIFVzZSBzdHJpbmcgZm9yIGRvdWJsaW5nIHNvIHdlIGRvbid0IGFjY2lkZW50YWxseSBzZWUgc2NhbGUgYXMgdW5jaGFuZ2VkIGJlbG93CgkJCQkJc2NhbGUgPSBzY2FsZSB8fCAiLjUiOwoKCQkJCQkvLyBBZGp1c3QgYW5kIGFwcGx5CgkJCQkJc3RhcnQgPSBzdGFydCAvIHNjYWxlOwoJCQkJCWpRdWVyeS5zdHlsZSggdHdlZW4uZWxlbSwgcHJvcCwgc3RhcnQgKyB1bml0ICk7CgoJCQkJLy8gVXBkYXRlIHNjYWxlLCB0b2xlcmF0aW5nIHplcm8gb3IgTmFOIGZyb20gdHdlZW4uY3VyKCksCgkJCQkvLyBicmVhayB0aGUgbG9vcCBpZiBzY2FsZSBpcyB1bmNoYW5nZWQgb3IgcGVyZmVjdCwgb3IgaWYgd2UndmUganVzdCBoYWQgZW5vdWdoCgkJCQl9IHdoaWxlICggc2NhbGUgIT09IChzY2FsZSA9IHR3ZWVuLmN1cigpIC8gdGFyZ2V0KSAmJiBzY2FsZSAhPT0gMSAmJiAtLW1heEl0ZXJhdGlvbnMgKTsKCQkJfQoKCQkJLy8gVXBkYXRlIHR3ZWVuIHByb3BlcnRpZXMKCQkJaWYgKCBwYXJ0cyApIHsKCQkJCXN0YXJ0ID0gdHdlZW4uc3RhcnQgPSArc3RhcnQgfHwgK3RhcmdldCB8fCAwOwoJCQkJdHdlZW4udW5pdCA9IHVuaXQ7CgkJCQkvLyBJZiBhICs9Ly09IHRva2VuIHdhcyBwcm92aWRlZCwgd2UncmUgZG9pbmcgYSByZWxhdGl2ZSBhbmltYXRpb24KCQkJCXR3ZWVuLmVuZCA9IHBhcnRzWyAxIF0gPwoJCQkJCXN0YXJ0ICsgKCBwYXJ0c1sgMSBdICsgMSApICogcGFydHNbIDIgXSA6CgkJCQkJK3BhcnRzWyAyIF07CgkJCX0KCgkJCXJldHVybiB0d2VlbjsKCQl9IF0KCX07CgovLyBBbmltYXRpb25zIGNyZWF0ZWQgc3luY2hyb25vdXNseSB3aWxsIHJ1biBzeW5jaHJvbm91c2x5CmZ1bmN0aW9uIGNyZWF0ZUZ4Tm93KCkgewoJc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQlmeE5vdyA9IHVuZGVmaW5lZDsKCX0pOwoJcmV0dXJuICggZnhOb3cgPSBqUXVlcnkubm93KCkgKTsKfQoKLy8gR2VuZXJhdGUgcGFyYW1ldGVycyB0byBjcmVhdGUgYSBzdGFuZGFyZCBhbmltYXRpb24KZnVuY3Rpb24gZ2VuRngoIHR5cGUsIGluY2x1ZGVXaWR0aCApIHsKCXZhciB3aGljaCwKCQlpID0gMCwKCQlhdHRycyA9IHsgaGVpZ2h0OiB0eXBlIH07CgoJLy8gSWYgd2UgaW5jbHVkZSB3aWR0aCwgc3RlcCB2YWx1ZSBpcyAxIHRvIGRvIGFsbCBjc3NFeHBhbmQgdmFsdWVzLAoJLy8gb3RoZXJ3aXNlIHN0ZXAgdmFsdWUgaXMgMiB0byBza2lwIG92ZXIgTGVmdCBhbmQgUmlnaHQKCWluY2x1ZGVXaWR0aCA9IGluY2x1ZGVXaWR0aCA/IDEgOiAwOwoJZm9yICggOyBpIDwgNCA7IGkgKz0gMiAtIGluY2x1ZGVXaWR0aCApIHsKCQl3aGljaCA9IGNzc0V4cGFuZFsgaSBdOwoJCWF0dHJzWyAibWFyZ2luIiArIHdoaWNoIF0gPSBhdHRyc1sgInBhZGRpbmciICsgd2hpY2ggXSA9IHR5cGU7Cgl9CgoJaWYgKCBpbmNsdWRlV2lkdGggKSB7CgkJYXR0cnMub3BhY2l0eSA9IGF0dHJzLndpZHRoID0gdHlwZTsKCX0KCglyZXR1cm4gYXR0cnM7Cn0KCmZ1bmN0aW9uIGNyZWF0ZVR3ZWVuKCB2YWx1ZSwgcHJvcCwgYW5pbWF0aW9uICkgewoJdmFyIHR3ZWVuLAoJCWNvbGxlY3Rpb24gPSAoIHR3ZWVuZXJzWyBwcm9wIF0gfHwgW10gKS5jb25jYXQoIHR3ZWVuZXJzWyAiKiIgXSApLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBjb2xsZWN0aW9uLmxlbmd0aDsKCWZvciAoIDsgaW5kZXggPCBsZW5ndGg7IGluZGV4KysgKSB7CgkJaWYgKCAodHdlZW4gPSBjb2xsZWN0aW9uWyBpbmRleCBdLmNhbGwoIGFuaW1hdGlvbiwgcHJvcCwgdmFsdWUgKSkgKSB7CgoJCQkvLyBXZSdyZSBkb25lIHdpdGggdGhpcyBwcm9wZXJ0eQoJCQlyZXR1cm4gdHdlZW47CgkJfQoJfQp9CgpmdW5jdGlvbiBkZWZhdWx0UHJlZmlsdGVyKCBlbGVtLCBwcm9wcywgb3B0cyApIHsKCS8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi8KCXZhciBwcm9wLCB2YWx1ZSwgdG9nZ2xlLCB0d2VlbiwgaG9va3MsIG9sZGZpcmUsIGRpc3BsYXksIGNoZWNrRGlzcGxheSwKCQlhbmltID0gdGhpcywKCQlvcmlnID0ge30sCgkJc3R5bGUgPSBlbGVtLnN0eWxlLAoJCWhpZGRlbiA9IGVsZW0ubm9kZVR5cGUgJiYgaXNIaWRkZW4oIGVsZW0gKSwKCQlkYXRhU2hvdyA9IGRhdGFfcHJpdi5nZXQoIGVsZW0sICJmeHNob3ciICk7CgoJLy8gSGFuZGxlIHF1ZXVlOiBmYWxzZSBwcm9taXNlcwoJaWYgKCAhb3B0cy5xdWV1ZSApIHsKCQlob29rcyA9IGpRdWVyeS5fcXVldWVIb29rcyggZWxlbSwgImZ4IiApOwoJCWlmICggaG9va3MudW5xdWV1ZWQgPT0gbnVsbCApIHsKCQkJaG9va3MudW5xdWV1ZWQgPSAwOwoJCQlvbGRmaXJlID0gaG9va3MuZW1wdHkuZmlyZTsKCQkJaG9va3MuZW1wdHkuZmlyZSA9IGZ1bmN0aW9uKCkgewoJCQkJaWYgKCAhaG9va3MudW5xdWV1ZWQgKSB7CgkJCQkJb2xkZmlyZSgpOwoJCQkJfQoJCQl9OwoJCX0KCQlob29rcy51bnF1ZXVlZCsrOwoKCQlhbmltLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJLy8gRW5zdXJlIHRoZSBjb21wbGV0ZSBoYW5kbGVyIGlzIGNhbGxlZCBiZWZvcmUgdGhpcyBjb21wbGV0ZXMKCQkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCQlob29rcy51bnF1ZXVlZC0tOwoJCQkJaWYgKCAhalF1ZXJ5LnF1ZXVlKCBlbGVtLCAiZngiICkubGVuZ3RoICkgewoJCQkJCWhvb2tzLmVtcHR5LmZpcmUoKTsKCQkJCX0KCQkJfSk7CgkJfSk7Cgl9CgoJLy8gSGVpZ2h0L3dpZHRoIG92ZXJmbG93IHBhc3MKCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoICJoZWlnaHQiIGluIHByb3BzIHx8ICJ3aWR0aCIgaW4gcHJvcHMgKSApIHsKCQkvLyBNYWtlIHN1cmUgdGhhdCBub3RoaW5nIHNuZWFrcyBvdXQKCQkvLyBSZWNvcmQgYWxsIDMgb3ZlcmZsb3cgYXR0cmlidXRlcyBiZWNhdXNlIElFOS0xMCBkbyBub3QKCQkvLyBjaGFuZ2UgdGhlIG92ZXJmbG93IGF0dHJpYnV0ZSB3aGVuIG92ZXJmbG93WCBhbmQKCQkvLyBvdmVyZmxvd1kgYXJlIHNldCB0byB0aGUgc2FtZSB2YWx1ZQoJCW9wdHMub3ZlcmZsb3cgPSBbIHN0eWxlLm92ZXJmbG93LCBzdHlsZS5vdmVyZmxvd1gsIHN0eWxlLm92ZXJmbG93WSBdOwoKCQkvLyBTZXQgZGlzcGxheSBwcm9wZXJ0eSB0byBpbmxpbmUtYmxvY2sgZm9yIGhlaWdodC93aWR0aAoJCS8vIGFuaW1hdGlvbnMgb24gaW5saW5lIGVsZW1lbnRzIHRoYXQgYXJlIGhhdmluZyB3aWR0aC9oZWlnaHQgYW5pbWF0ZWQKCQlkaXNwbGF5ID0galF1ZXJ5LmNzcyggZWxlbSwgImRpc3BsYXkiICk7CgoJCS8vIFRlc3QgZGVmYXVsdCBkaXNwbGF5IGlmIGRpc3BsYXkgaXMgY3VycmVudGx5ICJub25lIgoJCWNoZWNrRGlzcGxheSA9IGRpc3BsYXkgPT09ICJub25lIiA/CgkJCWRhdGFfcHJpdi5nZXQoIGVsZW0sICJvbGRkaXNwbGF5IiApIHx8IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgOiBkaXNwbGF5OwoKCQlpZiAoIGNoZWNrRGlzcGxheSA9PT0gImlubGluZSIgJiYgalF1ZXJ5LmNzcyggZWxlbSwgImZsb2F0IiApID09PSAibm9uZSIgKSB7CgkJCXN0eWxlLmRpc3BsYXkgPSAiaW5saW5lLWJsb2NrIjsKCQl9Cgl9CgoJaWYgKCBvcHRzLm92ZXJmbG93ICkgewoJCXN0eWxlLm92ZXJmbG93ID0gImhpZGRlbiI7CgkJYW5pbS5hbHdheXMoZnVuY3Rpb24oKSB7CgkJCXN0eWxlLm92ZXJmbG93ID0gb3B0cy5vdmVyZmxvd1sgMCBdOwoJCQlzdHlsZS5vdmVyZmxvd1ggPSBvcHRzLm92ZXJmbG93WyAxIF07CgkJCXN0eWxlLm92ZXJmbG93WSA9IG9wdHMub3ZlcmZsb3dbIDIgXTsKCQl9KTsKCX0KCgkvLyBzaG93L2hpZGUgcGFzcwoJZm9yICggcHJvcCBpbiBwcm9wcyApIHsKCQl2YWx1ZSA9IHByb3BzWyBwcm9wIF07CgkJaWYgKCByZnh0eXBlcy5leGVjKCB2YWx1ZSApICkgewoJCQlkZWxldGUgcHJvcHNbIHByb3AgXTsKCQkJdG9nZ2xlID0gdG9nZ2xlIHx8IHZhbHVlID09PSAidG9nZ2xlIjsKCQkJaWYgKCB2YWx1ZSA9PT0gKCBoaWRkZW4gPyAiaGlkZSIgOiAic2hvdyIgKSApIHsKCgkJCQkvLyBJZiB0aGVyZSBpcyBkYXRhU2hvdyBsZWZ0IG92ZXIgZnJvbSBhIHN0b3BwZWQgaGlkZSBvciBzaG93IGFuZCB3ZSBhcmUgZ29pbmcgdG8gcHJvY2VlZCB3aXRoIHNob3csIHdlIHNob3VsZCBwcmV0ZW5kIHRvIGJlIGhpZGRlbgoJCQkJaWYgKCB2YWx1ZSA9PT0gInNob3ciICYmIGRhdGFTaG93ICYmIGRhdGFTaG93WyBwcm9wIF0gIT09IHVuZGVmaW5lZCApIHsKCQkJCQloaWRkZW4gPSB0cnVlOwoJCQkJfSBlbHNlIHsKCQkJCQljb250aW51ZTsKCQkJCX0KCQkJfQoJCQlvcmlnWyBwcm9wIF0gPSBkYXRhU2hvdyAmJiBkYXRhU2hvd1sgcHJvcCBdIHx8IGpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCApOwoKCQkvLyBBbnkgbm9uLWZ4IHZhbHVlIHN0b3BzIHVzIGZyb20gcmVzdG9yaW5nIHRoZSBvcmlnaW5hbCBkaXNwbGF5IHZhbHVlCgkJfSBlbHNlIHsKCQkJZGlzcGxheSA9IHVuZGVmaW5lZDsKCQl9Cgl9CgoJaWYgKCAhalF1ZXJ5LmlzRW1wdHlPYmplY3QoIG9yaWcgKSApIHsKCQlpZiAoIGRhdGFTaG93ICkgewoJCQlpZiAoICJoaWRkZW4iIGluIGRhdGFTaG93ICkgewoJCQkJaGlkZGVuID0gZGF0YVNob3cuaGlkZGVuOwoJCQl9CgkJfSBlbHNlIHsKCQkJZGF0YVNob3cgPSBkYXRhX3ByaXYuYWNjZXNzKCBlbGVtLCAiZnhzaG93Iiwge30gKTsKCQl9CgoJCS8vIFN0b3JlIHN0YXRlIGlmIGl0cyB0b2dnbGUgLSBlbmFibGVzIC5zdG9wKCkudG9nZ2xlKCkgdG8gInJldmVyc2UiCgkJaWYgKCB0b2dnbGUgKSB7CgkJCWRhdGFTaG93LmhpZGRlbiA9ICFoaWRkZW47CgkJfQoJCWlmICggaGlkZGVuICkgewoJCQlqUXVlcnkoIGVsZW0gKS5zaG93KCk7CgkJfSBlbHNlIHsKCQkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQkJalF1ZXJ5KCBlbGVtICkuaGlkZSgpOwoJCQl9KTsKCQl9CgkJYW5pbS5kb25lKGZ1bmN0aW9uKCkgewoJCQl2YXIgcHJvcDsKCgkJCWRhdGFfcHJpdi5yZW1vdmUoIGVsZW0sICJmeHNob3ciICk7CgkJCWZvciAoIHByb3AgaW4gb3JpZyApIHsKCQkJCWpRdWVyeS5zdHlsZSggZWxlbSwgcHJvcCwgb3JpZ1sgcHJvcCBdICk7CgkJCX0KCQl9KTsKCQlmb3IgKCBwcm9wIGluIG9yaWcgKSB7CgkJCXR3ZWVuID0gY3JlYXRlVHdlZW4oIGhpZGRlbiA/IGRhdGFTaG93WyBwcm9wIF0gOiAwLCBwcm9wLCBhbmltICk7CgoJCQlpZiAoICEoIHByb3AgaW4gZGF0YVNob3cgKSApIHsKCQkJCWRhdGFTaG93WyBwcm9wIF0gPSB0d2Vlbi5zdGFydDsKCQkJCWlmICggaGlkZGVuICkgewoJCQkJCXR3ZWVuLmVuZCA9IHR3ZWVuLnN0YXJ0OwoJCQkJCXR3ZWVuLnN0YXJ0ID0gcHJvcCA9PT0gIndpZHRoIiB8fCBwcm9wID09PSAiaGVpZ2h0IiA/IDEgOiAwOwoJCQkJfQoJCQl9CgkJfQoKCS8vIElmIHRoaXMgaXMgYSBub29wIGxpa2UgLmhpZGUoKS5oaWRlKCksIHJlc3RvcmUgYW4gb3ZlcndyaXR0ZW4gZGlzcGxheSB2YWx1ZQoJfSBlbHNlIGlmICggKGRpc3BsYXkgPT09ICJub25lIiA/IGRlZmF1bHREaXNwbGF5KCBlbGVtLm5vZGVOYW1lICkgOiBkaXNwbGF5KSA9PT0gImlubGluZSIgKSB7CgkJc3R5bGUuZGlzcGxheSA9IGRpc3BsYXk7Cgl9Cn0KCmZ1bmN0aW9uIHByb3BGaWx0ZXIoIHByb3BzLCBzcGVjaWFsRWFzaW5nICkgewoJdmFyIGluZGV4LCBuYW1lLCBlYXNpbmcsIHZhbHVlLCBob29rczsKCgkvLyBjYW1lbENhc2UsIHNwZWNpYWxFYXNpbmcgYW5kIGV4cGFuZCBjc3NIb29rIHBhc3MKCWZvciAoIGluZGV4IGluIHByb3BzICkgewoJCW5hbWUgPSBqUXVlcnkuY2FtZWxDYXNlKCBpbmRleCApOwoJCWVhc2luZyA9IHNwZWNpYWxFYXNpbmdbIG5hbWUgXTsKCQl2YWx1ZSA9IHByb3BzWyBpbmRleCBdOwoJCWlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7CgkJCWVhc2luZyA9IHZhbHVlWyAxIF07CgkJCXZhbHVlID0gcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgMCBdOwoJCX0KCgkJaWYgKCBpbmRleCAhPT0gbmFtZSApIHsKCQkJcHJvcHNbIG5hbWUgXSA9IHZhbHVlOwoJCQlkZWxldGUgcHJvcHNbIGluZGV4IF07CgkJfQoKCQlob29rcyA9IGpRdWVyeS5jc3NIb29rc1sgbmFtZSBdOwoJCWlmICggaG9va3MgJiYgImV4cGFuZCIgaW4gaG9va3MgKSB7CgkJCXZhbHVlID0gaG9va3MuZXhwYW5kKCB2YWx1ZSApOwoJCQlkZWxldGUgcHJvcHNbIG5hbWUgXTsKCgkJCS8vIE5vdCBxdWl0ZSAkLmV4dGVuZCwgdGhpcyB3b24ndCBvdmVyd3JpdGUgZXhpc3Rpbmcga2V5cy4KCQkJLy8gUmV1c2luZyAnaW5kZXgnIGJlY2F1c2Ugd2UgaGF2ZSB0aGUgY29ycmVjdCAibmFtZSIKCQkJZm9yICggaW5kZXggaW4gdmFsdWUgKSB7CgkJCQlpZiAoICEoIGluZGV4IGluIHByb3BzICkgKSB7CgkJCQkJcHJvcHNbIGluZGV4IF0gPSB2YWx1ZVsgaW5kZXggXTsKCQkJCQlzcGVjaWFsRWFzaW5nWyBpbmRleCBdID0gZWFzaW5nOwoJCQkJfQoJCQl9CgkJfSBlbHNlIHsKCQkJc3BlY2lhbEVhc2luZ1sgbmFtZSBdID0gZWFzaW5nOwoJCX0KCX0KfQoKZnVuY3Rpb24gQW5pbWF0aW9uKCBlbGVtLCBwcm9wZXJ0aWVzLCBvcHRpb25zICkgewoJdmFyIHJlc3VsdCwKCQlzdG9wcGVkLAoJCWluZGV4ID0gMCwKCQlsZW5ndGggPSBhbmltYXRpb25QcmVmaWx0ZXJzLmxlbmd0aCwKCQlkZWZlcnJlZCA9IGpRdWVyeS5EZWZlcnJlZCgpLmFsd2F5cyggZnVuY3Rpb24oKSB7CgkJCS8vIERvbid0IG1hdGNoIGVsZW0gaW4gdGhlIDphbmltYXRlZCBzZWxlY3RvcgoJCQlkZWxldGUgdGljay5lbGVtOwoJCX0pLAoJCXRpY2sgPSBmdW5jdGlvbigpIHsKCQkJaWYgKCBzdG9wcGVkICkgewoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJCXZhciBjdXJyZW50VGltZSA9IGZ4Tm93IHx8IGNyZWF0ZUZ4Tm93KCksCgkJCQlyZW1haW5pbmcgPSBNYXRoLm1heCggMCwgYW5pbWF0aW9uLnN0YXJ0VGltZSArIGFuaW1hdGlvbi5kdXJhdGlvbiAtIGN1cnJlbnRUaW1lICksCgkJCQkvLyBTdXBwb3J0OiBBbmRyb2lkIDIuMwoJCQkJLy8gQXJjaGFpYyBjcmFzaCBidWcgd29uJ3QgYWxsb3cgdXMgdG8gdXNlIGAxIC0gKCAwLjUgfHwgMCApYCAoIzEyNDk3KQoJCQkJdGVtcCA9IHJlbWFpbmluZyAvIGFuaW1hdGlvbi5kdXJhdGlvbiB8fCAwLAoJCQkJcGVyY2VudCA9IDEgLSB0ZW1wLAoJCQkJaW5kZXggPSAwLAoJCQkJbGVuZ3RoID0gYW5pbWF0aW9uLnR3ZWVucy5sZW5ndGg7CgoJCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCBwZXJjZW50ICk7CgkJCX0KCgkJCWRlZmVycmVkLm5vdGlmeVdpdGgoIGVsZW0sIFsgYW5pbWF0aW9uLCBwZXJjZW50LCByZW1haW5pbmcgXSk7CgoJCQlpZiAoIHBlcmNlbnQgPCAxICYmIGxlbmd0aCApIHsKCQkJCXJldHVybiByZW1haW5pbmc7CgkJCX0gZWxzZSB7CgkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24gXSApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfSwKCQlhbmltYXRpb24gPSBkZWZlcnJlZC5wcm9taXNlKHsKCQkJZWxlbTogZWxlbSwKCQkJcHJvcHM6IGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wZXJ0aWVzICksCgkJCW9wdHM6IGpRdWVyeS5leHRlbmQoIHRydWUsIHsgc3BlY2lhbEVhc2luZzoge30gfSwgb3B0aW9ucyApLAoJCQlvcmlnaW5hbFByb3BlcnRpZXM6IHByb3BlcnRpZXMsCgkJCW9yaWdpbmFsT3B0aW9uczogb3B0aW9ucywKCQkJc3RhcnRUaW1lOiBmeE5vdyB8fCBjcmVhdGVGeE5vdygpLAoJCQlkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKCQkJdHdlZW5zOiBbXSwKCQkJY3JlYXRlVHdlZW46IGZ1bmN0aW9uKCBwcm9wLCBlbmQgKSB7CgkJCQl2YXIgdHdlZW4gPSBqUXVlcnkuVHdlZW4oIGVsZW0sIGFuaW1hdGlvbi5vcHRzLCBwcm9wLCBlbmQsCgkJCQkJCWFuaW1hdGlvbi5vcHRzLnNwZWNpYWxFYXNpbmdbIHByb3AgXSB8fCBhbmltYXRpb24ub3B0cy5lYXNpbmcgKTsKCQkJCWFuaW1hdGlvbi50d2VlbnMucHVzaCggdHdlZW4gKTsKCQkJCXJldHVybiB0d2VlbjsKCQkJfSwKCQkJc3RvcDogZnVuY3Rpb24oIGdvdG9FbmQgKSB7CgkJCQl2YXIgaW5kZXggPSAwLAoJCQkJCS8vIElmIHdlIGFyZSBnb2luZyB0byB0aGUgZW5kLCB3ZSB3YW50IHRvIHJ1biBhbGwgdGhlIHR3ZWVucwoJCQkJCS8vIG90aGVyd2lzZSB3ZSBza2lwIHRoaXMgcGFydAoJCQkJCWxlbmd0aCA9IGdvdG9FbmQgPyBhbmltYXRpb24udHdlZW5zLmxlbmd0aCA6IDA7CgkJCQlpZiAoIHN0b3BwZWQgKSB7CgkJCQkJcmV0dXJuIHRoaXM7CgkJCQl9CgkJCQlzdG9wcGVkID0gdHJ1ZTsKCQkJCWZvciAoIDsgaW5kZXggPCBsZW5ndGggOyBpbmRleCsrICkgewoJCQkJCWFuaW1hdGlvbi50d2VlbnNbIGluZGV4IF0ucnVuKCAxICk7CgkJCQl9CgoJCQkJLy8gUmVzb2x2ZSB3aGVuIHdlIHBsYXllZCB0aGUgbGFzdCBmcmFtZTsgb3RoZXJ3aXNlLCByZWplY3QKCQkJCWlmICggZ290b0VuZCApIHsKCQkJCQlkZWZlcnJlZC5yZXNvbHZlV2l0aCggZWxlbSwgWyBhbmltYXRpb24sIGdvdG9FbmQgXSApOwoJCQkJfSBlbHNlIHsKCQkJCQlkZWZlcnJlZC5yZWplY3RXaXRoKCBlbGVtLCBbIGFuaW1hdGlvbiwgZ290b0VuZCBdICk7CgkJCQl9CgkJCQlyZXR1cm4gdGhpczsKCQkJfQoJCX0pLAoJCXByb3BzID0gYW5pbWF0aW9uLnByb3BzOwoKCXByb3BGaWx0ZXIoIHByb3BzLCBhbmltYXRpb24ub3B0cy5zcGVjaWFsRWFzaW5nICk7CgoJZm9yICggOyBpbmRleCA8IGxlbmd0aCA7IGluZGV4KysgKSB7CgkJcmVzdWx0ID0gYW5pbWF0aW9uUHJlZmlsdGVyc1sgaW5kZXggXS5jYWxsKCBhbmltYXRpb24sIGVsZW0sIHByb3BzLCBhbmltYXRpb24ub3B0cyApOwoJCWlmICggcmVzdWx0ICkgewoJCQlyZXR1cm4gcmVzdWx0OwoJCX0KCX0KCglqUXVlcnkubWFwKCBwcm9wcywgY3JlYXRlVHdlZW4sIGFuaW1hdGlvbiApOwoKCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGFuaW1hdGlvbi5vcHRzLnN0YXJ0ICkgKSB7CgkJYW5pbWF0aW9uLm9wdHMuc3RhcnQuY2FsbCggZWxlbSwgYW5pbWF0aW9uICk7Cgl9CgoJalF1ZXJ5LmZ4LnRpbWVyKAoJCWpRdWVyeS5leHRlbmQoIHRpY2ssIHsKCQkJZWxlbTogZWxlbSwKCQkJYW5pbTogYW5pbWF0aW9uLAoJCQlxdWV1ZTogYW5pbWF0aW9uLm9wdHMucXVldWUKCQl9KQoJKTsKCgkvLyBhdHRhY2ggY2FsbGJhY2tzIGZyb20gb3B0aW9ucwoJcmV0dXJuIGFuaW1hdGlvbi5wcm9ncmVzcyggYW5pbWF0aW9uLm9wdHMucHJvZ3Jlc3MgKQoJCS5kb25lKCBhbmltYXRpb24ub3B0cy5kb25lLCBhbmltYXRpb24ub3B0cy5jb21wbGV0ZSApCgkJLmZhaWwoIGFuaW1hdGlvbi5vcHRzLmZhaWwgKQoJCS5hbHdheXMoIGFuaW1hdGlvbi5vcHRzLmFsd2F5cyApOwp9CgpqUXVlcnkuQW5pbWF0aW9uID0galF1ZXJ5LmV4dGVuZCggQW5pbWF0aW9uLCB7CgoJdHdlZW5lcjogZnVuY3Rpb24oIHByb3BzLCBjYWxsYmFjayApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBwcm9wcyApICkgewoJCQljYWxsYmFjayA9IHByb3BzOwoJCQlwcm9wcyA9IFsgIioiIF07CgkJfSBlbHNlIHsKCQkJcHJvcHMgPSBwcm9wcy5zcGxpdCgiICIpOwoJCX0KCgkJdmFyIHByb3AsCgkJCWluZGV4ID0gMCwKCQkJbGVuZ3RoID0gcHJvcHMubGVuZ3RoOwoKCQlmb3IgKCA7IGluZGV4IDwgbGVuZ3RoIDsgaW5kZXgrKyApIHsKCQkJcHJvcCA9IHByb3BzWyBpbmRleCBdOwoJCQl0d2VlbmVyc1sgcHJvcCBdID0gdHdlZW5lcnNbIHByb3AgXSB8fCBbXTsKCQkJdHdlZW5lcnNbIHByb3AgXS51bnNoaWZ0KCBjYWxsYmFjayApOwoJCX0KCX0sCgoJcHJlZmlsdGVyOiBmdW5jdGlvbiggY2FsbGJhY2ssIHByZXBlbmQgKSB7CgkJaWYgKCBwcmVwZW5kICkgewoJCQlhbmltYXRpb25QcmVmaWx0ZXJzLnVuc2hpZnQoIGNhbGxiYWNrICk7CgkJfSBlbHNlIHsKCQkJYW5pbWF0aW9uUHJlZmlsdGVycy5wdXNoKCBjYWxsYmFjayApOwoJCX0KCX0KfSk7CgpqUXVlcnkuc3BlZWQgPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgZm4gKSB7Cgl2YXIgb3B0ID0gc3BlZWQgJiYgdHlwZW9mIHNwZWVkID09PSAib2JqZWN0IiA/IGpRdWVyeS5leHRlbmQoIHt9LCBzcGVlZCApIDogewoJCWNvbXBsZXRlOiBmbiB8fCAhZm4gJiYgZWFzaW5nIHx8CgkJCWpRdWVyeS5pc0Z1bmN0aW9uKCBzcGVlZCApICYmIHNwZWVkLAoJCWR1cmF0aW9uOiBzcGVlZCwKCQllYXNpbmc6IGZuICYmIGVhc2luZyB8fCBlYXNpbmcgJiYgIWpRdWVyeS5pc0Z1bmN0aW9uKCBlYXNpbmcgKSAmJiBlYXNpbmcKCX07CgoJb3B0LmR1cmF0aW9uID0galF1ZXJ5LmZ4Lm9mZiA/IDAgOiB0eXBlb2Ygb3B0LmR1cmF0aW9uID09PSAibnVtYmVyIiA/IG9wdC5kdXJhdGlvbiA6CgkJb3B0LmR1cmF0aW9uIGluIGpRdWVyeS5meC5zcGVlZHMgPyBqUXVlcnkuZnguc3BlZWRzWyBvcHQuZHVyYXRpb24gXSA6IGpRdWVyeS5meC5zcGVlZHMuX2RlZmF1bHQ7CgoJLy8gTm9ybWFsaXplIG9wdC5xdWV1ZSAtIHRydWUvdW5kZWZpbmVkL251bGwgLT4gImZ4IgoJaWYgKCBvcHQucXVldWUgPT0gbnVsbCB8fCBvcHQucXVldWUgPT09IHRydWUgKSB7CgkJb3B0LnF1ZXVlID0gImZ4IjsKCX0KCgkvLyBRdWV1ZWluZwoJb3B0Lm9sZCA9IG9wdC5jb21wbGV0ZTsKCglvcHQuY29tcGxldGUgPSBmdW5jdGlvbigpIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHQub2xkICkgKSB7CgkJCW9wdC5vbGQuY2FsbCggdGhpcyApOwoJCX0KCgkJaWYgKCBvcHQucXVldWUgKSB7CgkJCWpRdWVyeS5kZXF1ZXVlKCB0aGlzLCBvcHQucXVldWUgKTsKCQl9Cgl9OwoKCXJldHVybiBvcHQ7Cn07CgpqUXVlcnkuZm4uZXh0ZW5kKHsKCWZhZGVUbzogZnVuY3Rpb24oIHNwZWVkLCB0bywgZWFzaW5nLCBjYWxsYmFjayApIHsKCgkJLy8gU2hvdyBhbnkgaGlkZGVuIGVsZW1lbnRzIGFmdGVyIHNldHRpbmcgb3BhY2l0eSB0byAwCgkJcmV0dXJuIHRoaXMuZmlsdGVyKCBpc0hpZGRlbiApLmNzcyggIm9wYWNpdHkiLCAwICkuc2hvdygpCgoJCQkvLyBBbmltYXRlIHRvIHRoZSB2YWx1ZSBzcGVjaWZpZWQKCQkJLmVuZCgpLmFuaW1hdGUoeyBvcGFjaXR5OiB0byB9LCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfSwKCWFuaW1hdGU6IGZ1bmN0aW9uKCBwcm9wLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApIHsKCQl2YXIgZW1wdHkgPSBqUXVlcnkuaXNFbXB0eU9iamVjdCggcHJvcCApLAoJCQlvcHRhbGwgPSBqUXVlcnkuc3BlZWQoIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICksCgkJCWRvQW5pbWF0aW9uID0gZnVuY3Rpb24oKSB7CgkJCQkvLyBPcGVyYXRlIG9uIGEgY29weSBvZiBwcm9wIHNvIHBlci1wcm9wZXJ0eSBlYXNpbmcgd29uJ3QgYmUgbG9zdAoJCQkJdmFyIGFuaW0gPSBBbmltYXRpb24oIHRoaXMsIGpRdWVyeS5leHRlbmQoIHt9LCBwcm9wICksIG9wdGFsbCApOwoKCQkJCS8vIEVtcHR5IGFuaW1hdGlvbnMsIG9yIGZpbmlzaGluZyByZXNvbHZlcyBpbW1lZGlhdGVseQoJCQkJaWYgKCBlbXB0eSB8fCBkYXRhX3ByaXYuZ2V0KCB0aGlzLCAiZmluaXNoIiApICkgewoJCQkJCWFuaW0uc3RvcCggdHJ1ZSApOwoJCQkJfQoJCQl9OwoJCQlkb0FuaW1hdGlvbi5maW5pc2ggPSBkb0FuaW1hdGlvbjsKCgkJcmV0dXJuIGVtcHR5IHx8IG9wdGFsbC5xdWV1ZSA9PT0gZmFsc2UgPwoJCQl0aGlzLmVhY2goIGRvQW5pbWF0aW9uICkgOgoJCQl0aGlzLnF1ZXVlKCBvcHRhbGwucXVldWUsIGRvQW5pbWF0aW9uICk7Cgl9LAoJc3RvcDogZnVuY3Rpb24oIHR5cGUsIGNsZWFyUXVldWUsIGdvdG9FbmQgKSB7CgkJdmFyIHN0b3BRdWV1ZSA9IGZ1bmN0aW9uKCBob29rcyApIHsKCQkJdmFyIHN0b3AgPSBob29rcy5zdG9wOwoJCQlkZWxldGUgaG9va3Muc3RvcDsKCQkJc3RvcCggZ290b0VuZCApOwoJCX07CgoJCWlmICggdHlwZW9mIHR5cGUgIT09ICJzdHJpbmciICkgewoJCQlnb3RvRW5kID0gY2xlYXJRdWV1ZTsKCQkJY2xlYXJRdWV1ZSA9IHR5cGU7CgkJCXR5cGUgPSB1bmRlZmluZWQ7CgkJfQoJCWlmICggY2xlYXJRdWV1ZSAmJiB0eXBlICE9PSBmYWxzZSApIHsKCQkJdGhpcy5xdWV1ZSggdHlwZSB8fCAiZngiLCBbXSApOwoJCX0KCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJdmFyIGRlcXVldWUgPSB0cnVlLAoJCQkJaW5kZXggPSB0eXBlICE9IG51bGwgJiYgdHlwZSArICJxdWV1ZUhvb2tzIiwKCQkJCXRpbWVycyA9IGpRdWVyeS50aW1lcnMsCgkJCQlkYXRhID0gZGF0YV9wcml2LmdldCggdGhpcyApOwoKCQkJaWYgKCBpbmRleCApIHsKCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgKSB7CgkJCQkJc3RvcFF1ZXVlKCBkYXRhWyBpbmRleCBdICk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlmb3IgKCBpbmRleCBpbiBkYXRhICkgewoJCQkJCWlmICggZGF0YVsgaW5kZXggXSAmJiBkYXRhWyBpbmRleCBdLnN0b3AgJiYgcnJ1bi50ZXN0KCBpbmRleCApICkgewoJCQkJCQlzdG9wUXVldWUoIGRhdGFbIGluZGV4IF0gKTsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCWZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7CgkJCQlpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmICh0eXBlID09IG51bGwgfHwgdGltZXJzWyBpbmRleCBdLnF1ZXVlID09PSB0eXBlKSApIHsKCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCBnb3RvRW5kICk7CgkJCQkJZGVxdWV1ZSA9IGZhbHNlOwoJCQkJCXRpbWVycy5zcGxpY2UoIGluZGV4LCAxICk7CgkJCQl9CgkJCX0KCgkJCS8vIFN0YXJ0IHRoZSBuZXh0IGluIHRoZSBxdWV1ZSBpZiB0aGUgbGFzdCBzdGVwIHdhc24ndCBmb3JjZWQuCgkJCS8vIFRpbWVycyBjdXJyZW50bHkgd2lsbCBjYWxsIHRoZWlyIGNvbXBsZXRlIGNhbGxiYWNrcywgd2hpY2gKCQkJLy8gd2lsbCBkZXF1ZXVlIGJ1dCBvbmx5IGlmIHRoZXkgd2VyZSBnb3RvRW5kLgoJCQlpZiAoIGRlcXVldWUgfHwgIWdvdG9FbmQgKSB7CgkJCQlqUXVlcnkuZGVxdWV1ZSggdGhpcywgdHlwZSApOwoJCQl9CgkJfSk7Cgl9LAoJZmluaXNoOiBmdW5jdGlvbiggdHlwZSApIHsKCQlpZiAoIHR5cGUgIT09IGZhbHNlICkgewoJCQl0eXBlID0gdHlwZSB8fCAiZngiOwoJCX0KCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkgewoJCQl2YXIgaW5kZXgsCgkJCQlkYXRhID0gZGF0YV9wcml2LmdldCggdGhpcyApLAoJCQkJcXVldWUgPSBkYXRhWyB0eXBlICsgInF1ZXVlIiBdLAoJCQkJaG9va3MgPSBkYXRhWyB0eXBlICsgInF1ZXVlSG9va3MiIF0sCgkJCQl0aW1lcnMgPSBqUXVlcnkudGltZXJzLAoJCQkJbGVuZ3RoID0gcXVldWUgPyBxdWV1ZS5sZW5ndGggOiAwOwoKCQkJLy8gRW5hYmxlIGZpbmlzaGluZyBmbGFnIG9uIHByaXZhdGUgZGF0YQoJCQlkYXRhLmZpbmlzaCA9IHRydWU7CgoJCQkvLyBFbXB0eSB0aGUgcXVldWUgZmlyc3QKCQkJalF1ZXJ5LnF1ZXVlKCB0aGlzLCB0eXBlLCBbXSApOwoKCQkJaWYgKCBob29rcyAmJiBob29rcy5zdG9wICkgewoJCQkJaG9va3Muc3RvcC5jYWxsKCB0aGlzLCB0cnVlICk7CgkJCX0KCgkJCS8vIExvb2sgZm9yIGFueSBhY3RpdmUgYW5pbWF0aW9ucywgYW5kIGZpbmlzaCB0aGVtCgkJCWZvciAoIGluZGV4ID0gdGltZXJzLmxlbmd0aDsgaW5kZXgtLTsgKSB7CgkJCQlpZiAoIHRpbWVyc1sgaW5kZXggXS5lbGVtID09PSB0aGlzICYmIHRpbWVyc1sgaW5kZXggXS5xdWV1ZSA9PT0gdHlwZSApIHsKCQkJCQl0aW1lcnNbIGluZGV4IF0uYW5pbS5zdG9wKCB0cnVlICk7CgkJCQkJdGltZXJzLnNwbGljZSggaW5kZXgsIDEgKTsKCQkJCX0KCQkJfQoKCQkJLy8gTG9vayBmb3IgYW55IGFuaW1hdGlvbnMgaW4gdGhlIG9sZCBxdWV1ZSBhbmQgZmluaXNoIHRoZW0KCQkJZm9yICggaW5kZXggPSAwOyBpbmRleCA8IGxlbmd0aDsgaW5kZXgrKyApIHsKCQkJCWlmICggcXVldWVbIGluZGV4IF0gJiYgcXVldWVbIGluZGV4IF0uZmluaXNoICkgewoJCQkJCXF1ZXVlWyBpbmRleCBdLmZpbmlzaC5jYWxsKCB0aGlzICk7CgkJCQl9CgkJCX0KCgkJCS8vIFR1cm4gb2ZmIGZpbmlzaGluZyBmbGFnCgkJCWRlbGV0ZSBkYXRhLmZpbmlzaDsKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZWFjaChbICJ0b2dnbGUiLCAic2hvdyIsICJoaWRlIiBdLCBmdW5jdGlvbiggaSwgbmFtZSApIHsKCXZhciBjc3NGbiA9IGpRdWVyeS5mblsgbmFtZSBdOwoJalF1ZXJ5LmZuWyBuYW1lIF0gPSBmdW5jdGlvbiggc3BlZWQsIGVhc2luZywgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIHNwZWVkID09IG51bGwgfHwgdHlwZW9mIHNwZWVkID09PSAiYm9vbGVhbiIgPwoJCQljc3NGbi5hcHBseSggdGhpcywgYXJndW1lbnRzICkgOgoJCQl0aGlzLmFuaW1hdGUoIGdlbkZ4KCBuYW1lLCB0cnVlICksIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICk7Cgl9Owp9KTsKCi8vIEdlbmVyYXRlIHNob3J0Y3V0cyBmb3IgY3VzdG9tIGFuaW1hdGlvbnMKalF1ZXJ5LmVhY2goewoJc2xpZGVEb3duOiBnZW5GeCgic2hvdyIpLAoJc2xpZGVVcDogZ2VuRngoImhpZGUiKSwKCXNsaWRlVG9nZ2xlOiBnZW5GeCgidG9nZ2xlIiksCglmYWRlSW46IHsgb3BhY2l0eTogInNob3ciIH0sCglmYWRlT3V0OiB7IG9wYWNpdHk6ICJoaWRlIiB9LAoJZmFkZVRvZ2dsZTogeyBvcGFjaXR5OiAidG9nZ2xlIiB9Cn0sIGZ1bmN0aW9uKCBuYW1lLCBwcm9wcyApIHsKCWpRdWVyeS5mblsgbmFtZSBdID0gZnVuY3Rpb24oIHNwZWVkLCBlYXNpbmcsIGNhbGxiYWNrICkgewoJCXJldHVybiB0aGlzLmFuaW1hdGUoIHByb3BzLCBzcGVlZCwgZWFzaW5nLCBjYWxsYmFjayApOwoJfTsKfSk7CgpqUXVlcnkudGltZXJzID0gW107CmpRdWVyeS5meC50aWNrID0gZnVuY3Rpb24oKSB7Cgl2YXIgdGltZXIsCgkJaSA9IDAsCgkJdGltZXJzID0galF1ZXJ5LnRpbWVyczsKCglmeE5vdyA9IGpRdWVyeS5ub3coKTsKCglmb3IgKCA7IGkgPCB0aW1lcnMubGVuZ3RoOyBpKysgKSB7CgkJdGltZXIgPSB0aW1lcnNbIGkgXTsKCQkvLyBDaGVja3MgdGhlIHRpbWVyIGhhcyBub3QgYWxyZWFkeSBiZWVuIHJlbW92ZWQKCQlpZiAoICF0aW1lcigpICYmIHRpbWVyc1sgaSBdID09PSB0aW1lciApIHsKCQkJdGltZXJzLnNwbGljZSggaS0tLCAxICk7CgkJfQoJfQoKCWlmICggIXRpbWVycy5sZW5ndGggKSB7CgkJalF1ZXJ5LmZ4LnN0b3AoKTsKCX0KCWZ4Tm93ID0gdW5kZWZpbmVkOwp9OwoKalF1ZXJ5LmZ4LnRpbWVyID0gZnVuY3Rpb24oIHRpbWVyICkgewoJalF1ZXJ5LnRpbWVycy5wdXNoKCB0aW1lciApOwoJaWYgKCB0aW1lcigpICkgewoJCWpRdWVyeS5meC5zdGFydCgpOwoJfSBlbHNlIHsKCQlqUXVlcnkudGltZXJzLnBvcCgpOwoJfQp9OwoKalF1ZXJ5LmZ4LmludGVydmFsID0gMTM7CgpqUXVlcnkuZnguc3RhcnQgPSBmdW5jdGlvbigpIHsKCWlmICggIXRpbWVySWQgKSB7CgkJdGltZXJJZCA9IHNldEludGVydmFsKCBqUXVlcnkuZngudGljaywgalF1ZXJ5LmZ4LmludGVydmFsICk7Cgl9Cn07CgpqUXVlcnkuZnguc3RvcCA9IGZ1bmN0aW9uKCkgewoJY2xlYXJJbnRlcnZhbCggdGltZXJJZCApOwoJdGltZXJJZCA9IG51bGw7Cn07CgpqUXVlcnkuZnguc3BlZWRzID0gewoJc2xvdzogNjAwLAoJZmFzdDogMjAwLAoJLy8gRGVmYXVsdCBzcGVlZAoJX2RlZmF1bHQ6IDQwMAp9OwoKCi8vIEJhc2VkIG9mZiBvZiB0aGUgcGx1Z2luIGJ5IENsaW50IEhlbGZlcnMsIHdpdGggcGVybWlzc2lvbi4KLy8gaHR0cDovL2JsaW5kc2lnbmFscy5jb20vaW5kZXgucGhwLzIwMDkvMDcvanF1ZXJ5LWRlbGF5LwpqUXVlcnkuZm4uZGVsYXkgPSBmdW5jdGlvbiggdGltZSwgdHlwZSApIHsKCXRpbWUgPSBqUXVlcnkuZnggPyBqUXVlcnkuZnguc3BlZWRzWyB0aW1lIF0gfHwgdGltZSA6IHRpbWU7Cgl0eXBlID0gdHlwZSB8fCAiZngiOwoKCXJldHVybiB0aGlzLnF1ZXVlKCB0eXBlLCBmdW5jdGlvbiggbmV4dCwgaG9va3MgKSB7CgkJdmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KCBuZXh0LCB0aW1lICk7CgkJaG9va3Muc3RvcCA9IGZ1bmN0aW9uKCkgewoJCQljbGVhclRpbWVvdXQoIHRpbWVvdXQgKTsKCQl9OwoJfSk7Cn07CgoKKGZ1bmN0aW9uKCkgewoJdmFyIGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCggImlucHV0IiApLAoJCXNlbGVjdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJzZWxlY3QiICksCgkJb3B0ID0gc2VsZWN0LmFwcGVuZENoaWxkKCBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCAib3B0aW9uIiApICk7CgoJaW5wdXQudHlwZSA9ICJjaGVja2JveCI7CgoJLy8gU3VwcG9ydDogaU9TPD01LjEsIEFuZHJvaWQ8PTQuMisKCS8vIERlZmF1bHQgdmFsdWUgZm9yIGEgY2hlY2tib3ggc2hvdWxkIGJlICJvbiIKCXN1cHBvcnQuY2hlY2tPbiA9IGlucHV0LnZhbHVlICE9PSAiIjsKCgkvLyBTdXBwb3J0OiBJRTw9MTErCgkvLyBNdXN0IGFjY2VzcyBzZWxlY3RlZEluZGV4IHRvIG1ha2UgZGVmYXVsdCBvcHRpb25zIHNlbGVjdAoJc3VwcG9ydC5vcHRTZWxlY3RlZCA9IG9wdC5zZWxlY3RlZDsKCgkvLyBTdXBwb3J0OiBBbmRyb2lkPD0yLjMKCS8vIE9wdGlvbnMgaW5zaWRlIGRpc2FibGVkIHNlbGVjdHMgYXJlIGluY29ycmVjdGx5IG1hcmtlZCBhcyBkaXNhYmxlZAoJc2VsZWN0LmRpc2FibGVkID0gdHJ1ZTsKCXN1cHBvcnQub3B0RGlzYWJsZWQgPSAhb3B0LmRpc2FibGVkOwoKCS8vIFN1cHBvcnQ6IElFPD0xMSsKCS8vIEFuIGlucHV0IGxvc2VzIGl0cyB2YWx1ZSBhZnRlciBiZWNvbWluZyBhIHJhZGlvCglpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoICJpbnB1dCIgKTsKCWlucHV0LnZhbHVlID0gInQiOwoJaW5wdXQudHlwZSA9ICJyYWRpbyI7CglzdXBwb3J0LnJhZGlvVmFsdWUgPSBpbnB1dC52YWx1ZSA9PT0gInQiOwp9KSgpOwoKCnZhciBub2RlSG9vaywgYm9vbEhvb2ssCglhdHRySGFuZGxlID0galF1ZXJ5LmV4cHIuYXR0ckhhbmRsZTsKCmpRdWVyeS5mbi5leHRlbmQoewoJYXR0cjogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGpRdWVyeS5hdHRyLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCgoJcmVtb3ZlQXR0cjogZnVuY3Rpb24oIG5hbWUgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJalF1ZXJ5LnJlbW92ZUF0dHIoIHRoaXMsIG5hbWUgKTsKCQl9KTsKCX0KfSk7CgpqUXVlcnkuZXh0ZW5kKHsKCWF0dHI6IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCB2YWx1ZSApIHsKCQl2YXIgaG9va3MsIHJldCwKCQkJblR5cGUgPSBlbGVtLm5vZGVUeXBlOwoKCQkvLyBkb24ndCBnZXQvc2V0IGF0dHJpYnV0ZXMgb24gdGV4dCwgY29tbWVudCBhbmQgYXR0cmlidXRlIG5vZGVzCgkJaWYgKCAhZWxlbSB8fCBuVHlwZSA9PT0gMyB8fCBuVHlwZSA9PT0gOCB8fCBuVHlwZSA9PT0gMiApIHsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gRmFsbGJhY2sgdG8gcHJvcCB3aGVuIGF0dHJpYnV0ZXMgYXJlIG5vdCBzdXBwb3J0ZWQKCQlpZiAoIHR5cGVvZiBlbGVtLmdldEF0dHJpYnV0ZSA9PT0gc3RydW5kZWZpbmVkICkgewoJCQlyZXR1cm4galF1ZXJ5LnByb3AoIGVsZW0sIG5hbWUsIHZhbHVlICk7CgkJfQoKCQkvLyBBbGwgYXR0cmlidXRlcyBhcmUgbG93ZXJjYXNlCgkJLy8gR3JhYiBuZWNlc3NhcnkgaG9vayBpZiBvbmUgaXMgZGVmaW5lZAoJCWlmICggblR5cGUgIT09IDEgfHwgIWpRdWVyeS5pc1hNTERvYyggZWxlbSApICkgewoJCQluYW1lID0gbmFtZS50b0xvd2VyQ2FzZSgpOwoJCQlob29rcyA9IGpRdWVyeS5hdHRySG9va3NbIG5hbWUgXSB8fAoJCQkJKCBqUXVlcnkuZXhwci5tYXRjaC5ib29sLnRlc3QoIG5hbWUgKSA/IGJvb2xIb29rIDogbm9kZUhvb2sgKTsKCQl9CgoJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggdmFsdWUgPT09IG51bGwgKSB7CgkJCQlqUXVlcnkucmVtb3ZlQXR0ciggZWxlbSwgbmFtZSApOwoKCQkJfSBlbHNlIGlmICggaG9va3MgJiYgInNldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLnNldCggZWxlbSwgdmFsdWUsIG5hbWUgKSkgIT09IHVuZGVmaW5lZCApIHsKCQkJCXJldHVybiByZXQ7CgoJCQl9IGVsc2UgewoJCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIHZhbHVlICsgIiIgKTsKCQkJCXJldHVybiB2YWx1ZTsKCQkJfQoKCQl9IGVsc2UgaWYgKCBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsICkgewoJCQlyZXR1cm4gcmV0OwoKCQl9IGVsc2UgewoJCQlyZXQgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCBuYW1lICk7CgoJCQkvLyBOb24tZXhpc3RlbnQgYXR0cmlidXRlcyByZXR1cm4gbnVsbCwgd2Ugbm9ybWFsaXplIHRvIHVuZGVmaW5lZAoJCQlyZXR1cm4gcmV0ID09IG51bGwgPwoJCQkJdW5kZWZpbmVkIDoKCQkJCXJldDsKCQl9Cgl9LAoKCXJlbW92ZUF0dHI6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQl2YXIgbmFtZSwgcHJvcE5hbWUsCgkJCWkgPSAwLAoJCQlhdHRyTmFtZXMgPSB2YWx1ZSAmJiB2YWx1ZS5tYXRjaCggcm5vdHdoaXRlICk7CgoJCWlmICggYXR0ck5hbWVzICYmIGVsZW0ubm9kZVR5cGUgPT09IDEgKSB7CgkJCXdoaWxlICggKG5hbWUgPSBhdHRyTmFtZXNbaSsrXSkgKSB7CgkJCQlwcm9wTmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCgkJCQkvLyBCb29sZWFuIGF0dHJpYnV0ZXMgZ2V0IHNwZWNpYWwgdHJlYXRtZW50ICgjMTA4NzApCgkJCQlpZiAoIGpRdWVyeS5leHByLm1hdGNoLmJvb2wudGVzdCggbmFtZSApICkgewoJCQkJCS8vIFNldCBjb3JyZXNwb25kaW5nIHByb3BlcnR5IHRvIGZhbHNlCgkJCQkJZWxlbVsgcHJvcE5hbWUgXSA9IGZhbHNlOwoJCQkJfQoKCQkJCWVsZW0ucmVtb3ZlQXR0cmlidXRlKCBuYW1lICk7CgkJCX0KCQl9Cgl9LAoKCWF0dHJIb29rczogewoJCXR5cGU6IHsKCQkJc2V0OiBmdW5jdGlvbiggZWxlbSwgdmFsdWUgKSB7CgkJCQlpZiAoICFzdXBwb3J0LnJhZGlvVmFsdWUgJiYgdmFsdWUgPT09ICJyYWRpbyIgJiYKCQkJCQlqUXVlcnkubm9kZU5hbWUoIGVsZW0sICJpbnB1dCIgKSApIHsKCQkJCQl2YXIgdmFsID0gZWxlbS52YWx1ZTsKCQkJCQllbGVtLnNldEF0dHJpYnV0ZSggInR5cGUiLCB2YWx1ZSApOwoJCQkJCWlmICggdmFsICkgewoJCQkJCQllbGVtLnZhbHVlID0gdmFsOwoJCQkJCX0KCQkJCQlyZXR1cm4gdmFsdWU7CgkJCQl9CgkJCX0KCQl9Cgl9Cn0pOwoKLy8gSG9va3MgZm9yIGJvb2xlYW4gYXR0cmlidXRlcwpib29sSG9vayA9IHsKCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlLCBuYW1lICkgewoJCWlmICggdmFsdWUgPT09IGZhbHNlICkgewoJCQkvLyBSZW1vdmUgYm9vbGVhbiBhdHRyaWJ1dGVzIHdoZW4gc2V0IHRvIGZhbHNlCgkJCWpRdWVyeS5yZW1vdmVBdHRyKCBlbGVtLCBuYW1lICk7CgkJfSBlbHNlIHsKCQkJZWxlbS5zZXRBdHRyaWJ1dGUoIG5hbWUsIG5hbWUgKTsKCQl9CgkJcmV0dXJuIG5hbWU7Cgl9Cn07CmpRdWVyeS5lYWNoKCBqUXVlcnkuZXhwci5tYXRjaC5ib29sLnNvdXJjZS5tYXRjaCggL1x3Ky9nICksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoJdmFyIGdldHRlciA9IGF0dHJIYW5kbGVbIG5hbWUgXSB8fCBqUXVlcnkuZmluZC5hdHRyOwoKCWF0dHJIYW5kbGVbIG5hbWUgXSA9IGZ1bmN0aW9uKCBlbGVtLCBuYW1lLCBpc1hNTCApIHsKCQl2YXIgcmV0LCBoYW5kbGU7CgkJaWYgKCAhaXNYTUwgKSB7CgkJCS8vIEF2b2lkIGFuIGluZmluaXRlIGxvb3AgYnkgdGVtcG9yYXJpbHkgcmVtb3ZpbmcgdGhpcyBmdW5jdGlvbiBmcm9tIHRoZSBnZXR0ZXIKCQkJaGFuZGxlID0gYXR0ckhhbmRsZVsgbmFtZSBdOwoJCQlhdHRySGFuZGxlWyBuYW1lIF0gPSByZXQ7CgkJCXJldCA9IGdldHRlciggZWxlbSwgbmFtZSwgaXNYTUwgKSAhPSBudWxsID8KCQkJCW5hbWUudG9Mb3dlckNhc2UoKSA6CgkJCQludWxsOwoJCQlhdHRySGFuZGxlWyBuYW1lIF0gPSBoYW5kbGU7CgkJfQoJCXJldHVybiByZXQ7Cgl9Owp9KTsKCgoKCnZhciByZm9jdXNhYmxlID0gL14oPzppbnB1dHxzZWxlY3R8dGV4dGFyZWF8YnV0dG9uKSQvaTsKCmpRdWVyeS5mbi5leHRlbmQoewoJcHJvcDogZnVuY3Rpb24oIG5hbWUsIHZhbHVlICkgewoJCXJldHVybiBhY2Nlc3MoIHRoaXMsIGpRdWVyeS5wcm9wLCBuYW1lLCB2YWx1ZSwgYXJndW1lbnRzLmxlbmd0aCA+IDEgKTsKCX0sCgoJcmVtb3ZlUHJvcDogZnVuY3Rpb24oIG5hbWUgKSB7CgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHsKCQkJZGVsZXRlIHRoaXNbIGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZSBdOwoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJcHJvcEZpeDogewoJCSJmb3IiOiAiaHRtbEZvciIsCgkJImNsYXNzIjogImNsYXNzTmFtZSIKCX0sCgoJcHJvcDogZnVuY3Rpb24oIGVsZW0sIG5hbWUsIHZhbHVlICkgewoJCXZhciByZXQsIGhvb2tzLCBub3R4bWwsCgkJCW5UeXBlID0gZWxlbS5ub2RlVHlwZTsKCgkJLy8gRG9uJ3QgZ2V0L3NldCBwcm9wZXJ0aWVzIG9uIHRleHQsIGNvbW1lbnQgYW5kIGF0dHJpYnV0ZSBub2RlcwoJCWlmICggIWVsZW0gfHwgblR5cGUgPT09IDMgfHwgblR5cGUgPT09IDggfHwgblR5cGUgPT09IDIgKSB7CgkJCXJldHVybjsKCQl9CgoJCW5vdHhtbCA9IG5UeXBlICE9PSAxIHx8ICFqUXVlcnkuaXNYTUxEb2MoIGVsZW0gKTsKCgkJaWYgKCBub3R4bWwgKSB7CgkJCS8vIEZpeCBuYW1lIGFuZCBhdHRhY2ggaG9va3MKCQkJbmFtZSA9IGpRdWVyeS5wcm9wRml4WyBuYW1lIF0gfHwgbmFtZTsKCQkJaG9va3MgPSBqUXVlcnkucHJvcEhvb2tzWyBuYW1lIF07CgkJfQoKCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgkJCXJldHVybiBob29rcyAmJiAic2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3Muc2V0KCBlbGVtLCB2YWx1ZSwgbmFtZSApKSAhPT0gdW5kZWZpbmVkID8KCQkJCXJldCA6CgkJCQkoIGVsZW1bIG5hbWUgXSA9IHZhbHVlICk7CgoJCX0gZWxzZSB7CgkJCXJldHVybiBob29rcyAmJiAiZ2V0IiBpbiBob29rcyAmJiAocmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBuYW1lICkpICE9PSBudWxsID8KCQkJCXJldCA6CgkJCQllbGVtWyBuYW1lIF07CgkJfQoJfSwKCglwcm9wSG9va3M6IHsKCQl0YWJJbmRleDogewoJCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQkJcmV0dXJuIGVsZW0uaGFzQXR0cmlidXRlKCAidGFiaW5kZXgiICkgfHwgcmZvY3VzYWJsZS50ZXN0KCBlbGVtLm5vZGVOYW1lICkgfHwgZWxlbS5ocmVmID8KCQkJCQllbGVtLnRhYkluZGV4IDoKCQkJCQktMTsKCQkJfQoJCX0KCX0KfSk7CgppZiAoICFzdXBwb3J0Lm9wdFNlbGVjdGVkICkgewoJalF1ZXJ5LnByb3BIb29rcy5zZWxlY3RlZCA9IHsKCQlnZXQ6IGZ1bmN0aW9uKCBlbGVtICkgewoJCQl2YXIgcGFyZW50ID0gZWxlbS5wYXJlbnROb2RlOwoJCQlpZiAoIHBhcmVudCAmJiBwYXJlbnQucGFyZW50Tm9kZSApIHsKCQkJCXBhcmVudC5wYXJlbnROb2RlLnNlbGVjdGVkSW5kZXg7CgkJCX0KCQkJcmV0dXJuIG51bGw7CgkJfQoJfTsKfQoKalF1ZXJ5LmVhY2goWwoJInRhYkluZGV4IiwKCSJyZWFkT25seSIsCgkibWF4TGVuZ3RoIiwKCSJjZWxsU3BhY2luZyIsCgkiY2VsbFBhZGRpbmciLAoJInJvd1NwYW4iLAoJImNvbFNwYW4iLAoJInVzZU1hcCIsCgkiZnJhbWVCb3JkZXIiLAoJImNvbnRlbnRFZGl0YWJsZSIKXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkucHJvcEZpeFsgdGhpcy50b0xvd2VyQ2FzZSgpIF0gPSB0aGlzOwp9KTsKCgoKCnZhciByY2xhc3MgPSAvW1x0XHJcblxmXS9nOwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglhZGRDbGFzczogZnVuY3Rpb24oIHZhbHVlICkgewoJCXZhciBjbGFzc2VzLCBlbGVtLCBjdXIsIGNsYXp6LCBqLCBmaW5hbFZhbHVlLAoJCQlwcm9jZWVkID0gdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgewoJCQkJalF1ZXJ5KCB0aGlzICkuYWRkQ2xhc3MoIHZhbHVlLmNhbGwoIHRoaXMsIGosIHRoaXMuY2xhc3NOYW1lICkgKTsKCQkJfSk7CgkJfQoKCQlpZiAoIHByb2NlZWQgKSB7CgkJCS8vIFRoZSBkaXNqdW5jdGlvbiBoZXJlIGlzIGZvciBiZXR0ZXIgY29tcHJlc3NpYmlsaXR5IChzZWUgcmVtb3ZlQ2xhc3MpCgkJCWNsYXNzZXMgPSAoIHZhbHVlIHx8ICIiICkubWF0Y2goIHJub3R3aGl0ZSApIHx8IFtdOwoKCQkJZm9yICggOyBpIDwgbGVuOyBpKysgKSB7CgkJCQllbGVtID0gdGhpc1sgaSBdOwoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiAiCgkJCQkpOwoKCQkJCWlmICggY3VyICkgewoJCQkJCWogPSAwOwoJCQkJCXdoaWxlICggKGNsYXp6ID0gY2xhc3Nlc1tqKytdKSApIHsKCQkJCQkJaWYgKCBjdXIuaW5kZXhPZiggIiAiICsgY2xhenogKyAiICIgKSA8IDAgKSB7CgkJCQkJCQljdXIgKz0gY2xhenogKyAiICI7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIG9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJZmluYWxWYWx1ZSA9IGpRdWVyeS50cmltKCBjdXIgKTsKCQkJCQlpZiAoIGVsZW0uY2xhc3NOYW1lICE9PSBmaW5hbFZhbHVlICkgewoJCQkJCQllbGVtLmNsYXNzTmFtZSA9IGZpbmFsVmFsdWU7CgkJCQkJfQoJCQkJfQoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJcmVtb3ZlQ2xhc3M6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgY2xhc3NlcywgZWxlbSwgY3VyLCBjbGF6eiwgaiwgZmluYWxWYWx1ZSwKCQkJcHJvY2VlZCA9IGFyZ3VtZW50cy5sZW5ndGggPT09IDAgfHwgdHlwZW9mIHZhbHVlID09PSAic3RyaW5nIiAmJiB2YWx1ZSwKCQkJaSA9IDAsCgkJCWxlbiA9IHRoaXMubGVuZ3RoOwoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBqICkgewoJCQkJalF1ZXJ5KCB0aGlzICkucmVtb3ZlQ2xhc3MoIHZhbHVlLmNhbGwoIHRoaXMsIGosIHRoaXMuY2xhc3NOYW1lICkgKTsKCQkJfSk7CgkJfQoJCWlmICggcHJvY2VlZCApIHsKCQkJY2xhc3NlcyA9ICggdmFsdWUgfHwgIiIgKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCQlmb3IgKCA7IGkgPCBsZW47IGkrKyApIHsKCQkJCWVsZW0gPSB0aGlzWyBpIF07CgkJCQkvLyBUaGlzIGV4cHJlc3Npb24gaXMgaGVyZSBmb3IgYmV0dGVyIGNvbXByZXNzaWJpbGl0eSAoc2VlIGFkZENsYXNzKQoJCQkJY3VyID0gZWxlbS5ub2RlVHlwZSA9PT0gMSAmJiAoIGVsZW0uY2xhc3NOYW1lID8KCQkJCQkoICIgIiArIGVsZW0uY2xhc3NOYW1lICsgIiAiICkucmVwbGFjZSggcmNsYXNzLCAiICIgKSA6CgkJCQkJIiIKCQkJCSk7CgoJCQkJaWYgKCBjdXIgKSB7CgkJCQkJaiA9IDA7CgkJCQkJd2hpbGUgKCAoY2xhenogPSBjbGFzc2VzW2orK10pICkgewoJCQkJCQkvLyBSZW1vdmUgKmFsbCogaW5zdGFuY2VzCgkJCQkJCXdoaWxlICggY3VyLmluZGV4T2YoICIgIiArIGNsYXp6ICsgIiAiICkgPj0gMCApIHsKCQkJCQkJCWN1ciA9IGN1ci5yZXBsYWNlKCAiICIgKyBjbGF6eiArICIgIiwgIiAiICk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCS8vIE9ubHkgYXNzaWduIGlmIGRpZmZlcmVudCB0byBhdm9pZCB1bm5lZWRlZCByZW5kZXJpbmcuCgkJCQkJZmluYWxWYWx1ZSA9IHZhbHVlID8galF1ZXJ5LnRyaW0oIGN1ciApIDogIiI7CgkJCQkJaWYgKCBlbGVtLmNsYXNzTmFtZSAhPT0gZmluYWxWYWx1ZSApIHsKCQkJCQkJZWxlbS5jbGFzc05hbWUgPSBmaW5hbFZhbHVlOwoJCQkJCX0KCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCXRvZ2dsZUNsYXNzOiBmdW5jdGlvbiggdmFsdWUsIHN0YXRlVmFsICkgewoJCXZhciB0eXBlID0gdHlwZW9mIHZhbHVlOwoKCQlpZiAoIHR5cGVvZiBzdGF0ZVZhbCA9PT0gImJvb2xlYW4iICYmIHR5cGUgPT09ICJzdHJpbmciICkgewoJCQlyZXR1cm4gc3RhdGVWYWwgPyB0aGlzLmFkZENsYXNzKCB2YWx1ZSApIDogdGhpcy5yZW1vdmVDbGFzcyggdmFsdWUgKTsKCQl9CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIHZhbHVlICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS50b2dnbGVDbGFzcyggdmFsdWUuY2FsbCh0aGlzLCBpLCB0aGlzLmNsYXNzTmFtZSwgc3RhdGVWYWwpLCBzdGF0ZVZhbCApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggdHlwZSA9PT0gInN0cmluZyIgKSB7CgkJCQkvLyBUb2dnbGUgaW5kaXZpZHVhbCBjbGFzcyBuYW1lcwoJCQkJdmFyIGNsYXNzTmFtZSwKCQkJCQlpID0gMCwKCQkJCQlzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQkJY2xhc3NOYW1lcyA9IHZhbHVlLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbXTsKCgkJCQl3aGlsZSAoIChjbGFzc05hbWUgPSBjbGFzc05hbWVzWyBpKysgXSkgKSB7CgkJCQkJLy8gQ2hlY2sgZWFjaCBjbGFzc05hbWUgZ2l2ZW4sIHNwYWNlIHNlcGFyYXRlZCBsaXN0CgkJCQkJaWYgKCBzZWxmLmhhc0NsYXNzKCBjbGFzc05hbWUgKSApIHsKCQkJCQkJc2VsZi5yZW1vdmVDbGFzcyggY2xhc3NOYW1lICk7CgkJCQkJfSBlbHNlIHsKCQkJCQkJc2VsZi5hZGRDbGFzcyggY2xhc3NOYW1lICk7CgkJCQkJfQoJCQkJfQoKCQkJLy8gVG9nZ2xlIHdob2xlIGNsYXNzIG5hbWUKCQkJfSBlbHNlIGlmICggdHlwZSA9PT0gc3RydW5kZWZpbmVkIHx8IHR5cGUgPT09ICJib29sZWFuIiApIHsKCQkJCWlmICggdGhpcy5jbGFzc05hbWUgKSB7CgkJCQkJLy8gc3RvcmUgY2xhc3NOYW1lIGlmIHNldAoJCQkJCWRhdGFfcHJpdi5zZXQoIHRoaXMsICJfX2NsYXNzTmFtZV9fIiwgdGhpcy5jbGFzc05hbWUgKTsKCQkJCX0KCgkJCQkvLyBJZiB0aGUgZWxlbWVudCBoYXMgYSBjbGFzcyBuYW1lIG9yIGlmIHdlJ3JlIHBhc3NlZCBgZmFsc2VgLAoJCQkJLy8gdGhlbiByZW1vdmUgdGhlIHdob2xlIGNsYXNzbmFtZSAoaWYgdGhlcmUgd2FzIG9uZSwgdGhlIGFib3ZlIHNhdmVkIGl0KS4KCQkJCS8vIE90aGVyd2lzZSBicmluZyBiYWNrIHdoYXRldmVyIHdhcyBwcmV2aW91c2x5IHNhdmVkIChpZiBhbnl0aGluZyksCgkJCQkvLyBmYWxsaW5nIGJhY2sgdG8gdGhlIGVtcHR5IHN0cmluZyBpZiBub3RoaW5nIHdhcyBzdG9yZWQuCgkJCQl0aGlzLmNsYXNzTmFtZSA9IHRoaXMuY2xhc3NOYW1lIHx8IHZhbHVlID09PSBmYWxzZSA/ICIiIDogZGF0YV9wcml2LmdldCggdGhpcywgIl9fY2xhc3NOYW1lX18iICkgfHwgIiI7CgkJCX0KCQl9KTsKCX0sCgoJaGFzQ2xhc3M6IGZ1bmN0aW9uKCBzZWxlY3RvciApIHsKCQl2YXIgY2xhc3NOYW1lID0gIiAiICsgc2VsZWN0b3IgKyAiICIsCgkJCWkgPSAwLAoJCQlsID0gdGhpcy5sZW5ndGg7CgkJZm9yICggOyBpIDwgbDsgaSsrICkgewoJCQlpZiAoIHRoaXNbaV0ubm9kZVR5cGUgPT09IDEgJiYgKCIgIiArIHRoaXNbaV0uY2xhc3NOYW1lICsgIiAiKS5yZXBsYWNlKHJjbGFzcywgIiAiKS5pbmRleE9mKCBjbGFzc05hbWUgKSA+PSAwICkgewoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9CgoJCXJldHVybiBmYWxzZTsKCX0KfSk7CgoKCgp2YXIgcnJldHVybiA9IC9cci9nOwoKalF1ZXJ5LmZuLmV4dGVuZCh7Cgl2YWw6IGZ1bmN0aW9uKCB2YWx1ZSApIHsKCQl2YXIgaG9va3MsIHJldCwgaXNGdW5jdGlvbiwKCQkJZWxlbSA9IHRoaXNbMF07CgoJCWlmICggIWFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCWlmICggZWxlbSApIHsKCQkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyBlbGVtLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIGVsZW0ubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJCWlmICggaG9va3MgJiYgImdldCIgaW4gaG9va3MgJiYgKHJldCA9IGhvb2tzLmdldCggZWxlbSwgInZhbHVlIiApKSAhPT0gdW5kZWZpbmVkICkgewoJCQkJCXJldHVybiByZXQ7CgkJCQl9CgoJCQkJcmV0ID0gZWxlbS52YWx1ZTsKCgkJCQlyZXR1cm4gdHlwZW9mIHJldCA9PT0gInN0cmluZyIgPwoJCQkJCS8vIEhhbmRsZSBtb3N0IGNvbW1vbiBzdHJpbmcgY2FzZXMKCQkJCQlyZXQucmVwbGFjZShycmV0dXJuLCAiIikgOgoJCQkJCS8vIEhhbmRsZSBjYXNlcyB3aGVyZSB2YWx1ZSBpcyBudWxsL3VuZGVmIG9yIG51bWJlcgoJCQkJCXJldCA9PSBudWxsID8gIiIgOiByZXQ7CgkJCX0KCgkJCXJldHVybjsKCQl9CgoJCWlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTsKCgkJcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiggaSApIHsKCQkJdmFyIHZhbDsKCgkJCWlmICggdGhpcy5ub2RlVHlwZSAhPT0gMSApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJaWYgKCBpc0Z1bmN0aW9uICkgewoJCQkJdmFsID0gdmFsdWUuY2FsbCggdGhpcywgaSwgalF1ZXJ5KCB0aGlzICkudmFsKCkgKTsKCQkJfSBlbHNlIHsKCQkJCXZhbCA9IHZhbHVlOwoJCQl9CgoJCQkvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyAiIjsgY29udmVydCBudW1iZXJzIHRvIHN0cmluZwoJCQlpZiAoIHZhbCA9PSBudWxsICkgewoJCQkJdmFsID0gIiI7CgoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSAibnVtYmVyIiApIHsKCQkJCXZhbCArPSAiIjsKCgkJCX0gZWxzZSBpZiAoIGpRdWVyeS5pc0FycmF5KCB2YWwgKSApIHsKCQkJCXZhbCA9IGpRdWVyeS5tYXAoIHZhbCwgZnVuY3Rpb24oIHZhbHVlICkgewoJCQkJCXJldHVybiB2YWx1ZSA9PSBudWxsID8gIiIgOiB2YWx1ZSArICIiOwoJCQkJfSk7CgkJCX0KCgkJCWhvb2tzID0galF1ZXJ5LnZhbEhvb2tzWyB0aGlzLnR5cGUgXSB8fCBqUXVlcnkudmFsSG9va3NbIHRoaXMubm9kZU5hbWUudG9Mb3dlckNhc2UoKSBdOwoKCQkJLy8gSWYgc2V0IHJldHVybnMgdW5kZWZpbmVkLCBmYWxsIGJhY2sgdG8gbm9ybWFsIHNldHRpbmcKCQkJaWYgKCAhaG9va3MgfHwgISgic2V0IiBpbiBob29rcykgfHwgaG9va3Muc2V0KCB0aGlzLCB2YWwsICJ2YWx1ZSIgKSA9PT0gdW5kZWZpbmVkICkgewoJCQkJdGhpcy52YWx1ZSA9IHZhbDsKCQkJfQoJCX0pOwoJfQp9KTsKCmpRdWVyeS5leHRlbmQoewoJdmFsSG9va3M6IHsKCQlvcHRpb246IHsKCQkJZ2V0OiBmdW5jdGlvbiggZWxlbSApIHsKCQkJCXZhciB2YWwgPSBqUXVlcnkuZmluZC5hdHRyKCBlbGVtLCAidmFsdWUiICk7CgkJCQlyZXR1cm4gdmFsICE9IG51bGwgPwoJCQkJCXZhbCA6CgkJCQkJLy8gU3VwcG9ydDogSUUxMC0xMSsKCQkJCQkvLyBvcHRpb24udGV4dCB0aHJvd3MgZXhjZXB0aW9ucyAoIzE0Njg2LCAjMTQ4NTgpCgkJCQkJalF1ZXJ5LnRyaW0oIGpRdWVyeS50ZXh0KCBlbGVtICkgKTsKCQkJfQoJCX0sCgkJc2VsZWN0OiB7CgkJCWdldDogZnVuY3Rpb24oIGVsZW0gKSB7CgkJCQl2YXIgdmFsdWUsIG9wdGlvbiwKCQkJCQlvcHRpb25zID0gZWxlbS5vcHRpb25zLAoJCQkJCWluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LAoJCQkJCW9uZSA9IGVsZW0udHlwZSA9PT0gInNlbGVjdC1vbmUiIHx8IGluZGV4IDwgMCwKCQkJCQl2YWx1ZXMgPSBvbmUgPyBudWxsIDogW10sCgkJCQkJbWF4ID0gb25lID8gaW5kZXggKyAxIDogb3B0aW9ucy5sZW5ndGgsCgkJCQkJaSA9IGluZGV4IDwgMCA/CgkJCQkJCW1heCA6CgkJCQkJCW9uZSA/IGluZGV4IDogMDsKCgkJCQkvLyBMb29wIHRocm91Z2ggYWxsIHRoZSBzZWxlY3RlZCBvcHRpb25zCgkJCQlmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHsKCQkJCQlvcHRpb24gPSBvcHRpb25zWyBpIF07CgoJCQkJCS8vIElFNi05IGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKQoJCQkJCWlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJgoJCQkJCQkJLy8gRG9uJ3QgcmV0dXJuIG9wdGlvbnMgdGhhdCBhcmUgZGlzYWJsZWQgb3IgaW4gYSBkaXNhYmxlZCBvcHRncm91cAoJCQkJCQkJKCBzdXBwb3J0Lm9wdERpc2FibGVkID8gIW9wdGlvbi5kaXNhYmxlZCA6IG9wdGlvbi5nZXRBdHRyaWJ1dGUoICJkaXNhYmxlZCIgKSA9PT0gbnVsbCApICYmCgkJCQkJCQkoICFvcHRpb24ucGFyZW50Tm9kZS5kaXNhYmxlZCB8fCAhalF1ZXJ5Lm5vZGVOYW1lKCBvcHRpb24ucGFyZW50Tm9kZSwgIm9wdGdyb3VwIiApICkgKSB7CgoJCQkJCQkvLyBHZXQgdGhlIHNwZWNpZmljIHZhbHVlIGZvciB0aGUgb3B0aW9uCgkJCQkJCXZhbHVlID0galF1ZXJ5KCBvcHRpb24gKS52YWwoKTsKCgkJCQkJCS8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzCgkJCQkJCWlmICggb25lICkgewoJCQkJCQkJcmV0dXJuIHZhbHVlOwoJCQkJCQl9CgoJCQkJCQkvLyBNdWx0aS1TZWxlY3RzIHJldHVybiBhbiBhcnJheQoJCQkJCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsKCQkJCQl9CgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlczsKCQkJfSwKCgkJCXNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkgewoJCQkJdmFyIG9wdGlvblNldCwgb3B0aW9uLAoJCQkJCW9wdGlvbnMgPSBlbGVtLm9wdGlvbnMsCgkJCQkJdmFsdWVzID0galF1ZXJ5Lm1ha2VBcnJheSggdmFsdWUgKSwKCQkJCQlpID0gb3B0aW9ucy5sZW5ndGg7CgoJCQkJd2hpbGUgKCBpLS0gKSB7CgkJCQkJb3B0aW9uID0gb3B0aW9uc1sgaSBdOwoJCQkJCWlmICggKG9wdGlvbi5zZWxlY3RlZCA9IGpRdWVyeS5pbkFycmF5KCBvcHRpb24udmFsdWUsIHZhbHVlcyApID49IDApICkgewoJCQkJCQlvcHRpb25TZXQgPSB0cnVlOwoJCQkJCX0KCQkJCX0KCgkJCQkvLyBGb3JjZSBicm93c2VycyB0byBiZWhhdmUgY29uc2lzdGVudGx5IHdoZW4gbm9uLW1hdGNoaW5nIHZhbHVlIGlzIHNldAoJCQkJaWYgKCAhb3B0aW9uU2V0ICkgewoJCQkJCWVsZW0uc2VsZWN0ZWRJbmRleCA9IC0xOwoJCQkJfQoJCQkJcmV0dXJuIHZhbHVlczsKCQkJfQoJCX0KCX0KfSk7CgovLyBSYWRpb3MgYW5kIGNoZWNrYm94ZXMgZ2V0dGVyL3NldHRlcgpqUXVlcnkuZWFjaChbICJyYWRpbyIsICJjaGVja2JveCIgXSwgZnVuY3Rpb24oKSB7CglqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHsKCQlzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHsKCQkJaWYgKCBqUXVlcnkuaXNBcnJheSggdmFsdWUgKSApIHsKCQkJCXJldHVybiAoIGVsZW0uY2hlY2tlZCA9IGpRdWVyeS5pbkFycmF5KCBqUXVlcnkoZWxlbSkudmFsKCksIHZhbHVlICkgPj0gMCApOwoJCQl9CgkJfQoJfTsKCWlmICggIXN1cHBvcnQuY2hlY2tPbiApIHsKCQlqUXVlcnkudmFsSG9va3NbIHRoaXMgXS5nZXQgPSBmdW5jdGlvbiggZWxlbSApIHsKCQkJcmV0dXJuIGVsZW0uZ2V0QXR0cmlidXRlKCJ2YWx1ZSIpID09PSBudWxsID8gIm9uIiA6IGVsZW0udmFsdWU7CgkJfTsKCX0KfSk7CgoKCgovLyBSZXR1cm4galF1ZXJ5IGZvciBhdHRyaWJ1dGVzLW9ubHkgaW5jbHVzaW9uCgoKalF1ZXJ5LmVhY2goICgiYmx1ciBmb2N1cyBmb2N1c2luIGZvY3Vzb3V0IGxvYWQgcmVzaXplIHNjcm9sbCB1bmxvYWQgY2xpY2sgZGJsY2xpY2sgIiArCgkibW91c2Vkb3duIG1vdXNldXAgbW91c2Vtb3ZlIG1vdXNlb3ZlciBtb3VzZW91dCBtb3VzZWVudGVyIG1vdXNlbGVhdmUgIiArCgkiY2hhbmdlIHNlbGVjdCBzdWJtaXQga2V5ZG93biBrZXlwcmVzcyBrZXl1cCBlcnJvciBjb250ZXh0bWVudSIpLnNwbGl0KCIgIiksIGZ1bmN0aW9uKCBpLCBuYW1lICkgewoKCS8vIEhhbmRsZSBldmVudCBiaW5kaW5nCglqUXVlcnkuZm5bIG5hbWUgXSA9IGZ1bmN0aW9uKCBkYXRhLCBmbiApIHsKCQlyZXR1cm4gYXJndW1lbnRzLmxlbmd0aCA+IDAgPwoJCQl0aGlzLm9uKCBuYW1lLCBudWxsLCBkYXRhLCBmbiApIDoKCQkJdGhpcy50cmlnZ2VyKCBuYW1lICk7Cgl9Owp9KTsKCmpRdWVyeS5mbi5leHRlbmQoewoJaG92ZXI6IGZ1bmN0aW9uKCBmbk92ZXIsIGZuT3V0ICkgewoJCXJldHVybiB0aGlzLm1vdXNlZW50ZXIoIGZuT3ZlciApLm1vdXNlbGVhdmUoIGZuT3V0IHx8IGZuT3ZlciApOwoJfSwKCgliaW5kOiBmdW5jdGlvbiggdHlwZXMsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgbnVsbCwgZGF0YSwgZm4gKTsKCX0sCgl1bmJpbmQ6IGZ1bmN0aW9uKCB0eXBlcywgZm4gKSB7CgkJcmV0dXJuIHRoaXMub2ZmKCB0eXBlcywgbnVsbCwgZm4gKTsKCX0sCgoJZGVsZWdhdGU6IGZ1bmN0aW9uKCBzZWxlY3RvciwgdHlwZXMsIGRhdGEsIGZuICkgewoJCXJldHVybiB0aGlzLm9uKCB0eXBlcywgc2VsZWN0b3IsIGRhdGEsIGZuICk7Cgl9LAoJdW5kZWxlZ2F0ZTogZnVuY3Rpb24oIHNlbGVjdG9yLCB0eXBlcywgZm4gKSB7CgkJLy8gKCBuYW1lc3BhY2UgKSBvciAoIHNlbGVjdG9yLCB0eXBlcyBbLCBmbl0gKQoJCXJldHVybiBhcmd1bWVudHMubGVuZ3RoID09PSAxID8gdGhpcy5vZmYoIHNlbGVjdG9yLCAiKioiICkgOiB0aGlzLm9mZiggdHlwZXMsIHNlbGVjdG9yIHx8ICIqKiIsIGZuICk7Cgl9Cn0pOwoKCnZhciBub25jZSA9IGpRdWVyeS5ub3coKTsKCnZhciBycXVlcnkgPSAoL1w/Lyk7CgoKCi8vIFN1cHBvcnQ6IEFuZHJvaWQgMi4zCi8vIFdvcmthcm91bmQgZmFpbHVyZSB0byBzdHJpbmctY2FzdCBudWxsIGlucHV0CmpRdWVyeS5wYXJzZUpTT04gPSBmdW5jdGlvbiggZGF0YSApIHsKCXJldHVybiBKU09OLnBhcnNlKCBkYXRhICsgIiIgKTsKfTsKCgovLyBDcm9zcy1icm93c2VyIHhtbCBwYXJzaW5nCmpRdWVyeS5wYXJzZVhNTCA9IGZ1bmN0aW9uKCBkYXRhICkgewoJdmFyIHhtbCwgdG1wOwoJaWYgKCAhZGF0YSB8fCB0eXBlb2YgZGF0YSAhPT0gInN0cmluZyIgKSB7CgkJcmV0dXJuIG51bGw7Cgl9CgoJLy8gU3VwcG9ydDogSUU5Cgl0cnkgewoJCXRtcCA9IG5ldyBET01QYXJzZXIoKTsKCQl4bWwgPSB0bXAucGFyc2VGcm9tU3RyaW5nKCBkYXRhLCAidGV4dC94bWwiICk7Cgl9IGNhdGNoICggZSApIHsKCQl4bWwgPSB1bmRlZmluZWQ7Cgl9CgoJaWYgKCAheG1sIHx8IHhtbC5nZXRFbGVtZW50c0J5VGFnTmFtZSggInBhcnNlcmVycm9yIiApLmxlbmd0aCApIHsKCQlqUXVlcnkuZXJyb3IoICJJbnZhbGlkIFhNTDogIiArIGRhdGEgKTsKCX0KCXJldHVybiB4bWw7Cn07CgoKdmFyCglyaGFzaCA9IC8jLiokLywKCXJ0cyA9IC8oWz8mXSlfPVteJl0qLywKCXJoZWFkZXJzID0gL14oLio/KTpbIFx0XSooW15cclxuXSopJC9tZywKCS8vICM3NjUzLCAjODEyNSwgIzgxNTI6IGxvY2FsIHByb3RvY29sIGRldGVjdGlvbgoJcmxvY2FsUHJvdG9jb2wgPSAvXig/OmFib3V0fGFwcHxhcHAtc3RvcmFnZXwuKy1leHRlbnNpb258ZmlsZXxyZXN8d2lkZ2V0KTokLywKCXJub0NvbnRlbnQgPSAvXig/OkdFVHxIRUFEKSQvLAoJcnByb3RvY29sID0gL15cL1wvLywKCXJ1cmwgPSAvXihbXHcuKy1dKzopKD86XC9cLyg/OlteXC8/I10qQHwpKFteXC8/IzpdKikoPzo6KFxkKyl8KXwpLywKCgkvKiBQcmVmaWx0ZXJzCgkgKiAxKSBUaGV5IGFyZSB1c2VmdWwgdG8gaW50cm9kdWNlIGN1c3RvbSBkYXRhVHlwZXMgKHNlZSBhamF4L2pzb25wLmpzIGZvciBhbiBleGFtcGxlKQoJICogMikgVGhlc2UgYXJlIGNhbGxlZDoKCSAqICAgIC0gQkVGT1JFIGFza2luZyBmb3IgYSB0cmFuc3BvcnQKCSAqICAgIC0gQUZURVIgcGFyYW0gc2VyaWFsaXphdGlvbiAocy5kYXRhIGlzIGEgc3RyaW5nIGlmIHMucHJvY2Vzc0RhdGEgaXMgdHJ1ZSkKCSAqIDMpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDQpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiA1KSBleGVjdXRpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBjb250aW51ZSBkb3duIHRvICIqIiBpZiBuZWVkZWQKCSAqLwoJcHJlZmlsdGVycyA9IHt9LAoKCS8qIFRyYW5zcG9ydHMgYmluZGluZ3MKCSAqIDEpIGtleSBpcyB0aGUgZGF0YVR5cGUKCSAqIDIpIHRoZSBjYXRjaGFsbCBzeW1ib2wgIioiIGNhbiBiZSB1c2VkCgkgKiAzKSBzZWxlY3Rpb24gd2lsbCBzdGFydCB3aXRoIHRyYW5zcG9ydCBkYXRhVHlwZSBhbmQgVEhFTiBnbyB0byAiKiIgaWYgbmVlZGVkCgkgKi8KCXRyYW5zcG9ydHMgPSB7fSwKCgkvLyBBdm9pZCBjb21tZW50LXByb2xvZyBjaGFyIHNlcXVlbmNlICgjMTAwOTgpOyBtdXN0IGFwcGVhc2UgbGludCBhbmQgZXZhZGUgY29tcHJlc3Npb24KCWFsbFR5cGVzID0gIiovIi5jb25jYXQoICIqIiApLAoKCS8vIERvY3VtZW50IGxvY2F0aW9uCglhamF4TG9jYXRpb24gPSBsb2NhdGlvbi5ocmVmLAoKCS8vIFNlZ21lbnQgbG9jYXRpb24gaW50byBwYXJ0cwoJYWpheExvY1BhcnRzID0gcnVybC5leGVjKCBhamF4TG9jYXRpb24udG9Mb3dlckNhc2UoKSApIHx8IFtdOwoKLy8gQmFzZSAiY29uc3RydWN0b3IiIGZvciBqUXVlcnkuYWpheFByZWZpbHRlciBhbmQgalF1ZXJ5LmFqYXhUcmFuc3BvcnQKZnVuY3Rpb24gYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBzdHJ1Y3R1cmUgKSB7CgoJLy8gZGF0YVR5cGVFeHByZXNzaW9uIGlzIG9wdGlvbmFsIGFuZCBkZWZhdWx0cyB0byAiKiIKCXJldHVybiBmdW5jdGlvbiggZGF0YVR5cGVFeHByZXNzaW9uLCBmdW5jICkgewoKCQlpZiAoIHR5cGVvZiBkYXRhVHlwZUV4cHJlc3Npb24gIT09ICJzdHJpbmciICkgewoJCQlmdW5jID0gZGF0YVR5cGVFeHByZXNzaW9uOwoJCQlkYXRhVHlwZUV4cHJlc3Npb24gPSAiKiI7CgkJfQoKCQl2YXIgZGF0YVR5cGUsCgkJCWkgPSAwLAoJCQlkYXRhVHlwZXMgPSBkYXRhVHlwZUV4cHJlc3Npb24udG9Mb3dlckNhc2UoKS5tYXRjaCggcm5vdHdoaXRlICkgfHwgW107CgoJCWlmICggalF1ZXJ5LmlzRnVuY3Rpb24oIGZ1bmMgKSApIHsKCQkJLy8gRm9yIGVhY2ggZGF0YVR5cGUgaW4gdGhlIGRhdGFUeXBlRXhwcmVzc2lvbgoJCQl3aGlsZSAoIChkYXRhVHlwZSA9IGRhdGFUeXBlc1tpKytdKSApIHsKCQkJCS8vIFByZXBlbmQgaWYgcmVxdWVzdGVkCgkJCQlpZiAoIGRhdGFUeXBlWzBdID09PSAiKyIgKSB7CgkJCQkJZGF0YVR5cGUgPSBkYXRhVHlwZS5zbGljZSggMSApIHx8ICIqIjsKCQkJCQkoc3RydWN0dXJlWyBkYXRhVHlwZSBdID0gc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdKS51bnNoaWZ0KCBmdW5jICk7CgoJCQkJLy8gT3RoZXJ3aXNlIGFwcGVuZAoJCQkJfSBlbHNlIHsKCQkJCQkoc3RydWN0dXJlWyBkYXRhVHlwZSBdID0gc3RydWN0dXJlWyBkYXRhVHlwZSBdIHx8IFtdKS5wdXNoKCBmdW5jICk7CgkJCQl9CgkJCX0KCQl9Cgl9Owp9CgovLyBCYXNlIGluc3BlY3Rpb24gZnVuY3Rpb24gZm9yIHByZWZpbHRlcnMgYW5kIHRyYW5zcG9ydHMKZnVuY3Rpb24gaW5zcGVjdFByZWZpbHRlcnNPclRyYW5zcG9ydHMoIHN0cnVjdHVyZSwgb3B0aW9ucywgb3JpZ2luYWxPcHRpb25zLCBqcVhIUiApIHsKCgl2YXIgaW5zcGVjdGVkID0ge30sCgkJc2Vla2luZ1RyYW5zcG9ydCA9ICggc3RydWN0dXJlID09PSB0cmFuc3BvcnRzICk7CgoJZnVuY3Rpb24gaW5zcGVjdCggZGF0YVR5cGUgKSB7CgkJdmFyIHNlbGVjdGVkOwoJCWluc3BlY3RlZFsgZGF0YVR5cGUgXSA9IHRydWU7CgkJalF1ZXJ5LmVhY2goIHN0cnVjdHVyZVsgZGF0YVR5cGUgXSB8fCBbXSwgZnVuY3Rpb24oIF8sIHByZWZpbHRlck9yRmFjdG9yeSApIHsKCQkJdmFyIGRhdGFUeXBlT3JUcmFuc3BvcnQgPSBwcmVmaWx0ZXJPckZhY3RvcnkoIG9wdGlvbnMsIG9yaWdpbmFsT3B0aW9ucywganFYSFIgKTsKCQkJaWYgKCB0eXBlb2YgZGF0YVR5cGVPclRyYW5zcG9ydCA9PT0gInN0cmluZyIgJiYgIXNlZWtpbmdUcmFuc3BvcnQgJiYgIWluc3BlY3RlZFsgZGF0YVR5cGVPclRyYW5zcG9ydCBdICkgewoJCQkJb3B0aW9ucy5kYXRhVHlwZXMudW5zaGlmdCggZGF0YVR5cGVPclRyYW5zcG9ydCApOwoJCQkJaW5zcGVjdCggZGF0YVR5cGVPclRyYW5zcG9ydCApOwoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9IGVsc2UgaWYgKCBzZWVraW5nVHJhbnNwb3J0ICkgewoJCQkJcmV0dXJuICEoIHNlbGVjdGVkID0gZGF0YVR5cGVPclRyYW5zcG9ydCApOwoJCQl9CgkJfSk7CgkJcmV0dXJuIHNlbGVjdGVkOwoJfQoKCXJldHVybiBpbnNwZWN0KCBvcHRpb25zLmRhdGFUeXBlc1sgMCBdICkgfHwgIWluc3BlY3RlZFsgIioiIF0gJiYgaW5zcGVjdCggIioiICk7Cn0KCi8vIEEgc3BlY2lhbCBleHRlbmQgZm9yIGFqYXggb3B0aW9ucwovLyB0aGF0IHRha2VzICJmbGF0IiBvcHRpb25zIChub3QgdG8gYmUgZGVlcCBleHRlbmRlZCkKLy8gRml4ZXMgIzk4ODcKZnVuY3Rpb24gYWpheEV4dGVuZCggdGFyZ2V0LCBzcmMgKSB7Cgl2YXIga2V5LCBkZWVwLAoJCWZsYXRPcHRpb25zID0galF1ZXJ5LmFqYXhTZXR0aW5ncy5mbGF0T3B0aW9ucyB8fCB7fTsKCglmb3IgKCBrZXkgaW4gc3JjICkgewoJCWlmICggc3JjWyBrZXkgXSAhPT0gdW5kZWZpbmVkICkgewoJCQkoIGZsYXRPcHRpb25zWyBrZXkgXSA/IHRhcmdldCA6ICggZGVlcCB8fCAoZGVlcCA9IHt9KSApIClbIGtleSBdID0gc3JjWyBrZXkgXTsKCQl9Cgl9CglpZiAoIGRlZXAgKSB7CgkJalF1ZXJ5LmV4dGVuZCggdHJ1ZSwgdGFyZ2V0LCBkZWVwICk7Cgl9CgoJcmV0dXJuIHRhcmdldDsKfQoKLyogSGFuZGxlcyByZXNwb25zZXMgdG8gYW4gYWpheCByZXF1ZXN0OgogKiAtIGZpbmRzIHRoZSByaWdodCBkYXRhVHlwZSAobWVkaWF0ZXMgYmV0d2VlbiBjb250ZW50LXR5cGUgYW5kIGV4cGVjdGVkIGRhdGFUeXBlKQogKiAtIHJldHVybnMgdGhlIGNvcnJlc3BvbmRpbmcgcmVzcG9uc2UKICovCmZ1bmN0aW9uIGFqYXhIYW5kbGVSZXNwb25zZXMoIHMsIGpxWEhSLCByZXNwb25zZXMgKSB7CgoJdmFyIGN0LCB0eXBlLCBmaW5hbERhdGFUeXBlLCBmaXJzdERhdGFUeXBlLAoJCWNvbnRlbnRzID0gcy5jb250ZW50cywKCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlczsKCgkvLyBSZW1vdmUgYXV0byBkYXRhVHlwZSBhbmQgZ2V0IGNvbnRlbnQtdHlwZSBpbiB0aGUgcHJvY2VzcwoJd2hpbGUgKCBkYXRhVHlwZXNbIDAgXSA9PT0gIioiICkgewoJCWRhdGFUeXBlcy5zaGlmdCgpOwoJCWlmICggY3QgPT09IHVuZGVmaW5lZCApIHsKCQkJY3QgPSBzLm1pbWVUeXBlIHx8IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJDb250ZW50LVR5cGUiKTsKCQl9Cgl9CgoJLy8gQ2hlY2sgaWYgd2UncmUgZGVhbGluZyB3aXRoIGEga25vd24gY29udGVudC10eXBlCglpZiAoIGN0ICkgewoJCWZvciAoIHR5cGUgaW4gY29udGVudHMgKSB7CgkJCWlmICggY29udGVudHNbIHR5cGUgXSAmJiBjb250ZW50c1sgdHlwZSBdLnRlc3QoIGN0ICkgKSB7CgkJCQlkYXRhVHlwZXMudW5zaGlmdCggdHlwZSApOwoJCQkJYnJlYWs7CgkJCX0KCQl9Cgl9CgoJLy8gQ2hlY2sgdG8gc2VlIGlmIHdlIGhhdmUgYSByZXNwb25zZSBmb3IgdGhlIGV4cGVjdGVkIGRhdGFUeXBlCglpZiAoIGRhdGFUeXBlc1sgMCBdIGluIHJlc3BvbnNlcyApIHsKCQlmaW5hbERhdGFUeXBlID0gZGF0YVR5cGVzWyAwIF07Cgl9IGVsc2UgewoJCS8vIFRyeSBjb252ZXJ0aWJsZSBkYXRhVHlwZXMKCQlmb3IgKCB0eXBlIGluIHJlc3BvbnNlcyApIHsKCQkJaWYgKCAhZGF0YVR5cGVzWyAwIF0gfHwgcy5jb252ZXJ0ZXJzWyB0eXBlICsgIiAiICsgZGF0YVR5cGVzWzBdIF0gKSB7CgkJCQlmaW5hbERhdGFUeXBlID0gdHlwZTsKCQkJCWJyZWFrOwoJCQl9CgkJCWlmICggIWZpcnN0RGF0YVR5cGUgKSB7CgkJCQlmaXJzdERhdGFUeXBlID0gdHlwZTsKCQkJfQoJCX0KCQkvLyBPciBqdXN0IHVzZSBmaXJzdCBvbmUKCQlmaW5hbERhdGFUeXBlID0gZmluYWxEYXRhVHlwZSB8fCBmaXJzdERhdGFUeXBlOwoJfQoKCS8vIElmIHdlIGZvdW5kIGEgZGF0YVR5cGUKCS8vIFdlIGFkZCB0aGUgZGF0YVR5cGUgdG8gdGhlIGxpc3QgaWYgbmVlZGVkCgkvLyBhbmQgcmV0dXJuIHRoZSBjb3JyZXNwb25kaW5nIHJlc3BvbnNlCglpZiAoIGZpbmFsRGF0YVR5cGUgKSB7CgkJaWYgKCBmaW5hbERhdGFUeXBlICE9PSBkYXRhVHlwZXNbIDAgXSApIHsKCQkJZGF0YVR5cGVzLnVuc2hpZnQoIGZpbmFsRGF0YVR5cGUgKTsKCQl9CgkJcmV0dXJuIHJlc3BvbnNlc1sgZmluYWxEYXRhVHlwZSBdOwoJfQp9CgovKiBDaGFpbiBjb252ZXJzaW9ucyBnaXZlbiB0aGUgcmVxdWVzdCBhbmQgdGhlIG9yaWdpbmFsIHJlc3BvbnNlCiAqIEFsc28gc2V0cyB0aGUgcmVzcG9uc2VYWFggZmllbGRzIG9uIHRoZSBqcVhIUiBpbnN0YW5jZQogKi8KZnVuY3Rpb24gYWpheENvbnZlcnQoIHMsIHJlc3BvbnNlLCBqcVhIUiwgaXNTdWNjZXNzICkgewoJdmFyIGNvbnYyLCBjdXJyZW50LCBjb252LCB0bXAsIHByZXYsCgkJY29udmVydGVycyA9IHt9LAoJCS8vIFdvcmsgd2l0aCBhIGNvcHkgb2YgZGF0YVR5cGVzIGluIGNhc2Ugd2UgbmVlZCB0byBtb2RpZnkgaXQgZm9yIGNvbnZlcnNpb24KCQlkYXRhVHlwZXMgPSBzLmRhdGFUeXBlcy5zbGljZSgpOwoKCS8vIENyZWF0ZSBjb252ZXJ0ZXJzIG1hcCB3aXRoIGxvd2VyY2FzZWQga2V5cwoJaWYgKCBkYXRhVHlwZXNbIDEgXSApIHsKCQlmb3IgKCBjb252IGluIHMuY29udmVydGVycyApIHsKCQkJY29udmVydGVyc1sgY29udi50b0xvd2VyQ2FzZSgpIF0gPSBzLmNvbnZlcnRlcnNbIGNvbnYgXTsKCQl9Cgl9CgoJY3VycmVudCA9IGRhdGFUeXBlcy5zaGlmdCgpOwoKCS8vIENvbnZlcnQgdG8gZWFjaCBzZXF1ZW50aWFsIGRhdGFUeXBlCgl3aGlsZSAoIGN1cnJlbnQgKSB7CgoJCWlmICggcy5yZXNwb25zZUZpZWxkc1sgY3VycmVudCBdICkgewoJCQlqcVhIUlsgcy5yZXNwb25zZUZpZWxkc1sgY3VycmVudCBdIF0gPSByZXNwb25zZTsKCQl9CgoJCS8vIEFwcGx5IHRoZSBkYXRhRmlsdGVyIGlmIHByb3ZpZGVkCgkJaWYgKCAhcHJldiAmJiBpc1N1Y2Nlc3MgJiYgcy5kYXRhRmlsdGVyICkgewoJCQlyZXNwb25zZSA9IHMuZGF0YUZpbHRlciggcmVzcG9uc2UsIHMuZGF0YVR5cGUgKTsKCQl9CgoJCXByZXYgPSBjdXJyZW50OwoJCWN1cnJlbnQgPSBkYXRhVHlwZXMuc2hpZnQoKTsKCgkJaWYgKCBjdXJyZW50ICkgewoKCQkvLyBUaGVyZSdzIG9ubHkgd29yayB0byBkbyBpZiBjdXJyZW50IGRhdGFUeXBlIGlzIG5vbi1hdXRvCgkJCWlmICggY3VycmVudCA9PT0gIioiICkgewoKCQkJCWN1cnJlbnQgPSBwcmV2OwoKCQkJLy8gQ29udmVydCByZXNwb25zZSBpZiBwcmV2IGRhdGFUeXBlIGlzIG5vbi1hdXRvIGFuZCBkaWZmZXJzIGZyb20gY3VycmVudAoJCQl9IGVsc2UgaWYgKCBwcmV2ICE9PSAiKiIgJiYgcHJldiAhPT0gY3VycmVudCApIHsKCgkJCQkvLyBTZWVrIGEgZGlyZWN0IGNvbnZlcnRlcgoJCQkJY29udiA9IGNvbnZlcnRlcnNbIHByZXYgKyAiICIgKyBjdXJyZW50IF0gfHwgY29udmVydGVyc1sgIiogIiArIGN1cnJlbnQgXTsKCgkJCQkvLyBJZiBub25lIGZvdW5kLCBzZWVrIGEgcGFpcgoJCQkJaWYgKCAhY29udiApIHsKCQkJCQlmb3IgKCBjb252MiBpbiBjb252ZXJ0ZXJzICkgewoKCQkJCQkJLy8gSWYgY29udjIgb3V0cHV0cyBjdXJyZW50CgkJCQkJCXRtcCA9IGNvbnYyLnNwbGl0KCAiICIgKTsKCQkJCQkJaWYgKCB0bXBbIDEgXSA9PT0gY3VycmVudCApIHsKCgkJCQkJCQkvLyBJZiBwcmV2IGNhbiBiZSBjb252ZXJ0ZWQgdG8gYWNjZXB0ZWQgaW5wdXQKCQkJCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBwcmV2ICsgIiAiICsgdG1wWyAwIF0gXSB8fAoJCQkJCQkJCWNvbnZlcnRlcnNbICIqICIgKyB0bXBbIDAgXSBdOwoJCQkJCQkJaWYgKCBjb252ICkgewoJCQkJCQkJCS8vIENvbmRlbnNlIGVxdWl2YWxlbmNlIGNvbnZlcnRlcnMKCQkJCQkJCQlpZiAoIGNvbnYgPT09IHRydWUgKSB7CgkJCQkJCQkJCWNvbnYgPSBjb252ZXJ0ZXJzWyBjb252MiBdOwoKCQkJCQkJCQkvLyBPdGhlcndpc2UsIGluc2VydCB0aGUgaW50ZXJtZWRpYXRlIGRhdGFUeXBlCgkJCQkJCQkJfSBlbHNlIGlmICggY29udmVydGVyc1sgY29udjIgXSAhPT0gdHJ1ZSApIHsKCQkJCQkJCQkJY3VycmVudCA9IHRtcFsgMCBdOwoJCQkJCQkJCQlkYXRhVHlwZXMudW5zaGlmdCggdG1wWyAxIF0gKTsKCQkJCQkJCQl9CgkJCQkJCQkJYnJlYWs7CgkJCQkJCQl9CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgoJCQkJLy8gQXBwbHkgY29udmVydGVyIChpZiBub3QgYW4gZXF1aXZhbGVuY2UpCgkJCQlpZiAoIGNvbnYgIT09IHRydWUgKSB7CgoJCQkJCS8vIFVubGVzcyBlcnJvcnMgYXJlIGFsbG93ZWQgdG8gYnViYmxlLCBjYXRjaCBhbmQgcmV0dXJuIHRoZW0KCQkJCQlpZiAoIGNvbnYgJiYgc1sgInRocm93cyIgXSApIHsKCQkJCQkJcmVzcG9uc2UgPSBjb252KCByZXNwb25zZSApOwoJCQkJCX0gZWxzZSB7CgkJCQkJCXRyeSB7CgkJCQkJCQlyZXNwb25zZSA9IGNvbnYoIHJlc3BvbnNlICk7CgkJCQkJCX0gY2F0Y2ggKCBlICkgewoJCQkJCQkJcmV0dXJuIHsgc3RhdGU6ICJwYXJzZXJlcnJvciIsIGVycm9yOiBjb252ID8gZSA6ICJObyBjb252ZXJzaW9uIGZyb20gIiArIHByZXYgKyAiIHRvICIgKyBjdXJyZW50IH07CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX0KCQl9Cgl9CgoJcmV0dXJuIHsgc3RhdGU6ICJzdWNjZXNzIiwgZGF0YTogcmVzcG9uc2UgfTsKfQoKalF1ZXJ5LmV4dGVuZCh7CgoJLy8gQ291bnRlciBmb3IgaG9sZGluZyB0aGUgbnVtYmVyIG9mIGFjdGl2ZSBxdWVyaWVzCglhY3RpdmU6IDAsCgoJLy8gTGFzdC1Nb2RpZmllZCBoZWFkZXIgY2FjaGUgZm9yIG5leHQgcmVxdWVzdAoJbGFzdE1vZGlmaWVkOiB7fSwKCWV0YWc6IHt9LAoKCWFqYXhTZXR0aW5nczogewoJCXVybDogYWpheExvY2F0aW9uLAoJCXR5cGU6ICJHRVQiLAoJCWlzTG9jYWw6IHJsb2NhbFByb3RvY29sLnRlc3QoIGFqYXhMb2NQYXJ0c1sgMSBdICksCgkJZ2xvYmFsOiB0cnVlLAoJCXByb2Nlc3NEYXRhOiB0cnVlLAoJCWFzeW5jOiB0cnVlLAoJCWNvbnRlbnRUeXBlOiAiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkOyBjaGFyc2V0PVVURi04IiwKCQkvKgoJCXRpbWVvdXQ6IDAsCgkJZGF0YTogbnVsbCwKCQlkYXRhVHlwZTogbnVsbCwKCQl1c2VybmFtZTogbnVsbCwKCQlwYXNzd29yZDogbnVsbCwKCQljYWNoZTogbnVsbCwKCQl0aHJvd3M6IGZhbHNlLAoJCXRyYWRpdGlvbmFsOiBmYWxzZSwKCQloZWFkZXJzOiB7fSwKCQkqLwoKCQlhY2NlcHRzOiB7CgkJCSIqIjogYWxsVHlwZXMsCgkJCXRleHQ6ICJ0ZXh0L3BsYWluIiwKCQkJaHRtbDogInRleHQvaHRtbCIsCgkJCXhtbDogImFwcGxpY2F0aW9uL3htbCwgdGV4dC94bWwiLAoJCQlqc29uOiAiYXBwbGljYXRpb24vanNvbiwgdGV4dC9qYXZhc2NyaXB0IgoJCX0sCgoJCWNvbnRlbnRzOiB7CgkJCXhtbDogL3htbC8sCgkJCWh0bWw6IC9odG1sLywKCQkJanNvbjogL2pzb24vCgkJfSwKCgkJcmVzcG9uc2VGaWVsZHM6IHsKCQkJeG1sOiAicmVzcG9uc2VYTUwiLAoJCQl0ZXh0OiAicmVzcG9uc2VUZXh0IiwKCQkJanNvbjogInJlc3BvbnNlSlNPTiIKCQl9LAoKCQkvLyBEYXRhIGNvbnZlcnRlcnMKCQkvLyBLZXlzIHNlcGFyYXRlIHNvdXJjZSAob3IgY2F0Y2hhbGwgIioiKSBhbmQgZGVzdGluYXRpb24gdHlwZXMgd2l0aCBhIHNpbmdsZSBzcGFjZQoJCWNvbnZlcnRlcnM6IHsKCgkJCS8vIENvbnZlcnQgYW55dGhpbmcgdG8gdGV4dAoJCQkiKiB0ZXh0IjogU3RyaW5nLAoKCQkJLy8gVGV4dCB0byBodG1sICh0cnVlID0gbm8gdHJhbnNmb3JtYXRpb24pCgkJCSJ0ZXh0IGh0bWwiOiB0cnVlLAoKCQkJLy8gRXZhbHVhdGUgdGV4dCBhcyBhIGpzb24gZXhwcmVzc2lvbgoJCQkidGV4dCBqc29uIjogalF1ZXJ5LnBhcnNlSlNPTiwKCgkJCS8vIFBhcnNlIHRleHQgYXMgeG1sCgkJCSJ0ZXh0IHhtbCI6IGpRdWVyeS5wYXJzZVhNTAoJCX0sCgoJCS8vIEZvciBvcHRpb25zIHRoYXQgc2hvdWxkbid0IGJlIGRlZXAgZXh0ZW5kZWQ6CgkJLy8geW91IGNhbiBhZGQgeW91ciBvd24gY3VzdG9tIG9wdGlvbnMgaGVyZSBpZgoJCS8vIGFuZCB3aGVuIHlvdSBjcmVhdGUgb25lIHRoYXQgc2hvdWxkbid0IGJlCgkJLy8gZGVlcCBleHRlbmRlZCAoc2VlIGFqYXhFeHRlbmQpCgkJZmxhdE9wdGlvbnM6IHsKCQkJdXJsOiB0cnVlLAoJCQljb250ZXh0OiB0cnVlCgkJfQoJfSwKCgkvLyBDcmVhdGVzIGEgZnVsbCBmbGVkZ2VkIHNldHRpbmdzIG9iamVjdCBpbnRvIHRhcmdldAoJLy8gd2l0aCBib3RoIGFqYXhTZXR0aW5ncyBhbmQgc2V0dGluZ3MgZmllbGRzLgoJLy8gSWYgdGFyZ2V0IGlzIG9taXR0ZWQsIHdyaXRlcyBpbnRvIGFqYXhTZXR0aW5ncy4KCWFqYXhTZXR1cDogZnVuY3Rpb24oIHRhcmdldCwgc2V0dGluZ3MgKSB7CgkJcmV0dXJuIHNldHRpbmdzID8KCgkJCS8vIEJ1aWxkaW5nIGEgc2V0dGluZ3Mgb2JqZWN0CgkJCWFqYXhFeHRlbmQoIGFqYXhFeHRlbmQoIHRhcmdldCwgalF1ZXJ5LmFqYXhTZXR0aW5ncyApLCBzZXR0aW5ncyApIDoKCgkJCS8vIEV4dGVuZGluZyBhamF4U2V0dGluZ3MKCQkJYWpheEV4dGVuZCggalF1ZXJ5LmFqYXhTZXR0aW5ncywgdGFyZ2V0ICk7Cgl9LAoKCWFqYXhQcmVmaWx0ZXI6IGFkZFRvUHJlZmlsdGVyc09yVHJhbnNwb3J0cyggcHJlZmlsdGVycyApLAoJYWpheFRyYW5zcG9ydDogYWRkVG9QcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCB0cmFuc3BvcnRzICksCgoJLy8gTWFpbiBtZXRob2QKCWFqYXg6IGZ1bmN0aW9uKCB1cmwsIG9wdGlvbnMgKSB7CgoJCS8vIElmIHVybCBpcyBhbiBvYmplY3QsIHNpbXVsYXRlIHByZS0xLjUgc2lnbmF0dXJlCgkJaWYgKCB0eXBlb2YgdXJsID09PSAib2JqZWN0IiApIHsKCQkJb3B0aW9ucyA9IHVybDsKCQkJdXJsID0gdW5kZWZpbmVkOwoJCX0KCgkJLy8gRm9yY2Ugb3B0aW9ucyB0byBiZSBhbiBvYmplY3QKCQlvcHRpb25zID0gb3B0aW9ucyB8fCB7fTsKCgkJdmFyIHRyYW5zcG9ydCwKCQkJLy8gVVJMIHdpdGhvdXQgYW50aS1jYWNoZSBwYXJhbQoJCQljYWNoZVVSTCwKCQkJLy8gUmVzcG9uc2UgaGVhZGVycwoJCQlyZXNwb25zZUhlYWRlcnNTdHJpbmcsCgkJCXJlc3BvbnNlSGVhZGVycywKCQkJLy8gdGltZW91dCBoYW5kbGUKCQkJdGltZW91dFRpbWVyLAoJCQkvLyBDcm9zcy1kb21haW4gZGV0ZWN0aW9uIHZhcnMKCQkJcGFydHMsCgkJCS8vIFRvIGtub3cgaWYgZ2xvYmFsIGV2ZW50cyBhcmUgdG8gYmUgZGlzcGF0Y2hlZAoJCQlmaXJlR2xvYmFscywKCQkJLy8gTG9vcCB2YXJpYWJsZQoJCQlpLAoJCQkvLyBDcmVhdGUgdGhlIGZpbmFsIG9wdGlvbnMgb2JqZWN0CgkJCXMgPSBqUXVlcnkuYWpheFNldHVwKCB7fSwgb3B0aW9ucyApLAoJCQkvLyBDYWxsYmFja3MgY29udGV4dAoJCQljYWxsYmFja0NvbnRleHQgPSBzLmNvbnRleHQgfHwgcywKCQkJLy8gQ29udGV4dCBmb3IgZ2xvYmFsIGV2ZW50cyBpcyBjYWxsYmFja0NvbnRleHQgaWYgaXQgaXMgYSBET00gbm9kZSBvciBqUXVlcnkgY29sbGVjdGlvbgoJCQlnbG9iYWxFdmVudENvbnRleHQgPSBzLmNvbnRleHQgJiYgKCBjYWxsYmFja0NvbnRleHQubm9kZVR5cGUgfHwgY2FsbGJhY2tDb250ZXh0LmpxdWVyeSApID8KCQkJCWpRdWVyeSggY2FsbGJhY2tDb250ZXh0ICkgOgoJCQkJalF1ZXJ5LmV2ZW50LAoJCQkvLyBEZWZlcnJlZHMKCQkJZGVmZXJyZWQgPSBqUXVlcnkuRGVmZXJyZWQoKSwKCQkJY29tcGxldGVEZWZlcnJlZCA9IGpRdWVyeS5DYWxsYmFja3MoIm9uY2UgbWVtb3J5IiksCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCXN0YXR1c0NvZGUgPSBzLnN0YXR1c0NvZGUgfHwge30sCgkJCS8vIEhlYWRlcnMgKHRoZXkgYXJlIHNlbnQgYWxsIGF0IG9uY2UpCgkJCXJlcXVlc3RIZWFkZXJzID0ge30sCgkJCXJlcXVlc3RIZWFkZXJzTmFtZXMgPSB7fSwKCQkJLy8gVGhlIGpxWEhSIHN0YXRlCgkJCXN0YXRlID0gMCwKCQkJLy8gRGVmYXVsdCBhYm9ydCBtZXNzYWdlCgkJCXN0ckFib3J0ID0gImNhbmNlbGVkIiwKCQkJLy8gRmFrZSB4aHIKCQkJanFYSFIgPSB7CgkJCQlyZWFkeVN0YXRlOiAwLAoKCQkJCS8vIEJ1aWxkcyBoZWFkZXJzIGhhc2h0YWJsZSBpZiBuZWVkZWQKCQkJCWdldFJlc3BvbnNlSGVhZGVyOiBmdW5jdGlvbigga2V5ICkgewoJCQkJCXZhciBtYXRjaDsKCQkJCQlpZiAoIHN0YXRlID09PSAyICkgewoJCQkJCQlpZiAoICFyZXNwb25zZUhlYWRlcnMgKSB7CgkJCQkJCQlyZXNwb25zZUhlYWRlcnMgPSB7fTsKCQkJCQkJCXdoaWxlICggKG1hdGNoID0gcmhlYWRlcnMuZXhlYyggcmVzcG9uc2VIZWFkZXJzU3RyaW5nICkpICkgewoJCQkJCQkJCXJlc3BvbnNlSGVhZGVyc1sgbWF0Y2hbMV0udG9Mb3dlckNhc2UoKSBdID0gbWF0Y2hbIDIgXTsKCQkJCQkJCX0KCQkJCQkJfQoJCQkJCQltYXRjaCA9IHJlc3BvbnNlSGVhZGVyc1sga2V5LnRvTG93ZXJDYXNlKCkgXTsKCQkJCQl9CgkJCQkJcmV0dXJuIG1hdGNoID09IG51bGwgPyBudWxsIDogbWF0Y2g7CgkJCQl9LAoKCQkJCS8vIFJhdyBzdHJpbmcKCQkJCWdldEFsbFJlc3BvbnNlSGVhZGVyczogZnVuY3Rpb24oKSB7CgkJCQkJcmV0dXJuIHN0YXRlID09PSAyID8gcmVzcG9uc2VIZWFkZXJzU3RyaW5nIDogbnVsbDsKCQkJCX0sCgoJCQkJLy8gQ2FjaGVzIHRoZSBoZWFkZXIKCQkJCXNldFJlcXVlc3RIZWFkZXI6IGZ1bmN0aW9uKCBuYW1lLCB2YWx1ZSApIHsKCQkJCQl2YXIgbG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCW5hbWUgPSByZXF1ZXN0SGVhZGVyc05hbWVzWyBsbmFtZSBdID0gcmVxdWVzdEhlYWRlcnNOYW1lc1sgbG5hbWUgXSB8fCBuYW1lOwoJCQkJCQlyZXF1ZXN0SGVhZGVyc1sgbmFtZSBdID0gdmFsdWU7CgkJCQkJfQoJCQkJCXJldHVybiB0aGlzOwoJCQkJfSwKCgkJCQkvLyBPdmVycmlkZXMgcmVzcG9uc2UgY29udGVudC10eXBlIGhlYWRlcgoJCQkJb3ZlcnJpZGVNaW1lVHlwZTogZnVuY3Rpb24oIHR5cGUgKSB7CgkJCQkJaWYgKCAhc3RhdGUgKSB7CgkJCQkJCXMubWltZVR5cGUgPSB0eXBlOwoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gU3RhdHVzLWRlcGVuZGVudCBjYWxsYmFja3MKCQkJCXN0YXR1c0NvZGU6IGZ1bmN0aW9uKCBtYXAgKSB7CgkJCQkJdmFyIGNvZGU7CgkJCQkJaWYgKCBtYXAgKSB7CgkJCQkJCWlmICggc3RhdGUgPCAyICkgewoJCQkJCQkJZm9yICggY29kZSBpbiBtYXAgKSB7CgkJCQkJCQkJLy8gTGF6eS1hZGQgdGhlIG5ldyBjYWxsYmFjayBpbiBhIHdheSB0aGF0IHByZXNlcnZlcyBvbGQgb25lcwoJCQkJCQkJCXN0YXR1c0NvZGVbIGNvZGUgXSA9IFsgc3RhdHVzQ29kZVsgY29kZSBdLCBtYXBbIGNvZGUgXSBdOwoJCQkJCQkJfQoJCQkJCQl9IGVsc2UgewoJCQkJCQkJLy8gRXhlY3V0ZSB0aGUgYXBwcm9wcmlhdGUgY2FsbGJhY2tzCgkJCQkJCQlqcVhIUi5hbHdheXMoIG1hcFsganFYSFIuc3RhdHVzIF0gKTsKCQkJCQkJfQoJCQkJCX0KCQkJCQlyZXR1cm4gdGhpczsKCQkJCX0sCgoJCQkJLy8gQ2FuY2VsIHRoZSByZXF1ZXN0CgkJCQlhYm9ydDogZnVuY3Rpb24oIHN0YXR1c1RleHQgKSB7CgkJCQkJdmFyIGZpbmFsVGV4dCA9IHN0YXR1c1RleHQgfHwgc3RyQWJvcnQ7CgkJCQkJaWYgKCB0cmFuc3BvcnQgKSB7CgkJCQkJCXRyYW5zcG9ydC5hYm9ydCggZmluYWxUZXh0ICk7CgkJCQkJfQoJCQkJCWRvbmUoIDAsIGZpbmFsVGV4dCApOwoJCQkJCXJldHVybiB0aGlzOwoJCQkJfQoJCQl9OwoKCQkvLyBBdHRhY2ggZGVmZXJyZWRzCgkJZGVmZXJyZWQucHJvbWlzZSgganFYSFIgKS5jb21wbGV0ZSA9IGNvbXBsZXRlRGVmZXJyZWQuYWRkOwoJCWpxWEhSLnN1Y2Nlc3MgPSBqcVhIUi5kb25lOwoJCWpxWEhSLmVycm9yID0ganFYSFIuZmFpbDsKCgkJLy8gUmVtb3ZlIGhhc2ggY2hhcmFjdGVyICgjNzUzMTogYW5kIHN0cmluZyBwcm9tb3Rpb24pCgkJLy8gQWRkIHByb3RvY29sIGlmIG5vdCBwcm92aWRlZCAocHJlZmlsdGVycyBtaWdodCBleHBlY3QgaXQpCgkJLy8gSGFuZGxlIGZhbHN5IHVybCBpbiB0aGUgc2V0dGluZ3Mgb2JqZWN0ICgjMTAwOTM6IGNvbnNpc3RlbmN5IHdpdGggb2xkIHNpZ25hdHVyZSkKCQkvLyBXZSBhbHNvIHVzZSB0aGUgdXJsIHBhcmFtZXRlciBpZiBhdmFpbGFibGUKCQlzLnVybCA9ICggKCB1cmwgfHwgcy51cmwgfHwgYWpheExvY2F0aW9uICkgKyAiIiApLnJlcGxhY2UoIHJoYXNoLCAiIiApCgkJCS5yZXBsYWNlKCBycHJvdG9jb2wsIGFqYXhMb2NQYXJ0c1sgMSBdICsgIi8vIiApOwoKCQkvLyBBbGlhcyBtZXRob2Qgb3B0aW9uIHRvIHR5cGUgYXMgcGVyIHRpY2tldCAjMTIwMDQKCQlzLnR5cGUgPSBvcHRpb25zLm1ldGhvZCB8fCBvcHRpb25zLnR5cGUgfHwgcy5tZXRob2QgfHwgcy50eXBlOwoKCQkvLyBFeHRyYWN0IGRhdGFUeXBlcyBsaXN0CgkJcy5kYXRhVHlwZXMgPSBqUXVlcnkudHJpbSggcy5kYXRhVHlwZSB8fCAiKiIgKS50b0xvd2VyQ2FzZSgpLm1hdGNoKCBybm90d2hpdGUgKSB8fCBbICIiIF07CgoJCS8vIEEgY3Jvc3MtZG9tYWluIHJlcXVlc3QgaXMgaW4gb3JkZXIgd2hlbiB3ZSBoYXZlIGEgcHJvdG9jb2w6aG9zdDpwb3J0IG1pc21hdGNoCgkJaWYgKCBzLmNyb3NzRG9tYWluID09IG51bGwgKSB7CgkJCXBhcnRzID0gcnVybC5leGVjKCBzLnVybC50b0xvd2VyQ2FzZSgpICk7CgkJCXMuY3Jvc3NEb21haW4gPSAhISggcGFydHMgJiYKCQkJCSggcGFydHNbIDEgXSAhPT0gYWpheExvY1BhcnRzWyAxIF0gfHwgcGFydHNbIDIgXSAhPT0gYWpheExvY1BhcnRzWyAyIF0gfHwKCQkJCQkoIHBhcnRzWyAzIF0gfHwgKCBwYXJ0c1sgMSBdID09PSAiaHR0cDoiID8gIjgwIiA6ICI0NDMiICkgKSAhPT0KCQkJCQkJKCBhamF4TG9jUGFydHNbIDMgXSB8fCAoIGFqYXhMb2NQYXJ0c1sgMSBdID09PSAiaHR0cDoiID8gIjgwIiA6ICI0NDMiICkgKSApCgkJCSk7CgkJfQoKCQkvLyBDb252ZXJ0IGRhdGEgaWYgbm90IGFscmVhZHkgYSBzdHJpbmcKCQlpZiAoIHMuZGF0YSAmJiBzLnByb2Nlc3NEYXRhICYmIHR5cGVvZiBzLmRhdGEgIT09ICJzdHJpbmciICkgewoJCQlzLmRhdGEgPSBqUXVlcnkucGFyYW0oIHMuZGF0YSwgcy50cmFkaXRpb25hbCApOwoJCX0KCgkJLy8gQXBwbHkgcHJlZmlsdGVycwoJCWluc3BlY3RQcmVmaWx0ZXJzT3JUcmFuc3BvcnRzKCBwcmVmaWx0ZXJzLCBzLCBvcHRpb25zLCBqcVhIUiApOwoKCQkvLyBJZiByZXF1ZXN0IHdhcyBhYm9ydGVkIGluc2lkZSBhIHByZWZpbHRlciwgc3RvcCB0aGVyZQoJCWlmICggc3RhdGUgPT09IDIgKSB7CgkJCXJldHVybiBqcVhIUjsKCQl9CgoJCS8vIFdlIGNhbiBmaXJlIGdsb2JhbCBldmVudHMgYXMgb2Ygbm93IGlmIGFza2VkIHRvCgkJLy8gRG9uJ3QgZmlyZSBldmVudHMgaWYgalF1ZXJ5LmV2ZW50IGlzIHVuZGVmaW5lZCBpbiBhbiBBTUQtdXNhZ2Ugc2NlbmFyaW8gKCMxNTExOCkKCQlmaXJlR2xvYmFscyA9IGpRdWVyeS5ldmVudCAmJiBzLmdsb2JhbDsKCgkJLy8gV2F0Y2ggZm9yIGEgbmV3IHNldCBvZiByZXF1ZXN0cwoJCWlmICggZmlyZUdsb2JhbHMgJiYgalF1ZXJ5LmFjdGl2ZSsrID09PSAwICkgewoJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcigiYWpheFN0YXJ0Iik7CgkJfQoKCQkvLyBVcHBlcmNhc2UgdGhlIHR5cGUKCQlzLnR5cGUgPSBzLnR5cGUudG9VcHBlckNhc2UoKTsKCgkJLy8gRGV0ZXJtaW5lIGlmIHJlcXVlc3QgaGFzIGNvbnRlbnQKCQlzLmhhc0NvbnRlbnQgPSAhcm5vQ29udGVudC50ZXN0KCBzLnR5cGUgKTsKCgkJLy8gU2F2ZSB0aGUgVVJMIGluIGNhc2Ugd2UncmUgdG95aW5nIHdpdGggdGhlIElmLU1vZGlmaWVkLVNpbmNlCgkJLy8gYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyIGxhdGVyIG9uCgkJY2FjaGVVUkwgPSBzLnVybDsKCgkJLy8gTW9yZSBvcHRpb25zIGhhbmRsaW5nIGZvciByZXF1ZXN0cyB3aXRoIG5vIGNvbnRlbnQKCQlpZiAoICFzLmhhc0NvbnRlbnQgKSB7CgoJCQkvLyBJZiBkYXRhIGlzIGF2YWlsYWJsZSwgYXBwZW5kIGRhdGEgdG8gdXJsCgkJCWlmICggcy5kYXRhICkgewoJCQkJY2FjaGVVUkwgPSAoIHMudXJsICs9ICggcnF1ZXJ5LnRlc3QoIGNhY2hlVVJMICkgPyAiJiIgOiAiPyIgKSArIHMuZGF0YSApOwoJCQkJLy8gIzk2ODI6IHJlbW92ZSBkYXRhIHNvIHRoYXQgaXQncyBub3QgdXNlZCBpbiBhbiBldmVudHVhbCByZXRyeQoJCQkJZGVsZXRlIHMuZGF0YTsKCQkJfQoKCQkJLy8gQWRkIGFudGktY2FjaGUgaW4gdXJsIGlmIG5lZWRlZAoJCQlpZiAoIHMuY2FjaGUgPT09IGZhbHNlICkgewoJCQkJcy51cmwgPSBydHMudGVzdCggY2FjaGVVUkwgKSA/CgoJCQkJCS8vIElmIHRoZXJlIGlzIGFscmVhZHkgYSAnXycgcGFyYW1ldGVyLCBzZXQgaXRzIHZhbHVlCgkJCQkJY2FjaGVVUkwucmVwbGFjZSggcnRzLCAiJDFfPSIgKyBub25jZSsrICkgOgoKCQkJCQkvLyBPdGhlcndpc2UgYWRkIG9uZSB0byB0aGUgZW5kCgkJCQkJY2FjaGVVUkwgKyAoIHJxdWVyeS50ZXN0KCBjYWNoZVVSTCApID8gIiYiIDogIj8iICkgKyAiXz0iICsgbm9uY2UrKzsKCQkJfQoJCX0KCgkJLy8gU2V0IHRoZSBJZi1Nb2RpZmllZC1TaW5jZSBhbmQvb3IgSWYtTm9uZS1NYXRjaCBoZWFkZXIsIGlmIGluIGlmTW9kaWZpZWQgbW9kZS4KCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJaWYgKCBqUXVlcnkubGFzdE1vZGlmaWVkWyBjYWNoZVVSTCBdICkgewoJCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggIklmLU1vZGlmaWVkLVNpbmNlIiwgalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSApOwoJCQl9CgkJCWlmICggalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gKSB7CgkJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiSWYtTm9uZS1NYXRjaCIsIGpRdWVyeS5ldGFnWyBjYWNoZVVSTCBdICk7CgkJCX0KCQl9CgoJCS8vIFNldCB0aGUgY29ycmVjdCBoZWFkZXIsIGlmIGRhdGEgaXMgYmVpbmcgc2VudAoJCWlmICggcy5kYXRhICYmIHMuaGFzQ29udGVudCAmJiBzLmNvbnRlbnRUeXBlICE9PSBmYWxzZSB8fCBvcHRpb25zLmNvbnRlbnRUeXBlICkgewoJCQlqcVhIUi5zZXRSZXF1ZXN0SGVhZGVyKCAiQ29udGVudC1UeXBlIiwgcy5jb250ZW50VHlwZSApOwoJCX0KCgkJLy8gU2V0IHRoZSBBY2NlcHRzIGhlYWRlciBmb3IgdGhlIHNlcnZlciwgZGVwZW5kaW5nIG9uIHRoZSBkYXRhVHlwZQoJCWpxWEhSLnNldFJlcXVlc3RIZWFkZXIoCgkJCSJBY2NlcHQiLAoJCQlzLmRhdGFUeXBlc1sgMCBdICYmIHMuYWNjZXB0c1sgcy5kYXRhVHlwZXNbMF0gXSA/CgkJCQlzLmFjY2VwdHNbIHMuZGF0YVR5cGVzWzBdIF0gKyAoIHMuZGF0YVR5cGVzWyAwIF0gIT09ICIqIiA/ICIsICIgKyBhbGxUeXBlcyArICI7IHE9MC4wMSIgOiAiIiApIDoKCQkJCXMuYWNjZXB0c1sgIioiIF0KCQkpOwoKCQkvLyBDaGVjayBmb3IgaGVhZGVycyBvcHRpb24KCQlmb3IgKCBpIGluIHMuaGVhZGVycyApIHsKCQkJanFYSFIuc2V0UmVxdWVzdEhlYWRlciggaSwgcy5oZWFkZXJzWyBpIF0gKTsKCQl9CgoJCS8vIEFsbG93IGN1c3RvbSBoZWFkZXJzL21pbWV0eXBlcyBhbmQgZWFybHkgYWJvcnQKCQlpZiAoIHMuYmVmb3JlU2VuZCAmJiAoIHMuYmVmb3JlU2VuZC5jYWxsKCBjYWxsYmFja0NvbnRleHQsIGpxWEhSLCBzICkgPT09IGZhbHNlIHx8IHN0YXRlID09PSAyICkgKSB7CgkJCS8vIEFib3J0IGlmIG5vdCBkb25lIGFscmVhZHkgYW5kIHJldHVybgoJCQlyZXR1cm4ganFYSFIuYWJvcnQoKTsKCQl9CgoJCS8vIEFib3J0aW5nIGlzIG5vIGxvbmdlciBhIGNhbmNlbGxhdGlvbgoJCXN0ckFib3J0ID0gImFib3J0IjsKCgkJLy8gSW5zdGFsbCBjYWxsYmFja3Mgb24gZGVmZXJyZWRzCgkJZm9yICggaSBpbiB7IHN1Y2Nlc3M6IDEsIGVycm9yOiAxLCBjb21wbGV0ZTogMSB9ICkgewoJCQlqcVhIUlsgaSBdKCBzWyBpIF0gKTsKCQl9CgoJCS8vIEdldCB0cmFuc3BvcnQKCQl0cmFuc3BvcnQgPSBpbnNwZWN0UHJlZmlsdGVyc09yVHJhbnNwb3J0cyggdHJhbnNwb3J0cywgcywgb3B0aW9ucywganFYSFIgKTsKCgkJLy8gSWYgbm8gdHJhbnNwb3J0LCB3ZSBhdXRvLWFib3J0CgkJaWYgKCAhdHJhbnNwb3J0ICkgewoJCQlkb25lKCAtMSwgIk5vIFRyYW5zcG9ydCIgKTsKCQl9IGVsc2UgewoJCQlqcVhIUi5yZWFkeVN0YXRlID0gMTsKCgkJCS8vIFNlbmQgZ2xvYmFsIGV2ZW50CgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggImFqYXhTZW5kIiwgWyBqcVhIUiwgcyBdICk7CgkJCX0KCQkJLy8gVGltZW91dAoJCQlpZiAoIHMuYXN5bmMgJiYgcy50aW1lb3V0ID4gMCApIHsKCQkJCXRpbWVvdXRUaW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQkJanFYSFIuYWJvcnQoInRpbWVvdXQiKTsKCQkJCX0sIHMudGltZW91dCApOwoJCQl9CgoJCQl0cnkgewoJCQkJc3RhdGUgPSAxOwoJCQkJdHJhbnNwb3J0LnNlbmQoIHJlcXVlc3RIZWFkZXJzLCBkb25lICk7CgkJCX0gY2F0Y2ggKCBlICkgewoJCQkJLy8gUHJvcGFnYXRlIGV4Y2VwdGlvbiBhcyBlcnJvciBpZiBub3QgZG9uZQoJCQkJaWYgKCBzdGF0ZSA8IDIgKSB7CgkJCQkJZG9uZSggLTEsIGUgKTsKCQkJCS8vIFNpbXBseSByZXRocm93IG90aGVyd2lzZQoJCQkJfSBlbHNlIHsKCQkJCQl0aHJvdyBlOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBDYWxsYmFjayBmb3Igd2hlbiBldmVyeXRoaW5nIGlzIGRvbmUKCQlmdW5jdGlvbiBkb25lKCBzdGF0dXMsIG5hdGl2ZVN0YXR1c1RleHQsIHJlc3BvbnNlcywgaGVhZGVycyApIHsKCQkJdmFyIGlzU3VjY2Vzcywgc3VjY2VzcywgZXJyb3IsIHJlc3BvbnNlLCBtb2RpZmllZCwKCQkJCXN0YXR1c1RleHQgPSBuYXRpdmVTdGF0dXNUZXh0OwoKCQkJLy8gQ2FsbGVkIG9uY2UKCQkJaWYgKCBzdGF0ZSA9PT0gMiApIHsKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU3RhdGUgaXMgImRvbmUiIG5vdwoJCQlzdGF0ZSA9IDI7CgoJCQkvLyBDbGVhciB0aW1lb3V0IGlmIGl0IGV4aXN0cwoJCQlpZiAoIHRpbWVvdXRUaW1lciApIHsKCQkJCWNsZWFyVGltZW91dCggdGltZW91dFRpbWVyICk7CgkJCX0KCgkJCS8vIERlcmVmZXJlbmNlIHRyYW5zcG9ydCBmb3IgZWFybHkgZ2FyYmFnZSBjb2xsZWN0aW9uCgkJCS8vIChubyBtYXR0ZXIgaG93IGxvbmcgdGhlIGpxWEhSIG9iamVjdCB3aWxsIGJlIHVzZWQpCgkJCXRyYW5zcG9ydCA9IHVuZGVmaW5lZDsKCgkJCS8vIENhY2hlIHJlc3BvbnNlIGhlYWRlcnMKCQkJcmVzcG9uc2VIZWFkZXJzU3RyaW5nID0gaGVhZGVycyB8fCAiIjsKCgkJCS8vIFNldCByZWFkeVN0YXRlCgkJCWpxWEhSLnJlYWR5U3RhdGUgPSBzdGF0dXMgPiAwID8gNCA6IDA7CgoJCQkvLyBEZXRlcm1pbmUgaWYgc3VjY2Vzc2Z1bAoJCQlpc1N1Y2Nlc3MgPSBzdGF0dXMgPj0gMjAwICYmIHN0YXR1cyA8IDMwMCB8fCBzdGF0dXMgPT09IDMwNDsKCgkJCS8vIEdldCByZXNwb25zZSBkYXRhCgkJCWlmICggcmVzcG9uc2VzICkgewoJCQkJcmVzcG9uc2UgPSBhamF4SGFuZGxlUmVzcG9uc2VzKCBzLCBqcVhIUiwgcmVzcG9uc2VzICk7CgkJCX0KCgkJCS8vIENvbnZlcnQgbm8gbWF0dGVyIHdoYXQgKHRoYXQgd2F5IHJlc3BvbnNlWFhYIGZpZWxkcyBhcmUgYWx3YXlzIHNldCkKCQkJcmVzcG9uc2UgPSBhamF4Q29udmVydCggcywgcmVzcG9uc2UsIGpxWEhSLCBpc1N1Y2Nlc3MgKTsKCgkJCS8vIElmIHN1Y2Nlc3NmdWwsIGhhbmRsZSB0eXBlIGNoYWluaW5nCgkJCWlmICggaXNTdWNjZXNzICkgewoKCQkJCS8vIFNldCB0aGUgSWYtTW9kaWZpZWQtU2luY2UgYW5kL29yIElmLU5vbmUtTWF0Y2ggaGVhZGVyLCBpZiBpbiBpZk1vZGlmaWVkIG1vZGUuCgkJCQlpZiAoIHMuaWZNb2RpZmllZCApIHsKCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJMYXN0LU1vZGlmaWVkIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5Lmxhc3RNb2RpZmllZFsgY2FjaGVVUkwgXSA9IG1vZGlmaWVkOwoJCQkJCX0KCQkJCQltb2RpZmllZCA9IGpxWEhSLmdldFJlc3BvbnNlSGVhZGVyKCJldGFnIik7CgkJCQkJaWYgKCBtb2RpZmllZCApIHsKCQkJCQkJalF1ZXJ5LmV0YWdbIGNhY2hlVVJMIF0gPSBtb2RpZmllZDsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gaWYgbm8gY29udGVudAoJCQkJaWYgKCBzdGF0dXMgPT09IDIwNCB8fCBzLnR5cGUgPT09ICJIRUFEIiApIHsKCQkJCQlzdGF0dXNUZXh0ID0gIm5vY29udGVudCI7CgoJCQkJLy8gaWYgbm90IG1vZGlmaWVkCgkJCQl9IGVsc2UgaWYgKCBzdGF0dXMgPT09IDMwNCApIHsKCQkJCQlzdGF0dXNUZXh0ID0gIm5vdG1vZGlmaWVkIjsKCgkJCQkvLyBJZiB3ZSBoYXZlIGRhdGEsIGxldCdzIGNvbnZlcnQgaXQKCQkJCX0gZWxzZSB7CgkJCQkJc3RhdHVzVGV4dCA9IHJlc3BvbnNlLnN0YXRlOwoJCQkJCXN1Y2Nlc3MgPSByZXNwb25zZS5kYXRhOwoJCQkJCWVycm9yID0gcmVzcG9uc2UuZXJyb3I7CgkJCQkJaXNTdWNjZXNzID0gIWVycm9yOwoJCQkJfQoJCQl9IGVsc2UgewoJCQkJLy8gRXh0cmFjdCBlcnJvciBmcm9tIHN0YXR1c1RleHQgYW5kIG5vcm1hbGl6ZSBmb3Igbm9uLWFib3J0cwoJCQkJZXJyb3IgPSBzdGF0dXNUZXh0OwoJCQkJaWYgKCBzdGF0dXMgfHwgIXN0YXR1c1RleHQgKSB7CgkJCQkJc3RhdHVzVGV4dCA9ICJlcnJvciI7CgkJCQkJaWYgKCBzdGF0dXMgPCAwICkgewoJCQkJCQlzdGF0dXMgPSAwOwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gU2V0IGRhdGEgZm9yIHRoZSBmYWtlIHhociBvYmplY3QKCQkJanFYSFIuc3RhdHVzID0gc3RhdHVzOwoJCQlqcVhIUi5zdGF0dXNUZXh0ID0gKCBuYXRpdmVTdGF0dXNUZXh0IHx8IHN0YXR1c1RleHQgKSArICIiOwoKCQkJLy8gU3VjY2Vzcy9FcnJvcgoJCQlpZiAoIGlzU3VjY2VzcyApIHsKCQkJCWRlZmVycmVkLnJlc29sdmVXaXRoKCBjYWxsYmFja0NvbnRleHQsIFsgc3VjY2Vzcywgc3RhdHVzVGV4dCwganFYSFIgXSApOwoJCQl9IGVsc2UgewoJCQkJZGVmZXJyZWQucmVqZWN0V2l0aCggY2FsbGJhY2tDb250ZXh0LCBbIGpxWEhSLCBzdGF0dXNUZXh0LCBlcnJvciBdICk7CgkJCX0KCgkJCS8vIFN0YXR1cy1kZXBlbmRlbnQgY2FsbGJhY2tzCgkJCWpxWEhSLnN0YXR1c0NvZGUoIHN0YXR1c0NvZGUgKTsKCQkJc3RhdHVzQ29kZSA9IHVuZGVmaW5lZDsKCgkJCWlmICggZmlyZUdsb2JhbHMgKSB7CgkJCQlnbG9iYWxFdmVudENvbnRleHQudHJpZ2dlciggaXNTdWNjZXNzID8gImFqYXhTdWNjZXNzIiA6ICJhamF4RXJyb3IiLAoJCQkJCVsganFYSFIsIHMsIGlzU3VjY2VzcyA/IHN1Y2Nlc3MgOiBlcnJvciBdICk7CgkJCX0KCgkJCS8vIENvbXBsZXRlCgkJCWNvbXBsZXRlRGVmZXJyZWQuZmlyZVdpdGgoIGNhbGxiYWNrQ29udGV4dCwgWyBqcVhIUiwgc3RhdHVzVGV4dCBdICk7CgoJCQlpZiAoIGZpcmVHbG9iYWxzICkgewoJCQkJZ2xvYmFsRXZlbnRDb250ZXh0LnRyaWdnZXIoICJhamF4Q29tcGxldGUiLCBbIGpxWEhSLCBzIF0gKTsKCQkJCS8vIEhhbmRsZSB0aGUgZ2xvYmFsIEFKQVggY291bnRlcgoJCQkJaWYgKCAhKCAtLWpRdWVyeS5hY3RpdmUgKSApIHsKCQkJCQlqUXVlcnkuZXZlbnQudHJpZ2dlcigiYWpheFN0b3AiKTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIGpxWEhSOwoJfSwKCglnZXRKU09OOiBmdW5jdGlvbiggdXJsLCBkYXRhLCBjYWxsYmFjayApIHsKCQlyZXR1cm4galF1ZXJ5LmdldCggdXJsLCBkYXRhLCBjYWxsYmFjaywgImpzb24iICk7Cgl9LAoKCWdldFNjcmlwdDogZnVuY3Rpb24oIHVybCwgY2FsbGJhY2sgKSB7CgkJcmV0dXJuIGpRdWVyeS5nZXQoIHVybCwgdW5kZWZpbmVkLCBjYWxsYmFjaywgInNjcmlwdCIgKTsKCX0KfSk7CgpqUXVlcnkuZWFjaCggWyAiZ2V0IiwgInBvc3QiIF0sIGZ1bmN0aW9uKCBpLCBtZXRob2QgKSB7CglqUXVlcnlbIG1ldGhvZCBdID0gZnVuY3Rpb24oIHVybCwgZGF0YSwgY2FsbGJhY2ssIHR5cGUgKSB7CgkJLy8gU2hpZnQgYXJndW1lbnRzIGlmIGRhdGEgYXJndW1lbnQgd2FzIG9taXR0ZWQKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBkYXRhICkgKSB7CgkJCXR5cGUgPSB0eXBlIHx8IGNhbGxiYWNrOwoJCQljYWxsYmFjayA9IGRhdGE7CgkJCWRhdGEgPSB1bmRlZmluZWQ7CgkJfQoKCQlyZXR1cm4galF1ZXJ5LmFqYXgoewoJCQl1cmw6IHVybCwKCQkJdHlwZTogbWV0aG9kLAoJCQlkYXRhVHlwZTogdHlwZSwKCQkJZGF0YTogZGF0YSwKCQkJc3VjY2VzczogY2FsbGJhY2sKCQl9KTsKCX07Cn0pOwoKCmpRdWVyeS5fZXZhbFVybCA9IGZ1bmN0aW9uKCB1cmwgKSB7CglyZXR1cm4galF1ZXJ5LmFqYXgoewoJCXVybDogdXJsLAoJCXR5cGU6ICJHRVQiLAoJCWRhdGFUeXBlOiAic2NyaXB0IiwKCQlhc3luYzogZmFsc2UsCgkJZ2xvYmFsOiBmYWxzZSwKCQkidGhyb3dzIjogdHJ1ZQoJfSk7Cn07CgoKalF1ZXJ5LmZuLmV4dGVuZCh7Cgl3cmFwQWxsOiBmdW5jdGlvbiggaHRtbCApIHsKCQl2YXIgd3JhcDsKCgkJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApICkgewoJCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQkJalF1ZXJ5KCB0aGlzICkud3JhcEFsbCggaHRtbC5jYWxsKHRoaXMsIGkpICk7CgkJCX0pOwoJCX0KCgkJaWYgKCB0aGlzWyAwIF0gKSB7CgoJCQkvLyBUaGUgZWxlbWVudHMgdG8gd3JhcCB0aGUgdGFyZ2V0IGFyb3VuZAoJCQl3cmFwID0galF1ZXJ5KCBodG1sLCB0aGlzWyAwIF0ub3duZXJEb2N1bWVudCApLmVxKCAwICkuY2xvbmUoIHRydWUgKTsKCgkJCWlmICggdGhpc1sgMCBdLnBhcmVudE5vZGUgKSB7CgkJCQl3cmFwLmluc2VydEJlZm9yZSggdGhpc1sgMCBdICk7CgkJCX0KCgkJCXdyYXAubWFwKGZ1bmN0aW9uKCkgewoJCQkJdmFyIGVsZW0gPSB0aGlzOwoKCQkJCXdoaWxlICggZWxlbS5maXJzdEVsZW1lbnRDaGlsZCApIHsKCQkJCQllbGVtID0gZWxlbS5maXJzdEVsZW1lbnRDaGlsZDsKCQkJCX0KCgkJCQlyZXR1cm4gZWxlbTsKCQkJfSkuYXBwZW5kKCB0aGlzICk7CgkJfQoKCQlyZXR1cm4gdGhpczsKCX0sCgoJd3JhcElubmVyOiBmdW5jdGlvbiggaHRtbCApIHsKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBodG1sICkgKSB7CgkJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS53cmFwSW5uZXIoIGh0bWwuY2FsbCh0aGlzLCBpKSApOwoJCQl9KTsKCQl9CgoJCXJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7CgkJCXZhciBzZWxmID0galF1ZXJ5KCB0aGlzICksCgkJCQljb250ZW50cyA9IHNlbGYuY29udGVudHMoKTsKCgkJCWlmICggY29udGVudHMubGVuZ3RoICkgewoJCQkJY29udGVudHMud3JhcEFsbCggaHRtbCApOwoKCQkJfSBlbHNlIHsKCQkJCXNlbGYuYXBwZW5kKCBodG1sICk7CgkJCX0KCQl9KTsKCX0sCgoJd3JhcDogZnVuY3Rpb24oIGh0bWwgKSB7CgkJdmFyIGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggaHRtbCApOwoKCQlyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCBpICkgewoJCQlqUXVlcnkoIHRoaXMgKS53cmFwQWxsKCBpc0Z1bmN0aW9uID8gaHRtbC5jYWxsKHRoaXMsIGkpIDogaHRtbCApOwoJCX0pOwoJfSwKCgl1bndyYXA6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLnBhcmVudCgpLmVhY2goZnVuY3Rpb24oKSB7CgkJCWlmICggIWpRdWVyeS5ub2RlTmFtZSggdGhpcywgImJvZHkiICkgKSB7CgkJCQlqUXVlcnkoIHRoaXMgKS5yZXBsYWNlV2l0aCggdGhpcy5jaGlsZE5vZGVzICk7CgkJCX0KCQl9KS5lbmQoKTsKCX0KfSk7CgoKalF1ZXJ5LmV4cHIuZmlsdGVycy5oaWRkZW4gPSBmdW5jdGlvbiggZWxlbSApIHsKCS8vIFN1cHBvcnQ6IE9wZXJhIDw9IDEyLjEyCgkvLyBPcGVyYSByZXBvcnRzIG9mZnNldFdpZHRocyBhbmQgb2Zmc2V0SGVpZ2h0cyBsZXNzIHRoYW4gemVybyBvbiBzb21lIGVsZW1lbnRzCglyZXR1cm4gZWxlbS5vZmZzZXRXaWR0aCA8PSAwICYmIGVsZW0ub2Zmc2V0SGVpZ2h0IDw9IDA7Cn07CmpRdWVyeS5leHByLmZpbHRlcnMudmlzaWJsZSA9IGZ1bmN0aW9uKCBlbGVtICkgewoJcmV0dXJuICFqUXVlcnkuZXhwci5maWx0ZXJzLmhpZGRlbiggZWxlbSApOwp9OwoKCgoKdmFyIHIyMCA9IC8lMjAvZywKCXJicmFja2V0ID0gL1xbXF0kLywKCXJDUkxGID0gL1xyP1xuL2csCglyc3VibWl0dGVyVHlwZXMgPSAvXig/OnN1Ym1pdHxidXR0b258aW1hZ2V8cmVzZXR8ZmlsZSkkL2ksCglyc3VibWl0dGFibGUgPSAvXig/OmlucHV0fHNlbGVjdHx0ZXh0YXJlYXxrZXlnZW4pL2k7CgpmdW5jdGlvbiBidWlsZFBhcmFtcyggcHJlZml4LCBvYmosIHRyYWRpdGlvbmFsLCBhZGQgKSB7Cgl2YXIgbmFtZTsKCglpZiAoIGpRdWVyeS5pc0FycmF5KCBvYmogKSApIHsKCQkvLyBTZXJpYWxpemUgYXJyYXkgaXRlbS4KCQlqUXVlcnkuZWFjaCggb2JqLCBmdW5jdGlvbiggaSwgdiApIHsKCQkJaWYgKCB0cmFkaXRpb25hbCB8fCByYnJhY2tldC50ZXN0KCBwcmVmaXggKSApIHsKCQkJCS8vIFRyZWF0IGVhY2ggYXJyYXkgaXRlbSBhcyBhIHNjYWxhci4KCQkJCWFkZCggcHJlZml4LCB2ICk7CgoJCQl9IGVsc2UgewoJCQkJLy8gSXRlbSBpcyBub24tc2NhbGFyIChhcnJheSBvciBvYmplY3QpLCBlbmNvZGUgaXRzIG51bWVyaWMgaW5kZXguCgkJCQlidWlsZFBhcmFtcyggcHJlZml4ICsgIlsiICsgKCB0eXBlb2YgdiA9PT0gIm9iamVjdCIgPyBpIDogIiIgKSArICJdIiwgdiwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCQl9CgkJfSk7CgoJfSBlbHNlIGlmICggIXRyYWRpdGlvbmFsICYmIGpRdWVyeS50eXBlKCBvYmogKSA9PT0gIm9iamVjdCIgKSB7CgkJLy8gU2VyaWFsaXplIG9iamVjdCBpdGVtLgoJCWZvciAoIG5hbWUgaW4gb2JqICkgewoJCQlidWlsZFBhcmFtcyggcHJlZml4ICsgIlsiICsgbmFtZSArICJdIiwgb2JqWyBuYW1lIF0sIHRyYWRpdGlvbmFsLCBhZGQgKTsKCQl9CgoJfSBlbHNlIHsKCQkvLyBTZXJpYWxpemUgc2NhbGFyIGl0ZW0uCgkJYWRkKCBwcmVmaXgsIG9iaiApOwoJfQp9CgovLyBTZXJpYWxpemUgYW4gYXJyYXkgb2YgZm9ybSBlbGVtZW50cyBvciBhIHNldCBvZgovLyBrZXkvdmFsdWVzIGludG8gYSBxdWVyeSBzdHJpbmcKalF1ZXJ5LnBhcmFtID0gZnVuY3Rpb24oIGEsIHRyYWRpdGlvbmFsICkgewoJdmFyIHByZWZpeCwKCQlzID0gW10sCgkJYWRkID0gZnVuY3Rpb24oIGtleSwgdmFsdWUgKSB7CgkJCS8vIElmIHZhbHVlIGlzIGEgZnVuY3Rpb24sIGludm9rZSBpdCBhbmQgcmV0dXJuIGl0cyB2YWx1ZQoJCQl2YWx1ZSA9IGpRdWVyeS5pc0Z1bmN0aW9uKCB2YWx1ZSApID8gdmFsdWUoKSA6ICggdmFsdWUgPT0gbnVsbCA/ICIiIDogdmFsdWUgKTsKCQkJc1sgcy5sZW5ndGggXSA9IGVuY29kZVVSSUNvbXBvbmVudCgga2V5ICkgKyAiPSIgKyBlbmNvZGVVUklDb21wb25lbnQoIHZhbHVlICk7CgkJfTsKCgkvLyBTZXQgdHJhZGl0aW9uYWwgdG8gdHJ1ZSBmb3IgalF1ZXJ5IDw9IDEuMy4yIGJlaGF2aW9yLgoJaWYgKCB0cmFkaXRpb25hbCA9PT0gdW5kZWZpbmVkICkgewoJCXRyYWRpdGlvbmFsID0galF1ZXJ5LmFqYXhTZXR0aW5ncyAmJiBqUXVlcnkuYWpheFNldHRpbmdzLnRyYWRpdGlvbmFsOwoJfQoKCS8vIElmIGFuIGFycmF5IHdhcyBwYXNzZWQgaW4sIGFzc3VtZSB0aGF0IGl0IGlzIGFuIGFycmF5IG9mIGZvcm0gZWxlbWVudHMuCglpZiAoIGpRdWVyeS5pc0FycmF5KCBhICkgfHwgKCBhLmpxdWVyeSAmJiAhalF1ZXJ5LmlzUGxhaW5PYmplY3QoIGEgKSApICkgewoJCS8vIFNlcmlhbGl6ZSB0aGUgZm9ybSBlbGVtZW50cwoJCWpRdWVyeS5lYWNoKCBhLCBmdW5jdGlvbigpIHsKCQkJYWRkKCB0aGlzLm5hbWUsIHRoaXMudmFsdWUgKTsKCQl9KTsKCgl9IGVsc2UgewoJCS8vIElmIHRyYWRpdGlvbmFsLCBlbmNvZGUgdGhlICJvbGQiIHdheSAodGhlIHdheSAxLjMuMiBvciBvbGRlcgoJCS8vIGRpZCBpdCksIG90aGVyd2lzZSBlbmNvZGUgcGFyYW1zIHJlY3Vyc2l2ZWx5LgoJCWZvciAoIHByZWZpeCBpbiBhICkgewoJCQlidWlsZFBhcmFtcyggcHJlZml4LCBhWyBwcmVmaXggXSwgdHJhZGl0aW9uYWwsIGFkZCApOwoJCX0KCX0KCgkvLyBSZXR1cm4gdGhlIHJlc3VsdGluZyBzZXJpYWxpemF0aW9uCglyZXR1cm4gcy5qb2luKCAiJiIgKS5yZXBsYWNlKCByMjAsICIrIiApOwp9OwoKalF1ZXJ5LmZuLmV4dGVuZCh7CglzZXJpYWxpemU6IGZ1bmN0aW9uKCkgewoJCXJldHVybiBqUXVlcnkucGFyYW0oIHRoaXMuc2VyaWFsaXplQXJyYXkoKSApOwoJfSwKCXNlcmlhbGl6ZUFycmF5OiBmdW5jdGlvbigpIHsKCQlyZXR1cm4gdGhpcy5tYXAoZnVuY3Rpb24oKSB7CgkJCS8vIENhbiBhZGQgcHJvcEhvb2sgZm9yICJlbGVtZW50cyIgdG8gZmlsdGVyIG9yIGFkZCBmb3JtIGVsZW1lbnRzCgkJCXZhciBlbGVtZW50cyA9IGpRdWVyeS5wcm9wKCB0aGlzLCAiZWxlbWVudHMiICk7CgkJCXJldHVybiBlbGVtZW50cyA/IGpRdWVyeS5tYWtlQXJyYXkoIGVsZW1lbnRzICkgOiB0aGlzOwoJCX0pCgkJLmZpbHRlcihmdW5jdGlvbigpIHsKCQkJdmFyIHR5cGUgPSB0aGlzLnR5cGU7CgoJCQkvLyBVc2UgLmlzKCAiOmRpc2FibGVkIiApIHNvIHRoYXQgZmllbGRzZXRbZGlzYWJsZWRdIHdvcmtzCgkJCXJldHVybiB0aGlzLm5hbWUgJiYgIWpRdWVyeSggdGhpcyApLmlzKCAiOmRpc2FibGVkIiApICYmCgkJCQlyc3VibWl0dGFibGUudGVzdCggdGhpcy5ub2RlTmFtZSApICYmICFyc3VibWl0dGVyVHlwZXMudGVzdCggdHlwZSApICYmCgkJCQkoIHRoaXMuY2hlY2tlZCB8fCAhcmNoZWNrYWJsZVR5cGUudGVzdCggdHlwZSApICk7CgkJfSkKCQkubWFwKGZ1bmN0aW9uKCBpLCBlbGVtICkgewoJCQl2YXIgdmFsID0galF1ZXJ5KCB0aGlzICkudmFsKCk7CgoJCQlyZXR1cm4gdmFsID09IG51bGwgPwoJCQkJbnVsbCA6CgkJCQlqUXVlcnkuaXNBcnJheSggdmFsICkgPwoJCQkJCWpRdWVyeS5tYXAoIHZhbCwgZnVuY3Rpb24oIHZhbCApIHsKCQkJCQkJcmV0dXJuIHsgbmFtZTogZWxlbS5uYW1lLCB2YWx1ZTogdmFsLnJlcGxhY2UoIHJDUkxGLCAiXHJcbiIgKSB9OwoJCQkJCX0pIDoKCQkJCQl7IG5hbWU6IGVsZW0ubmFtZSwgdmFsdWU6IHZhbC5yZXBsYWNlKCByQ1JMRiwgIlxyXG4iICkgfTsKCQl9KS5nZXQoKTsKCX0KfSk7CgoKalF1ZXJ5LmFqYXhTZXR0aW5ncy54aHIgPSBmdW5jdGlvbigpIHsKCXRyeSB7CgkJcmV0dXJuIG5ldyBYTUxIdHRwUmVxdWVzdCgpOwoJfSBjYXRjaCggZSApIHt9Cn07Cgp2YXIgeGhySWQgPSAwLAoJeGhyQ2FsbGJhY2tzID0ge30sCgl4aHJTdWNjZXNzU3RhdHVzID0gewoJCS8vIGZpbGUgcHJvdG9jb2wgYWx3YXlzIHlpZWxkcyBzdGF0dXMgY29kZSAwLCBhc3N1bWUgMjAwCgkJMDogMjAwLAoJCS8vIFN1cHBvcnQ6IElFOQoJCS8vICMxNDUwOiBzb21ldGltZXMgSUUgcmV0dXJucyAxMjIzIHdoZW4gaXQgc2hvdWxkIGJlIDIwNAoJCTEyMjM6IDIwNAoJfSwKCXhoclN1cHBvcnRlZCA9IGpRdWVyeS5hamF4U2V0dGluZ3MueGhyKCk7CgovLyBTdXBwb3J0OiBJRTkKLy8gT3BlbiByZXF1ZXN0cyBtdXN0IGJlIG1hbnVhbGx5IGFib3J0ZWQgb24gdW5sb2FkICgjNTI4MCkKLy8gU2VlIGh0dHBzOi8vc3VwcG9ydC5taWNyb3NvZnQuY29tL2tiLzI4NTY3NDYgZm9yIG1vcmUgaW5mbwppZiAoIHdpbmRvdy5hdHRhY2hFdmVudCApIHsKCXdpbmRvdy5hdHRhY2hFdmVudCggIm9udW5sb2FkIiwgZnVuY3Rpb24oKSB7CgkJZm9yICggdmFyIGtleSBpbiB4aHJDYWxsYmFja3MgKSB7CgkJCXhockNhbGxiYWNrc1sga2V5IF0oKTsKCQl9Cgl9KTsKfQoKc3VwcG9ydC5jb3JzID0gISF4aHJTdXBwb3J0ZWQgJiYgKCAid2l0aENyZWRlbnRpYWxzIiBpbiB4aHJTdXBwb3J0ZWQgKTsKc3VwcG9ydC5hamF4ID0geGhyU3VwcG9ydGVkID0gISF4aHJTdXBwb3J0ZWQ7CgpqUXVlcnkuYWpheFRyYW5zcG9ydChmdW5jdGlvbiggb3B0aW9ucyApIHsKCXZhciBjYWxsYmFjazsKCgkvLyBDcm9zcyBkb21haW4gb25seSBhbGxvd2VkIGlmIHN1cHBvcnRlZCB0aHJvdWdoIFhNTEh0dHBSZXF1ZXN0CglpZiAoIHN1cHBvcnQuY29ycyB8fCB4aHJTdXBwb3J0ZWQgJiYgIW9wdGlvbnMuY3Jvc3NEb21haW4gKSB7CgkJcmV0dXJuIHsKCQkJc2VuZDogZnVuY3Rpb24oIGhlYWRlcnMsIGNvbXBsZXRlICkgewoJCQkJdmFyIGksCgkJCQkJeGhyID0gb3B0aW9ucy54aHIoKSwKCQkJCQlpZCA9ICsreGhySWQ7CgoJCQkJeGhyLm9wZW4oIG9wdGlvbnMudHlwZSwgb3B0aW9ucy51cmwsIG9wdGlvbnMuYXN5bmMsIG9wdGlvbnMudXNlcm5hbWUsIG9wdGlvbnMucGFzc3dvcmQgKTsKCgkJCQkvLyBBcHBseSBjdXN0b20gZmllbGRzIGlmIHByb3ZpZGVkCgkJCQlpZiAoIG9wdGlvbnMueGhyRmllbGRzICkgewoJCQkJCWZvciAoIGkgaW4gb3B0aW9ucy54aHJGaWVsZHMgKSB7CgkJCQkJCXhoclsgaSBdID0gb3B0aW9ucy54aHJGaWVsZHNbIGkgXTsKCQkJCQl9CgkJCQl9CgoJCQkJLy8gT3ZlcnJpZGUgbWltZSB0eXBlIGlmIG5lZWRlZAoJCQkJaWYgKCBvcHRpb25zLm1pbWVUeXBlICYmIHhoci5vdmVycmlkZU1pbWVUeXBlICkgewoJCQkJCXhoci5vdmVycmlkZU1pbWVUeXBlKCBvcHRpb25zLm1pbWVUeXBlICk7CgkJCQl9CgoJCQkJLy8gWC1SZXF1ZXN0ZWQtV2l0aCBoZWFkZXIKCQkJCS8vIEZvciBjcm9zcy1kb21haW4gcmVxdWVzdHMsIHNlZWluZyBhcyBjb25kaXRpb25zIGZvciBhIHByZWZsaWdodCBhcmUKCQkJCS8vIGFraW4gdG8gYSBqaWdzYXcgcHV6emxlLCB3ZSBzaW1wbHkgbmV2ZXIgc2V0IGl0IHRvIGJlIHN1cmUuCgkJCQkvLyAoaXQgY2FuIGFsd2F5cyBiZSBzZXQgb24gYSBwZXItcmVxdWVzdCBiYXNpcyBvciBldmVuIHVzaW5nIGFqYXhTZXR1cCkKCQkJCS8vIEZvciBzYW1lLWRvbWFpbiByZXF1ZXN0cywgd29uJ3QgY2hhbmdlIGhlYWRlciBpZiBhbHJlYWR5IHByb3ZpZGVkLgoJCQkJaWYgKCAhb3B0aW9ucy5jcm9zc0RvbWFpbiAmJiAhaGVhZGVyc1siWC1SZXF1ZXN0ZWQtV2l0aCJdICkgewoJCQkJCWhlYWRlcnNbIlgtUmVxdWVzdGVkLVdpdGgiXSA9ICJYTUxIdHRwUmVxdWVzdCI7CgkJCQl9CgoJCQkJLy8gU2V0IGhlYWRlcnMKCQkJCWZvciAoIGkgaW4gaGVhZGVycyApIHsKCQkJCQl4aHIuc2V0UmVxdWVzdEhlYWRlciggaSwgaGVhZGVyc1sgaSBdICk7CgkJCQl9CgoJCQkJLy8gQ2FsbGJhY2sKCQkJCWNhbGxiYWNrID0gZnVuY3Rpb24oIHR5cGUgKSB7CgkJCQkJcmV0dXJuIGZ1bmN0aW9uKCkgewoJCQkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCQkJZGVsZXRlIHhockNhbGxiYWNrc1sgaWQgXTsKCQkJCQkJCWNhbGxiYWNrID0geGhyLm9ubG9hZCA9IHhoci5vbmVycm9yID0gbnVsbDsKCgkJCQkJCQlpZiAoIHR5cGUgPT09ICJhYm9ydCIgKSB7CgkJCQkJCQkJeGhyLmFib3J0KCk7CgkJCQkJCQl9IGVsc2UgaWYgKCB0eXBlID09PSAiZXJyb3IiICkgewoJCQkJCQkJCWNvbXBsZXRlKAoJCQkJCQkJCQkvLyBmaWxlOiBwcm90b2NvbCBhbHdheXMgeWllbGRzIHN0YXR1cyAwOyBzZWUgIzg2MDUsICMxNDIwNwoJCQkJCQkJCQl4aHIuc3RhdHVzLAoJCQkJCQkJCQl4aHIuc3RhdHVzVGV4dAoJCQkJCQkJCSk7CgkJCQkJCQl9IGVsc2UgewoJCQkJCQkJCWNvbXBsZXRlKAoJCQkJCQkJCQl4aHJTdWNjZXNzU3RhdHVzWyB4aHIuc3RhdHVzIF0gfHwgeGhyLnN0YXR1cywKCQkJCQkJCQkJeGhyLnN0YXR1c1RleHQsCgkJCQkJCQkJCS8vIFN1cHBvcnQ6IElFOQoJCQkJCQkJCQkvLyBBY2Nlc3NpbmcgYmluYXJ5LWRhdGEgcmVzcG9uc2VUZXh0IHRocm93cyBhbiBleGNlcHRpb24KCQkJCQkJCQkJLy8gKCMxMTQyNikKCQkJCQkJCQkJdHlwZW9mIHhoci5yZXNwb25zZVRleHQgPT09ICJzdHJpbmciID8gewoJCQkJCQkJCQkJdGV4dDogeGhyLnJlc3BvbnNlVGV4dAoJCQkJCQkJCQl9IDogdW5kZWZpbmVkLAoJCQkJCQkJCQl4aHIuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCkKCQkJCQkJCQkpOwoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfTsKCQkJCX07CgoJCQkJLy8gTGlzdGVuIHRvIGV2ZW50cwoJCQkJeGhyLm9ubG9hZCA9IGNhbGxiYWNrKCk7CgkJCQl4aHIub25lcnJvciA9IGNhbGxiYWNrKCJlcnJvciIpOwoKCQkJCS8vIENyZWF0ZSB0aGUgYWJvcnQgY2FsbGJhY2sKCQkJCWNhbGxiYWNrID0geGhyQ2FsbGJhY2tzWyBpZCBdID0gY2FsbGJhY2soImFib3J0Iik7CgoJCQkJdHJ5IHsKCQkJCQkvLyBEbyBzZW5kIHRoZSByZXF1ZXN0ICh0aGlzIG1heSByYWlzZSBhbiBleGNlcHRpb24pCgkJCQkJeGhyLnNlbmQoIG9wdGlvbnMuaGFzQ29udGVudCAmJiBvcHRpb25zLmRhdGEgfHwgbnVsbCApOwoJCQkJfSBjYXRjaCAoIGUgKSB7CgkJCQkJLy8gIzE0NjgzOiBPbmx5IHJldGhyb3cgaWYgdGhpcyBoYXNuJ3QgYmVlbiBub3RpZmllZCBhcyBhbiBlcnJvciB5ZXQKCQkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCQl0aHJvdyBlOwoJCQkJCX0KCQkJCX0KCQkJfSwKCgkJCWFib3J0OiBmdW5jdGlvbigpIHsKCQkJCWlmICggY2FsbGJhY2sgKSB7CgkJCQkJY2FsbGJhY2soKTsKCQkJCX0KCQkJfQoJCX07Cgl9Cn0pOwoKCgoKLy8gSW5zdGFsbCBzY3JpcHQgZGF0YVR5cGUKalF1ZXJ5LmFqYXhTZXR1cCh7CglhY2NlcHRzOiB7CgkJc2NyaXB0OiAidGV4dC9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9qYXZhc2NyaXB0LCBhcHBsaWNhdGlvbi9lY21hc2NyaXB0LCBhcHBsaWNhdGlvbi94LWVjbWFzY3JpcHQiCgl9LAoJY29udGVudHM6IHsKCQlzY3JpcHQ6IC8oPzpqYXZhfGVjbWEpc2NyaXB0LwoJfSwKCWNvbnZlcnRlcnM6IHsKCQkidGV4dCBzY3JpcHQiOiBmdW5jdGlvbiggdGV4dCApIHsKCQkJalF1ZXJ5Lmdsb2JhbEV2YWwoIHRleHQgKTsKCQkJcmV0dXJuIHRleHQ7CgkJfQoJfQp9KTsKCi8vIEhhbmRsZSBjYWNoZSdzIHNwZWNpYWwgY2FzZSBhbmQgY3Jvc3NEb21haW4KalF1ZXJ5LmFqYXhQcmVmaWx0ZXIoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCWlmICggcy5jYWNoZSA9PT0gdW5kZWZpbmVkICkgewoJCXMuY2FjaGUgPSBmYWxzZTsKCX0KCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCQlzLnR5cGUgPSAiR0VUIjsKCX0KfSk7CgovLyBCaW5kIHNjcmlwdCB0YWcgaGFjayB0cmFuc3BvcnQKalF1ZXJ5LmFqYXhUcmFuc3BvcnQoICJzY3JpcHQiLCBmdW5jdGlvbiggcyApIHsKCS8vIFRoaXMgdHJhbnNwb3J0IG9ubHkgZGVhbHMgd2l0aCBjcm9zcyBkb21haW4gcmVxdWVzdHMKCWlmICggcy5jcm9zc0RvbWFpbiApIHsKCQl2YXIgc2NyaXB0LCBjYWxsYmFjazsKCQlyZXR1cm4gewoJCQlzZW5kOiBmdW5jdGlvbiggXywgY29tcGxldGUgKSB7CgkJCQlzY3JpcHQgPSBqUXVlcnkoIjxzY3JpcHQ+IikucHJvcCh7CgkJCQkJYXN5bmM6IHRydWUsCgkJCQkJY2hhcnNldDogcy5zY3JpcHRDaGFyc2V0LAoJCQkJCXNyYzogcy51cmwKCQkJCX0pLm9uKAoJCQkJCSJsb2FkIGVycm9yIiwKCQkJCQljYWxsYmFjayA9IGZ1bmN0aW9uKCBldnQgKSB7CgkJCQkJCXNjcmlwdC5yZW1vdmUoKTsKCQkJCQkJY2FsbGJhY2sgPSBudWxsOwoJCQkJCQlpZiAoIGV2dCApIHsKCQkJCQkJCWNvbXBsZXRlKCBldnQudHlwZSA9PT0gImVycm9yIiA/IDQwNCA6IDIwMCwgZXZ0LnR5cGUgKTsKCQkJCQkJfQoJCQkJCX0KCQkJCSk7CgkJCQlkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKCBzY3JpcHRbIDAgXSApOwoJCQl9LAoJCQlhYm9ydDogZnVuY3Rpb24oKSB7CgkJCQlpZiAoIGNhbGxiYWNrICkgewoJCQkJCWNhbGxiYWNrKCk7CgkJCQl9CgkJCX0KCQl9OwoJfQp9KTsKCgoKCnZhciBvbGRDYWxsYmFja3MgPSBbXSwKCXJqc29ucCA9IC8oPSlcPyg/PSZ8JCl8XD9cPy87CgovLyBEZWZhdWx0IGpzb25wIHNldHRpbmdzCmpRdWVyeS5hamF4U2V0dXAoewoJanNvbnA6ICJjYWxsYmFjayIsCglqc29ucENhbGxiYWNrOiBmdW5jdGlvbigpIHsKCQl2YXIgY2FsbGJhY2sgPSBvbGRDYWxsYmFja3MucG9wKCkgfHwgKCBqUXVlcnkuZXhwYW5kbyArICJfIiArICggbm9uY2UrKyApICk7CgkJdGhpc1sgY2FsbGJhY2sgXSA9IHRydWU7CgkJcmV0dXJuIGNhbGxiYWNrOwoJfQp9KTsKCi8vIERldGVjdCwgbm9ybWFsaXplIG9wdGlvbnMgYW5kIGluc3RhbGwgY2FsbGJhY2tzIGZvciBqc29ucCByZXF1ZXN0cwpqUXVlcnkuYWpheFByZWZpbHRlciggImpzb24ganNvbnAiLCBmdW5jdGlvbiggcywgb3JpZ2luYWxTZXR0aW5ncywganFYSFIgKSB7CgoJdmFyIGNhbGxiYWNrTmFtZSwgb3ZlcndyaXR0ZW4sIHJlc3BvbnNlQ29udGFpbmVyLAoJCWpzb25Qcm9wID0gcy5qc29ucCAhPT0gZmFsc2UgJiYgKCByanNvbnAudGVzdCggcy51cmwgKSA/CgkJCSJ1cmwiIDoKCQkJdHlwZW9mIHMuZGF0YSA9PT0gInN0cmluZyIgJiYgISggcy5jb250ZW50VHlwZSB8fCAiIiApLmluZGV4T2YoImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCIpICYmIHJqc29ucC50ZXN0KCBzLmRhdGEgKSAmJiAiZGF0YSIKCQkpOwoKCS8vIEhhbmRsZSBpZmYgdGhlIGV4cGVjdGVkIGRhdGEgdHlwZSBpcyAianNvbnAiIG9yIHdlIGhhdmUgYSBwYXJhbWV0ZXIgdG8gc2V0CglpZiAoIGpzb25Qcm9wIHx8IHMuZGF0YVR5cGVzWyAwIF0gPT09ICJqc29ucCIgKSB7CgoJCS8vIEdldCBjYWxsYmFjayBuYW1lLCByZW1lbWJlcmluZyBwcmVleGlzdGluZyB2YWx1ZSBhc3NvY2lhdGVkIHdpdGggaXQKCQljYWxsYmFja05hbWUgPSBzLmpzb25wQ2FsbGJhY2sgPSBqUXVlcnkuaXNGdW5jdGlvbiggcy5qc29ucENhbGxiYWNrICkgPwoJCQlzLmpzb25wQ2FsbGJhY2soKSA6CgkJCXMuanNvbnBDYWxsYmFjazsKCgkJLy8gSW5zZXJ0IGNhbGxiYWNrIGludG8gdXJsIG9yIGZvcm0gZGF0YQoJCWlmICgganNvblByb3AgKSB7CgkJCXNbIGpzb25Qcm9wIF0gPSBzWyBqc29uUHJvcCBdLnJlcGxhY2UoIHJqc29ucCwgIiQxIiArIGNhbGxiYWNrTmFtZSApOwoJCX0gZWxzZSBpZiAoIHMuanNvbnAgIT09IGZhbHNlICkgewoJCQlzLnVybCArPSAoIHJxdWVyeS50ZXN0KCBzLnVybCApID8gIiYiIDogIj8iICkgKyBzLmpzb25wICsgIj0iICsgY2FsbGJhY2tOYW1lOwoJCX0KCgkJLy8gVXNlIGRhdGEgY29udmVydGVyIHRvIHJldHJpZXZlIGpzb24gYWZ0ZXIgc2NyaXB0IGV4ZWN1dGlvbgoJCXMuY29udmVydGVyc1sic2NyaXB0IGpzb24iXSA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoICFyZXNwb25zZUNvbnRhaW5lciApIHsKCQkJCWpRdWVyeS5lcnJvciggY2FsbGJhY2tOYW1lICsgIiB3YXMgbm90IGNhbGxlZCIgKTsKCQkJfQoJCQlyZXR1cm4gcmVzcG9uc2VDb250YWluZXJbIDAgXTsKCQl9OwoKCQkvLyBmb3JjZSBqc29uIGRhdGFUeXBlCgkJcy5kYXRhVHlwZXNbIDAgXSA9ICJqc29uIjsKCgkJLy8gSW5zdGFsbCBjYWxsYmFjawoJCW92ZXJ3cml0dGVuID0gd2luZG93WyBjYWxsYmFja05hbWUgXTsKCQl3aW5kb3dbIGNhbGxiYWNrTmFtZSBdID0gZnVuY3Rpb24oKSB7CgkJCXJlc3BvbnNlQ29udGFpbmVyID0gYXJndW1lbnRzOwoJCX07CgoJCS8vIENsZWFuLXVwIGZ1bmN0aW9uIChmaXJlcyBhZnRlciBjb252ZXJ0ZXJzKQoJCWpxWEhSLmFsd2F5cyhmdW5jdGlvbigpIHsKCQkJLy8gUmVzdG9yZSBwcmVleGlzdGluZyB2YWx1ZQoJCQl3aW5kb3dbIGNhbGxiYWNrTmFtZSBdID0gb3ZlcndyaXR0ZW47CgoJCQkvLyBTYXZlIGJhY2sgYXMgZnJlZQoJCQlpZiAoIHNbIGNhbGxiYWNrTmFtZSBdICkgewoJCQkJLy8gbWFrZSBzdXJlIHRoYXQgcmUtdXNpbmcgdGhlIG9wdGlvbnMgZG9lc24ndCBzY3JldyB0aGluZ3MgYXJvdW5kCgkJCQlzLmpzb25wQ2FsbGJhY2sgPSBvcmlnaW5hbFNldHRpbmdzLmpzb25wQ2FsbGJhY2s7CgoJCQkJLy8gc2F2ZSB0aGUgY2FsbGJhY2sgbmFtZSBmb3IgZnV0dXJlIHVzZQoJCQkJb2xkQ2FsbGJhY2tzLnB1c2goIGNhbGxiYWNrTmFtZSApOwoJCQl9CgoJCQkvLyBDYWxsIGlmIGl0IHdhcyBhIGZ1bmN0aW9uIGFuZCB3ZSBoYXZlIGEgcmVzcG9uc2UKCQkJaWYgKCByZXNwb25zZUNvbnRhaW5lciAmJiBqUXVlcnkuaXNGdW5jdGlvbiggb3ZlcndyaXR0ZW4gKSApIHsKCQkJCW92ZXJ3cml0dGVuKCByZXNwb25zZUNvbnRhaW5lclsgMCBdICk7CgkJCX0KCgkJCXJlc3BvbnNlQ29udGFpbmVyID0gb3ZlcndyaXR0ZW4gPSB1bmRlZmluZWQ7CgkJfSk7CgoJCS8vIERlbGVnYXRlIHRvIHNjcmlwdAoJCXJldHVybiAic2NyaXB0IjsKCX0KfSk7CgoKCgovLyBkYXRhOiBzdHJpbmcgb2YgaHRtbAovLyBjb250ZXh0IChvcHRpb25hbCk6IElmIHNwZWNpZmllZCwgdGhlIGZyYWdtZW50IHdpbGwgYmUgY3JlYXRlZCBpbiB0aGlzIGNvbnRleHQsIGRlZmF1bHRzIHRvIGRvY3VtZW50Ci8vIGtlZXBTY3JpcHRzIChvcHRpb25hbCk6IElmIHRydWUsIHdpbGwgaW5jbHVkZSBzY3JpcHRzIHBhc3NlZCBpbiB0aGUgaHRtbCBzdHJpbmcKalF1ZXJ5LnBhcnNlSFRNTCA9IGZ1bmN0aW9uKCBkYXRhLCBjb250ZXh0LCBrZWVwU2NyaXB0cyApIHsKCWlmICggIWRhdGEgfHwgdHlwZW9mIGRhdGEgIT09ICJzdHJpbmciICkgewoJCXJldHVybiBudWxsOwoJfQoJaWYgKCB0eXBlb2YgY29udGV4dCA9PT0gImJvb2xlYW4iICkgewoJCWtlZXBTY3JpcHRzID0gY29udGV4dDsKCQljb250ZXh0ID0gZmFsc2U7Cgl9Cgljb250ZXh0ID0gY29udGV4dCB8fCBkb2N1bWVudDsKCgl2YXIgcGFyc2VkID0gcnNpbmdsZVRhZy5leGVjKCBkYXRhICksCgkJc2NyaXB0cyA9ICFrZWVwU2NyaXB0cyAmJiBbXTsKCgkvLyBTaW5nbGUgdGFnCglpZiAoIHBhcnNlZCApIHsKCQlyZXR1cm4gWyBjb250ZXh0LmNyZWF0ZUVsZW1lbnQoIHBhcnNlZFsxXSApIF07Cgl9CgoJcGFyc2VkID0galF1ZXJ5LmJ1aWxkRnJhZ21lbnQoIFsgZGF0YSBdLCBjb250ZXh0LCBzY3JpcHRzICk7CgoJaWYgKCBzY3JpcHRzICYmIHNjcmlwdHMubGVuZ3RoICkgewoJCWpRdWVyeSggc2NyaXB0cyApLnJlbW92ZSgpOwoJfQoKCXJldHVybiBqUXVlcnkubWVyZ2UoIFtdLCBwYXJzZWQuY2hpbGROb2RlcyApOwp9OwoKCi8vIEtlZXAgYSBjb3B5IG9mIHRoZSBvbGQgbG9hZCBtZXRob2QKdmFyIF9sb2FkID0galF1ZXJ5LmZuLmxvYWQ7CgovKioKICogTG9hZCBhIHVybCBpbnRvIGEgcGFnZQogKi8KalF1ZXJ5LmZuLmxvYWQgPSBmdW5jdGlvbiggdXJsLCBwYXJhbXMsIGNhbGxiYWNrICkgewoJaWYgKCB0eXBlb2YgdXJsICE9PSAic3RyaW5nIiAmJiBfbG9hZCApIHsKCQlyZXR1cm4gX2xvYWQuYXBwbHkoIHRoaXMsIGFyZ3VtZW50cyApOwoJfQoKCXZhciBzZWxlY3RvciwgdHlwZSwgcmVzcG9uc2UsCgkJc2VsZiA9IHRoaXMsCgkJb2ZmID0gdXJsLmluZGV4T2YoIiAiKTsKCglpZiAoIG9mZiA+PSAwICkgewoJCXNlbGVjdG9yID0galF1ZXJ5LnRyaW0oIHVybC5zbGljZSggb2ZmICkgKTsKCQl1cmwgPSB1cmwuc2xpY2UoIDAsIG9mZiApOwoJfQoKCS8vIElmIGl0J3MgYSBmdW5jdGlvbgoJaWYgKCBqUXVlcnkuaXNGdW5jdGlvbiggcGFyYW1zICkgKSB7CgoJCS8vIFdlIGFzc3VtZSB0aGF0IGl0J3MgdGhlIGNhbGxiYWNrCgkJY2FsbGJhY2sgPSBwYXJhbXM7CgkJcGFyYW1zID0gdW5kZWZpbmVkOwoKCS8vIE90aGVyd2lzZSwgYnVpbGQgYSBwYXJhbSBzdHJpbmcKCX0gZWxzZSBpZiAoIHBhcmFtcyAmJiB0eXBlb2YgcGFyYW1zID09PSAib2JqZWN0IiApIHsKCQl0eXBlID0gIlBPU1QiOwoJfQoKCS8vIElmIHdlIGhhdmUgZWxlbWVudHMgdG8gbW9kaWZ5LCBtYWtlIHRoZSByZXF1ZXN0CglpZiAoIHNlbGYubGVuZ3RoID4gMCApIHsKCQlqUXVlcnkuYWpheCh7CgkJCXVybDogdXJsLAoKCQkJLy8gaWYgInR5cGUiIHZhcmlhYmxlIGlzIHVuZGVmaW5lZCwgdGhlbiAiR0VUIiBtZXRob2Qgd2lsbCBiZSB1c2VkCgkJCXR5cGU6IHR5cGUsCgkJCWRhdGFUeXBlOiAiaHRtbCIsCgkJCWRhdGE6IHBhcmFtcwoJCX0pLmRvbmUoZnVuY3Rpb24oIHJlc3BvbnNlVGV4dCApIHsKCgkJCS8vIFNhdmUgcmVzcG9uc2UgZm9yIHVzZSBpbiBjb21wbGV0ZSBjYWxsYmFjawoJCQlyZXNwb25zZSA9IGFyZ3VtZW50czsKCgkJCXNlbGYuaHRtbCggc2VsZWN0b3IgPwoKCQkJCS8vIElmIGEgc2VsZWN0b3Igd2FzIHNwZWNpZmllZCwgbG9jYXRlIHRoZSByaWdodCBlbGVtZW50cyBpbiBhIGR1bW15IGRpdgoJCQkJLy8gRXhjbHVkZSBzY3JpcHRzIHRvIGF2b2lkIElFICdQZXJtaXNzaW9uIERlbmllZCcgZXJyb3JzCgkJCQlqUXVlcnkoIjxkaXY+IikuYXBwZW5kKCBqUXVlcnkucGFyc2VIVE1MKCByZXNwb25zZVRleHQgKSApLmZpbmQoIHNlbGVjdG9yICkgOgoKCQkJCS8vIE90aGVyd2lzZSB1c2UgdGhlIGZ1bGwgcmVzdWx0CgkJCQlyZXNwb25zZVRleHQgKTsKCgkJfSkuY29tcGxldGUoIGNhbGxiYWNrICYmIGZ1bmN0aW9uKCBqcVhIUiwgc3RhdHVzICkgewoJCQlzZWxmLmVhY2goIGNhbGxiYWNrLCByZXNwb25zZSB8fCBbIGpxWEhSLnJlc3BvbnNlVGV4dCwgc3RhdHVzLCBqcVhIUiBdICk7CgkJfSk7Cgl9CgoJcmV0dXJuIHRoaXM7Cn07CgoKCgovLyBBdHRhY2ggYSBidW5jaCBvZiBmdW5jdGlvbnMgZm9yIGhhbmRsaW5nIGNvbW1vbiBBSkFYIGV2ZW50cwpqUXVlcnkuZWFjaCggWyAiYWpheFN0YXJ0IiwgImFqYXhTdG9wIiwgImFqYXhDb21wbGV0ZSIsICJhamF4RXJyb3IiLCAiYWpheFN1Y2Nlc3MiLCAiYWpheFNlbmQiIF0sIGZ1bmN0aW9uKCBpLCB0eXBlICkgewoJalF1ZXJ5LmZuWyB0eXBlIF0gPSBmdW5jdGlvbiggZm4gKSB7CgkJcmV0dXJuIHRoaXMub24oIHR5cGUsIGZuICk7Cgl9Owp9KTsKCgoKCmpRdWVyeS5leHByLmZpbHRlcnMuYW5pbWF0ZWQgPSBmdW5jdGlvbiggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuZ3JlcChqUXVlcnkudGltZXJzLCBmdW5jdGlvbiggZm4gKSB7CgkJcmV0dXJuIGVsZW0gPT09IGZuLmVsZW07Cgl9KS5sZW5ndGg7Cn07CgoKCgp2YXIgZG9jRWxlbSA9IHdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgovKioKICogR2V0cyBhIHdpbmRvdyBmcm9tIGFuIGVsZW1lbnQKICovCmZ1bmN0aW9uIGdldFdpbmRvdyggZWxlbSApIHsKCXJldHVybiBqUXVlcnkuaXNXaW5kb3coIGVsZW0gKSA/IGVsZW0gOiBlbGVtLm5vZGVUeXBlID09PSA5ICYmIGVsZW0uZGVmYXVsdFZpZXc7Cn0KCmpRdWVyeS5vZmZzZXQgPSB7CglzZXRPZmZzZXQ6IGZ1bmN0aW9uKCBlbGVtLCBvcHRpb25zLCBpICkgewoJCXZhciBjdXJQb3NpdGlvbiwgY3VyTGVmdCwgY3VyQ1NTVG9wLCBjdXJUb3AsIGN1ck9mZnNldCwgY3VyQ1NTTGVmdCwgY2FsY3VsYXRlUG9zaXRpb24sCgkJCXBvc2l0aW9uID0galF1ZXJ5LmNzcyggZWxlbSwgInBvc2l0aW9uIiApLAoJCQljdXJFbGVtID0galF1ZXJ5KCBlbGVtICksCgkJCXByb3BzID0ge307CgoJCS8vIFNldCBwb3NpdGlvbiBmaXJzdCwgaW4tY2FzZSB0b3AvbGVmdCBhcmUgc2V0IGV2ZW4gb24gc3RhdGljIGVsZW0KCQlpZiAoIHBvc2l0aW9uID09PSAic3RhdGljIiApIHsKCQkJZWxlbS5zdHlsZS5wb3NpdGlvbiA9ICJyZWxhdGl2ZSI7CgkJfQoKCQljdXJPZmZzZXQgPSBjdXJFbGVtLm9mZnNldCgpOwoJCWN1ckNTU1RvcCA9IGpRdWVyeS5jc3MoIGVsZW0sICJ0b3AiICk7CgkJY3VyQ1NTTGVmdCA9IGpRdWVyeS5jc3MoIGVsZW0sICJsZWZ0IiApOwoJCWNhbGN1bGF0ZVBvc2l0aW9uID0gKCBwb3NpdGlvbiA9PT0gImFic29sdXRlIiB8fCBwb3NpdGlvbiA9PT0gImZpeGVkIiApICYmCgkJCSggY3VyQ1NTVG9wICsgY3VyQ1NTTGVmdCApLmluZGV4T2YoImF1dG8iKSA+IC0xOwoKCQkvLyBOZWVkIHRvIGJlIGFibGUgdG8gY2FsY3VsYXRlIHBvc2l0aW9uIGlmIGVpdGhlcgoJCS8vIHRvcCBvciBsZWZ0IGlzIGF1dG8gYW5kIHBvc2l0aW9uIGlzIGVpdGhlciBhYnNvbHV0ZSBvciBmaXhlZAoJCWlmICggY2FsY3VsYXRlUG9zaXRpb24gKSB7CgkJCWN1clBvc2l0aW9uID0gY3VyRWxlbS5wb3NpdGlvbigpOwoJCQljdXJUb3AgPSBjdXJQb3NpdGlvbi50b3A7CgkJCWN1ckxlZnQgPSBjdXJQb3NpdGlvbi5sZWZ0OwoKCQl9IGVsc2UgewoJCQljdXJUb3AgPSBwYXJzZUZsb2F0KCBjdXJDU1NUb3AgKSB8fCAwOwoJCQljdXJMZWZ0ID0gcGFyc2VGbG9hdCggY3VyQ1NTTGVmdCApIHx8IDA7CgkJfQoKCQlpZiAoIGpRdWVyeS5pc0Z1bmN0aW9uKCBvcHRpb25zICkgKSB7CgkJCW9wdGlvbnMgPSBvcHRpb25zLmNhbGwoIGVsZW0sIGksIGN1ck9mZnNldCApOwoJCX0KCgkJaWYgKCBvcHRpb25zLnRvcCAhPSBudWxsICkgewoJCQlwcm9wcy50b3AgPSAoIG9wdGlvbnMudG9wIC0gY3VyT2Zmc2V0LnRvcCApICsgY3VyVG9wOwoJCX0KCQlpZiAoIG9wdGlvbnMubGVmdCAhPSBudWxsICkgewoJCQlwcm9wcy5sZWZ0ID0gKCBvcHRpb25zLmxlZnQgLSBjdXJPZmZzZXQubGVmdCApICsgY3VyTGVmdDsKCQl9CgoJCWlmICggInVzaW5nIiBpbiBvcHRpb25zICkgewoJCQlvcHRpb25zLnVzaW5nLmNhbGwoIGVsZW0sIHByb3BzICk7CgoJCX0gZWxzZSB7CgkJCWN1ckVsZW0uY3NzKCBwcm9wcyApOwoJCX0KCX0KfTsKCmpRdWVyeS5mbi5leHRlbmQoewoJb2Zmc2V0OiBmdW5jdGlvbiggb3B0aW9ucyApIHsKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggKSB7CgkJCXJldHVybiBvcHRpb25zID09PSB1bmRlZmluZWQgPwoJCQkJdGhpcyA6CgkJCQl0aGlzLmVhY2goZnVuY3Rpb24oIGkgKSB7CgkJCQkJalF1ZXJ5Lm9mZnNldC5zZXRPZmZzZXQoIHRoaXMsIG9wdGlvbnMsIGkgKTsKCQkJCX0pOwoJCX0KCgkJdmFyIGRvY0VsZW0sIHdpbiwKCQkJZWxlbSA9IHRoaXNbIDAgXSwKCQkJYm94ID0geyB0b3A6IDAsIGxlZnQ6IDAgfSwKCQkJZG9jID0gZWxlbSAmJiBlbGVtLm93bmVyRG9jdW1lbnQ7CgoJCWlmICggIWRvYyApIHsKCQkJcmV0dXJuOwoJCX0KCgkJZG9jRWxlbSA9IGRvYy5kb2N1bWVudEVsZW1lbnQ7CgoJCS8vIE1ha2Ugc3VyZSBpdCdzIG5vdCBhIGRpc2Nvbm5lY3RlZCBET00gbm9kZQoJCWlmICggIWpRdWVyeS5jb250YWlucyggZG9jRWxlbSwgZWxlbSApICkgewoJCQlyZXR1cm4gYm94OwoJCX0KCgkJLy8gU3VwcG9ydDogQmxhY2tCZXJyeSA1LCBpT1MgMyAob3JpZ2luYWwgaVBob25lKQoJCS8vIElmIHdlIGRvbid0IGhhdmUgZ0JDUiwganVzdCB1c2UgMCwwIHJhdGhlciB0aGFuIGVycm9yCgkJaWYgKCB0eXBlb2YgZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QgIT09IHN0cnVuZGVmaW5lZCApIHsKCQkJYm94ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCQl9CgkJd2luID0gZ2V0V2luZG93KCBkb2MgKTsKCQlyZXR1cm4gewoJCQl0b3A6IGJveC50b3AgKyB3aW4ucGFnZVlPZmZzZXQgLSBkb2NFbGVtLmNsaWVudFRvcCwKCQkJbGVmdDogYm94LmxlZnQgKyB3aW4ucGFnZVhPZmZzZXQgLSBkb2NFbGVtLmNsaWVudExlZnQKCQl9OwoJfSwKCglwb3NpdGlvbjogZnVuY3Rpb24oKSB7CgkJaWYgKCAhdGhpc1sgMCBdICkgewoJCQlyZXR1cm47CgkJfQoKCQl2YXIgb2Zmc2V0UGFyZW50LCBvZmZzZXQsCgkJCWVsZW0gPSB0aGlzWyAwIF0sCgkJCXBhcmVudE9mZnNldCA9IHsgdG9wOiAwLCBsZWZ0OiAwIH07CgoJCS8vIEZpeGVkIGVsZW1lbnRzIGFyZSBvZmZzZXQgZnJvbSB3aW5kb3cgKHBhcmVudE9mZnNldCA9IHt0b3A6MCwgbGVmdDogMH0sIGJlY2F1c2UgaXQgaXMgaXRzIG9ubHkgb2Zmc2V0IHBhcmVudAoJCWlmICggalF1ZXJ5LmNzcyggZWxlbSwgInBvc2l0aW9uIiApID09PSAiZml4ZWQiICkgewoJCQkvLyBBc3N1bWUgZ2V0Qm91bmRpbmdDbGllbnRSZWN0IGlzIHRoZXJlIHdoZW4gY29tcHV0ZWQgcG9zaXRpb24gaXMgZml4ZWQKCQkJb2Zmc2V0ID0gZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCgkJfSBlbHNlIHsKCQkJLy8gR2V0ICpyZWFsKiBvZmZzZXRQYXJlbnQKCQkJb2Zmc2V0UGFyZW50ID0gdGhpcy5vZmZzZXRQYXJlbnQoKTsKCgkJCS8vIEdldCBjb3JyZWN0IG9mZnNldHMKCQkJb2Zmc2V0ID0gdGhpcy5vZmZzZXQoKTsKCQkJaWYgKCAhalF1ZXJ5Lm5vZGVOYW1lKCBvZmZzZXRQYXJlbnRbIDAgXSwgImh0bWwiICkgKSB7CgkJCQlwYXJlbnRPZmZzZXQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0KCk7CgkJCX0KCgkJCS8vIEFkZCBvZmZzZXRQYXJlbnQgYm9yZGVycwoJCQlwYXJlbnRPZmZzZXQudG9wICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyVG9wV2lkdGgiLCB0cnVlICk7CgkJCXBhcmVudE9mZnNldC5sZWZ0ICs9IGpRdWVyeS5jc3MoIG9mZnNldFBhcmVudFsgMCBdLCAiYm9yZGVyTGVmdFdpZHRoIiwgdHJ1ZSApOwoJCX0KCgkJLy8gU3VidHJhY3QgcGFyZW50IG9mZnNldHMgYW5kIGVsZW1lbnQgbWFyZ2lucwoJCXJldHVybiB7CgkJCXRvcDogb2Zmc2V0LnRvcCAtIHBhcmVudE9mZnNldC50b3AgLSBqUXVlcnkuY3NzKCBlbGVtLCAibWFyZ2luVG9wIiwgdHJ1ZSApLAoJCQlsZWZ0OiBvZmZzZXQubGVmdCAtIHBhcmVudE9mZnNldC5sZWZ0IC0galF1ZXJ5LmNzcyggZWxlbSwgIm1hcmdpbkxlZnQiLCB0cnVlICkKCQl9OwoJfSwKCglvZmZzZXRQYXJlbnQ6IGZ1bmN0aW9uKCkgewoJCXJldHVybiB0aGlzLm1hcChmdW5jdGlvbigpIHsKCQkJdmFyIG9mZnNldFBhcmVudCA9IHRoaXMub2Zmc2V0UGFyZW50IHx8IGRvY0VsZW07CgoJCQl3aGlsZSAoIG9mZnNldFBhcmVudCAmJiAoICFqUXVlcnkubm9kZU5hbWUoIG9mZnNldFBhcmVudCwgImh0bWwiICkgJiYgalF1ZXJ5LmNzcyggb2Zmc2V0UGFyZW50LCAicG9zaXRpb24iICkgPT09ICJzdGF0aWMiICkgKSB7CgkJCQlvZmZzZXRQYXJlbnQgPSBvZmZzZXRQYXJlbnQub2Zmc2V0UGFyZW50OwoJCQl9CgoJCQlyZXR1cm4gb2Zmc2V0UGFyZW50IHx8IGRvY0VsZW07CgkJfSk7Cgl9Cn0pOwoKLy8gQ3JlYXRlIHNjcm9sbExlZnQgYW5kIHNjcm9sbFRvcCBtZXRob2RzCmpRdWVyeS5lYWNoKCB7IHNjcm9sbExlZnQ6ICJwYWdlWE9mZnNldCIsIHNjcm9sbFRvcDogInBhZ2VZT2Zmc2V0IiB9LCBmdW5jdGlvbiggbWV0aG9kLCBwcm9wICkgewoJdmFyIHRvcCA9ICJwYWdlWU9mZnNldCIgPT09IHByb3A7CgoJalF1ZXJ5LmZuWyBtZXRob2QgXSA9IGZ1bmN0aW9uKCB2YWwgKSB7CgkJcmV0dXJuIGFjY2VzcyggdGhpcywgZnVuY3Rpb24oIGVsZW0sIG1ldGhvZCwgdmFsICkgewoJCQl2YXIgd2luID0gZ2V0V2luZG93KCBlbGVtICk7CgoJCQlpZiAoIHZhbCA9PT0gdW5kZWZpbmVkICkgewoJCQkJcmV0dXJuIHdpbiA/IHdpblsgcHJvcCBdIDogZWxlbVsgbWV0aG9kIF07CgkJCX0KCgkJCWlmICggd2luICkgewoJCQkJd2luLnNjcm9sbFRvKAoJCQkJCSF0b3AgPyB2YWwgOiB3aW5kb3cucGFnZVhPZmZzZXQsCgkJCQkJdG9wID8gdmFsIDogd2luZG93LnBhZ2VZT2Zmc2V0CgkJCQkpOwoKCQkJfSBlbHNlIHsKCQkJCWVsZW1bIG1ldGhvZCBdID0gdmFsOwoJCQl9CgkJfSwgbWV0aG9kLCB2YWwsIGFyZ3VtZW50cy5sZW5ndGgsIG51bGwgKTsKCX07Cn0pOwoKLy8gU3VwcG9ydDogU2FmYXJpPDcrLCBDaHJvbWU8MzcrCi8vIEFkZCB0aGUgdG9wL2xlZnQgY3NzSG9va3MgdXNpbmcgalF1ZXJ5LmZuLnBvc2l0aW9uCi8vIFdlYmtpdCBidWc6IGh0dHBzOi8vYnVncy53ZWJraXQub3JnL3Nob3dfYnVnLmNnaT9pZD0yOTA4NAovLyBCbGluayBidWc6IGh0dHBzOi8vY29kZS5nb29nbGUuY29tL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD0yMjkyODAKLy8gZ2V0Q29tcHV0ZWRTdHlsZSByZXR1cm5zIHBlcmNlbnQgd2hlbiBzcGVjaWZpZWQgZm9yIHRvcC9sZWZ0L2JvdHRvbS9yaWdodDsKLy8gcmF0aGVyIHRoYW4gbWFrZSB0aGUgY3NzIG1vZHVsZSBkZXBlbmQgb24gdGhlIG9mZnNldCBtb2R1bGUsIGp1c3QgY2hlY2sgZm9yIGl0IGhlcmUKalF1ZXJ5LmVhY2goIFsgInRvcCIsICJsZWZ0IiBdLCBmdW5jdGlvbiggaSwgcHJvcCApIHsKCWpRdWVyeS5jc3NIb29rc1sgcHJvcCBdID0gYWRkR2V0SG9va0lmKCBzdXBwb3J0LnBpeGVsUG9zaXRpb24sCgkJZnVuY3Rpb24oIGVsZW0sIGNvbXB1dGVkICkgewoJCQlpZiAoIGNvbXB1dGVkICkgewoJCQkJY29tcHV0ZWQgPSBjdXJDU1MoIGVsZW0sIHByb3AgKTsKCQkJCS8vIElmIGN1ckNTUyByZXR1cm5zIHBlcmNlbnRhZ2UsIGZhbGxiYWNrIHRvIG9mZnNldAoJCQkJcmV0dXJuIHJudW1ub25weC50ZXN0KCBjb21wdXRlZCApID8KCQkJCQlqUXVlcnkoIGVsZW0gKS5wb3NpdGlvbigpWyBwcm9wIF0gKyAicHgiIDoKCQkJCQljb21wdXRlZDsKCQkJfQoJCX0KCSk7Cn0pOwoKCi8vIENyZWF0ZSBpbm5lckhlaWdodCwgaW5uZXJXaWR0aCwgaGVpZ2h0LCB3aWR0aCwgb3V0ZXJIZWlnaHQgYW5kIG91dGVyV2lkdGggbWV0aG9kcwpqUXVlcnkuZWFjaCggeyBIZWlnaHQ6ICJoZWlnaHQiLCBXaWR0aDogIndpZHRoIiB9LCBmdW5jdGlvbiggbmFtZSwgdHlwZSApIHsKCWpRdWVyeS5lYWNoKCB7IHBhZGRpbmc6ICJpbm5lciIgKyBuYW1lLCBjb250ZW50OiB0eXBlLCAiIjogIm91dGVyIiArIG5hbWUgfSwgZnVuY3Rpb24oIGRlZmF1bHRFeHRyYSwgZnVuY05hbWUgKSB7CgkJLy8gTWFyZ2luIGlzIG9ubHkgZm9yIG91dGVySGVpZ2h0LCBvdXRlcldpZHRoCgkJalF1ZXJ5LmZuWyBmdW5jTmFtZSBdID0gZnVuY3Rpb24oIG1hcmdpbiwgdmFsdWUgKSB7CgkJCXZhciBjaGFpbmFibGUgPSBhcmd1bWVudHMubGVuZ3RoICYmICggZGVmYXVsdEV4dHJhIHx8IHR5cGVvZiBtYXJnaW4gIT09ICJib29sZWFuIiApLAoJCQkJZXh0cmEgPSBkZWZhdWx0RXh0cmEgfHwgKCBtYXJnaW4gPT09IHRydWUgfHwgdmFsdWUgPT09IHRydWUgPyAibWFyZ2luIiA6ICJib3JkZXIiICk7CgoJCQlyZXR1cm4gYWNjZXNzKCB0aGlzLCBmdW5jdGlvbiggZWxlbSwgdHlwZSwgdmFsdWUgKSB7CgkJCQl2YXIgZG9jOwoKCQkJCWlmICggalF1ZXJ5LmlzV2luZG93KCBlbGVtICkgKSB7CgkJCQkJLy8gQXMgb2YgNS84LzIwMTIgdGhpcyB3aWxsIHlpZWxkIGluY29ycmVjdCByZXN1bHRzIGZvciBNb2JpbGUgU2FmYXJpLCBidXQgdGhlcmUKCQkJCQkvLyBpc24ndCBhIHdob2xlIGxvdCB3ZSBjYW4gZG8uIFNlZSBwdWxsIHJlcXVlc3QgYXQgdGhpcyBVUkwgZm9yIGRpc2N1c3Npb246CgkJCQkJLy8gaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnkvcHVsbC83NjQKCQkJCQlyZXR1cm4gZWxlbS5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnRbICJjbGllbnQiICsgbmFtZSBdOwoJCQkJfQoKCQkJCS8vIEdldCBkb2N1bWVudCB3aWR0aCBvciBoZWlnaHQKCQkJCWlmICggZWxlbS5ub2RlVHlwZSA9PT0gOSApIHsKCQkJCQlkb2MgPSBlbGVtLmRvY3VtZW50RWxlbWVudDsKCgkJCQkJLy8gRWl0aGVyIHNjcm9sbFtXaWR0aC9IZWlnaHRdIG9yIG9mZnNldFtXaWR0aC9IZWlnaHRdIG9yIGNsaWVudFtXaWR0aC9IZWlnaHRdLAoJCQkJCS8vIHdoaWNoZXZlciBpcyBncmVhdGVzdAoJCQkJCXJldHVybiBNYXRoLm1heCgKCQkJCQkJZWxlbS5ib2R5WyAic2Nyb2xsIiArIG5hbWUgXSwgZG9jWyAic2Nyb2xsIiArIG5hbWUgXSwKCQkJCQkJZWxlbS5ib2R5WyAib2Zmc2V0IiArIG5hbWUgXSwgZG9jWyAib2Zmc2V0IiArIG5hbWUgXSwKCQkJCQkJZG9jWyAiY2xpZW50IiArIG5hbWUgXQoJCQkJCSk7CgkJCQl9CgoJCQkJcmV0dXJuIHZhbHVlID09PSB1bmRlZmluZWQgPwoJCQkJCS8vIEdldCB3aWR0aCBvciBoZWlnaHQgb24gdGhlIGVsZW1lbnQsIHJlcXVlc3RpbmcgYnV0IG5vdCBmb3JjaW5nIHBhcnNlRmxvYXQKCQkJCQlqUXVlcnkuY3NzKCBlbGVtLCB0eXBlLCBleHRyYSApIDoKCgkJCQkJLy8gU2V0IHdpZHRoIG9yIGhlaWdodCBvbiB0aGUgZWxlbWVudAoJCQkJCWpRdWVyeS5zdHlsZSggZWxlbSwgdHlwZSwgdmFsdWUsIGV4dHJhICk7CgkJCX0sIHR5cGUsIGNoYWluYWJsZSA/IG1hcmdpbiA6IHVuZGVmaW5lZCwgY2hhaW5hYmxlLCBudWxsICk7CgkJfTsKCX0pOwp9KTsKCgovLyBUaGUgbnVtYmVyIG9mIGVsZW1lbnRzIGNvbnRhaW5lZCBpbiB0aGUgbWF0Y2hlZCBlbGVtZW50IHNldApqUXVlcnkuZm4uc2l6ZSA9IGZ1bmN0aW9uKCkgewoJcmV0dXJuIHRoaXMubGVuZ3RoOwp9OwoKalF1ZXJ5LmZuLmFuZFNlbGYgPSBqUXVlcnkuZm4uYWRkQmFjazsKCgoKCi8vIFJlZ2lzdGVyIGFzIGEgbmFtZWQgQU1EIG1vZHVsZSwgc2luY2UgalF1ZXJ5IGNhbiBiZSBjb25jYXRlbmF0ZWQgd2l0aCBvdGhlcgovLyBmaWxlcyB0aGF0IG1heSB1c2UgZGVmaW5lLCBidXQgbm90IHZpYSBhIHByb3BlciBjb25jYXRlbmF0aW9uIHNjcmlwdCB0aGF0Ci8vIHVuZGVyc3RhbmRzIGFub255bW91cyBBTUQgbW9kdWxlcy4gQSBuYW1lZCBBTUQgaXMgc2FmZXN0IGFuZCBtb3N0IHJvYnVzdAovLyB3YXkgdG8gcmVnaXN0ZXIuIExvd2VyY2FzZSBqcXVlcnkgaXMgdXNlZCBiZWNhdXNlIEFNRCBtb2R1bGUgbmFtZXMgYXJlCi8vIGRlcml2ZWQgZnJvbSBmaWxlIG5hbWVzLCBhbmQgalF1ZXJ5IGlzIG5vcm1hbGx5IGRlbGl2ZXJlZCBpbiBhIGxvd2VyY2FzZQovLyBmaWxlIG5hbWUuIERvIHRoaXMgYWZ0ZXIgY3JlYXRpbmcgdGhlIGdsb2JhbCBzbyB0aGF0IGlmIGFuIEFNRCBtb2R1bGUgd2FudHMKLy8gdG8gY2FsbCBub0NvbmZsaWN0IHRvIGhpZGUgdGhpcyB2ZXJzaW9uIG9mIGpRdWVyeSwgaXQgd2lsbCB3b3JrLgoKLy8gTm90ZSB0aGF0IGZvciBtYXhpbXVtIHBvcnRhYmlsaXR5LCBsaWJyYXJpZXMgdGhhdCBhcmUgbm90IGpRdWVyeSBzaG91bGQKLy8gZGVjbGFyZSB0aGVtc2VsdmVzIGFzIGFub255bW91cyBtb2R1bGVzLCBhbmQgYXZvaWQgc2V0dGluZyBhIGdsb2JhbCBpZiBhbgovLyBBTUQgbG9hZGVyIGlzIHByZXNlbnQuIGpRdWVyeSBpcyBhIHNwZWNpYWwgY2FzZS4gRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZQovLyBodHRwczovL2dpdGh1Yi5jb20vanJidXJrZS9yZXF1aXJlanMvd2lraS9VcGRhdGluZy1leGlzdGluZy1saWJyYXJpZXMjd2lraS1hbm9uCgppZiAoIHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCApIHsKCWRlZmluZSggImpxdWVyeSIsIFtdLCBmdW5jdGlvbigpIHsKCQlyZXR1cm4galF1ZXJ5OwoJfSk7Cn0KCgoKCnZhcgoJLy8gTWFwIG92ZXIgalF1ZXJ5IGluIGNhc2Ugb2Ygb3ZlcndyaXRlCglfalF1ZXJ5ID0gd2luZG93LmpRdWVyeSwKCgkvLyBNYXAgb3ZlciB0aGUgJCBpbiBjYXNlIG9mIG92ZXJ3cml0ZQoJXyQgPSB3aW5kb3cuJDsKCmpRdWVyeS5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oIGRlZXAgKSB7CglpZiAoIHdpbmRvdy4kID09PSBqUXVlcnkgKSB7CgkJd2luZG93LiQgPSBfJDsKCX0KCglpZiAoIGRlZXAgJiYgd2luZG93LmpRdWVyeSA9PT0galF1ZXJ5ICkgewoJCXdpbmRvdy5qUXVlcnkgPSBfalF1ZXJ5OwoJfQoKCXJldHVybiBqUXVlcnk7Cn07CgovLyBFeHBvc2UgalF1ZXJ5IGFuZCAkIGlkZW50aWZpZXJzLCBldmVuIGluIEFNRAovLyAoIzcxMDIjY29tbWVudDoxMCwgaHR0cHM6Ly9naXRodWIuY29tL2pxdWVyeS9qcXVlcnkvcHVsbC81NTcpCi8vIGFuZCBDb21tb25KUyBmb3IgYnJvd3NlciBlbXVsYXRvcnMgKCMxMzU2NikKaWYgKCB0eXBlb2Ygbm9HbG9iYWwgPT09IHN0cnVuZGVmaW5lZCApIHsKCXdpbmRvdy5qUXVlcnkgPSB3aW5kb3cuJCA9IGpRdWVyeTsKfQoKCgoKcmV0dXJuIGpRdWVyeTsKCn0pKTsK"></script>
<script src="data:application/x-javascript;base64,LyoqCioKKiBqcXVlcnkuc3BhcmtsaW5lLmpzCioKKiB2Mi4xLjIKKiAoYykgU3BsdW5rLCBJbmMKKiBDb250YWN0OiBHYXJldGggV2F0dHMgKGdhcmV0aEBzcGx1bmsuY29tKQoqIGh0dHA6Ly9vbW5pcG90ZW50Lm5ldC9qcXVlcnkuc3BhcmtsaW5lLwoqCiogR2VuZXJhdGVzIGlubGluZSBzcGFya2xpbmUgY2hhcnRzIGZyb20gZGF0YSBzdXBwbGllZCBlaXRoZXIgdG8gdGhlIG1ldGhvZAoqIG9yIGlubGluZSBpbiBIVE1MCioKKiBDb21wYXRpYmxlIHdpdGggSW50ZXJuZXQgRXhwbG9yZXIgNi4wKyBhbmQgbW9kZXJuIGJyb3dzZXJzIGVxdWlwcGVkIHdpdGggdGhlIGNhbnZhcyB0YWcKKiAoRmlyZWZveCAyLjArLCBTYWZhcmksIE9wZXJhLCBldGMpCioKKiBMaWNlbnNlOiBOZXcgQlNEIExpY2Vuc2UKKgoqIENvcHlyaWdodCAoYykgMjAxMiwgU3BsdW5rIEluYy4KKiBBbGwgcmlnaHRzIHJlc2VydmVkLgoqCiogUmVkaXN0cmlidXRpb24gYW5kIHVzZSBpbiBzb3VyY2UgYW5kIGJpbmFyeSBmb3Jtcywgd2l0aCBvciB3aXRob3V0IG1vZGlmaWNhdGlvbiwKKiBhcmUgcGVybWl0dGVkIHByb3ZpZGVkIHRoYXQgdGhlIGZvbGxvd2luZyBjb25kaXRpb25zIGFyZSBtZXQ6CioKKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgb2Ygc291cmNlIGNvZGUgbXVzdCByZXRhaW4gdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiogICAgICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lci4KKiAgICAgKiBSZWRpc3RyaWJ1dGlvbnMgaW4gYmluYXJ5IGZvcm0gbXVzdCByZXByb2R1Y2UgdGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UsCiogICAgICAgdGhpcyBsaXN0IG9mIGNvbmRpdGlvbnMgYW5kIHRoZSBmb2xsb3dpbmcgZGlzY2xhaW1lciBpbiB0aGUgZG9jdW1lbnRhdGlvbgoqICAgICAgIGFuZC9vciBvdGhlciBtYXRlcmlhbHMgcHJvdmlkZWQgd2l0aCB0aGUgZGlzdHJpYnV0aW9uLgoqICAgICAqIE5laXRoZXIgdGhlIG5hbWUgb2YgU3BsdW5rIEluYyBub3IgdGhlIG5hbWVzIG9mIGl0cyBjb250cmlidXRvcnMgbWF5CiogICAgICAgYmUgdXNlZCB0byBlbmRvcnNlIG9yIHByb21vdGUgcHJvZHVjdHMgZGVyaXZlZCBmcm9tIHRoaXMgc29mdHdhcmUgd2l0aG91dAoqICAgICAgIHNwZWNpZmljIHByaW9yIHdyaXR0ZW4gcGVybWlzc2lvbi4KKgoqIFRISVMgU09GVFdBUkUgSVMgUFJPVklERUQgQlkgVEhFIENPUFlSSUdIVCBIT0xERVJTIEFORCBDT05UUklCVVRPUlMgIkFTIElTIiBBTkQgQU5ZCiogRVhQUkVTUyBPUiBJTVBMSUVEIFdBUlJBTlRJRVMsIElOQ0xVRElORywgQlVUIE5PVCBMSU1JVEVEIFRPLCBUSEUgSU1QTElFRCBXQVJSQU5USUVTCiogT0YgTUVSQ0hBTlRBQklMSVRZIEFORCBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRSBBUkUgRElTQ0xBSU1FRC4gSU4gTk8gRVZFTlQKKiBTSEFMTCBUSEUgQ09QWVJJR0hUIE9XTkVSIE9SIENPTlRSSUJVVE9SUyBCRSBMSUFCTEUgRk9SIEFOWSBESVJFQ1QsIElORElSRUNULCBJTkNJREVOVEFMLAoqIFNQRUNJQUwsIEVYRU1QTEFSWSwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIChJTkNMVURJTkcsIEJVVCBOT1QgTElNSVRFRCBUTywgUFJPQ1VSRU1FTlQKKiBPRiBTVUJTVElUVVRFIEdPT0RTIE9SIFNFUlZJQ0VTOyBMT1NTIE9GIFVTRSwgREFUQSwgT1IgUFJPRklUUzsgT1IgQlVTSU5FU1MgSU5URVJSVVBUSU9OKQoqIEhPV0VWRVIgQ0FVU0VEIEFORCBPTiBBTlkgVEhFT1JZIE9GIExJQUJJTElUWSwgV0hFVEhFUiBJTiBDT05UUkFDVCwgU1RSSUNUIExJQUJJTElUWSwKKiBPUiBUT1JUIChJTkNMVURJTkcgTkVHTElHRU5DRSBPUiBPVEhFUldJU0UpIEFSSVNJTkcgSU4gQU5ZIFdBWSBPVVQgT0YgVEhFIFVTRSBPRiBUSElTCiogU09GVFdBUkUsIEVWRU4gSUYgQURWSVNFRCBPRiBUSEUgUE9TU0lCSUxJVFkgT0YgU1VDSCBEQU1BR0UuCioKKgoqIFVzYWdlOgoqICAkKHNlbGVjdG9yKS5zcGFya2xpbmUodmFsdWVzLCBvcHRpb25zKQoqCiogSWYgdmFsdWVzIGlzIHVuZGVmaW5lZCBvciBzZXQgdG8gJ2h0bWwnIHRoZW4gdGhlIGRhdGEgdmFsdWVzIGFyZSByZWFkIGZyb20gdGhlIHNwZWNpZmllZCB0YWc6CiogICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPSJzcGFya2xpbmUiPjEsNCw2LDYsOCw1LDMsNTwvc3Bhbj48L3A+CiogICAkKCcuc3BhcmtsaW5lJykuc3BhcmtsaW5lKCk7CiogVGhlcmUgbXVzdCBiZSBubyBzcGFjZXMgaW4gdGhlIGVuY2xvc2VkIGRhdGEgc2V0CioKKiBPdGhlcndpc2UgdmFsdWVzIG11c3QgYmUgYW4gYXJyYXkgb2YgbnVtYmVycyBvciBudWxsIHZhbHVlcwoqICAgIDxwPlNwYXJrbGluZTogPHNwYW4gaWQ9InNwYXJrbGluZTEiPlRoaXMgdGV4dCByZXBsYWNlZCBpZiB0aGUgYnJvd3NlciBpcyBjb21wYXRpYmxlPC9zcGFuPjwvcD4KKiAgICAkKCcjc3BhcmtsaW5lMScpLnNwYXJrbGluZShbMSw0LDYsNiw4LDUsMyw1XSkKKiAgICAkKCcjc3BhcmtsaW5lMicpLnNwYXJrbGluZShbMSw0LDYsbnVsbCxudWxsLDUsMyw1XSkKKgoqIFZhbHVlcyBjYW4gYWxzbyBiZSBzcGVjaWZpZWQgaW4gYW4gSFRNTCBjb21tZW50LCBvciBhcyBhIHZhbHVlcyBhdHRyaWJ1dGU6CiogICAgPHA+U3BhcmtsaW5lOiA8c3BhbiBjbGFzcz0ic3BhcmtsaW5lIj48IS0tMSw0LDYsNiw4LDUsMyw1IC0tPjwvc3Bhbj48L3A+CiogICAgPHA+U3BhcmtsaW5lOiA8c3BhbiBjbGFzcz0ic3BhcmtsaW5lIiB2YWx1ZXM9IjEsNCw2LDYsOCw1LDMsNSI+PC9zcGFuPjwvcD4KKiAgICAkKCcuc3BhcmtsaW5lJykuc3BhcmtsaW5lKCk7CioKKiBGb3IgbGluZSBjaGFydHMsIHggdmFsdWVzIGNhbiBhbHNvIGJlIHNwZWNpZmllZDoKKiAgIDxwPlNwYXJrbGluZTogPHNwYW4gY2xhc3M9InNwYXJrbGluZSI+MToxLDIuNzo0LDMuNDo2LDU6Niw2OjgsOC43OjUsOTozLDEwOjU8L3NwYW4+PC9wPgoqICAgICQoJyNzcGFya2xpbmUxJykuc3BhcmtsaW5lKFsgWzEsMV0sIFsyLjcsNF0sIFszLjQsNl0sIFs1LDZdLCBbNiw4XSwgWzguNyw1XSwgWzksM10sIFsxMCw1XSBdKQoqCiogQnkgZGVmYXVsdCwgb3B0aW9ucyBzaG91bGQgYmUgcGFzc2VkIGluIGFzIHRlaCBzZWNvbmQgYXJndW1lbnQgdG8gdGhlIHNwYXJrbGluZSBmdW5jdGlvbjoKKiAgICQoJy5zcGFya2xpbmUnKS5zcGFya2xpbmUoWzEsMiwzLDRdLCB7dHlwZTogJ2Jhcid9KQoqCiogT3B0aW9ucyBjYW4gYWxzbyBiZSBzZXQgYnkgcGFzc2luZyB0aGVtIG9uIHRoZSB0YWcgaXRzZWxmLiAgVGhpcyBmZWF0dXJlIGlzIGRpc2FibGVkIGJ5IGRlZmF1bHQgdGhvdWdoCiogYXMgdGhlcmUncyBhIHNsaWdodCBwZXJmb3JtYW5jZSBvdmVyaGVhZDoKKiAgICQoJy5zcGFya2xpbmUnKS5zcGFya2xpbmUoWzEsMiwzLDRdLCB7ZW5hYmxlVGFnT3B0aW9uczogdHJ1ZX0pCiogICA8cD5TcGFya2xpbmU6IDxzcGFuIGNsYXNzPSJzcGFya2xpbmUiIHNwYXJrVHlwZT0iYmFyIiBzcGFya0JhckNvbG9yPSJyZWQiPmxvYWRpbmc8L3NwYW4+PC9wPgoqIFByZWZpeCBhbGwgb3B0aW9ucyBzdXBwbGllZCBhcyB0YWcgYXR0cmlidXRlIHdpdGggInNwYXJrIiAoY29uZmlndXJhYmxlIGJ5IHNldHRpbmcgdGFnT3B0aW9uUHJlZml4KQoqCiogU3VwcG9ydGVkIG9wdGlvbnM6CiogICBsaW5lQ29sb3IgLSBDb2xvciBvZiB0aGUgbGluZSB1c2VkIGZvciB0aGUgY2hhcnQKKiAgIGZpbGxDb2xvciAtIENvbG9yIHVzZWQgdG8gZmlsbCBpbiB0aGUgY2hhcnQgLSBTZXQgdG8gJycgb3IgZmFsc2UgZm9yIGEgdHJhbnNwYXJlbnQgY2hhcnQKKiAgIHdpZHRoIC0gV2lkdGggb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gMyB0aW1lcyB0aGUgbnVtYmVyIG9mIHZhbHVlcyBpbiBwaXhlbHMKKiAgIGhlaWdodCAtIEhlaWdodCBvZiB0aGUgY2hhcnQgLSBEZWZhdWx0cyB0byB0aGUgaGVpZ2h0IG9mIHRoZSBjb250YWluaW5nIGVsZW1lbnQKKiAgIGNoYXJ0UmFuZ2VNaW4gLSBTcGVjaWZ5IHRoZSBtaW5pbXVtIHZhbHVlIHRvIHVzZSBmb3IgdGhlIFkgcmFuZ2Ugb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gdGhlIG1pbmltdW0gdmFsdWUgc3VwcGxpZWQKKiAgIGNoYXJ0UmFuZ2VNYXggLSBTcGVjaWZ5IHRoZSBtYXhpbXVtIHZhbHVlIHRvIHVzZSBmb3IgdGhlIFkgcmFuZ2Ugb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gdGhlIG1heGltdW0gdmFsdWUgc3VwcGxpZWQKKiAgIGNoYXJ0UmFuZ2VDbGlwIC0gQ2xpcCBvdXQgb2YgcmFuZ2UgdmFsdWVzIHRvIHRoZSBtYXgvbWluIHNwZWNpZmllZCBieSBjaGFydFJhbmdlTWluIGFuZCBjaGFydFJhbmdlTWF4CiogICBjaGFydFJhbmdlTWluWCAtIFNwZWNpZnkgdGhlIG1pbmltdW0gdmFsdWUgdG8gdXNlIGZvciB0aGUgWCByYW5nZSBvZiB0aGUgY2hhcnQgLSBEZWZhdWx0cyB0byB0aGUgbWluaW11bSB2YWx1ZSBzdXBwbGllZAoqICAgY2hhcnRSYW5nZU1heFggLSBTcGVjaWZ5IHRoZSBtYXhpbXVtIHZhbHVlIHRvIHVzZSBmb3IgdGhlIFggcmFuZ2Ugb2YgdGhlIGNoYXJ0IC0gRGVmYXVsdHMgdG8gdGhlIG1heGltdW0gdmFsdWUgc3VwcGxpZWQKKiAgIGNvbXBvc2l0ZSAtIElmIHRydWUgdGhlbiBkb24ndCBlcmFzZSBhbnkgZXhpc3RpbmcgY2hhcnQgYXR0YWNoZWQgdG8gdGhlIHRhZywgYnV0IGRyYXcKKiAgICAgICAgICAgYW5vdGhlciBjaGFydCBvdmVyIHRoZSB0b3AgLSBOb3RlIHRoYXQgd2lkdGggYW5kIGhlaWdodCBhcmUgaWdub3JlZCBpZiBhbgoqICAgICAgICAgICBleGlzdGluZyBjaGFydCBpcyBkZXRlY3RlZC4KKiAgIHRhZ1ZhbHVlc0F0dHJpYnV0ZSAtIE5hbWUgb2YgdGFnIGF0dHJpYnV0ZSB0byBjaGVjayBmb3IgZGF0YSB2YWx1ZXMgLSBEZWZhdWx0cyB0byAndmFsdWVzJwoqICAgZW5hYmxlVGFnT3B0aW9ucyAtIFdoZXRoZXIgdG8gY2hlY2sgdGFncyBmb3Igc3BhcmtsaW5lIG9wdGlvbnMKKiAgIHRhZ09wdGlvblByZWZpeCAtIFByZWZpeCB1c2VkIGZvciBvcHRpb25zIHN1cHBsaWVkIGFzIHRhZyBhdHRyaWJ1dGVzIC0gRGVmYXVsdHMgdG8gJ3NwYXJrJwoqICAgZGlzYWJsZUhpZGRlbkNoZWNrIC0gSWYgc2V0IHRvIHRydWUsIHRoZW4gdGhlIHBsdWdpbiB3aWxsIGFzc3VtZSB0aGF0IGNoYXJ0cyB3aWxsIG5ldmVyIGJlIGRyYXduIGludG8gYQoqICAgICAgICAgICBoaWRkZW4gZG9tIGVsZW1lbnQsIGF2b2RpbmcgYSBicm93c2VyIHJlZmxvdwoqICAgZGlzYWJsZUludGVyYWN0aW9uIC0gSWYgc2V0IHRvIHRydWUgdGhlbiBhbGwgbW91c2VvdmVyL2NsaWNrIGludGVyYWN0aW9uIGJlaGF2aW91ciB3aWxsIGJlIGRpc2FibGVkLAoqICAgICAgIG1ha2luZyB0aGUgcGx1Z2luIHBlcmZvcm0gbXVjaCBsaWtlIGl0IGRpZCBpbiAxLngKKiAgIGRpc2FibGVUb29sdGlwcyAtIElmIHNldCB0byB0cnVlIHRoZW4gdG9vbHRpcHMgd2lsbCBiZSBkaXNhYmxlZCAtIERlZmF1bHRzIHRvIGZhbHNlICh0b29sdGlwcyBlbmFibGVkKQoqICAgZGlzYWJsZUhpZ2hsaWdodCAtIElmIHNldCB0byB0cnVlIHRoZW4gaGlnaGxpZ2h0aW5nIG9mIHNlbGVjdGVkIGNoYXJ0IGVsZW1lbnRzIG9uIG1vdXNlb3ZlciB3aWxsIGJlIGRpc2FibGVkCiogICAgICAgZGVmYXVsdHMgdG8gZmFsc2UgKGhpZ2hsaWdodHMgZW5hYmxlZCkKKiAgIGhpZ2hsaWdodExpZ2h0ZW4gLSBGYWN0b3IgdG8gbGlnaHRlbi9kYXJrZW4gaGlnaGxpZ2h0ZWQgY2hhcnQgdmFsdWVzIGJ5IC0gRGVmYXVsdHMgdG8gMS40IGZvciBhIDQwJSBpbmNyZWFzZQoqICAgdG9vbHRpcENvbnRhaW5lciAtIFNwZWNpZnkgd2hpY2ggRE9NIGVsZW1lbnQgdGhlIHRvb2x0aXAgc2hvdWxkIGJlIHJlbmRlcmVkIGludG8gLSBkZWZhdWx0cyB0byBkb2N1bWVudC5ib2R5CiogICB0b29sdGlwQ2xhc3NuYW1lIC0gT3B0aW9uYWwgQ1NTIGNsYXNzbmFtZSB0byBhcHBseSB0byB0b29sdGlwcyAtIElmIG5vdCBzcGVjaWZpZWQgdGhlbiBhIGRlZmF1bHQgc3R5bGUgd2lsbCBiZSBhcHBsaWVkCiogICB0b29sdGlwT2Zmc2V0WCAtIEhvdyBtYW55IHBpeGVscyBhd2F5IGZyb20gdGhlIG1vdXNlIHBvaW50ZXIgdG8gcmVuZGVyIHRoZSB0b29sdGlwIG9uIHRoZSBYIGF4aXMKKiAgIHRvb2x0aXBPZmZzZXRZIC0gSG93IG1hbnkgcGl4ZWxzIGF3YXkgZnJvbSB0aGUgbW91c2UgcG9pbnRlciB0byByZW5kZXIgdGhlIHRvb2x0aXAgb24gdGhlIHIgYXhpcwoqICAgdG9vbHRpcEZvcm1hdHRlciAgLSBPcHRpb25hbCBjYWxsYmFjayB0aGF0IGFsbG93cyB5b3UgdG8gb3ZlcnJpZGUgdGhlIEhUTUwgZGlzcGxheWVkIGluIHRoZSB0b29sdGlwCiogICAgICAgY2FsbGJhY2sgaXMgZ2l2ZW4gYXJndW1lbnRzIG9mIChzcGFya2xpbmUsIG9wdGlvbnMsIGZpZWxkcykKKiAgIHRvb2x0aXBDaGFydFRpdGxlIC0gSWYgc3BlY2lmaWVkIHRoZW4gdGhlIHRvb2x0aXAgdXNlcyB0aGUgc3RyaW5nIHNwZWNpZmllZCBieSB0aGlzIHNldHRpbmcgYXMgYSB0aXRsZQoqICAgdG9vbHRpcEZvcm1hdCAtIEEgZm9ybWF0IHN0cmluZyBvciBTUEZvcm1hdCBvYmplY3QgIChvciBhbiBhcnJheSB0aGVyZW9mIGZvciBtdWx0aXBsZSBlbnRyaWVzKQoqICAgICAgIHRvIGNvbnRyb2wgdGhlIGZvcm1hdCBvZiB0aGUgdG9vbHRpcAoqICAgdG9vbHRpcFByZWZpeCAtIEEgc3RyaW5nIHRvIHByZXBlbmQgdG8gZWFjaCBmaWVsZCBkaXNwbGF5ZWQgaW4gYSB0b29sdGlwCiogICB0b29sdGlwU3VmZml4IC0gQSBzdHJpbmcgdG8gYXBwZW5kIHRvIGVhY2ggZmllbGQgZGlzcGxheWVkIGluIGEgdG9vbHRpcAoqICAgdG9vbHRpcFNraXBOdWxsIC0gSWYgdHJ1ZSB0aGVuIG51bGwgdmFsdWVzIHdpbGwgbm90IGhhdmUgYSB0b29sdGlwIGRpc3BsYXllZCAoZGVmYXVsdHMgdG8gdHJ1ZSkKKiAgIHRvb2x0aXBWYWx1ZUxvb2t1cHMgLSBBbiBvYmplY3Qgb3IgcmFuZ2UgbWFwIHRvIG1hcCBmaWVsZCB2YWx1ZXMgdG8gdG9vbHRpcCBzdHJpbmdzCiogICAgICAgKGVnLiB0byBtYXAgLTEgdG8gIkxvc3QiLCAwIHRvICJEcmF3IiwgYW5kIDEgdG8gIldpbiIpCiogICBudW1iZXJGb3JtYXR0ZXIgLSBPcHRpb25hbCBjYWxsYmFjayBmb3IgZm9ybWF0dGluZyBudW1iZXJzIGluIHRvb2x0aXBzCiogICBudW1iZXJEaWdpdEdyb3VwU2VwIC0gQ2hhcmFjdGVyIHRvIHVzZSBmb3IgZ3JvdXAgc2VwYXJhdG9yIGluIG51bWJlcnMgIjEsMjM0IiAtIERlZmF1bHRzIHRvICIsIgoqICAgbnVtYmVyRGVjaW1hbE1hcmsgLSBDaGFyYWN0ZXIgdG8gdXNlIGZvciB0aGUgZGVjaW1hbCBwb2ludCB3aGVuIGZvcm1hdHRpbmcgbnVtYmVycyAtIERlZmF1bHRzIHRvICIuIgoqICAgbnVtYmVyRGlnaXRHcm91cENvdW50IC0gTnVtYmVyIG9mIGRpZ2l0cyBiZXR3ZWVuIGdyb3VwIHNlcGFyYXRvciAtIERlZmF1bHRzIHRvIDMKKgoqIFRoZXJlIGFyZSA3IHR5cGVzIG9mIHNwYXJrbGluZSwgc2VsZWN0ZWQgYnkgc3VwcGx5aW5nIGEgInR5cGUiIG9wdGlvbiBvZiAnbGluZScgKGRlZmF1bHQpLAoqICdiYXInLCAndHJpc3RhdGUnLCAnYnVsbGV0JywgJ2Rpc2NyZXRlJywgJ3BpZScgb3IgJ2JveCcKKiAgICBsaW5lIC0gTGluZSBjaGFydC4gIE9wdGlvbnM6CiogICAgICAgc3BvdENvbG9yIC0gU2V0IHRvICcnIHRvIG5vdCBlbmQgZWFjaCBsaW5lIGluIGEgY2lyY3VsYXIgc3BvdAoqICAgICAgIG1pblNwb3RDb2xvciAtIElmIHNldCwgY29sb3Igb2Ygc3BvdCBhdCBtaW5pbXVtIHZhbHVlCiogICAgICAgbWF4U3BvdENvbG9yIC0gSWYgc2V0LCBjb2xvciBvZiBzcG90IGF0IG1heGltdW0gdmFsdWUKKiAgICAgICBzcG90UmFkaXVzIC0gUmFkaXVzIGluIHBpeGVscwoqICAgICAgIGxpbmVXaWR0aCAtIFdpZHRoIG9mIGxpbmUgaW4gcGl4ZWxzCiogICAgICAgbm9ybWFsUmFuZ2VNaW4KKiAgICAgICBub3JtYWxSYW5nZU1heCAtIElmIHNldCBkcmF3cyBhIGZpbGxlZCBob3Jpem9udGFsIGJhciBiZXR3ZWVuIHRoZXNlIHR3byB2YWx1ZXMgbWFya2luZyB0aGUgIm5vcm1hbCIKKiAgICAgICAgICAgICAgICAgICAgICBvciBleHBlY3RlZCByYW5nZSBvZiB2YWx1ZXMKKiAgICAgICBub3JtYWxSYW5nZUNvbG9yIC0gQ29sb3IgdG8gdXNlIGZvciB0aGUgYWJvdmUgYmFyCiogICAgICAgZHJhd05vcm1hbE9uVG9wIC0gRHJhdyB0aGUgbm9ybWFsIHJhbmdlIGFib3ZlIHRoZSBjaGFydCBmaWxsIGNvbG9yIGlmIHRydWUKKiAgICAgICBkZWZhdWx0UGl4ZWxzUGVyVmFsdWUgLSBEZWZhdWx0cyB0byAzIHBpeGVscyBvZiB3aWR0aCBmb3IgZWFjaCB2YWx1ZSBpbiB0aGUgY2hhcnQKKiAgICAgICBoaWdobGlnaHRTcG90Q29sb3IgLSBUaGUgY29sb3IgdG8gdXNlIGZvciBkcmF3aW5nIGEgaGlnaGxpZ2h0IHNwb3Qgb24gbW91c2VvdmVyIC0gU2V0IHRvIG51bGwgdG8gZGlzYWJsZQoqICAgICAgIGhpZ2hsaWdodExpbmVDb2xvciAtIFRoZSBjb2xvciB0byB1c2UgZm9yIGRyYXdpbmcgYSBoaWdobGlnaHQgbGluZSBvbiBtb3VzZW92ZXIgLSBTZXQgdG8gbnVsbCB0byBkaXNhYmxlCiogICAgICAgdmFsdWVTcG90cyAtIFNwZWNpZnkgd2hpY2ggcG9pbnRzIHRvIGRyYXcgc3BvdHMgb24sIGFuZCBpbiB3aGljaCBjb2xvci4gIEFjY2VwdHMgYSByYW5nZSBtYXAKKgoqICAgYmFyIC0gQmFyIGNoYXJ0LiAgT3B0aW9uczoKKiAgICAgICBiYXJDb2xvciAtIENvbG9yIG9mIGJhcnMgZm9yIHBvc3RpdmUgdmFsdWVzCiogICAgICAgbmVnQmFyQ29sb3IgLSBDb2xvciBvZiBiYXJzIGZvciBuZWdhdGl2ZSB2YWx1ZXMKKiAgICAgICB6ZXJvQ29sb3IgLSBDb2xvciBvZiBiYXJzIHdpdGggemVybyB2YWx1ZXMKKiAgICAgICBudWxsQ29sb3IgLSBDb2xvciBvZiBiYXJzIHdpdGggbnVsbCB2YWx1ZXMgLSBEZWZhdWx0cyB0byBvbWl0dGluZyB0aGUgYmFyIGVudGlyZWx5CiogICAgICAgYmFyV2lkdGggLSBXaWR0aCBvZiBiYXJzIGluIHBpeGVscwoqICAgICAgIGNvbG9yTWFwIC0gT3B0aW9uYWwgbWFwcG5pZyBvZiB2YWx1ZXMgdG8gY29sb3JzIHRvIG92ZXJyaWRlIHRoZSAqQmFyQ29sb3IgdmFsdWVzIGFib3ZlCiogICAgICAgICAgICAgICAgICBjYW4gYmUgYW4gQXJyYXkgb2YgdmFsdWVzIHRvIGNvbnRyb2wgdGhlIGNvbG9yIG9mIGluZGl2aWR1YWwgYmFycyBvciBhIHJhbmdlIG1hcAoqICAgICAgICAgICAgICAgICAgdG8gc3BlY2lmeSBjb2xvcnMgZm9yIGluZGl2aWR1YWwgcmFuZ2VzIG9mIHZhbHVlcwoqICAgICAgIGJhclNwYWNpbmcgLSBHYXAgYmV0d2VlbiBiYXJzIGluIHBpeGVscwoqICAgICAgIHplcm9BeGlzIC0gQ2VudGVycyB0aGUgeS1heGlzIGFyb3VuZCB6ZXJvIGlmIHRydWUKKgoqICAgdHJpc3RhdGUgLSBDaGFydHMgdmFsdWVzIG9mIHdpbiAoPjApLCBsb3NlICg8MCkgb3IgZHJhdyAoPTApCiogICAgICAgcG9zQmFyQ29sb3IgLSBDb2xvciBvZiB3aW4gdmFsdWVzCiogICAgICAgbmVnQmFyQ29sb3IgLSBDb2xvciBvZiBsb3NlIHZhbHVlcwoqICAgICAgIHplcm9CYXJDb2xvciAtIENvbG9yIG9mIGRyYXcgdmFsdWVzCiogICAgICAgYmFyV2lkdGggLSBXaWR0aCBvZiBiYXJzIGluIHBpeGVscwoqICAgICAgIGJhclNwYWNpbmcgLSBHYXAgYmV0d2VlbiBiYXJzIGluIHBpeGVscwoqICAgICAgIGNvbG9yTWFwIC0gT3B0aW9uYWwgbWFwcG5pZyBvZiB2YWx1ZXMgdG8gY29sb3JzIHRvIG92ZXJyaWRlIHRoZSAqQmFyQ29sb3IgdmFsdWVzIGFib3ZlCiogICAgICAgICAgICAgICAgICBjYW4gYmUgYW4gQXJyYXkgb2YgdmFsdWVzIHRvIGNvbnRyb2wgdGhlIGNvbG9yIG9mIGluZGl2aWR1YWwgYmFycyBvciBhIHJhbmdlIG1hcAoqICAgICAgICAgICAgICAgICAgdG8gc3BlY2lmeSBjb2xvcnMgZm9yIGluZGl2aWR1YWwgcmFuZ2VzIG9mIHZhbHVlcwoqCiogICBkaXNjcmV0ZSAtIE9wdGlvbnM6CiogICAgICAgbGluZUhlaWdodCAtIEhlaWdodCBvZiBlYWNoIGxpbmUgaW4gcGl4ZWxzIC0gRGVmYXVsdHMgdG8gMzAlIG9mIHRoZSBncmFwaCBoZWlnaHQKKiAgICAgICB0aGVzaG9sZFZhbHVlIC0gVmFsdWVzIGxlc3MgdGhhbiB0aGlzIHZhbHVlIHdpbGwgYmUgZHJhd24gdXNpbmcgdGhyZXNob2xkQ29sb3IgaW5zdGVhZCBvZiBsaW5lQ29sb3IKKiAgICAgICB0aHJlc2hvbGRDb2xvcgoqCiogICBidWxsZXQgLSBWYWx1ZXMgZm9yIGJ1bGxldCBncmFwaHMgbXN1dCBiZSBpbiB0aGUgb3JkZXI6IHRhcmdldCwgcGVyZm9ybWFuY2UsIHJhbmdlMSwgcmFuZ2UyLCByYW5nZTMsIC4uLgoqICAgICAgIG9wdGlvbnM6CiogICAgICAgdGFyZ2V0Q29sb3IgLSBUaGUgY29sb3Igb2YgdGhlIHZlcnRpY2FsIHRhcmdldCBtYXJrZXIKKiAgICAgICB0YXJnZXRXaWR0aCAtIFRoZSB3aWR0aCBvZiB0aGUgdGFyZ2V0IG1hcmtlciBpbiBwaXhlbHMKKiAgICAgICBwZXJmb3JtYW5jZUNvbG9yIC0gVGhlIGNvbG9yIG9mIHRoZSBwZXJmb3JtYW5jZSBtZWFzdXJlIGhvcml6b250YWwgYmFyCiogICAgICAgcmFuZ2VDb2xvcnMgLSBDb2xvcnMgdG8gdXNlIGZvciBlYWNoIHF1YWxpdGF0aXZlIHJhbmdlIGJhY2tncm91bmQgY29sb3IKKgoqICAgcGllIC0gUGllIGNoYXJ0LiBPcHRpb25zOgoqICAgICAgIHNsaWNlQ29sb3JzIC0gQW4gYXJyYXkgb2YgY29sb3JzIHRvIHVzZSBmb3IgcGllIHNsaWNlcwoqICAgICAgIG9mZnNldCAtIEFuZ2xlIGluIGRlZ3JlZXMgdG8gb2Zmc2V0IHRoZSBmaXJzdCBzbGljZSAtIFRyeSAtOTAgb3IgKzkwCiogICAgICAgYm9yZGVyV2lkdGggLSBXaWR0aCBvZiBib3JkZXIgdG8gZHJhdyBhcm91bmQgdGhlIHBpZSBjaGFydCwgaW4gcGl4ZWxzIC0gRGVmYXVsdHMgdG8gMCAobm8gYm9yZGVyKQoqICAgICAgIGJvcmRlckNvbG9yIC0gQ29sb3IgdG8gdXNlIGZvciB0aGUgcGllIGNoYXJ0IGJvcmRlciAtIERlZmF1bHRzIHRvICMwMDAKKgoqICAgYm94IC0gQm94IHBsb3QuIE9wdGlvbnM6CiogICAgICAgcmF3IC0gU2V0IHRvIHRydWUgdG8gc3VwcGx5IHByZS1jb21wdXRlZCBwbG90IHBvaW50cyBhcyB2YWx1ZXMKKiAgICAgICAgICAgICB2YWx1ZXMgc2hvdWxkIGJlOiBsb3dfb3V0bGllciwgbG93X3doaXNrZXIsIHExLCBtZWRpYW4sIHEzLCBoaWdoX3doaXNrZXIsIGhpZ2hfb3V0bGllcgoqICAgICAgICAgICAgIFdoZW4gc2V0IHRvIGZhbHNlIHlvdSBjYW4gc3VwcGx5IGFueSBudW1iZXIgb2YgdmFsdWVzIGFuZCB0aGUgYm94IHBsb3Qgd2lsbAoqICAgICAgICAgICAgIGJlIGNvbXB1dGVkIGZvciB5b3UuICBEZWZhdWx0IGlzIGZhbHNlLgoqICAgICAgIHNob3dPdXRsaWVycyAtIFNldCB0byB0cnVlIChkZWZhdWx0KSB0byBkaXNwbGF5IG91dGxpZXJzIGFzIGNpcmNsZXMKKiAgICAgICBvdXRsaWVySVFSIC0gSW50ZXJxdWFydGlsZSByYW5nZSB1c2VkIHRvIGRldGVybWluZSBvdXRsaWVycy4gIERlZmF1bHQgMS41CiogICAgICAgYm94TGluZUNvbG9yIC0gT3V0bGluZSBjb2xvciBvZiB0aGUgYm94CiogICAgICAgYm94RmlsbENvbG9yIC0gRmlsbCBjb2xvciBmb3IgdGhlIGJveAoqICAgICAgIHdoaXNrZXJDb2xvciAtIExpbmUgY29sb3IgdXNlZCBmb3Igd2hpc2tlcnMKKiAgICAgICBvdXRsaWVyTGluZUNvbG9yIC0gT3V0bGluZSBjb2xvciBvZiBvdXRsaWVyIGNpcmNsZXMKKiAgICAgICBvdXRsaWVyRmlsbENvbG9yIC0gRmlsbCBjb2xvciBvZiB0aGUgb3V0bGllciBjaXJjbGVzCiogICAgICAgc3BvdFJhZGl1cyAtIFJhZGl1cyBvZiBvdXRsaWVyIGNpcmNsZXMKKiAgICAgICBtZWRpYW5Db2xvciAtIExpbmUgY29sb3Igb2YgdGhlIG1lZGlhbiBsaW5lCiogICAgICAgdGFyZ2V0IC0gRHJhdyBhIHRhcmdldCBjcm9zcyBoYWlyIGF0IHRoZSBzdXBwbGllZCB2YWx1ZSAoZGVmYXVsdCB1bmRlZmluZWQpCioKKgoqCiogICBFeGFtcGxlczoKKiAgICQoJyNzcGFya2xpbmUxJykuc3BhcmtsaW5lKG15dmFsdWVzLCB7IGxpbmVDb2xvcjogJyNmMDAnLCBmaWxsQ29sb3I6IGZhbHNlIH0pOwoqICAgJCgnLmJhcnNwYXJrcycpLnNwYXJrbGluZSgnaHRtbCcsIHsgdHlwZTonYmFyJywgaGVpZ2h0Oic0MHB4JywgYmFyV2lkdGg6NSB9KTsKKiAgICQoJyN0cmlzdGF0ZScpLnNwYXJrbGluZShbMSwxLC0xLDEsMCwwLC0xXSwgeyB0eXBlOid0cmlzdGF0ZScgfSk6CiogICAkKCcjZGlzY3JldGUnKS5zcGFya2xpbmUoWzEsMyw0LDUsNSwzLDQsNV0sIHsgdHlwZTonZGlzY3JldGUnIH0pOwoqICAgJCgnI2J1bGxldCcpLnNwYXJrbGluZShbMTAsMTIsMTIsOSw3XSwgeyB0eXBlOididWxsZXQnIH0pOwoqICAgJCgnI3BpZScpLnNwYXJrbGluZShbMSwxLDJdLCB7IHR5cGU6J3BpZScgfSk7CiovCgovKmpzbGludCByZWdleHA6IHRydWUsIGJyb3dzZXI6IHRydWUsIGpxdWVyeTogdHJ1ZSwgd2hpdGU6IHRydWUsIG5vbWVuOiBmYWxzZSwgcGx1c3BsdXM6IGZhbHNlLCBtYXhlcnI6IDUwMCwgaW5kZW50OiA0ICovCgooZnVuY3Rpb24oZG9jdW1lbnQsIE1hdGgsIHVuZGVmaW5lZCkgeyAvLyBwZXJmb3JtYW5jZS9taW5pZmllZC1zaXplIG9wdGltaXphdGlvbgooZnVuY3Rpb24oZmFjdG9yeSkgewogICAgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7CiAgICAgICAgZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpOwogICAgfSBlbHNlIGlmIChqUXVlcnkgJiYgIWpRdWVyeS5mbi5zcGFya2xpbmUpIHsKICAgICAgICBmYWN0b3J5KGpRdWVyeSk7CiAgICB9Cn0KKGZ1bmN0aW9uKCQpIHsKICAgICd1c2Ugc3RyaWN0JzsKCiAgICB2YXIgVU5TRVRfT1BUSU9OID0ge30sCiAgICAgICAgZ2V0RGVmYXVsdHMsIGNyZWF0ZUNsYXNzLCBTUEZvcm1hdCwgY2xpcHZhbCwgcXVhcnRpbGUsIG5vcm1hbGl6ZVZhbHVlLCBub3JtYWxpemVWYWx1ZXMsCiAgICAgICAgcmVtb3ZlLCBpc051bWJlciwgYWxsLCBzdW0sIGFkZENTUywgZW5zdXJlQXJyYXksIGZvcm1hdE51bWJlciwgUmFuZ2VNYXAsCiAgICAgICAgTW91c2VIYW5kbGVyLCBUb29sdGlwLCBiYXJIaWdobGlnaHRNaXhpbiwKICAgICAgICBsaW5lLCBiYXIsIHRyaXN0YXRlLCBkaXNjcmV0ZSwgYnVsbGV0LCBwaWUsIGJveCwgZGVmYXVsdFN0eWxlcywgaW5pdFN0eWxlcywKICAgICAgICBWU2hhcGUsIFZDYW52YXNfYmFzZSwgVkNhbnZhc19jYW52YXMsIFZDYW52YXNfdm1sLCBwZW5kaW5nLCBzaGFwZUNvdW50ID0gMDsKCiAgICAvKioKICAgICAqIERlZmF1bHQgY29uZmlndXJhdGlvbiBzZXR0aW5ncwogICAgICovCiAgICBnZXREZWZhdWx0cyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAvLyBTZXR0aW5ncyBjb21tb24gdG8gbW9zdC9hbGwgY2hhcnQgdHlwZXMKICAgICAgICAgICAgY29tbW9uOiB7CiAgICAgICAgICAgICAgICB0eXBlOiAnbGluZScsCiAgICAgICAgICAgICAgICBsaW5lQ29sb3I6ICcjMDBmJywKICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogJyNjZGYnLAogICAgICAgICAgICAgICAgZGVmYXVsdFBpeGVsc1BlclZhbHVlOiAzLAogICAgICAgICAgICAgICAgd2lkdGg6ICdhdXRvJywKICAgICAgICAgICAgICAgIGhlaWdodDogJ2F1dG8nLAogICAgICAgICAgICAgICAgY29tcG9zaXRlOiBmYWxzZSwKICAgICAgICAgICAgICAgIHRhZ1ZhbHVlc0F0dHJpYnV0ZTogJ3ZhbHVlcycsCiAgICAgICAgICAgICAgICB0YWdPcHRpb25zUHJlZml4OiAnc3BhcmsnLAogICAgICAgICAgICAgICAgZW5hYmxlVGFnT3B0aW9uczogZmFsc2UsCiAgICAgICAgICAgICAgICBlbmFibGVIaWdobGlnaHQ6IHRydWUsCiAgICAgICAgICAgICAgICBoaWdobGlnaHRMaWdodGVuOiAxLjQsCiAgICAgICAgICAgICAgICB0b29sdGlwU2tpcE51bGw6IHRydWUsCiAgICAgICAgICAgICAgICB0b29sdGlwUHJlZml4OiAnJywKICAgICAgICAgICAgICAgIHRvb2x0aXBTdWZmaXg6ICcnLAogICAgICAgICAgICAgICAgZGlzYWJsZUhpZGRlbkNoZWNrOiBmYWxzZSwKICAgICAgICAgICAgICAgIG51bWJlckZvcm1hdHRlcjogZmFsc2UsCiAgICAgICAgICAgICAgICBudW1iZXJEaWdpdEdyb3VwQ291bnQ6IDMsCiAgICAgICAgICAgICAgICBudW1iZXJEaWdpdEdyb3VwU2VwOiAnLCcsCiAgICAgICAgICAgICAgICBudW1iZXJEZWNpbWFsTWFyazogJy4nLAogICAgICAgICAgICAgICAgZGlzYWJsZVRvb2x0aXBzOiBmYWxzZSwKICAgICAgICAgICAgICAgIGRpc2FibGVJbnRlcmFjdGlvbjogZmFsc2UKICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gRGVmYXVsdHMgZm9yIGxpbmUgY2hhcnRzCiAgICAgICAgICAgIGxpbmU6IHsKICAgICAgICAgICAgICAgIHNwb3RDb2xvcjogJyNmODAnLAogICAgICAgICAgICAgICAgaGlnaGxpZ2h0U3BvdENvbG9yOiAnIzVmNScsCiAgICAgICAgICAgICAgICBoaWdobGlnaHRMaW5lQ29sb3I6ICcjZjIyJywKICAgICAgICAgICAgICAgIHNwb3RSYWRpdXM6IDEuNSwKICAgICAgICAgICAgICAgIG1pblNwb3RDb2xvcjogJyNmODAnLAogICAgICAgICAgICAgICAgbWF4U3BvdENvbG9yOiAnI2Y4MCcsCiAgICAgICAgICAgICAgICBsaW5lV2lkdGg6IDEsCiAgICAgICAgICAgICAgICBub3JtYWxSYW5nZU1pbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgbm9ybWFsUmFuZ2VNYXg6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIG5vcm1hbFJhbmdlQ29sb3I6ICcjY2NjJywKICAgICAgICAgICAgICAgIGRyYXdOb3JtYWxPblRvcDogZmFsc2UsCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWluOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWF4OiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWluWDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1heFg6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgnPHNwYW4gc3R5bGU9ImNvbG9yOiB7e2NvbG9yfX0iPiYjOTY3OTs8L3NwYW4+IHt7cHJlZml4fX17e3l9fXt7c3VmZml4fX0nKQogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgYmFyIGNoYXJ0cwogICAgICAgICAgICBiYXI6IHsKICAgICAgICAgICAgICAgIGJhckNvbG9yOiAnIzMzNjZjYycsCiAgICAgICAgICAgICAgICBuZWdCYXJDb2xvcjogJyNmNDQnLAogICAgICAgICAgICAgICAgc3RhY2tlZEJhckNvbG9yOiBbJyMzMzY2Y2MnLCAnI2RjMzkxMicsICcjZmY5OTAwJywgJyMxMDk2MTgnLCAnIzY2YWEwMCcsCiAgICAgICAgICAgICAgICAgICAgJyNkZDQ0NzcnLCAnIzAwOTljNicsICcjOTkwMDk5J10sCiAgICAgICAgICAgICAgICB6ZXJvQ29sb3I6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIG51bGxDb2xvcjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgemVyb0F4aXM6IHRydWUsCiAgICAgICAgICAgICAgICBiYXJXaWR0aDogNCwKICAgICAgICAgICAgICAgIGJhclNwYWNpbmc6IDEsCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWF4OiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWluOiB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlQ2xpcDogZmFsc2UsCiAgICAgICAgICAgICAgICBjb2xvck1hcDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDogbmV3IFNQRm9ybWF0KCc8c3BhbiBzdHlsZT0iY29sb3I6IHt7Y29sb3J9fSI+JiM5Njc5Ozwvc3Bhbj4ge3twcmVmaXh9fXt7dmFsdWV9fXt7c3VmZml4fX0nKQogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgdHJpc3RhdGUgY2hhcnRzCiAgICAgICAgICAgIHRyaXN0YXRlOiB7CiAgICAgICAgICAgICAgICBiYXJXaWR0aDogNCwKICAgICAgICAgICAgICAgIGJhclNwYWNpbmc6IDEsCiAgICAgICAgICAgICAgICBwb3NCYXJDb2xvcjogJyM2ZjYnLAogICAgICAgICAgICAgICAgbmVnQmFyQ29sb3I6ICcjZjQ0JywKICAgICAgICAgICAgICAgIHplcm9CYXJDb2xvcjogJyM5OTknLAogICAgICAgICAgICAgICAgY29sb3JNYXA6IHt9LAogICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDogbmV3IFNQRm9ybWF0KCc8c3BhbiBzdHlsZT0iY29sb3I6IHt7Y29sb3J9fSI+JiM5Njc5Ozwvc3Bhbj4ge3t2YWx1ZTptYXB9fScpLAogICAgICAgICAgICAgICAgdG9vbHRpcFZhbHVlTG9va3VwczogeyBtYXA6IHsgJy0xJzogJ0xvc3MnLCAnMCc6ICdEcmF3JywgJzEnOiAnV2luJyB9IH0KICAgICAgICAgICAgfSwKICAgICAgICAgICAgLy8gRGVmYXVsdHMgZm9yIGRpc2NyZXRlIGNoYXJ0cwogICAgICAgICAgICBkaXNjcmV0ZTogewogICAgICAgICAgICAgICAgbGluZUhlaWdodDogJ2F1dG8nLAogICAgICAgICAgICAgICAgdGhyZXNob2xkQ29sb3I6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHRocmVzaG9sZFZhbHVlOiAwLAogICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1heDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1pbjogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgY2hhcnRSYW5nZUNsaXA6IGZhbHNlLAogICAgICAgICAgICAgICAgdG9vbHRpcEZvcm1hdDogbmV3IFNQRm9ybWF0KCd7e3ByZWZpeH19e3t2YWx1ZX19e3tzdWZmaXh9fScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBidWxsZXQgY2hhcnRzCiAgICAgICAgICAgIGJ1bGxldDogewogICAgICAgICAgICAgICAgdGFyZ2V0Q29sb3I6ICcjZjMzJywKICAgICAgICAgICAgICAgIHRhcmdldFdpZHRoOiAzLCAvLyB3aWR0aCBvZiB0aGUgdGFyZ2V0IGJhciBpbiBwaXhlbHMKICAgICAgICAgICAgICAgIHBlcmZvcm1hbmNlQ29sb3I6ICcjMzNmJywKICAgICAgICAgICAgICAgIHJhbmdlQ29sb3JzOiBbJyNkM2RhZmUnLCAnI2E4YjZmZicsICcjN2Y5NGZmJ10sCiAgICAgICAgICAgICAgICBiYXNlOiB1bmRlZmluZWQsIC8vIHNldCB0aGlzIHRvIGEgbnVtYmVyIHRvIGNoYW5nZSB0aGUgYmFzZSBzdGFydCBudW1iZXIKICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgne3tmaWVsZGtleTpmaWVsZHN9fSAtIHt7dmFsdWV9fScpLAogICAgICAgICAgICAgICAgdG9vbHRpcFZhbHVlTG9va3VwczogeyBmaWVsZHM6IHtyOiAnUmFuZ2UnLCBwOiAnUGVyZm9ybWFuY2UnLCB0OiAnVGFyZ2V0J30gfQogICAgICAgICAgICB9LAogICAgICAgICAgICAvLyBEZWZhdWx0cyBmb3IgcGllIGNoYXJ0cwogICAgICAgICAgICBwaWU6IHsKICAgICAgICAgICAgICAgIG9mZnNldDogMCwKICAgICAgICAgICAgICAgIHNsaWNlQ29sb3JzOiBbJyMzMzY2Y2MnLCAnI2RjMzkxMicsICcjZmY5OTAwJywgJyMxMDk2MTgnLCAnIzY2YWEwMCcsCiAgICAgICAgICAgICAgICAgICAgJyNkZDQ0NzcnLCAnIzAwOTljNicsICcjOTkwMDk5J10sCiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aDogMCwKICAgICAgICAgICAgICAgIGJvcmRlckNvbG9yOiAnIzAwMCcsCiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0OiBuZXcgU1BGb3JtYXQoJzxzcGFuIHN0eWxlPSJjb2xvcjoge3tjb2xvcn19Ij4mIzk2Nzk7PC9zcGFuPiB7e3ZhbHVlfX0gKHt7cGVyY2VudC4xfX0lKScpCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIC8vIERlZmF1bHRzIGZvciBib3ggcGxvdHMKICAgICAgICAgICAgYm94OiB7CiAgICAgICAgICAgICAgICByYXc6IGZhbHNlLAogICAgICAgICAgICAgICAgYm94TGluZUNvbG9yOiAnIzAwMCcsCiAgICAgICAgICAgICAgICBib3hGaWxsQ29sb3I6ICcjY2RmJywKICAgICAgICAgICAgICAgIHdoaXNrZXJDb2xvcjogJyMwMDAnLAogICAgICAgICAgICAgICAgb3V0bGllckxpbmVDb2xvcjogJyMzMzMnLAogICAgICAgICAgICAgICAgb3V0bGllckZpbGxDb2xvcjogJyNmZmYnLAogICAgICAgICAgICAgICAgbWVkaWFuQ29sb3I6ICcjZjAwJywKICAgICAgICAgICAgICAgIHNob3dPdXRsaWVyczogdHJ1ZSwKICAgICAgICAgICAgICAgIG91dGxpZXJJUVI6IDEuNSwKICAgICAgICAgICAgICAgIHNwb3RSYWRpdXM6IDEuNSwKICAgICAgICAgICAgICAgIHRhcmdldDogdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdGFyZ2V0Q29sb3I6ICcjNGEyJywKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNYXg6IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VNaW46IHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgIHRvb2x0aXBGb3JtYXQ6IG5ldyBTUEZvcm1hdCgne3tmaWVsZDpmaWVsZHN9fToge3t2YWx1ZX19JyksCiAgICAgICAgICAgICAgICB0b29sdGlwRm9ybWF0RmllbGRsaXN0S2V5OiAnZmllbGQnLAogICAgICAgICAgICAgICAgdG9vbHRpcFZhbHVlTG9va3VwczogeyBmaWVsZHM6IHsgbHE6ICdMb3dlciBRdWFydGlsZScsIG1lZDogJ01lZGlhbicsCiAgICAgICAgICAgICAgICAgICAgdXE6ICdVcHBlciBRdWFydGlsZScsIGxvOiAnTGVmdCBPdXRsaWVyJywgcm86ICdSaWdodCBPdXRsaWVyJywKICAgICAgICAgICAgICAgICAgICBsdzogJ0xlZnQgV2hpc2tlcicsIHJ3OiAnUmlnaHQgV2hpc2tlcid9IH0KICAgICAgICAgICAgfQogICAgICAgIH07CiAgICB9OwoKICAgIC8vIFlvdSBjYW4gaGF2ZSB0b29sdGlwcyB1c2UgYSBjc3MgY2xhc3Mgb3RoZXIgdGhhbiBqcXN0b29sdGlwIGJ5IHNwZWNpZnlpbmcgdG9vbHRpcENsYXNzbmFtZQogICAgZGVmYXVsdFN0eWxlcyA9ICcuanFzdG9vbHRpcCB7ICcgKwogICAgICAgICAgICAncG9zaXRpb246IGFic29sdXRlOycgKwogICAgICAgICAgICAnbGVmdDogMHB4OycgKwogICAgICAgICAgICAndG9wOiAwcHg7JyArCiAgICAgICAgICAgICd2aXNpYmlsaXR5OiBoaWRkZW47JyArCiAgICAgICAgICAgICdiYWNrZ3JvdW5kOiByZ2IoMCwgMCwgMCkgdHJhbnNwYXJlbnQ7JyArCiAgICAgICAgICAgICdiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDAsMCwwLDAuNik7JyArCiAgICAgICAgICAgICdmaWx0ZXI6cHJvZ2lkOkRYSW1hZ2VUcmFuc2Zvcm0uTWljcm9zb2Z0LmdyYWRpZW50KHN0YXJ0Q29sb3JzdHI9Izk5MDAwMDAwLCBlbmRDb2xvcnN0cj0jOTkwMDAwMDApOycgKwogICAgICAgICAgICAnLW1zLWZpbHRlcjogInByb2dpZDpEWEltYWdlVHJhbnNmb3JtLk1pY3Jvc29mdC5ncmFkaWVudChzdGFydENvbG9yc3RyPSM5OTAwMDAwMCwgZW5kQ29sb3JzdHI9Izk5MDAwMDAwKSI7JyArCiAgICAgICAgICAgICdjb2xvcjogd2hpdGU7JyArCiAgICAgICAgICAgICdmb250OiAxMHB4IGFyaWFsLCBzYW4gc2VyaWY7JyArCiAgICAgICAgICAgICd0ZXh0LWFsaWduOiBsZWZ0OycgKwogICAgICAgICAgICAnd2hpdGUtc3BhY2U6IG5vd3JhcDsnICsKICAgICAgICAgICAgJ3BhZGRpbmc6IDVweDsnICsKICAgICAgICAgICAgJ2JvcmRlcjogMXB4IHNvbGlkIHdoaXRlOycgKwogICAgICAgICAgICAnei1pbmRleDogMTAwMDA7JyArCiAgICAgICAgICAgICd9JyArCiAgICAgICAgICAgICcuanFzZmllbGQgeyAnICsKICAgICAgICAgICAgJ2NvbG9yOiB3aGl0ZTsnICsKICAgICAgICAgICAgJ2ZvbnQ6IDEwcHggYXJpYWwsIHNhbiBzZXJpZjsnICsKICAgICAgICAgICAgJ3RleHQtYWxpZ246IGxlZnQ7JyArCiAgICAgICAgICAgICd9JzsKCiAgICAvKioKICAgICAqIFV0aWxpdGllcwogICAgICovCgogICAgY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoLyogW2Jhc2VjbGFzcywgW21peGluLCAuLi5dXSwgZGVmaW5pdGlvbiAqLykgewogICAgICAgIHZhciBDbGFzcywgYXJnczsKICAgICAgICBDbGFzcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7CiAgICAgICAgfTsKICAgICAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgaWYgKGFyZ3VtZW50c1swXSkgewogICAgICAgICAgICAgICAgQ2xhc3MucHJvdG90eXBlID0gJC5leHRlbmQobmV3IGFyZ3VtZW50c1swXSgpLCBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdKTsKICAgICAgICAgICAgICAgIENsYXNzLl9zdXBlciA9IGFyZ3VtZW50c1swXS5wcm90b3R5cGU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBDbGFzcy5wcm90b3R5cGUgPSBhcmd1bWVudHNbYXJndW1lbnRzLmxlbmd0aCAtIDFdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSwgLTEpOwogICAgICAgICAgICAgICAgYXJncy51bnNoaWZ0KENsYXNzLnByb3RvdHlwZSk7CiAgICAgICAgICAgICAgICAkLmV4dGVuZC5hcHBseSgkLCBhcmdzKTsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIENsYXNzLnByb3RvdHlwZSA9IGFyZ3VtZW50c1swXTsKICAgICAgICB9CiAgICAgICAgQ2xhc3MucHJvdG90eXBlLmNscyA9IENsYXNzOwogICAgICAgIHJldHVybiBDbGFzczsKICAgIH07CgogICAgLyoqCiAgICAgKiBXcmFwcyBhIGZvcm1hdCBzdHJpbmcgZm9yIHRvb2x0aXBzCiAgICAgKiB7e3h9fQogICAgICoge3t4LjJ9CiAgICAgKiB7e3g6bW9udGhzfX0KICAgICAqLwogICAgJC5TUEZvcm1hdENsYXNzID0gU1BGb3JtYXQgPSBjcmVhdGVDbGFzcyh7CiAgICAgICAgZnJlOiAvXHtceyhbXHcuXSs/KSg6KC4rPykpP1x9XH0vZywKICAgICAgICBwcmVjcmU6IC8oXHcrKVwuKFxkKykvLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoZm9ybWF0LCBmY2xhc3MpIHsKICAgICAgICAgICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICAgICAgICAgIHRoaXMuZmNsYXNzID0gZmNsYXNzOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKGZpZWxkc2V0LCBsb29rdXBzLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBzZWxmID0gdGhpcywKICAgICAgICAgICAgICAgIGZpZWxkcyA9IGZpZWxkc2V0LAogICAgICAgICAgICAgICAgbWF0Y2gsIHRva2VuLCBsb29rdXBrZXksIGZpZWxkdmFsdWUsIHByZWM7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmZvcm1hdC5yZXBsYWNlKHRoaXMuZnJlLCBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgbG9va3VwOwogICAgICAgICAgICAgICAgdG9rZW4gPSBhcmd1bWVudHNbMV07CiAgICAgICAgICAgICAgICBsb29rdXBrZXkgPSBhcmd1bWVudHNbM107CiAgICAgICAgICAgICAgICBtYXRjaCA9IHNlbGYucHJlY3JlLmV4ZWModG9rZW4pOwogICAgICAgICAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICAgICAgICAgICAgcHJlYyA9IG1hdGNoWzJdOwogICAgICAgICAgICAgICAgICAgIHRva2VuID0gbWF0Y2hbMV07CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHByZWMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpZWxkdmFsdWUgPSBmaWVsZHNbdG9rZW5dOwogICAgICAgICAgICAgICAgaWYgKGZpZWxkdmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChsb29rdXBrZXkgJiYgbG9va3VwcyAmJiBsb29rdXBzW2xvb2t1cGtleV0pIHsKICAgICAgICAgICAgICAgICAgICBsb29rdXAgPSBsb29rdXBzW2xvb2t1cGtleV07CiAgICAgICAgICAgICAgICAgICAgaWYgKGxvb2t1cC5nZXQpIHsgLy8gUmFuZ2VNYXAKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGxvb2t1cHNbbG9va3Vwa2V5XS5nZXQoZmllbGR2YWx1ZSkgfHwgZmllbGR2YWx1ZTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9va3Vwc1tsb29rdXBrZXldW2ZpZWxkdmFsdWVdIHx8IGZpZWxkdmFsdWU7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGlzTnVtYmVyKGZpZWxkdmFsdWUpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdudW1iZXJGb3JtYXR0ZXInKSkgewogICAgICAgICAgICAgICAgICAgICAgICBmaWVsZHZhbHVlID0gb3B0aW9ucy5nZXQoJ251bWJlckZvcm1hdHRlcicpKGZpZWxkdmFsdWUpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpZWxkdmFsdWUgPSBmb3JtYXROdW1iZXIoZmllbGR2YWx1ZSwgcHJlYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdudW1iZXJEaWdpdEdyb3VwQ291bnQnKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdudW1iZXJEaWdpdEdyb3VwU2VwJyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbnVtYmVyRGVjaW1hbE1hcmsnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIGZpZWxkdmFsdWU7CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8vIGNvbnZpZW5jZSBtZXRob2QgdG8gYXZvaWQgbmVlZGluZyB0aGUgbmV3IG9wZXJhdG9yCiAgICAkLnNwZm9ybWF0ID0gZnVuY3Rpb24oZm9ybWF0LCBmY2xhc3MpIHsKICAgICAgICByZXR1cm4gbmV3IFNQRm9ybWF0KGZvcm1hdCwgZmNsYXNzKTsKICAgIH07CgogICAgY2xpcHZhbCA9IGZ1bmN0aW9uICh2YWwsIG1pbiwgbWF4KSB7CiAgICAgICAgaWYgKHZhbCA8IG1pbikgewogICAgICAgICAgICByZXR1cm4gbWluOwogICAgICAgIH0KICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICAgIHJldHVybiBtYXg7CiAgICAgICAgfQogICAgICAgIHJldHVybiB2YWw7CiAgICB9OwoKICAgIHF1YXJ0aWxlID0gZnVuY3Rpb24gKHZhbHVlcywgcSkgewogICAgICAgIHZhciB2bDsKICAgICAgICBpZiAocSA9PT0gMikgewogICAgICAgICAgICB2bCA9IE1hdGguZmxvb3IodmFsdWVzLmxlbmd0aCAvIDIpOwogICAgICAgICAgICByZXR1cm4gdmFsdWVzLmxlbmd0aCAlIDIgPyB2YWx1ZXNbdmxdIDogKHZhbHVlc1t2bC0xXSArIHZhbHVlc1t2bF0pIC8gMjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBpZiAodmFsdWVzLmxlbmd0aCAlIDIgKSB7IC8vIG9kZAogICAgICAgICAgICAgICAgdmwgPSAodmFsdWVzLmxlbmd0aCAqIHEgKyBxKSAvIDQ7CiAgICAgICAgICAgICAgICByZXR1cm4gdmwgJSAxID8gKHZhbHVlc1tNYXRoLmZsb29yKHZsKV0gKyB2YWx1ZXNbTWF0aC5mbG9vcih2bCkgLSAxXSkgLyAyIDogdmFsdWVzW3ZsLTFdOwogICAgICAgICAgICB9IGVsc2UgeyAvL2V2ZW4KICAgICAgICAgICAgICAgIHZsID0gKHZhbHVlcy5sZW5ndGggKiBxICsgMikgLyA0OwogICAgICAgICAgICAgICAgcmV0dXJuIHZsICUgMSA/ICh2YWx1ZXNbTWF0aC5mbG9vcih2bCldICsgdmFsdWVzW01hdGguZmxvb3IodmwpIC0gMV0pIC8gMiA6ICB2YWx1ZXNbdmwtMV07CgogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfTsKCiAgICBub3JtYWxpemVWYWx1ZSA9IGZ1bmN0aW9uICh2YWwpIHsKICAgICAgICB2YXIgbmY7CiAgICAgICAgc3dpdGNoICh2YWwpIHsKICAgICAgICAgICAgY2FzZSAndW5kZWZpbmVkJzoKICAgICAgICAgICAgICAgIHZhbCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlICdudWxsJzoKICAgICAgICAgICAgICAgIHZhbCA9IG51bGw7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAndHJ1ZSc6CiAgICAgICAgICAgICAgICB2YWwgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgJ2ZhbHNlJzoKICAgICAgICAgICAgICAgIHZhbCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBuZiA9IHBhcnNlRmxvYXQodmFsKTsKICAgICAgICAgICAgICAgIGlmICh2YWwgPT0gbmYpIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBuZjsKICAgICAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIHZhbDsKICAgIH07CgogICAgbm9ybWFsaXplVmFsdWVzID0gZnVuY3Rpb24gKHZhbHMpIHsKICAgICAgICB2YXIgaSwgcmVzdWx0ID0gW107CiAgICAgICAgZm9yIChpID0gdmFscy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgcmVzdWx0W2ldID0gbm9ybWFsaXplVmFsdWUodmFsc1tpXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwoKICAgIHJlbW92ZSA9IGZ1bmN0aW9uICh2YWxzLCBmaWx0ZXIpIHsKICAgICAgICB2YXIgaSwgdmwsIHJlc3VsdCA9IFtdOwogICAgICAgIGZvciAoaSA9IDAsIHZsID0gdmFscy5sZW5ndGg7IGkgPCB2bDsgaSsrKSB7CiAgICAgICAgICAgIGlmICh2YWxzW2ldICE9PSBmaWx0ZXIpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHZhbHNbaV0pOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9OwoKICAgIGlzTnVtYmVyID0gZnVuY3Rpb24gKG51bSkgewogICAgICAgIHJldHVybiAhaXNOYU4ocGFyc2VGbG9hdChudW0pKSAmJiBpc0Zpbml0ZShudW0pOwogICAgfTsKCiAgICBmb3JtYXROdW1iZXIgPSBmdW5jdGlvbiAobnVtLCBwcmVjLCBncm91cHNpemUsIGdyb3Vwc2VwLCBkZWNzZXApIHsKICAgICAgICB2YXIgcCwgaTsKICAgICAgICBudW0gPSAocHJlYyA9PT0gZmFsc2UgPyBwYXJzZUZsb2F0KG51bSkudG9TdHJpbmcoKSA6IG51bS50b0ZpeGVkKHByZWMpKS5zcGxpdCgnJyk7CiAgICAgICAgcCA9IChwID0gJC5pbkFycmF5KCcuJywgbnVtKSkgPCAwID8gbnVtLmxlbmd0aCA6IHA7CiAgICAgICAgaWYgKHAgPCBudW0ubGVuZ3RoKSB7CiAgICAgICAgICAgIG51bVtwXSA9IGRlY3NlcDsKICAgICAgICB9CiAgICAgICAgZm9yIChpID0gcCAtIGdyb3Vwc2l6ZTsgaSA+IDA7IGkgLT0gZ3JvdXBzaXplKSB7CiAgICAgICAgICAgIG51bS5zcGxpY2UoaSwgMCwgZ3JvdXBzZXApOwogICAgICAgIH0KICAgICAgICByZXR1cm4gbnVtLmpvaW4oJycpOwogICAgfTsKCiAgICAvLyBkZXRlcm1pbmUgaWYgYWxsIHZhbHVlcyBvZiBhbiBhcnJheSBtYXRjaCBhIHZhbHVlCiAgICAvLyByZXR1cm5zIHRydWUgaWYgdGhlIGFycmF5IGlzIGVtcHR5CiAgICBhbGwgPSBmdW5jdGlvbiAodmFsLCBhcnIsIGlnbm9yZU51bGwpIHsKICAgICAgICB2YXIgaTsKICAgICAgICBmb3IgKGkgPSBhcnIubGVuZ3RoOyBpLS07ICkgewogICAgICAgICAgICBpZiAoaWdub3JlTnVsbCAmJiBhcnJbaV0gPT09IG51bGwpIGNvbnRpbnVlOwogICAgICAgICAgICBpZiAoYXJyW2ldICE9PSB2YWwpIHsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgIH07CgogICAgLy8gc3VtcyB0aGUgbnVtZXJpYyB2YWx1ZXMgaW4gYW4gYXJyYXksIGlnbm9yaW5nIG90aGVyIHZhbHVlcwogICAgc3VtID0gZnVuY3Rpb24gKHZhbHMpIHsKICAgICAgICB2YXIgdG90YWwgPSAwLCBpOwogICAgICAgIGZvciAoaSA9IHZhbHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgIHRvdGFsICs9IHR5cGVvZiB2YWxzW2ldID09PSAnbnVtYmVyJyA/IHZhbHNbaV0gOiAwOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdG90YWw7CiAgICB9OwoKICAgIGVuc3VyZUFycmF5ID0gZnVuY3Rpb24gKHZhbCkgewogICAgICAgIHJldHVybiAkLmlzQXJyYXkodmFsKSA/IHZhbCA6IFt2YWxdOwogICAgfTsKCiAgICAvLyBodHRwOi8vcGF1bGlyaXNoLmNvbS8yMDA4L2Jvb2ttYXJrbGV0LWluamVjdC1uZXctY3NzLXJ1bGVzLwogICAgYWRkQ1NTID0gZnVuY3Rpb24oY3NzKSB7CiAgICAgICAgdmFyIHRhZzsKICAgICAgICAvL2lmICgnXHYnID09ICd2JykgLyogaWUgb25seSAqLyB7CiAgICAgICAgaWYgKGRvY3VtZW50LmNyZWF0ZVN0eWxlU2hlZXQpIHsKICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlU3R5bGVTaGVldCgpLmNzc1RleHQgPSBjc3M7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGFnID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICAgICAgdGFnLnR5cGUgPSAndGV4dC9jc3MnOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHRhZyk7CiAgICAgICAgICAgIHRhZ1sodHlwZW9mIGRvY3VtZW50LmJvZHkuc3R5bGUuV2Via2l0QXBwZWFyYW5jZSA9PSAnc3RyaW5nJykgLyogd2Via2l0IG9ubHkgKi8gPyAnaW5uZXJUZXh0JyA6ICdpbm5lckhUTUwnXSA9IGNzczsKICAgICAgICB9CiAgICB9OwoKICAgIC8vIFByb3ZpZGUgYSBjcm9zcy1icm93c2VyIGludGVyZmFjZSB0byBhIGZldyBzaW1wbGUgZHJhd2luZyBwcmltaXRpdmVzCiAgICAkLmZuLnNpbXBsZWRyYXcgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgdXNlRXhpc3RpbmcsIGludGVyYWN0KSB7CiAgICAgICAgdmFyIHRhcmdldCwgbWhhbmRsZXI7CiAgICAgICAgaWYgKHVzZUV4aXN0aW5nICYmICh0YXJnZXQgPSB0aGlzLmRhdGEoJ19qcXNfdmNhbnZhcycpKSkgewogICAgICAgICAgICByZXR1cm4gdGFyZ2V0OwogICAgICAgIH0KCiAgICAgICAgaWYgKCQuZm4uc3BhcmtsaW5lLmNhbnZhcyA9PT0gZmFsc2UpIHsKICAgICAgICAgICAgLy8gV2UndmUgYWxyZWFkeSBkZXRlcm1pbmVkIHRoYXQgbmVpdGhlciBDYW52YXMgbm9yIFZNTCBhcmUgYXZhaWxhYmxlCiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKCiAgICAgICAgfSBlbHNlIGlmICgkLmZuLnNwYXJrbGluZS5jYW52YXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAvLyBObyBmdW5jdGlvbiBkZWZpbmVkIHlldCAtLSBuZWVkIHRvIHNlZSBpZiB3ZSBzdXBwb3J0IENhbnZhcyBvciBWTUwKICAgICAgICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgICAgICAgIGlmICghIShlbC5nZXRDb250ZXh0ICYmIGVsLmdldENvbnRleHQoJzJkJykpKSB7CiAgICAgICAgICAgICAgICAvLyBDYW52YXMgaXMgYXZhaWxhYmxlCiAgICAgICAgICAgICAgICAkLmZuLnNwYXJrbGluZS5jYW52YXMgPSBmdW5jdGlvbih3aWR0aCwgaGVpZ2h0LCB0YXJnZXQsIGludGVyYWN0KSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBWQ2FudmFzX2NhbnZhcyh3aWR0aCwgaGVpZ2h0LCB0YXJnZXQsIGludGVyYWN0KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgIH0gZWxzZSBpZiAoZG9jdW1lbnQubmFtZXNwYWNlcyAmJiAhZG9jdW1lbnQubmFtZXNwYWNlcy52KSB7CiAgICAgICAgICAgICAgICAvLyBWTUwgaXMgYXZhaWxhYmxlCiAgICAgICAgICAgICAgICBkb2N1bWVudC5uYW1lc3BhY2VzLmFkZCgndicsICd1cm46c2NoZW1hcy1taWNyb3NvZnQtY29tOnZtbCcsICcjZGVmYXVsdCNWTUwnKTsKICAgICAgICAgICAgICAgICQuZm4uc3BhcmtsaW5lLmNhbnZhcyA9IGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQsIHRhcmdldCwgaW50ZXJhY3QpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFZDYW52YXNfdm1sKHdpZHRoLCBoZWlnaHQsIHRhcmdldCk7CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgLy8gTmVpdGhlciBDYW52YXMgbm9yIFZNTCBhcmUgYXZhaWxhYmxlCiAgICAgICAgICAgICAgICAkLmZuLnNwYXJrbGluZS5jYW52YXMgPSBmYWxzZTsKICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHdpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgd2lkdGggPSAkKHRoaXMpLmlubmVyV2lkdGgoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGhlaWdodCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGhlaWdodCA9ICQodGhpcykuaW5uZXJIZWlnaHQoKTsKICAgICAgICB9CgogICAgICAgIHRhcmdldCA9ICQuZm4uc3BhcmtsaW5lLmNhbnZhcyh3aWR0aCwgaGVpZ2h0LCB0aGlzLCBpbnRlcmFjdCk7CgogICAgICAgIG1oYW5kbGVyID0gJCh0aGlzKS5kYXRhKCdfanFzX21oYW5kbGVyJyk7CiAgICAgICAgaWYgKG1oYW5kbGVyKSB7CiAgICAgICAgICAgIG1oYW5kbGVyLnJlZ2lzdGVyQ2FudmFzKHRhcmdldCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9OwoKICAgICQuZm4uY2xlYXJkcmF3ID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLmRhdGEoJ19qcXNfdmNhbnZhcycpOwogICAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICAgICAgdGFyZ2V0LnJlc2V0KCk7CiAgICAgICAgfQogICAgfTsKCiAgICAkLlJhbmdlTWFwQ2xhc3MgPSBSYW5nZU1hcCA9IGNyZWF0ZUNsYXNzKHsKICAgICAgICBpbml0OiBmdW5jdGlvbiAobWFwKSB7CiAgICAgICAgICAgIHZhciBrZXksIHJhbmdlLCByYW5nZWxpc3QgPSBbXTsKICAgICAgICAgICAgZm9yIChrZXkgaW4gbWFwKSB7CiAgICAgICAgICAgICAgICBpZiAobWFwLmhhc093blByb3BlcnR5KGtleSkgJiYgdHlwZW9mIGtleSA9PT0gJ3N0cmluZycgJiYga2V5LmluZGV4T2YoJzonKSA+IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgcmFuZ2UgPSBrZXkuc3BsaXQoJzonKTsKICAgICAgICAgICAgICAgICAgICByYW5nZVswXSA9IHJhbmdlWzBdLmxlbmd0aCA9PT0gMCA/IC1JbmZpbml0eSA6IHBhcnNlRmxvYXQocmFuZ2VbMF0pOwogICAgICAgICAgICAgICAgICAgIHJhbmdlWzFdID0gcmFuZ2VbMV0ubGVuZ3RoID09PSAwID8gSW5maW5pdHkgOiBwYXJzZUZsb2F0KHJhbmdlWzFdKTsKICAgICAgICAgICAgICAgICAgICByYW5nZVsyXSA9IG1hcFtrZXldOwogICAgICAgICAgICAgICAgICAgIHJhbmdlbGlzdC5wdXNoKHJhbmdlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1hcCA9IG1hcDsKICAgICAgICAgICAgdGhpcy5yYW5nZWxpc3QgPSByYW5nZWxpc3QgfHwgZmFsc2U7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0OiBmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgdmFyIHJhbmdlbGlzdCA9IHRoaXMucmFuZ2VsaXN0LAogICAgICAgICAgICAgICAgaSwgcmFuZ2UsIHJlc3VsdDsKICAgICAgICAgICAgaWYgKChyZXN1bHQgPSB0aGlzLm1hcFt2YWx1ZV0pICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJhbmdlbGlzdCkgewogICAgICAgICAgICAgICAgZm9yIChpID0gcmFuZ2VsaXN0Lmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgICAgIHJhbmdlID0gcmFuZ2VsaXN0W2ldOwogICAgICAgICAgICAgICAgICAgIGlmIChyYW5nZVswXSA8PSB2YWx1ZSAmJiByYW5nZVsxXSA+PSB2YWx1ZSkgewogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmFuZ2VbMl07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gQ29udmVuaWVuY2UgZnVuY3Rpb24KICAgICQucmFuZ2VfbWFwID0gZnVuY3Rpb24obWFwKSB7CiAgICAgICAgcmV0dXJuIG5ldyBSYW5nZU1hcChtYXApOwogICAgfTsKCiAgICBNb3VzZUhhbmRsZXIgPSBjcmVhdGVDbGFzcyh7CiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCBvcHRpb25zKSB7CiAgICAgICAgICAgIHZhciAkZWwgPSAkKGVsKTsKICAgICAgICAgICAgdGhpcy4kZWwgPSAkZWw7CiAgICAgICAgICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gMDsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZVkgPSAwOwogICAgICAgICAgICB0aGlzLmVsID0gZWw7CiAgICAgICAgICAgIHRoaXMuc3BsaXN0ID0gW107CiAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IG51bGw7CiAgICAgICAgICAgIHRoaXMub3ZlciA9IGZhbHNlOwogICAgICAgICAgICB0aGlzLmRpc3BsYXlUb29sdGlwcyA9ICFvcHRpb25zLmdldCgnZGlzYWJsZVRvb2x0aXBzJyk7CiAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0RW5hYmxlZCA9ICFvcHRpb25zLmdldCgnZGlzYWJsZUhpZ2hsaWdodCcpOwogICAgICAgIH0sCgogICAgICAgIHJlZ2lzdGVyU3BhcmtsaW5lOiBmdW5jdGlvbiAoc3ApIHsKICAgICAgICAgICAgdGhpcy5zcGxpc3QucHVzaChzcCk7CiAgICAgICAgICAgIGlmICh0aGlzLm92ZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlRGlzcGxheSgpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgcmVnaXN0ZXJDYW52YXM6IGZ1bmN0aW9uIChjYW52YXMpIHsKICAgICAgICAgICAgdmFyICRjYW52YXMgPSAkKGNhbnZhcy5jYW52YXMpOwogICAgICAgICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhczsKICAgICAgICAgICAgdGhpcy4kY2FudmFzID0gJGNhbnZhczsKICAgICAgICAgICAgJGNhbnZhcy5tb3VzZWVudGVyKCQucHJveHkodGhpcy5tb3VzZWVudGVyLCB0aGlzKSk7CiAgICAgICAgICAgICRjYW52YXMubW91c2VsZWF2ZSgkLnByb3h5KHRoaXMubW91c2VsZWF2ZSwgdGhpcykpOwogICAgICAgICAgICAkY2FudmFzLmNsaWNrKCQucHJveHkodGhpcy5tb3VzZWNsaWNrLCB0aGlzKSk7CiAgICAgICAgfSwKCiAgICAgICAgcmVzZXQ6IGZ1bmN0aW9uIChyZW1vdmVUb29sdGlwKSB7CiAgICAgICAgICAgIHRoaXMuc3BsaXN0ID0gW107CiAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXAgJiYgcmVtb3ZlVG9vbHRpcCkgewogICAgICAgICAgICAgICAgdGhpcy50b29sdGlwLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgdGhpcy50b29sdGlwID0gdW5kZWZpbmVkOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgbW91c2VjbGljazogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdmFyIGNsaWNrRXZlbnQgPSAkLkV2ZW50KCdzcGFya2xpbmVDbGljaycpOwogICAgICAgICAgICBjbGlja0V2ZW50Lm9yaWdpbmFsRXZlbnQgPSBlOwogICAgICAgICAgICBjbGlja0V2ZW50LnNwYXJrbGluZXMgPSB0aGlzLnNwbGlzdDsKICAgICAgICAgICAgdGhpcy4kZWwudHJpZ2dlcihjbGlja0V2ZW50KTsKICAgICAgICB9LAoKICAgICAgICBtb3VzZWVudGVyOiBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLnVuYmluZCgnbW91c2Vtb3ZlLmpxcycpOwogICAgICAgICAgICAkKGRvY3VtZW50LmJvZHkpLmJpbmQoJ21vdXNlbW92ZS5qcXMnLCAkLnByb3h5KHRoaXMubW91c2Vtb3ZlLCB0aGlzKSk7CiAgICAgICAgICAgIHRoaXMub3ZlciA9IHRydWU7CiAgICAgICAgICAgIHRoaXMuY3VycmVudFBhZ2VYID0gZS5wYWdlWDsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZVkgPSBlLnBhZ2VZOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRFbCA9IGUudGFyZ2V0OwogICAgICAgICAgICBpZiAoIXRoaXMudG9vbHRpcCAmJiB0aGlzLmRpc3BsYXlUb29sdGlwcykgewogICAgICAgICAgICAgICAgdGhpcy50b29sdGlwID0gbmV3IFRvb2x0aXAodGhpcy5vcHRpb25zKTsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC51cGRhdGVQb3NpdGlvbihlLnBhZ2VYLCBlLnBhZ2VZKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnVwZGF0ZURpc3BsYXkoKTsKICAgICAgICB9LAoKICAgICAgICBtb3VzZWxlYXZlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICQoZG9jdW1lbnQuYm9keSkudW5iaW5kKCdtb3VzZW1vdmUuanFzJyk7CiAgICAgICAgICAgIHZhciBzcGxpc3QgPSB0aGlzLnNwbGlzdCwKICAgICAgICAgICAgICAgICBzcGNvdW50ID0gc3BsaXN0Lmxlbmd0aCwKICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSBmYWxzZSwKICAgICAgICAgICAgICAgICBzcCwgaTsKICAgICAgICAgICAgdGhpcy5vdmVyID0gZmFsc2U7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEVsID0gbnVsbDsKCiAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXApIHsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC5yZW1vdmUoKTsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHNwID0gc3BsaXN0W2ldOwogICAgICAgICAgICAgICAgaWYgKHNwLmNsZWFyUmVnaW9uSGlnaGxpZ2h0KCkpIHsKICAgICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSB0cnVlOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobmVlZHNSZWZyZXNoKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhcy5yZW5kZXIoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIG1vdXNlbW92ZTogZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UGFnZVggPSBlLnBhZ2VYOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRQYWdlWSA9IGUucGFnZVk7CiAgICAgICAgICAgIHRoaXMuY3VycmVudEVsID0gZS50YXJnZXQ7CiAgICAgICAgICAgIGlmICh0aGlzLnRvb2x0aXApIHsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC51cGRhdGVQb3NpdGlvbihlLnBhZ2VYLCBlLnBhZ2VZKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnVwZGF0ZURpc3BsYXkoKTsKICAgICAgICB9LAoKICAgICAgICB1cGRhdGVEaXNwbGF5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBzcGxpc3QgPSB0aGlzLnNwbGlzdCwKICAgICAgICAgICAgICAgICBzcGNvdW50ID0gc3BsaXN0Lmxlbmd0aCwKICAgICAgICAgICAgICAgICBuZWVkc1JlZnJlc2ggPSBmYWxzZSwKICAgICAgICAgICAgICAgICBvZmZzZXQgPSB0aGlzLiRjYW52YXMub2Zmc2V0KCksCiAgICAgICAgICAgICAgICAgbG9jYWxYID0gdGhpcy5jdXJyZW50UGFnZVggLSBvZmZzZXQubGVmdCwKICAgICAgICAgICAgICAgICBsb2NhbFkgPSB0aGlzLmN1cnJlbnRQYWdlWSAtIG9mZnNldC50b3AsCiAgICAgICAgICAgICAgICAgdG9vbHRpcGh0bWwsIHNwLCBpLCByZXN1bHQsIGNoYW5nZUV2ZW50OwogICAgICAgICAgICBpZiAoIXRoaXMub3ZlcikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzcGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHNwID0gc3BsaXN0W2ldOwogICAgICAgICAgICAgICAgcmVzdWx0ID0gc3Auc2V0UmVnaW9uSGlnaGxpZ2h0KHRoaXMuY3VycmVudEVsLCBsb2NhbFgsIGxvY2FsWSk7CiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgICAgICAgICAgICAgbmVlZHNSZWZyZXNoID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmVlZHNSZWZyZXNoKSB7CiAgICAgICAgICAgICAgICBjaGFuZ2VFdmVudCA9ICQuRXZlbnQoJ3NwYXJrbGluZVJlZ2lvbkNoYW5nZScpOwogICAgICAgICAgICAgICAgY2hhbmdlRXZlbnQuc3BhcmtsaW5lcyA9IHRoaXMuc3BsaXN0OwogICAgICAgICAgICAgICAgdGhpcy4kZWwudHJpZ2dlcihjaGFuZ2VFdmVudCk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy50b29sdGlwKSB7CiAgICAgICAgICAgICAgICAgICAgdG9vbHRpcGh0bWwgPSAnJzsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3Bjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNwID0gc3BsaXN0W2ldOwogICAgICAgICAgICAgICAgICAgICAgICB0b29sdGlwaHRtbCArPSBzcC5nZXRDdXJyZW50UmVnaW9uVG9vbHRpcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLnRvb2x0aXAuc2V0Q29udGVudCh0b29sdGlwaHRtbCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZUhpZ2hsaWdodCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzLnJlbmRlcigpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChyZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHRoaXMubW91c2VsZWF2ZSgpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgfSk7CgoKICAgIFRvb2x0aXAgPSBjcmVhdGVDbGFzcyh7CiAgICAgICAgc2l6ZVN0eWxlOiAncG9zaXRpb246IHN0YXRpYyAhaW1wb3J0YW50OycgKwogICAgICAgICAgICAnZGlzcGxheTogYmxvY2sgIWltcG9ydGFudDsnICsKICAgICAgICAgICAgJ3Zpc2liaWxpdHk6IGhpZGRlbiAhaW1wb3J0YW50OycgKwogICAgICAgICAgICAnZmxvYXQ6IGxlZnQgIWltcG9ydGFudDsnLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAob3B0aW9ucykgewogICAgICAgICAgICB2YXIgdG9vbHRpcENsYXNzbmFtZSA9IG9wdGlvbnMuZ2V0KCd0b29sdGlwQ2xhc3NuYW1lJywgJ2pxc3Rvb2x0aXAnKSwKICAgICAgICAgICAgICAgIHNpemV0aXBTdHlsZSA9IHRoaXMuc2l6ZVN0eWxlLAogICAgICAgICAgICAgICAgb2Zmc2V0OwogICAgICAgICAgICB0aGlzLmNvbnRhaW5lciA9IG9wdGlvbnMuZ2V0KCd0b29sdGlwQ29udGFpbmVyJykgfHwgZG9jdW1lbnQuYm9keTsKICAgICAgICAgICAgdGhpcy50b29sdGlwT2Zmc2V0WCA9IG9wdGlvbnMuZ2V0KCd0b29sdGlwT2Zmc2V0WCcsIDEwKTsKICAgICAgICAgICAgdGhpcy50b29sdGlwT2Zmc2V0WSA9IG9wdGlvbnMuZ2V0KCd0b29sdGlwT2Zmc2V0WScsIDEyKTsKICAgICAgICAgICAgLy8gcmVtb3ZlIGFueSBwcmV2aW91cyBsaW5nZXJpbmcgdG9vbHRpcAogICAgICAgICAgICAkKCcjanFzc2l6ZXRpcCcpLnJlbW92ZSgpOwogICAgICAgICAgICAkKCcjanFzdG9vbHRpcCcpLnJlbW92ZSgpOwogICAgICAgICAgICB0aGlzLnNpemV0aXAgPSAkKCc8ZGl2Lz4nLCB7CiAgICAgICAgICAgICAgICBpZDogJ2pxc3NpemV0aXAnLAogICAgICAgICAgICAgICAgc3R5bGU6IHNpemV0aXBTdHlsZSwKICAgICAgICAgICAgICAgICdjbGFzcyc6IHRvb2x0aXBDbGFzc25hbWUKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIHRoaXMudG9vbHRpcCA9ICQoJzxkaXYvPicsIHsKICAgICAgICAgICAgICAgIGlkOiAnanFzdG9vbHRpcCcsCiAgICAgICAgICAgICAgICAnY2xhc3MnOiB0b29sdGlwQ2xhc3NuYW1lCiAgICAgICAgICAgIH0pLmFwcGVuZFRvKHRoaXMuY29udGFpbmVyKTsKICAgICAgICAgICAgLy8gYWNjb3VudCBmb3IgdGhlIGNvbnRhaW5lcidzIGxvY2F0aW9uCiAgICAgICAgICAgIG9mZnNldCA9IHRoaXMudG9vbHRpcC5vZmZzZXQoKTsKICAgICAgICAgICAgdGhpcy5vZmZzZXRMZWZ0ID0gb2Zmc2V0LmxlZnQ7CiAgICAgICAgICAgIHRoaXMub2Zmc2V0VG9wID0gb2Zmc2V0LnRvcDsKICAgICAgICAgICAgdGhpcy5oaWRkZW4gPSB0cnVlOwogICAgICAgICAgICAkKHdpbmRvdykudW5iaW5kKCdyZXNpemUuanFzIHNjcm9sbC5qcXMnKTsKICAgICAgICAgICAgJCh3aW5kb3cpLmJpbmQoJ3Jlc2l6ZS5qcXMgc2Nyb2xsLmpxcycsICQucHJveHkodGhpcy51cGRhdGVXaW5kb3dEaW1zLCB0aGlzKSk7CiAgICAgICAgICAgIHRoaXMudXBkYXRlV2luZG93RGltcygpOwogICAgICAgIH0sCgogICAgICAgIHVwZGF0ZVdpbmRvd0RpbXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSAkKHdpbmRvdykuc2Nyb2xsVG9wKCk7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9ICQod2luZG93KS5zY3JvbGxMZWZ0KCk7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsUmlnaHQgPSB0aGlzLnNjcm9sbExlZnQgKyAkKHdpbmRvdykud2lkdGgoKTsKICAgICAgICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbigpOwogICAgICAgIH0sCgogICAgICAgIGdldFNpemU6IGZ1bmN0aW9uIChjb250ZW50KSB7CiAgICAgICAgICAgIHRoaXMuc2l6ZXRpcC5odG1sKGNvbnRlbnQpLmFwcGVuZFRvKHRoaXMuY29udGFpbmVyKTsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMuc2l6ZXRpcC53aWR0aCgpICsgMTsKICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLnNpemV0aXAuaGVpZ2h0KCk7CiAgICAgICAgICAgIHRoaXMuc2l6ZXRpcC5yZW1vdmUoKTsKICAgICAgICB9LAoKICAgICAgICBzZXRDb250ZW50OiBmdW5jdGlvbiAoY29udGVudCkgewogICAgICAgICAgICBpZiAoIWNvbnRlbnQpIHsKICAgICAgICAgICAgICAgIHRoaXMudG9vbHRpcC5jc3MoJ3Zpc2liaWxpdHknLCAnaGlkZGVuJyk7CiAgICAgICAgICAgICAgICB0aGlzLmhpZGRlbiA9IHRydWU7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5nZXRTaXplKGNvbnRlbnQpOwogICAgICAgICAgICB0aGlzLnRvb2x0aXAuaHRtbChjb250ZW50KQogICAgICAgICAgICAgICAgLmNzcyh7CiAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogdGhpcy53aWR0aCwKICAgICAgICAgICAgICAgICAgICAnaGVpZ2h0JzogdGhpcy5oZWlnaHQsCiAgICAgICAgICAgICAgICAgICAgJ3Zpc2liaWxpdHknOiAndmlzaWJsZScKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAodGhpcy5oaWRkZW4pIHsKICAgICAgICAgICAgICAgIHRoaXMuaGlkZGVuID0gZmFsc2U7CiAgICAgICAgICAgICAgICB0aGlzLnVwZGF0ZVBvc2l0aW9uKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICB1cGRhdGVQb3NpdGlvbjogZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICAgICAgaWYgKHggPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgaWYgKHRoaXMubW91c2V4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4ID0gdGhpcy5tb3VzZXggLSB0aGlzLm9mZnNldExlZnQ7CiAgICAgICAgICAgICAgICB5ID0gdGhpcy5tb3VzZXkgLSB0aGlzLm9mZnNldFRvcDsKCiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLm1vdXNleCA9IHggPSB4IC0gdGhpcy5vZmZzZXRMZWZ0OwogICAgICAgICAgICAgICAgdGhpcy5tb3VzZXkgPSB5ID0geSAtIHRoaXMub2Zmc2V0VG9wOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghdGhpcy5oZWlnaHQgfHwgIXRoaXMud2lkdGggfHwgdGhpcy5oaWRkZW4pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgeSAtPSB0aGlzLmhlaWdodCArIHRoaXMudG9vbHRpcE9mZnNldFk7CiAgICAgICAgICAgIHggKz0gdGhpcy50b29sdGlwT2Zmc2V0WDsKCiAgICAgICAgICAgIGlmICh5IDwgdGhpcy5zY3JvbGxUb3ApIHsKICAgICAgICAgICAgICAgIHkgPSB0aGlzLnNjcm9sbFRvcDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoeCA8IHRoaXMuc2Nyb2xsTGVmdCkgewogICAgICAgICAgICAgICAgeCA9IHRoaXMuc2Nyb2xsTGVmdDsKICAgICAgICAgICAgfSBlbHNlIGlmICh4ICsgdGhpcy53aWR0aCA+IHRoaXMuc2Nyb2xsUmlnaHQpIHsKICAgICAgICAgICAgICAgIHggPSB0aGlzLnNjcm9sbFJpZ2h0IC0gdGhpcy53aWR0aDsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy50b29sdGlwLmNzcyh7CiAgICAgICAgICAgICAgICAnbGVmdCc6IHgsCiAgICAgICAgICAgICAgICAndG9wJzogeQogICAgICAgICAgICB9KTsKICAgICAgICB9LAoKICAgICAgICByZW1vdmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy50b29sdGlwLnJlbW92ZSgpOwogICAgICAgICAgICB0aGlzLnNpemV0aXAucmVtb3ZlKCk7CiAgICAgICAgICAgIHRoaXMuc2l6ZXRpcCA9IHRoaXMudG9vbHRpcCA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgJCh3aW5kb3cpLnVuYmluZCgncmVzaXplLmpxcyBzY3JvbGwuanFzJyk7CiAgICAgICAgfQogICAgfSk7CgogICAgaW5pdFN0eWxlcyA9IGZ1bmN0aW9uKCkgewogICAgICAgIGFkZENTUyhkZWZhdWx0U3R5bGVzKTsKICAgIH07CgogICAgJChpbml0U3R5bGVzKTsKCiAgICBwZW5kaW5nID0gW107CiAgICAkLmZuLnNwYXJrbGluZSA9IGZ1bmN0aW9uICh1c2VyVmFsdWVzLCB1c2VyT3B0aW9ucykgewogICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IG5ldyAkLmZuLnNwYXJrbGluZS5vcHRpb25zKHRoaXMsIHVzZXJPcHRpb25zKSwKICAgICAgICAgICAgICAgICAkdGhpcyA9ICQodGhpcyksCiAgICAgICAgICAgICAgICAgcmVuZGVyLCBpOwogICAgICAgICAgICByZW5kZXIgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICB2YXIgdmFsdWVzLCB3aWR0aCwgaGVpZ2h0LCB0bXAsIG1oYW5kbGVyLCBzcCwgdmFsczsKICAgICAgICAgICAgICAgIGlmICh1c2VyVmFsdWVzID09PSAnaHRtbCcgfHwgdXNlclZhbHVlcyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgdmFscyA9IHRoaXMuZ2V0QXR0cmlidXRlKG9wdGlvbnMuZ2V0KCd0YWdWYWx1ZXNBdHRyaWJ1dGUnKSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHMgPT09IHVuZGVmaW5lZCB8fCB2YWxzID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHMgPSAkdGhpcy5odG1sKCk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhbHVlcyA9IHZhbHMucmVwbGFjZSgvKF5ccyo8IS0tKXwoLS0+XHMqJCl8XHMrL2csICcnKS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXMgPSB1c2VyVmFsdWVzOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIHdpZHRoID0gb3B0aW9ucy5nZXQoJ3dpZHRoJykgPT09ICdhdXRvJyA/IHZhbHVlcy5sZW5ndGggKiBvcHRpb25zLmdldCgnZGVmYXVsdFBpeGVsc1BlclZhbHVlJykgOiBvcHRpb25zLmdldCgnd2lkdGgnKTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnaGVpZ2h0JykgPT09ICdhdXRvJykgewogICAgICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5nZXQoJ2NvbXBvc2l0ZScpIHx8ICEkLmRhdGEodGhpcywgJ19qcXNfdmNhbnZhcycpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG11c3QgYmUgYSBiZXR0ZXIgd2F5IHRvIGdldCB0aGUgbGluZSBoZWlnaHQKICAgICAgICAgICAgICAgICAgICAgICAgdG1wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgICAgICAgICAgICAgICAgICAgICB0bXAuaW5uZXJIVE1MID0gJ2EnOwogICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5odG1sKHRtcCk7CiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9ICQodG1wKS5pbm5lckhlaWdodCgpIHx8ICQodG1wKS5oZWlnaHQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgJCh0bXApLnJlbW92ZSgpOwogICAgICAgICAgICAgICAgICAgICAgICB0bXAgPSBudWxsOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gb3B0aW9ucy5nZXQoJ2hlaWdodCcpOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5nZXQoJ2Rpc2FibGVJbnRlcmFjdGlvbicpKSB7CiAgICAgICAgICAgICAgICAgICAgbWhhbmRsZXIgPSAkLmRhdGEodGhpcywgJ19qcXNfbWhhbmRsZXInKTsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1oYW5kbGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIG1oYW5kbGVyID0gbmV3IE1vdXNlSGFuZGxlcih0aGlzLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5kYXRhKHRoaXMsICdfanFzX21oYW5kbGVyJywgbWhhbmRsZXIpOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoIW9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSkgewogICAgICAgICAgICAgICAgICAgICAgICBtaGFuZGxlci5yZXNldCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbWhhbmRsZXIgPSBmYWxzZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NvbXBvc2l0ZScpICYmICEkLmRhdGEodGhpcywgJ19qcXNfdmNhbnZhcycpKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCEkLmRhdGEodGhpcywgJ19qcXNfZXJybm90aWZ5JykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgYWxlcnQoJ0F0dGVtcHRlZCB0byBhdHRhY2ggYSBjb21wb3NpdGUgc3BhcmtsaW5lIHRvIGFuIGVsZW1lbnQgd2l0aCBubyBleGlzdGluZyBzcGFya2xpbmUnKTsKICAgICAgICAgICAgICAgICAgICAgICAgJC5kYXRhKHRoaXMsICdfanFzX2Vycm5vdGlmeScsIHRydWUpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgc3AgPSBuZXcgJC5mbi5zcGFya2xpbmVbb3B0aW9ucy5nZXQoJ3R5cGUnKV0odGhpcywgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTsKCiAgICAgICAgICAgICAgICBzcC5yZW5kZXIoKTsKCiAgICAgICAgICAgICAgICBpZiAobWhhbmRsZXIpIHsKICAgICAgICAgICAgICAgICAgICBtaGFuZGxlci5yZWdpc3RlclNwYXJrbGluZShzcCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGlmICgoJCh0aGlzKS5odG1sKCkgJiYgIW9wdGlvbnMuZ2V0KCdkaXNhYmxlSGlkZGVuQ2hlY2snKSAmJiAkKHRoaXMpLmlzKCc6aGlkZGVuJykpIHx8ICEkKHRoaXMpLnBhcmVudHMoJ2JvZHknKS5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIGlmICghb3B0aW9ucy5nZXQoJ2NvbXBvc2l0ZScpICYmICQuZGF0YSh0aGlzLCAnX2pxc19wZW5kaW5nJykpIHsKICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmUgYW55IGV4aXN0aW5nIHJlZmVyZW5jZXMgdG8gdGhlIGVsZW1lbnQKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSBwZW5kaW5nLmxlbmd0aDsgaTsgaS0tKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwZW5kaW5nW2kgLSAxXVswXSA9PSB0aGlzKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZW5kaW5nLnNwbGljZShpIC0gMSwgMSk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBwZW5kaW5nLnB1c2goW3RoaXMsIHJlbmRlcl0pOwogICAgICAgICAgICAgICAgJC5kYXRhKHRoaXMsICdfanFzX3BlbmRpbmcnLCB0cnVlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlbmRlci5jYWxsKHRoaXMpOwogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9OwoKICAgICQuZm4uc3BhcmtsaW5lLmRlZmF1bHRzID0gZ2V0RGVmYXVsdHMoKTsKCgogICAgJC5zcGFya2xpbmVfZGlzcGxheV92aXNpYmxlID0gZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBlbCwgaSwgcGw7CiAgICAgICAgdmFyIGRvbmUgPSBbXTsKICAgICAgICBmb3IgKGkgPSAwLCBwbCA9IHBlbmRpbmcubGVuZ3RoOyBpIDwgcGw7IGkrKykgewogICAgICAgICAgICBlbCA9IHBlbmRpbmdbaV1bMF07CiAgICAgICAgICAgIGlmICgkKGVsKS5pcygnOnZpc2libGUnKSAmJiAhJChlbCkucGFyZW50cygpLmlzKCc6aGlkZGVuJykpIHsKICAgICAgICAgICAgICAgIHBlbmRpbmdbaV1bMV0uY2FsbChlbCk7CiAgICAgICAgICAgICAgICAkLmRhdGEocGVuZGluZ1tpXVswXSwgJ19qcXNfcGVuZGluZycsIGZhbHNlKTsKICAgICAgICAgICAgICAgIGRvbmUucHVzaChpKTsKICAgICAgICAgICAgfSBlbHNlIGlmICghJChlbCkuY2xvc2VzdCgnaHRtbCcpLmxlbmd0aCAmJiAhJC5kYXRhKGVsLCAnX2pxc19wZW5kaW5nJykpIHsKICAgICAgICAgICAgICAgIC8vIGVsZW1lbnQgaGFzIGJlZW4gaW5zZXJ0ZWQgYW5kIHJlbW92ZWQgZnJvbSB0aGUgRE9NCiAgICAgICAgICAgICAgICAvLyBJZiBpdCB3YXMgbm90IHlldCBpbnNlcnRlZCBpbnRvIHRoZSBkb20gdGhlbiB0aGUgLmRhdGEgcmVxdWVzdAogICAgICAgICAgICAgICAgLy8gd2lsbCByZXR1cm4gdHJ1ZS4KICAgICAgICAgICAgICAgIC8vIHJlbW92aW5nIGZyb20gdGhlIGRvbSBjYXVzZXMgdGhlIGRhdGEgdG8gYmUgcmVtb3ZlZC4KICAgICAgICAgICAgICAgICQuZGF0YShwZW5kaW5nW2ldWzBdLCAnX2pxc19wZW5kaW5nJywgZmFsc2UpOwogICAgICAgICAgICAgICAgZG9uZS5wdXNoKGkpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IGRvbmUubGVuZ3RoOyBpOyBpLS0pIHsKICAgICAgICAgICAgcGVuZGluZy5zcGxpY2UoZG9uZVtpIC0gMV0sIDEpOwogICAgICAgIH0KICAgIH07CgoKICAgIC8qKgogICAgICogVXNlciBvcHRpb24gaGFuZGxlcgogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS5vcHRpb25zID0gY3JlYXRlQ2xhc3MoewogICAgICAgIGluaXQ6IGZ1bmN0aW9uICh0YWcsIHVzZXJPcHRpb25zKSB7CiAgICAgICAgICAgIHZhciBleHRlbmRlZE9wdGlvbnMsIGRlZmF1bHRzLCBiYXNlLCB0YWdPcHRpb25UeXBlOwogICAgICAgICAgICB0aGlzLnVzZXJPcHRpb25zID0gdXNlck9wdGlvbnMgPSB1c2VyT3B0aW9ucyB8fCB7fTsKICAgICAgICAgICAgdGhpcy50YWcgPSB0YWc7CiAgICAgICAgICAgIHRoaXMudGFnVmFsQ2FjaGUgPSB7fTsKICAgICAgICAgICAgZGVmYXVsdHMgPSAkLmZuLnNwYXJrbGluZS5kZWZhdWx0czsKICAgICAgICAgICAgYmFzZSA9IGRlZmF1bHRzLmNvbW1vbjsKICAgICAgICAgICAgdGhpcy50YWdPcHRpb25zUHJlZml4ID0gdXNlck9wdGlvbnMuZW5hYmxlVGFnT3B0aW9ucyAmJiAodXNlck9wdGlvbnMudGFnT3B0aW9uc1ByZWZpeCB8fCBiYXNlLnRhZ09wdGlvbnNQcmVmaXgpOwoKICAgICAgICAgICAgdGFnT3B0aW9uVHlwZSA9IHRoaXMuZ2V0VGFnU2V0dGluZygndHlwZScpOwogICAgICAgICAgICBpZiAodGFnT3B0aW9uVHlwZSA9PT0gVU5TRVRfT1BUSU9OKSB7CiAgICAgICAgICAgICAgICBleHRlbmRlZE9wdGlvbnMgPSBkZWZhdWx0c1t1c2VyT3B0aW9ucy50eXBlIHx8IGJhc2UudHlwZV07CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBleHRlbmRlZE9wdGlvbnMgPSBkZWZhdWx0c1t0YWdPcHRpb25UeXBlXTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1lcmdlZE9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgYmFzZSwgZXh0ZW5kZWRPcHRpb25zLCB1c2VyT3B0aW9ucyk7CiAgICAgICAgfSwKCgogICAgICAgIGdldFRhZ1NldHRpbmc6IGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgICAgdmFyIHByZWZpeCA9IHRoaXMudGFnT3B0aW9uc1ByZWZpeCwKICAgICAgICAgICAgICAgIHZhbCwgaSwgcGFpcnMsIGtleXZhbDsKICAgICAgICAgICAgaWYgKHByZWZpeCA9PT0gZmFsc2UgfHwgcHJlZml4ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJldHVybiBVTlNFVF9PUFRJT047CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMudGFnVmFsQ2FjaGUuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAgICAgICAgICAgdmFsID0gdGhpcy50YWdWYWxDYWNoZS5rZXk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YWwgPSB0aGlzLnRhZy5nZXRBdHRyaWJ1dGUocHJlZml4ICsga2V5KTsKICAgICAgICAgICAgICAgIGlmICh2YWwgPT09IHVuZGVmaW5lZCB8fCB2YWwgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBVTlNFVF9PUFRJT047CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHZhbC5zdWJzdHIoMCwgMSkgPT09ICdbJykgewogICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbC5zdWJzdHIoMSwgdmFsLmxlbmd0aCAtIDIpLnNwbGl0KCcsJyk7CiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gdmFsLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgICAgICAgICB2YWxbaV0gPSBub3JtYWxpemVWYWx1ZSh2YWxbaV0ucmVwbGFjZSgvKF5ccyopfChccyokKS9nLCAnJykpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsLnN1YnN0cigwLCAxKSA9PT0gJ3snKSB7CiAgICAgICAgICAgICAgICAgICAgcGFpcnMgPSB2YWwuc3Vic3RyKDEsIHZhbC5sZW5ndGggLSAyKS5zcGxpdCgnLCcpOwogICAgICAgICAgICAgICAgICAgIHZhbCA9IHt9OwogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IHBhaXJzLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgICAgICAgICBrZXl2YWwgPSBwYWlyc1tpXS5zcGxpdCgnOicsIDIpOwogICAgICAgICAgICAgICAgICAgICAgICB2YWxba2V5dmFsWzBdLnJlcGxhY2UoLyheXHMqKXwoXHMqJCkvZywgJycpXSA9IG5vcm1hbGl6ZVZhbHVlKGtleXZhbFsxXS5yZXBsYWNlKC8oXlxzKil8KFxzKiQpL2csICcnKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB2YWwgPSBub3JtYWxpemVWYWx1ZSh2YWwpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy50YWdWYWxDYWNoZS5rZXkgPSB2YWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHZhbDsKICAgICAgICB9LAoKICAgICAgICBnZXQ6IGZ1bmN0aW9uIChrZXksIGRlZmF1bHR2YWwpIHsKICAgICAgICAgICAgdmFyIHRhZ09wdGlvbiA9IHRoaXMuZ2V0VGFnU2V0dGluZyhrZXkpLAogICAgICAgICAgICAgICAgcmVzdWx0OwogICAgICAgICAgICBpZiAodGFnT3B0aW9uICE9PSBVTlNFVF9PUFRJT04pIHsKICAgICAgICAgICAgICAgIHJldHVybiB0YWdPcHRpb247CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgPSB0aGlzLm1lcmdlZE9wdGlvbnNba2V5XSkgPT09IHVuZGVmaW5lZCA/IGRlZmF1bHR2YWwgOiByZXN1bHQ7CiAgICAgICAgfQogICAgfSk7CgoKICAgICQuZm4uc3BhcmtsaW5lLl9iYXNlID0gY3JlYXRlQ2xhc3MoewogICAgICAgIGRpc2FibGVkOiBmYWxzZSwKCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgdGhpcy5lbCA9IGVsOwogICAgICAgICAgICB0aGlzLiRlbCA9ICQoZWwpOwogICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlczsKICAgICAgICAgICAgdGhpcy5vcHRpb25zID0gb3B0aW9uczsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVnaW9uID0gdW5kZWZpbmVkOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFNldHVwIHRoZSBjYW52YXMKICAgICAgICAgKi8KICAgICAgICBpbml0VGFyZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBpbnRlcmFjdGl2ZSA9ICF0aGlzLm9wdGlvbnMuZ2V0KCdkaXNhYmxlSW50ZXJhY3Rpb24nKTsKICAgICAgICAgICAgaWYgKCEodGhpcy50YXJnZXQgPSB0aGlzLiRlbC5zaW1wbGVkcmF3KHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0LCB0aGlzLm9wdGlvbnMuZ2V0KCdjb21wb3NpdGUnKSwgaW50ZXJhY3RpdmUpKSkgewogICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc1dpZHRoID0gdGhpcy50YXJnZXQucGl4ZWxXaWR0aDsKICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzSGVpZ2h0ID0gdGhpcy50YXJnZXQucGl4ZWxIZWlnaHQ7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBBY3R1YWxseSByZW5kZXIgdGhlIGNoYXJ0IHRvIHRoZSBjYW52YXMKICAgICAgICAgKi8KICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHsKICAgICAgICAgICAgICAgIHRoaXMuZWwuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmV0dXJuIGEgcmVnaW9uIGlkIGZvciBhIGdpdmVuIHgveSBjby1vcmRpbmF0ZQogICAgICAgICAqLwogICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKHgsIHkpIHsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBIaWdobGlnaHQgYW4gaXRlbSBiYXNlZCBvbiB0aGUgbW91c2VkLW92ZXIgeCx5IGNvLW9yZGluYXRlCiAgICAgICAgICovCiAgICAgICAgc2V0UmVnaW9uSGlnaGxpZ2h0OiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sCiAgICAgICAgICAgICAgICBoaWdobGlnaHRFbmFibGVkID0gIXRoaXMub3B0aW9ucy5nZXQoJ2Rpc2FibGVIaWdobGlnaHQnKSwKICAgICAgICAgICAgICAgIG5ld1JlZ2lvbjsKICAgICAgICAgICAgaWYgKHggPiB0aGlzLmNhbnZhc1dpZHRoIHx8IHkgPiB0aGlzLmNhbnZhc0hlaWdodCB8fCB4IDwgMCB8fCB5IDwgMCkgewogICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV3UmVnaW9uID0gdGhpcy5nZXRSZWdpb24oZWwsIHgsIHkpOwogICAgICAgICAgICBpZiAoY3VycmVudFJlZ2lvbiAhPT0gbmV3UmVnaW9uKSB7CiAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJlZ2lvbiAhPT0gdW5kZWZpbmVkICYmIGhpZ2hsaWdodEVuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUhpZ2hsaWdodCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50UmVnaW9uID0gbmV3UmVnaW9uOwogICAgICAgICAgICAgICAgaWYgKG5ld1JlZ2lvbiAhPT0gdW5kZWZpbmVkICYmIGhpZ2hsaWdodEVuYWJsZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbmRlckhpZ2hsaWdodCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFJlc2V0IGFueSBjdXJyZW50bHkgaGlnaGxpZ2h0ZWQgaXRlbQogICAgICAgICAqLwogICAgICAgIGNsZWFyUmVnaW9uSGlnaGxpZ2h0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRSZWdpb24gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVIaWdobGlnaHQoKTsKICAgICAgICAgICAgICAgIHRoaXMuY3VycmVudFJlZ2lvbiA9IHVuZGVmaW5lZDsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9LAoKICAgICAgICByZW5kZXJIaWdobGlnaHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdGhpcy5jaGFuZ2VIaWdobGlnaHQodHJ1ZSk7CiAgICAgICAgfSwKCiAgICAgICAgcmVtb3ZlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuY2hhbmdlSGlnaGxpZ2h0KGZhbHNlKTsKICAgICAgICB9LAoKICAgICAgICBjaGFuZ2VIaWdobGlnaHQ6IGZ1bmN0aW9uIChoaWdobGlnaHQpICB7fSwKCiAgICAgICAgLyoqCiAgICAgICAgICogRmV0Y2ggdGhlIEhUTUwgdG8gZGlzcGxheSBhcyBhIHRvb2x0aXAKICAgICAgICAgKi8KICAgICAgICBnZXRDdXJyZW50UmVnaW9uVG9vbHRpcDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIGhlYWRlciA9ICcnLAogICAgICAgICAgICAgICAgZW50cmllcyA9IFtdLAogICAgICAgICAgICAgICAgZmllbGRzLCBmb3JtYXRzLCBmb3JtYXRsZW4sIGZjbGFzcywgdGV4dCwgaSwKICAgICAgICAgICAgICAgIHNob3dGaWVsZHMsIHNob3dGaWVsZHNLZXksIG5ld0ZpZWxkcywgZnYsCiAgICAgICAgICAgICAgICBmb3JtYXR0ZXIsIGZvcm1hdCwgZmllbGRsZW4sIGo7CiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRSZWdpb24gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZpZWxkcyA9IHRoaXMuZ2V0Q3VycmVudFJlZ2lvbkZpZWxkcygpOwogICAgICAgICAgICBmb3JtYXR0ZXIgPSBvcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdHRlcicpOwogICAgICAgICAgICBpZiAoZm9ybWF0dGVyKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0dGVyKHRoaXMsIG9wdGlvbnMsIGZpZWxkcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCd0b29sdGlwQ2hhcnRUaXRsZScpKSB7CiAgICAgICAgICAgICAgICBoZWFkZXIgKz0gJzxkaXYgY2xhc3M9ImpxcyBqcXN0aXRsZSI+JyArIG9wdGlvbnMuZ2V0KCd0b29sdGlwQ2hhcnRUaXRsZScpICsgJzwvZGl2PlxuJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JtYXRzID0gdGhpcy5vcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdCcpOwogICAgICAgICAgICBpZiAoIWZvcm1hdHMpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJzsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoISQuaXNBcnJheShmb3JtYXRzKSkgewogICAgICAgICAgICAgICAgZm9ybWF0cyA9IFtmb3JtYXRzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoISQuaXNBcnJheShmaWVsZHMpKSB7CiAgICAgICAgICAgICAgICBmaWVsZHMgPSBbZmllbGRzXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzaG93RmllbGRzID0gdGhpcy5vcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdEZpZWxkbGlzdCcpOwogICAgICAgICAgICBzaG93RmllbGRzS2V5ID0gdGhpcy5vcHRpb25zLmdldCgndG9vbHRpcEZvcm1hdEZpZWxkbGlzdEtleScpOwogICAgICAgICAgICBpZiAoc2hvd0ZpZWxkcyAmJiBzaG93RmllbGRzS2V5KSB7CiAgICAgICAgICAgICAgICAvLyB1c2VyLXNlbGVjdGVkIG9yZGVyaW5nIG9mIGZpZWxkcwogICAgICAgICAgICAgICAgbmV3RmllbGRzID0gW107CiAgICAgICAgICAgICAgICBmb3IgKGkgPSBmaWVsZHMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICAgICAgZnYgPSBmaWVsZHNbaV1bc2hvd0ZpZWxkc0tleV07CiAgICAgICAgICAgICAgICAgICAgaWYgKChqID0gJC5pbkFycmF5KGZ2LCBzaG93RmllbGRzKSkgIT0gLTEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgbmV3RmllbGRzW2pdID0gZmllbGRzW2ldOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZpZWxkcyA9IG5ld0ZpZWxkczsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3JtYXRsZW4gPSBmb3JtYXRzLmxlbmd0aDsKICAgICAgICAgICAgZmllbGRsZW4gPSBmaWVsZHMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZm9ybWF0bGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGZvcm1hdCA9IGZvcm1hdHNbaV07CiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZvcm1hdCA9PT0gJ3N0cmluZycpIHsKICAgICAgICAgICAgICAgICAgICBmb3JtYXQgPSBuZXcgU1BGb3JtYXQoZm9ybWF0KTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGZjbGFzcyA9IGZvcm1hdC5mY2xhc3MgfHwgJ2pxc2ZpZWxkJzsKICAgICAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBmaWVsZGxlbjsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKCFmaWVsZHNbal0uaXNOdWxsIHx8ICFvcHRpb25zLmdldCgndG9vbHRpcFNraXBOdWxsJykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgJC5leHRlbmQoZmllbGRzW2pdLCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVmaXg6IG9wdGlvbnMuZ2V0KCd0b29sdGlwUHJlZml4JyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdWZmaXg6IG9wdGlvbnMuZ2V0KCd0b29sdGlwU3VmZml4JykKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSBmb3JtYXQucmVuZGVyKGZpZWxkc1tqXSwgb3B0aW9ucy5nZXQoJ3Rvb2x0aXBWYWx1ZUxvb2t1cHMnKSwgb3B0aW9ucyk7CiAgICAgICAgICAgICAgICAgICAgICAgIGVudHJpZXMucHVzaCgnPGRpdiBjbGFzcz0iJyArIGZjbGFzcyArICciPicgKyB0ZXh0ICsgJzwvZGl2PicpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZW50cmllcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHJldHVybiBoZWFkZXIgKyBlbnRyaWVzLmpvaW4oJ1xuJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHt9LAoKICAgICAgICBjYWxjSGlnaGxpZ2h0Q29sb3I6IGZ1bmN0aW9uIChjb2xvciwgb3B0aW9ucykgewogICAgICAgICAgICB2YXIgaGlnaGxpZ2h0Q29sb3IgPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0Q29sb3InKSwKICAgICAgICAgICAgICAgIGxpZ2h0ZW4gPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0TGlnaHRlbicpLAogICAgICAgICAgICAgICAgcGFyc2UsIG11bHQsIHJnYm5ldywgaTsKICAgICAgICAgICAgaWYgKGhpZ2hsaWdodENvbG9yKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gaGlnaGxpZ2h0Q29sb3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGxpZ2h0ZW4pIHsKICAgICAgICAgICAgICAgIC8vIGV4dHJhY3QgUkdCIHZhbHVlcwogICAgICAgICAgICAgICAgcGFyc2UgPSAvXiMoWzAtOWEtZl0pKFswLTlhLWZdKShbMC05YS1mXSkkL2kuZXhlYyhjb2xvcikgfHwgL14jKFswLTlhLWZdezJ9KShbMC05YS1mXXsyfSkoWzAtOWEtZl17Mn0pJC9pLmV4ZWMoY29sb3IpOwogICAgICAgICAgICAgICAgaWYgKHBhcnNlKSB7CiAgICAgICAgICAgICAgICAgICAgcmdibmV3ID0gW107CiAgICAgICAgICAgICAgICAgICAgbXVsdCA9IGNvbG9yLmxlbmd0aCA9PT0gNCA/IDE2IDogMTsKICAgICAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJnYm5ld1tpXSA9IGNsaXB2YWwoTWF0aC5yb3VuZChwYXJzZUludChwYXJzZVtpICsgMV0sIDE2KSAqIG11bHQgKiBsaWdodGVuKSwgMCwgMjU1KTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICdyZ2IoJyArIHJnYm5ldy5qb2luKCcsJykgKyAnKSc7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb2xvcjsKICAgICAgICB9CgogICAgfSk7CgogICAgYmFySGlnaGxpZ2h0TWl4aW4gPSB7CiAgICAgICAgY2hhbmdlSGlnaGxpZ2h0OiBmdW5jdGlvbiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uLAogICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGhpcy50YXJnZXQsCiAgICAgICAgICAgICAgICBzaGFwZWlkcyA9IHRoaXMucmVnaW9uU2hhcGVzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgbmV3U2hhcGVzOwogICAgICAgICAgICAvLyB3aWxsIGJlIG51bGwgaWYgdGhlIHJlZ2lvbiB2YWx1ZSB3YXMgbnVsbAogICAgICAgICAgICBpZiAoc2hhcGVpZHMpIHsKICAgICAgICAgICAgICAgIG5ld1NoYXBlcyA9IHRoaXMucmVuZGVyUmVnaW9uKGN1cnJlbnRSZWdpb24sIGhpZ2hsaWdodCk7CiAgICAgICAgICAgICAgICBpZiAoJC5pc0FycmF5KG5ld1NoYXBlcykgfHwgJC5pc0FycmF5KHNoYXBlaWRzKSkgewogICAgICAgICAgICAgICAgICAgIHRhcmdldC5yZXBsYWNlV2l0aFNoYXBlcyhzaGFwZWlkcywgbmV3U2hhcGVzKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnJlZ2lvblNoYXBlc1tjdXJyZW50UmVnaW9uXSA9ICQubWFwKG5ld1NoYXBlcywgZnVuY3Rpb24gKG5ld1NoYXBlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdTaGFwZS5pZDsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LnJlcGxhY2VXaXRoU2hhcGUoc2hhcGVpZHMsIG5ld1NoYXBlcyk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZWdpb25TaGFwZXNbY3VycmVudFJlZ2lvbl0gPSBuZXdTaGFwZXMuaWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMudmFsdWVzLAogICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGhpcy50YXJnZXQsCiAgICAgICAgICAgICAgICByZWdpb25TaGFwZXMgPSB0aGlzLnJlZ2lvblNoYXBlcywKICAgICAgICAgICAgICAgIHNoYXBlcywgaWRzLCBpLCBqOwoKICAgICAgICAgICAgaWYgKCF0aGlzLmNscy5fc3VwZXIucmVuZGVyLmNhbGwodGhpcykpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSB2YWx1ZXMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBzaGFwZXMgPSB0aGlzLnJlbmRlclJlZ2lvbihpKTsKICAgICAgICAgICAgICAgIGlmIChzaGFwZXMpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoJC5pc0FycmF5KHNoYXBlcykpIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWRzID0gW107CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoaiA9IHNoYXBlcy5sZW5ndGg7IGotLTspIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNoYXBlc1tqXS5hcHBlbmQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkcy5wdXNoKHNoYXBlc1tqXS5pZCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uU2hhcGVzW2ldID0gaWRzOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHNoYXBlcy5hcHBlbmQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmVnaW9uU2hhcGVzW2ldID0gc2hhcGVzLmlkOyAvLyBzdG9yZSBqdXN0IHRoZSBzaGFwZWlkCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBudWxsIHZhbHVlCiAgICAgICAgICAgICAgICAgICAgcmVnaW9uU2hhcGVzW2ldID0gbnVsbDsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0YXJnZXQucmVuZGVyKCk7CiAgICAgICAgfQogICAgfTsKCiAgICAvKioKICAgICAqIExpbmUgY2hhcnRzCiAgICAgKi8KICAgICQuZm4uc3BhcmtsaW5lLmxpbmUgPSBsaW5lID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIHsKICAgICAgICB0eXBlOiAnbGluZScsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIGxpbmUuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCBlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgICAgdGhpcy52ZXJ0aWNlcyA9IFtdOwogICAgICAgICAgICB0aGlzLnJlZ2lvbk1hcCA9IFtdOwogICAgICAgICAgICB0aGlzLnh2YWx1ZXMgPSBbXTsKICAgICAgICAgICAgdGhpcy55dmFsdWVzID0gW107CiAgICAgICAgICAgIHRoaXMueW1pbm1heCA9IFtdOwogICAgICAgICAgICB0aGlzLmhpZ2h0bGlnaHRTcG90SWQgPSBudWxsOwogICAgICAgICAgICB0aGlzLmxhc3RTaGFwZUlkID0gbnVsbDsKICAgICAgICAgICAgdGhpcy5pbml0VGFyZ2V0KCk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgdmFyIGksCiAgICAgICAgICAgICAgICByZWdpb25NYXAgPSB0aGlzLnJlZ2lvbk1hcDsgLy8gbWFwcyByZWdpb25zIHRvIHZhbHVlIHBvc2l0aW9ucwogICAgICAgICAgICBmb3IgKGkgPSByZWdpb25NYXAubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBpZiAocmVnaW9uTWFwW2ldICE9PSBudWxsICYmIHggPj0gcmVnaW9uTWFwW2ldWzBdICYmIHggPD0gcmVnaW9uTWFwW2ldWzFdKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlZ2lvbk1hcFtpXVsyXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb247CiAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBpc051bGw6IHRoaXMueXZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gbnVsbCwKICAgICAgICAgICAgICAgIHg6IHRoaXMueHZhbHVlc1tjdXJyZW50UmVnaW9uXSwKICAgICAgICAgICAgICAgIHk6IHRoaXMueXZhbHVlc1tjdXJyZW50UmVnaW9uXSwKICAgICAgICAgICAgICAgIGNvbG9yOiB0aGlzLm9wdGlvbnMuZ2V0KCdsaW5lQ29sb3InKSwKICAgICAgICAgICAgICAgIGZpbGxDb2xvcjogdGhpcy5vcHRpb25zLmdldCgnZmlsbENvbG9yJyksCiAgICAgICAgICAgICAgICBvZmZzZXQ6IGN1cnJlbnRSZWdpb24KICAgICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICByZW5kZXJIaWdobGlnaHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIHZlcnRleCA9IHRoaXMudmVydGljZXNbY3VycmVudFJlZ2lvbl0sCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgc3BvdFJhZGl1cyA9IG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksCiAgICAgICAgICAgICAgICBoaWdobGlnaHRTcG90Q29sb3IgPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0U3BvdENvbG9yJyksCiAgICAgICAgICAgICAgICBoaWdobGlnaHRMaW5lQ29sb3IgPSBvcHRpb25zLmdldCgnaGlnaGxpZ2h0TGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICBoaWdobGlnaHRTcG90LCBoaWdobGlnaHRMaW5lOwoKICAgICAgICAgICAgaWYgKCF2ZXJ0ZXgpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3BvdFJhZGl1cyAmJiBoaWdobGlnaHRTcG90Q29sb3IpIHsKICAgICAgICAgICAgICAgIGhpZ2hsaWdodFNwb3QgPSB0YXJnZXQuZHJhd0NpcmNsZSh2ZXJ0ZXhbMF0sIHZlcnRleFsxXSwKICAgICAgICAgICAgICAgICAgICBzcG90UmFkaXVzLCB1bmRlZmluZWQsIGhpZ2hsaWdodFNwb3RDb2xvcik7CiAgICAgICAgICAgICAgICB0aGlzLmhpZ2hsaWdodFNwb3RJZCA9IGhpZ2hsaWdodFNwb3QuaWQ7CiAgICAgICAgICAgICAgICB0YXJnZXQuaW5zZXJ0QWZ0ZXJTaGFwZSh0aGlzLmxhc3RTaGFwZUlkLCBoaWdobGlnaHRTcG90KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0TGluZUNvbG9yKSB7CiAgICAgICAgICAgICAgICBoaWdobGlnaHRMaW5lID0gdGFyZ2V0LmRyYXdMaW5lKHZlcnRleFswXSwgdGhpcy5jYW52YXNUb3AsIHZlcnRleFswXSwKICAgICAgICAgICAgICAgICAgICB0aGlzLmNhbnZhc1RvcCArIHRoaXMuY2FudmFzSGVpZ2h0LCBoaWdobGlnaHRMaW5lQ29sb3IpOwogICAgICAgICAgICAgICAgdGhpcy5oaWdobGlnaHRMaW5lSWQgPSBoaWdobGlnaHRMaW5lLmlkOwogICAgICAgICAgICAgICAgdGFyZ2V0Lmluc2VydEFmdGVyU2hhcGUodGhpcy5sYXN0U2hhcGVJZCwgaGlnaGxpZ2h0TGluZSk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICByZW1vdmVIaWdobGlnaHQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHRhcmdldCA9IHRoaXMudGFyZ2V0OwogICAgICAgICAgICBpZiAodGhpcy5oaWdobGlnaHRTcG90SWQpIHsKICAgICAgICAgICAgICAgIHRhcmdldC5yZW1vdmVTaGFwZUlkKHRoaXMuaGlnaGxpZ2h0U3BvdElkKTsKICAgICAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0U3BvdElkID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5oaWdobGlnaHRMaW5lSWQpIHsKICAgICAgICAgICAgICAgIHRhcmdldC5yZW1vdmVTaGFwZUlkKHRoaXMuaGlnaGxpZ2h0TGluZUlkKTsKICAgICAgICAgICAgICAgIHRoaXMuaGlnaGxpZ2h0TGluZUlkID0gbnVsbDsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIHNjYW5WYWx1ZXM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHZhbHVlcyA9IHRoaXMudmFsdWVzLAogICAgICAgICAgICAgICAgdmFsY291bnQgPSB2YWx1ZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgeHZhbHVlcyA9IHRoaXMueHZhbHVlcywKICAgICAgICAgICAgICAgIHl2YWx1ZXMgPSB0aGlzLnl2YWx1ZXMsCiAgICAgICAgICAgICAgICB5bWlubWF4ID0gdGhpcy55bWlubWF4LAogICAgICAgICAgICAgICAgaSwgdmFsLCBpc1N0ciwgaXNBcnJheSwgc3A7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YWwgPSB2YWx1ZXNbaV07CiAgICAgICAgICAgICAgICBpc1N0ciA9IHR5cGVvZih2YWx1ZXNbaV0pID09PSAnc3RyaW5nJzsKICAgICAgICAgICAgICAgIGlzQXJyYXkgPSB0eXBlb2YodmFsdWVzW2ldKSA9PT0gJ29iamVjdCcgJiYgdmFsdWVzW2ldIGluc3RhbmNlb2YgQXJyYXk7CiAgICAgICAgICAgICAgICBzcCA9IGlzU3RyICYmIHZhbHVlc1tpXS5zcGxpdCgnOicpOwogICAgICAgICAgICAgICAgaWYgKGlzU3RyICYmIHNwLmxlbmd0aCA9PT0gMikgeyAvLyB4OnkKICAgICAgICAgICAgICAgICAgICB4dmFsdWVzLnB1c2goTnVtYmVyKHNwWzBdKSk7CiAgICAgICAgICAgICAgICAgICAgeXZhbHVlcy5wdXNoKE51bWJlcihzcFsxXSkpOwogICAgICAgICAgICAgICAgICAgIHltaW5tYXgucHVzaChOdW1iZXIoc3BbMV0pKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoaXNBcnJheSkgewogICAgICAgICAgICAgICAgICAgIHh2YWx1ZXMucHVzaCh2YWxbMF0pOwogICAgICAgICAgICAgICAgICAgIHl2YWx1ZXMucHVzaCh2YWxbMV0pOwogICAgICAgICAgICAgICAgICAgIHltaW5tYXgucHVzaCh2YWxbMV0pOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICB4dmFsdWVzLnB1c2goaSk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlc1tpXSA9PT0gbnVsbCB8fCB2YWx1ZXNbaV0gPT09ICdudWxsJykgewogICAgICAgICAgICAgICAgICAgICAgICB5dmFsdWVzLnB1c2gobnVsbCk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgeXZhbHVlcy5wdXNoKE51bWJlcih2YWwpKTsKICAgICAgICAgICAgICAgICAgICAgICAgeW1pbm1heC5wdXNoKE51bWJlcih2YWwpKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5nZXQoJ3h2YWx1ZXMnKSkgewogICAgICAgICAgICAgICAgeHZhbHVlcyA9IHRoaXMub3B0aW9ucy5nZXQoJ3h2YWx1ZXMnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5tYXh5ID0gdGhpcy5tYXh5b3JnID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgeW1pbm1heCk7CiAgICAgICAgICAgIHRoaXMubWlueSA9IHRoaXMubWlueW9yZyA9IE1hdGgubWluLmFwcGx5KE1hdGgsIHltaW5tYXgpOwoKICAgICAgICAgICAgdGhpcy5tYXh4ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgeHZhbHVlcyk7CiAgICAgICAgICAgIHRoaXMubWlueCA9IE1hdGgubWluLmFwcGx5KE1hdGgsIHh2YWx1ZXMpOwoKICAgICAgICAgICAgdGhpcy54dmFsdWVzID0geHZhbHVlczsKICAgICAgICAgICAgdGhpcy55dmFsdWVzID0geXZhbHVlczsKICAgICAgICAgICAgdGhpcy55bWlubWF4ID0geW1pbm1heDsKCiAgICAgICAgfSwKCiAgICAgICAgcHJvY2Vzc1JhbmdlT3B0aW9uczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIG5vcm1hbFJhbmdlTWluID0gb3B0aW9ucy5nZXQoJ25vcm1hbFJhbmdlTWluJyksCiAgICAgICAgICAgICAgICBub3JtYWxSYW5nZU1heCA9IG9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1heCcpOwoKICAgICAgICAgICAgaWYgKG5vcm1hbFJhbmdlTWluICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGlmIChub3JtYWxSYW5nZU1pbiA8IHRoaXMubWlueSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMubWlueSA9IG5vcm1hbFJhbmdlTWluOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKG5vcm1hbFJhbmdlTWF4ID4gdGhpcy5tYXh5KSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5tYXh5ID0gbm9ybWFsUmFuZ2VNYXg7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSA8IHRoaXMubWlueSkpIHsKICAgICAgICAgICAgICAgIHRoaXMubWlueSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4JykgIT09IHVuZGVmaW5lZCAmJiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSA+IHRoaXMubWF4eSkpIHsKICAgICAgICAgICAgICAgIHRoaXMubWF4eSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluWCcpICE9PSB1bmRlZmluZWQgJiYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlQ2xpcFgnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pblgnKSA8IHRoaXMubWlueCkpIHsKICAgICAgICAgICAgICAgIHRoaXMubWlueCA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluWCcpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heFgnKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXBYJykgfHwgb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXhYJykgPiB0aGlzLm1heHgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1heHggPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heFgnKTsKICAgICAgICAgICAgfQoKICAgICAgICB9LAoKICAgICAgICBkcmF3Tm9ybWFsUmFuZ2U6IGZ1bmN0aW9uIChjYW52YXNMZWZ0LCBjYW52YXNUb3AsIGNhbnZhc0hlaWdodCwgY2FudmFzV2lkdGgsIHJhbmdleSkgewogICAgICAgICAgICB2YXIgbm9ybWFsUmFuZ2VNaW4gPSB0aGlzLm9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1pbicpLAogICAgICAgICAgICAgICAgbm9ybWFsUmFuZ2VNYXggPSB0aGlzLm9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1heCcpLAogICAgICAgICAgICAgICAgeXRvcCA9IGNhbnZhc1RvcCArIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gKGNhbnZhc0hlaWdodCAqICgobm9ybWFsUmFuZ2VNYXggLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5yb3VuZCgoY2FudmFzSGVpZ2h0ICogKG5vcm1hbFJhbmdlTWF4IC0gbm9ybWFsUmFuZ2VNaW4pKSAvIHJhbmdleSk7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0LmRyYXdSZWN0KGNhbnZhc0xlZnQsIHl0b3AsIGNhbnZhc1dpZHRoLCBoZWlnaHQsIHVuZGVmaW5lZCwgdGhpcy5vcHRpb25zLmdldCgnbm9ybWFsUmFuZ2VDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoID0gdGhpcy5jYW52YXNXaWR0aCwKICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0LAogICAgICAgICAgICAgICAgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzLAogICAgICAgICAgICAgICAgc3BvdFJhZGl1cyA9IG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksCiAgICAgICAgICAgICAgICByZWdpb25NYXAgPSB0aGlzLnJlZ2lvbk1hcCwKICAgICAgICAgICAgICAgIHJhbmdleCwgcmFuZ2V5LCB5dmFsbGFzdCwKICAgICAgICAgICAgICAgIGNhbnZhc1RvcCwgY2FudmFzTGVmdCwKICAgICAgICAgICAgICAgIHZlcnRleCwgcGF0aCwgcGF0aHMsIHgsIHksIHhuZXh0LCB4cG9zLCB4cG9zbmV4dCwKICAgICAgICAgICAgICAgIGxhc3QsIG5leHQsIHl2YWxjb3VudCwgbGluZVNoYXBlcywgZmlsbFNoYXBlcywgcGxlbiwKICAgICAgICAgICAgICAgIHZhbHVlU3BvdHMsIGhsU3BvdHNFbmFibGVkLCBjb2xvciwgeHZhbHVlcywgeXZhbHVlcywgaTsKCiAgICAgICAgICAgIGlmICghbGluZS5fc3VwZXIucmVuZGVyLmNhbGwodGhpcykpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zY2FuVmFsdWVzKCk7CiAgICAgICAgICAgIHRoaXMucHJvY2Vzc1JhbmdlT3B0aW9ucygpOwoKICAgICAgICAgICAgeHZhbHVlcyA9IHRoaXMueHZhbHVlczsKICAgICAgICAgICAgeXZhbHVlcyA9IHRoaXMueXZhbHVlczsKCiAgICAgICAgICAgIGlmICghdGhpcy55bWlubWF4Lmxlbmd0aCB8fCB0aGlzLnl2YWx1ZXMubGVuZ3RoIDwgMikgewogICAgICAgICAgICAgICAgLy8gZW1wdHkgb3IgYWxsIG51bGwgdmFsdWVzcwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjYW52YXNUb3AgPSBjYW52YXNMZWZ0ID0gMDsKCiAgICAgICAgICAgIHJhbmdleCA9IHRoaXMubWF4eCAtIHRoaXMubWlueCA9PT0gMCA/IDEgOiB0aGlzLm1heHggLSB0aGlzLm1pbng7CiAgICAgICAgICAgIHJhbmdleSA9IHRoaXMubWF4eSAtIHRoaXMubWlueSA9PT0gMCA/IDEgOiB0aGlzLm1heHkgLSB0aGlzLm1pbnk7CiAgICAgICAgICAgIHl2YWxsYXN0ID0gdGhpcy55dmFsdWVzLmxlbmd0aCAtIDE7CgogICAgICAgICAgICBpZiAoc3BvdFJhZGl1cyAmJiAoY2FudmFzV2lkdGggPCAoc3BvdFJhZGl1cyAqIDQpIHx8IGNhbnZhc0hlaWdodCA8IChzcG90UmFkaXVzICogNCkpKSB7CiAgICAgICAgICAgICAgICBzcG90UmFkaXVzID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc3BvdFJhZGl1cykgewogICAgICAgICAgICAgICAgLy8gYWRqdXN0IHRoZSBjYW52YXMgc2l6ZSBhcyByZXF1aXJlZCBzbyB0aGF0IHNwb3RzIHdpbGwgZml0CiAgICAgICAgICAgICAgICBobFNwb3RzRW5hYmxlZCA9IG9wdGlvbnMuZ2V0KCdoaWdobGlnaHRTcG90Q29sb3InKSAmJiAgIW9wdGlvbnMuZ2V0KCdkaXNhYmxlSW50ZXJhY3Rpb24nKTsKICAgICAgICAgICAgICAgIGlmIChobFNwb3RzRW5hYmxlZCB8fCBvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykgfHwgKG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSAmJiB5dmFsdWVzW3l2YWxsYXN0XSA9PT0gdGhpcy5taW55KSkgewogICAgICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCAtPSBNYXRoLmNlaWwoc3BvdFJhZGl1cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaGxTcG90c0VuYWJsZWQgfHwgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpIHx8IChvcHRpb25zLmdldCgnc3BvdENvbG9yJykgJiYgeXZhbHVlc1t5dmFsbGFzdF0gPT09IHRoaXMubWF4eSkpIHsKICAgICAgICAgICAgICAgICAgICBjYW52YXNIZWlnaHQgLT0gTWF0aC5jZWlsKHNwb3RSYWRpdXMpOwogICAgICAgICAgICAgICAgICAgIGNhbnZhc1RvcCArPSBNYXRoLmNlaWwoc3BvdFJhZGl1cyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAoaGxTcG90c0VuYWJsZWQgfHwKICAgICAgICAgICAgICAgICAgICAgKChvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykgfHwgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpKSAmJiAoeXZhbHVlc1swXSA9PT0gdGhpcy5taW55IHx8IHl2YWx1ZXNbMF0gPT09IHRoaXMubWF4eSkpKSB7CiAgICAgICAgICAgICAgICAgICAgY2FudmFzTGVmdCArPSBNYXRoLmNlaWwoc3BvdFJhZGl1cyk7CiAgICAgICAgICAgICAgICAgICAgY2FudmFzV2lkdGggLT0gTWF0aC5jZWlsKHNwb3RSYWRpdXMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKGhsU3BvdHNFbmFibGVkIHx8IG9wdGlvbnMuZ2V0KCdzcG90Q29sb3InKSB8fAogICAgICAgICAgICAgICAgICAgIChvcHRpb25zLmdldCgnbWluU3BvdENvbG9yJykgfHwgb3B0aW9ucy5nZXQoJ21heFNwb3RDb2xvcicpICYmCiAgICAgICAgICAgICAgICAgICAgICAgICh5dmFsdWVzW3l2YWxsYXN0XSA9PT0gdGhpcy5taW55IHx8IHl2YWx1ZXNbeXZhbGxhc3RdID09PSB0aGlzLm1heHkpKSkgewogICAgICAgICAgICAgICAgICAgIGNhbnZhc1dpZHRoIC09IE1hdGguY2VpbChzcG90UmFkaXVzKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKCiAgICAgICAgICAgIGNhbnZhc0hlaWdodC0tOwoKICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdub3JtYWxSYW5nZU1pbicpICE9PSB1bmRlZmluZWQgJiYgIW9wdGlvbnMuZ2V0KCdkcmF3Tm9ybWFsT25Ub3AnKSkgewogICAgICAgICAgICAgICAgdGhpcy5kcmF3Tm9ybWFsUmFuZ2UoY2FudmFzTGVmdCwgY2FudmFzVG9wLCBjYW52YXNIZWlnaHQsIGNhbnZhc1dpZHRoLCByYW5nZXkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBwYXRoID0gW107CiAgICAgICAgICAgIHBhdGhzID0gW3BhdGhdOwogICAgICAgICAgICBsYXN0ID0gbmV4dCA9IG51bGw7CiAgICAgICAgICAgIHl2YWxjb3VudCA9IHl2YWx1ZXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgeXZhbGNvdW50OyBpKyspIHsKICAgICAgICAgICAgICAgIHggPSB4dmFsdWVzW2ldOwogICAgICAgICAgICAgICAgeG5leHQgPSB4dmFsdWVzW2kgKyAxXTsKICAgICAgICAgICAgICAgIHkgPSB5dmFsdWVzW2ldOwogICAgICAgICAgICAgICAgeHBvcyA9IGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4IC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpOwogICAgICAgICAgICAgICAgeHBvc25leHQgPSBpIDwgeXZhbGNvdW50IC0gMSA/IGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4bmV4dCAtIHRoaXMubWlueCkgKiAoY2FudmFzV2lkdGggLyByYW5nZXgpKSA6IGNhbnZhc1dpZHRoOwogICAgICAgICAgICAgICAgbmV4dCA9IHhwb3MgKyAoKHhwb3NuZXh0IC0geHBvcykgLyAyKTsKICAgICAgICAgICAgICAgIHJlZ2lvbk1hcFtpXSA9IFtsYXN0IHx8IDAsIG5leHQsIGldOwogICAgICAgICAgICAgICAgbGFzdCA9IG5leHQ7CiAgICAgICAgICAgICAgICBpZiAoeSA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgIGlmIChpKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh5dmFsdWVzW2kgLSAxXSAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aCA9IFtdOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGF0aHMucHVzaChwYXRoKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICB2ZXJ0aWNlcy5wdXNoKG51bGwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPCB0aGlzLm1pbnkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHRoaXMubWlueTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKHkgPiB0aGlzLm1heHkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgeSA9IHRoaXMubWF4eTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgaWYgKCFwYXRoLmxlbmd0aCkgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBwcmV2aW91cyB2YWx1ZSB3YXMgbnVsbAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoLnB1c2goW3hwb3MsIGNhbnZhc1RvcCArIGNhbnZhc0hlaWdodF0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB2ZXJ0ZXggPSBbeHBvcywgY2FudmFzVG9wICsgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSAoY2FudmFzSGVpZ2h0ICogKCh5IC0gdGhpcy5taW55KSAvIHJhbmdleSkpKV07CiAgICAgICAgICAgICAgICAgICAgcGF0aC5wdXNoKHZlcnRleCk7CiAgICAgICAgICAgICAgICAgICAgdmVydGljZXMucHVzaCh2ZXJ0ZXgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICBsaW5lU2hhcGVzID0gW107CiAgICAgICAgICAgIGZpbGxTaGFwZXMgPSBbXTsKICAgICAgICAgICAgcGxlbiA9IHBhdGhzLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHBsZW47IGkrKykgewogICAgICAgICAgICAgICAgcGF0aCA9IHBhdGhzW2ldOwogICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG9wdGlvbnMuZ2V0KCdmaWxsQ29sb3InKSkgewogICAgICAgICAgICAgICAgICAgICAgICBwYXRoLnB1c2goW3BhdGhbcGF0aC5sZW5ndGggLSAxXVswXSwgKGNhbnZhc1RvcCArIGNhbnZhc0hlaWdodCldKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmlsbFNoYXBlcy5wdXNoKHBhdGguc2xpY2UoMCkpOwogICAgICAgICAgICAgICAgICAgICAgICBwYXRoLnBvcCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIG9ubHkgYSBzaW5nbGUgcG9pbnQgaW4gdGhpcyBwYXRoLCB0aGVuIHdlIHdhbnQgdG8gZGlzcGxheSBpdAogICAgICAgICAgICAgICAgICAgIC8vIGFzIGEgdmVydGljYWwgbGluZSB3aGljaCBtZWFucyB3ZSBrZWVwIHBhdGhbMF0gIGFzIGlzCiAgICAgICAgICAgICAgICAgICAgaWYgKHBhdGgubGVuZ3RoID4gMikgewogICAgICAgICAgICAgICAgICAgICAgICAvLyBlbHNlIHdlIHdhbnQgdGhlIGZpcnN0IHZhbHVlCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhbMF0gPSBbcGF0aFswXVswXSwgcGF0aFsxXVsxXV07CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGxpbmVTaGFwZXMucHVzaChwYXRoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgLy8gZHJhdyB0aGUgZmlsbCBmaXJzdCwgdGhlbiBvcHRpb25hbGx5IHRoZSBub3JtYWwgcmFuZ2UsIHRoZW4gdGhlIGxpbmUgb24gdG9wIG9mIHRoYXQKICAgICAgICAgICAgcGxlbiA9IGZpbGxTaGFwZXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd1NoYXBlKGZpbGxTaGFwZXNbaV0sCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2ZpbGxDb2xvcicpLCBvcHRpb25zLmdldCgnZmlsbENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ25vcm1hbFJhbmdlTWluJykgIT09IHVuZGVmaW5lZCAmJiBvcHRpb25zLmdldCgnZHJhd05vcm1hbE9uVG9wJykpIHsKICAgICAgICAgICAgICAgIHRoaXMuZHJhd05vcm1hbFJhbmdlKGNhbnZhc0xlZnQsIGNhbnZhc1RvcCwgY2FudmFzSGVpZ2h0LCBjYW52YXNXaWR0aCwgcmFuZ2V5KTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcGxlbiA9IGxpbmVTaGFwZXMubGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGxlbjsgaSsrKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd1NoYXBlKGxpbmVTaGFwZXNbaV0sIG9wdGlvbnMuZ2V0KCdsaW5lQ29sb3InKSwgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdsaW5lV2lkdGgnKSkuYXBwZW5kKCk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzcG90UmFkaXVzICYmIG9wdGlvbnMuZ2V0KCd2YWx1ZVNwb3RzJykpIHsKICAgICAgICAgICAgICAgIHZhbHVlU3BvdHMgPSBvcHRpb25zLmdldCgndmFsdWVTcG90cycpOwogICAgICAgICAgICAgICAgaWYgKHZhbHVlU3BvdHMuZ2V0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB2YWx1ZVNwb3RzID0gbmV3IFJhbmdlTWFwKHZhbHVlU3BvdHMpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHl2YWxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSB2YWx1ZVNwb3RzLmdldCh5dmFsdWVzW2ldKTsKICAgICAgICAgICAgICAgICAgICBpZiAoY29sb3IpIHsKICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0LmRyYXdDaXJjbGUoY2FudmFzTGVmdCArIE1hdGgucm91bmQoKHh2YWx1ZXNbaV0gLSB0aGlzLm1pbngpICogKGNhbnZhc1dpZHRoIC8gcmFuZ2V4KSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNUb3AgKyBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAtIChjYW52YXNIZWlnaHQgKiAoKHl2YWx1ZXNbaV0gLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3BvdFJhZGl1cywgdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3IpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHNwb3RSYWRpdXMgJiYgb3B0aW9ucy5nZXQoJ3Nwb3RDb2xvcicpICYmIHl2YWx1ZXNbeXZhbGxhc3RdICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShjYW52YXNMZWZ0ICsgTWF0aC5yb3VuZCgoeHZhbHVlc1t4dmFsdWVzLmxlbmd0aCAtIDFdIC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpLAogICAgICAgICAgICAgICAgICAgIGNhbnZhc1RvcCArIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gKGNhbnZhc0hlaWdodCAqICgoeXZhbHVlc1t5dmFsbGFzdF0gLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMsIHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnc3BvdENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLm1heHkgIT09IHRoaXMubWlueW9yZykgewogICAgICAgICAgICAgICAgaWYgKHNwb3RSYWRpdXMgJiYgb3B0aW9ucy5nZXQoJ21pblNwb3RDb2xvcicpKSB7CiAgICAgICAgICAgICAgICAgICAgeCA9IHh2YWx1ZXNbJC5pbkFycmF5KHRoaXMubWlueW9yZywgeXZhbHVlcyldOwogICAgICAgICAgICAgICAgICAgIHRhcmdldC5kcmF3Q2lyY2xlKGNhbnZhc0xlZnQgKyBNYXRoLnJvdW5kKCh4IC0gdGhpcy5taW54KSAqIChjYW52YXNXaWR0aCAvIHJhbmdleCkpLAogICAgICAgICAgICAgICAgICAgICAgICBjYW52YXNUb3AgKyBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAtIChjYW52YXNIZWlnaHQgKiAoKHRoaXMubWlueW9yZyAtIHRoaXMubWlueSkgLyByYW5nZXkpKSksCiAgICAgICAgICAgICAgICAgICAgICAgIHNwb3RSYWRpdXMsIHVuZGVmaW5lZCwKICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ21pblNwb3RDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzcG90UmFkaXVzICYmIG9wdGlvbnMuZ2V0KCdtYXhTcG90Q29sb3InKSkgewogICAgICAgICAgICAgICAgICAgIHggPSB4dmFsdWVzWyQuaW5BcnJheSh0aGlzLm1heHlvcmcsIHl2YWx1ZXMpXTsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShjYW52YXNMZWZ0ICsgTWF0aC5yb3VuZCgoeCAtIHRoaXMubWlueCkgKiAoY2FudmFzV2lkdGggLyByYW5nZXgpKSwKICAgICAgICAgICAgICAgICAgICAgICAgY2FudmFzVG9wICsgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSAoY2FudmFzSGVpZ2h0ICogKCh0aGlzLm1heHlvcmcgLSB0aGlzLm1pbnkpIC8gcmFuZ2V5KSkpLAogICAgICAgICAgICAgICAgICAgICAgICBzcG90UmFkaXVzLCB1bmRlZmluZWQsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdtYXhTcG90Q29sb3InKSkuYXBwZW5kKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMubGFzdFNoYXBlSWQgPSB0YXJnZXQuZ2V0TGFzdFNoYXBlSWQoKTsKICAgICAgICAgICAgdGhpcy5jYW52YXNUb3AgPSBjYW52YXNUb3A7CiAgICAgICAgICAgIHRhcmdldC5yZW5kZXIoKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvKioKICAgICAqIEJhciBjaGFydHMKICAgICAqLwogICAgJC5mbi5zcGFya2xpbmUuYmFyID0gYmFyID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIGJhckhpZ2hsaWdodE1peGluLCB7CiAgICAgICAgdHlwZTogJ2JhcicsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIHZhciBiYXJXaWR0aCA9IHBhcnNlSW50KG9wdGlvbnMuZ2V0KCdiYXJXaWR0aCcpLCAxMCksCiAgICAgICAgICAgICAgICBiYXJTcGFjaW5nID0gcGFyc2VJbnQob3B0aW9ucy5nZXQoJ2JhclNwYWNpbmcnKSwgMTApLAogICAgICAgICAgICAgICAgY2hhcnRSYW5nZU1pbiA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJyksCiAgICAgICAgICAgICAgICBjaGFydFJhbmdlTWF4ID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSwKICAgICAgICAgICAgICAgIGNoYXJ0UmFuZ2VDbGlwID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VDbGlwJyksCiAgICAgICAgICAgICAgICBzdGFja01pbiA9IEluZmluaXR5LAogICAgICAgICAgICAgICAgc3RhY2tNYXggPSAtSW5maW5pdHksCiAgICAgICAgICAgICAgICBpc1N0YWNrU3RyaW5nLCBncm91cE1pbiwgZ3JvdXBNYXgsIHN0YWNrUmFuZ2VzLAogICAgICAgICAgICAgICAgbnVtVmFsdWVzLCBpLCB2bGVuLCByYW5nZSwgemVyb0F4aXMsIHhheGlzT2Zmc2V0LCBtaW4sIG1heCwgY2xpcE1pbiwgY2xpcE1heCwKICAgICAgICAgICAgICAgIHN0YWNrZWQsIHZsaXN0LCBqLCBzbGVuLCBzdmFscywgdmFsLCB5b2Zmc2V0LCB5TWF4Q2FsYywgY2FudmFzSGVpZ2h0RWY7CiAgICAgICAgICAgIGJhci5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAgICAgLy8gc2NhbiB2YWx1ZXMgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdG8gc3RhY2sgYmFycwogICAgICAgICAgICBmb3IgKGkgPSAwLCB2bGVuID0gdmFsdWVzLmxlbmd0aDsgaSA8IHZsZW47IGkrKykgewogICAgICAgICAgICAgICAgdmFsID0gdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgaXNTdGFja1N0cmluZyA9IHR5cGVvZih2YWwpID09PSAnc3RyaW5nJyAmJiB2YWwuaW5kZXhPZignOicpID4gLTE7CiAgICAgICAgICAgICAgICBpZiAoaXNTdGFja1N0cmluZyB8fCAkLmlzQXJyYXkodmFsKSkgewogICAgICAgICAgICAgICAgICAgIHN0YWNrZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgICAgIGlmIChpc1N0YWNrU3RyaW5nKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbHVlc1tpXSA9IG5vcm1hbGl6ZVZhbHVlcyh2YWwuc3BsaXQoJzonKSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIHZhbCA9IHJlbW92ZSh2YWwsIG51bGwpOyAvLyBtaW4vbWF4IHdpbGwgdHJlYXQgbnVsbCBhcyB6ZXJvCiAgICAgICAgICAgICAgICAgICAgZ3JvdXBNaW4gPSBNYXRoLm1pbi5hcHBseShNYXRoLCB2YWwpOwogICAgICAgICAgICAgICAgICAgIGdyb3VwTWF4ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgdmFsKTsKICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBNaW4gPCBzdGFja01pbikgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFja01pbiA9IGdyb3VwTWluOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBpZiAoZ3JvdXBNYXggPiBzdGFja01heCkgewogICAgICAgICAgICAgICAgICAgICAgICBzdGFja01heCA9IGdyb3VwTWF4OwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy5zdGFja2VkID0gc3RhY2tlZDsKICAgICAgICAgICAgdGhpcy5yZWdpb25TaGFwZXMgPSB7fTsKICAgICAgICAgICAgdGhpcy5iYXJXaWR0aCA9IGJhcldpZHRoOwogICAgICAgICAgICB0aGlzLmJhclNwYWNpbmcgPSBiYXJTcGFjaW5nOwogICAgICAgICAgICB0aGlzLnRvdGFsQmFyV2lkdGggPSBiYXJXaWR0aCArIGJhclNwYWNpbmc7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aCA9ICh2YWx1ZXMubGVuZ3RoICogYmFyV2lkdGgpICsgKCh2YWx1ZXMubGVuZ3RoIC0gMSkgKiBiYXJTcGFjaW5nKTsKCiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpOwoKICAgICAgICAgICAgaWYgKGNoYXJ0UmFuZ2VDbGlwKSB7CiAgICAgICAgICAgICAgICBjbGlwTWluID0gY2hhcnRSYW5nZU1pbiA9PT0gdW5kZWZpbmVkID8gLUluZmluaXR5IDogY2hhcnRSYW5nZU1pbjsKICAgICAgICAgICAgICAgIGNsaXBNYXggPSBjaGFydFJhbmdlTWF4ID09PSB1bmRlZmluZWQgPyBJbmZpbml0eSA6IGNoYXJ0UmFuZ2VNYXg7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG51bVZhbHVlcyA9IFtdOwogICAgICAgICAgICBzdGFja1JhbmdlcyA9IHN0YWNrZWQgPyBbXSA6IG51bVZhbHVlczsKICAgICAgICAgICAgdmFyIHN0YWNrVG90YWxzID0gW107CiAgICAgICAgICAgIHZhciBzdGFja1Jhbmdlc05lZyA9IFtdOwogICAgICAgICAgICBmb3IgKGkgPSAwLCB2bGVuID0gdmFsdWVzLmxlbmd0aDsgaSA8IHZsZW47IGkrKykgewogICAgICAgICAgICAgICAgaWYgKHN0YWNrZWQpIHsKICAgICAgICAgICAgICAgICAgICB2bGlzdCA9IHZhbHVlc1tpXTsKICAgICAgICAgICAgICAgICAgICB2YWx1ZXNbaV0gPSBzdmFscyA9IFtdOwogICAgICAgICAgICAgICAgICAgIHN0YWNrVG90YWxzW2ldID0gMDsKICAgICAgICAgICAgICAgICAgICBzdGFja1Jhbmdlc1tpXSA9IHN0YWNrUmFuZ2VzTmVnW2ldID0gMDsKICAgICAgICAgICAgICAgICAgICBmb3IgKGogPSAwLCBzbGVuID0gdmxpc3QubGVuZ3RoOyBqIDwgc2xlbjsgaisrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbCA9IHN2YWxzW2pdID0gY2hhcnRSYW5nZUNsaXAgPyBjbGlwdmFsKHZsaXN0W2pdLCBjbGlwTWluLCBjbGlwTWF4KSA6IHZsaXN0W2pdOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YWNrVG90YWxzW2ldICs9IHZhbDsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdGFja01pbiA8IDAgJiYgc3RhY2tNYXggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCA8IDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhY2tSYW5nZXNOZWdbaV0gKz0gTWF0aC5hYnModmFsKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja1Jhbmdlc1tpXSArPSB2YWw7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFja1Jhbmdlc1tpXSArPSBNYXRoLmFicyh2YWwgLSAodmFsIDwgMCA/IHN0YWNrTWF4IDogc3RhY2tNaW4pKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bVZhbHVlcy5wdXNoKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHZhbCA9IGNoYXJ0UmFuZ2VDbGlwID8gY2xpcHZhbCh2YWx1ZXNbaV0sIGNsaXBNaW4sIGNsaXBNYXgpIDogdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgICAgIHZhbCA9IHZhbHVlc1tpXSA9IG5vcm1hbGl6ZVZhbHVlKHZhbCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbCAhPT0gbnVsbCkgewogICAgICAgICAgICAgICAgICAgICAgICBudW1WYWx1ZXMucHVzaCh2YWwpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1heCA9IG1heCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIG51bVZhbHVlcyk7CiAgICAgICAgICAgIHRoaXMubWluID0gbWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgbnVtVmFsdWVzKTsKICAgICAgICAgICAgdGhpcy5zdGFja01heCA9IHN0YWNrTWF4ID0gc3RhY2tlZCA/IE1hdGgubWF4LmFwcGx5KE1hdGgsIHN0YWNrVG90YWxzKSA6IG1heDsKICAgICAgICAgICAgdGhpcy5zdGFja01pbiA9IHN0YWNrTWluID0gc3RhY2tlZCA/IE1hdGgubWluLmFwcGx5KE1hdGgsIG51bVZhbHVlcykgOiBtaW47CgogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXAnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpIDwgbWluKSkgewogICAgICAgICAgICAgICAgbWluID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXAnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heCcpID4gbWF4KSkgewogICAgICAgICAgICAgICAgbWF4ID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdGhpcy56ZXJvQXhpcyA9IHplcm9BeGlzID0gb3B0aW9ucy5nZXQoJ3plcm9BeGlzJywgdHJ1ZSk7CiAgICAgICAgICAgIGlmIChtaW4gPD0gMCAmJiBtYXggPj0gMCAmJiB6ZXJvQXhpcykgewogICAgICAgICAgICAgICAgeGF4aXNPZmZzZXQgPSAwOwogICAgICAgICAgICB9IGVsc2UgaWYgKHplcm9BeGlzID09IGZhbHNlKSB7CiAgICAgICAgICAgICAgICB4YXhpc09mZnNldCA9IG1pbjsKICAgICAgICAgICAgfSBlbHNlIGlmIChtaW4gPiAwKSB7CiAgICAgICAgICAgICAgICB4YXhpc09mZnNldCA9IG1pbjsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHhheGlzT2Zmc2V0ID0gbWF4OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMueGF4aXNPZmZzZXQgPSB4YXhpc09mZnNldDsKCiAgICAgICAgICAgIHJhbmdlID0gc3RhY2tlZCA/IChNYXRoLm1heC5hcHBseShNYXRoLCBzdGFja1JhbmdlcykgKyBNYXRoLm1heC5hcHBseShNYXRoLCBzdGFja1Jhbmdlc05lZykpIDogbWF4IC0gbWluOwoKICAgICAgICAgICAgLy8gYXMgd2UgcGxvdCB6ZXJvL21pbiB2YWx1ZXMgYSBzaW5nbGUgcGl4ZWwgbGluZSwgd2UgYWRkIGEgcGl4ZWwgdG8gYWxsIG90aGVyCiAgICAgICAgICAgIC8vIHZhbHVlcyAtIFJlZHVjZSB0aGUgZWZmZWN0aXZlIGNhbnZhcyBzaXplIHRvIHN1aXQKICAgICAgICAgICAgdGhpcy5jYW52YXNIZWlnaHRFZiA9ICh6ZXJvQXhpcyAmJiBtaW4gPCAwKSA/IHRoaXMuY2FudmFzSGVpZ2h0IC0gMiA6IHRoaXMuY2FudmFzSGVpZ2h0IC0gMTsKCiAgICAgICAgICAgIGlmIChtaW4gPCB4YXhpc09mZnNldCkgewogICAgICAgICAgICAgICAgeU1heENhbGMgPSAoc3RhY2tlZCAmJiBtYXggPj0gMCkgPyBzdGFja01heCA6IG1heDsKICAgICAgICAgICAgICAgIHlvZmZzZXQgPSAoeU1heENhbGMgLSB4YXhpc09mZnNldCkgLyByYW5nZSAqIHRoaXMuY2FudmFzSGVpZ2h0OwogICAgICAgICAgICAgICAgaWYgKHlvZmZzZXQgIT09IE1hdGguY2VpbCh5b2Zmc2V0KSkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY2FudmFzSGVpZ2h0RWYgLT0gMjsKICAgICAgICAgICAgICAgICAgICB5b2Zmc2V0ID0gTWF0aC5jZWlsKHlvZmZzZXQpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgeW9mZnNldCA9IHRoaXMuY2FudmFzSGVpZ2h0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMueW9mZnNldCA9IHlvZmZzZXQ7CgogICAgICAgICAgICBpZiAoJC5pc0FycmF5KG9wdGlvbnMuZ2V0KCdjb2xvck1hcCcpKSkgewogICAgICAgICAgICAgICAgdGhpcy5jb2xvck1hcEJ5SW5kZXggPSBvcHRpb25zLmdldCgnY29sb3JNYXAnKTsKICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeVZhbHVlID0gbnVsbDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeUluZGV4ID0gbnVsbDsKICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeVZhbHVlID0gb3B0aW9ucy5nZXQoJ2NvbG9yTWFwJyk7CiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb2xvck1hcEJ5VmFsdWUgJiYgdGhpcy5jb2xvck1hcEJ5VmFsdWUuZ2V0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbG9yTWFwQnlWYWx1ZSA9IG5ldyBSYW5nZU1hcCh0aGlzLmNvbG9yTWFwQnlWYWx1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMucmFuZ2UgPSByYW5nZTsKICAgICAgICB9LAoKICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uIChlbCwgeCwgeSkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gTWF0aC5mbG9vcih4IC8gdGhpcy50b3RhbEJhcldpZHRoKTsKICAgICAgICAgICAgcmV0dXJuIChyZXN1bHQgPCAwIHx8IHJlc3VsdCA+PSB0aGlzLnZhbHVlcy5sZW5ndGgpID8gdW5kZWZpbmVkIDogcmVzdWx0OwogICAgICAgIH0sCgogICAgICAgIGdldEN1cnJlbnRSZWdpb25GaWVsZHM6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sCiAgICAgICAgICAgICAgICB2YWx1ZXMgPSBlbnN1cmVBcnJheSh0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSksCiAgICAgICAgICAgICAgICByZXN1bHQgPSBbXSwKICAgICAgICAgICAgICAgIHZhbHVlLCBpOwogICAgICAgICAgICBmb3IgKGkgPSB2YWx1ZXMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICB2YWx1ZSA9IHZhbHVlc1tpXTsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsKICAgICAgICAgICAgICAgICAgICBpc051bGw6IHZhbHVlID09PSBudWxsLAogICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZSwKICAgICAgICAgICAgICAgICAgICBjb2xvcjogdGhpcy5jYWxjQ29sb3IoaSwgdmFsdWUsIGN1cnJlbnRSZWdpb24pLAogICAgICAgICAgICAgICAgICAgIG9mZnNldDogY3VycmVudFJlZ2lvbgogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9LAoKICAgICAgICBjYWxjQ29sb3I6IGZ1bmN0aW9uIChzdGFja251bSwgdmFsdWUsIHZhbHVlbnVtKSB7CiAgICAgICAgICAgIHZhciBjb2xvck1hcEJ5SW5kZXggPSB0aGlzLmNvbG9yTWFwQnlJbmRleCwKICAgICAgICAgICAgICAgIGNvbG9yTWFwQnlWYWx1ZSA9IHRoaXMuY29sb3JNYXBCeVZhbHVlLAogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIGNvbG9yLCBuZXdDb2xvcjsKICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2tlZCkgewogICAgICAgICAgICAgICAgY29sb3IgPSBvcHRpb25zLmdldCgnc3RhY2tlZEJhckNvbG9yJyk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICBjb2xvciA9ICh2YWx1ZSA8IDApID8gb3B0aW9ucy5nZXQoJ25lZ0JhckNvbG9yJykgOiBvcHRpb25zLmdldCgnYmFyQ29sb3InKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodmFsdWUgPT09IDAgJiYgb3B0aW9ucy5nZXQoJ3plcm9Db2xvcicpICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3plcm9Db2xvcicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb2xvck1hcEJ5VmFsdWUgJiYgKG5ld0NvbG9yID0gY29sb3JNYXBCeVZhbHVlLmdldCh2YWx1ZSkpKSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IG5ld0NvbG9yOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbG9yTWFwQnlJbmRleCAmJiBjb2xvck1hcEJ5SW5kZXgubGVuZ3RoID4gdmFsdWVudW0pIHsKICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3JNYXBCeUluZGV4W3ZhbHVlbnVtXTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gJC5pc0FycmF5KGNvbG9yKSA/IGNvbG9yW3N0YWNrbnVtICUgY29sb3IubGVuZ3RoXSA6IGNvbG9yOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFJlbmRlciBiYXIocykgZm9yIGEgcmVnaW9uCiAgICAgICAgICovCiAgICAgICAgcmVuZGVyUmVnaW9uOiBmdW5jdGlvbiAodmFsdWVudW0sIGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgdmFscyA9IHRoaXMudmFsdWVzW3ZhbHVlbnVtXSwKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICB4YXhpc09mZnNldCA9IHRoaXMueGF4aXNPZmZzZXQsCiAgICAgICAgICAgICAgICByZXN1bHQgPSBbXSwKICAgICAgICAgICAgICAgIHJhbmdlID0gdGhpcy5yYW5nZSwKICAgICAgICAgICAgICAgIHN0YWNrZWQgPSB0aGlzLnN0YWNrZWQsCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIHggPSB2YWx1ZW51bSAqIHRoaXMudG90YWxCYXJXaWR0aCwKICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodEVmID0gdGhpcy5jYW52YXNIZWlnaHRFZiwKICAgICAgICAgICAgICAgIHlvZmZzZXQgPSB0aGlzLnlvZmZzZXQsCiAgICAgICAgICAgICAgICB5LCBoZWlnaHQsIGNvbG9yLCBpc051bGwsIHlvZmZzZXROZWcsIGksIHZhbGNvdW50LCB2YWwsIG1pblBsb3R0ZWQsIGFsbE1pbjsKCiAgICAgICAgICAgIHZhbHMgPSAkLmlzQXJyYXkodmFscykgPyB2YWxzIDogW3ZhbHNdOwogICAgICAgICAgICB2YWxjb3VudCA9IHZhbHMubGVuZ3RoOwogICAgICAgICAgICB2YWwgPSB2YWxzWzBdOwogICAgICAgICAgICBpc051bGwgPSBhbGwobnVsbCwgdmFscyk7CiAgICAgICAgICAgIGFsbE1pbiA9IGFsbCh4YXhpc09mZnNldCwgdmFscywgdHJ1ZSk7CgogICAgICAgICAgICBpZiAoaXNOdWxsKSB7CiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ251bGxDb2xvcicpKSB7CiAgICAgICAgICAgICAgICAgICAgY29sb3IgPSBoaWdobGlnaHQgPyBvcHRpb25zLmdldCgnbnVsbENvbG9yJykgOiB0aGlzLmNhbGNIaWdobGlnaHRDb2xvcihvcHRpb25zLmdldCgnbnVsbENvbG9yJyksIG9wdGlvbnMpOwogICAgICAgICAgICAgICAgICAgIHkgPSAoeW9mZnNldCA+IDApID8geW9mZnNldCAtIDEgOiB5b2Zmc2V0OwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuZHJhd1JlY3QoeCwgeSwgdGhpcy5iYXJXaWR0aCAtIDEsIDAsIGNvbG9yLCBjb2xvcik7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeW9mZnNldE5lZyA9IHlvZmZzZXQ7CiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2YWxjb3VudDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YWwgPSB2YWxzW2ldOwoKICAgICAgICAgICAgICAgIGlmIChzdGFja2VkICYmIHZhbCA9PT0geGF4aXNPZmZzZXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIWFsbE1pbiB8fCBtaW5QbG90dGVkKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICBtaW5QbG90dGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBpZiAocmFuZ2UgPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0ID0gTWF0aC5mbG9vcihjYW52YXNIZWlnaHRFZiAqICgoTWF0aC5hYnModmFsIC0geGF4aXNPZmZzZXQpIC8gcmFuZ2UpKSkgKyAxOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSAxOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHZhbCA8IHhheGlzT2Zmc2V0IHx8ICh2YWwgPT09IHhheGlzT2Zmc2V0ICYmIHlvZmZzZXQgPT09IDApKSB7CiAgICAgICAgICAgICAgICAgICAgeSA9IHlvZmZzZXROZWc7CiAgICAgICAgICAgICAgICAgICAgeW9mZnNldE5lZyArPSBoZWlnaHQ7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIHkgPSB5b2Zmc2V0IC0gaGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIHlvZmZzZXQgLT0gaGVpZ2h0OwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29sb3IgPSB0aGlzLmNhbGNDb2xvcihpLCB2YWwsIHZhbHVlbnVtKTsKICAgICAgICAgICAgICAgIGlmIChoaWdobGlnaHQpIHsKICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHRhcmdldC5kcmF3UmVjdCh4LCB5LCB0aGlzLmJhcldpZHRoIC0gMSwgaGVpZ2h0IC0gMSwgY29sb3IsIGNvbG9yKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPT09IDEpIHsKICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHRbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgICB9CiAgICB9KTsKCiAgICAvKioKICAgICAqIFRyaXN0YXRlIGNoYXJ0cwogICAgICovCiAgICAkLmZuLnNwYXJrbGluZS50cmlzdGF0ZSA9IHRyaXN0YXRlID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIGJhckhpZ2hsaWdodE1peGluLCB7CiAgICAgICAgdHlwZTogJ3RyaXN0YXRlJywKCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgdmFyIGJhcldpZHRoID0gcGFyc2VJbnQob3B0aW9ucy5nZXQoJ2JhcldpZHRoJyksIDEwKSwKICAgICAgICAgICAgICAgIGJhclNwYWNpbmcgPSBwYXJzZUludChvcHRpb25zLmdldCgnYmFyU3BhY2luZycpLCAxMCk7CiAgICAgICAgICAgIHRyaXN0YXRlLl9zdXBlci5pbml0LmNhbGwodGhpcywgZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICB0aGlzLnJlZ2lvblNoYXBlcyA9IHt9OwogICAgICAgICAgICB0aGlzLmJhcldpZHRoID0gYmFyV2lkdGg7CiAgICAgICAgICAgIHRoaXMuYmFyU3BhY2luZyA9IGJhclNwYWNpbmc7CiAgICAgICAgICAgIHRoaXMudG90YWxCYXJXaWR0aCA9IGJhcldpZHRoICsgYmFyU3BhY2luZzsKICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSAkLm1hcCh2YWx1ZXMsIE51bWJlcik7CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aCA9ICh2YWx1ZXMubGVuZ3RoICogYmFyV2lkdGgpICsgKCh2YWx1ZXMubGVuZ3RoIC0gMSkgKiBiYXJTcGFjaW5nKTsKCiAgICAgICAgICAgIGlmICgkLmlzQXJyYXkob3B0aW9ucy5nZXQoJ2NvbG9yTWFwJykpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmNvbG9yTWFwQnlJbmRleCA9IG9wdGlvbnMuZ2V0KCdjb2xvck1hcCcpOwogICAgICAgICAgICAgICAgdGhpcy5jb2xvck1hcEJ5VmFsdWUgPSBudWxsOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5jb2xvck1hcEJ5SW5kZXggPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5jb2xvck1hcEJ5VmFsdWUgPSBvcHRpb25zLmdldCgnY29sb3JNYXAnKTsKICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbG9yTWFwQnlWYWx1ZSAmJiB0aGlzLmNvbG9yTWFwQnlWYWx1ZS5nZXQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgICAgIHRoaXMuY29sb3JNYXBCeVZhbHVlID0gbmV3IFJhbmdlTWFwKHRoaXMuY29sb3JNYXBCeVZhbHVlKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmluaXRUYXJnZXQoKTsKICAgICAgICB9LAoKICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uIChlbCwgeCwgeSkgewogICAgICAgICAgICByZXR1cm4gTWF0aC5mbG9vcih4IC8gdGhpcy50b3RhbEJhcldpZHRoKTsKICAgICAgICB9LAoKICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaXNOdWxsOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgY29sb3I6IHRoaXMuY2FsY0NvbG9yKHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dLCBjdXJyZW50UmVnaW9uKSwKICAgICAgICAgICAgICAgIG9mZnNldDogY3VycmVudFJlZ2lvbgogICAgICAgICAgICB9OwogICAgICAgIH0sCgogICAgICAgIGNhbGNDb2xvcjogZnVuY3Rpb24gKHZhbHVlLCB2YWx1ZW51bSkgewogICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgY29sb3JNYXBCeUluZGV4ID0gdGhpcy5jb2xvck1hcEJ5SW5kZXgsCiAgICAgICAgICAgICAgICBjb2xvck1hcEJ5VmFsdWUgPSB0aGlzLmNvbG9yTWFwQnlWYWx1ZSwKICAgICAgICAgICAgICAgIGNvbG9yLCBuZXdDb2xvcjsKCiAgICAgICAgICAgIGlmIChjb2xvck1hcEJ5VmFsdWUgJiYgKG5ld0NvbG9yID0gY29sb3JNYXBCeVZhbHVlLmdldCh2YWx1ZSkpKSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IG5ld0NvbG9yOwogICAgICAgICAgICB9IGVsc2UgaWYgKGNvbG9yTWFwQnlJbmRleCAmJiBjb2xvck1hcEJ5SW5kZXgubGVuZ3RoID4gdmFsdWVudW0pIHsKICAgICAgICAgICAgICAgIGNvbG9yID0gY29sb3JNYXBCeUluZGV4W3ZhbHVlbnVtXTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZXNbdmFsdWVudW1dIDwgMCkgewogICAgICAgICAgICAgICAgY29sb3IgPSBvcHRpb25zLmdldCgnbmVnQmFyQ29sb3InKTsKICAgICAgICAgICAgfSBlbHNlIGlmICh2YWx1ZXNbdmFsdWVudW1dID4gMCkgewogICAgICAgICAgICAgICAgY29sb3IgPSBvcHRpb25zLmdldCgncG9zQmFyQ29sb3InKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3plcm9CYXJDb2xvcicpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBjb2xvcjsKICAgICAgICB9LAoKICAgICAgICByZW5kZXJSZWdpb246IGZ1bmN0aW9uICh2YWx1ZW51bSwgaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciB2YWx1ZXMgPSB0aGlzLnZhbHVlcywKICAgICAgICAgICAgICAgIG9wdGlvbnMgPSB0aGlzLm9wdGlvbnMsCiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCwgaGVpZ2h0LCBoYWxmSGVpZ2h0LAogICAgICAgICAgICAgICAgeCwgeSwgY29sb3I7CgogICAgICAgICAgICBjYW52YXNIZWlnaHQgPSB0YXJnZXQucGl4ZWxIZWlnaHQ7CiAgICAgICAgICAgIGhhbGZIZWlnaHQgPSBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDIpOwoKICAgICAgICAgICAgeCA9IHZhbHVlbnVtICogdGhpcy50b3RhbEJhcldpZHRoOwogICAgICAgICAgICBpZiAodmFsdWVzW3ZhbHVlbnVtXSA8IDApIHsKICAgICAgICAgICAgICAgIHkgPSBoYWxmSGVpZ2h0OwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGFsZkhlaWdodCAtIDE7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodmFsdWVzW3ZhbHVlbnVtXSA+IDApIHsKICAgICAgICAgICAgICAgIHkgPSAwOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gaGFsZkhlaWdodCAtIDE7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB5ID0gaGFsZkhlaWdodCAtIDE7CiAgICAgICAgICAgICAgICBoZWlnaHQgPSAyOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbG9yID0gdGhpcy5jYWxjQ29sb3IodmFsdWVzW3ZhbHVlbnVtXSwgdmFsdWVudW0pOwogICAgICAgICAgICBpZiAoY29sb3IgPT09IG51bGwpIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmRyYXdSZWN0KHgsIHksIHRoaXMuYmFyV2lkdGggLSAxLCBoZWlnaHQgLSAxLCBjb2xvciwgY29sb3IpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8qKgogICAgICogRGlzY3JldGUgY2hhcnRzCiAgICAgKi8KICAgICQuZm4uc3BhcmtsaW5lLmRpc2NyZXRlID0gZGlzY3JldGUgPSBjcmVhdGVDbGFzcygkLmZuLnNwYXJrbGluZS5fYmFzZSwgYmFySGlnaGxpZ2h0TWl4aW4sIHsKICAgICAgICB0eXBlOiAnZGlzY3JldGUnLAoKICAgICAgICBpbml0OiBmdW5jdGlvbiAoZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCkgewogICAgICAgICAgICBkaXNjcmV0ZS5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAgICAgdGhpcy5yZWdpb25TaGFwZXMgPSB7fTsKICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMgPSAkLm1hcCh2YWx1ZXMsIE51bWJlcik7CiAgICAgICAgICAgIHRoaXMubWluID0gTWF0aC5taW4uYXBwbHkoTWF0aCwgdmFsdWVzKTsKICAgICAgICAgICAgdGhpcy5tYXggPSBNYXRoLm1heC5hcHBseShNYXRoLCB2YWx1ZXMpOwogICAgICAgICAgICB0aGlzLnJhbmdlID0gdGhpcy5tYXggLSB0aGlzLm1pbjsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoID0gb3B0aW9ucy5nZXQoJ3dpZHRoJykgPT09ICdhdXRvJyA/IHZhbHVlcy5sZW5ndGggKiAyIDogdGhpcy53aWR0aDsKICAgICAgICAgICAgdGhpcy5pbnRlcnZhbCA9IE1hdGguZmxvb3Iod2lkdGggLyB2YWx1ZXMubGVuZ3RoKTsKICAgICAgICAgICAgdGhpcy5pdGVtV2lkdGggPSB3aWR0aCAvIHZhbHVlcy5sZW5ndGg7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpICE9PSB1bmRlZmluZWQgJiYgKG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlQ2xpcCcpIHx8IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJykgPCB0aGlzLm1pbikpIHsKICAgICAgICAgICAgICAgIHRoaXMubWluID0gb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNaW4nKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSAhPT0gdW5kZWZpbmVkICYmIChvcHRpb25zLmdldCgnY2hhcnRSYW5nZUNsaXAnKSB8fCBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heCcpID4gdGhpcy5tYXgpKSB7CiAgICAgICAgICAgICAgICB0aGlzLm1heCA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWF4Jyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5pbml0VGFyZ2V0KCk7CiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldCkgewogICAgICAgICAgICAgICAgdGhpcy5saW5lSGVpZ2h0ID0gb3B0aW9ucy5nZXQoJ2xpbmVIZWlnaHQnKSA9PT0gJ2F1dG8nID8gTWF0aC5yb3VuZCh0aGlzLmNhbnZhc0hlaWdodCAqIDAuMykgOiBvcHRpb25zLmdldCgnbGluZUhlaWdodCcpOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgcmV0dXJuIE1hdGguZmxvb3IoeCAvIHRoaXMuaXRlbVdpZHRoKTsKICAgICAgICB9LAoKICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaXNOdWxsOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgb2Zmc2V0OiBjdXJyZW50UmVnaW9uCiAgICAgICAgICAgIH07CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyUmVnaW9uOiBmdW5jdGlvbiAodmFsdWVudW0sIGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgdmFsdWVzID0gdGhpcy52YWx1ZXMsCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgbWluID0gdGhpcy5taW4sCiAgICAgICAgICAgICAgICBtYXggPSB0aGlzLm1heCwKICAgICAgICAgICAgICAgIHJhbmdlID0gdGhpcy5yYW5nZSwKICAgICAgICAgICAgICAgIGludGVydmFsID0gdGhpcy5pbnRlcnZhbCwKICAgICAgICAgICAgICAgIHRhcmdldCA9IHRoaXMudGFyZ2V0LAogICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0ID0gdGhpcy5jYW52YXNIZWlnaHQsCiAgICAgICAgICAgICAgICBsaW5lSGVpZ2h0ID0gdGhpcy5saW5lSGVpZ2h0LAogICAgICAgICAgICAgICAgcGhlaWdodCA9IGNhbnZhc0hlaWdodCAtIGxpbmVIZWlnaHQsCiAgICAgICAgICAgICAgICB5dG9wLCB2YWwsIGNvbG9yLCB4OwoKICAgICAgICAgICAgdmFsID0gY2xpcHZhbCh2YWx1ZXNbdmFsdWVudW1dLCBtaW4sIG1heCk7CiAgICAgICAgICAgIHggPSB2YWx1ZW51bSAqIGludGVydmFsOwogICAgICAgICAgICB5dG9wID0gTWF0aC5yb3VuZChwaGVpZ2h0IC0gcGhlaWdodCAqICgodmFsIC0gbWluKSAvIHJhbmdlKSk7CiAgICAgICAgICAgIGNvbG9yID0gKG9wdGlvbnMuZ2V0KCd0aHJlc2hvbGRDb2xvcicpICYmIHZhbCA8IG9wdGlvbnMuZ2V0KCd0aHJlc2hvbGRWYWx1ZScpKSA/IG9wdGlvbnMuZ2V0KCd0aHJlc2hvbGRDb2xvcicpIDogb3B0aW9ucy5nZXQoJ2xpbmVDb2xvcicpOwogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gdGFyZ2V0LmRyYXdMaW5lKHgsIHl0b3AsIHgsIHl0b3AgKyBsaW5lSGVpZ2h0LCBjb2xvcik7CiAgICAgICAgfQogICAgfSk7CgogICAgLyoqCiAgICAgKiBCdWxsZXQgY2hhcnRzCiAgICAgKi8KICAgICQuZm4uc3BhcmtsaW5lLmJ1bGxldCA9IGJ1bGxldCA9IGNyZWF0ZUNsYXNzKCQuZm4uc3BhcmtsaW5lLl9iYXNlLCB7CiAgICAgICAgdHlwZTogJ2J1bGxldCcsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIHZhciBtaW4sIG1heCwgdmFsczsKICAgICAgICAgICAgYnVsbGV0Ll9zdXBlci5pbml0LmNhbGwodGhpcywgZWwsIHZhbHVlcywgb3B0aW9ucywgd2lkdGgsIGhlaWdodCk7CgogICAgICAgICAgICAvLyB2YWx1ZXM6IHRhcmdldCwgcGVyZm9ybWFuY2UsIHJhbmdlMSwgcmFuZ2UyLCByYW5nZTMKICAgICAgICAgICAgdGhpcy52YWx1ZXMgPSB2YWx1ZXMgPSBub3JtYWxpemVWYWx1ZXModmFsdWVzKTsKICAgICAgICAgICAgLy8gdGFyZ2V0IG9yIHBlcmZvcm1hbmNlIGNvdWxkIGJlIG51bGwKICAgICAgICAgICAgdmFscyA9IHZhbHVlcy5zbGljZSgpOwogICAgICAgICAgICB2YWxzWzBdID0gdmFsc1swXSA9PT0gbnVsbCA/IHZhbHNbMl0gOiB2YWxzWzBdOwogICAgICAgICAgICB2YWxzWzFdID0gdmFsdWVzWzFdID09PSBudWxsID8gdmFsc1syXSA6IHZhbHNbMV07CiAgICAgICAgICAgIG1pbiA9IE1hdGgubWluLmFwcGx5KE1hdGgsIHZhbHVlcyk7CiAgICAgICAgICAgIG1heCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIHZhbHVlcyk7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnYmFzZScpID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIG1pbiA9IG1pbiA8IDAgPyBtaW4gOiAwOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgbWluID0gb3B0aW9ucy5nZXQoJ2Jhc2UnKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm1pbiA9IG1pbjsKICAgICAgICAgICAgdGhpcy5tYXggPSBtYXg7CiAgICAgICAgICAgIHRoaXMucmFuZ2UgPSBtYXggLSBtaW47CiAgICAgICAgICAgIHRoaXMuc2hhcGVzID0ge307CiAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXMgPSB7fTsKICAgICAgICAgICAgdGhpcy5yZWdpb25kYXRhID0ge307CiAgICAgICAgICAgIHRoaXMud2lkdGggPSB3aWR0aCA9IG9wdGlvbnMuZ2V0KCd3aWR0aCcpID09PSAnYXV0bycgPyAnNC4wZW0nIDogd2lkdGg7CiAgICAgICAgICAgIHRoaXMudGFyZ2V0ID0gdGhpcy4kZWwuc2ltcGxlZHJhdyh3aWR0aCwgaGVpZ2h0LCBvcHRpb25zLmdldCgnY29tcG9zaXRlJykpOwogICAgICAgICAgICBpZiAoIXZhbHVlcy5sZW5ndGgpIHsKICAgICAgICAgICAgICAgIHRoaXMuZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpOwogICAgICAgIH0sCgogICAgICAgIGdldFJlZ2lvbjogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIHZhciBzaGFwZWlkID0gdGhpcy50YXJnZXQuZ2V0U2hhcGVBdChlbCwgeCwgeSk7CiAgICAgICAgICAgIHJldHVybiAoc2hhcGVpZCAhPT0gdW5kZWZpbmVkICYmIHRoaXMuc2hhcGVzW3NoYXBlaWRdICE9PSB1bmRlZmluZWQpID8gdGhpcy5zaGFwZXNbc2hhcGVpZF0gOiB1bmRlZmluZWQ7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0Q3VycmVudFJlZ2lvbkZpZWxkczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY3VycmVudFJlZ2lvbiA9IHRoaXMuY3VycmVudFJlZ2lvbjsKICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgIGZpZWxka2V5OiBjdXJyZW50UmVnaW9uLnN1YnN0cigwLCAxKSwKICAgICAgICAgICAgICAgIHZhbHVlOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uLnN1YnN0cigxKV0sCiAgICAgICAgICAgICAgICByZWdpb246IGN1cnJlbnRSZWdpb24KICAgICAgICAgICAgfTsKICAgICAgICB9LAoKICAgICAgICBjaGFuZ2VIaWdobGlnaHQ6IGZ1bmN0aW9uIChoaWdobGlnaHQpIHsKICAgICAgICAgICAgdmFyIGN1cnJlbnRSZWdpb24gPSB0aGlzLmN1cnJlbnRSZWdpb24sCiAgICAgICAgICAgICAgICBzaGFwZWlkID0gdGhpcy52YWx1ZVNoYXBlc1tjdXJyZW50UmVnaW9uXSwKICAgICAgICAgICAgICAgIHNoYXBlOwogICAgICAgICAgICBkZWxldGUgdGhpcy5zaGFwZXNbc2hhcGVpZF07CiAgICAgICAgICAgIHN3aXRjaCAoY3VycmVudFJlZ2lvbi5zdWJzdHIoMCwgMSkpIHsKICAgICAgICAgICAgICAgIGNhc2UgJ3InOgogICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJSYW5nZShjdXJyZW50UmVnaW9uLnN1YnN0cigxKSwgaGlnaGxpZ2h0KTsKICAgICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIGNhc2UgJ3AnOgogICAgICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJQZXJmb3JtYW5jZShoaWdobGlnaHQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgICAgY2FzZSAndCc6CiAgICAgICAgICAgICAgICAgICAgc2hhcGUgPSB0aGlzLnJlbmRlclRhcmdldChoaWdobGlnaHQpOwogICAgICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXNbY3VycmVudFJlZ2lvbl0gPSBzaGFwZS5pZDsKICAgICAgICAgICAgdGhpcy5zaGFwZXNbc2hhcGUuaWRdID0gY3VycmVudFJlZ2lvbjsKICAgICAgICAgICAgdGhpcy50YXJnZXQucmVwbGFjZVdpdGhTaGFwZShzaGFwZWlkLCBzaGFwZSk7CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyUmFuZ2U6IGZ1bmN0aW9uIChybiwgaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgIHZhciByYW5nZXZhbCA9IHRoaXMudmFsdWVzW3JuXSwKICAgICAgICAgICAgICAgIHJhbmdld2lkdGggPSBNYXRoLnJvdW5kKHRoaXMuY2FudmFzV2lkdGggKiAoKHJhbmdldmFsIC0gdGhpcy5taW4pIC8gdGhpcy5yYW5nZSkpLAogICAgICAgICAgICAgICAgY29sb3IgPSB0aGlzLm9wdGlvbnMuZ2V0KCdyYW5nZUNvbG9ycycpW3JuIC0gMl07CiAgICAgICAgICAgIGlmIChoaWdobGlnaHQpIHsKICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5jYWxjSGlnaGxpZ2h0Q29sb3IoY29sb3IsIHRoaXMub3B0aW9ucyk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIHRoaXMudGFyZ2V0LmRyYXdSZWN0KDAsIDAsIHJhbmdld2lkdGggLSAxLCB0aGlzLmNhbnZhc0hlaWdodCAtIDEsIGNvbG9yLCBjb2xvcik7CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyUGVyZm9ybWFuY2U6IGZ1bmN0aW9uIChoaWdobGlnaHQpIHsKICAgICAgICAgICAgdmFyIHBlcmZ2YWwgPSB0aGlzLnZhbHVlc1sxXSwKICAgICAgICAgICAgICAgIHBlcmZ3aWR0aCA9IE1hdGgucm91bmQodGhpcy5jYW52YXNXaWR0aCAqICgocGVyZnZhbCAtIHRoaXMubWluKSAvIHRoaXMucmFuZ2UpKSwKICAgICAgICAgICAgICAgIGNvbG9yID0gdGhpcy5vcHRpb25zLmdldCgncGVyZm9ybWFuY2VDb2xvcicpOwogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhcmdldC5kcmF3UmVjdCgwLCBNYXRoLnJvdW5kKHRoaXMuY2FudmFzSGVpZ2h0ICogMC4zKSwgcGVyZndpZHRoIC0gMSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQodGhpcy5jYW52YXNIZWlnaHQgKiAwLjQpIC0gMSwgY29sb3IsIGNvbG9yKTsKICAgICAgICB9LAoKICAgICAgICByZW5kZXJUYXJnZXQ6IGZ1bmN0aW9uIChoaWdobGlnaHQpIHsKICAgICAgICAgICAgdmFyIHRhcmdldHZhbCA9IHRoaXMudmFsdWVzWzBdLAogICAgICAgICAgICAgICAgeCA9IE1hdGgucm91bmQodGhpcy5jYW52YXNXaWR0aCAqICgodGFyZ2V0dmFsIC0gdGhpcy5taW4pIC8gdGhpcy5yYW5nZSkgLSAodGhpcy5vcHRpb25zLmdldCgndGFyZ2V0V2lkdGgnKSAvIDIpKSwKICAgICAgICAgICAgICAgIHRhcmdldHRvcCA9IE1hdGgucm91bmQodGhpcy5jYW52YXNIZWlnaHQgKiAwLjEwKSwKICAgICAgICAgICAgICAgIHRhcmdldGhlaWdodCA9IHRoaXMuY2FudmFzSGVpZ2h0IC0gKHRhcmdldHRvcCAqIDIpLAogICAgICAgICAgICAgICAgY29sb3IgPSB0aGlzLm9wdGlvbnMuZ2V0KCd0YXJnZXRDb2xvcicpOwogICAgICAgICAgICBpZiAoaGlnaGxpZ2h0KSB7CiAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCB0aGlzLm9wdGlvbnMpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiB0aGlzLnRhcmdldC5kcmF3UmVjdCh4LCB0YXJnZXR0b3AsIHRoaXMub3B0aW9ucy5nZXQoJ3RhcmdldFdpZHRoJykgLSAxLCB0YXJnZXRoZWlnaHQgLSAxLCBjb2xvciwgY29sb3IpOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgdmxlbiA9IHRoaXMudmFsdWVzLmxlbmd0aCwKICAgICAgICAgICAgICAgIHRhcmdldCA9IHRoaXMudGFyZ2V0LAogICAgICAgICAgICAgICAgaSwgc2hhcGU7CiAgICAgICAgICAgIGlmICghYnVsbGV0Ll9zdXBlci5yZW5kZXIuY2FsbCh0aGlzKSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IDI7IGkgPCB2bGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIHNoYXBlID0gdGhpcy5yZW5kZXJSYW5nZShpKS5hcHBlbmQoKTsKICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9ICdyJyArIGk7CiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlU2hhcGVzWydyJyArIGldID0gc2hhcGUuaWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMudmFsdWVzWzFdICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMucmVuZGVyUGVyZm9ybWFuY2UoKS5hcHBlbmQoKTsKICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9ICdwMSc7CiAgICAgICAgICAgICAgICB0aGlzLnZhbHVlU2hhcGVzLnAxID0gc2hhcGUuaWQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMudmFsdWVzWzBdICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgICBzaGFwZSA9IHRoaXMucmVuZGVyVGFyZ2V0KCkuYXBwZW5kKCk7CiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSAndDAnOwogICAgICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlcy50MCA9IHNoYXBlLmlkOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRhcmdldC5yZW5kZXIoKTsKICAgICAgICB9CiAgICB9KTsKCiAgICAvKioKICAgICAqIFBpZSBjaGFydHMKICAgICAqLwogICAgJC5mbi5zcGFya2xpbmUucGllID0gcGllID0gY3JlYXRlQ2xhc3MoJC5mbi5zcGFya2xpbmUuX2Jhc2UsIHsKICAgICAgICB0eXBlOiAncGllJywKCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpIHsKICAgICAgICAgICAgdmFyIHRvdGFsID0gMCwgaTsKCiAgICAgICAgICAgIHBpZS5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpOwoKICAgICAgICAgICAgdGhpcy5zaGFwZXMgPSB7fTsgLy8gbWFwIHNoYXBlIGlkcyB0byB2YWx1ZSBvZmZzZXRzCiAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXMgPSB7fTsgLy8gbWFwcyB2YWx1ZSBvZmZzZXRzIHRvIHNoYXBlIGlkcwogICAgICAgICAgICB0aGlzLnZhbHVlcyA9IHZhbHVlcyA9ICQubWFwKHZhbHVlcywgTnVtYmVyKTsKCiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnd2lkdGgnKSA9PT0gJ2F1dG8nKSB7CiAgICAgICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5oZWlnaHQ7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgZm9yIChpID0gdmFsdWVzLmxlbmd0aDsgaS0tOykgewogICAgICAgICAgICAgICAgICAgIHRvdGFsICs9IHZhbHVlc1tpXTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLnRvdGFsID0gdG90YWw7CiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpOwogICAgICAgICAgICB0aGlzLnJhZGl1cyA9IE1hdGguZmxvb3IoTWF0aC5taW4odGhpcy5jYW52YXNXaWR0aCwgdGhpcy5jYW52YXNIZWlnaHQpIC8gMik7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0UmVnaW9uOiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgdmFyIHNoYXBlaWQgPSB0aGlzLnRhcmdldC5nZXRTaGFwZUF0KGVsLCB4LCB5KTsKICAgICAgICAgICAgcmV0dXJuIChzaGFwZWlkICE9PSB1bmRlZmluZWQgJiYgdGhpcy5zaGFwZXNbc2hhcGVpZF0gIT09IHVuZGVmaW5lZCkgPyB0aGlzLnNoYXBlc1tzaGFwZWlkXSA6IHVuZGVmaW5lZDsKICAgICAgICB9LAoKICAgICAgICBnZXRDdXJyZW50UmVnaW9uRmllbGRzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdXJyZW50UmVnaW9uID0gdGhpcy5jdXJyZW50UmVnaW9uOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgICAgaXNOdWxsOiB0aGlzLnZhbHVlc1tjdXJyZW50UmVnaW9uXSA9PT0gdW5kZWZpbmVkLAogICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMudmFsdWVzW2N1cnJlbnRSZWdpb25dLAogICAgICAgICAgICAgICAgcGVyY2VudDogdGhpcy52YWx1ZXNbY3VycmVudFJlZ2lvbl0gLyB0aGlzLnRvdGFsICogMTAwLAogICAgICAgICAgICAgICAgY29sb3I6IHRoaXMub3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJylbY3VycmVudFJlZ2lvbiAlIHRoaXMub3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJykubGVuZ3RoXSwKICAgICAgICAgICAgICAgIG9mZnNldDogY3VycmVudFJlZ2lvbgogICAgICAgICAgICB9OwogICAgICAgIH0sCgogICAgICAgIGNoYW5nZUhpZ2hsaWdodDogZnVuY3Rpb24gKGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgY3VycmVudFJlZ2lvbiA9IHRoaXMuY3VycmVudFJlZ2lvbiwKICAgICAgICAgICAgICAgICBuZXdzbGljZSA9IHRoaXMucmVuZGVyU2xpY2UoY3VycmVudFJlZ2lvbiwgaGlnaGxpZ2h0KSwKICAgICAgICAgICAgICAgICBzaGFwZWlkID0gdGhpcy52YWx1ZVNoYXBlc1tjdXJyZW50UmVnaW9uXTsKICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2hhcGVzW3NoYXBlaWRdOwogICAgICAgICAgICB0aGlzLnRhcmdldC5yZXBsYWNlV2l0aFNoYXBlKHNoYXBlaWQsIG5ld3NsaWNlKTsKICAgICAgICAgICAgdGhpcy52YWx1ZVNoYXBlc1tjdXJyZW50UmVnaW9uXSA9IG5ld3NsaWNlLmlkOwogICAgICAgICAgICB0aGlzLnNoYXBlc1tuZXdzbGljZS5pZF0gPSBjdXJyZW50UmVnaW9uOwogICAgICAgIH0sCgogICAgICAgIHJlbmRlclNsaWNlOiBmdW5jdGlvbiAodmFsdWVudW0sIGhpZ2hsaWdodCkgewogICAgICAgICAgICB2YXIgdGFyZ2V0ID0gdGhpcy50YXJnZXQsCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgcmFkaXVzID0gdGhpcy5yYWRpdXMsCiAgICAgICAgICAgICAgICBib3JkZXJXaWR0aCA9IG9wdGlvbnMuZ2V0KCdib3JkZXJXaWR0aCcpLAogICAgICAgICAgICAgICAgb2Zmc2V0ID0gb3B0aW9ucy5nZXQoJ29mZnNldCcpLAogICAgICAgICAgICAgICAgY2lyY2xlID0gMiAqIE1hdGguUEksCiAgICAgICAgICAgICAgICB2YWx1ZXMgPSB0aGlzLnZhbHVlcywKICAgICAgICAgICAgICAgIHRvdGFsID0gdGhpcy50b3RhbCwKICAgICAgICAgICAgICAgIG5leHQgPSBvZmZzZXQgPyAoMipNYXRoLlBJKSoob2Zmc2V0LzM2MCkgOiAwLAogICAgICAgICAgICAgICAgc3RhcnQsIGVuZCwgaSwgdmxlbiwgY29sb3I7CgogICAgICAgICAgICB2bGVuID0gdmFsdWVzLmxlbmd0aDsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHZsZW47IGkrKykgewogICAgICAgICAgICAgICAgc3RhcnQgPSBuZXh0OwogICAgICAgICAgICAgICAgZW5kID0gbmV4dDsKICAgICAgICAgICAgICAgIGlmICh0b3RhbCA+IDApIHsgIC8vIGF2b2lkIGRpdmlkZSBieSB6ZXJvCiAgICAgICAgICAgICAgICAgICAgZW5kID0gbmV4dCArIChjaXJjbGUgKiAodmFsdWVzW2ldIC8gdG90YWwpKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmICh2YWx1ZW51bSA9PT0gaSkgewogICAgICAgICAgICAgICAgICAgIGNvbG9yID0gb3B0aW9ucy5nZXQoJ3NsaWNlQ29sb3JzJylbaSAlIG9wdGlvbnMuZ2V0KCdzbGljZUNvbG9ycycpLmxlbmd0aF07CiAgICAgICAgICAgICAgICAgICAgaWYgKGhpZ2hsaWdodCkgewogICAgICAgICAgICAgICAgICAgICAgICBjb2xvciA9IHRoaXMuY2FsY0hpZ2hsaWdodENvbG9yKGNvbG9yLCBvcHRpb25zKTsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHJldHVybiB0YXJnZXQuZHJhd1BpZVNsaWNlKHJhZGl1cywgcmFkaXVzLCByYWRpdXMgLSBib3JkZXJXaWR0aCwgc3RhcnQsIGVuZCwgdW5kZWZpbmVkLCBjb2xvcik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBuZXh0ID0gZW5kOwogICAgICAgICAgICB9CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMudmFsdWVzLAogICAgICAgICAgICAgICAgb3B0aW9ucyA9IHRoaXMub3B0aW9ucywKICAgICAgICAgICAgICAgIHJhZGl1cyA9IHRoaXMucmFkaXVzLAogICAgICAgICAgICAgICAgYm9yZGVyV2lkdGggPSBvcHRpb25zLmdldCgnYm9yZGVyV2lkdGgnKSwKICAgICAgICAgICAgICAgIHNoYXBlLCBpOwoKICAgICAgICAgICAgaWYgKCFwaWUuX3N1cGVyLnJlbmRlci5jYWxsKHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGJvcmRlcldpZHRoKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZShyYWRpdXMsIHJhZGl1cywgTWF0aC5mbG9vcihyYWRpdXMgLSAoYm9yZGVyV2lkdGggLyAyKSksCiAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2JvcmRlckNvbG9yJyksIHVuZGVmaW5lZCwgYm9yZGVyV2lkdGgpLmFwcGVuZCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoaSA9IHZhbHVlcy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0pIHsgLy8gZG9uJ3QgcmVuZGVyIHplcm8gdmFsdWVzCiAgICAgICAgICAgICAgICAgICAgc2hhcGUgPSB0aGlzLnJlbmRlclNsaWNlKGkpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgICAgIHRoaXMudmFsdWVTaGFwZXNbaV0gPSBzaGFwZS5pZDsgLy8gc3RvcmUganVzdCB0aGUgc2hhcGVpZAogICAgICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzW3NoYXBlLmlkXSA9IGk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGFyZ2V0LnJlbmRlcigpOwogICAgICAgIH0KICAgIH0pOwoKICAgIC8qKgogICAgICogQm94IHBsb3RzCiAgICAgKi8KICAgICQuZm4uc3BhcmtsaW5lLmJveCA9IGJveCA9IGNyZWF0ZUNsYXNzKCQuZm4uc3BhcmtsaW5lLl9iYXNlLCB7CiAgICAgICAgdHlwZTogJ2JveCcsCgogICAgICAgIGluaXQ6IGZ1bmN0aW9uIChlbCwgdmFsdWVzLCBvcHRpb25zLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgICAgIGJveC5fc3VwZXIuaW5pdC5jYWxsKHRoaXMsIGVsLCB2YWx1ZXMsIG9wdGlvbnMsIHdpZHRoLCBoZWlnaHQpOwogICAgICAgICAgICB0aGlzLnZhbHVlcyA9ICQubWFwKHZhbHVlcywgTnVtYmVyKTsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IG9wdGlvbnMuZ2V0KCd3aWR0aCcpID09PSAnYXV0bycgPyAnNC4wZW0nIDogd2lkdGg7CiAgICAgICAgICAgIHRoaXMuaW5pdFRhcmdldCgpOwogICAgICAgICAgICBpZiAoIXRoaXMudmFsdWVzLmxlbmd0aCkgewogICAgICAgICAgICAgICAgdGhpcy5kaXNhYmxlZCA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBTaW11bGF0ZSBhIHNpbmdsZSByZWdpb24KICAgICAgICAgKi8KICAgICAgICBnZXRSZWdpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgcmV0dXJuIDE7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0Q3VycmVudFJlZ2lvbkZpZWxkczogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgcmVzdWx0ID0gWwogICAgICAgICAgICAgICAgeyBmaWVsZDogJ2xxJywgdmFsdWU6IHRoaXMucXVhcnRpbGVzWzBdIH0sCiAgICAgICAgICAgICAgICB7IGZpZWxkOiAnbWVkJywgdmFsdWU6IHRoaXMucXVhcnRpbGVzWzFdIH0sCiAgICAgICAgICAgICAgICB7IGZpZWxkOiAndXEnLCB2YWx1ZTogdGhpcy5xdWFydGlsZXNbMl0gfQogICAgICAgICAgICBdOwogICAgICAgICAgICBpZiAodGhpcy5sb3V0bGllciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7IGZpZWxkOiAnbG8nLCB2YWx1ZTogdGhpcy5sb3V0bGllcn0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnJvdXRsaWVyICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHsgZmllbGQ6ICdybycsIHZhbHVlOiB0aGlzLnJvdXRsaWVyfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRoaXMubHdoaXNrZXIgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgcmVzdWx0LnB1c2goeyBmaWVsZDogJ2x3JywgdmFsdWU6IHRoaXMubHdoaXNrZXJ9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodGhpcy5yd2hpc2tlciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZXN1bHQucHVzaCh7IGZpZWxkOiAncncnLCB2YWx1ZTogdGhpcy5yd2hpc2tlcn0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7CiAgICAgICAgfSwKCiAgICAgICAgcmVuZGVyOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciB0YXJnZXQgPSB0aGlzLnRhcmdldCwKICAgICAgICAgICAgICAgIHZhbHVlcyA9IHRoaXMudmFsdWVzLAogICAgICAgICAgICAgICAgdmxlbiA9IHZhbHVlcy5sZW5ndGgsCiAgICAgICAgICAgICAgICBvcHRpb25zID0gdGhpcy5vcHRpb25zLAogICAgICAgICAgICAgICAgY2FudmFzV2lkdGggPSB0aGlzLmNhbnZhc1dpZHRoLAogICAgICAgICAgICAgICAgY2FudmFzSGVpZ2h0ID0gdGhpcy5jYW52YXNIZWlnaHQsCiAgICAgICAgICAgICAgICBtaW5WYWx1ZSA9IG9wdGlvbnMuZ2V0KCdjaGFydFJhbmdlTWluJykgPT09IHVuZGVmaW5lZCA/IE1hdGgubWluLmFwcGx5KE1hdGgsIHZhbHVlcykgOiBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1pbicpLAogICAgICAgICAgICAgICAgbWF4VmFsdWUgPSBvcHRpb25zLmdldCgnY2hhcnRSYW5nZU1heCcpID09PSB1bmRlZmluZWQgPyBNYXRoLm1heC5hcHBseShNYXRoLCB2YWx1ZXMpIDogb3B0aW9ucy5nZXQoJ2NoYXJ0UmFuZ2VNYXgnKSwKICAgICAgICAgICAgICAgIGNhbnZhc0xlZnQgPSAwLAogICAgICAgICAgICAgICAgbHdoaXNrZXIsIGxvdXRsaWVyLCBpcXIsIHExLCBxMiwgcTMsIHJ3aGlza2VyLCByb3V0bGllciwgaSwKICAgICAgICAgICAgICAgIHNpemUsIHVuaXRTaXplOwoKICAgICAgICAgICAgaWYgKCFib3guX3N1cGVyLnJlbmRlci5jYWxsKHRoaXMpKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgncmF3JykpIHsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnc2hvd091dGxpZXJzJykgJiYgdmFsdWVzLmxlbmd0aCA+IDUpIHsKICAgICAgICAgICAgICAgICAgICBsb3V0bGllciA9IHZhbHVlc1swXTsKICAgICAgICAgICAgICAgICAgICBsd2hpc2tlciA9IHZhbHVlc1sxXTsKICAgICAgICAgICAgICAgICAgICBxMSA9IHZhbHVlc1syXTsKICAgICAgICAgICAgICAgICAgICBxMiA9IHZhbHVlc1szXTsKICAgICAgICAgICAgICAgICAgICBxMyA9IHZhbHVlc1s0XTsKICAgICAgICAgICAgICAgICAgICByd2hpc2tlciA9IHZhbHVlc1s1XTsKICAgICAgICAgICAgICAgICAgICByb3V0bGllciA9IHZhbHVlc1s2XTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgbHdoaXNrZXIgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgICAgICAgcTEgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgICAgICAgcTIgPSB2YWx1ZXNbMl07CiAgICAgICAgICAgICAgICAgICAgcTMgPSB2YWx1ZXNbM107CiAgICAgICAgICAgICAgICAgICAgcndoaXNrZXIgPSB2YWx1ZXNbNF07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB2YWx1ZXMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSAtIGI7IH0pOwogICAgICAgICAgICAgICAgcTEgPSBxdWFydGlsZSh2YWx1ZXMsIDEpOwogICAgICAgICAgICAgICAgcTIgPSBxdWFydGlsZSh2YWx1ZXMsIDIpOwogICAgICAgICAgICAgICAgcTMgPSBxdWFydGlsZSh2YWx1ZXMsIDMpOwogICAgICAgICAgICAgICAgaXFyID0gcTMgLSBxMTsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgnc2hvd091dGxpZXJzJykpIHsKICAgICAgICAgICAgICAgICAgICBsd2hpc2tlciA9IHJ3aGlza2VyID0gdW5kZWZpbmVkOwogICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCB2bGVuOyBpKyspIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGx3aGlza2VyID09PSB1bmRlZmluZWQgJiYgdmFsdWVzW2ldID4gcTEgLSAoaXFyICogb3B0aW9ucy5nZXQoJ291dGxpZXJJUVInKSkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGx3aGlza2VyID0gdmFsdWVzW2ldOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZXNbaV0gPCBxMyArIChpcXIgKiBvcHRpb25zLmdldCgnb3V0bGllcklRUicpKSkgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgcndoaXNrZXIgPSB2YWx1ZXNbaV07CiAgICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgbG91dGxpZXIgPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgICAgICAgcm91dGxpZXIgPSB2YWx1ZXNbdmxlbiAtIDFdOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBsd2hpc2tlciA9IHZhbHVlc1swXTsKICAgICAgICAgICAgICAgICAgICByd2hpc2tlciA9IHZhbHVlc1t2bGVuIC0gMV07CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5xdWFydGlsZXMgPSBbcTEsIHEyLCBxM107CiAgICAgICAgICAgIHRoaXMubHdoaXNrZXIgPSBsd2hpc2tlcjsKICAgICAgICAgICAgdGhpcy5yd2hpc2tlciA9IHJ3aGlza2VyOwogICAgICAgICAgICB0aGlzLmxvdXRsaWVyID0gbG91dGxpZXI7CiAgICAgICAgICAgIHRoaXMucm91dGxpZXIgPSByb3V0bGllcjsKCiAgICAgICAgICAgIHVuaXRTaXplID0gY2FudmFzV2lkdGggLyAobWF4VmFsdWUgLSBtaW5WYWx1ZSArIDEpOwogICAgICAgICAgICBpZiAob3B0aW9ucy5nZXQoJ3Nob3dPdXRsaWVycycpKSB7CiAgICAgICAgICAgICAgICBjYW52YXNMZWZ0ID0gTWF0aC5jZWlsKG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJykpOwogICAgICAgICAgICAgICAgY2FudmFzV2lkdGggLT0gMiAqIE1hdGguY2VpbChvcHRpb25zLmdldCgnc3BvdFJhZGl1cycpKTsKICAgICAgICAgICAgICAgIHVuaXRTaXplID0gY2FudmFzV2lkdGggLyAobWF4VmFsdWUgLSBtaW5WYWx1ZSArIDEpOwogICAgICAgICAgICAgICAgaWYgKGxvdXRsaWVyIDwgbHdoaXNrZXIpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZSgobG91dGxpZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCAvIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyTGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyRmlsbENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaWYgKHJvdXRsaWVyID4gcndoaXNrZXIpIHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0NpcmNsZSgocm91dGxpZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQsCiAgICAgICAgICAgICAgICAgICAgICAgIGNhbnZhc0hlaWdodCAvIDIsCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdzcG90UmFkaXVzJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyTGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCdvdXRsaWVyRmlsbENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CgogICAgICAgICAgICAvLyBib3gKICAgICAgICAgICAgdGFyZ2V0LmRyYXdSZWN0KAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocTEgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgKiAwLjEpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocTMgLSBxMSkgKiB1bml0U2l6ZSksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuOCksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnYm94TGluZUNvbG9yJyksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnYm94RmlsbENvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAvLyBsZWZ0IHdoaXNrZXIKICAgICAgICAgICAgdGFyZ2V0LmRyYXdMaW5lKAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgobHdoaXNrZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKHExIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC8gMiksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbGluZUNvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChsd2hpc2tlciAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgobHdoaXNrZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLSBjYW52YXNIZWlnaHQgLyA0KSwKICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCd3aGlza2VyQ29sb3InKSkuYXBwZW5kKCk7CiAgICAgICAgICAgIC8vIHJpZ2h0IHdoaXNrZXIKICAgICAgICAgICAgdGFyZ2V0LmRyYXdMaW5lKE1hdGgucm91bmQoKHJ3aGlza2VyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC8gMiksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMyAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDIpLAogICAgICAgICAgICAgICAgb3B0aW9ucy5nZXQoJ2xpbmVDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICAgICAgdGFyZ2V0LmRyYXdMaW5lKAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgocndoaXNrZXIgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQpLAogICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyA0KSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKHJ3aGlza2VyIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSwKICAgICAgICAgICAgICAgIE1hdGgucm91bmQoY2FudmFzSGVpZ2h0IC0gY2FudmFzSGVpZ2h0IC8gNCksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnd2hpc2tlckNvbG9yJykpLmFwcGVuZCgpOwogICAgICAgICAgICAvLyBtZWRpYW4gbGluZQogICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMiAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuMSksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChxMiAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAqIDAuOSksCiAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgnbWVkaWFuQ29sb3InKSkuYXBwZW5kKCk7CiAgICAgICAgICAgIGlmIChvcHRpb25zLmdldCgndGFyZ2V0JykpIHsKICAgICAgICAgICAgICAgIHNpemUgPSBNYXRoLmNlaWwob3B0aW9ucy5nZXQoJ3Nwb3RSYWRpdXMnKSk7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgob3B0aW9ucy5nZXQoJ3RhcmdldCcpIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0KSwKICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChjYW52YXNIZWlnaHQgLyAyKSAtIHNpemUpLAogICAgICAgICAgICAgICAgICAgIE1hdGgucm91bmQoKG9wdGlvbnMuZ2V0KCd0YXJnZXQnKSAtIG1pblZhbHVlKSAqIHVuaXRTaXplICsgY2FudmFzTGVmdCksCiAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgoY2FudmFzSGVpZ2h0IC8gMikgKyBzaXplKSwKICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmdldCgndGFyZ2V0Q29sb3InKSkuYXBwZW5kKCk7CiAgICAgICAgICAgICAgICB0YXJnZXQuZHJhd0xpbmUoCiAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZCgob3B0aW9ucy5nZXQoJ3RhcmdldCcpIC0gbWluVmFsdWUpICogdW5pdFNpemUgKyBjYW52YXNMZWZ0IC0gc2l6ZSksCiAgICAgICAgICAgICAgICAgICAgTWF0aC5yb3VuZChjYW52YXNIZWlnaHQgLyAyKSwKICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKChvcHRpb25zLmdldCgndGFyZ2V0JykgLSBtaW5WYWx1ZSkgKiB1bml0U2l6ZSArIGNhbnZhc0xlZnQgKyBzaXplKSwKICAgICAgICAgICAgICAgICAgICBNYXRoLnJvdW5kKGNhbnZhc0hlaWdodCAvIDIpLAogICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuZ2V0KCd0YXJnZXRDb2xvcicpKS5hcHBlbmQoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0YXJnZXQucmVuZGVyKCk7CiAgICAgICAgfQogICAgfSk7CgogICAgLy8gU2V0dXAgYSB2ZXJ5IHNpbXBsZSAidmlydHVhbCBjYW52YXMiIHRvIG1ha2UgZHJhd2luZyB0aGUgZmV3IHNoYXBlcyB3ZSBuZWVkIGVhc2llcgogICAgLy8gVGhpcyBpcyBhY2Nlc3NpYmxlIGFzICQoZm9vKS5zaW1wbGVkcmF3KCkKCiAgICBWU2hhcGUgPSBjcmVhdGVDbGFzcyh7CiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHRhcmdldCwgaWQsIHR5cGUsIGFyZ3MpIHsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMuaWQgPSBpZDsKICAgICAgICAgICAgdGhpcy50eXBlID0gdHlwZTsKICAgICAgICAgICAgdGhpcy5hcmdzID0gYXJnczsKICAgICAgICB9LAogICAgICAgIGFwcGVuZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLnRhcmdldC5hcHBlbmRTaGFwZSh0aGlzKTsKICAgICAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgICAgfQogICAgfSk7CgogICAgVkNhbnZhc19iYXNlID0gY3JlYXRlQ2xhc3MoewogICAgICAgIF9weHJlZ2V4OiAvKFxkKykocHgpP1xzKiQvaSwKCiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHRhcmdldCkgewogICAgICAgICAgICBpZiAoIXdpZHRoKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgICAgICAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICAgICAgICAgICAgdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICAgICAgICAgIHRoaXMubGFzdFNoYXBlSWQgPSBudWxsOwogICAgICAgICAgICBpZiAodGFyZ2V0WzBdKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXRbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5kYXRhKHRhcmdldCwgJ19qcXNfdmNhbnZhcycsIHRoaXMpOwogICAgICAgIH0sCgogICAgICAgIGRyYXdMaW5lOiBmdW5jdGlvbiAoeDEsIHkxLCB4MiwgeTIsIGxpbmVDb2xvciwgbGluZVdpZHRoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmRyYXdTaGFwZShbW3gxLCB5MV0sIFt4MiwgeTJdXSwgbGluZUNvbG9yLCBsaW5lV2lkdGgpOwogICAgICAgIH0sCgogICAgICAgIGRyYXdTaGFwZTogZnVuY3Rpb24gKHBhdGgsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGgpIHsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dlblNoYXBlKCdTaGFwZScsIFtwYXRoLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoXSk7CiAgICAgICAgfSwKCiAgICAgICAgZHJhd0NpcmNsZTogZnVuY3Rpb24gKHgsIHksIHJhZGl1cywgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2VuU2hhcGUoJ0NpcmNsZScsIFt4LCB5LCByYWRpdXMsIGxpbmVDb2xvciwgZmlsbENvbG9yLCBsaW5lV2lkdGhdKTsKICAgICAgICB9LAoKICAgICAgICBkcmF3UGllU2xpY2U6IGZ1bmN0aW9uICh4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBsaW5lQ29sb3IsIGZpbGxDb2xvcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2VuU2hhcGUoJ1BpZVNsaWNlJywgW3gsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGxpbmVDb2xvciwgZmlsbENvbG9yXSk7CiAgICAgICAgfSwKCiAgICAgICAgZHJhd1JlY3Q6IGZ1bmN0aW9uICh4LCB5LCB3aWR0aCwgaGVpZ2h0LCBsaW5lQ29sb3IsIGZpbGxDb2xvcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2VuU2hhcGUoJ1JlY3QnLCBbeCwgeSwgd2lkdGgsIGhlaWdodCwgbGluZUNvbG9yLCBmaWxsQ29sb3JdKTsKICAgICAgICB9LAoKICAgICAgICBnZXRFbGVtZW50OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmNhbnZhczsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBSZXR1cm4gdGhlIG1vc3QgcmVjZW50bHkgaW5zZXJ0ZWQgc2hhcGUgaWQKICAgICAgICAgKi8KICAgICAgICBnZXRMYXN0U2hhcGVJZDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5sYXN0U2hhcGVJZDsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBDbGVhciBhbmQgcmVzZXQgdGhlIGNhbnZhcwogICAgICAgICAqLwogICAgICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIGFsZXJ0KCdyZXNldCBub3QgaW1wbGVtZW50ZWQnKTsKICAgICAgICB9LAoKICAgICAgICBfaW5zZXJ0OiBmdW5jdGlvbiAoZWwsIHRhcmdldCkgewogICAgICAgICAgICAkKHRhcmdldCkuaHRtbChlbCk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogQ2FsY3VsYXRlIHRoZSBwaXhlbCBkaW1lbnNpb25zIG9mIHRoZSBjYW52YXMKICAgICAgICAgKi8KICAgICAgICBfY2FsY3VsYXRlUGl4ZWxEaW1zOiBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgY2FudmFzKSB7CiAgICAgICAgICAgIC8vIFhYWCBUaGlzIHNob3VsZCBwcm9iYWJseSBiZSBhIGNvbmZpZ3VyYWJsZSBvcHRpb24KICAgICAgICAgICAgdmFyIG1hdGNoOwogICAgICAgICAgICBtYXRjaCA9IHRoaXMuX3B4cmVnZXguZXhlYyhoZWlnaHQpOwogICAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICAgIHRoaXMucGl4ZWxIZWlnaHQgPSBtYXRjaFsxXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMucGl4ZWxIZWlnaHQgPSAkKGNhbnZhcykuaGVpZ2h0KCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWF0Y2ggPSB0aGlzLl9weHJlZ2V4LmV4ZWMod2lkdGgpOwogICAgICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgICAgICAgIHRoaXMucGl4ZWxXaWR0aCA9IG1hdGNoWzFdOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgdGhpcy5waXhlbFdpZHRoID0gJChjYW52YXMpLndpZHRoKCk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBHZW5lcmF0ZSBhIHNoYXBlIG9iamVjdCBhbmQgaWQgZm9yIGxhdGVyIHJlbmRlcmluZwogICAgICAgICAqLwogICAgICAgIF9nZW5TaGFwZTogZnVuY3Rpb24gKHNoYXBldHlwZSwgc2hhcGVhcmdzKSB7CiAgICAgICAgICAgIHZhciBpZCA9IHNoYXBlQ291bnQrKzsKICAgICAgICAgICAgc2hhcGVhcmdzLnVuc2hpZnQoaWQpOwogICAgICAgICAgICByZXR1cm4gbmV3IFZTaGFwZSh0aGlzLCBpZCwgc2hhcGV0eXBlLCBzaGFwZWFyZ3MpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBlbmQgb2YgdGhlIHJlbmRlciBxdWV1ZQogICAgICAgICAqLwogICAgICAgIGFwcGVuZFNoYXBlOiBmdW5jdGlvbiAoc2hhcGUpIHsKICAgICAgICAgICAgYWxlcnQoJ2FwcGVuZFNoYXBlIG5vdCBpbXBsZW1lbnRlZCcpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIFJlcGxhY2Ugb25lIHNoYXBlIHdpdGggYW5vdGhlcgogICAgICAgICAqLwogICAgICAgIHJlcGxhY2VXaXRoU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkgewogICAgICAgICAgICBhbGVydCgncmVwbGFjZVdpdGhTaGFwZSBub3QgaW1wbGVtZW50ZWQnKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBJbnNlcnQgb25lIHNoYXBlIGFmdGVyIGFub3RoZXIgaW4gdGhlIHJlbmRlciBxdWV1ZQogICAgICAgICAqLwogICAgICAgIGluc2VydEFmdGVyU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkgewogICAgICAgICAgICBhbGVydCgnaW5zZXJ0QWZ0ZXJTaGFwZSBub3QgaW1wbGVtZW50ZWQnKTsKICAgICAgICB9LAoKICAgICAgICAvKioKICAgICAgICAgKiBSZW1vdmUgYSBzaGFwZSBmcm9tIHRoZSBxdWV1ZQogICAgICAgICAqLwogICAgICAgIHJlbW92ZVNoYXBlSWQ6IGZ1bmN0aW9uIChzaGFwZWlkKSB7CiAgICAgICAgICAgIGFsZXJ0KCdyZW1vdmVTaGFwZUlkIG5vdCBpbXBsZW1lbnRlZCcpOwogICAgICAgIH0sCgogICAgICAgIC8qKgogICAgICAgICAqIEZpbmQgYSBzaGFwZSBhdCB0aGUgc3BlY2lmaWVkIHgveSBjby1vcmRpbmF0ZXMKICAgICAgICAgKi8KICAgICAgICBnZXRTaGFwZUF0OiBmdW5jdGlvbiAoZWwsIHgsIHkpIHsKICAgICAgICAgICAgYWxlcnQoJ2dldFNoYXBlQXQgbm90IGltcGxlbWVudGVkJyk7CiAgICAgICAgfSwKCiAgICAgICAgLyoqCiAgICAgICAgICogUmVuZGVyIGFsbCBxdWV1ZWQgc2hhcGVzIG9udG8gdGhlIGNhbnZhcwogICAgICAgICAqLwogICAgICAgIHJlbmRlcjogZnVuY3Rpb24gKCkgewogICAgICAgICAgICBhbGVydCgncmVuZGVyIG5vdCBpbXBsZW1lbnRlZCcpOwogICAgICAgIH0KICAgIH0pOwoKICAgIFZDYW52YXNfY2FudmFzID0gY3JlYXRlQ2xhc3MoVkNhbnZhc19iYXNlLCB7CiAgICAgICAgaW5pdDogZnVuY3Rpb24gKHdpZHRoLCBoZWlnaHQsIHRhcmdldCwgaW50ZXJhY3QpIHsKICAgICAgICAgICAgVkNhbnZhc19jYW52YXMuX3N1cGVyLmluaXQuY2FsbCh0aGlzLCB3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpOwogICAgICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICAgICAgICBpZiAodGFyZ2V0WzBdKSB7CiAgICAgICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXRbMF07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgJC5kYXRhKHRhcmdldCwgJ19qcXNfdmNhbnZhcycsIHRoaXMpOwogICAgICAgICAgICAkKHRoaXMuY2FudmFzKS5jc3MoeyBkaXNwbGF5OiAnaW5saW5lLWJsb2NrJywgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgdmVydGljYWxBbGlnbjogJ3RvcCcgfSk7CiAgICAgICAgICAgIHRoaXMuX2luc2VydCh0aGlzLmNhbnZhcywgdGFyZ2V0KTsKICAgICAgICAgICAgdGhpcy5fY2FsY3VsYXRlUGl4ZWxEaW1zKHdpZHRoLCBoZWlnaHQsIHRoaXMuY2FudmFzKTsKICAgICAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLnBpeGVsV2lkdGg7CiAgICAgICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMucGl4ZWxIZWlnaHQ7CiAgICAgICAgICAgIHRoaXMuaW50ZXJhY3QgPSBpbnRlcmFjdDsKICAgICAgICAgICAgdGhpcy5zaGFwZXMgPSB7fTsKICAgICAgICAgICAgdGhpcy5zaGFwZXNlcSA9IFtdOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRUYXJnZXRTaGFwZUlkID0gdW5kZWZpbmVkOwogICAgICAgICAgICAkKHRoaXMuY2FudmFzKS5jc3Moe3dpZHRoOiB0aGlzLnBpeGVsV2lkdGgsIGhlaWdodDogdGhpcy5waXhlbEhlaWdodH0pOwogICAgICAgIH0sCgogICAgICAgIF9nZXRDb250ZXh0OiBmdW5jdGlvbiAobGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCkgewogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7CiAgICAgICAgICAgIGlmIChsaW5lQ29sb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY29udGV4dC5zdHJva2VTdHlsZSA9IGxpbmVDb2xvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250ZXh0LmxpbmVXaWR0aCA9IGxpbmVXaWR0aCA9PT0gdW5kZWZpbmVkID8gMSA6IGxpbmVXaWR0aDsKICAgICAgICAgICAgaWYgKGZpbGxDb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LmZpbGxTdHlsZSA9IGZpbGxDb2xvcjsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gY29udGV4dDsKICAgICAgICB9LAoKICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX2dldENvbnRleHQoKTsKICAgICAgICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5waXhlbFdpZHRoLCB0aGlzLnBpeGVsSGVpZ2h0KTsKICAgICAgICAgICAgdGhpcy5zaGFwZXMgPSB7fTsKICAgICAgICAgICAgdGhpcy5zaGFwZXNlcSA9IFtdOwogICAgICAgICAgICB0aGlzLmN1cnJlbnRUYXJnZXRTaGFwZUlkID0gdW5kZWZpbmVkOwogICAgICAgIH0sCgogICAgICAgIF9kcmF3U2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBwYXRoLCBsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSB7CiAgICAgICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5fZ2V0Q29udGV4dChsaW5lQ29sb3IsIGZpbGxDb2xvciwgbGluZVdpZHRoKSwKICAgICAgICAgICAgICAgIGksIHBsZW47CiAgICAgICAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGNvbnRleHQubW92ZVRvKHBhdGhbMF1bMF0gKyAwLjUsIHBhdGhbMF1bMV0gKyAwLjUpOwogICAgICAgICAgICBmb3IgKGkgPSAxLCBwbGVuID0gcGF0aC5sZW5ndGg7IGkgPCBwbGVuOyBpKyspIHsKICAgICAgICAgICAgICAgIGNvbnRleHQubGluZVRvKHBhdGhbaV1bMF0gKyAwLjUsIHBhdGhbaV1bMV0gKyAwLjUpOyAvLyB0aGUgMC41IG9mZnNldCBnaXZlcyB1cyBjcmlzcCBwaXhlbC13aWR0aCBsaW5lcwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChsaW5lQ29sb3IgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgY29udGV4dC5zdHJva2UoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZmlsbENvbG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuZmlsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFggIT09IHVuZGVmaW5lZCAmJiB0aGlzLnRhcmdldFkgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgICAgY29udGV4dC5pc1BvaW50SW5QYXRoKHRoaXMudGFyZ2V0WCwgdGhpcy50YXJnZXRZKSkgewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VGFyZ2V0U2hhcGVJZCA9IHNoYXBlaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBfZHJhd0NpcmNsZTogZnVuY3Rpb24gKHNoYXBlaWQsIHgsIHksIHJhZGl1cywgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCkgewogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX2dldENvbnRleHQobGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCk7CiAgICAgICAgICAgIGNvbnRleHQuYmVnaW5QYXRoKCk7CiAgICAgICAgICAgIGNvbnRleHQuYXJjKHgsIHksIHJhZGl1cywgMCwgMiAqIE1hdGguUEksIGZhbHNlKTsKICAgICAgICAgICAgaWYgKHRoaXMudGFyZ2V0WCAhPT0gdW5kZWZpbmVkICYmIHRoaXMudGFyZ2V0WSAhPT0gdW5kZWZpbmVkICYmCiAgICAgICAgICAgICAgICBjb250ZXh0LmlzUG9pbnRJblBhdGgodGhpcy50YXJnZXRYLCB0aGlzLnRhcmdldFkpKSB7CiAgICAgICAgICAgICAgICB0aGlzLmN1cnJlbnRUYXJnZXRTaGFwZUlkID0gc2hhcGVpZDsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobGluZUNvbG9yICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuc3Ryb2tlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGZpbGxDb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LmZpbGwoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIF9kcmF3UGllU2xpY2U6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCByYWRpdXMsIHN0YXJ0QW5nbGUsIGVuZEFuZ2xlLCBsaW5lQ29sb3IsIGZpbGxDb2xvcikgewogICAgICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX2dldENvbnRleHQobGluZUNvbG9yLCBmaWxsQ29sb3IpOwogICAgICAgICAgICBjb250ZXh0LmJlZ2luUGF0aCgpOwogICAgICAgICAgICBjb250ZXh0Lm1vdmVUbyh4LCB5KTsKICAgICAgICAgICAgY29udGV4dC5hcmMoeCwgeSwgcmFkaXVzLCBzdGFydEFuZ2xlLCBlbmRBbmdsZSwgZmFsc2UpOwogICAgICAgICAgICBjb250ZXh0LmxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgY29udGV4dC5jbG9zZVBhdGgoKTsKICAgICAgICAgICAgaWYgKGxpbmVDb2xvciAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICBjb250ZXh0LnN0cm9rZSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChmaWxsQ29sb3IpIHsKICAgICAgICAgICAgICAgIGNvbnRleHQuZmlsbCgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0aGlzLnRhcmdldFggIT09IHVuZGVmaW5lZCAmJiB0aGlzLnRhcmdldFkgIT09IHVuZGVmaW5lZCAmJgogICAgICAgICAgICAgICAgY29udGV4dC5pc1BvaW50SW5QYXRoKHRoaXMudGFyZ2V0WCwgdGhpcy50YXJnZXRZKSkgewogICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VGFyZ2V0U2hhcGVJZCA9IHNoYXBlaWQ7CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICBfZHJhd1JlY3Q6IGZ1bmN0aW9uIChzaGFwZWlkLCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCBsaW5lQ29sb3IsIGZpbGxDb2xvcikgewogICAgICAgICAgICByZXR1cm4gdGhpcy5fZHJhd1NoYXBlKHNoYXBlaWQsIFtbeCwgeV0sIFt4ICsgd2lkdGgsIHldLCBbeCArIHdpZHRoLCB5ICsgaGVpZ2h0XSwgW3gsIHkgKyBoZWlnaHRdLCBbeCwgeV1dLCBsaW5lQ29sb3IsIGZpbGxDb2xvcik7CiAgICAgICAgfSwKCiAgICAgICAgYXBwZW5kU2hhcGU6IGZ1bmN0aW9uIChzaGFwZSkgewogICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSBzaGFwZTsKICAgICAgICAgICAgdGhpcy5zaGFwZXNlcS5wdXNoKHNoYXBlLmlkKTsKICAgICAgICAgICAgdGhpcy5sYXN0U2hhcGVJZCA9IHNoYXBlLmlkOwogICAgICAgICAgICByZXR1cm4gc2hhcGUuaWQ7CiAgICAgICAgfSwKCiAgICAgICAgcmVwbGFjZVdpdGhTaGFwZTogZnVuY3Rpb24gKHNoYXBlaWQsIHNoYXBlKSB7CiAgICAgICAgICAgIHZhciBzaGFwZXNlcSA9IHRoaXMuc2hhcGVzZXEsCiAgICAgICAgICAgICAgICBpOwogICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSBzaGFwZTsKICAgICAgICAgICAgZm9yIChpID0gc2hhcGVzZXEubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBpZiAoc2hhcGVzZXFbaV0gPT0gc2hhcGVpZCkgewogICAgICAgICAgICAgICAgICAgIHNoYXBlc2VxW2ldID0gc2hhcGUuaWQ7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2hhcGVzW3NoYXBlaWRdOwogICAgICAgIH0sCgogICAgICAgIHJlcGxhY2VXaXRoU2hhcGVzOiBmdW5jdGlvbiAoc2hhcGVpZHMsIHNoYXBlcykgewogICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLAogICAgICAgICAgICAgICAgc2hhcGVtYXAgPSB7fSwKICAgICAgICAgICAgICAgIHNpZCwgaSwgZmlyc3Q7CgogICAgICAgICAgICBmb3IgKGkgPSBzaGFwZWlkcy5sZW5ndGg7IGktLTspIHsKICAgICAgICAgICAgICAgIHNoYXBlbWFwW3NoYXBlaWRzW2ldXSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChpID0gc2hhcGVzZXEubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBzaWQgPSBzaGFwZXNlcVtpXTsKICAgICAgICAgICAgICAgIGlmIChzaGFwZW1hcFtzaWRdKSB7CiAgICAgICAgICAgICAgICAgICAgc2hhcGVzZXEuc3BsaWNlKGksIDEpOwogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnNoYXBlc1tzaWRdOwogICAgICAgICAgICAgICAgICAgIGZpcnN0ID0gaTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBmb3IgKGkgPSBzaGFwZXMubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBzaGFwZXNlcS5zcGxpY2UoZmlyc3QsIDAsIHNoYXBlc1tpXS5pZCk7CiAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZXNbaV0uaWRdID0gc2hhcGVzW2ldOwogICAgICAgICAgICB9CgogICAgICAgIH0sCgogICAgICAgIGluc2VydEFmdGVyU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkgewogICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLAogICAgICAgICAgICAgICAgaTsKICAgICAgICAgICAgZm9yIChpID0gc2hhcGVzZXEubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBpZiAoc2hhcGVzZXFbaV0gPT09IHNoYXBlaWQpIHsKICAgICAgICAgICAgICAgICAgICBzaGFwZXNlcS5zcGxpY2UoaSArIDEsIDAsIHNoYXBlLmlkKTsKICAgICAgICAgICAgICAgICAgICB0aGlzLnNoYXBlc1tzaGFwZS5pZF0gPSBzaGFwZTsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9LAoKICAgICAgICByZW1vdmVTaGFwZUlkOiBmdW5jdGlvbiAoc2hhcGVpZCkgewogICAgICAgICAgICB2YXIgc2hhcGVzZXEgPSB0aGlzLnNoYXBlc2VxLAogICAgICAgICAgICAgICAgaTsKICAgICAgICAgICAgZm9yIChpID0gc2hhcGVzZXEubGVuZ3RoOyBpLS07KSB7CiAgICAgICAgICAgICAgICBpZiAoc2hhcGVzZXFbaV0gPT09IHNoYXBlaWQpIHsKICAgICAgICAgICAgICAgICAgICBzaGFwZXNlcS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGVsZXRlIHRoaXMuc2hhcGVzW3NoYXBlaWRdOwogICAgICAgIH0sCgogICAgICAgIGdldFNoYXBlQXQ6IGZ1bmN0aW9uIChlbCwgeCwgeSkgewogICAgICAgICAgICB0aGlzLnRhcmdldFggPSB4OwogICAgICAgICAgICB0aGlzLnRhcmdldFkgPSB5OwogICAgICAgICAgICB0aGlzLnJlbmRlcigpOwogICAgICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VGFyZ2V0U2hhcGVJZDsKICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgdmFyIHNoYXBlc2VxID0gdGhpcy5zaGFwZXNlcSwKICAgICAgICAgICAgICAgIHNoYXBlcyA9IHRoaXMuc2hhcGVzLAogICAgICAgICAgICAgICAgc2hhcGVDb3VudCA9IHNoYXBlc2VxLmxlbmd0aCwKICAgICAgICAgICAgICAgIGNvbnRleHQgPSB0aGlzLl9nZXRDb250ZXh0KCksCiAgICAgICAgICAgICAgICBzaGFwZWlkLCBzaGFwZSwgaTsKICAgICAgICAgICAgY29udGV4dC5jbGVhclJlY3QoMCwgMCwgdGhpcy5waXhlbFdpZHRoLCB0aGlzLnBpeGVsSGVpZ2h0KTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNoYXBlQ291bnQ7IGkrKykgewogICAgICAgICAgICAgICAgc2hhcGVpZCA9IHNoYXBlc2VxW2ldOwogICAgICAgICAgICAgICAgc2hhcGUgPSBzaGFwZXNbc2hhcGVpZF07CiAgICAgICAgICAgICAgICB0aGlzWydfZHJhdycgKyBzaGFwZS50eXBlXS5hcHBseSh0aGlzLCBzaGFwZS5hcmdzKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIXRoaXMuaW50ZXJhY3QpIHsKICAgICAgICAgICAgICAgIC8vIG5vdCBpbnRlcmFjdGl2ZSBzbyBubyBuZWVkIHRvIGtlZXAgdGhlIHNoYXBlcyBhcnJheQogICAgICAgICAgICAgICAgdGhpcy5zaGFwZXMgPSB7fTsKICAgICAgICAgICAgICAgIHRoaXMuc2hhcGVzZXEgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgIH0KCiAgICB9KTsKCiAgICBWQ2FudmFzX3ZtbCA9IGNyZWF0ZUNsYXNzKFZDYW52YXNfYmFzZSwgewogICAgICAgIGluaXQ6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0LCB0YXJnZXQpIHsKICAgICAgICAgICAgdmFyIGdyb3VwZWw7CiAgICAgICAgICAgIFZDYW52YXNfdm1sLl9zdXBlci5pbml0LmNhbGwodGhpcywgd2lkdGgsIGhlaWdodCwgdGFyZ2V0KTsKICAgICAgICAgICAgaWYgKHRhcmdldFswXSkgewogICAgICAgICAgICAgICAgdGFyZ2V0ID0gdGFyZ2V0WzBdOwogICAgICAgICAgICB9CiAgICAgICAgICAgICQuZGF0YSh0YXJnZXQsICdfanFzX3ZjYW52YXMnLCB0aGlzKTsKICAgICAgICAgICAgdGhpcy5jYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICAgICAgICAgICQodGhpcy5jYW52YXMpLmNzcyh7IGRpc3BsYXk6ICdpbmxpbmUtYmxvY2snLCBwb3NpdGlvbjogJ3JlbGF0aXZlJywgb3ZlcmZsb3c6ICdoaWRkZW4nLCB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0LCBtYXJnaW46ICcwcHgnLCBwYWRkaW5nOiAnMHB4JywgdmVydGljYWxBbGlnbjogJ3RvcCd9KTsKICAgICAgICAgICAgdGhpcy5faW5zZXJ0KHRoaXMuY2FudmFzLCB0YXJnZXQpOwogICAgICAgICAgICB0aGlzLl9jYWxjdWxhdGVQaXhlbERpbXMod2lkdGgsIGhlaWdodCwgdGhpcy5jYW52YXMpOwogICAgICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IHRoaXMucGl4ZWxXaWR0aDsKICAgICAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5waXhlbEhlaWdodDsKICAgICAgICAgICAgZ3JvdXBlbCA9ICc8djpncm91cCBjb29yZG9yaWdpbj0iMCAwIiBjb29yZHNpemU9IicgKyB0aGlzLnBpeGVsV2lkdGggKyAnICcgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJyInICsKICAgICAgICAgICAgICAgICAgICAnIHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7d2lkdGg6JyArIHRoaXMucGl4ZWxXaWR0aCArICdweDtoZWlnaHQ9JyArIHRoaXMucGl4ZWxIZWlnaHQgKyAncHg7Ij48L3Y6Z3JvdXA+JzsKICAgICAgICAgICAgdGhpcy5jYW52YXMuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVFbmQnLCBncm91cGVsKTsKICAgICAgICAgICAgdGhpcy5ncm91cCA9ICQodGhpcy5jYW52YXMpLmNoaWxkcmVuKClbMF07CiAgICAgICAgICAgIHRoaXMucmVuZGVyZWQgPSBmYWxzZTsKICAgICAgICAgICAgdGhpcy5wcmVyZW5kZXIgPSAnJzsKICAgICAgICB9LAoKICAgICAgICBfZHJhd1NoYXBlOiBmdW5jdGlvbiAoc2hhcGVpZCwgcGF0aCwgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCkgewogICAgICAgICAgICB2YXIgdnBhdGggPSBbXSwKICAgICAgICAgICAgICAgIGluaXRpYWwsIHN0cm9rZSwgZmlsbCwgY2xvc2VkLCB2ZWwsIHBsZW4sIGk7CiAgICAgICAgICAgIGZvciAoaSA9IDAsIHBsZW4gPSBwYXRoLmxlbmd0aDsgaSA8IHBsZW47IGkrKykgewogICAgICAgICAgICAgICAgdnBhdGhbaV0gPSAnJyArIChwYXRoW2ldWzBdKSArICcsJyArIChwYXRoW2ldWzFdKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbml0aWFsID0gdnBhdGguc3BsaWNlKDAsIDEpOwogICAgICAgICAgICBsaW5lV2lkdGggPSBsaW5lV2lkdGggPT09IHVuZGVmaW5lZCA/IDEgOiBsaW5lV2lkdGg7CiAgICAgICAgICAgIHN0cm9rZSA9IGxpbmVDb2xvciA9PT0gdW5kZWZpbmVkID8gJyBzdHJva2VkPSJmYWxzZSIgJyA6ICcgc3Ryb2tlV2VpZ2h0PSInICsgbGluZVdpZHRoICsgJ3B4IiBzdHJva2VDb2xvcj0iJyArIGxpbmVDb2xvciArICciICc7CiAgICAgICAgICAgIGZpbGwgPSBmaWxsQ29sb3IgPT09IHVuZGVmaW5lZCA/ICcgZmlsbGVkPSJmYWxzZSInIDogJyBmaWxsQ29sb3I9IicgKyBmaWxsQ29sb3IgKyAnIiBmaWxsZWQ9InRydWUiICc7CiAgICAgICAgICAgIGNsb3NlZCA9IHZwYXRoWzBdID09PSB2cGF0aFt2cGF0aC5sZW5ndGggLSAxXSA/ICd4ICcgOiAnJzsKICAgICAgICAgICAgdmVsID0gJzx2OnNoYXBlIGNvb3Jkb3JpZ2luPSIwIDAiIGNvb3Jkc2l6ZT0iJyArIHRoaXMucGl4ZWxXaWR0aCArICcgJyArIHRoaXMucGl4ZWxIZWlnaHQgKyAnIiAnICsKICAgICAgICAgICAgICAgICAnIGlkPSJqcXNzaGFwZScgKyBzaGFwZWlkICsgJyIgJyArCiAgICAgICAgICAgICAgICAgc3Ryb2tlICsKICAgICAgICAgICAgICAgICBmaWxsICsKICAgICAgICAgICAgICAgICcgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2xlZnQ6MHB4O3RvcDowcHg7aGVpZ2h0OicgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJ3B4O3dpZHRoOicgKyB0aGlzLnBpeGVsV2lkdGggKyAncHg7cGFkZGluZzowcHg7bWFyZ2luOjBweDsiICcgKwogICAgICAgICAgICAgICAgJyBwYXRoPSJtICcgKyBpbml0aWFsICsgJyBsICcgKyB2cGF0aC5qb2luKCcsICcpICsgJyAnICsgY2xvc2VkICsgJ2UiPicgKwogICAgICAgICAgICAgICAgJyA8L3Y6c2hhcGU+JzsKICAgICAgICAgICAgcmV0dXJuIHZlbDsKICAgICAgICB9LAoKICAgICAgICBfZHJhd0NpcmNsZTogZnVuY3Rpb24gKHNoYXBlaWQsIHgsIHksIHJhZGl1cywgbGluZUNvbG9yLCBmaWxsQ29sb3IsIGxpbmVXaWR0aCkgewogICAgICAgICAgICB2YXIgc3Ryb2tlLCBmaWxsLCB2ZWw7CiAgICAgICAgICAgIHggLT0gcmFkaXVzOwogICAgICAgICAgICB5IC09IHJhZGl1czsKICAgICAgICAgICAgc3Ryb2tlID0gbGluZUNvbG9yID09PSB1bmRlZmluZWQgPyAnIHN0cm9rZWQ9ImZhbHNlIiAnIDogJyBzdHJva2VXZWlnaHQ9IicgKyBsaW5lV2lkdGggKyAncHgiIHN0cm9rZUNvbG9yPSInICsgbGluZUNvbG9yICsgJyIgJzsKICAgICAgICAgICAgZmlsbCA9IGZpbGxDb2xvciA9PT0gdW5kZWZpbmVkID8gJyBmaWxsZWQ9ImZhbHNlIicgOiAnIGZpbGxDb2xvcj0iJyArIGZpbGxDb2xvciArICciIGZpbGxlZD0idHJ1ZSIgJzsKICAgICAgICAgICAgdmVsID0gJzx2Om92YWwgJyArCiAgICAgICAgICAgICAgICAgJyBpZD0ianFzc2hhcGUnICsgc2hhcGVpZCArICciICcgKwogICAgICAgICAgICAgICAgc3Ryb2tlICsKICAgICAgICAgICAgICAgIGZpbGwgKwogICAgICAgICAgICAgICAgJyBzdHlsZT0icG9zaXRpb246YWJzb2x1dGU7dG9wOicgKyB5ICsgJ3B4OyBsZWZ0OicgKyB4ICsgJ3B4OyB3aWR0aDonICsgKHJhZGl1cyAqIDIpICsgJ3B4OyBoZWlnaHQ6JyArIChyYWRpdXMgKiAyKSArICdweCI+PC92Om92YWw+JzsKICAgICAgICAgICAgcmV0dXJuIHZlbDsKCiAgICAgICAgfSwKCiAgICAgICAgX2RyYXdQaWVTbGljZTogZnVuY3Rpb24gKHNoYXBlaWQsIHgsIHksIHJhZGl1cywgc3RhcnRBbmdsZSwgZW5kQW5nbGUsIGxpbmVDb2xvciwgZmlsbENvbG9yKSB7CiAgICAgICAgICAgIHZhciB2cGF0aCwgc3RhcnR4LCBzdGFydHksIGVuZHgsIGVuZHksIHN0cm9rZSwgZmlsbCwgdmVsOwogICAgICAgICAgICBpZiAoc3RhcnRBbmdsZSA9PT0gZW5kQW5nbGUpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnJzsgIC8vIFZNTCBzZWVtcyB0byBoYXZlIHByb2JsZW0gd2hlbiBzdGFydCBhbmdsZSBlcXVhbHMgZW5kIGFuZ2xlLgogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICgoZW5kQW5nbGUgLSBzdGFydEFuZ2xlKSA9PT0gKDIgKiBNYXRoLlBJKSkgewogICAgICAgICAgICAgICAgc3RhcnRBbmdsZSA9IDAuMDsgIC8vIFZNTCBzZWVtcyB0byBoYXZlIGEgcHJvYmxlbSB3aGVuIGRyYXdpbmcgYSBmdWxsIGNpcmNsZSB0aGF0IGRvZXNuJ3Qgc3RhcnQgMAogICAgICAgICAgICAgICAgZW5kQW5nbGUgPSAoMiAqIE1hdGguUEkpOwogICAgICAgICAgICB9CgogICAgICAgICAgICBzdGFydHggPSB4ICsgTWF0aC5yb3VuZChNYXRoLmNvcyhzdGFydEFuZ2xlKSAqIHJhZGl1cyk7CiAgICAgICAgICAgIHN0YXJ0eSA9IHkgKyBNYXRoLnJvdW5kKE1hdGguc2luKHN0YXJ0QW5nbGUpICogcmFkaXVzKTsKICAgICAgICAgICAgZW5keCA9IHggKyBNYXRoLnJvdW5kKE1hdGguY29zKGVuZEFuZ2xlKSAqIHJhZGl1cyk7CiAgICAgICAgICAgIGVuZHkgPSB5ICsgTWF0aC5yb3VuZChNYXRoLnNpbihlbmRBbmdsZSkgKiByYWRpdXMpOwoKICAgICAgICAgICAgaWYgKHN0YXJ0eCA9PT0gZW5keCAmJiBzdGFydHkgPT09IGVuZHkpIHsKICAgICAgICAgICAgICAgIGlmICgoZW5kQW5nbGUgLSBzdGFydEFuZ2xlKSA8IE1hdGguUEkpIHsKICAgICAgICAgICAgICAgICAgICAvLyBQcmV2ZW50IHZlcnkgc21hbGwgc2xpY2VzIGZyb20gYmVpbmcgbWlzdGFrZW4gYXMgYSB3aG9sZSBwaWUKICAgICAgICAgICAgICAgICAgICByZXR1cm4gJyc7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAvLyBlc3NlbnRpYWxseSBnb2luZyB0byBiZSB0aGUgZW50aXJlIGNpcmNsZSwgc28gaWdub3JlIHN0YXJ0QW5nbGUKICAgICAgICAgICAgICAgIHN0YXJ0eCA9IGVuZHggPSB4ICsgcmFkaXVzOwogICAgICAgICAgICAgICAgc3RhcnR5ID0gZW5keSA9IHk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGlmIChzdGFydHggPT09IGVuZHggJiYgc3RhcnR5ID09PSBlbmR5ICYmIChlbmRBbmdsZSAtIHN0YXJ0QW5nbGUpIDwgTWF0aC5QSSkgewogICAgICAgICAgICAgICAgcmV0dXJuICcnOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2cGF0aCA9IFt4IC0gcmFkaXVzLCB5IC0gcmFkaXVzLCB4ICsgcmFkaXVzLCB5ICsgcmFkaXVzLCBzdGFydHgsIHN0YXJ0eSwgZW5keCwgZW5keV07CiAgICAgICAgICAgIHN0cm9rZSA9IGxpbmVDb2xvciA9PT0gdW5kZWZpbmVkID8gJyBzdHJva2VkPSJmYWxzZSIgJyA6ICcgc3Ryb2tlV2VpZ2h0PSIxcHgiIHN0cm9rZUNvbG9yPSInICsgbGluZUNvbG9yICsgJyIgJzsKICAgICAgICAgICAgZmlsbCA9IGZpbGxDb2xvciA9PT0gdW5kZWZpbmVkID8gJyBmaWxsZWQ9ImZhbHNlIicgOiAnIGZpbGxDb2xvcj0iJyArIGZpbGxDb2xvciArICciIGZpbGxlZD0idHJ1ZSIgJzsKICAgICAgICAgICAgdmVsID0gJzx2OnNoYXBlIGNvb3Jkb3JpZ2luPSIwIDAiIGNvb3Jkc2l6ZT0iJyArIHRoaXMucGl4ZWxXaWR0aCArICcgJyArIHRoaXMucGl4ZWxIZWlnaHQgKyAnIiAnICsKICAgICAgICAgICAgICAgICAnIGlkPSJqcXNzaGFwZScgKyBzaGFwZWlkICsgJyIgJyArCiAgICAgICAgICAgICAgICAgc3Ryb2tlICsKICAgICAgICAgICAgICAgICBmaWxsICsKICAgICAgICAgICAgICAgICcgc3R5bGU9InBvc2l0aW9uOmFic29sdXRlO2xlZnQ6MHB4O3RvcDowcHg7aGVpZ2h0OicgKyB0aGlzLnBpeGVsSGVpZ2h0ICsgJ3B4O3dpZHRoOicgKyB0aGlzLnBpeGVsV2lkdGggKyAncHg7cGFkZGluZzowcHg7bWFyZ2luOjBweDsiICcgKwogICAgICAgICAgICAgICAgJyBwYXRoPSJtICcgKyB4ICsgJywnICsgeSArICcgd2EgJyArIHZwYXRoLmpvaW4oJywgJykgKyAnIHggZSI+JyArCiAgICAgICAgICAgICAgICAnIDwvdjpzaGFwZT4nOwogICAgICAgICAgICByZXR1cm4gdmVsOwogICAgICAgIH0sCgogICAgICAgIF9kcmF3UmVjdDogZnVuY3Rpb24gKHNoYXBlaWQsIHgsIHksIHdpZHRoLCBoZWlnaHQsIGxpbmVDb2xvciwgZmlsbENvbG9yKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLl9kcmF3U2hhcGUoc2hhcGVpZCwgW1t4LCB5XSwgW3gsIHkgKyBoZWlnaHRdLCBbeCArIHdpZHRoLCB5ICsgaGVpZ2h0XSwgW3ggKyB3aWR0aCwgeV0sIFt4LCB5XV0sIGxpbmVDb2xvciwgZmlsbENvbG9yKTsKICAgICAgICB9LAoKICAgICAgICByZXNldDogZnVuY3Rpb24gKCkgewogICAgICAgICAgICB0aGlzLmdyb3VwLmlubmVySFRNTCA9ICcnOwogICAgICAgIH0sCgogICAgICAgIGFwcGVuZFNoYXBlOiBmdW5jdGlvbiAoc2hhcGUpIHsKICAgICAgICAgICAgdmFyIHZlbCA9IHRoaXNbJ19kcmF3JyArIHNoYXBlLnR5cGVdLmFwcGx5KHRoaXMsIHNoYXBlLmFyZ3MpOwogICAgICAgICAgICBpZiAodGhpcy5yZW5kZXJlZCkgewogICAgICAgICAgICAgICAgdGhpcy5ncm91cC5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZUVuZCcsIHZlbCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLnByZXJlbmRlciArPSB2ZWw7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5sYXN0U2hhcGVJZCA9IHNoYXBlLmlkOwogICAgICAgICAgICByZXR1cm4gc2hhcGUuaWQ7CiAgICAgICAgfSwKCiAgICAgICAgcmVwbGFjZVdpdGhTaGFwZTogZnVuY3Rpb24gKHNoYXBlaWQsIHNoYXBlKSB7CiAgICAgICAgICAgIHZhciBleGlzdGluZyA9ICQoJyNqcXNzaGFwZScgKyBzaGFwZWlkKSwKICAgICAgICAgICAgICAgIHZlbCA9IHRoaXNbJ19kcmF3JyArIHNoYXBlLnR5cGVdLmFwcGx5KHRoaXMsIHNoYXBlLmFyZ3MpOwogICAgICAgICAgICBleGlzdGluZ1swXS5vdXRlckhUTUwgPSB2ZWw7CiAgICAgICAgfSwKCiAgICAgICAgcmVwbGFjZVdpdGhTaGFwZXM6IGZ1bmN0aW9uIChzaGFwZWlkcywgc2hhcGVzKSB7CiAgICAgICAgICAgIC8vIHJlcGxhY2UgdGhlIGZpcnN0IHNoYXBlaWQgd2l0aCBhbGwgdGhlIG5ldyBzaGFwZXMgdGhlbiB0b2FzdCB0aGUgcmVtYWluaW5nIG9sZCBzaGFwZXMKICAgICAgICAgICAgdmFyIGV4aXN0aW5nID0gJCgnI2pxc3NoYXBlJyArIHNoYXBlaWRzWzBdKSwKICAgICAgICAgICAgICAgIHJlcGxhY2UgPSAnJywKICAgICAgICAgICAgICAgIHNsZW4gPSBzaGFwZXMubGVuZ3RoLAogICAgICAgICAgICAgICAgaTsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IHNsZW47IGkrKykgewogICAgICAgICAgICAgICAgcmVwbGFjZSArPSB0aGlzWydfZHJhdycgKyBzaGFwZXNbaV0udHlwZV0uYXBwbHkodGhpcywgc2hhcGVzW2ldLmFyZ3MpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGV4aXN0aW5nWzBdLm91dGVySFRNTCA9IHJlcGxhY2U7CiAgICAgICAgICAgIGZvciAoaSA9IDE7IGkgPCBzaGFwZWlkcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgJCgnI2pxc3NoYXBlJyArIHNoYXBlaWRzW2ldKS5yZW1vdmUoKTsKICAgICAgICAgICAgfQogICAgICAgIH0sCgogICAgICAgIGluc2VydEFmdGVyU2hhcGU6IGZ1bmN0aW9uIChzaGFwZWlkLCBzaGFwZSkgewogICAgICAgICAgICB2YXIgZXhpc3RpbmcgPSAkKCcjanFzc2hhcGUnICsgc2hhcGVpZCksCiAgICAgICAgICAgICAgICAgdmVsID0gdGhpc1snX2RyYXcnICsgc2hhcGUudHlwZV0uYXBwbHkodGhpcywgc2hhcGUuYXJncyk7CiAgICAgICAgICAgIGV4aXN0aW5nWzBdLmluc2VydEFkamFjZW50SFRNTCgnYWZ0ZXJFbmQnLCB2ZWwpOwogICAgICAgIH0sCgogICAgICAgIHJlbW92ZVNoYXBlSWQ6IGZ1bmN0aW9uIChzaGFwZWlkKSB7CiAgICAgICAgICAgIHZhciBleGlzdGluZyA9ICQoJyNqcXNzaGFwZScgKyBzaGFwZWlkKTsKICAgICAgICAgICAgdGhpcy5ncm91cC5yZW1vdmVDaGlsZChleGlzdGluZ1swXSk7CiAgICAgICAgfSwKCiAgICAgICAgZ2V0U2hhcGVBdDogZnVuY3Rpb24gKGVsLCB4LCB5KSB7CiAgICAgICAgICAgIHZhciBzaGFwZWlkID0gZWwuaWQuc3Vic3RyKDgpOwogICAgICAgICAgICByZXR1cm4gc2hhcGVpZDsKICAgICAgICB9LAoKICAgICAgICByZW5kZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgaWYgKCF0aGlzLnJlbmRlcmVkKSB7CiAgICAgICAgICAgICAgICAvLyBiYXRjaCB0aGUgaW50aWFsIHJlbmRlciBpbnRvIGEgc2luZ2xlIHJlcGFpbnQKICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXAuaW5uZXJIVE1MID0gdGhpcy5wcmVyZW5kZXI7CiAgICAgICAgICAgICAgICB0aGlzLnJlbmRlcmVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgIH0pOwoKfSkpfShkb2N1bWVudCwgTWF0aCkpOwo="></script>
<link href="data:text/css;charset=utf-8,%2Ehandsontable%20%2EcurrentRow%20%7B%0Abackground%2Dcolor%3A%20%23E7E8EF%3B%0A%7D%0A%2Ehandsontable%20%2EcurrentCol%20%7B%0Abackground%2Dcolor%3A%20%23F9F9FB%3B%0A%7D%0A%2Ehandsontable%20%7B%0Aoverflow%3A%20auto%3B%0A%7D%0A%0A%2Ejqstooltip%7B%0Awidth%3A%20auto%20%21important%3B%0Aheight%3A%20auto%20%21important%3B%0A%7D%0A%0A%2Edatepicker%20%7B%0Az%2Dindex%3A%201000%20%21important%3B%0A%7D%0A%2Ehandsontable%20table%20thead%20th%20%7B%0Awhite%2Dspace%3A%20pre%2Dline%3B%0A%0A%7D%0A" rel="stylesheet" />
<script src="data:application/x-javascript;base64,SFRNTFdpZGdldHMud2lkZ2V0KHsKCiAgbmFtZTogJ3JoYW5kc29udGFibGUnLAoKICB0eXBlOiAnb3V0cHV0JywKCiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQpIHsKCiAgICByZXR1cm4gewoKICAgIH07CgogIH0sCgogIHJlbmRlclZhbHVlOiBmdW5jdGlvbihlbCwgeCwgaW5zdGFuY2UpIHsKCiAgICAvLyBjb252ZXJ0IGpzb24gdG8gYXJyYXkKICAgIGlmICh4LmRhdGEubGVuZ3RoID4gMCAmJiB4LmRhdGFbMF0uY29uc3RydWN0b3IgPT09IEFycmF5KSB7CiAgICAgIHguZGF0YSA9IHguZGF0YTsKICAgIH0gZWxzZSB7CiAgICAgIHguZGF0YSA9IHRvQXJyYXkoeC5kYXRhLm1hcChmdW5jdGlvbihkKSB7CiAgICAgICAgcmV0dXJuIHguckNvbG5hbWVzLm1hcChmdW5jdGlvbihreSkgewogICAgICAgICAgcmV0dXJuIGRba3ldOwogICAgICAgIH0pOwogICAgICB9KSk7CiAgICB9CgogICAgaWYgKHguaXNIZWF0bWFwID09PSB0cnVlKSB7CiAgICAgIHguYWZ0ZXJMb2FkRGF0YSA9IHRoaXMuaW5pdEhlYXRtYXA7CiAgICAgIHguYmVmb3JlQ2hhbmdlUmVuZGVyID0gdGhpcy51cGRhdGVIZWF0bWFwOwogICAgfQoKICAgIHRoaXMuYWZ0ZXJDaGFuZ2VDYWxsYmFjayh4KTsKICAgIHRoaXMuYWZ0ZXJDZWxsTWV0YUNhbGxiYWNrKHgpOwogICAgdGhpcy5hZnRlclJvd0FuZENvbENoYW5nZSh4KTsKCiAgICBpZiAoeC5zZWxlY3RDYWxsYmFjaykgewogICAgICB0aGlzLmFmdGVyU2VsZWN0Q2FsbGJhY2soeCk7CiAgICB9CgogICAgaWYgKGluc3RhbmNlLmhvdCkgeyAvLyB1cGRhdGUgZXhpc3RpbmcgaW5zdGFuY2UKCiAgICAgIGluc3RhbmNlLmhvdC51cGRhdGVTZXR0aW5ncyh4KTsKCiAgICB9IGVsc2UgeyAgLy8gY3JlYXRlIG5ldyBpbnN0YW5jZQoKICAgICAgaW5zdGFuY2UuaG90ID0gbmV3IEhhbmRzb250YWJsZShlbCwgeCk7CgogICAgfQoKICAgIGluc3RhbmNlLmhvdC5wYXJhbXMgPSB4OwogIH0sCgogIHJlc2l6ZTogZnVuY3Rpb24oZWwsIHdpZHRoLCBoZWlnaHQsIGluc3RhbmNlKSB7CgogICAgaW5zdGFuY2UuaG90LnVwZGF0ZVNldHRpbmdzKHsgd2lkdGg6IHdpZHRoLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQKICAgIH0pOwogICAgaW5zdGFuY2UuaG90LnJlbmRlcigpOwoKICB9LAoKICBhZnRlckNoYW5nZUNhbGxiYWNrOiBmdW5jdGlvbih4KSB7CgogICAgeC5hZnRlckNoYW5nZSA9IGZ1bmN0aW9uKGNoYW5nZXMsIHNvdXJjZSkgewoKICAgICAgaWYgKEhUTUxXaWRnZXRzLnNoaW55TW9kZSAmJiBjaGFuZ2VzKSB7CiAgICAgICAgaWYgKHRoaXMuc29ydEluZGV4ICYmIHRoaXMuc29ydEluZGV4Lmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgYyA9IFt0aGlzLnNvcnRJbmRleFtjaGFuZ2VzWzBdWzBdXVswXSwgY2hhbmdlc1swXS5zbGljZSgxLCAxICsgMyldOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjID0gY2hhbmdlczsKICAgICAgICB9CgogICAgICAgIFNoaW55Lm9uSW5wdXRDaGFuZ2UodGhpcy5yb290RWxlbWVudC5pZCwgewogICAgICAgICAgZGF0YTogdGhpcy5nZXREYXRhKCksCiAgICAgICAgICBjaGFuZ2VzOiB7IGV2ZW50OiAiYWZ0ZXJDaGFuZ2UiLCBjaGFuZ2VzOiBjIH0sCiAgICAgICAgICBwYXJhbXM6IHRoaXMucGFyYW1zCiAgICAgICAgfSk7CiAgICAgIH0KCiAgICB9OwogIH0sCgogIGFmdGVyQ2VsbE1ldGFDYWxsYmFjazogZnVuY3Rpb24oeCkgewoKICAgIHguYWZ0ZXJTZXRDZWxsTWV0YSA9IGZ1bmN0aW9uKHIsIGMsIGtleSwgdmFsKSB7CgogICAgICBpZiAoSFRNTFdpZGdldHMuc2hpbnlNb2RlICYmIGtleSA9PT0gImNvbW1lbnQiKSB7CiAgICAgICAgaWYgKHRoaXMuc29ydEluZGV4ICYmIHRoaXMuc29ydEluZGV4Lmxlbmd0aCAhPT0gMCkgewogICAgICAgICAgciA9IHRoaXMuc29ydEluZGV4W3JdWzBdOwogICAgICAgIH0KCiAgICAgICAgU2hpbnkub25JbnB1dENoYW5nZSh0aGlzLnJvb3RFbGVtZW50LmlkICsgIl9jb21tZW50IiwgewogICAgICAgICAgZGF0YTogdGhpcy5nZXREYXRhKCksCiAgICAgICAgICBjb21tZW50OiB7IHI6IHIgKyAxLCBjOiBjICsgMSwga2V5OiBrZXksIHZhbDogdmFsfSwKICAgICAgICAgIHBhcmFtczogdGhpcy5wYXJhbXMKICAgICAgICB9KTsKICAgICAgfQoKICAgIH07CiAgfSwKCiAgYWZ0ZXJTZWxlY3RDYWxsYmFjazogZnVuY3Rpb24oeCkgewoKICAgIHguYWZ0ZXJTZWxlY3Rpb25FbmQgPSBmdW5jdGlvbihyLCBjLCByMiwgYzIpIHsKCiAgICAgIGlmIChIVE1MV2lkZ2V0cy5zaGlueU1vZGUpIHsKICAgICAgICBpZiAodGhpcy5zb3J0SW5kZXggJiYgdGhpcy5zb3J0SW5kZXgubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICByID0gdGhpcy5zb3J0SW5kZXhbcl1bMF07CiAgICAgICAgICByMiA9IHRoaXMuc29ydEluZGV4W3IyXVswXTsKICAgICAgICB9CgogICAgICAgIFNoaW55Lm9uSW5wdXRDaGFuZ2UodGhpcy5yb290RWxlbWVudC5pZCArICJfc2VsZWN0IiwgewogICAgICAgICAgZGF0YTogdGhpcy5nZXREYXRhKCksCiAgICAgICAgICBzZWxlY3Q6IHsgcjogciArIDEsIGM6IGMgKyAxLCByMjogcjIgKyAxLCBjMjogYzIgKyAxfSwKICAgICAgICAgIHBhcmFtczogdGhpcy5wYXJhbXMKICAgICAgICB9KTsKICAgICAgfQoKICAgIH07CiAgfSwKCiAgYWZ0ZXJSb3dBbmRDb2xDaGFuZ2U6IGZ1bmN0aW9uKHgpIHsKCiAgICB4LmFmdGVyQ3JlYXRlUm93ID0gZnVuY3Rpb24oaW5kLCBjdCkgewoKICAgICAgaWYgKEhUTUxXaWRnZXRzLnNoaW55TW9kZSkgewoKICAgICAgICBmb3IodmFyIGkgPSAwLCBjb2xDb3VudCA9IHRoaXMuY291bnRDb2xzKCk7IGkgPCBjb2xDb3VudCA7IGkrKykgewogICAgICAgICAgdGhpcy5zZXREYXRhQXRDZWxsKGluZCwgaSwgdGhpcy5wYXJhbXMuY29sdW1uc1tpXS5kZWZhdWx0KTsKICAgICAgICB9CgogICAgICAgIFNoaW55Lm9uSW5wdXRDaGFuZ2UodGhpcy5yb290RWxlbWVudC5pZCwgewogICAgICAgICAgZGF0YTogdGhpcy5nZXREYXRhKCksCiAgICAgICAgICBjaGFuZ2VzOiB7IGV2ZW50OiAiYWZ0ZXJDcmVhdGVSb3ciLCBpbmQ6IGluZCwgY3Q6IGN0IH0sCiAgICAgICAgICBwYXJhbXM6IHRoaXMucGFyYW1zCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH07CgogICAgeC5hZnRlclJlbW92ZVJvdyA9IGZ1bmN0aW9uKGluZCwgY3QpIHsKCiAgICAgIGlmIChIVE1MV2lkZ2V0cy5zaGlueU1vZGUpCiAgICAgICAgU2hpbnkub25JbnB1dENoYW5nZSh0aGlzLnJvb3RFbGVtZW50LmlkLCB7CiAgICAgICAgICBkYXRhOiB0aGlzLmdldERhdGEoKSwKICAgICAgICAgIGNoYW5nZXM6IHsgZXZlbnQ6ICJhZnRlclJlbW92ZVJvdyIsIGluZDogaW5kLCBjdDogY3QgfSwKICAgICAgICAgIHBhcmFtczogdGhpcy5wYXJhbXMKICAgICAgICB9KTsKICAgIH07CgogICAgeC5hZnRlckNyZWF0ZUNvbCA9IGZ1bmN0aW9uKGluZCwgY3QpIHsKCiAgICAgIGlmIChIVE1MV2lkZ2V0cy5zaGlueU1vZGUpCiAgICAgICAgU2hpbnkub25JbnB1dENoYW5nZSh0aGlzLnJvb3RFbGVtZW50LmlkLCB7CiAgICAgICAgICBkYXRhOiB0aGlzLmdldERhdGEoKSwKICAgICAgICAgIGNoYW5nZXM6IHsgZXZlbnQ6ICJhZnRlckNyZWF0ZUNvbCIsIGluZDogaW5kLCBjdDogY3QgfSwKICAgICAgICAgIHBhcmFtczogdGhpcy5wYXJhbXMKICAgICAgICB9KTsKICAgIH07CgogICAgeC5hZnRlclJlbW92ZUNvbCA9IGZ1bmN0aW9uKGluZCwgY3QpIHsKCiAgICAgIGlmIChIVE1MV2lkZ2V0cy5zaGlueU1vZGUpCiAgICAgICAgU2hpbnkub25JbnB1dENoYW5nZSh0aGlzLnJvb3RFbGVtZW50LmlkLCB7CiAgICAgICAgICBkYXRhOiB0aGlzLmdldERhdGEoKSwKICAgICAgICAgIGNoYW5nZXM6IHsgZXZlbnQ6ICJhZnRlclJlbW92ZUNvbCIsIGluZDogaW5kLCBjdDogY3QgfSwKICAgICAgICAgIHBhcmFtczogdGhpcy5wYXJhbXMKICAgICAgICB9KTsKICAgIH07CgogIH0sCgogIC8vIHNlZSBodHRwOi8vaGFuZHNvbnRhYmxlLmNvbS9kZW1vL2hlYXRtYXBzLmh0bWwKICBpbml0SGVhdG1hcDogZnVuY3Rpb24oZmlyc3RUaW1lLCBzb3VyY2UpIHsKICAgIHRoaXMuaGVhdG1hcCA9IFtdOwoKICAgIGZvcih2YXIgaSA9IDAsIGNvbENvdW50ID0gdGhpcy5jb3VudENvbHMoKTsgaSA8IGNvbENvdW50IDsgaSsrKSB7CiAgICAgIHRoaXMuaGVhdG1hcFtpXSA9IGdlbmVyYXRlSGVhdG1hcERhdGEuY2FsbCh0aGlzLCBpKTsKICAgIH0KICB9LAoKICB1cGRhdGVIZWF0bWFwOiBmdW5jdGlvbihjaGFuZ2UsIHNvdXJjZSkgewogICAgdGhpcy5oZWF0bWFwW2NoYW5nZVswXVsxXV0gPSBnZW5lcmF0ZUhlYXRtYXBEYXRhLmNhbGwodGhpcywgY2hhbmdlWzBdWzFdKTsKICB9Cgp9KTsKCmZ1bmN0aW9uIGdlbmVyYXRlSGVhdG1hcERhdGEoY29sSWQpIHsKCiAgdmFyIHZhbHVlcyA9IHRoaXMuZ2V0RGF0YUF0Q29sKGNvbElkKTsKCiAgcmV0dXJuIHsKICAgIG1pbjogTWF0aC5taW4uYXBwbHkobnVsbCwgdmFsdWVzKSwKICAgIG1heDogTWF0aC5tYXguYXBwbHkobnVsbCwgdmFsdWVzKQogIH07Cn0KCi8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzIyNDc3NjEyL2NvbnZlcnRpbmctYXJyYXktb2Ytb2JqZWN0cy1pbnRvLWFycmF5LW9mLWFycmF5cwpmdW5jdGlvbiB0b0FycmF5KGlucHV0KSB7CiAgdmFyIHJlc3VsdCA9IGlucHV0Lm1hcChmdW5jdGlvbihvYmopIHsKICAgIHJldHVybiBPYmplY3Qua2V5cyhvYmopLm1hcChmdW5jdGlvbihrZXkpIHsKICAgICAgcmV0dXJuIG9ialtrZXldOwogICAgfSk7CiAgfSk7CiAgcmV0dXJuIHJlc3VsdDsKfQoKLy8gY3N2IGxvZ2ljIGFkYXB0ZWQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vanVhbnRhc2Nvbi9qcXVlcnktaGFuZHNvbnRhYmxlLWNzdgpmdW5jdGlvbiBjc3ZTdHJpbmcoaW5zdGFuY2UpIHsKCiAgdmFyIGhlYWRlcnMgPSBpbnN0YW5jZS5nZXRDb2xIZWFkZXIoKTsKCiAgdmFyIGNzdiA9IGhlYWRlcnMuam9pbigiLCIpICsgIlxuIjsKCiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnN0YW5jZS5jb3VudFJvd3MoKTsgaSsrKSB7CiAgICAgIHZhciByb3cgPSBbXTsKICAgICAgZm9yICh2YXIgaCBpbiBoZWFkZXJzKSB7CiAgICAgICAgICB2YXIgcHJvcCA9IGluc3RhbmNlLmNvbFRvUHJvcChoKTsKICAgICAgICAgIHZhciB2YWx1ZSA9IGluc3RhbmNlLmdldERhdGFBdFJvd1Byb3AoaSwgcHJvcCk7CiAgICAgICAgICByb3cucHVzaCh2YWx1ZSk7CiAgICAgIH0KCiAgICAgIGNzdiArPSByb3cuam9pbigiLCIpOwogICAgICBjc3YgKz0gIlxuIjsKICB9CgogIHJldHVybiBjc3Y7Cn0KCmZ1bmN0aW9uIGN1c3RvbVJlbmRlcmVyKGluc3RhbmNlLCBURCwgcm93LCBjb2wsIHByb3AsIHZhbHVlLCBjZWxsUHJvcGVydGllcykgewogIGlmICh2YWx1ZSA9PT0gJ05BJykgewogICAgdmFsdWUgPSAnJzsKICAgIEhhbmRzb250YWJsZS5yZW5kZXJlcnMuZ2V0UmVuZGVyZXIoJ3RleHQnKShpbnN0YW5jZSwgVEQsIHJvdywgY29sLCBwcm9wLCB2YWx1ZSwgY2VsbFByb3BlcnRpZXMpOwogIH0gZWxzZSB7CiAgICBpZiAoWydkYXRlJywgJ2hhbmRzb250YWJsZScsICdkcm9wZG93biddLmluZGV4T2YoY2VsbFByb3BlcnRpZXMudHlwZSkgPiAtMSkgewogICAgICB0eXBlID0gJ2F1dG9jb21wbGV0ZSc7CiAgICB9IGVsc2UgewogICAgICB0eXBlID0gY2VsbFByb3BlcnRpZXMudHlwZTsKICAgIH0KICAgIEhhbmRzb250YWJsZS5yZW5kZXJlcnMuZ2V0UmVuZGVyZXIodHlwZSkoaW5zdGFuY2UsIFRELCByb3csIGNvbCwgcHJvcCwgdmFsdWUsIGNlbGxQcm9wZXJ0aWVzKTsKICB9Cn0KCmZ1bmN0aW9uIHJlbmRlclNwYXJrbGluZShpbnN0YW5jZSwgdGQsIHJvdywgY29sLCBwcm9wLCB2YWx1ZSwgY2VsbFByb3BlcnRpZXMpIHsKICB0cnkgewogICAgdmFsID0gSlNPTi5wYXJzZSh2YWx1ZSk7CgogICAgbm0gPSAnc3BhcmtsaW5lc19yJyArIHJvdyArICdfYycgKyBjb2w7CiAgICB0ZC5pbm5lckhUTUwgPSAnPHNwYW4gY2xhc3M9XCInICsgbm0gKyAnXCI+PC9zcGFuPic7CgogICAgLy8gYWRqdXN0IGZvciBjZWxsIHBhZGRpbmcKICAgIGlmICh2YWwub3B0aW9ucyAmJiB2YWwub3B0aW9ucy50eXBlICYmCiAgICAgIFsnYmFyJywgJ3RyaXN0YXRlJ10uaW5kZXhPZih2YWwub3B0aW9ucy50eXBlWzBdKSA+IC0xKSB7CiAgICAgIHZhbC5vcHRpb25zLmJhclNwYWNpbmcgPSAxOwogICAgICB2YWwub3B0aW9ucy5iYXJXaWR0aCA9IE1hdGgubWF4KDEsIE1hdGgucm91bmQoKGluc3RhbmNlLmdldENvbFdpZHRoKGNvbCkgLSA4IC0gKHZhbC52YWx1ZXMubGVuZ3RoIC0gMSkpIC8gdmFsLnZhbHVlcy5sZW5ndGgpKTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghdmFsLm9wdGlvbnMpIHsKICAgICAgICB2YWwub3B0aW9ucyA9IHt9OwogICAgICB9CiAgICAgIHZhbC5vcHRpb25zLndpZHRoID0gKGluc3RhbmNlLmdldENvbFdpZHRoKGNvbCkgLSA4KSArICJweCI7CiAgICB9CgogICAgJCgnLicgKyBubSkuc3BhcmtsaW5lKHZhbC52YWx1ZXMsIHZhbC5vcHRpb25zKTsKICB9IGNhdGNoKGVycikgewogICAgdGQuaW5uZXJIVE1MID0gJyc7CiAgfQoKICByZXR1cm4gdGQ7Cn0KCi8vIGh0dHA6Ly9kb2NzLmhhbmRzb250YWJsZS5jb20vMC4xNi4xL2RlbW8tY3VzdG9tLXJlbmRlcmVycy5odG1sCmZ1bmN0aW9uIHN0cmlwX3RhZ3MoaW5wdXQsIGFsbG93ZWQpIHsKICB2YXIgdGFncyA9IC88XC8/KFthLXpdW2EtejAtOV0qKVxiW14+XSo+L2dpLAogICAgY29tbWVudHNBbmRQaHBUYWdzID0gLzwhLS1bXHNcU10qPy0tPnw8XD8oPzpwaHApP1tcc1xTXSo/XD8+L2dpOwoKICAvLyBtYWtpbmcgc3VyZSB0aGUgYWxsb3dlZCBhcmcgaXMgYSBzdHJpbmcgY29udGFpbmluZyBvbmx5IHRhZ3MgaW4gbG93ZXJjYXNlICg8YT48Yj48Yz4pCiAgYWxsb3dlZCA9ICgoKGFsbG93ZWQgfHwgIiIpICsgIiIpLnRvTG93ZXJDYXNlKCkubWF0Y2goLzxbYS16XVthLXowLTldKj4vZykgfHwgW10pLmpvaW4oJycpOwoKICByZXR1cm4gaW5wdXQucmVwbGFjZShjb21tZW50c0FuZFBocFRhZ3MsICcnKS5yZXBsYWNlKHRhZ3MsIGZ1bmN0aW9uICgkMCwgJDEpIHsKICAgIHJldHVybiBhbGxvd2VkLmluZGV4T2YoJzwnICsgJDEudG9Mb3dlckNhc2UoKSArICc+JykgPiAtMSA/ICQwIDogJyc7CiAgfSk7Cn0KCmZ1bmN0aW9uIHNhZmVIdG1sUmVuZGVyZXIoaW5zdGFuY2UsIHRkLCByb3csIGNvbCwgcHJvcCwgdmFsdWUsIGNlbGxQcm9wZXJ0aWVzKSB7CiAgdmFyIGVzY2FwZWQgPSBIYW5kc29udGFibGUuaGVscGVyLnN0cmluZ2lmeSh2YWx1ZSk7CiAgaWYgKGluc3RhbmNlLmdldFNldHRpbmdzKCkuYWxsb3dlZFRhZ3MpIHsKICAgIHRhZ3MgPSBpbnN0YW5jZS5nZXRTZXR0aW5ncygpLmFsbG93ZWRUYWdzCiAgfSBlbHNlIHsKICAgIHRhZ3MgPSAnPGVtPjxiPjxzdHJvbmc+PGE+PGJpZz4nCiAgfQogIGVzY2FwZWQgPSBzdHJpcF90YWdzKGVzY2FwZWQsIHRhZ3MpOyAvL2JlIHN1cmUgeW91IG9ubHkgYWxsb3cgY2VydGFpbiBIVE1MIHRhZ3MgdG8gYXZvaWQgWFNTIHRocmVhdHMgKHlvdSBzaG91bGQgYWxzbyByZW1vdmUgdW53YW50ZWQgSFRNTCBhdHRyaWJ1dGVzKQogIHRkLmlubmVySFRNTCA9IGVzY2FwZWQ7CgogIHJldHVybiB0ZDsKfQo="></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0A%7D%0Apre%20%7B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">rhandsontable Introduction</h1>
<h4 class="author"><em>Jonathan Owen</em></h4>
<h4 class="date"><em>2016-02-01</em></h4>
</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>rhandsontable is a htmlwidget based on the <a href="https://www.handsontable.com">handsontable.js</a> library.</p>
<blockquote>
<p>Handsontable is a data grid component with an Excel-like appearance. Built in JavaScript, it integrates with any data source with peak efficiency. It comes with powerful features like data validation, sorting, grouping, data binding, formula support or column ordering. (<a href="https://www.handsontable.com">via</a>)</p>
</blockquote>
</div>
<div id="column-types" class="section level2">
<h2>Column Types</h2>
<p>The table includes support for numeric, logical, character and Date types. Logical values will appear as check boxes, and the <a href="https://github.com/dbushell/Pikaday">pikaday.js</a> library is used to specify Date values.</p>
<p>rhandsontable attempts to map R classes to an appropriate handsontable type. Factors will be mapped to <code>dropdown</code>, with the choices specified by <code>level</code> and <code>allowInvalid</code> set to <code>FALSE</code>. To allow new levels, set <code>allowInvalid</code> to <code>TRUE</code> (using <code>hot_col</code>; it may also be desirable to set <code>strict</code> to <code>FALSE</code>). When running in <code>shiny</code>, using <code>hot_to_r</code> will preserve custom factor ordering, and if new levels are allowed, they will be added to the end.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">integer =</span> <span class="dv">1</span>:<span class="dv">10</span>,
                   <span class="dt">numeric =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),
                   <span class="dt">logical =</span> <span class="kw">rep</span>(<span class="ot">TRUE</span>, <span class="dv">10</span>), 
                   <span class="dt">character =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                   <span class="dt">factor =</span> <span class="kw">factor</span>(letters[<span class="dv">1</span>:<span class="dv">10</span>], <span class="dt">levels =</span> letters[<span class="dv">10</span>:<span class="dv">1</span>], 
                                   <span class="dt">ordered =</span> <span class="ot">TRUE</span>),
                   <span class="dt">factor_allow =</span> <span class="kw">factor</span>(letters[<span class="dv">1</span>:<span class="dv">10</span>], <span class="dt">levels =</span> letters[<span class="dv">10</span>:<span class="dv">1</span>], 
                                         <span class="dt">ordered =</span> <span class="ot">TRUE</span>),
                   <span class="dt">date =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                   <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;factor_allow&quot;</span>, <span class="dt">allowInvalid =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><div id="htmlwidget-7065" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-7065">{"x":{"data":[{"integer":1,"numeric":0.4056,"logical":true,"character":"A","factor":"a","factor_allow":"a","date":"02/01/2016"},{"integer":2,"numeric":-0.6166,"logical":true,"character":"B","factor":"b","factor_allow":"b","date":"02/02/2016"},{"integer":3,"numeric":-0.4239,"logical":true,"character":"C","factor":"c","factor_allow":"c","date":"02/03/2016"},{"integer":4,"numeric":1.2896,"logical":true,"character":"D","factor":"d","factor_allow":"d","date":"02/04/2016"},{"integer":5,"numeric":0.6148,"logical":true,"character":"E","factor":"e","factor_allow":"e","date":"02/05/2016"},{"integer":6,"numeric":-0.8555,"logical":true,"character":"F","factor":"f","factor_allow":"f","date":"02/06/2016"},{"integer":7,"numeric":-0.6084,"logical":true,"character":"G","factor":"g","factor_allow":"g","date":"02/07/2016"},{"integer":8,"numeric":-0.7583,"logical":true,"character":"H","factor":"h","factor_allow":"h","date":"02/08/2016"},{"integer":9,"numeric":1.326,"logical":true,"character":"I","factor":"i","factor_allow":"i","date":"02/09/2016"},{"integer":10,"numeric":1.4501,"logical":true,"character":"J","factor":"j","factor_allow":"j","date":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"integer":"integer","numeric":"numeric","logical":"logical","character":"character","factor":"factor","factor_allow":"factor","date":"Date"},"rColnames":["integer","numeric","logical","character","factor","factor_allow","date"],"selectCallback":false,"colHeaders":["integer","numeric","logical","character","factor","factor_allow","date"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"dropdown","source":["j","i","h","g","f","e","d","c","b","a"],"allowInvalid":false,"renderer":"customRenderer","default":null},{"type":"dropdown","source":["j","i","h","g","f","e","d","c","b","a"],"allowInvalid":true,"renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer","columns.5.renderer","columns.6.renderer"]}</script></p>
<p>To improve readability, <code>NA</code> values will be displayed as blank cells. This requires converting columns containing <code>NA</code> to characters, and in the case of factors and Dates, may not display the data in the desired format. It may be beneficial to concert these type of columns to character before passing to <code>rhandsontable</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF_na =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">integer =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">2</span>:<span class="dv">10</span>), 
                   <span class="dt">logical =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">rep</span>(<span class="ot">TRUE</span>, <span class="dv">9</span>)), 
                   <span class="dt">character =</span> <span class="kw">c</span>(<span class="ot">NA</span>, LETTERS[<span class="dv">1</span>:<span class="dv">9</span>]),
                   <span class="dt">factor =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">factor</span>(letters[<span class="dv">1</span>:<span class="dv">9</span>])),
                   <span class="dt">date =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, 
                                    <span class="dt">length.out =</span> <span class="dv">9</span>)),
                   <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

DF_na$factor_ch =<span class="st"> </span><span class="kw">as.character</span>(DF_na$factor)
DF_na$date_ch =<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="kw">as.character</span>(<span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, 
                                       <span class="dt">length.out =</span> <span class="dv">9</span>)))

<span class="kw">rhandsontable</span>(DF_na)</code></pre></div>
<p><div id="htmlwidget-5042" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-5042">{"x":{"data":[{"integer":"NA","logical":"NA","character":"NA","factor":"NA","date":"NA","factor_ch":"NA","date_ch":"NA"},{"integer":2,"logical":true,"character":"A","factor":1,"date":16832,"factor_ch":"1","date_ch":"2016-02-01"},{"integer":3,"logical":true,"character":"B","factor":2,"date":16833,"factor_ch":"2","date_ch":"2016-02-02"},{"integer":4,"logical":true,"character":"C","factor":3,"date":16834,"factor_ch":"3","date_ch":"2016-02-03"},{"integer":5,"logical":true,"character":"D","factor":4,"date":16835,"factor_ch":"4","date_ch":"2016-02-04"},{"integer":6,"logical":true,"character":"E","factor":5,"date":16836,"factor_ch":"5","date_ch":"2016-02-05"},{"integer":7,"logical":true,"character":"F","factor":6,"date":16837,"factor_ch":"6","date_ch":"2016-02-06"},{"integer":8,"logical":true,"character":"G","factor":7,"date":16838,"factor_ch":"7","date_ch":"2016-02-07"},{"integer":9,"logical":true,"character":"H","factor":8,"date":16839,"factor_ch":"8","date_ch":"2016-02-08"},{"integer":10,"logical":true,"character":"I","factor":9,"date":16840,"factor_ch":"9","date_ch":"2016-02-09"}],"rClass":"data.frame","rColClasses":{"integer":"integer","logical":"logical","character":"character","factor":"integer","date":"integer","factor_ch":"character","date_ch":"character"},"rColnames":["integer","logical","character","factor","date","factor_ch","date_ch"],"selectCallback":false,"colHeaders":["integer","logical","character","factor","date","factor_ch","date_ch"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer","columns.5.renderer","columns.6.renderer"]}</script></p>
<div id="dropdown-autocomplete" class="section level3">
<h3>Dropdown / Autocomplete</h3>
<p>To control character column values, the column type can be specified as <code>dropdown</code> or <code>autocomplete</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="co"># try updating big to a value not in the dropdown</span>
<span class="kw">rhandsontable</span>(DF, <span class="dt">rowHeaders =</span> <span class="ot">NULL</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="dt">col =</span> <span class="st">&quot;big&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;dropdown&quot;</span>, <span class="dt">source =</span> LETTERS) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="dt">col =</span> <span class="st">&quot;small&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;autocomplete&quot;</span>, <span class="dt">source =</span> letters,
          <span class="dt">strict =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><div id="htmlwidget-6674" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-6674">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":null,"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"dropdown","renderer":"customRenderer","default":null,"source":["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]},{"type":"autocomplete","renderer":"customRenderer","default":null,"source":["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],"strict":false},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="password" class="section level3">
<h3>Password</h3>
<p>A column can also be specified as a <code>password</code> type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;small&quot;</span>, <span class="st">&quot;password&quot;</span>)</code></pre></div>
<p><div id="htmlwidget-4940" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-4940">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"password","renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="sparkline" class="section level3">
<h3>Sparkline</h3>
<p>New in version 0.2, <a href="http://omnipotent.net/jquery.sparkline/">sparkline.js</a> charts can be added to the table. Thanks to the sparkline package and Ramnath Vaidyanathan for inspiration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

DF$chart =<span class="st"> </span><span class="kw">c</span>(<span class="kw">sapply</span>(<span class="dv">1</span>:<span class="dv">5</span>,
                    function(x) jsonlite::<span class="kw">toJSON</span>(<span class="kw">list</span>(<span class="dt">values=</span><span class="kw">rnorm</span>(<span class="dv">10</span>),
                                                      <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;bar&quot;</span>)))),
             <span class="kw">sapply</span>(<span class="dv">1</span>:<span class="dv">5</span>,
                    function(x) jsonlite::<span class="kw">toJSON</span>(<span class="kw">list</span>(<span class="dt">values=</span><span class="kw">rnorm</span>(<span class="dv">10</span>),
                                                      <span class="dt">options =</span> <span class="kw">list</span>(<span class="dt">type =</span> <span class="st">&quot;line&quot;</span>)))))

<span class="kw">rhandsontable</span>(DF, <span class="dt">rowHeaders =</span> <span class="ot">NULL</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;chart&quot;</span>, <span class="dt">renderer =</span> htmlwidgets::<span class="kw">JS</span>(<span class="st">&quot;renderSparkline&quot;</span>))</code></pre></div>
<p><div id="htmlwidget-3563" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-3563">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016","chart":"{\"values\":[0.8927,0.149,0.8225,0.2228,0.1569,-0.178,-0.8782,0.508,-0.5705,1.808],\"options\":{\"type\":[\"bar\"]}}"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016","chart":"{\"values\":[-1.2467,-0.7488,-1.0671,2.1756,-0.6995,-0.3404,0.8984,-0.2055,0.2221,-0.9968],\"options\":{\"type\":[\"bar\"]}}"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016","chart":"{\"values\":[-0.1417,0.9136,0.8893,0.6788,-1.4164,-0.479,0.552,-1.4477,-0.6968,-0.8555],\"options\":{\"type\":[\"bar\"]}}"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016","chart":"{\"values\":[0.5623,1.0692,0.4015,-0.1423,-0.7874,0.7773,-1.4434,0.904,0.0652,0.8535],\"options\":{\"type\":[\"bar\"]}}"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016","chart":"{\"values\":[-1.2052,0.7679,0.2122,0.4033,0.5922,0.6862,-0.683,-0.6301,1.1714,-0.305],\"options\":{\"type\":[\"bar\"]}}"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016","chart":"{\"values\":[-1.5687,-0.1693,-1.6483,0.4238,0.0194,-1.4184,-0.7134,-0.4732,-1.5203,0.7588],\"options\":{\"type\":[\"line\"]}}"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016","chart":"{\"values\":[0.4601,-1.0848,-0.3629,0.3997,0.0135,0.8352,-1.1044,-1.8543,-0.9871,0.7931],\"options\":{\"type\":[\"line\"]}}"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016","chart":"{\"values\":[-0.4206,1.5564,-0.573,0.0126,-2.0716,3.115,0.0384,-0.3843,-0.4906,-0.3831],\"options\":{\"type\":[\"line\"]}}"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016","chart":"{\"values\":[-1.2319,1.6758,0.9708,-0.7199,-0.6449,-2.1112,0.1909,-1.0425,-0.7328,0.0303],\"options\":{\"type\":[\"line\"]}}"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016","chart":"{\"values\":[0.067,-0.4957,-1.256,0.8278,1.292,-1.2582,0.3451,0.153,-0.1702,-1.6038],\"options\":{\"type\":[\"line\"]}}"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date","chart":"character"},"rColnames":["val","bool","big","small","dt","chart"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt","chart"],"rowHeaders":null,"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null},{"type":"text","renderer":"renderSparkline","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer","columns.5.renderer"]}</script></p>
</div>
<div id="custom-renderer" class="section level3">
<h3>Custom Renderer</h3>
<p>Its also possible to define a custom column renderer function. For example, it may be desirable to include html in a cell. The example below mimics <a href="http://docs.handsontable.com/0.16.1/demo-custom-renderers.html">Custom renderers</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(
  <span class="dt">title =</span> <span class="kw">c</span>(
    <span class="st">&quot;&lt;a href='http://www.amazon.com/Professional-JavaScript-Developers-Nicholas-Zakas/dp/1118026691'&gt;Professional JavaScript for Web Developers&lt;/a&gt;&quot;</span>,
    <span class="st">&quot;&lt;a href='http://shop.oreilly.com/product/9780596517748.do'&gt;JavaScript: The Good Parts&lt;/a&gt;&quot;</span>,
    <span class="st">&quot;&lt;a href='http://shop.oreilly.com/product/9780596805531.do'&gt;JavaScript: The Definitive Guide&lt;/a&gt;&quot;</span>
  ),
  <span class="dt">desc =</span> <span class="kw">c</span>(
    <span class="st">&quot;This &lt;a href='http://bit.ly/sM1bDf'&gt;book&lt;/a&gt; provides a developer-level introduction along with more advanced and useful features of &lt;b&gt;JavaScript&lt;/b&gt;.&quot;</span>,
    <span class="st">&quot;This book provides a developer-level introduction along with &lt;b&gt;more advanced&lt;/b&gt; and useful features of JavaScript.&quot;</span>,
    <span class="st">&quot;&lt;em&gt;JavaScript: The Definitive Guide&lt;/em&gt; provides a thorough description of the core &lt;b&gt;JavaScript&lt;/b&gt; language and both the legacy and standard DOMs implemented in web browsers.&quot;</span>
  ),
  <span class="dt">comments =</span> <span class="kw">c</span>(
    <span class="st">&quot;I would rate it &amp;#x2605;&amp;#x2605;&amp;#x2605;&amp;#x2605;&amp;#x2606;&quot;</span>,
    <span class="st">&quot;This is the book about JavaScript&quot;</span>,
    <span class="st">&quot;I've never actually read it, but the &lt;a href='http://shop.oreilly.com/product/9780596805531.do'&gt;comments&lt;/a&gt; are highly &lt;strong&gt;positive&lt;/strong&gt;.&quot;</span>
  ), 
  <span class="dt">cover =</span> <span class="kw">c</span>(
    <span class="st">&quot;http://ecx.images-amazon.com/images/I/51bRhyVTVGL._SL50_.jpg&quot;</span>,
    <span class="st">&quot;http://ecx.images-amazon.com/images/I/51gdVAEfPUL._SL50_.jpg&quot;</span>,
    <span class="st">&quot;http://ecx.images-amazon.com/images/I/51VFNL4T7kL._SL50_.jpg&quot;</span>
 ),
 <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>
)

<span class="kw">rhandsontable</span>(DF, <span class="dt">allowedTags =</span> <span class="st">&quot;&lt;em&gt;&lt;b&gt;&lt;strong&gt;&lt;a&gt;&lt;big&gt;&quot;</span>, 
              <span class="dt">width =</span> <span class="dv">800</span>, <span class="dt">height =</span> <span class="dv">500</span>, <span class="dt">rowHeaders =</span> <span class="ot">FALSE</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_cols</span>(<span class="dt">colWidths =</span> <span class="kw">c</span>(<span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">80</span>)) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="dv">1</span>:<span class="dv">2</span>, <span class="dt">renderer =</span> <span class="st">&quot;html&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="dv">1</span>:<span class="dv">3</span>, <span class="dt">renderer =</span> htmlwidgets::<span class="kw">JS</span>(<span class="st">&quot;safeHtmlRenderer&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="dv">4</span>, <span class="dt">renderer =</span> <span class="st">&quot;</span>
<span class="st">    function(instance, td, row, col, prop, value, cellProperties) {</span>
<span class="st">      var escaped = Handsontable.helper.stringify(value),</span>
<span class="st">        img;</span>
<span class="st">  </span>
<span class="st">      if (escaped.indexOf('http') === 0) {</span>
<span class="st">        img = document.createElement('IMG');</span>
<span class="st">        img.src = value;</span>
<span class="st">  </span>
<span class="st">        Handsontable.Dom.addEvent(img, 'mousedown', function (e){</span>
<span class="st">          e.preventDefault(); // prevent selection quirk</span>
<span class="st">        });</span>
<span class="st">  </span>
<span class="st">        Handsontable.Dom.empty(td);</span>
<span class="st">        td.appendChild(img);</span>
<span class="st">      }</span>
<span class="st">      else {</span>
<span class="st">        // render as text</span>
<span class="st">        Handsontable.renderers.TextRenderer.apply(this, arguments);</span>
<span class="st">      }</span>
<span class="st">  </span>
<span class="st">      return td;</span>
<span class="st">    }&quot;</span>)</code></pre></div>
<p><div id="htmlwidget-3892" style="width:800px;height:500px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-3892">{"x":{"data":[{"title":"<a href='http://www.amazon.com/Professional-JavaScript-Developers-Nicholas-Zakas/dp/1118026691'>Professional JavaScript for Web Developers</a>","desc":"This <a href='http://bit.ly/sM1bDf'>book</a> provides a developer-level introduction along with more advanced and useful features of <b>JavaScript</b>.","comments":"I would rate it &#x2605;&#x2605;&#x2605;&#x2605;&#x2606;","cover":"http://ecx.images-amazon.com/images/I/51bRhyVTVGL._SL50_.jpg"},{"title":"<a href='http://shop.oreilly.com/product/9780596517748.do'>JavaScript: The Good Parts</a>","desc":"This book provides a developer-level introduction along with <b>more advanced</b> and useful features of JavaScript.","comments":"This is the book about JavaScript","cover":"http://ecx.images-amazon.com/images/I/51gdVAEfPUL._SL50_.jpg"},{"title":"<a href='http://shop.oreilly.com/product/9780596805531.do'>JavaScript: The Definitive Guide</a>","desc":"<em>JavaScript: The Definitive Guide</em> provides a thorough description of the core <b>JavaScript</b> language and both the legacy and standard DOMs implemented in web browsers.","comments":"I've never actually read it, but the <a href='http://shop.oreilly.com/product/9780596805531.do'>comments</a> are highly <strong>positive</strong>.","cover":"http://ecx.images-amazon.com/images/I/51VFNL4T7kL._SL50_.jpg"}],"rClass":"data.frame","rColClasses":{"title":"character","desc":"character","comments":"character","cover":"character"},"rColnames":["title","desc","comments","cover"],"selectCallback":false,"colHeaders":["title","desc","comments","cover"],"rowHeaders":false,"columns":[{"type":"text","renderer":"safeHtmlRenderer","default":null},{"type":"text","renderer":"safeHtmlRenderer","default":null},{"type":"text","renderer":"safeHtmlRenderer","default":null},{"type":"text","renderer":"\n    function(instance, td, row, col, prop, value, cellProperties) {\n      var escaped = Handsontable.helper.stringify(value),\n        img;\n  \n      if (escaped.indexOf('http') === 0) {\n        img = document.createElement('IMG');\n        img.src = value;\n  \n        Handsontable.Dom.addEvent(img, 'mousedown', function (e){\n          e.preventDefault(); // prevent selection quirk\n        });\n  \n        Handsontable.Dom.empty(td);\n        td.appendChild(img);\n      }\n      else {\n        // render as text\n        Handsontable.renderers.TextRenderer.apply(this, arguments);\n      }\n  \n      return td;\n    }","default":null}],"width":800,"height":500,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}},"allowedTags":"<em><b><strong><a><big>","colWidths":[200,200,200,80]},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer"]}</script></p>
<p>For <code>shiny</code> apps, use <code>renderer = htmlwidgets::JS(&quot;safeHtmlRenderer&quot;)</code> to display columns with html data. The allowed html tags default to <code>&lt;em&gt;&lt;b&gt;&lt;strong&gt;&lt;a&gt;&lt;big&gt;</code>, but the (hidden) <code>allowedTags</code> parameter can in <code>rhandsontable</code> can be used to customize this list.</p>
</div>
</div>
<div id="right-click-menu" class="section level2">
<h2>Right-Click Menu</h2>
<p>Right-clicking in a cell will enable a context menu that includes customizable table actions via the <code>hot_context_menu</code> function. For shiny apps, formatting and comment updates made via the context menu are not currently retained.</p>
<p>To disable the context menu, set <code>contextMenu = FALSE</code> in <code>hot_table</code> (or <code>rhandsontable</code>).</p>
<div id="add-remove-rows-columns" class="section level3">
<h3>Add / Remove Rows &amp; Columns</h3>
<p>By default a user can add or remove table rows and columns, but this functionality can be disabled. Note that Handsontable does not allow column be added or deleted to the table if column types are defined (i.e. <code>useTypes == TRUE</code> in <code>rhandsontable</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_context_menu</span>(<span class="dt">allowRowEdit =</span> <span class="ot">FALSE</span>, <span class="dt">allowColEdit =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><div id="htmlwidget-2897" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-2897">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="customizing" class="section level3">
<h3>Customizing</h3>
<p>The <code>customOpts</code> parameter of <code>hot_context_menu</code> can be used to add custom functionality to the context menu. Below are a couple examples.</p>
<div id="export-to-csv" class="section level4">
<h4>Export to CSV</h4>
<p>This example illustrates how to add an option to export the table to a csv file.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="kw">rhandsontable</span>(MAT) %&gt;%
<span class="st">  </span><span class="kw">hot_context_menu</span>(
    <span class="dt">customOpts =</span> <span class="kw">list</span>(
      <span class="dt">csv =</span> <span class="kw">list</span>(<span class="dt">name =</span> <span class="st">&quot;Download to CSV&quot;</span>,
                    <span class="dt">callback =</span> htmlwidgets::<span class="kw">JS</span>(
                      <span class="st">&quot;function (key, options) {</span>
<span class="st">                         var csv = csvString(instance);</span>

<span class="st">                         var link = document.createElement('a');</span>
<span class="st">                         link.setAttribute('href', 'data:text/plain;charset=utf-8,' +</span>
<span class="st">                           encodeURIComponent(csv));</span>
<span class="st">                         link.setAttribute('download', filename);</span>

<span class="st">                         document.body.appendChild(link);</span>
<span class="st">                         link.click();</span>
<span class="st">                         document.body.removeChild(link);</span>
<span class="st">                       }&quot;</span>))))</code></pre></div>
<p><div id="htmlwidget-1543" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-1543">{"x":{"data":[[1.8266,-0.3538,-0.0076,0.0798,-0.0158],[-2.6188,0.0326,1.1562,-0.382,1.0603],[1.1169,-0.0652,0.7741,2.1321,0.9775],[-0.2244,0.1689,-0.3859,0.0694,0.4159],[-1.2899,1.4722,1.4096,-0.5721,0.8396],[-0.3811,-0.4614,-0.3137,0.9136,-0.6242],[-2.4265,-0.6968,-0.1666,0.4137,1.8068],[-0.6149,0.9385,-2.0928,-1.464,-0.7154],[0.645,0.5585,1.6289,1.4077,-0.0425],[-0.3389,-0.1116,-0.5255,0.1231,-0.5006]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[],"col_left":[],"col_right":[],"remove_col":[],"hsep3":{"name":"---------"},"hsep4":{"name":"---------"},"hsep5":{"name":"---------"},"csv":{"name":"Download to CSV","callback":"function (key, options) {\n                         var csv = csvString(instance);\n\n                         var link = document.createElement('a');\n                         link.setAttribute('href', 'data:text/plain;charset=utf-8,' +\n                           encodeURIComponent(csv));\n                         link.setAttribute('download', filename);\n\n                         document.body.appendChild(link);\n                         link.click();\n                         document.body.removeChild(link);\n                       }"}}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer","contextMenu.items.csv.callback"]}</script></p>
</div>
<div id="search" class="section level4">
<h4>Search</h4>
<p>This example illustrates how to enable the search functionality in Handsontable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>,
                <span class="dt">bool =</span> <span class="ot">TRUE</span>,
                <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> <span class="kw">factor</span>(letters[<span class="dv">1</span>:<span class="dv">10</span>]),
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF, <span class="dt">search =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_context_menu</span>(
    <span class="dt">customOpts =</span> <span class="kw">list</span>(
      <span class="dt">search =</span> <span class="kw">list</span>(<span class="dt">name =</span> <span class="st">&quot;Search&quot;</span>,
                    <span class="dt">callback =</span> htmlwidgets::<span class="kw">JS</span>(
                      <span class="st">&quot;function (key, options) {</span>
<span class="st">                         var srch = prompt('Search criteria');</span>

<span class="st">                         this.search.query(srch);</span>
<span class="st">                         this.render();</span>
<span class="st">                       }&quot;</span>))))</code></pre></div>
<p><div id="htmlwidget-5592" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-5592">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"factor","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"dropdown","source":["a","b","c","d","e","f","g","h","i","j"],"allowInvalid":false,"renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[],"col_left":[],"col_right":[],"remove_col":[],"hsep3":{"name":"---------"},"hsep4":{"name":"---------"},"hsep5":{"name":"---------"},"search":{"name":"Search","callback":"function (key, options) {\n                         var srch = prompt('Search criteria');\n\n                         this.search.query(srch);\n                         this.render();\n                       }"}}},"search":true},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer","contextMenu.items.search.callback"]}</script></p>
<p>Future enhancements will look to expand export options.</p>
</div>
</div>
</div>
<div id="numeric-formatting" class="section level2">
<h2>Numeric Formatting</h2>
<p>Numeric columns are formatted using the <a href="http://numeraljs.com/">numeral.js</a> library.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">int =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">float =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>), <span class="dt">cur =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>) *<span class="st"> </span><span class="fl">1E5</span>,
                <span class="dt">lrg =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>) *<span class="st"> </span><span class="fl">1E8</span>, <span class="dt">pct =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>))

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;float&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;0.0&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;cur&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;$0,0.00&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;lrg&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;0a&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;pct&quot;</span>, <span class="dt">format =</span> <span class="st">&quot;0%&quot;</span>)</code></pre></div>
<p><div id="htmlwidget-5031" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-5031">{"x":{"data":[{"int":1,"float":-0.6518,"cur":-116116.7573,"lrg":202197517.5128,"pct":-0.82},{"int":2,"float":2.9813,"cur":-6282.5918,"lrg":-191338675.4655,"pct":-1.4354},{"int":3,"float":0.6393,"cur":36303.9308,"lrg":80324542.365,"pct":0.7308},{"int":4,"float":0.4218,"cur":-48696.9018,"lrg":79996278.2599,"pct":-0.3229},{"int":5,"float":1.2217,"cur":-12152.9383,"lrg":-128444917.2585,"pct":-0.1034},{"int":6,"float":-0.4479,"cur":-43346.2563,"lrg":-33958538.964,"pct":-0.036},{"int":7,"float":0.4837,"cur":-10174.4661,"lrg":-193779877.726,"pct":-1.6746},{"int":8,"float":-0.479,"cur":74040.6922,"lrg":-1647151.2893,"pct":1.0328},{"int":9,"float":1.2978,"cur":13827.5239,"lrg":-64257270.0763,"pct":0.5005},{"int":10,"float":-0.5278,"cur":-330347.1031,"lrg":-2455312.513,"pct":-1.3477}],"rClass":"data.frame","rColClasses":{"int":"integer","float":"numeric","cur":"numeric","lrg":"numeric","pct":"numeric"},"rColnames":["int","float","cur","lrg","pct"],"selectCallback":false,"colHeaders":["int","float","cur","lrg","pct"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.0","renderer":"customRenderer","default":null},{"type":"numeric","format":"$0,0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0a","renderer":"customRenderer","default":null},{"type":"numeric","format":"0%","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="read-only" class="section level2">
<h2>Read Only</h2>
<p>The whole table and individual columns can to set to <code>readOnly</code> to prevent the user from making changes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF, <span class="dt">readOnly =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_col</span>(<span class="st">&quot;val&quot;</span>, <span class="dt">readOnly =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><div id="htmlwidget-8198" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-8198">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","readOnly":false,"renderer":"customRenderer","default":null},{"type":"checkbox","readOnly":true,"renderer":"customRenderer","default":null},{"type":"text","readOnly":true,"renderer":"customRenderer","default":null},{"type":"text","readOnly":true,"renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","readOnly":true,"renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="sorting" class="section level2">
<h2>Sorting</h2>
<p>Column sorting can be enabled; sorting only impacts the widget and will not reorder the original data set.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_cols</span>(<span class="dt">columnSorting =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><div id="htmlwidget-5354" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-5354">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}},"columnSorting":true},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="highlight-rows-columns" class="section level2">
<h2>Highlight Rows &amp; Columns</h2>
<p>With larger tables it my be desirable to highlight the row and column for a selected cell.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_table</span>(<span class="dt">highlightCol =</span> <span class="ot">TRUE</span>, <span class="dt">highlightRow =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><div id="htmlwidget-3054" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-3054">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[],"hsep3":{"name":"---------"}}},"ishighlight":true,"currentRowClassName":"currentRow","currentColClassName":"currentCol"},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="sizing" class="section level2">
<h2>Sizing</h2>
<p>Column and row dimensions can be customized. For larger data sets, (multiple) top rows and left columns can be frozen.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="kw">rhandsontable</span>(MAT, <span class="dt">width =</span> <span class="dv">600</span>, <span class="dt">height =</span> <span class="dv">600</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_cols</span>(<span class="dt">colWidths =</span> <span class="dv">100</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_rows</span>(<span class="dt">rowHeights =</span> <span class="dv">50</span>)</code></pre></div>
<p><div id="htmlwidget-2440" style="width:600px;height:600px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-2440">{"x":{"data":[[-0.319,1.0893,0.8455,1.9194,0.6175],[-1.8235,1.7479,-1.3637,0.4059,0.8728],[0.6266,-0.6409,1.2879,-0.0221,0.4164],[0.8248,-0.539,0.172,-0.5352,0.5596],[-1.0666,-0.2117,0.0949,0.3373,-0.4899],[0.4776,-1.5291,1.8793,-1.8064,0.3657],[0.016,-0.4435,-1.3936,-0.4946,0.6855],[0.2962,0.1692,-0.9035,1.883,-1.2329],[0.6031,0.32,-0.4264,1.093,0.0582],[0.3838,-0.7878,-0.9561,0.4003,-0.4807]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null}],"width":600,"height":600,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}},"colWidths":100,"rowHeights":50},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
<p>The table can be streched to the full width by passing <code>stretchH = &quot;all&quot;</code> to <code>rhandsontable</code> (or <code>hot_table</code>).</p>
</div>
<div id="fixed-rows-columns" class="section level2">
<h2>Fixed Rows / Columns</h2>
<p>For larger data sets, (multiple) top rows and left columns can be frozen.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="kw">rhandsontable</span>(MAT) %&gt;%
<span class="st">  </span><span class="kw">hot_cols</span>(<span class="dt">fixedColumnsLeft =</span> <span class="dv">1</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_rows</span>(<span class="dt">fixedRowsTop =</span> <span class="dv">1</span>)</code></pre></div>
<p><div id="htmlwidget-9569" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-9569">{"x":{"data":[[0.0066,-1.0552,-2.3979,-0.3362,-0.0711],[-0.0964,-2.0936,0.4495,-0.1092,1.4413],[-1.0876,-0.4236,0.9735,0.1685,-1.0806],[0.0532,0.082,0.1706,-1.4796,0.734],[0.162,0.8815,0.7513,-0.1717,-0.2423],[-0.5406,-1.5286,-0.4724,-0.4907,0.8328],[-0.0417,0.3446,0.4503,-1.2313,1.3511],[0.5915,1.2039,1.0432,-0.3624,-1.1656],[0.7501,-0.0669,1.637,-0.7962,-0.1621],[0.8757,1.1642,-0.7968,1.2938,0.2643]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}},"fixedColumnsLeft":1,"fixedRowsTop":1},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="cell-comments" class="section level2">
<h2>Cell Comments</h2>
<p>Comments (hover) can also be added to individual cells and will appear as red flags in the upper right of the cell. Comments can also be added via the right-click context menu, but these updates will not currently be retained by shiny.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_cell</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="st">&quot;Test comment&quot;</span>)</code></pre></div>
<p><div id="htmlwidget-1119" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-1119">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}},"cell":[{"row":0,"col":0,"comment":"Test comment"}]},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="grouping" class="section level2">
<h2>Grouping</h2>
<p>It is also possible to group rows and columns. Note that grouping is not yet supported in markdown documents.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="kw">rhandsontable</span>(MAT) %&gt;%
<span class="st">  </span><span class="kw">hot_table</span>(<span class="dt">groups =</span> <span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">cols =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),
                          <span class="kw">list</span>(<span class="dt">rows =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))))</code></pre></div>
</div>
<div id="borders" class="section level2">
<h2>Borders</h2>
<p>Custom borders can be drawn around cells to highlight specific items. Borders can also be added via the right-click context menu, but these updates will not currently be retained by shiny.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="kw">rhandsontable</span>(MAT) %&gt;%
<span class="st">  </span><span class="kw">hot_table</span>(<span class="dt">customBorders =</span> <span class="kw">list</span>(<span class="kw">list</span>(
    <span class="dt">range =</span> <span class="kw">list</span>(<span class="dt">from =</span> <span class="kw">list</span>(<span class="dt">row =</span> <span class="dv">1</span>, <span class="dt">col =</span> <span class="dv">1</span>),
                 <span class="dt">to =</span> <span class="kw">list</span>(<span class="dt">row =</span> <span class="dv">2</span>, <span class="dt">col =</span> <span class="dv">2</span>)),
    <span class="dt">top =</span> <span class="kw">list</span>(<span class="dt">width =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>),
    <span class="dt">left =</span> <span class="kw">list</span>(<span class="dt">width =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>),
    <span class="dt">bottom =</span> <span class="kw">list</span>(<span class="dt">width =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>),
    <span class="dt">right =</span> <span class="kw">list</span>(<span class="dt">width =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>))))</code></pre></div>
<p><div id="htmlwidget-5768" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-5768">{"x":{"data":[[0.5805,-0.0189,0.0717,-1.3401,-0.1143],[-0.0143,0.0203,0.4171,-0.4285,-0.3022],[-0.2374,-0.0315,-2.1353,-0.6729,0.2458],[-0.3652,0.3759,-1.5426,-0.8139,0.6427],[-1.7071,1.1581,0.9271,-2.0796,-1.1354],[1.2451,0.1877,-0.1511,0.8237,0.9295],[-0.4334,2.3502,0.9381,-1.5669,-0.7605],[0.2427,0.4145,1.8561,0.0372,-1.4331],[0.445,-0.254,0.3094,0.2106,1.1742],[-0.9027,-0.4883,0.7127,1.0423,-0.9156]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[],"hsep3":{"name":"---------"},"hsep4":{"name":"---------"},"borders":[]}},"customBorders":[{"range":{"from":{"row":1,"col":1},"to":{"row":2,"col":2}},"top":{"width":2,"color":"red"},"left":{"width":2,"color":"red"},"bottom":{"width":2,"color":"red"},"right":{"width":2,"color":"red"}}]},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="validation" class="section level2">
<h2>Validation</h2>
<div id="numeric-columns" class="section level3">
<h3>Numeric Columns</h3>
<p>Pre-defined validation can be added for numeric columns in two ways:</p>
<ul>
<li>specify a min and max and any values within the range to exclude</li>
<li>similar to a <code>dropdown</code> column, specify allowed values</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="kw">rhandsontable</span>(MAT *<span class="st"> </span><span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_validate_numeric</span>(<span class="dt">col =</span> <span class="dv">1</span>, <span class="dt">min =</span> -<span class="dv">50</span>, <span class="dt">max =</span> <span class="dv">50</span>, <span class="dt">exclude =</span> <span class="dv">40</span>)</code></pre></div>
<p><div id="htmlwidget-4195" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-4195">{"x":{"data":[[12.6461,-8.8526,-5.4362,-2.3054,0.9214],[6.9058,0.8188,22.5574,-7.6911,-19.021],[-7.6581,-12.0167,-13.1684,-0.692,2.4427],[-11.5572,-9.1286,4.4006,2.8874,3.1771],[9.5996,2.563,-6.9954,-3.7005,-2.8072],[-12.1554,10.617,-19.5942,-4.1225,18.4519],[-10.8156,-2.7282,-6.2155,-2.0358,-10.5281],[-10.6942,-3.2589,8.9277,-2.6517,-6.8518],[-5.4866,17.6625,-35.7657,-5.2296,0.1644],[0.2926,12.3356,8.6437,4.5774,-19.3452]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null,"validator":"function (value, callback) {\n         setTimeout(function(){\n           if (isNaN(parseFloat(value))) {\n             callback(false);\n           }\n           if (['40'].indexOf(value) > -1) { return callback(false); }\n           if (value < -50) { return callback(false); }\n           if (value > 50) { return callback(false); }\n           \n           return callback(true);\n         }, 500)\n       }","allowInvalid":false},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.0.validator","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rhandsontable</span>(MAT *<span class="st"> </span><span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_validate_numeric</span>(<span class="dt">col =</span> <span class="dv">1</span>, <span class="dt">choices =</span> <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">40</span>))</code></pre></div>
<p><div id="htmlwidget-3239" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-3239">{"x":{"data":[[12.6461,-8.8526,-5.4362,-2.3054,0.9214],[6.9058,0.8188,22.5574,-7.6911,-19.021],[-7.6581,-12.0167,-13.1684,-0.692,2.4427],[-11.5572,-9.1286,4.4006,2.8874,3.1771],[9.5996,2.563,-6.9954,-3.7005,-2.8072],[-12.1554,10.617,-19.5942,-4.1225,18.4519],[-10.8156,-2.7282,-6.2155,-2.0358,-10.5281],[-10.6942,-3.2589,8.9277,-2.6517,-6.8518],[-5.4866,17.6625,-35.7657,-5.2296,0.1644],[0.2926,12.3356,8.6437,4.5774,-19.3452]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null,"validator":"function (value, callback) {\n         setTimeout(function(){\n           if (isNaN(parseFloat(value))) {\n             callback(false);\n           }\n           \n           \n           \n           if (['10','20','40'].indexOf(value) == -1) { return callback(false); }\n           return callback(true);\n         }, 500)\n       }","allowInvalid":false},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.0.validator","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="character-columns" class="section level3">
<h3>Character Columns</h3>
<p>For character columns, a vector of allowed options can be specified. A more user-friendly approach may be to use a <code>dropdown</code> column with <code>strict = TRUE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DF =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">val =</span> <span class="dv">1</span>:<span class="dv">10</span>, <span class="dt">bool =</span> <span class="ot">TRUE</span>, <span class="dt">big =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">small =</span> letters[<span class="dv">1</span>:<span class="dv">10</span>],
                <span class="dt">dt =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="kw">Sys.Date</span>(), <span class="dt">by =</span> <span class="st">&quot;days&quot;</span>, <span class="dt">length.out =</span> <span class="dv">10</span>),
                <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)

<span class="kw">rhandsontable</span>(DF) %&gt;%
<span class="st">  </span><span class="kw">hot_validate_character</span>(<span class="dt">col =</span> <span class="st">&quot;big&quot;</span>, <span class="dt">choices =</span> LETTERS[<span class="dv">1</span>:<span class="dv">10</span>])</code></pre></div>
<p><div id="htmlwidget-7372" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-7372">{"x":{"data":[{"val":1,"bool":true,"big":"A","small":"a","dt":"02/01/2016"},{"val":2,"bool":true,"big":"B","small":"b","dt":"02/02/2016"},{"val":3,"bool":true,"big":"C","small":"c","dt":"02/03/2016"},{"val":4,"bool":true,"big":"D","small":"d","dt":"02/04/2016"},{"val":5,"bool":true,"big":"E","small":"e","dt":"02/05/2016"},{"val":6,"bool":true,"big":"F","small":"f","dt":"02/06/2016"},{"val":7,"bool":true,"big":"G","small":"g","dt":"02/07/2016"},{"val":8,"bool":true,"big":"H","small":"h","dt":"02/08/2016"},{"val":9,"bool":true,"big":"I","small":"i","dt":"02/09/2016"},{"val":10,"bool":true,"big":"J","small":"j","dt":"02/10/2016"}],"rClass":"data.frame","rColClasses":{"val":"integer","bool":"logical","big":"character","small":"character","dt":"Date"},"rColnames":["val","bool","big","small","dt"],"selectCallback":false,"colHeaders":["val","bool","big","small","dt"],"rowHeaders":["1","2","3","4","5","6","7","8","9","10"],"columns":[{"type":"numeric","format":"0","renderer":"customRenderer","default":null},{"type":"checkbox","renderer":"customRenderer","default":null},{"type":"text","renderer":"customRenderer","default":null,"validator":"function (value, callback) {\n         setTimeout(function() {\n           if (typeof(value) != 'string') {\n             return callback(false);\n           }\n           if (['A','B','C','D','E','F','G','H','I','J'].indexOf(value) > -1) { return callback(true); }\n           return callback(false);\n         }, 500)\n       }","allowInvalid":false},{"type":"text","renderer":"customRenderer","default":null},{"type":"date","correctFormat":true,"dateFormat":"MM/DD/YYYY","renderer":"customRenderer","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.2.validator","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="custom" class="section level3">
<h3>Custom</h3>
<p>It is also possible to create a custom validation function in JavaScript.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="co"># try to update any cell to 0</span>
<span class="kw">rhandsontable</span>(MAT *<span class="st"> </span><span class="dv">10</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_cols</span>(<span class="dt">validator =</span> <span class="st">&quot;</span>
<span class="st">           function (value, callback) {</span>
<span class="st">            setTimeout(function(){</span>
<span class="st">              callback(value != 0);</span>
<span class="st">            }, 1000)</span>
<span class="st">           }&quot;</span>,
           <span class="dt">allowInvalid =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><div id="htmlwidget-7754" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-7754">{"x":{"data":[[-2.2121,-3.8694,-2.8367,2.9395,0.774],[1.0949,2.2469,8.757,2.9781,-27.5827],[-5.4308,13.1642,-13.8186,-3.6844,10.416],[-1.7524,6.5077,2.4903,0.7746,11.5815],[-1.5196,-11.1472,-17.6072,-30.0755,11.1592],[1.7757,-4.4176,-5.908,2.0038,17.0766],[2.7212,3.3378,-8.4439,-1.7029,6.8157],[-13.7709,11.6733,-8.2214,3.186,11.0692],[11.1054,3.2088,4.9067,-0.1595,-6.4928],[1.2748,-1.1417,-1.7863,-9.1829,9.7445]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null,"validator":"\n           function (value, callback) {\n            setTimeout(function(){\n              callback(value != 0);\n            }, 1000)\n           }","allowInvalid":false},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null,"validator":"\n           function (value, callback) {\n            setTimeout(function(){\n              callback(value != 0);\n            }, 1000)\n           }","allowInvalid":false},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null,"validator":"\n           function (value, callback) {\n            setTimeout(function(){\n              callback(value != 0);\n            }, 1000)\n           }","allowInvalid":false},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null,"validator":"\n           function (value, callback) {\n            setTimeout(function(){\n              callback(value != 0);\n            }, 1000)\n           }","allowInvalid":false},{"type":"numeric","format":"0.00","renderer":"customRenderer","default":null,"validator":"\n           function (value, callback) {\n            setTimeout(function(){\n              callback(value != 0);\n            }, 1000)\n           }","allowInvalid":false}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.0.validator","columns.1.renderer","columns.1.validator","columns.2.renderer","columns.2.validator","columns.3.renderer","columns.3.validator","columns.4.renderer","columns.4.validator"]}</script></p>
</div>
</div>
<div id="conditional-formatting" class="section level2">
<h2>Conditional Formatting</h2>
<p>Conditional formatting can also be specified via custom JavaScript function. Future enhancements will look to simplify this interface.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">100</span>, -<span class="dv">1</span>, <span class="dv">1</span>), <span class="dt">nrow =</span> <span class="dv">10</span>,
             <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>], LETTERS[<span class="dv">1</span>:<span class="dv">10</span>]))
<span class="kw">diag</span>(MAT) =<span class="st"> </span><span class="dv">1</span>
MAT[<span class="kw">upper.tri</span>(MAT)] =<span class="st"> </span>MAT[<span class="kw">lower.tri</span>(MAT)]
<span class="kw">rhandsontable</span>(MAT, <span class="dt">readOnly =</span> <span class="ot">TRUE</span>) %&gt;%
<span class="st">  </span><span class="kw">hot_cols</span>(<span class="dt">renderer =</span> <span class="st">&quot;</span>
<span class="st">           function (instance, td, row, col, prop, value, cellProperties) {</span>
<span class="st">             Handsontable.renderers.TextRenderer.apply(this, arguments);</span>
<span class="st">             if (row == col) {</span>
<span class="st">              td.style.background = 'lightgrey';</span>
<span class="st">             } else if (col &gt; row) {</span>
<span class="st">              td.style.background = 'grey';</span>
<span class="st">              td.style.color = 'grey';</span>
<span class="st">             } else if (value &lt; -0.75) {</span>
<span class="st">              td.style.background = 'pink';</span>
<span class="st">             } else if (value &gt; 0.75) {</span>
<span class="st">              td.style.background = 'lightgreen';</span>
<span class="st">             }</span>
<span class="st">           }&quot;</span>)</code></pre></div>
<p><div id="htmlwidget-5389" style="width:768px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-5389">{"x":{"data":[[1,-0.1711,0.6363,-0.4731,0.4353,0.3228,0.6624,-0.0487,-0.246,0.4452],[-0.1711,1,0.0174,0.7156,-0.5525,-0.8556,0.3519,0.5892,0.8491,-0.1257],[0.6363,0.0265,1,0.7004,-0.314,-0.7876,0.3893,0.0163,0.3892,0.4656],[0.0174,0.3228,0.3893,1,0.0265,-0.4154,0.0058,-0.9704,0.7141,0.565],[-0.4731,-0.8556,0.0058,-0.9704,1,0.315,0.3465,-0.9433,0.2148,-0.5565],[0.7156,-0.7876,0.3465,-0.9433,0.3892,1,-0.6884,-0.3352,0.318,0.5096],[0.7004,-0.4154,-0.6884,-0.3352,0.7141,-0.7326,1,-0.9827,-0.3067,0.1161],[0.4353,0.315,-0.0487,-0.9827,0.2148,0.4452,0.565,1,-0.7326,0.835],[-0.5525,0.6624,0.5892,-0.246,0.318,-0.1257,-0.5565,0.1161,1,0.2438],[-0.314,0.3519,0.0163,0.8491,-0.3067,0.4656,0.5096,0.835,0.2438,1]],"rClass":"matrix","rColClasses":"numeric","rColnames":["A","B","C","D","E","F","G","H","I","J"],"selectCallback":false,"colHeaders":["A","B","C","D","E","F","G","H","I","J"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null},{"type":"numeric","format":"0.00","readOnly":true,"renderer":"\n           function (instance, td, row, col, prop, value, cellProperties) {\n             Handsontable.renderers.TextRenderer.apply(this, arguments);\n             if (row == col) {\n              td.style.background = 'lightgrey';\n             } else if (col > row) {\n              td.style.background = 'grey';\n              td.style.color = 'grey';\n             } else if (value < -0.75) {\n              td.style.background = 'pink';\n             } else if (value > 0.75) {\n              td.style.background = 'lightgreen';\n             }\n           }","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}}},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer","columns.5.renderer","columns.6.renderer","columns.7.renderer","columns.8.renderer","columns.9.renderer"]}</script></p>
</div>
<div id="heatmap" class="section level2">
<h2>Heatmap</h2>
<p>The <a href="http://old.driven-by-data.net/about/chromajs/">chroma.js</a> library can be used to turn the table into a heatmap.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">MAT =<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">50</span>), <span class="dt">nrow =</span> <span class="dv">10</span>, <span class="dt">dimnames =</span> <span class="kw">list</span>(LETTERS[<span class="dv">1</span>:<span class="dv">10</span>],
                                                   letters[<span class="dv">1</span>:<span class="dv">5</span>]))

<span class="kw">rhandsontable</span>(MAT) %&gt;%
<span class="st">  </span><span class="kw">hot_heatmap</span>()</code></pre></div>
<p><div id="htmlwidget-7965" style="width:288px;height:288px;" class="rhandsontable"></div>
<script type="application/json" data-for="htmlwidget-7965">{"x":{"data":[[-1.3347,1.2602,0.4844,-0.1843,1.6429],[-1.7255,1.2924,-1.0942,-0.9784,0.6635],[-1.2626,-0.4336,0.5189,-1.1529,0.7395],[0.7851,1.1078,0.4498,-0.5399,1.5772],[0.2015,0.0909,-0.7031,0.3413,-1.2342],[-0.497,-0.764,0.8456,-0.5194,1.8802],[-0.2256,1.1804,-0.0451,0.9602,0.9752],[0.1736,-0.1052,-1.1094,-2.1896,0.6784],[-1.3265,0.1557,-0.9912,-0.6994,0.1053],[-1.3524,-0.4854,-1.2454,-0.129,0.4435]],"rClass":"matrix","rColClasses":"numeric","rColnames":["a","b","c","d","e"],"selectCallback":false,"colHeaders":["a","b","c","d","e"],"rowHeaders":["A","B","C","D","E","F","G","H","I","J"],"columns":[{"type":"numeric","format":"0.00","renderer":"      function (instance, td, row, col, prop, value, cellProperties) {        Handsontable.renderers.TextRenderer.apply(this, arguments);        heatmapScale  = chroma.scale(['#ED6D47', '#17F556']);        if (instance.heatmap[col]) {          mn = instance.heatmap[col].min;          mx = instance.heatmap[col].max;          pt = (parseInt(value, 10) - mn) / (mx - mn);          td.style.backgroundColor = heatmapScale(pt).hex();        }      }      ","default":null},{"type":"numeric","format":"0.00","renderer":"      function (instance, td, row, col, prop, value, cellProperties) {        Handsontable.renderers.TextRenderer.apply(this, arguments);        heatmapScale  = chroma.scale(['#ED6D47', '#17F556']);        if (instance.heatmap[col]) {          mn = instance.heatmap[col].min;          mx = instance.heatmap[col].max;          pt = (parseInt(value, 10) - mn) / (mx - mn);          td.style.backgroundColor = heatmapScale(pt).hex();        }      }      ","default":null},{"type":"numeric","format":"0.00","renderer":"      function (instance, td, row, col, prop, value, cellProperties) {        Handsontable.renderers.TextRenderer.apply(this, arguments);        heatmapScale  = chroma.scale(['#ED6D47', '#17F556']);        if (instance.heatmap[col]) {          mn = instance.heatmap[col].min;          mx = instance.heatmap[col].max;          pt = (parseInt(value, 10) - mn) / (mx - mn);          td.style.backgroundColor = heatmapScale(pt).hex();        }      }      ","default":null},{"type":"numeric","format":"0.00","renderer":"      function (instance, td, row, col, prop, value, cellProperties) {        Handsontable.renderers.TextRenderer.apply(this, arguments);        heatmapScale  = chroma.scale(['#ED6D47', '#17F556']);        if (instance.heatmap[col]) {          mn = instance.heatmap[col].min;          mx = instance.heatmap[col].max;          pt = (parseInt(value, 10) - mn) / (mx - mn);          td.style.backgroundColor = heatmapScale(pt).hex();        }      }      ","default":null},{"type":"numeric","format":"0.00","renderer":"      function (instance, td, row, col, prop, value, cellProperties) {        Handsontable.renderers.TextRenderer.apply(this, arguments);        heatmapScale  = chroma.scale(['#ED6D47', '#17F556']);        if (instance.heatmap[col]) {          mn = instance.heatmap[col].min;          mx = instance.heatmap[col].max;          pt = (parseInt(value, 10) - mn) / (mx - mn);          td.style.backgroundColor = heatmapScale(pt).hex();        }      }      ","default":null}],"width":null,"height":null,"stretchH":"none","comments":false,"contextMenu":{"items":{"row_above":[],"row_below":[],"remove_row":[],"hsep1":{"name":"---------"},"undo":[],"redo":[],"hsep2":{"name":"---------"},"alignment":[]}},"isHeatmap":true},"evals":["columns.0.renderer","columns.1.renderer","columns.2.renderer","columns.3.renderer","columns.4.renderer"]}</script></p>
</div>
<div id="shiny" class="section level2">
<h2>Shiny</h2>
<p>The data grid will be editable by default and can be used as input to a <code>shiny</code> app. A few <code>shiny</code> and <code>shinydashboard</code> example links are listed below. Note that the shinyapps.io links may not work if the has hit the monthly usage limit.</p>
<p>When using <code>rhandsontable</code> and an input, these apps generally use the <code>hot_to_r</code> function to convert data to an R data.frame and <code>shiny::reactiveValues</code> to store a cached version of the data (see the <em>Data file editor</em> example below). The <code>rhandsontable</code> function also includes the <code>selectCallback</code> parameter, which will fire a callback event when a table cell is selected (see the <em>Table callback linked to chart</em> example below).</p>
<ul>
<li><p><a href="https://jrowen.shinyapps.io/rhandsontable_output">Output only</a></p>
<pre><code>shiny::runGitHub(&quot;rhandsontable&quot;, &quot;jrowen&quot;, 
             subdir = &quot;inst/examples/rhandsontable_output&quot;)</code></pre></li>
<li><p><a href="https://jrowen.shinyapps.io/rhandsontable_datafile">Date file editor</a></p>
<pre><code>shiny::runGitHub(&quot;rhandsontable&quot;, &quot;jrowen&quot;, 
             subdir = &quot;inst/examples/rhandsontable_datafile&quot;)</code></pre></li>
<li><p><a href="https://jrowen.shinyapps.io/rhandsontable_portfolio">Calculation input</a></p>
<pre><code>shiny::runGitHub(&quot;rhandsontable&quot;, &quot;jrowen&quot;, 
             subdir = &quot;inst/examples/rhandsontable_portfolio&quot;)</code></pre></li>
<li><p><a href="https://jrowen.shinyapps.io/rhandsontable_corr">Table callback linked to chart</a></p>
<pre><code>shiny::runGitHub(&quot;rhandsontable&quot;, &quot;jrowen&quot;, 
             subdir = &quot;inst/examples/rhandsontable_corr&quot;)</code></pre></li>
<li><p><a href="https://jrowen.shinyapps.io/rhandsontable_frontier">Multiple input tables</a></p>
<pre><code>shiny::runGitHub(&quot;rhandsontable&quot;, &quot;jrowen&quot;, 
             subdir = &quot;inst/examples/rhandsontable_frontier&quot;)</code></pre></li>
<li><p><a href="https://jrowen.shinyapps.io/rhandsontable_dash">A shinydashboard app</a></p>
<pre><code>shiny::runGitHub(&quot;rhandsontable&quot;, &quot;jrowen&quot;, 
             subdir=&quot;inst/examples/rhandsontable_dash&quot;)</code></pre></li>
</ul>
</div>
<div id="suggestions-contributions" class="section level2">
<h2>Suggestions &amp; Contributions</h2>
<p>Please file a issue if you experience any problems with the widget or have feature requests. Pull requests are also welcome.</p>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
